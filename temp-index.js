var cie=Object.defineProperty;var uie=(t,e,r)=>e in t?cie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Uf=(t,e,r)=>uie(t,typeof e!="symbol"?e+"":e,r);function die(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const c in n)if(c!=="default"&&!(c in t)){const d=Object.getOwnPropertyDescriptor(n,c);d&&Object.defineProperty(t,c,d.get?d:{enumerable:!0,get:()=>n[c]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function r(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(c){if(c.ep)return;c.ep=!0;const d=r(c);fetch(c.href,d)}})();var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function W0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function c9(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var c=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,c.get?c:{enumerable:!0,get:function(){return t[n]}})}),r}var u9={exports:{}},$I={},d9={exports:{}},fi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fE=Symbol.for("react.element"),hie=Symbol.for("react.portal"),fie=Symbol.for("react.fragment"),pie=Symbol.for("react.strict_mode"),mie=Symbol.for("react.profiler"),gie=Symbol.for("react.provider"),_ie=Symbol.for("react.context"),yie=Symbol.for("react.forward_ref"),xie=Symbol.for("react.suspense"),vie=Symbol.for("react.memo"),wie=Symbol.for("react.lazy"),hV=Symbol.iterator;function bie(t){return t===null||typeof t!="object"?null:(t=hV&&t[hV]||t["@@iterator"],typeof t=="function"?t:null)}var h9={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f9=Object.assign,p9={};function Z0(t,e,r){this.props=t,this.context=e,this.refs=p9,this.updater=r||h9}Z0.prototype.isReactComponent={};Z0.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Z0.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function m9(){}m9.prototype=Z0.prototype;function NO(t,e,r){this.props=t,this.context=e,this.refs=p9,this.updater=r||h9}var IO=NO.prototype=new m9;IO.constructor=NO;f9(IO,Z0.prototype);IO.isPureReactComponent=!0;var fV=Array.isArray,g9=Object.prototype.hasOwnProperty,CO={current:null},_9={key:!0,ref:!0,__self:!0,__source:!0};function y9(t,e,r){var n,c={},d=null,p=null;if(e!=null)for(n in e.ref!==void 0&&(p=e.ref),e.key!==void 0&&(d=""+e.key),e)g9.call(e,n)&&!_9.hasOwnProperty(n)&&(c[n]=e[n]);var a=arguments.length-2;if(a===1)c.children=r;else if(1<a){for(var w=Array(a),E=0;E<a;E++)w[E]=arguments[E+2];c.children=w}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)c[n]===void 0&&(c[n]=a[n]);return{$$typeof:fE,type:t,key:d,ref:p,props:c,_owner:CO.current}}function Sie(t,e){return{$$typeof:fE,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function AO(t){return typeof t=="object"&&t!==null&&t.$$typeof===fE}function Eie(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var pV=/\/+/g;function Pk(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Eie(""+t.key):e.toString(36)}function Mj(t,e,r,n,c){var d=typeof t;(d==="undefined"||d==="boolean")&&(t=null);var p=!1;if(t===null)p=!0;else switch(d){case"string":case"number":p=!0;break;case"object":switch(t.$$typeof){case fE:case hie:p=!0}}if(p)return p=t,c=c(p),t=n===""?"."+Pk(p,0):n,fV(c)?(r="",t!=null&&(r=t.replace(pV,"$&/")+"/"),Mj(c,e,r,"",function(E){return E})):c!=null&&(AO(c)&&(c=Sie(c,r+(!c.key||p&&p.key===c.key?"":(""+c.key).replace(pV,"$&/")+"/")+t)),e.push(c)),1;if(p=0,n=n===""?".":n+":",fV(t))for(var a=0;a<t.length;a++){d=t[a];var w=n+Pk(d,a);p+=Mj(d,e,r,w,c)}else if(w=bie(t),typeof w=="function")for(t=w.call(t),a=0;!(d=t.next()).done;)d=d.value,w=n+Pk(d,a++),p+=Mj(d,e,r,w,c);else if(d==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return p}function q2(t,e,r){if(t==null)return t;var n=[],c=0;return Mj(t,n,"","",function(d){return e.call(r,d,c++)}),n}function Tie(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Cc={current:null},Dj={transition:null},jie={ReactCurrentDispatcher:Cc,ReactCurrentBatchConfig:Dj,ReactCurrentOwner:CO};function x9(){throw Error("act(...) is not supported in production builds of React.")}fi.Children={map:q2,forEach:function(t,e,r){q2(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return q2(t,function(){e++}),e},toArray:function(t){return q2(t,function(e){return e})||[]},only:function(t){if(!AO(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};fi.Component=Z0;fi.Fragment=fie;fi.Profiler=mie;fi.PureComponent=NO;fi.StrictMode=pie;fi.Suspense=xie;fi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jie;fi.act=x9;fi.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=f9({},t.props),c=t.key,d=t.ref,p=t._owner;if(e!=null){if(e.ref!==void 0&&(d=e.ref,p=CO.current),e.key!==void 0&&(c=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(w in e)g9.call(e,w)&&!_9.hasOwnProperty(w)&&(n[w]=e[w]===void 0&&a!==void 0?a[w]:e[w])}var w=arguments.length-2;if(w===1)n.children=r;else if(1<w){a=Array(w);for(var E=0;E<w;E++)a[E]=arguments[E+2];n.children=a}return{$$typeof:fE,type:t.type,key:c,ref:d,props:n,_owner:p}};fi.createContext=function(t){return t={$$typeof:_ie,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:gie,_context:t},t.Consumer=t};fi.createElement=y9;fi.createFactory=function(t){var e=y9.bind(null,t);return e.type=t,e};fi.createRef=function(){return{current:null}};fi.forwardRef=function(t){return{$$typeof:yie,render:t}};fi.isValidElement=AO;fi.lazy=function(t){return{$$typeof:wie,_payload:{_status:-1,_result:t},_init:Tie}};fi.memo=function(t,e){return{$$typeof:vie,type:t,compare:e===void 0?null:e}};fi.startTransition=function(t){var e=Dj.transition;Dj.transition={};try{t()}finally{Dj.transition=e}};fi.unstable_act=x9;fi.useCallback=function(t,e){return Cc.current.useCallback(t,e)};fi.useContext=function(t){return Cc.current.useContext(t)};fi.useDebugValue=function(){};fi.useDeferredValue=function(t){return Cc.current.useDeferredValue(t)};fi.useEffect=function(t,e){return Cc.current.useEffect(t,e)};fi.useId=function(){return Cc.current.useId()};fi.useImperativeHandle=function(t,e,r){return Cc.current.useImperativeHandle(t,e,r)};fi.useInsertionEffect=function(t,e){return Cc.current.useInsertionEffect(t,e)};fi.useLayoutEffect=function(t,e){return Cc.current.useLayoutEffect(t,e)};fi.useMemo=function(t,e){return Cc.current.useMemo(t,e)};fi.useReducer=function(t,e,r){return Cc.current.useReducer(t,e,r)};fi.useRef=function(t){return Cc.current.useRef(t)};fi.useState=function(t){return Cc.current.useState(t)};fi.useSyncExternalStore=function(t,e,r){return Cc.current.useSyncExternalStore(t,e,r)};fi.useTransition=function(){return Cc.current.useTransition()};fi.version="18.3.1";d9.exports=fi;var z=d9.exports;const _n=W0(z),v9=die({__proto__:null,default:_n},[z]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nie=z,Iie=Symbol.for("react.element"),Cie=Symbol.for("react.fragment"),Aie=Object.prototype.hasOwnProperty,Pie=Nie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kie={key:!0,ref:!0,__self:!0,__source:!0};function w9(t,e,r){var n,c={},d=null,p=null;r!==void 0&&(d=""+r),e.key!==void 0&&(d=""+e.key),e.ref!==void 0&&(p=e.ref);for(n in e)Aie.call(e,n)&&!kie.hasOwnProperty(n)&&(c[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)c[n]===void 0&&(c[n]=e[n]);return{$$typeof:Iie,type:t,key:d,ref:p,props:c,_owner:Pie.current}}$I.Fragment=Cie;$I.jsx=w9;$I.jsxs=w9;u9.exports=$I;var i=u9.exports,b9={exports:{}},Lu={},S9={exports:{}},E9={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e($e,st){var it=$e.length;$e.push(st);e:for(;0<it;){var Mt=it-1>>>1,ar=$e[Mt];if(0<c(ar,st))$e[Mt]=st,$e[it]=ar,it=Mt;else break e}}function r($e){return $e.length===0?null:$e[0]}function n($e){if($e.length===0)return null;var st=$e[0],it=$e.pop();if(it!==st){$e[0]=it;e:for(var Mt=0,ar=$e.length,St=ar>>>1;Mt<St;){var Xt=2*(Mt+1)-1,dt=$e[Xt],ft=Xt+1,Wt=$e[ft];if(0>c(dt,it))ft<ar&&0>c(Wt,dt)?($e[Mt]=Wt,$e[ft]=it,Mt=ft):($e[Mt]=dt,$e[Xt]=it,Mt=Xt);else if(ft<ar&&0>c(Wt,it))$e[Mt]=Wt,$e[ft]=it,Mt=ft;else break e}}return st}function c($e,st){var it=$e.sortIndex-st.sortIndex;return it!==0?it:$e.id-st.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;t.unstable_now=function(){return d.now()}}else{var p=Date,a=p.now();t.unstable_now=function(){return p.now()-a}}var w=[],E=[],C=1,P=null,R=3,B=!1,V=!1,W=!1,K=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X($e){for(var st=r(E);st!==null;){if(st.callback===null)n(E);else if(st.startTime<=$e)n(E),st.sortIndex=st.expirationTime,e(w,st);else break;st=r(E)}}function Q($e){if(W=!1,X($e),!V)if(r(w)!==null)V=!0,Xe(re);else{var st=r(E);st!==null&&qe(Q,st.startTime-$e)}}function re($e,st){V=!1,W&&(W=!1,Z(ue),ue=-1),B=!0;var it=R;try{for(X(st),P=r(w);P!==null&&(!(P.expirationTime>st)||$e&&!Se());){var Mt=P.callback;if(typeof Mt=="function"){P.callback=null,R=P.priorityLevel;var ar=Mt(P.expirationTime<=st);st=t.unstable_now(),typeof ar=="function"?P.callback=ar:P===r(w)&&n(w),X(st)}else n(w);P=r(w)}if(P!==null)var St=!0;else{var Xt=r(E);Xt!==null&&qe(Q,Xt.startTime-st),St=!1}return St}finally{P=null,R=it,B=!1}}var ve=!1,pe=null,ue=-1,ge=5,ce=-1;function Se(){return!(t.unstable_now()-ce<ge)}function le(){if(pe!==null){var $e=t.unstable_now();ce=$e;var st=!0;try{st=pe(!0,$e)}finally{st?J():(ve=!1,pe=null)}}else ve=!1}var J;if(typeof $=="function")J=function(){$(le)};else if(typeof MessageChannel<"u"){var ke=new MessageChannel,Ze=ke.port2;ke.port1.onmessage=le,J=function(){Ze.postMessage(null)}}else J=function(){K(le,0)};function Xe($e){pe=$e,ve||(ve=!0,J())}function qe($e,st){ue=K(function(){$e(t.unstable_now())},st)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($e){$e.callback=null},t.unstable_continueExecution=function(){V||B||(V=!0,Xe(re))},t.unstable_forceFrameRate=function($e){0>$e||125<$e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ge=0<$e?Math.floor(1e3/$e):5},t.unstable_getCurrentPriorityLevel=function(){return R},t.unstable_getFirstCallbackNode=function(){return r(w)},t.unstable_next=function($e){switch(R){case 1:case 2:case 3:var st=3;break;default:st=R}var it=R;R=st;try{return $e()}finally{R=it}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function($e,st){switch($e){case 1:case 2:case 3:case 4:case 5:break;default:$e=3}var it=R;R=$e;try{return st()}finally{R=it}},t.unstable_scheduleCallback=function($e,st,it){var Mt=t.unstable_now();switch(typeof it=="object"&&it!==null?(it=it.delay,it=typeof it=="number"&&0<it?Mt+it:Mt):it=Mt,$e){case 1:var ar=-1;break;case 2:ar=250;break;case 5:ar=1073741823;break;case 4:ar=1e4;break;default:ar=5e3}return ar=it+ar,$e={id:C++,callback:st,priorityLevel:$e,startTime:it,expirationTime:ar,sortIndex:-1},it>Mt?($e.sortIndex=it,e(E,$e),r(w)===null&&$e===r(E)&&(W?(Z(ue),ue=-1):W=!0,qe(Q,it-Mt))):($e.sortIndex=ar,e(w,$e),V||B||(V=!0,Xe(re))),$e},t.unstable_shouldYield=Se,t.unstable_wrapCallback=function($e){var st=R;return function(){var it=R;R=st;try{return $e.apply(this,arguments)}finally{R=it}}}})(E9);S9.exports=E9;var Rie=S9.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mie=z,Du=Rie;function Rr(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var T9=new Set,pS={};function Iy(t,e){p0(t,e),p0(t+"Capture",e)}function p0(t,e){for(pS[t]=e,t=0;t<e.length;t++)T9.add(e[t])}var dp=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),uM=Object.prototype.hasOwnProperty,Die=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,mV={},gV={};function Oie(t){return uM.call(gV,t)?!0:uM.call(mV,t)?!1:Die.test(t)?gV[t]=!0:(mV[t]=!0,!1)}function Lie(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Fie(t,e,r,n){if(e===null||typeof e>"u"||Lie(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ac(t,e,r,n,c,d,p){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=d,this.removeEmptyString=p}var Il={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Il[t]=new Ac(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Il[e]=new Ac(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Il[t]=new Ac(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Il[t]=new Ac(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Il[t]=new Ac(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Il[t]=new Ac(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Il[t]=new Ac(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Il[t]=new Ac(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Il[t]=new Ac(t,5,!1,t.toLowerCase(),null,!1,!1)});var PO=/[\-:]([a-z])/g;function kO(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(PO,kO);Il[e]=new Ac(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(PO,kO);Il[e]=new Ac(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(PO,kO);Il[e]=new Ac(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Il[t]=new Ac(t,1,!1,t.toLowerCase(),null,!1,!1)});Il.xlinkHref=new Ac("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Il[t]=new Ac(t,1,!1,t.toLowerCase(),null,!0,!0)});function RO(t,e,r,n){var c=Il.hasOwnProperty(e)?Il[e]:null;(c!==null?c.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Fie(e,r,c,n)&&(r=null),n||c===null?Oie(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):c.mustUseProperty?t[c.propertyName]=r===null?c.type===3?!1:"":r:(e=c.attributeName,n=c.attributeNamespace,r===null?t.removeAttribute(e):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Ip=Mie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,G2=Symbol.for("react.element"),Av=Symbol.for("react.portal"),Pv=Symbol.for("react.fragment"),MO=Symbol.for("react.strict_mode"),dM=Symbol.for("react.profiler"),j9=Symbol.for("react.provider"),N9=Symbol.for("react.context"),DO=Symbol.for("react.forward_ref"),hM=Symbol.for("react.suspense"),fM=Symbol.for("react.suspense_list"),OO=Symbol.for("react.memo"),km=Symbol.for("react.lazy"),I9=Symbol.for("react.offscreen"),_V=Symbol.iterator;function p1(t){return t===null||typeof t!="object"?null:(t=_V&&t[_V]||t["@@iterator"],typeof t=="function"?t:null)}var ro=Object.assign,kk;function P1(t){if(kk===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);kk=e&&e[1]||""}return`
`+kk+t}var Rk=!1;function Mk(t,e){if(!t||Rk)return"";Rk=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(E){var n=E}Reflect.construct(t,[],e)}else{try{e.call()}catch(E){n=E}t.call(e.prototype)}else{try{throw Error()}catch(E){n=E}t()}}catch(E){if(E&&n&&typeof E.stack=="string"){for(var c=E.stack.split(`
`),d=n.stack.split(`
`),p=c.length-1,a=d.length-1;1<=p&&0<=a&&c[p]!==d[a];)a--;for(;1<=p&&0<=a;p--,a--)if(c[p]!==d[a]){if(p!==1||a!==1)do if(p--,a--,0>a||c[p]!==d[a]){var w=`
`+c[p].replace(" at new "," at ");return t.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",t.displayName)),w}while(1<=p&&0<=a);break}}}finally{Rk=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?P1(t):""}function zie(t){switch(t.tag){case 5:return P1(t.type);case 16:return P1("Lazy");case 13:return P1("Suspense");case 19:return P1("SuspenseList");case 0:case 2:case 15:return t=Mk(t.type,!1),t;case 11:return t=Mk(t.type.render,!1),t;case 1:return t=Mk(t.type,!0),t;default:return""}}function pM(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Pv:return"Fragment";case Av:return"Portal";case dM:return"Profiler";case MO:return"StrictMode";case hM:return"Suspense";case fM:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case N9:return(t.displayName||"Context")+".Consumer";case j9:return(t._context.displayName||"Context")+".Provider";case DO:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case OO:return e=t.displayName||null,e!==null?e:pM(t.type)||"Memo";case km:e=t._payload,t=t._init;try{return pM(t(e))}catch{}}return null}function Bie(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pM(e);case 8:return e===MO?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function og(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function C9(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Vie(t){var e=C9(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,d=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return c.call(this)},set:function(p){n=""+p,d.call(this,p)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(p){n=""+p},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function H2(t){t._valueTracker||(t._valueTracker=Vie(t))}function A9(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=C9(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function uN(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function mM(t,e){var r=e.checked;return ro({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function yV(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=og(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function P9(t,e){e=e.checked,e!=null&&RO(t,"checked",e,!1)}function gM(t,e){P9(t,e);var r=og(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?_M(t,e.type,r):e.hasOwnProperty("defaultValue")&&_M(t,e.type,og(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function xV(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function _M(t,e,r){(e!=="number"||uN(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var k1=Array.isArray;function Wv(t,e,r,n){if(t=t.options,e){e={};for(var c=0;c<r.length;c++)e["$"+r[c]]=!0;for(r=0;r<t.length;r++)c=e.hasOwnProperty("$"+t[r].value),t[r].selected!==c&&(t[r].selected=c),c&&n&&(t[r].defaultSelected=!0)}else{for(r=""+og(r),e=null,c=0;c<t.length;c++){if(t[c].value===r){t[c].selected=!0,n&&(t[c].defaultSelected=!0);return}e!==null||t[c].disabled||(e=t[c])}e!==null&&(e.selected=!0)}}function yM(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Rr(91));return ro({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function vV(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(Rr(92));if(k1(r)){if(1<r.length)throw Error(Rr(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:og(r)}}function k9(t,e){var r=og(e.value),n=og(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function wV(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function R9(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xM(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?R9(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var W2,M9=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,c){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,c)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(W2=W2||document.createElement("div"),W2.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=W2.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function mS(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var H1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Uie=["Webkit","ms","Moz","O"];Object.keys(H1).forEach(function(t){Uie.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),H1[e]=H1[t]})});function D9(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||H1.hasOwnProperty(t)&&H1[t]?(""+e).trim():e+"px"}function O9(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,c=D9(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,c):t[r]=c}}var $ie=ro({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vM(t,e){if(e){if($ie[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Rr(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Rr(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Rr(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Rr(62))}}function wM(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bM=null;function LO(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var SM=null,Zv=null,Kv=null;function bV(t){if(t=gE(t)){if(typeof SM!="function")throw Error(Rr(280));var e=t.stateNode;e&&(e=ZI(e),SM(t.stateNode,t.type,e))}}function L9(t){Zv?Kv?Kv.push(t):Kv=[t]:Zv=t}function F9(){if(Zv){var t=Zv,e=Kv;if(Kv=Zv=null,bV(t),e)for(t=0;t<e.length;t++)bV(e[t])}}function z9(t,e){return t(e)}function B9(){}var Dk=!1;function V9(t,e,r){if(Dk)return t(e,r);Dk=!0;try{return z9(t,e,r)}finally{Dk=!1,(Zv!==null||Kv!==null)&&(B9(),F9())}}function gS(t,e){var r=t.stateNode;if(r===null)return null;var n=ZI(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(Rr(231,e,typeof r));return r}var EM=!1;if(dp)try{var m1={};Object.defineProperty(m1,"passive",{get:function(){EM=!0}}),window.addEventListener("test",m1,m1),window.removeEventListener("test",m1,m1)}catch{EM=!1}function qie(t,e,r,n,c,d,p,a,w){var E=Array.prototype.slice.call(arguments,3);try{e.apply(r,E)}catch(C){this.onError(C)}}var W1=!1,dN=null,hN=!1,TM=null,Gie={onError:function(t){W1=!0,dN=t}};function Hie(t,e,r,n,c,d,p,a,w){W1=!1,dN=null,qie.apply(Gie,arguments)}function Wie(t,e,r,n,c,d,p,a,w){if(Hie.apply(this,arguments),W1){if(W1){var E=dN;W1=!1,dN=null}else throw Error(Rr(198));hN||(hN=!0,TM=E)}}function Cy(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function U9(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function SV(t){if(Cy(t)!==t)throw Error(Rr(188))}function Zie(t){var e=t.alternate;if(!e){if(e=Cy(t),e===null)throw Error(Rr(188));return e!==t?null:t}for(var r=t,n=e;;){var c=r.return;if(c===null)break;var d=c.alternate;if(d===null){if(n=c.return,n!==null){r=n;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===r)return SV(c),t;if(d===n)return SV(c),e;d=d.sibling}throw Error(Rr(188))}if(r.return!==n.return)r=c,n=d;else{for(var p=!1,a=c.child;a;){if(a===r){p=!0,r=c,n=d;break}if(a===n){p=!0,n=c,r=d;break}a=a.sibling}if(!p){for(a=d.child;a;){if(a===r){p=!0,r=d,n=c;break}if(a===n){p=!0,n=d,r=c;break}a=a.sibling}if(!p)throw Error(Rr(189))}}if(r.alternate!==n)throw Error(Rr(190))}if(r.tag!==3)throw Error(Rr(188));return r.stateNode.current===r?t:e}function $9(t){return t=Zie(t),t!==null?q9(t):null}function q9(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=q9(t);if(e!==null)return e;t=t.sibling}return null}var G9=Du.unstable_scheduleCallback,EV=Du.unstable_cancelCallback,Kie=Du.unstable_shouldYield,Xie=Du.unstable_requestPaint,bo=Du.unstable_now,Yie=Du.unstable_getCurrentPriorityLevel,FO=Du.unstable_ImmediatePriority,H9=Du.unstable_UserBlockingPriority,fN=Du.unstable_NormalPriority,Jie=Du.unstable_LowPriority,W9=Du.unstable_IdlePriority,qI=null,Yh=null;function Qie(t){if(Yh&&typeof Yh.onCommitFiberRoot=="function")try{Yh.onCommitFiberRoot(qI,t,void 0,(t.current.flags&128)===128)}catch{}}var Zd=Math.clz32?Math.clz32:rae,eae=Math.log,tae=Math.LN2;function rae(t){return t>>>=0,t===0?32:31-(eae(t)/tae|0)|0}var Z2=64,K2=4194304;function R1(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function pN(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,c=t.suspendedLanes,d=t.pingedLanes,p=r&268435455;if(p!==0){var a=p&~c;a!==0?n=R1(a):(d&=p,d!==0&&(n=R1(d)))}else p=r&~c,p!==0?n=R1(p):d!==0&&(n=R1(d));if(n===0)return 0;if(e!==0&&e!==n&&!(e&c)&&(c=n&-n,d=e&-e,c>=d||c===16&&(d&4194240)!==0))return e;if(n&4&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-Zd(e),c=1<<r,n|=t[r],e&=~c;return n}function nae(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sae(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,c=t.expirationTimes,d=t.pendingLanes;0<d;){var p=31-Zd(d),a=1<<p,w=c[p];w===-1?(!(a&r)||a&n)&&(c[p]=nae(a,e)):w<=e&&(t.expiredLanes|=a),d&=~a}}function jM(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Z9(){var t=Z2;return Z2<<=1,!(Z2&4194240)&&(Z2=64),t}function Ok(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function pE(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Zd(e),t[e]=r}function iae(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var c=31-Zd(r),d=1<<c;e[c]=0,n[c]=-1,t[c]=-1,r&=~d}}function zO(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-Zd(r),c=1<<n;c&e|t[n]&e&&(t[n]|=e),r&=~c}}var na=0;function K9(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var X9,BO,Y9,J9,Q9,NM=!1,X2=[],Xm=null,Ym=null,Jm=null,_S=new Map,yS=new Map,Dm=[],aae="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function TV(t,e){switch(t){case"focusin":case"focusout":Xm=null;break;case"dragenter":case"dragleave":Ym=null;break;case"mouseover":case"mouseout":Jm=null;break;case"pointerover":case"pointerout":_S.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":yS.delete(e.pointerId)}}function g1(t,e,r,n,c,d){return t===null||t.nativeEvent!==d?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:d,targetContainers:[c]},e!==null&&(e=gE(e),e!==null&&BO(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,c!==null&&e.indexOf(c)===-1&&e.push(c),t)}function oae(t,e,r,n,c){switch(e){case"focusin":return Xm=g1(Xm,t,e,r,n,c),!0;case"dragenter":return Ym=g1(Ym,t,e,r,n,c),!0;case"mouseover":return Jm=g1(Jm,t,e,r,n,c),!0;case"pointerover":var d=c.pointerId;return _S.set(d,g1(_S.get(d)||null,t,e,r,n,c)),!0;case"gotpointercapture":return d=c.pointerId,yS.set(d,g1(yS.get(d)||null,t,e,r,n,c)),!0}return!1}function eq(t){var e=D_(t.target);if(e!==null){var r=Cy(e);if(r!==null){if(e=r.tag,e===13){if(e=U9(r),e!==null){t.blockedOn=e,Q9(t.priority,function(){Y9(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Oj(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=IM(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);bM=n,r.target.dispatchEvent(n),bM=null}else return e=gE(r),e!==null&&BO(e),t.blockedOn=r,!1;e.shift()}return!0}function jV(t,e,r){Oj(t)&&r.delete(e)}function lae(){NM=!1,Xm!==null&&Oj(Xm)&&(Xm=null),Ym!==null&&Oj(Ym)&&(Ym=null),Jm!==null&&Oj(Jm)&&(Jm=null),_S.forEach(jV),yS.forEach(jV)}function _1(t,e){t.blockedOn===e&&(t.blockedOn=null,NM||(NM=!0,Du.unstable_scheduleCallback(Du.unstable_NormalPriority,lae)))}function xS(t){function e(c){return _1(c,t)}if(0<X2.length){_1(X2[0],t);for(var r=1;r<X2.length;r++){var n=X2[r];n.blockedOn===t&&(n.blockedOn=null)}}for(Xm!==null&&_1(Xm,t),Ym!==null&&_1(Ym,t),Jm!==null&&_1(Jm,t),_S.forEach(e),yS.forEach(e),r=0;r<Dm.length;r++)n=Dm[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<Dm.length&&(r=Dm[0],r.blockedOn===null);)eq(r),r.blockedOn===null&&Dm.shift()}var Xv=Ip.ReactCurrentBatchConfig,mN=!0;function cae(t,e,r,n){var c=na,d=Xv.transition;Xv.transition=null;try{na=1,VO(t,e,r,n)}finally{na=c,Xv.transition=d}}function uae(t,e,r,n){var c=na,d=Xv.transition;Xv.transition=null;try{na=4,VO(t,e,r,n)}finally{na=c,Xv.transition=d}}function VO(t,e,r,n){if(mN){var c=IM(t,e,r,n);if(c===null)Hk(t,e,n,gN,r),TV(t,n);else if(oae(c,t,e,r,n))n.stopPropagation();else if(TV(t,n),e&4&&-1<aae.indexOf(t)){for(;c!==null;){var d=gE(c);if(d!==null&&X9(d),d=IM(t,e,r,n),d===null&&Hk(t,e,n,gN,r),d===c)break;c=d}c!==null&&n.stopPropagation()}else Hk(t,e,n,null,r)}}var gN=null;function IM(t,e,r,n){if(gN=null,t=LO(n),t=D_(t),t!==null)if(e=Cy(t),e===null)t=null;else if(r=e.tag,r===13){if(t=U9(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return gN=t,null}function tq(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Yie()){case FO:return 1;case H9:return 4;case fN:case Jie:return 16;case W9:return 536870912;default:return 16}default:return 16}}var Gm=null,UO=null,Lj=null;function rq(){if(Lj)return Lj;var t,e=UO,r=e.length,n,c="value"in Gm?Gm.value:Gm.textContent,d=c.length;for(t=0;t<r&&e[t]===c[t];t++);var p=r-t;for(n=1;n<=p&&e[r-n]===c[d-n];n++);return Lj=c.slice(t,1<n?1-n:void 0)}function Fj(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Y2(){return!0}function NV(){return!1}function Fu(t){function e(r,n,c,d,p){this._reactName=r,this._targetInst=c,this.type=n,this.nativeEvent=d,this.target=p,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(d):d[a]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?Y2:NV,this.isPropagationStopped=NV,this}return ro(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Y2)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Y2)},persist:function(){},isPersistent:Y2}),e}var K0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$O=Fu(K0),mE=ro({},K0,{view:0,detail:0}),dae=Fu(mE),Lk,Fk,y1,GI=ro({},mE,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qO,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==y1&&(y1&&t.type==="mousemove"?(Lk=t.screenX-y1.screenX,Fk=t.screenY-y1.screenY):Fk=Lk=0,y1=t),Lk)},movementY:function(t){return"movementY"in t?t.movementY:Fk}}),IV=Fu(GI),hae=ro({},GI,{dataTransfer:0}),fae=Fu(hae),pae=ro({},mE,{relatedTarget:0}),zk=Fu(pae),mae=ro({},K0,{animationName:0,elapsedTime:0,pseudoElement:0}),gae=Fu(mae),_ae=ro({},K0,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),yae=Fu(_ae),xae=ro({},K0,{data:0}),CV=Fu(xae),vae={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wae={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bae={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sae(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=bae[t])?!!e[t]:!1}function qO(){return Sae}var Eae=ro({},mE,{key:function(t){if(t.key){var e=vae[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Fj(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?wae[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qO,charCode:function(t){return t.type==="keypress"?Fj(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Fj(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Tae=Fu(Eae),jae=ro({},GI,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),AV=Fu(jae),Nae=ro({},mE,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qO}),Iae=Fu(Nae),Cae=ro({},K0,{propertyName:0,elapsedTime:0,pseudoElement:0}),Aae=Fu(Cae),Pae=ro({},GI,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),kae=Fu(Pae),Rae=[9,13,27,32],GO=dp&&"CompositionEvent"in window,Z1=null;dp&&"documentMode"in document&&(Z1=document.documentMode);var Mae=dp&&"TextEvent"in window&&!Z1,nq=dp&&(!GO||Z1&&8<Z1&&11>=Z1),PV=" ",kV=!1;function sq(t,e){switch(t){case"keyup":return Rae.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iq(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var kv=!1;function Dae(t,e){switch(t){case"compositionend":return iq(e);case"keypress":return e.which!==32?null:(kV=!0,PV);case"textInput":return t=e.data,t===PV&&kV?null:t;default:return null}}function Oae(t,e){if(kv)return t==="compositionend"||!GO&&sq(t,e)?(t=rq(),Lj=UO=Gm=null,kv=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return nq&&e.locale!=="ko"?null:e.data;default:return null}}var Lae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function RV(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Lae[t.type]:e==="textarea"}function aq(t,e,r,n){L9(n),e=_N(e,"onChange"),0<e.length&&(r=new $O("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var K1=null,vS=null;function Fae(t){_q(t,0)}function HI(t){var e=Dv(t);if(A9(e))return t}function zae(t,e){if(t==="change")return e}var oq=!1;if(dp){var Bk;if(dp){var Vk="oninput"in document;if(!Vk){var MV=document.createElement("div");MV.setAttribute("oninput","return;"),Vk=typeof MV.oninput=="function"}Bk=Vk}else Bk=!1;oq=Bk&&(!document.documentMode||9<document.documentMode)}function DV(){K1&&(K1.detachEvent("onpropertychange",lq),vS=K1=null)}function lq(t){if(t.propertyName==="value"&&HI(vS)){var e=[];aq(e,vS,t,LO(t)),V9(Fae,e)}}function Bae(t,e,r){t==="focusin"?(DV(),K1=e,vS=r,K1.attachEvent("onpropertychange",lq)):t==="focusout"&&DV()}function Vae(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return HI(vS)}function Uae(t,e){if(t==="click")return HI(e)}function $ae(t,e){if(t==="input"||t==="change")return HI(e)}function qae(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var eh=typeof Object.is=="function"?Object.is:qae;function wS(t,e){if(eh(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var c=r[n];if(!uM.call(e,c)||!eh(t[c],e[c]))return!1}return!0}function OV(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function LV(t,e){var r=OV(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=OV(r)}}function cq(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?cq(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function uq(){for(var t=window,e=uN();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=uN(t.document)}return e}function HO(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Gae(t){var e=uq(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&cq(r.ownerDocument.documentElement,r)){if(n!==null&&HO(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var c=r.textContent.length,d=Math.min(n.start,c);n=n.end===void 0?d:Math.min(n.end,c),!t.extend&&d>n&&(c=n,n=d,d=c),c=LV(r,d);var p=LV(r,n);c&&p&&(t.rangeCount!==1||t.anchorNode!==c.node||t.anchorOffset!==c.offset||t.focusNode!==p.node||t.focusOffset!==p.offset)&&(e=e.createRange(),e.setStart(c.node,c.offset),t.removeAllRanges(),d>n?(t.addRange(e),t.extend(p.node,p.offset)):(e.setEnd(p.node,p.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Hae=dp&&"documentMode"in document&&11>=document.documentMode,Rv=null,CM=null,X1=null,AM=!1;function FV(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;AM||Rv==null||Rv!==uN(n)||(n=Rv,"selectionStart"in n&&HO(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),X1&&wS(X1,n)||(X1=n,n=_N(CM,"onSelect"),0<n.length&&(e=new $O("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=Rv)))}function J2(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var Mv={animationend:J2("Animation","AnimationEnd"),animationiteration:J2("Animation","AnimationIteration"),animationstart:J2("Animation","AnimationStart"),transitionend:J2("Transition","TransitionEnd")},Uk={},dq={};dp&&(dq=document.createElement("div").style,"AnimationEvent"in window||(delete Mv.animationend.animation,delete Mv.animationiteration.animation,delete Mv.animationstart.animation),"TransitionEvent"in window||delete Mv.transitionend.transition);function WI(t){if(Uk[t])return Uk[t];if(!Mv[t])return t;var e=Mv[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in dq)return Uk[t]=e[r];return t}var hq=WI("animationend"),fq=WI("animationiteration"),pq=WI("animationstart"),mq=WI("transitionend"),gq=new Map,zV="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Eg(t,e){gq.set(t,e),Iy(e,[t])}for(var $k=0;$k<zV.length;$k++){var qk=zV[$k],Wae=qk.toLowerCase(),Zae=qk[0].toUpperCase()+qk.slice(1);Eg(Wae,"on"+Zae)}Eg(hq,"onAnimationEnd");Eg(fq,"onAnimationIteration");Eg(pq,"onAnimationStart");Eg("dblclick","onDoubleClick");Eg("focusin","onFocus");Eg("focusout","onBlur");Eg(mq,"onTransitionEnd");p0("onMouseEnter",["mouseout","mouseover"]);p0("onMouseLeave",["mouseout","mouseover"]);p0("onPointerEnter",["pointerout","pointerover"]);p0("onPointerLeave",["pointerout","pointerover"]);Iy("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Iy("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Iy("onBeforeInput",["compositionend","keypress","textInput","paste"]);Iy("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Iy("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Iy("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var M1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Kae=new Set("cancel close invalid load scroll toggle".split(" ").concat(M1));function BV(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,Wie(n,e,void 0,t),t.currentTarget=null}function _q(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],c=n.event;n=n.listeners;e:{var d=void 0;if(e)for(var p=n.length-1;0<=p;p--){var a=n[p],w=a.instance,E=a.currentTarget;if(a=a.listener,w!==d&&c.isPropagationStopped())break e;BV(c,a,E),d=w}else for(p=0;p<n.length;p++){if(a=n[p],w=a.instance,E=a.currentTarget,a=a.listener,w!==d&&c.isPropagationStopped())break e;BV(c,a,E),d=w}}}if(hN)throw t=TM,hN=!1,TM=null,t}function Ia(t,e){var r=e[DM];r===void 0&&(r=e[DM]=new Set);var n=t+"__bubble";r.has(n)||(yq(e,t,2,!1),r.add(n))}function Gk(t,e,r){var n=0;e&&(n|=4),yq(r,t,n,e)}var Q2="_reactListening"+Math.random().toString(36).slice(2);function bS(t){if(!t[Q2]){t[Q2]=!0,T9.forEach(function(r){r!=="selectionchange"&&(Kae.has(r)||Gk(r,!1,t),Gk(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Q2]||(e[Q2]=!0,Gk("selectionchange",!1,e))}}function yq(t,e,r,n){switch(tq(e)){case 1:var c=cae;break;case 4:c=uae;break;default:c=VO}r=c.bind(null,e,r,t),c=void 0,!EM||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(c=!0),n?c!==void 0?t.addEventListener(e,r,{capture:!0,passive:c}):t.addEventListener(e,r,!0):c!==void 0?t.addEventListener(e,r,{passive:c}):t.addEventListener(e,r,!1)}function Hk(t,e,r,n,c){var d=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var p=n.tag;if(p===3||p===4){var a=n.stateNode.containerInfo;if(a===c||a.nodeType===8&&a.parentNode===c)break;if(p===4)for(p=n.return;p!==null;){var w=p.tag;if((w===3||w===4)&&(w=p.stateNode.containerInfo,w===c||w.nodeType===8&&w.parentNode===c))return;p=p.return}for(;a!==null;){if(p=D_(a),p===null)return;if(w=p.tag,w===5||w===6){n=d=p;continue e}a=a.parentNode}}n=n.return}V9(function(){var E=d,C=LO(r),P=[];e:{var R=gq.get(t);if(R!==void 0){var B=$O,V=t;switch(t){case"keypress":if(Fj(r)===0)break e;case"keydown":case"keyup":B=Tae;break;case"focusin":V="focus",B=zk;break;case"focusout":V="blur",B=zk;break;case"beforeblur":case"afterblur":B=zk;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":B=IV;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":B=fae;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":B=Iae;break;case hq:case fq:case pq:B=gae;break;case mq:B=Aae;break;case"scroll":B=dae;break;case"wheel":B=kae;break;case"copy":case"cut":case"paste":B=yae;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":B=AV}var W=(e&4)!==0,K=!W&&t==="scroll",Z=W?R!==null?R+"Capture":null:R;W=[];for(var $=E,X;$!==null;){X=$;var Q=X.stateNode;if(X.tag===5&&Q!==null&&(X=Q,Z!==null&&(Q=gS($,Z),Q!=null&&W.push(SS($,Q,X)))),K)break;$=$.return}0<W.length&&(R=new B(R,V,null,r,C),P.push({event:R,listeners:W}))}}if(!(e&7)){e:{if(R=t==="mouseover"||t==="pointerover",B=t==="mouseout"||t==="pointerout",R&&r!==bM&&(V=r.relatedTarget||r.fromElement)&&(D_(V)||V[hp]))break e;if((B||R)&&(R=C.window===C?C:(R=C.ownerDocument)?R.defaultView||R.parentWindow:window,B?(V=r.relatedTarget||r.toElement,B=E,V=V?D_(V):null,V!==null&&(K=Cy(V),V!==K||V.tag!==5&&V.tag!==6)&&(V=null)):(B=null,V=E),B!==V)){if(W=IV,Q="onMouseLeave",Z="onMouseEnter",$="mouse",(t==="pointerout"||t==="pointerover")&&(W=AV,Q="onPointerLeave",Z="onPointerEnter",$="pointer"),K=B==null?R:Dv(B),X=V==null?R:Dv(V),R=new W(Q,$+"leave",B,r,C),R.target=K,R.relatedTarget=X,Q=null,D_(C)===E&&(W=new W(Z,$+"enter",V,r,C),W.target=X,W.relatedTarget=K,Q=W),K=Q,B&&V)t:{for(W=B,Z=V,$=0,X=W;X;X=uv(X))$++;for(X=0,Q=Z;Q;Q=uv(Q))X++;for(;0<$-X;)W=uv(W),$--;for(;0<X-$;)Z=uv(Z),X--;for(;$--;){if(W===Z||Z!==null&&W===Z.alternate)break t;W=uv(W),Z=uv(Z)}W=null}else W=null;B!==null&&VV(P,R,B,W,!1),V!==null&&K!==null&&VV(P,K,V,W,!0)}}e:{if(R=E?Dv(E):window,B=R.nodeName&&R.nodeName.toLowerCase(),B==="select"||B==="input"&&R.type==="file")var re=zae;else if(RV(R))if(oq)re=$ae;else{re=Vae;var ve=Bae}else(B=R.nodeName)&&B.toLowerCase()==="input"&&(R.type==="checkbox"||R.type==="radio")&&(re=Uae);if(re&&(re=re(t,E))){aq(P,re,r,C);break e}ve&&ve(t,R,E),t==="focusout"&&(ve=R._wrapperState)&&ve.controlled&&R.type==="number"&&_M(R,"number",R.value)}switch(ve=E?Dv(E):window,t){case"focusin":(RV(ve)||ve.contentEditable==="true")&&(Rv=ve,CM=E,X1=null);break;case"focusout":X1=CM=Rv=null;break;case"mousedown":AM=!0;break;case"contextmenu":case"mouseup":case"dragend":AM=!1,FV(P,r,C);break;case"selectionchange":if(Hae)break;case"keydown":case"keyup":FV(P,r,C)}var pe;if(GO)e:{switch(t){case"compositionstart":var ue="onCompositionStart";break e;case"compositionend":ue="onCompositionEnd";break e;case"compositionupdate":ue="onCompositionUpdate";break e}ue=void 0}else kv?sq(t,r)&&(ue="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(ue="onCompositionStart");ue&&(nq&&r.locale!=="ko"&&(kv||ue!=="onCompositionStart"?ue==="onCompositionEnd"&&kv&&(pe=rq()):(Gm=C,UO="value"in Gm?Gm.value:Gm.textContent,kv=!0)),ve=_N(E,ue),0<ve.length&&(ue=new CV(ue,t,null,r,C),P.push({event:ue,listeners:ve}),pe?ue.data=pe:(pe=iq(r),pe!==null&&(ue.data=pe)))),(pe=Mae?Dae(t,r):Oae(t,r))&&(E=_N(E,"onBeforeInput"),0<E.length&&(C=new CV("onBeforeInput","beforeinput",null,r,C),P.push({event:C,listeners:E}),C.data=pe))}_q(P,e)})}function SS(t,e,r){return{instance:t,listener:e,currentTarget:r}}function _N(t,e){for(var r=e+"Capture",n=[];t!==null;){var c=t,d=c.stateNode;c.tag===5&&d!==null&&(c=d,d=gS(t,r),d!=null&&n.unshift(SS(t,d,c)),d=gS(t,e),d!=null&&n.push(SS(t,d,c))),t=t.return}return n}function uv(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function VV(t,e,r,n,c){for(var d=e._reactName,p=[];r!==null&&r!==n;){var a=r,w=a.alternate,E=a.stateNode;if(w!==null&&w===n)break;a.tag===5&&E!==null&&(a=E,c?(w=gS(r,d),w!=null&&p.unshift(SS(r,w,a))):c||(w=gS(r,d),w!=null&&p.push(SS(r,w,a)))),r=r.return}p.length!==0&&t.push({event:e,listeners:p})}var Xae=/\r\n?/g,Yae=/\u0000|\uFFFD/g;function UV(t){return(typeof t=="string"?t:""+t).replace(Xae,`
`).replace(Yae,"")}function ej(t,e,r){if(e=UV(e),UV(t)!==e&&r)throw Error(Rr(425))}function yN(){}var PM=null,kM=null;function RM(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var MM=typeof setTimeout=="function"?setTimeout:void 0,Jae=typeof clearTimeout=="function"?clearTimeout:void 0,$V=typeof Promise=="function"?Promise:void 0,Qae=typeof queueMicrotask=="function"?queueMicrotask:typeof $V<"u"?function(t){return $V.resolve(null).then(t).catch(eoe)}:MM;function eoe(t){setTimeout(function(){throw t})}function Wk(t,e){var r=e,n=0;do{var c=r.nextSibling;if(t.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(n===0){t.removeChild(c),xS(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=c}while(r);xS(e)}function Qm(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function qV(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var X0=Math.random().toString(36).slice(2),$h="__reactFiber$"+X0,ES="__reactProps$"+X0,hp="__reactContainer$"+X0,DM="__reactEvents$"+X0,toe="__reactListeners$"+X0,roe="__reactHandles$"+X0;function D_(t){var e=t[$h];if(e)return e;for(var r=t.parentNode;r;){if(e=r[hp]||r[$h]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=qV(t);t!==null;){if(r=t[$h])return r;t=qV(t)}return e}t=r,r=t.parentNode}return null}function gE(t){return t=t[$h]||t[hp],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Dv(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Rr(33))}function ZI(t){return t[ES]||null}var OM=[],Ov=-1;function Tg(t){return{current:t}}function Ca(t){0>Ov||(t.current=OM[Ov],OM[Ov]=null,Ov--)}function ya(t,e){Ov++,OM[Ov]=t.current,t.current=e}var lg={},Wl=Tg(lg),eu=Tg(!1),J_=lg;function m0(t,e){var r=t.type.contextTypes;if(!r)return lg;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var c={},d;for(d in r)c[d]=e[d];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=c),c}function tu(t){return t=t.childContextTypes,t!=null}function xN(){Ca(eu),Ca(Wl)}function GV(t,e,r){if(Wl.current!==lg)throw Error(Rr(168));ya(Wl,e),ya(eu,r)}function xq(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var c in n)if(!(c in e))throw Error(Rr(108,Bie(t)||"Unknown",c));return ro({},r,n)}function vN(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||lg,J_=Wl.current,ya(Wl,t),ya(eu,eu.current),!0}function HV(t,e,r){var n=t.stateNode;if(!n)throw Error(Rr(169));r?(t=xq(t,e,J_),n.__reactInternalMemoizedMergedChildContext=t,Ca(eu),Ca(Wl),ya(Wl,t)):Ca(eu),ya(eu,r)}var Yf=null,KI=!1,Zk=!1;function vq(t){Yf===null?Yf=[t]:Yf.push(t)}function noe(t){KI=!0,vq(t)}function jg(){if(!Zk&&Yf!==null){Zk=!0;var t=0,e=na;try{var r=Yf;for(na=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}Yf=null,KI=!1}catch(c){throw Yf!==null&&(Yf=Yf.slice(t+1)),G9(FO,jg),c}finally{na=e,Zk=!1}}return null}var Lv=[],Fv=0,wN=null,bN=0,Ju=[],Qu=0,Q_=null,ep=1,tp="";function I_(t,e){Lv[Fv++]=bN,Lv[Fv++]=wN,wN=t,bN=e}function wq(t,e,r){Ju[Qu++]=ep,Ju[Qu++]=tp,Ju[Qu++]=Q_,Q_=t;var n=ep;t=tp;var c=32-Zd(n)-1;n&=~(1<<c),r+=1;var d=32-Zd(e)+c;if(30<d){var p=c-c%5;d=(n&(1<<p)-1).toString(32),n>>=p,c-=p,ep=1<<32-Zd(e)+c|r<<c|n,tp=d+t}else ep=1<<d|r<<c|n,tp=t}function WO(t){t.return!==null&&(I_(t,1),wq(t,1,0))}function ZO(t){for(;t===wN;)wN=Lv[--Fv],Lv[Fv]=null,bN=Lv[--Fv],Lv[Fv]=null;for(;t===Q_;)Q_=Ju[--Qu],Ju[Qu]=null,tp=Ju[--Qu],Ju[Qu]=null,ep=Ju[--Qu],Ju[Qu]=null}var Au=null,Nu=null,La=!1,Ud=null;function bq(t,e){var r=ed(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function WV(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Au=t,Nu=Qm(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Au=t,Nu=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Q_!==null?{id:ep,overflow:tp}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=ed(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Au=t,Nu=null,!0):!1;default:return!1}}function LM(t){return(t.mode&1)!==0&&(t.flags&128)===0}function FM(t){if(La){var e=Nu;if(e){var r=e;if(!WV(t,e)){if(LM(t))throw Error(Rr(418));e=Qm(r.nextSibling);var n=Au;e&&WV(t,e)?bq(n,r):(t.flags=t.flags&-4097|2,La=!1,Au=t)}}else{if(LM(t))throw Error(Rr(418));t.flags=t.flags&-4097|2,La=!1,Au=t}}}function ZV(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Au=t}function tj(t){if(t!==Au)return!1;if(!La)return ZV(t),La=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!RM(t.type,t.memoizedProps)),e&&(e=Nu)){if(LM(t))throw Sq(),Error(Rr(418));for(;e;)bq(t,e),e=Qm(e.nextSibling)}if(ZV(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Rr(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Nu=Qm(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Nu=null}}else Nu=Au?Qm(t.stateNode.nextSibling):null;return!0}function Sq(){for(var t=Nu;t;)t=Qm(t.nextSibling)}function g0(){Nu=Au=null,La=!1}function KO(t){Ud===null?Ud=[t]:Ud.push(t)}var soe=Ip.ReactCurrentBatchConfig;function x1(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Rr(309));var n=r.stateNode}if(!n)throw Error(Rr(147,t));var c=n,d=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===d?e.ref:(e=function(p){var a=c.refs;p===null?delete a[d]:a[d]=p},e._stringRef=d,e)}if(typeof t!="string")throw Error(Rr(284));if(!r._owner)throw Error(Rr(290,t))}return t}function rj(t,e){throw t=Object.prototype.toString.call(e),Error(Rr(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function KV(t){var e=t._init;return e(t._payload)}function Eq(t){function e(Z,$){if(t){var X=Z.deletions;X===null?(Z.deletions=[$],Z.flags|=16):X.push($)}}function r(Z,$){if(!t)return null;for(;$!==null;)e(Z,$),$=$.sibling;return null}function n(Z,$){for(Z=new Map;$!==null;)$.key!==null?Z.set($.key,$):Z.set($.index,$),$=$.sibling;return Z}function c(Z,$){return Z=ng(Z,$),Z.index=0,Z.sibling=null,Z}function d(Z,$,X){return Z.index=X,t?(X=Z.alternate,X!==null?(X=X.index,X<$?(Z.flags|=2,$):X):(Z.flags|=2,$)):(Z.flags|=1048576,$)}function p(Z){return t&&Z.alternate===null&&(Z.flags|=2),Z}function a(Z,$,X,Q){return $===null||$.tag!==6?($=tR(X,Z.mode,Q),$.return=Z,$):($=c($,X),$.return=Z,$)}function w(Z,$,X,Q){var re=X.type;return re===Pv?C(Z,$,X.props.children,Q,X.key):$!==null&&($.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===km&&KV(re)===$.type)?(Q=c($,X.props),Q.ref=x1(Z,$,X),Q.return=Z,Q):(Q=Gj(X.type,X.key,X.props,null,Z.mode,Q),Q.ref=x1(Z,$,X),Q.return=Z,Q)}function E(Z,$,X,Q){return $===null||$.tag!==4||$.stateNode.containerInfo!==X.containerInfo||$.stateNode.implementation!==X.implementation?($=rR(X,Z.mode,Q),$.return=Z,$):($=c($,X.children||[]),$.return=Z,$)}function C(Z,$,X,Q,re){return $===null||$.tag!==7?($=$_(X,Z.mode,Q,re),$.return=Z,$):($=c($,X),$.return=Z,$)}function P(Z,$,X){if(typeof $=="string"&&$!==""||typeof $=="number")return $=tR(""+$,Z.mode,X),$.return=Z,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case G2:return X=Gj($.type,$.key,$.props,null,Z.mode,X),X.ref=x1(Z,null,$),X.return=Z,X;case Av:return $=rR($,Z.mode,X),$.return=Z,$;case km:var Q=$._init;return P(Z,Q($._payload),X)}if(k1($)||p1($))return $=$_($,Z.mode,X,null),$.return=Z,$;rj(Z,$)}return null}function R(Z,$,X,Q){var re=$!==null?$.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return re!==null?null:a(Z,$,""+X,Q);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case G2:return X.key===re?w(Z,$,X,Q):null;case Av:return X.key===re?E(Z,$,X,Q):null;case km:return re=X._init,R(Z,$,re(X._payload),Q)}if(k1(X)||p1(X))return re!==null?null:C(Z,$,X,Q,null);rj(Z,X)}return null}function B(Z,$,X,Q,re){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Z=Z.get(X)||null,a($,Z,""+Q,re);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case G2:return Z=Z.get(Q.key===null?X:Q.key)||null,w($,Z,Q,re);case Av:return Z=Z.get(Q.key===null?X:Q.key)||null,E($,Z,Q,re);case km:var ve=Q._init;return B(Z,$,X,ve(Q._payload),re)}if(k1(Q)||p1(Q))return Z=Z.get(X)||null,C($,Z,Q,re,null);rj($,Q)}return null}function V(Z,$,X,Q){for(var re=null,ve=null,pe=$,ue=$=0,ge=null;pe!==null&&ue<X.length;ue++){pe.index>ue?(ge=pe,pe=null):ge=pe.sibling;var ce=R(Z,pe,X[ue],Q);if(ce===null){pe===null&&(pe=ge);break}t&&pe&&ce.alternate===null&&e(Z,pe),$=d(ce,$,ue),ve===null?re=ce:ve.sibling=ce,ve=ce,pe=ge}if(ue===X.length)return r(Z,pe),La&&I_(Z,ue),re;if(pe===null){for(;ue<X.length;ue++)pe=P(Z,X[ue],Q),pe!==null&&($=d(pe,$,ue),ve===null?re=pe:ve.sibling=pe,ve=pe);return La&&I_(Z,ue),re}for(pe=n(Z,pe);ue<X.length;ue++)ge=B(pe,Z,ue,X[ue],Q),ge!==null&&(t&&ge.alternate!==null&&pe.delete(ge.key===null?ue:ge.key),$=d(ge,$,ue),ve===null?re=ge:ve.sibling=ge,ve=ge);return t&&pe.forEach(function(Se){return e(Z,Se)}),La&&I_(Z,ue),re}function W(Z,$,X,Q){var re=p1(X);if(typeof re!="function")throw Error(Rr(150));if(X=re.call(X),X==null)throw Error(Rr(151));for(var ve=re=null,pe=$,ue=$=0,ge=null,ce=X.next();pe!==null&&!ce.done;ue++,ce=X.next()){pe.index>ue?(ge=pe,pe=null):ge=pe.sibling;var Se=R(Z,pe,ce.value,Q);if(Se===null){pe===null&&(pe=ge);break}t&&pe&&Se.alternate===null&&e(Z,pe),$=d(Se,$,ue),ve===null?re=Se:ve.sibling=Se,ve=Se,pe=ge}if(ce.done)return r(Z,pe),La&&I_(Z,ue),re;if(pe===null){for(;!ce.done;ue++,ce=X.next())ce=P(Z,ce.value,Q),ce!==null&&($=d(ce,$,ue),ve===null?re=ce:ve.sibling=ce,ve=ce);return La&&I_(Z,ue),re}for(pe=n(Z,pe);!ce.done;ue++,ce=X.next())ce=B(pe,Z,ue,ce.value,Q),ce!==null&&(t&&ce.alternate!==null&&pe.delete(ce.key===null?ue:ce.key),$=d(ce,$,ue),ve===null?re=ce:ve.sibling=ce,ve=ce);return t&&pe.forEach(function(le){return e(Z,le)}),La&&I_(Z,ue),re}function K(Z,$,X,Q){if(typeof X=="object"&&X!==null&&X.type===Pv&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case G2:e:{for(var re=X.key,ve=$;ve!==null;){if(ve.key===re){if(re=X.type,re===Pv){if(ve.tag===7){r(Z,ve.sibling),$=c(ve,X.props.children),$.return=Z,Z=$;break e}}else if(ve.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===km&&KV(re)===ve.type){r(Z,ve.sibling),$=c(ve,X.props),$.ref=x1(Z,ve,X),$.return=Z,Z=$;break e}r(Z,ve);break}else e(Z,ve);ve=ve.sibling}X.type===Pv?($=$_(X.props.children,Z.mode,Q,X.key),$.return=Z,Z=$):(Q=Gj(X.type,X.key,X.props,null,Z.mode,Q),Q.ref=x1(Z,$,X),Q.return=Z,Z=Q)}return p(Z);case Av:e:{for(ve=X.key;$!==null;){if($.key===ve)if($.tag===4&&$.stateNode.containerInfo===X.containerInfo&&$.stateNode.implementation===X.implementation){r(Z,$.sibling),$=c($,X.children||[]),$.return=Z,Z=$;break e}else{r(Z,$);break}else e(Z,$);$=$.sibling}$=rR(X,Z.mode,Q),$.return=Z,Z=$}return p(Z);case km:return ve=X._init,K(Z,$,ve(X._payload),Q)}if(k1(X))return V(Z,$,X,Q);if(p1(X))return W(Z,$,X,Q);rj(Z,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,$!==null&&$.tag===6?(r(Z,$.sibling),$=c($,X),$.return=Z,Z=$):(r(Z,$),$=tR(X,Z.mode,Q),$.return=Z,Z=$),p(Z)):r(Z,$)}return K}var _0=Eq(!0),Tq=Eq(!1),SN=Tg(null),EN=null,zv=null,XO=null;function YO(){XO=zv=EN=null}function JO(t){var e=SN.current;Ca(SN),t._currentValue=e}function zM(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Yv(t,e){EN=t,XO=zv=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Yc=!0),t.firstContext=null)}function ad(t){var e=t._currentValue;if(XO!==t)if(t={context:t,memoizedValue:e,next:null},zv===null){if(EN===null)throw Error(Rr(308));zv=t,EN.dependencies={lanes:0,firstContext:t}}else zv=zv.next=t;return e}var O_=null;function QO(t){O_===null?O_=[t]:O_.push(t)}function jq(t,e,r,n){var c=e.interleaved;return c===null?(r.next=r,QO(e)):(r.next=c.next,c.next=r),e.interleaved=r,fp(t,n)}function fp(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Rm=!1;function eL(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Nq(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ap(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function eg(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,Ri&2){var c=n.pending;return c===null?e.next=e:(e.next=c.next,c.next=e),n.pending=e,fp(t,r)}return c=n.interleaved,c===null?(e.next=e,QO(n)):(e.next=c.next,c.next=e),n.interleaved=e,fp(t,r)}function zj(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,zO(t,r)}}function XV(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var c=null,d=null;if(r=r.firstBaseUpdate,r!==null){do{var p={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};d===null?c=d=p:d=d.next=p,r=r.next}while(r!==null);d===null?c=d=e:d=d.next=e}else c=d=e;r={baseState:n.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function TN(t,e,r,n){var c=t.updateQueue;Rm=!1;var d=c.firstBaseUpdate,p=c.lastBaseUpdate,a=c.shared.pending;if(a!==null){c.shared.pending=null;var w=a,E=w.next;w.next=null,p===null?d=E:p.next=E,p=w;var C=t.alternate;C!==null&&(C=C.updateQueue,a=C.lastBaseUpdate,a!==p&&(a===null?C.firstBaseUpdate=E:a.next=E,C.lastBaseUpdate=w))}if(d!==null){var P=c.baseState;p=0,C=E=w=null,a=d;do{var R=a.lane,B=a.eventTime;if((n&R)===R){C!==null&&(C=C.next={eventTime:B,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var V=t,W=a;switch(R=e,B=r,W.tag){case 1:if(V=W.payload,typeof V=="function"){P=V.call(B,P,R);break e}P=V;break e;case 3:V.flags=V.flags&-65537|128;case 0:if(V=W.payload,R=typeof V=="function"?V.call(B,P,R):V,R==null)break e;P=ro({},P,R);break e;case 2:Rm=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,R=c.effects,R===null?c.effects=[a]:R.push(a))}else B={eventTime:B,lane:R,tag:a.tag,payload:a.payload,callback:a.callback,next:null},C===null?(E=C=B,w=P):C=C.next=B,p|=R;if(a=a.next,a===null){if(a=c.shared.pending,a===null)break;R=a,a=R.next,R.next=null,c.lastBaseUpdate=R,c.shared.pending=null}}while(!0);if(C===null&&(w=P),c.baseState=w,c.firstBaseUpdate=E,c.lastBaseUpdate=C,e=c.shared.interleaved,e!==null){c=e;do p|=c.lane,c=c.next;while(c!==e)}else d===null&&(c.shared.lanes=0);ty|=p,t.lanes=p,t.memoizedState=P}}function YV(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],c=n.callback;if(c!==null){if(n.callback=null,n=r,typeof c!="function")throw Error(Rr(191,c));c.call(n)}}}var _E={},Jh=Tg(_E),TS=Tg(_E),jS=Tg(_E);function L_(t){if(t===_E)throw Error(Rr(174));return t}function tL(t,e){switch(ya(jS,e),ya(TS,t),ya(Jh,_E),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:xM(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=xM(e,t)}Ca(Jh),ya(Jh,e)}function y0(){Ca(Jh),Ca(TS),Ca(jS)}function Iq(t){L_(jS.current);var e=L_(Jh.current),r=xM(e,t.type);e!==r&&(ya(TS,t),ya(Jh,r))}function rL(t){TS.current===t&&(Ca(Jh),Ca(TS))}var Wa=Tg(0);function jN(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Kk=[];function nL(){for(var t=0;t<Kk.length;t++)Kk[t]._workInProgressVersionPrimary=null;Kk.length=0}var Bj=Ip.ReactCurrentDispatcher,Xk=Ip.ReactCurrentBatchConfig,ey=0,Ja=null,Ko=null,ol=null,NN=!1,Y1=!1,NS=0,ioe=0;function Fl(){throw Error(Rr(321))}function sL(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!eh(t[r],e[r]))return!1;return!0}function iL(t,e,r,n,c,d){if(ey=d,Ja=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bj.current=t===null||t.memoizedState===null?coe:uoe,t=r(n,c),Y1){d=0;do{if(Y1=!1,NS=0,25<=d)throw Error(Rr(301));d+=1,ol=Ko=null,e.updateQueue=null,Bj.current=doe,t=r(n,c)}while(Y1)}if(Bj.current=IN,e=Ko!==null&&Ko.next!==null,ey=0,ol=Ko=Ja=null,NN=!1,e)throw Error(Rr(300));return t}function aL(){var t=NS!==0;return NS=0,t}function Vh(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ol===null?Ja.memoizedState=ol=t:ol=ol.next=t,ol}function od(){if(Ko===null){var t=Ja.alternate;t=t!==null?t.memoizedState:null}else t=Ko.next;var e=ol===null?Ja.memoizedState:ol.next;if(e!==null)ol=e,Ko=t;else{if(t===null)throw Error(Rr(310));Ko=t,t={memoizedState:Ko.memoizedState,baseState:Ko.baseState,baseQueue:Ko.baseQueue,queue:Ko.queue,next:null},ol===null?Ja.memoizedState=ol=t:ol=ol.next=t}return ol}function IS(t,e){return typeof e=="function"?e(t):e}function Yk(t){var e=od(),r=e.queue;if(r===null)throw Error(Rr(311));r.lastRenderedReducer=t;var n=Ko,c=n.baseQueue,d=r.pending;if(d!==null){if(c!==null){var p=c.next;c.next=d.next,d.next=p}n.baseQueue=c=d,r.pending=null}if(c!==null){d=c.next,n=n.baseState;var a=p=null,w=null,E=d;do{var C=E.lane;if((ey&C)===C)w!==null&&(w=w.next={lane:0,action:E.action,hasEagerState:E.hasEagerState,eagerState:E.eagerState,next:null}),n=E.hasEagerState?E.eagerState:t(n,E.action);else{var P={lane:C,action:E.action,hasEagerState:E.hasEagerState,eagerState:E.eagerState,next:null};w===null?(a=w=P,p=n):w=w.next=P,Ja.lanes|=C,ty|=C}E=E.next}while(E!==null&&E!==d);w===null?p=n:w.next=a,eh(n,e.memoizedState)||(Yc=!0),e.memoizedState=n,e.baseState=p,e.baseQueue=w,r.lastRenderedState=n}if(t=r.interleaved,t!==null){c=t;do d=c.lane,Ja.lanes|=d,ty|=d,c=c.next;while(c!==t)}else c===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function Jk(t){var e=od(),r=e.queue;if(r===null)throw Error(Rr(311));r.lastRenderedReducer=t;var n=r.dispatch,c=r.pending,d=e.memoizedState;if(c!==null){r.pending=null;var p=c=c.next;do d=t(d,p.action),p=p.next;while(p!==c);eh(d,e.memoizedState)||(Yc=!0),e.memoizedState=d,e.baseQueue===null&&(e.baseState=d),r.lastRenderedState=d}return[d,n]}function Cq(){}function Aq(t,e){var r=Ja,n=od(),c=e(),d=!eh(n.memoizedState,c);if(d&&(n.memoizedState=c,Yc=!0),n=n.queue,oL(Rq.bind(null,r,n,t),[t]),n.getSnapshot!==e||d||ol!==null&&ol.memoizedState.tag&1){if(r.flags|=2048,CS(9,kq.bind(null,r,n,c,e),void 0,null),ul===null)throw Error(Rr(349));ey&30||Pq(r,e,c)}return c}function Pq(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Ja.updateQueue,e===null?(e={lastEffect:null,stores:null},Ja.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function kq(t,e,r,n){e.value=r,e.getSnapshot=n,Mq(e)&&Dq(t)}function Rq(t,e,r){return r(function(){Mq(e)&&Dq(t)})}function Mq(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!eh(t,r)}catch{return!0}}function Dq(t){var e=fp(t,1);e!==null&&Kd(e,t,1,-1)}function JV(t){var e=Vh();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:IS,lastRenderedState:t},e.queue=t,t=t.dispatch=loe.bind(null,Ja,t),[e.memoizedState,t]}function CS(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=Ja.updateQueue,e===null?(e={lastEffect:null,stores:null},Ja.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function Oq(){return od().memoizedState}function Vj(t,e,r,n){var c=Vh();Ja.flags|=t,c.memoizedState=CS(1|e,r,void 0,n===void 0?null:n)}function XI(t,e,r,n){var c=od();n=n===void 0?null:n;var d=void 0;if(Ko!==null){var p=Ko.memoizedState;if(d=p.destroy,n!==null&&sL(n,p.deps)){c.memoizedState=CS(e,r,d,n);return}}Ja.flags|=t,c.memoizedState=CS(1|e,r,d,n)}function QV(t,e){return Vj(8390656,8,t,e)}function oL(t,e){return XI(2048,8,t,e)}function Lq(t,e){return XI(4,2,t,e)}function Fq(t,e){return XI(4,4,t,e)}function zq(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Bq(t,e,r){return r=r!=null?r.concat([t]):null,XI(4,4,zq.bind(null,e,t),r)}function lL(){}function Vq(t,e){var r=od();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&sL(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function Uq(t,e){var r=od();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&sL(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function $q(t,e,r){return ey&21?(eh(r,e)||(r=Z9(),Ja.lanes|=r,ty|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Yc=!0),t.memoizedState=r)}function aoe(t,e){var r=na;na=r!==0&&4>r?r:4,t(!0);var n=Xk.transition;Xk.transition={};try{t(!1),e()}finally{na=r,Xk.transition=n}}function qq(){return od().memoizedState}function ooe(t,e,r){var n=rg(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},Gq(t))Hq(e,r);else if(r=jq(t,e,r,n),r!==null){var c=jc();Kd(r,t,n,c),Wq(r,e,n)}}function loe(t,e,r){var n=rg(t),c={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(Gq(t))Hq(e,c);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=e.lastRenderedReducer,d!==null))try{var p=e.lastRenderedState,a=d(p,r);if(c.hasEagerState=!0,c.eagerState=a,eh(a,p)){var w=e.interleaved;w===null?(c.next=c,QO(e)):(c.next=w.next,w.next=c),e.interleaved=c;return}}catch{}finally{}r=jq(t,e,c,n),r!==null&&(c=jc(),Kd(r,t,n,c),Wq(r,e,n))}}function Gq(t){var e=t.alternate;return t===Ja||e!==null&&e===Ja}function Hq(t,e){Y1=NN=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function Wq(t,e,r){if(r&4194240){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,zO(t,r)}}var IN={readContext:ad,useCallback:Fl,useContext:Fl,useEffect:Fl,useImperativeHandle:Fl,useInsertionEffect:Fl,useLayoutEffect:Fl,useMemo:Fl,useReducer:Fl,useRef:Fl,useState:Fl,useDebugValue:Fl,useDeferredValue:Fl,useTransition:Fl,useMutableSource:Fl,useSyncExternalStore:Fl,useId:Fl,unstable_isNewReconciler:!1},coe={readContext:ad,useCallback:function(t,e){return Vh().memoizedState=[t,e===void 0?null:e],t},useContext:ad,useEffect:QV,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Vj(4194308,4,zq.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Vj(4194308,4,t,e)},useInsertionEffect:function(t,e){return Vj(4,2,t,e)},useMemo:function(t,e){var r=Vh();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=Vh();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=ooe.bind(null,Ja,t),[n.memoizedState,t]},useRef:function(t){var e=Vh();return t={current:t},e.memoizedState=t},useState:JV,useDebugValue:lL,useDeferredValue:function(t){return Vh().memoizedState=t},useTransition:function(){var t=JV(!1),e=t[0];return t=aoe.bind(null,t[1]),Vh().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=Ja,c=Vh();if(La){if(r===void 0)throw Error(Rr(407));r=r()}else{if(r=e(),ul===null)throw Error(Rr(349));ey&30||Pq(n,e,r)}c.memoizedState=r;var d={value:r,getSnapshot:e};return c.queue=d,QV(Rq.bind(null,n,d,t),[t]),n.flags|=2048,CS(9,kq.bind(null,n,d,r,e),void 0,null),r},useId:function(){var t=Vh(),e=ul.identifierPrefix;if(La){var r=tp,n=ep;r=(n&~(1<<32-Zd(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=NS++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=ioe++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},uoe={readContext:ad,useCallback:Vq,useContext:ad,useEffect:oL,useImperativeHandle:Bq,useInsertionEffect:Lq,useLayoutEffect:Fq,useMemo:Uq,useReducer:Yk,useRef:Oq,useState:function(){return Yk(IS)},useDebugValue:lL,useDeferredValue:function(t){var e=od();return $q(e,Ko.memoizedState,t)},useTransition:function(){var t=Yk(IS)[0],e=od().memoizedState;return[t,e]},useMutableSource:Cq,useSyncExternalStore:Aq,useId:qq,unstable_isNewReconciler:!1},doe={readContext:ad,useCallback:Vq,useContext:ad,useEffect:oL,useImperativeHandle:Bq,useInsertionEffect:Lq,useLayoutEffect:Fq,useMemo:Uq,useReducer:Jk,useRef:Oq,useState:function(){return Jk(IS)},useDebugValue:lL,useDeferredValue:function(t){var e=od();return Ko===null?e.memoizedState=t:$q(e,Ko.memoizedState,t)},useTransition:function(){var t=Jk(IS)[0],e=od().memoizedState;return[t,e]},useMutableSource:Cq,useSyncExternalStore:Aq,useId:qq,unstable_isNewReconciler:!1};function Fd(t,e){if(t&&t.defaultProps){e=ro({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function BM(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:ro({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var YI={isMounted:function(t){return(t=t._reactInternals)?Cy(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=jc(),c=rg(t),d=ap(n,c);d.payload=e,r!=null&&(d.callback=r),e=eg(t,d,c),e!==null&&(Kd(e,t,c,n),zj(e,t,c))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=jc(),c=rg(t),d=ap(n,c);d.tag=1,d.payload=e,r!=null&&(d.callback=r),e=eg(t,d,c),e!==null&&(Kd(e,t,c,n),zj(e,t,c))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=jc(),n=rg(t),c=ap(r,n);c.tag=2,e!=null&&(c.callback=e),e=eg(t,c,n),e!==null&&(Kd(e,t,n,r),zj(e,t,n))}};function e6(t,e,r,n,c,d,p){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,d,p):e.prototype&&e.prototype.isPureReactComponent?!wS(r,n)||!wS(c,d):!0}function Zq(t,e,r){var n=!1,c=lg,d=e.contextType;return typeof d=="object"&&d!==null?d=ad(d):(c=tu(e)?J_:Wl.current,n=e.contextTypes,d=(n=n!=null)?m0(t,c):lg),e=new e(r,d),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=YI,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=c,t.__reactInternalMemoizedMaskedChildContext=d),e}function t6(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&YI.enqueueReplaceState(e,e.state,null)}function VM(t,e,r,n){var c=t.stateNode;c.props=r,c.state=t.memoizedState,c.refs={},eL(t);var d=e.contextType;typeof d=="object"&&d!==null?c.context=ad(d):(d=tu(e)?J_:Wl.current,c.context=m0(t,d)),c.state=t.memoizedState,d=e.getDerivedStateFromProps,typeof d=="function"&&(BM(t,e,d,r),c.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(e=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),e!==c.state&&YI.enqueueReplaceState(c,c.state,null),TN(t,r,c,n),c.state=t.memoizedState),typeof c.componentDidMount=="function"&&(t.flags|=4194308)}function x0(t,e){try{var r="",n=e;do r+=zie(n),n=n.return;while(n);var c=r}catch(d){c=`
Error generating stack: `+d.message+`
`+d.stack}return{value:t,source:e,stack:c,digest:null}}function Qk(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function UM(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var hoe=typeof WeakMap=="function"?WeakMap:Map;function Kq(t,e,r){r=ap(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){AN||(AN=!0,JM=n),UM(t,e)},r}function Xq(t,e,r){r=ap(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var c=e.value;r.payload=function(){return n(c)},r.callback=function(){UM(t,e)}}var d=t.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(r.callback=function(){UM(t,e),typeof n!="function"&&(tg===null?tg=new Set([this]):tg.add(this));var p=e.stack;this.componentDidCatch(e.value,{componentStack:p!==null?p:""})}),r}function r6(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new hoe;var c=new Set;n.set(e,c)}else c=n.get(e),c===void 0&&(c=new Set,n.set(e,c));c.has(r)||(c.add(r),t=joe.bind(null,t,e,r),e.then(t,t))}function n6(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function s6(t,e,r,n,c){return t.mode&1?(t.flags|=65536,t.lanes=c,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=ap(-1,1),e.tag=2,eg(r,e,1))),r.lanes|=1),t)}var foe=Ip.ReactCurrentOwner,Yc=!1;function vc(t,e,r,n){e.child=t===null?Tq(e,null,r,n):_0(e,t.child,r,n)}function i6(t,e,r,n,c){r=r.render;var d=e.ref;return Yv(e,c),n=iL(t,e,r,n,d,c),r=aL(),t!==null&&!Yc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,pp(t,e,c)):(La&&r&&WO(e),e.flags|=1,vc(t,e,n,c),e.child)}function a6(t,e,r,n,c){if(t===null){var d=r.type;return typeof d=="function"&&!gL(d)&&d.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=d,Yq(t,e,d,n,c)):(t=Gj(r.type,null,n,e,e.mode,c),t.ref=e.ref,t.return=e,e.child=t)}if(d=t.child,!(t.lanes&c)){var p=d.memoizedProps;if(r=r.compare,r=r!==null?r:wS,r(p,n)&&t.ref===e.ref)return pp(t,e,c)}return e.flags|=1,t=ng(d,n),t.ref=e.ref,t.return=e,e.child=t}function Yq(t,e,r,n,c){if(t!==null){var d=t.memoizedProps;if(wS(d,n)&&t.ref===e.ref)if(Yc=!1,e.pendingProps=n=d,(t.lanes&c)!==0)t.flags&131072&&(Yc=!0);else return e.lanes=t.lanes,pp(t,e,c)}return $M(t,e,r,n,c)}function Jq(t,e,r){var n=e.pendingProps,c=n.children,d=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ya(Vv,Tu),Tu|=r;else{if(!(r&1073741824))return t=d!==null?d.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ya(Vv,Tu),Tu|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=d!==null?d.baseLanes:r,ya(Vv,Tu),Tu|=n}else d!==null?(n=d.baseLanes|r,e.memoizedState=null):n=r,ya(Vv,Tu),Tu|=n;return vc(t,e,c,r),e.child}function Qq(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function $M(t,e,r,n,c){var d=tu(r)?J_:Wl.current;return d=m0(e,d),Yv(e,c),r=iL(t,e,r,n,d,c),n=aL(),t!==null&&!Yc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,pp(t,e,c)):(La&&n&&WO(e),e.flags|=1,vc(t,e,r,c),e.child)}function o6(t,e,r,n,c){if(tu(r)){var d=!0;vN(e)}else d=!1;if(Yv(e,c),e.stateNode===null)Uj(t,e),Zq(e,r,n),VM(e,r,n,c),n=!0;else if(t===null){var p=e.stateNode,a=e.memoizedProps;p.props=a;var w=p.context,E=r.contextType;typeof E=="object"&&E!==null?E=ad(E):(E=tu(r)?J_:Wl.current,E=m0(e,E));var C=r.getDerivedStateFromProps,P=typeof C=="function"||typeof p.getSnapshotBeforeUpdate=="function";P||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(a!==n||w!==E)&&t6(e,p,n,E),Rm=!1;var R=e.memoizedState;p.state=R,TN(e,n,p,c),w=e.memoizedState,a!==n||R!==w||eu.current||Rm?(typeof C=="function"&&(BM(e,r,C,n),w=e.memoizedState),(a=Rm||e6(e,r,a,n,R,w,E))?(P||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(e.flags|=4194308)):(typeof p.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=w),p.props=n,p.state=w,p.context=E,n=a):(typeof p.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{p=e.stateNode,Nq(t,e),a=e.memoizedProps,E=e.type===e.elementType?a:Fd(e.type,a),p.props=E,P=e.pendingProps,R=p.context,w=r.contextType,typeof w=="object"&&w!==null?w=ad(w):(w=tu(r)?J_:Wl.current,w=m0(e,w));var B=r.getDerivedStateFromProps;(C=typeof B=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(a!==P||R!==w)&&t6(e,p,n,w),Rm=!1,R=e.memoizedState,p.state=R,TN(e,n,p,c);var V=e.memoizedState;a!==P||R!==V||eu.current||Rm?(typeof B=="function"&&(BM(e,r,B,n),V=e.memoizedState),(E=Rm||e6(e,r,E,n,R,V,w)||!1)?(C||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(n,V,w),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(n,V,w)),typeof p.componentDidUpdate=="function"&&(e.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof p.componentDidUpdate!="function"||a===t.memoizedProps&&R===t.memoizedState||(e.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&R===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=V),p.props=n,p.state=V,p.context=w,n=E):(typeof p.componentDidUpdate!="function"||a===t.memoizedProps&&R===t.memoizedState||(e.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&R===t.memoizedState||(e.flags|=1024),n=!1)}return qM(t,e,r,n,d,c)}function qM(t,e,r,n,c,d){Qq(t,e);var p=(e.flags&128)!==0;if(!n&&!p)return c&&HV(e,r,!1),pp(t,e,d);n=e.stateNode,foe.current=e;var a=p&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&p?(e.child=_0(e,t.child,null,d),e.child=_0(e,null,a,d)):vc(t,e,a,d),e.memoizedState=n.state,c&&HV(e,r,!0),e.child}function e7(t){var e=t.stateNode;e.pendingContext?GV(t,e.pendingContext,e.pendingContext!==e.context):e.context&&GV(t,e.context,!1),tL(t,e.containerInfo)}function l6(t,e,r,n,c){return g0(),KO(c),e.flags|=256,vc(t,e,r,n),e.child}var GM={dehydrated:null,treeContext:null,retryLane:0};function HM(t){return{baseLanes:t,cachePool:null,transitions:null}}function t7(t,e,r){var n=e.pendingProps,c=Wa.current,d=!1,p=(e.flags&128)!==0,a;if((a=p)||(a=t!==null&&t.memoizedState===null?!1:(c&2)!==0),a?(d=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(c|=1),ya(Wa,c&1),t===null)return FM(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(p=n.children,t=n.fallback,d?(n=e.mode,d=e.child,p={mode:"hidden",children:p},!(n&1)&&d!==null?(d.childLanes=0,d.pendingProps=p):d=eC(p,n,0,null),t=$_(t,n,r,null),d.return=e,t.return=e,d.sibling=t,e.child=d,e.child.memoizedState=HM(r),e.memoizedState=GM,t):cL(e,p));if(c=t.memoizedState,c!==null&&(a=c.dehydrated,a!==null))return poe(t,e,p,n,a,c,r);if(d){d=n.fallback,p=e.mode,c=t.child,a=c.sibling;var w={mode:"hidden",children:n.children};return!(p&1)&&e.child!==c?(n=e.child,n.childLanes=0,n.pendingProps=w,e.deletions=null):(n=ng(c,w),n.subtreeFlags=c.subtreeFlags&14680064),a!==null?d=ng(a,d):(d=$_(d,p,r,null),d.flags|=2),d.return=e,n.return=e,n.sibling=d,e.child=n,n=d,d=e.child,p=t.child.memoizedState,p=p===null?HM(r):{baseLanes:p.baseLanes|r,cachePool:null,transitions:p.transitions},d.memoizedState=p,d.childLanes=t.childLanes&~r,e.memoizedState=GM,n}return d=t.child,t=d.sibling,n=ng(d,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function cL(t,e){return e=eC({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function nj(t,e,r,n){return n!==null&&KO(n),_0(e,t.child,null,r),t=cL(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function poe(t,e,r,n,c,d,p){if(r)return e.flags&256?(e.flags&=-257,n=Qk(Error(Rr(422))),nj(t,e,p,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(d=n.fallback,c=e.mode,n=eC({mode:"visible",children:n.children},c,0,null),d=$_(d,c,p,null),d.flags|=2,n.return=e,d.return=e,n.sibling=d,e.child=n,e.mode&1&&_0(e,t.child,null,p),e.child.memoizedState=HM(p),e.memoizedState=GM,d);if(!(e.mode&1))return nj(t,e,p,null);if(c.data==="$!"){if(n=c.nextSibling&&c.nextSibling.dataset,n)var a=n.dgst;return n=a,d=Error(Rr(419)),n=Qk(d,n,void 0),nj(t,e,p,n)}if(a=(p&t.childLanes)!==0,Yc||a){if(n=ul,n!==null){switch(p&-p){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(n.suspendedLanes|p)?0:c,c!==0&&c!==d.retryLane&&(d.retryLane=c,fp(t,c),Kd(n,t,c,-1))}return mL(),n=Qk(Error(Rr(421))),nj(t,e,p,n)}return c.data==="$?"?(e.flags|=128,e.child=t.child,e=Noe.bind(null,t),c._reactRetry=e,null):(t=d.treeContext,Nu=Qm(c.nextSibling),Au=e,La=!0,Ud=null,t!==null&&(Ju[Qu++]=ep,Ju[Qu++]=tp,Ju[Qu++]=Q_,ep=t.id,tp=t.overflow,Q_=e),e=cL(e,n.children),e.flags|=4096,e)}function c6(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),zM(t.return,e,r)}function eR(t,e,r,n,c){var d=t.memoizedState;d===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:c}:(d.isBackwards=e,d.rendering=null,d.renderingStartTime=0,d.last=n,d.tail=r,d.tailMode=c)}function r7(t,e,r){var n=e.pendingProps,c=n.revealOrder,d=n.tail;if(vc(t,e,n.children,r),n=Wa.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&c6(t,r,e);else if(t.tag===19)c6(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(ya(Wa,n),!(e.mode&1))e.memoizedState=null;else switch(c){case"forwards":for(r=e.child,c=null;r!==null;)t=r.alternate,t!==null&&jN(t)===null&&(c=r),r=r.sibling;r=c,r===null?(c=e.child,e.child=null):(c=r.sibling,r.sibling=null),eR(e,!1,c,r,d);break;case"backwards":for(r=null,c=e.child,e.child=null;c!==null;){if(t=c.alternate,t!==null&&jN(t)===null){e.child=c;break}t=c.sibling,c.sibling=r,r=c,c=t}eR(e,!0,r,null,d);break;case"together":eR(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Uj(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function pp(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),ty|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Rr(153));if(e.child!==null){for(t=e.child,r=ng(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=ng(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function moe(t,e,r){switch(e.tag){case 3:e7(e),g0();break;case 5:Iq(e);break;case 1:tu(e.type)&&vN(e);break;case 4:tL(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,c=e.memoizedProps.value;ya(SN,n._currentValue),n._currentValue=c;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(ya(Wa,Wa.current&1),e.flags|=128,null):r&e.child.childLanes?t7(t,e,r):(ya(Wa,Wa.current&1),t=pp(t,e,r),t!==null?t.sibling:null);ya(Wa,Wa.current&1);break;case 19:if(n=(r&e.childLanes)!==0,t.flags&128){if(n)return r7(t,e,r);e.flags|=128}if(c=e.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),ya(Wa,Wa.current),n)break;return null;case 22:case 23:return e.lanes=0,Jq(t,e,r)}return pp(t,e,r)}var n7,WM,s7,i7;n7=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};WM=function(){};s7=function(t,e,r,n){var c=t.memoizedProps;if(c!==n){t=e.stateNode,L_(Jh.current);var d=null;switch(r){case"input":c=mM(t,c),n=mM(t,n),d=[];break;case"select":c=ro({},c,{value:void 0}),n=ro({},n,{value:void 0}),d=[];break;case"textarea":c=yM(t,c),n=yM(t,n),d=[];break;default:typeof c.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=yN)}vM(r,n);var p;r=null;for(E in c)if(!n.hasOwnProperty(E)&&c.hasOwnProperty(E)&&c[E]!=null)if(E==="style"){var a=c[E];for(p in a)a.hasOwnProperty(p)&&(r||(r={}),r[p]="")}else E!=="dangerouslySetInnerHTML"&&E!=="children"&&E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(pS.hasOwnProperty(E)?d||(d=[]):(d=d||[]).push(E,null));for(E in n){var w=n[E];if(a=c!=null?c[E]:void 0,n.hasOwnProperty(E)&&w!==a&&(w!=null||a!=null))if(E==="style")if(a){for(p in a)!a.hasOwnProperty(p)||w&&w.hasOwnProperty(p)||(r||(r={}),r[p]="");for(p in w)w.hasOwnProperty(p)&&a[p]!==w[p]&&(r||(r={}),r[p]=w[p])}else r||(d||(d=[]),d.push(E,r)),r=w;else E==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,a=a?a.__html:void 0,w!=null&&a!==w&&(d=d||[]).push(E,w)):E==="children"?typeof w!="string"&&typeof w!="number"||(d=d||[]).push(E,""+w):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&(pS.hasOwnProperty(E)?(w!=null&&E==="onScroll"&&Ia("scroll",t),d||a===w||(d=[])):(d=d||[]).push(E,w))}r&&(d=d||[]).push("style",r);var E=d;(e.updateQueue=E)&&(e.flags|=4)}};i7=function(t,e,r,n){r!==n&&(e.flags|=4)};function v1(t,e){if(!La)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function zl(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var c=t.child;c!==null;)r|=c.lanes|c.childLanes,n|=c.subtreeFlags&14680064,n|=c.flags&14680064,c.return=t,c=c.sibling;else for(c=t.child;c!==null;)r|=c.lanes|c.childLanes,n|=c.subtreeFlags,n|=c.flags,c.return=t,c=c.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function goe(t,e,r){var n=e.pendingProps;switch(ZO(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zl(e),null;case 1:return tu(e.type)&&xN(),zl(e),null;case 3:return n=e.stateNode,y0(),Ca(eu),Ca(Wl),nL(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(tj(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ud!==null&&(tD(Ud),Ud=null))),WM(t,e),zl(e),null;case 5:rL(e);var c=L_(jS.current);if(r=e.type,t!==null&&e.stateNode!=null)s7(t,e,r,n,c),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Rr(166));return zl(e),null}if(t=L_(Jh.current),tj(e)){n=e.stateNode,r=e.type;var d=e.memoizedProps;switch(n[$h]=e,n[ES]=d,t=(e.mode&1)!==0,r){case"dialog":Ia("cancel",n),Ia("close",n);break;case"iframe":case"object":case"embed":Ia("load",n);break;case"video":case"audio":for(c=0;c<M1.length;c++)Ia(M1[c],n);break;case"source":Ia("error",n);break;case"img":case"image":case"link":Ia("error",n),Ia("load",n);break;case"details":Ia("toggle",n);break;case"input":yV(n,d),Ia("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!d.multiple},Ia("invalid",n);break;case"textarea":vV(n,d),Ia("invalid",n)}vM(r,d),c=null;for(var p in d)if(d.hasOwnProperty(p)){var a=d[p];p==="children"?typeof a=="string"?n.textContent!==a&&(d.suppressHydrationWarning!==!0&&ej(n.textContent,a,t),c=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(d.suppressHydrationWarning!==!0&&ej(n.textContent,a,t),c=["children",""+a]):pS.hasOwnProperty(p)&&a!=null&&p==="onScroll"&&Ia("scroll",n)}switch(r){case"input":H2(n),xV(n,d,!0);break;case"textarea":H2(n),wV(n);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(n.onclick=yN)}n=c,e.updateQueue=n,n!==null&&(e.flags|=4)}else{p=c.nodeType===9?c:c.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=R9(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=p.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=p.createElement(r,{is:n.is}):(t=p.createElement(r),r==="select"&&(p=t,n.multiple?p.multiple=!0:n.size&&(p.size=n.size))):t=p.createElementNS(t,r),t[$h]=e,t[ES]=n,n7(t,e,!1,!1),e.stateNode=t;e:{switch(p=wM(r,n),r){case"dialog":Ia("cancel",t),Ia("close",t),c=n;break;case"iframe":case"object":case"embed":Ia("load",t),c=n;break;case"video":case"audio":for(c=0;c<M1.length;c++)Ia(M1[c],t);c=n;break;case"source":Ia("error",t),c=n;break;case"img":case"image":case"link":Ia("error",t),Ia("load",t),c=n;break;case"details":Ia("toggle",t),c=n;break;case"input":yV(t,n),c=mM(t,n),Ia("invalid",t);break;case"option":c=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},c=ro({},n,{value:void 0}),Ia("invalid",t);break;case"textarea":vV(t,n),c=yM(t,n),Ia("invalid",t);break;default:c=n}vM(r,c),a=c;for(d in a)if(a.hasOwnProperty(d)){var w=a[d];d==="style"?O9(t,w):d==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&M9(t,w)):d==="children"?typeof w=="string"?(r!=="textarea"||w!=="")&&mS(t,w):typeof w=="number"&&mS(t,""+w):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(pS.hasOwnProperty(d)?w!=null&&d==="onScroll"&&Ia("scroll",t):w!=null&&RO(t,d,w,p))}switch(r){case"input":H2(t),xV(t,n,!1);break;case"textarea":H2(t),wV(t);break;case"option":n.value!=null&&t.setAttribute("value",""+og(n.value));break;case"select":t.multiple=!!n.multiple,d=n.value,d!=null?Wv(t,!!n.multiple,d,!1):n.defaultValue!=null&&Wv(t,!!n.multiple,n.defaultValue,!0);break;default:typeof c.onClick=="function"&&(t.onclick=yN)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return zl(e),null;case 6:if(t&&e.stateNode!=null)i7(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Rr(166));if(r=L_(jS.current),L_(Jh.current),tj(e)){if(n=e.stateNode,r=e.memoizedProps,n[$h]=e,(d=n.nodeValue!==r)&&(t=Au,t!==null))switch(t.tag){case 3:ej(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ej(n.nodeValue,r,(t.mode&1)!==0)}d&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[$h]=e,e.stateNode=n}return zl(e),null;case 13:if(Ca(Wa),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(La&&Nu!==null&&e.mode&1&&!(e.flags&128))Sq(),g0(),e.flags|=98560,d=!1;else if(d=tj(e),n!==null&&n.dehydrated!==null){if(t===null){if(!d)throw Error(Rr(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(Rr(317));d[$h]=e}else g0(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;zl(e),d=!1}else Ud!==null&&(tD(Ud),Ud=null),d=!0;if(!d)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||Wa.current&1?Xo===0&&(Xo=3):mL())),e.updateQueue!==null&&(e.flags|=4),zl(e),null);case 4:return y0(),WM(t,e),t===null&&bS(e.stateNode.containerInfo),zl(e),null;case 10:return JO(e.type._context),zl(e),null;case 17:return tu(e.type)&&xN(),zl(e),null;case 19:if(Ca(Wa),d=e.memoizedState,d===null)return zl(e),null;if(n=(e.flags&128)!==0,p=d.rendering,p===null)if(n)v1(d,!1);else{if(Xo!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(p=jN(t),p!==null){for(e.flags|=128,v1(d,!1),n=p.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)d=r,t=n,d.flags&=14680066,p=d.alternate,p===null?(d.childLanes=0,d.lanes=t,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=p.childLanes,d.lanes=p.lanes,d.child=p.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=p.memoizedProps,d.memoizedState=p.memoizedState,d.updateQueue=p.updateQueue,d.type=p.type,t=p.dependencies,d.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return ya(Wa,Wa.current&1|2),e.child}t=t.sibling}d.tail!==null&&bo()>v0&&(e.flags|=128,n=!0,v1(d,!1),e.lanes=4194304)}else{if(!n)if(t=jN(p),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),v1(d,!0),d.tail===null&&d.tailMode==="hidden"&&!p.alternate&&!La)return zl(e),null}else 2*bo()-d.renderingStartTime>v0&&r!==1073741824&&(e.flags|=128,n=!0,v1(d,!1),e.lanes=4194304);d.isBackwards?(p.sibling=e.child,e.child=p):(r=d.last,r!==null?r.sibling=p:e.child=p,d.last=p)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=bo(),e.sibling=null,r=Wa.current,ya(Wa,n?r&1|2:r&1),e):(zl(e),null);case 22:case 23:return pL(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Tu&1073741824&&(zl(e),e.subtreeFlags&6&&(e.flags|=8192)):zl(e),null;case 24:return null;case 25:return null}throw Error(Rr(156,e.tag))}function _oe(t,e){switch(ZO(e),e.tag){case 1:return tu(e.type)&&xN(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return y0(),Ca(eu),Ca(Wl),nL(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return rL(e),null;case 13:if(Ca(Wa),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Rr(340));g0()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ca(Wa),null;case 4:return y0(),null;case 10:return JO(e.type._context),null;case 22:case 23:return pL(),null;case 24:return null;default:return null}}var sj=!1,$l=!1,yoe=typeof WeakSet=="function"?WeakSet:Set,En=null;function Bv(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){ho(t,e,n)}else r.current=null}function ZM(t,e,r){try{r()}catch(n){ho(t,e,n)}}var u6=!1;function xoe(t,e){if(PM=mN,t=uq(),HO(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var c=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{r.nodeType,d.nodeType}catch{r=null;break e}var p=0,a=-1,w=-1,E=0,C=0,P=t,R=null;t:for(;;){for(var B;P!==r||c!==0&&P.nodeType!==3||(a=p+c),P!==d||n!==0&&P.nodeType!==3||(w=p+n),P.nodeType===3&&(p+=P.nodeValue.length),(B=P.firstChild)!==null;)R=P,P=B;for(;;){if(P===t)break t;if(R===r&&++E===c&&(a=p),R===d&&++C===n&&(w=p),(B=P.nextSibling)!==null)break;P=R,R=P.parentNode}P=B}r=a===-1||w===-1?null:{start:a,end:w}}else r=null}r=r||{start:0,end:0}}else r=null;for(kM={focusedElem:t,selectionRange:r},mN=!1,En=e;En!==null;)if(e=En,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,En=t;else for(;En!==null;){e=En;try{var V=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(V!==null){var W=V.memoizedProps,K=V.memoizedState,Z=e.stateNode,$=Z.getSnapshotBeforeUpdate(e.elementType===e.type?W:Fd(e.type,W),K);Z.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var X=e.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Rr(163))}}catch(Q){ho(e,e.return,Q)}if(t=e.sibling,t!==null){t.return=e.return,En=t;break}En=e.return}return V=u6,u6=!1,V}function J1(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var c=n=n.next;do{if((c.tag&t)===t){var d=c.destroy;c.destroy=void 0,d!==void 0&&ZM(e,r,d)}c=c.next}while(c!==n)}}function JI(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function KM(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function a7(t){var e=t.alternate;e!==null&&(t.alternate=null,a7(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[$h],delete e[ES],delete e[DM],delete e[toe],delete e[roe])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function o7(t){return t.tag===5||t.tag===3||t.tag===4}function d6(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||o7(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function XM(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=yN));else if(n!==4&&(t=t.child,t!==null))for(XM(t,e,r),t=t.sibling;t!==null;)XM(t,e,r),t=t.sibling}function YM(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(YM(t,e,r),t=t.sibling;t!==null;)YM(t,e,r),t=t.sibling}var wl=null,zd=!1;function Sm(t,e,r){for(r=r.child;r!==null;)l7(t,e,r),r=r.sibling}function l7(t,e,r){if(Yh&&typeof Yh.onCommitFiberUnmount=="function")try{Yh.onCommitFiberUnmount(qI,r)}catch{}switch(r.tag){case 5:$l||Bv(r,e);case 6:var n=wl,c=zd;wl=null,Sm(t,e,r),wl=n,zd=c,wl!==null&&(zd?(t=wl,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):wl.removeChild(r.stateNode));break;case 18:wl!==null&&(zd?(t=wl,r=r.stateNode,t.nodeType===8?Wk(t.parentNode,r):t.nodeType===1&&Wk(t,r),xS(t)):Wk(wl,r.stateNode));break;case 4:n=wl,c=zd,wl=r.stateNode.containerInfo,zd=!0,Sm(t,e,r),wl=n,zd=c;break;case 0:case 11:case 14:case 15:if(!$l&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){c=n=n.next;do{var d=c,p=d.destroy;d=d.tag,p!==void 0&&(d&2||d&4)&&ZM(r,e,p),c=c.next}while(c!==n)}Sm(t,e,r);break;case 1:if(!$l&&(Bv(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){ho(r,e,a)}Sm(t,e,r);break;case 21:Sm(t,e,r);break;case 22:r.mode&1?($l=(n=$l)||r.memoizedState!==null,Sm(t,e,r),$l=n):Sm(t,e,r);break;default:Sm(t,e,r)}}function h6(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new yoe),e.forEach(function(n){var c=Ioe.bind(null,t,n);r.has(n)||(r.add(n),n.then(c,c))})}}function Md(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var c=r[n];try{var d=t,p=e,a=p;e:for(;a!==null;){switch(a.tag){case 5:wl=a.stateNode,zd=!1;break e;case 3:wl=a.stateNode.containerInfo,zd=!0;break e;case 4:wl=a.stateNode.containerInfo,zd=!0;break e}a=a.return}if(wl===null)throw Error(Rr(160));l7(d,p,c),wl=null,zd=!1;var w=c.alternate;w!==null&&(w.return=null),c.return=null}catch(E){ho(c,e,E)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)c7(e,t),e=e.sibling}function c7(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Md(e,t),zh(t),n&4){try{J1(3,t,t.return),JI(3,t)}catch(W){ho(t,t.return,W)}try{J1(5,t,t.return)}catch(W){ho(t,t.return,W)}}break;case 1:Md(e,t),zh(t),n&512&&r!==null&&Bv(r,r.return);break;case 5:if(Md(e,t),zh(t),n&512&&r!==null&&Bv(r,r.return),t.flags&32){var c=t.stateNode;try{mS(c,"")}catch(W){ho(t,t.return,W)}}if(n&4&&(c=t.stateNode,c!=null)){var d=t.memoizedProps,p=r!==null?r.memoizedProps:d,a=t.type,w=t.updateQueue;if(t.updateQueue=null,w!==null)try{a==="input"&&d.type==="radio"&&d.name!=null&&P9(c,d),wM(a,p);var E=wM(a,d);for(p=0;p<w.length;p+=2){var C=w[p],P=w[p+1];C==="style"?O9(c,P):C==="dangerouslySetInnerHTML"?M9(c,P):C==="children"?mS(c,P):RO(c,C,P,E)}switch(a){case"input":gM(c,d);break;case"textarea":k9(c,d);break;case"select":var R=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!d.multiple;var B=d.value;B!=null?Wv(c,!!d.multiple,B,!1):R!==!!d.multiple&&(d.defaultValue!=null?Wv(c,!!d.multiple,d.defaultValue,!0):Wv(c,!!d.multiple,d.multiple?[]:"",!1))}c[ES]=d}catch(W){ho(t,t.return,W)}}break;case 6:if(Md(e,t),zh(t),n&4){if(t.stateNode===null)throw Error(Rr(162));c=t.stateNode,d=t.memoizedProps;try{c.nodeValue=d}catch(W){ho(t,t.return,W)}}break;case 3:if(Md(e,t),zh(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{xS(e.containerInfo)}catch(W){ho(t,t.return,W)}break;case 4:Md(e,t),zh(t);break;case 13:Md(e,t),zh(t),c=t.child,c.flags&8192&&(d=c.memoizedState!==null,c.stateNode.isHidden=d,!d||c.alternate!==null&&c.alternate.memoizedState!==null||(hL=bo())),n&4&&h6(t);break;case 22:if(C=r!==null&&r.memoizedState!==null,t.mode&1?($l=(E=$l)||C,Md(e,t),$l=E):Md(e,t),zh(t),n&8192){if(E=t.memoizedState!==null,(t.stateNode.isHidden=E)&&!C&&t.mode&1)for(En=t,C=t.child;C!==null;){for(P=En=C;En!==null;){switch(R=En,B=R.child,R.tag){case 0:case 11:case 14:case 15:J1(4,R,R.return);break;case 1:Bv(R,R.return);var V=R.stateNode;if(typeof V.componentWillUnmount=="function"){n=R,r=R.return;try{e=n,V.props=e.memoizedProps,V.state=e.memoizedState,V.componentWillUnmount()}catch(W){ho(n,r,W)}}break;case 5:Bv(R,R.return);break;case 22:if(R.memoizedState!==null){p6(P);continue}}B!==null?(B.return=R,En=B):p6(P)}C=C.sibling}e:for(C=null,P=t;;){if(P.tag===5){if(C===null){C=P;try{c=P.stateNode,E?(d=c.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(a=P.stateNode,w=P.memoizedProps.style,p=w!=null&&w.hasOwnProperty("display")?w.display:null,a.style.display=D9("display",p))}catch(W){ho(t,t.return,W)}}}else if(P.tag===6){if(C===null)try{P.stateNode.nodeValue=E?"":P.memoizedProps}catch(W){ho(t,t.return,W)}}else if((P.tag!==22&&P.tag!==23||P.memoizedState===null||P===t)&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===t)break e;for(;P.sibling===null;){if(P.return===null||P.return===t)break e;C===P&&(C=null),P=P.return}C===P&&(C=null),P.sibling.return=P.return,P=P.sibling}}break;case 19:Md(e,t),zh(t),n&4&&h6(t);break;case 21:break;default:Md(e,t),zh(t)}}function zh(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(o7(r)){var n=r;break e}r=r.return}throw Error(Rr(160))}switch(n.tag){case 5:var c=n.stateNode;n.flags&32&&(mS(c,""),n.flags&=-33);var d=d6(t);YM(t,d,c);break;case 3:case 4:var p=n.stateNode.containerInfo,a=d6(t);XM(t,a,p);break;default:throw Error(Rr(161))}}catch(w){ho(t,t.return,w)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function voe(t,e,r){En=t,u7(t)}function u7(t,e,r){for(var n=(t.mode&1)!==0;En!==null;){var c=En,d=c.child;if(c.tag===22&&n){var p=c.memoizedState!==null||sj;if(!p){var a=c.alternate,w=a!==null&&a.memoizedState!==null||$l;a=sj;var E=$l;if(sj=p,($l=w)&&!E)for(En=c;En!==null;)p=En,w=p.child,p.tag===22&&p.memoizedState!==null?m6(c):w!==null?(w.return=p,En=w):m6(c);for(;d!==null;)En=d,u7(d),d=d.sibling;En=c,sj=a,$l=E}f6(t)}else c.subtreeFlags&8772&&d!==null?(d.return=c,En=d):f6(t)}}function f6(t){for(;En!==null;){var e=En;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:$l||JI(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!$l)if(r===null)n.componentDidMount();else{var c=e.elementType===e.type?r.memoizedProps:Fd(e.type,r.memoizedProps);n.componentDidUpdate(c,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var d=e.updateQueue;d!==null&&YV(e,d,n);break;case 3:var p=e.updateQueue;if(p!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}YV(e,p,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var w=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&r.focus();break;case"img":w.src&&(r.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var E=e.alternate;if(E!==null){var C=E.memoizedState;if(C!==null){var P=C.dehydrated;P!==null&&xS(P)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Rr(163))}$l||e.flags&512&&KM(e)}catch(R){ho(e,e.return,R)}}if(e===t){En=null;break}if(r=e.sibling,r!==null){r.return=e.return,En=r;break}En=e.return}}function p6(t){for(;En!==null;){var e=En;if(e===t){En=null;break}var r=e.sibling;if(r!==null){r.return=e.return,En=r;break}En=e.return}}function m6(t){for(;En!==null;){var e=En;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{JI(4,e)}catch(w){ho(e,r,w)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var c=e.return;try{n.componentDidMount()}catch(w){ho(e,c,w)}}var d=e.return;try{KM(e)}catch(w){ho(e,d,w)}break;case 5:var p=e.return;try{KM(e)}catch(w){ho(e,p,w)}}}catch(w){ho(e,e.return,w)}if(e===t){En=null;break}var a=e.sibling;if(a!==null){a.return=e.return,En=a;break}En=e.return}}var woe=Math.ceil,CN=Ip.ReactCurrentDispatcher,uL=Ip.ReactCurrentOwner,rd=Ip.ReactCurrentBatchConfig,Ri=0,ul=null,Ro=null,El=0,Tu=0,Vv=Tg(0),Xo=0,AS=null,ty=0,QI=0,dL=0,Q1=null,Wc=null,hL=0,v0=1/0,Kf=null,AN=!1,JM=null,tg=null,ij=!1,Hm=null,PN=0,eS=0,QM=null,$j=-1,qj=0;function jc(){return Ri&6?bo():$j!==-1?$j:$j=bo()}function rg(t){return t.mode&1?Ri&2&&El!==0?El&-El:soe.transition!==null?(qj===0&&(qj=Z9()),qj):(t=na,t!==0||(t=window.event,t=t===void 0?16:tq(t.type)),t):1}function Kd(t,e,r,n){if(50<eS)throw eS=0,QM=null,Error(Rr(185));pE(t,r,n),(!(Ri&2)||t!==ul)&&(t===ul&&(!(Ri&2)&&(QI|=r),Xo===4&&Om(t,El)),ru(t,n),r===1&&Ri===0&&!(e.mode&1)&&(v0=bo()+500,KI&&jg()))}function ru(t,e){var r=t.callbackNode;sae(t,e);var n=pN(t,t===ul?El:0);if(n===0)r!==null&&EV(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&EV(r),e===1)t.tag===0?noe(g6.bind(null,t)):vq(g6.bind(null,t)),Qae(function(){!(Ri&6)&&jg()}),r=null;else{switch(K9(n)){case 1:r=FO;break;case 4:r=H9;break;case 16:r=fN;break;case 536870912:r=W9;break;default:r=fN}r=y7(r,d7.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function d7(t,e){if($j=-1,qj=0,Ri&6)throw Error(Rr(327));var r=t.callbackNode;if(Jv()&&t.callbackNode!==r)return null;var n=pN(t,t===ul?El:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=kN(t,n);else{e=n;var c=Ri;Ri|=2;var d=f7();(ul!==t||El!==e)&&(Kf=null,v0=bo()+500,U_(t,e));do try{Eoe();break}catch(a){h7(t,a)}while(!0);YO(),CN.current=d,Ri=c,Ro!==null?e=0:(ul=null,El=0,e=Xo)}if(e!==0){if(e===2&&(c=jM(t),c!==0&&(n=c,e=eD(t,c))),e===1)throw r=AS,U_(t,0),Om(t,n),ru(t,bo()),r;if(e===6)Om(t,n);else{if(c=t.current.alternate,!(n&30)&&!boe(c)&&(e=kN(t,n),e===2&&(d=jM(t),d!==0&&(n=d,e=eD(t,d))),e===1))throw r=AS,U_(t,0),Om(t,n),ru(t,bo()),r;switch(t.finishedWork=c,t.finishedLanes=n,e){case 0:case 1:throw Error(Rr(345));case 2:C_(t,Wc,Kf);break;case 3:if(Om(t,n),(n&130023424)===n&&(e=hL+500-bo(),10<e)){if(pN(t,0)!==0)break;if(c=t.suspendedLanes,(c&n)!==n){jc(),t.pingedLanes|=t.suspendedLanes&c;break}t.timeoutHandle=MM(C_.bind(null,t,Wc,Kf),e);break}C_(t,Wc,Kf);break;case 4:if(Om(t,n),(n&4194240)===n)break;for(e=t.eventTimes,c=-1;0<n;){var p=31-Zd(n);d=1<<p,p=e[p],p>c&&(c=p),n&=~d}if(n=c,n=bo()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*woe(n/1960))-n,10<n){t.timeoutHandle=MM(C_.bind(null,t,Wc,Kf),n);break}C_(t,Wc,Kf);break;case 5:C_(t,Wc,Kf);break;default:throw Error(Rr(329))}}}return ru(t,bo()),t.callbackNode===r?d7.bind(null,t):null}function eD(t,e){var r=Q1;return t.current.memoizedState.isDehydrated&&(U_(t,e).flags|=256),t=kN(t,e),t!==2&&(e=Wc,Wc=r,e!==null&&tD(e)),t}function tD(t){Wc===null?Wc=t:Wc.push.apply(Wc,t)}function boe(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var c=r[n],d=c.getSnapshot;c=c.value;try{if(!eh(d(),c))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Om(t,e){for(e&=~dL,e&=~QI,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Zd(e),n=1<<r;t[r]=-1,e&=~n}}function g6(t){if(Ri&6)throw Error(Rr(327));Jv();var e=pN(t,0);if(!(e&1))return ru(t,bo()),null;var r=kN(t,e);if(t.tag!==0&&r===2){var n=jM(t);n!==0&&(e=n,r=eD(t,n))}if(r===1)throw r=AS,U_(t,0),Om(t,e),ru(t,bo()),r;if(r===6)throw Error(Rr(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,C_(t,Wc,Kf),ru(t,bo()),null}function fL(t,e){var r=Ri;Ri|=1;try{return t(e)}finally{Ri=r,Ri===0&&(v0=bo()+500,KI&&jg())}}function ry(t){Hm!==null&&Hm.tag===0&&!(Ri&6)&&Jv();var e=Ri;Ri|=1;var r=rd.transition,n=na;try{if(rd.transition=null,na=1,t)return t()}finally{na=n,rd.transition=r,Ri=e,!(Ri&6)&&jg()}}function pL(){Tu=Vv.current,Ca(Vv)}function U_(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Jae(r)),Ro!==null)for(r=Ro.return;r!==null;){var n=r;switch(ZO(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&xN();break;case 3:y0(),Ca(eu),Ca(Wl),nL();break;case 5:rL(n);break;case 4:y0();break;case 13:Ca(Wa);break;case 19:Ca(Wa);break;case 10:JO(n.type._context);break;case 22:case 23:pL()}r=r.return}if(ul=t,Ro=t=ng(t.current,null),El=Tu=e,Xo=0,AS=null,dL=QI=ty=0,Wc=Q1=null,O_!==null){for(e=0;e<O_.length;e++)if(r=O_[e],n=r.interleaved,n!==null){r.interleaved=null;var c=n.next,d=r.pending;if(d!==null){var p=d.next;d.next=c,n.next=p}r.pending=n}O_=null}return t}function h7(t,e){do{var r=Ro;try{if(YO(),Bj.current=IN,NN){for(var n=Ja.memoizedState;n!==null;){var c=n.queue;c!==null&&(c.pending=null),n=n.next}NN=!1}if(ey=0,ol=Ko=Ja=null,Y1=!1,NS=0,uL.current=null,r===null||r.return===null){Xo=1,AS=e,Ro=null;break}e:{var d=t,p=r.return,a=r,w=e;if(e=El,a.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var E=w,C=a,P=C.tag;if(!(C.mode&1)&&(P===0||P===11||P===15)){var R=C.alternate;R?(C.updateQueue=R.updateQueue,C.memoizedState=R.memoizedState,C.lanes=R.lanes):(C.updateQueue=null,C.memoizedState=null)}var B=n6(p);if(B!==null){B.flags&=-257,s6(B,p,a,d,e),B.mode&1&&r6(d,E,e),e=B,w=E;var V=e.updateQueue;if(V===null){var W=new Set;W.add(w),e.updateQueue=W}else V.add(w);break e}else{if(!(e&1)){r6(d,E,e),mL();break e}w=Error(Rr(426))}}else if(La&&a.mode&1){var K=n6(p);if(K!==null){!(K.flags&65536)&&(K.flags|=256),s6(K,p,a,d,e),KO(x0(w,a));break e}}d=w=x0(w,a),Xo!==4&&(Xo=2),Q1===null?Q1=[d]:Q1.push(d),d=p;do{switch(d.tag){case 3:d.flags|=65536,e&=-e,d.lanes|=e;var Z=Kq(d,w,e);XV(d,Z);break e;case 1:a=w;var $=d.type,X=d.stateNode;if(!(d.flags&128)&&(typeof $.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(tg===null||!tg.has(X)))){d.flags|=65536,e&=-e,d.lanes|=e;var Q=Xq(d,a,e);XV(d,Q);break e}}d=d.return}while(d!==null)}m7(r)}catch(re){e=re,Ro===r&&r!==null&&(Ro=r=r.return);continue}break}while(!0)}function f7(){var t=CN.current;return CN.current=IN,t===null?IN:t}function mL(){(Xo===0||Xo===3||Xo===2)&&(Xo=4),ul===null||!(ty&268435455)&&!(QI&268435455)||Om(ul,El)}function kN(t,e){var r=Ri;Ri|=2;var n=f7();(ul!==t||El!==e)&&(Kf=null,U_(t,e));do try{Soe();break}catch(c){h7(t,c)}while(!0);if(YO(),Ri=r,CN.current=n,Ro!==null)throw Error(Rr(261));return ul=null,El=0,Xo}function Soe(){for(;Ro!==null;)p7(Ro)}function Eoe(){for(;Ro!==null&&!Kie();)p7(Ro)}function p7(t){var e=_7(t.alternate,t,Tu);t.memoizedProps=t.pendingProps,e===null?m7(t):Ro=e,uL.current=null}function m7(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=_oe(r,e),r!==null){r.flags&=32767,Ro=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Xo=6,Ro=null;return}}else if(r=goe(r,e,Tu),r!==null){Ro=r;return}if(e=e.sibling,e!==null){Ro=e;return}Ro=e=t}while(e!==null);Xo===0&&(Xo=5)}function C_(t,e,r){var n=na,c=rd.transition;try{rd.transition=null,na=1,Toe(t,e,r,n)}finally{rd.transition=c,na=n}return null}function Toe(t,e,r,n){do Jv();while(Hm!==null);if(Ri&6)throw Error(Rr(327));r=t.finishedWork;var c=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(Rr(177));t.callbackNode=null,t.callbackPriority=0;var d=r.lanes|r.childLanes;if(iae(t,d),t===ul&&(Ro=ul=null,El=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||ij||(ij=!0,y7(fN,function(){return Jv(),null})),d=(r.flags&15990)!==0,r.subtreeFlags&15990||d){d=rd.transition,rd.transition=null;var p=na;na=1;var a=Ri;Ri|=4,uL.current=null,xoe(t,r),c7(r,t),Gae(kM),mN=!!PM,kM=PM=null,t.current=r,voe(r),Xie(),Ri=a,na=p,rd.transition=d}else t.current=r;if(ij&&(ij=!1,Hm=t,PN=c),d=t.pendingLanes,d===0&&(tg=null),Qie(r.stateNode),ru(t,bo()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)c=e[r],n(c.value,{componentStack:c.stack,digest:c.digest});if(AN)throw AN=!1,t=JM,JM=null,t;return PN&1&&t.tag!==0&&Jv(),d=t.pendingLanes,d&1?t===QM?eS++:(eS=0,QM=t):eS=0,jg(),null}function Jv(){if(Hm!==null){var t=K9(PN),e=rd.transition,r=na;try{if(rd.transition=null,na=16>t?16:t,Hm===null)var n=!1;else{if(t=Hm,Hm=null,PN=0,Ri&6)throw Error(Rr(331));var c=Ri;for(Ri|=4,En=t.current;En!==null;){var d=En,p=d.child;if(En.flags&16){var a=d.deletions;if(a!==null){for(var w=0;w<a.length;w++){var E=a[w];for(En=E;En!==null;){var C=En;switch(C.tag){case 0:case 11:case 15:J1(8,C,d)}var P=C.child;if(P!==null)P.return=C,En=P;else for(;En!==null;){C=En;var R=C.sibling,B=C.return;if(a7(C),C===E){En=null;break}if(R!==null){R.return=B,En=R;break}En=B}}}var V=d.alternate;if(V!==null){var W=V.child;if(W!==null){V.child=null;do{var K=W.sibling;W.sibling=null,W=K}while(W!==null)}}En=d}}if(d.subtreeFlags&2064&&p!==null)p.return=d,En=p;else e:for(;En!==null;){if(d=En,d.flags&2048)switch(d.tag){case 0:case 11:case 15:J1(9,d,d.return)}var Z=d.sibling;if(Z!==null){Z.return=d.return,En=Z;break e}En=d.return}}var $=t.current;for(En=$;En!==null;){p=En;var X=p.child;if(p.subtreeFlags&2064&&X!==null)X.return=p,En=X;else e:for(p=$;En!==null;){if(a=En,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:JI(9,a)}}catch(re){ho(a,a.return,re)}if(a===p){En=null;break e}var Q=a.sibling;if(Q!==null){Q.return=a.return,En=Q;break e}En=a.return}}if(Ri=c,jg(),Yh&&typeof Yh.onPostCommitFiberRoot=="function")try{Yh.onPostCommitFiberRoot(qI,t)}catch{}n=!0}return n}finally{na=r,rd.transition=e}}return!1}function _6(t,e,r){e=x0(r,e),e=Kq(t,e,1),t=eg(t,e,1),e=jc(),t!==null&&(pE(t,1,e),ru(t,e))}function ho(t,e,r){if(t.tag===3)_6(t,t,r);else for(;e!==null;){if(e.tag===3){_6(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(tg===null||!tg.has(n))){t=x0(r,t),t=Xq(e,t,1),e=eg(e,t,1),t=jc(),e!==null&&(pE(e,1,t),ru(e,t));break}}e=e.return}}function joe(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=jc(),t.pingedLanes|=t.suspendedLanes&r,ul===t&&(El&r)===r&&(Xo===4||Xo===3&&(El&130023424)===El&&500>bo()-hL?U_(t,0):dL|=r),ru(t,e)}function g7(t,e){e===0&&(t.mode&1?(e=K2,K2<<=1,!(K2&130023424)&&(K2=4194304)):e=1);var r=jc();t=fp(t,e),t!==null&&(pE(t,e,r),ru(t,r))}function Noe(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),g7(t,r)}function Ioe(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,c=t.memoizedState;c!==null&&(r=c.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(Rr(314))}n!==null&&n.delete(e),g7(t,r)}var _7;_7=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||eu.current)Yc=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return Yc=!1,moe(t,e,r);Yc=!!(t.flags&131072)}else Yc=!1,La&&e.flags&1048576&&wq(e,bN,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Uj(t,e),t=e.pendingProps;var c=m0(e,Wl.current);Yv(e,r),c=iL(null,e,n,t,c,r);var d=aL();return e.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,tu(n)?(d=!0,vN(e)):d=!1,e.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,eL(e),c.updater=YI,e.stateNode=c,c._reactInternals=e,VM(e,n,t,r),e=qM(null,e,n,!0,d,r)):(e.tag=0,La&&d&&WO(e),vc(null,e,c,r),e=e.child),e;case 16:n=e.elementType;e:{switch(Uj(t,e),t=e.pendingProps,c=n._init,n=c(n._payload),e.type=n,c=e.tag=Aoe(n),t=Fd(n,t),c){case 0:e=$M(null,e,n,t,r);break e;case 1:e=o6(null,e,n,t,r);break e;case 11:e=i6(null,e,n,t,r);break e;case 14:e=a6(null,e,n,Fd(n.type,t),r);break e}throw Error(Rr(306,n,""))}return e;case 0:return n=e.type,c=e.pendingProps,c=e.elementType===n?c:Fd(n,c),$M(t,e,n,c,r);case 1:return n=e.type,c=e.pendingProps,c=e.elementType===n?c:Fd(n,c),o6(t,e,n,c,r);case 3:e:{if(e7(e),t===null)throw Error(Rr(387));n=e.pendingProps,d=e.memoizedState,c=d.element,Nq(t,e),TN(e,n,null,r);var p=e.memoizedState;if(n=p.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:p.cache,pendingSuspenseBoundaries:p.pendingSuspenseBoundaries,transitions:p.transitions},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){c=x0(Error(Rr(423)),e),e=l6(t,e,n,r,c);break e}else if(n!==c){c=x0(Error(Rr(424)),e),e=l6(t,e,n,r,c);break e}else for(Nu=Qm(e.stateNode.containerInfo.firstChild),Au=e,La=!0,Ud=null,r=Tq(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(g0(),n===c){e=pp(t,e,r);break e}vc(t,e,n,r)}e=e.child}return e;case 5:return Iq(e),t===null&&FM(e),n=e.type,c=e.pendingProps,d=t!==null?t.memoizedProps:null,p=c.children,RM(n,c)?p=null:d!==null&&RM(n,d)&&(e.flags|=32),Qq(t,e),vc(t,e,p,r),e.child;case 6:return t===null&&FM(e),null;case 13:return t7(t,e,r);case 4:return tL(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=_0(e,null,n,r):vc(t,e,n,r),e.child;case 11:return n=e.type,c=e.pendingProps,c=e.elementType===n?c:Fd(n,c),i6(t,e,n,c,r);case 7:return vc(t,e,e.pendingProps,r),e.child;case 8:return vc(t,e,e.pendingProps.children,r),e.child;case 12:return vc(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,c=e.pendingProps,d=e.memoizedProps,p=c.value,ya(SN,n._currentValue),n._currentValue=p,d!==null)if(eh(d.value,p)){if(d.children===c.children&&!eu.current){e=pp(t,e,r);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var a=d.dependencies;if(a!==null){p=d.child;for(var w=a.firstContext;w!==null;){if(w.context===n){if(d.tag===1){w=ap(-1,r&-r),w.tag=2;var E=d.updateQueue;if(E!==null){E=E.shared;var C=E.pending;C===null?w.next=w:(w.next=C.next,C.next=w),E.pending=w}}d.lanes|=r,w=d.alternate,w!==null&&(w.lanes|=r),zM(d.return,r,e),a.lanes|=r;break}w=w.next}}else if(d.tag===10)p=d.type===e.type?null:d.child;else if(d.tag===18){if(p=d.return,p===null)throw Error(Rr(341));p.lanes|=r,a=p.alternate,a!==null&&(a.lanes|=r),zM(p,r,e),p=d.sibling}else p=d.child;if(p!==null)p.return=d;else for(p=d;p!==null;){if(p===e){p=null;break}if(d=p.sibling,d!==null){d.return=p.return,p=d;break}p=p.return}d=p}vc(t,e,c.children,r),e=e.child}return e;case 9:return c=e.type,n=e.pendingProps.children,Yv(e,r),c=ad(c),n=n(c),e.flags|=1,vc(t,e,n,r),e.child;case 14:return n=e.type,c=Fd(n,e.pendingProps),c=Fd(n.type,c),a6(t,e,n,c,r);case 15:return Yq(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,c=e.pendingProps,c=e.elementType===n?c:Fd(n,c),Uj(t,e),e.tag=1,tu(n)?(t=!0,vN(e)):t=!1,Yv(e,r),Zq(e,n,c),VM(e,n,c,r),qM(null,e,n,!0,t,r);case 19:return r7(t,e,r);case 22:return Jq(t,e,r)}throw Error(Rr(156,e.tag))};function y7(t,e){return G9(t,e)}function Coe(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ed(t,e,r,n){return new Coe(t,e,r,n)}function gL(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Aoe(t){if(typeof t=="function")return gL(t)?1:0;if(t!=null){if(t=t.$$typeof,t===DO)return 11;if(t===OO)return 14}return 2}function ng(t,e){var r=t.alternate;return r===null?(r=ed(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Gj(t,e,r,n,c,d){var p=2;if(n=t,typeof t=="function")gL(t)&&(p=1);else if(typeof t=="string")p=5;else e:switch(t){case Pv:return $_(r.children,c,d,e);case MO:p=8,c|=8;break;case dM:return t=ed(12,r,e,c|2),t.elementType=dM,t.lanes=d,t;case hM:return t=ed(13,r,e,c),t.elementType=hM,t.lanes=d,t;case fM:return t=ed(19,r,e,c),t.elementType=fM,t.lanes=d,t;case I9:return eC(r,c,d,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case j9:p=10;break e;case N9:p=9;break e;case DO:p=11;break e;case OO:p=14;break e;case km:p=16,n=null;break e}throw Error(Rr(130,t==null?t:typeof t,""))}return e=ed(p,r,e,c),e.elementType=t,e.type=n,e.lanes=d,e}function $_(t,e,r,n){return t=ed(7,t,n,e),t.lanes=r,t}function eC(t,e,r,n){return t=ed(22,t,n,e),t.elementType=I9,t.lanes=r,t.stateNode={isHidden:!1},t}function tR(t,e,r){return t=ed(6,t,null,e),t.lanes=r,t}function rR(t,e,r){return e=ed(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Poe(t,e,r,n,c){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ok(0),this.expirationTimes=Ok(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ok(0),this.identifierPrefix=n,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function _L(t,e,r,n,c,d,p,a,w){return t=new Poe(t,e,r,a,w),e===1?(e=1,d===!0&&(e|=8)):e=0,d=ed(3,null,null,e),t.current=d,d.stateNode=t,d.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},eL(d),t}function koe(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Av,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function x7(t){if(!t)return lg;t=t._reactInternals;e:{if(Cy(t)!==t||t.tag!==1)throw Error(Rr(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(tu(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Rr(171))}if(t.tag===1){var r=t.type;if(tu(r))return xq(t,r,e)}return e}function v7(t,e,r,n,c,d,p,a,w){return t=_L(r,n,!0,t,c,d,p,a,w),t.context=x7(null),r=t.current,n=jc(),c=rg(r),d=ap(n,c),d.callback=e??null,eg(r,d,c),t.current.lanes=c,pE(t,c,n),ru(t,n),t}function tC(t,e,r,n){var c=e.current,d=jc(),p=rg(c);return r=x7(r),e.context===null?e.context=r:e.pendingContext=r,e=ap(d,p),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=eg(c,e,p),t!==null&&(Kd(t,c,p,d),zj(t,c,p)),p}function RN(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function y6(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function yL(t,e){y6(t,e),(t=t.alternate)&&y6(t,e)}function Roe(){return null}var w7=typeof reportError=="function"?reportError:function(t){console.error(t)};function xL(t){this._internalRoot=t}rC.prototype.render=xL.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Rr(409));tC(t,e,null,null)};rC.prototype.unmount=xL.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ry(function(){tC(null,t,null,null)}),e[hp]=null}};function rC(t){this._internalRoot=t}rC.prototype.unstable_scheduleHydration=function(t){if(t){var e=J9();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Dm.length&&e!==0&&e<Dm[r].priority;r++);Dm.splice(r,0,t),r===0&&eq(t)}};function vL(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function nC(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function x6(){}function Moe(t,e,r,n,c){if(c){if(typeof n=="function"){var d=n;n=function(){var E=RN(p);d.call(E)}}var p=v7(e,n,t,0,null,!1,!1,"",x6);return t._reactRootContainer=p,t[hp]=p.current,bS(t.nodeType===8?t.parentNode:t),ry(),p}for(;c=t.lastChild;)t.removeChild(c);if(typeof n=="function"){var a=n;n=function(){var E=RN(w);a.call(E)}}var w=_L(t,0,!1,null,null,!1,!1,"",x6);return t._reactRootContainer=w,t[hp]=w.current,bS(t.nodeType===8?t.parentNode:t),ry(function(){tC(e,w,r,n)}),w}function sC(t,e,r,n,c){var d=r._reactRootContainer;if(d){var p=d;if(typeof c=="function"){var a=c;c=function(){var w=RN(p);a.call(w)}}tC(e,p,t,c)}else p=Moe(r,e,t,c,n);return RN(p)}X9=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=R1(e.pendingLanes);r!==0&&(zO(e,r|1),ru(e,bo()),!(Ri&6)&&(v0=bo()+500,jg()))}break;case 13:ry(function(){var n=fp(t,1);if(n!==null){var c=jc();Kd(n,t,1,c)}}),yL(t,1)}};BO=function(t){if(t.tag===13){var e=fp(t,134217728);if(e!==null){var r=jc();Kd(e,t,134217728,r)}yL(t,134217728)}};Y9=function(t){if(t.tag===13){var e=rg(t),r=fp(t,e);if(r!==null){var n=jc();Kd(r,t,e,n)}yL(t,e)}};J9=function(){return na};Q9=function(t,e){var r=na;try{return na=t,e()}finally{na=r}};SM=function(t,e,r){switch(e){case"input":if(gM(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var c=ZI(n);if(!c)throw Error(Rr(90));A9(n),gM(n,c)}}}break;case"textarea":k9(t,r);break;case"select":e=r.value,e!=null&&Wv(t,!!r.multiple,e,!1)}};z9=fL;B9=ry;var Doe={usingClientEntryPoint:!1,Events:[gE,Dv,ZI,L9,F9,fL]},w1={findFiberByHostInstance:D_,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ooe={bundleType:w1.bundleType,version:w1.version,rendererPackageName:w1.rendererPackageName,rendererConfig:w1.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ip.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=$9(t),t===null?null:t.stateNode},findFiberByHostInstance:w1.findFiberByHostInstance||Roe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var aj=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!aj.isDisabled&&aj.supportsFiber)try{qI=aj.inject(Ooe),Yh=aj}catch{}}Lu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Doe;Lu.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!vL(e))throw Error(Rr(200));return koe(t,e,null,r)};Lu.createRoot=function(t,e){if(!vL(t))throw Error(Rr(299));var r=!1,n="",c=w7;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(c=e.onRecoverableError)),e=_L(t,1,!1,null,null,r,!1,n,c),t[hp]=e.current,bS(t.nodeType===8?t.parentNode:t),new xL(e)};Lu.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Rr(188)):(t=Object.keys(t).join(","),Error(Rr(268,t)));return t=$9(e),t=t===null?null:t.stateNode,t};Lu.flushSync=function(t){return ry(t)};Lu.hydrate=function(t,e,r){if(!nC(e))throw Error(Rr(200));return sC(null,t,e,!0,r)};Lu.hydrateRoot=function(t,e,r){if(!vL(t))throw Error(Rr(405));var n=r!=null&&r.hydratedSources||null,c=!1,d="",p=w7;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),e=v7(e,null,t,1,r??null,c,!1,d,p),t[hp]=e.current,bS(t),n)for(t=0;t<n.length;t++)r=n[t],c=r._getVersion,c=c(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,c]:e.mutableSourceEagerHydrationData.push(r,c);return new rC(e)};Lu.render=function(t,e,r){if(!nC(e))throw Error(Rr(200));return sC(null,t,e,!1,r)};Lu.unmountComponentAtNode=function(t){if(!nC(t))throw Error(Rr(40));return t._reactRootContainer?(ry(function(){sC(null,null,t,!1,function(){t._reactRootContainer=null,t[hp]=null})}),!0):!1};Lu.unstable_batchedUpdates=fL;Lu.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!nC(r))throw Error(Rr(200));if(t==null||t._reactInternals===void 0)throw Error(Rr(38));return sC(t,e,r,!1,n)};Lu.version="18.3.1-next-f1338f8080-20240426";function b7(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b7)}catch(t){console.error(t)}}b7(),b9.exports=Lu;var Y0=b9.exports;const Loe=W0(Y0);var S7,v6=Y0;S7=v6.createRoot,v6.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function PS(){return PS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},PS.apply(this,arguments)}var Wm;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Wm||(Wm={}));const w6="popstate";function Foe(t){t===void 0&&(t={});function e(c,d){let{pathname:p="/",search:a="",hash:w=""}=Ay(c.location.hash.substr(1));return!p.startsWith("/")&&!p.startsWith(".")&&(p="/"+p),rD("",{pathname:p,search:a,hash:w},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function r(c,d){let p=c.document.querySelector("base"),a="";if(p&&p.getAttribute("href")){let w=c.location.href,E=w.indexOf("#");a=E===-1?w:w.slice(0,E)}return a+"#"+(typeof d=="string"?d:MN(d))}function n(c,d){wL(c.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(d)+")")}return Boe(e,r,n,t)}function Qa(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function wL(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function zoe(){return Math.random().toString(36).substr(2,8)}function b6(t,e){return{usr:t.state,key:t.key,idx:e}}function rD(t,e,r,n){return r===void 0&&(r=null),PS({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Ay(e):e,{state:r,key:e&&e.key||n||zoe()})}function MN(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function Ay(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function Boe(t,e,r,n){n===void 0&&(n={});let{window:c=document.defaultView,v5Compat:d=!1}=n,p=c.history,a=Wm.Pop,w=null,E=C();E==null&&(E=0,p.replaceState(PS({},p.state,{idx:E}),""));function C(){return(p.state||{idx:null}).idx}function P(){a=Wm.Pop;let K=C(),Z=K==null?null:K-E;E=K,w&&w({action:a,location:W.location,delta:Z})}function R(K,Z){a=Wm.Push;let $=rD(W.location,K,Z);r&&r($,K),E=C()+1;let X=b6($,E),Q=W.createHref($);try{p.pushState(X,"",Q)}catch(re){if(re instanceof DOMException&&re.name==="DataCloneError")throw re;c.location.assign(Q)}d&&w&&w({action:a,location:W.location,delta:1})}function B(K,Z){a=Wm.Replace;let $=rD(W.location,K,Z);r&&r($,K),E=C();let X=b6($,E),Q=W.createHref($);p.replaceState(X,"",Q),d&&w&&w({action:a,location:W.location,delta:0})}function V(K){let Z=c.location.origin!=="null"?c.location.origin:c.location.href,$=typeof K=="string"?K:MN(K);return $=$.replace(/ $/,"%20"),Qa(Z,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,Z)}let W={get action(){return a},get location(){return t(c,p)},listen(K){if(w)throw new Error("A history only accepts one active listener");return c.addEventListener(w6,P),w=K,()=>{c.removeEventListener(w6,P),w=null}},createHref(K){return e(c,K)},createURL:V,encodeLocation(K){let Z=V(K);return{pathname:Z.pathname,search:Z.search,hash:Z.hash}},push:R,replace:B,go(K){return p.go(K)}};return W}var S6;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(S6||(S6={}));function Voe(t,e,r){return r===void 0&&(r="/"),Uoe(t,e,r,!1)}function Uoe(t,e,r,n){let c=typeof e=="string"?Ay(e):e,d=w0(c.pathname||"/",r);if(d==null)return null;let p=E7(t);$oe(p);let a=null;for(let w=0;a==null&&w<p.length;++w){let E=ele(d);a=Joe(p[w],E,n)}return a}function E7(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let c=(d,p,a)=>{let w={relativePath:a===void 0?d.path||"":a,caseSensitive:d.caseSensitive===!0,childrenIndex:p,route:d};w.relativePath.startsWith("/")&&(Qa(w.relativePath.startsWith(n),'Absolute route path "'+w.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),w.relativePath=w.relativePath.slice(n.length));let E=sg([n,w.relativePath]),C=r.concat(w);d.children&&d.children.length>0&&(Qa(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+E+'".')),E7(d.children,e,C,E)),!(d.path==null&&!d.index)&&e.push({path:E,score:Xoe(E,d.index),routesMeta:C})};return t.forEach((d,p)=>{var a;if(d.path===""||!((a=d.path)!=null&&a.includes("?")))c(d,p);else for(let w of T7(d.path))c(d,p,w)}),e}function T7(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,c=r.endsWith("?"),d=r.replace(/\?$/,"");if(n.length===0)return c?[d,""]:[d];let p=T7(n.join("/")),a=[];return a.push(...p.map(w=>w===""?d:[d,w].join("/"))),c&&a.push(...p),a.map(w=>t.startsWith("/")&&w===""?"/":w)}function $oe(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:Yoe(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const qoe=/^:[\w-]+$/,Goe=3,Hoe=2,Woe=1,Zoe=10,Koe=-2,E6=t=>t==="*";function Xoe(t,e){let r=t.split("/"),n=r.length;return r.some(E6)&&(n+=Koe),e&&(n+=Hoe),r.filter(c=>!E6(c)).reduce((c,d)=>c+(qoe.test(d)?Goe:d===""?Woe:Zoe),n)}function Yoe(t,e){return t.length===e.length&&t.slice(0,-1).every((n,c)=>n===e[c])?t[t.length-1]-e[e.length-1]:0}function Joe(t,e,r){let{routesMeta:n}=t,c={},d="/",p=[];for(let a=0;a<n.length;++a){let w=n[a],E=a===n.length-1,C=d==="/"?e:e.slice(d.length)||"/",P=DN({path:w.relativePath,caseSensitive:w.caseSensitive,end:E},C),R=w.route;if(!P&&E&&r&&!n[n.length-1].route.index&&(P=DN({path:w.relativePath,caseSensitive:w.caseSensitive,end:!1},C)),!P)return null;Object.assign(c,P.params),p.push({params:c,pathname:sg([d,P.pathname]),pathnameBase:sle(sg([d,P.pathnameBase])),route:R}),P.pathnameBase!=="/"&&(d=sg([d,P.pathnameBase]))}return p}function DN(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=Qoe(t.path,t.caseSensitive,t.end),c=e.match(r);if(!c)return null;let d=c[0],p=d.replace(/(.)\/+$/,"$1"),a=c.slice(1);return{params:n.reduce((E,C,P)=>{let{paramName:R,isOptional:B}=C;if(R==="*"){let W=a[P]||"";p=d.slice(0,d.length-W.length).replace(/(.)\/+$/,"$1")}const V=a[P];return B&&!V?E[R]=void 0:E[R]=(V||"").replace(/%2F/g,"/"),E},{}),pathname:d,pathnameBase:p,pattern:t}}function Qoe(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),wL(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],c="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(p,a,w)=>(n.push({paramName:a,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),c+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":t!==""&&t!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),n]}function ele(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return wL(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function w0(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function tle(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:c=""}=typeof t=="string"?Ay(t):t;return{pathname:r?r.startsWith("/")?r:rle(r,e):e,search:ile(n),hash:ale(c)}}function rle(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(c=>{c===".."?r.length>1&&r.pop():c!=="."&&r.push(c)}),r.length>1?r.join("/"):"/"}function nR(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function nle(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function bL(t,e){let r=nle(t);return e?r.map((n,c)=>c===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function SL(t,e,r,n){n===void 0&&(n=!1);let c;typeof t=="string"?c=Ay(t):(c=PS({},t),Qa(!c.pathname||!c.pathname.includes("?"),nR("?","pathname","search",c)),Qa(!c.pathname||!c.pathname.includes("#"),nR("#","pathname","hash",c)),Qa(!c.search||!c.search.includes("#"),nR("#","search","hash",c)));let d=t===""||c.pathname==="",p=d?"/":c.pathname,a;if(p==null)a=r;else{let P=e.length-1;if(!n&&p.startsWith("..")){let R=p.split("/");for(;R[0]==="..";)R.shift(),P-=1;c.pathname=R.join("/")}a=P>=0?e[P]:"/"}let w=tle(c,a),E=p&&p!=="/"&&p.endsWith("/"),C=(d||p===".")&&r.endsWith("/");return!w.pathname.endsWith("/")&&(E||C)&&(w.pathname+="/"),w}const sg=t=>t.join("/").replace(/\/\/+/g,"/"),sle=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),ile=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,ale=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function ole(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const j7=["post","put","patch","delete"];new Set(j7);const lle=["get",...j7];new Set(lle);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function kS(){return kS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},kS.apply(this,arguments)}const iC=z.createContext(null),N7=z.createContext(null),Cp=z.createContext(null),aC=z.createContext(null),ff=z.createContext({outlet:null,matches:[],isDataRoute:!1}),I7=z.createContext(null);function cle(t,e){let{relative:r}=e===void 0?{}:e;J0()||Qa(!1);let{basename:n,navigator:c}=z.useContext(Cp),{hash:d,pathname:p,search:a}=oC(t,{relative:r}),w=p;return n!=="/"&&(w=p==="/"?n:sg([n,p])),c.createHref({pathname:w,search:a,hash:d})}function J0(){return z.useContext(aC)!=null}function Ap(){return J0()||Qa(!1),z.useContext(aC).location}function C7(t){z.useContext(Cp).static||z.useLayoutEffect(t)}function Ra(){let{isDataRoute:t}=z.useContext(ff);return t?Ele():ule()}function ule(){J0()||Qa(!1);let t=z.useContext(iC),{basename:e,future:r,navigator:n}=z.useContext(Cp),{matches:c}=z.useContext(ff),{pathname:d}=Ap(),p=JSON.stringify(bL(c,r.v7_relativeSplatPath)),a=z.useRef(!1);return C7(()=>{a.current=!0}),z.useCallback(function(E,C){if(C===void 0&&(C={}),!a.current)return;if(typeof E=="number"){n.go(E);return}let P=SL(E,JSON.parse(p),d,C.relative==="path");t==null&&e!=="/"&&(P.pathname=P.pathname==="/"?e:sg([e,P.pathname])),(C.replace?n.replace:n.push)(P,C.state,C)},[e,n,p,d,t])}const dle=z.createContext(null);function hle(t){let e=z.useContext(ff).outlet;return e&&z.createElement(dle.Provider,{value:t},e)}function yE(){let{matches:t}=z.useContext(ff),e=t[t.length-1];return e?e.params:{}}function oC(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=z.useContext(Cp),{matches:c}=z.useContext(ff),{pathname:d}=Ap(),p=JSON.stringify(bL(c,n.v7_relativeSplatPath));return z.useMemo(()=>SL(t,JSON.parse(p),d,r==="path"),[t,p,d,r])}function fle(t,e){return ple(t,e)}function ple(t,e,r,n){J0()||Qa(!1);let{navigator:c}=z.useContext(Cp),{matches:d}=z.useContext(ff),p=d[d.length-1],a=p?p.params:{};p&&p.pathname;let w=p?p.pathnameBase:"/";p&&p.route;let E=Ap(),C;if(e){var P;let K=typeof e=="string"?Ay(e):e;w==="/"||(P=K.pathname)!=null&&P.startsWith(w)||Qa(!1),C=K}else C=E;let R=C.pathname||"/",B=R;if(w!=="/"){let K=w.replace(/^\//,"").split("/");B="/"+R.replace(/^\//,"").split("/").slice(K.length).join("/")}let V=Voe(t,{pathname:B}),W=xle(V&&V.map(K=>Object.assign({},K,{params:Object.assign({},a,K.params),pathname:sg([w,c.encodeLocation?c.encodeLocation(K.pathname).pathname:K.pathname]),pathnameBase:K.pathnameBase==="/"?w:sg([w,c.encodeLocation?c.encodeLocation(K.pathnameBase).pathname:K.pathnameBase])})),d,r,n);return e&&W?z.createElement(aC.Provider,{value:{location:kS({pathname:"/",search:"",hash:"",state:null,key:"default"},C),navigationType:Wm.Pop}},W):W}function mle(){let t=Sle(),e=ole(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return z.createElement(z.Fragment,null,z.createElement("h2",null,"Unexpected Application Error!"),z.createElement("h3",{style:{fontStyle:"italic"}},e),r?z.createElement("pre",{style:c},r):null,null)}const gle=z.createElement(mle,null);class _le extends z.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?z.createElement(ff.Provider,{value:this.props.routeContext},z.createElement(I7.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function yle(t){let{routeContext:e,match:r,children:n}=t,c=z.useContext(iC);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),z.createElement(ff.Provider,{value:e},n)}function xle(t,e,r,n){var c;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var d;if(!r)return null;if(r.errors)t=r.matches;else if((d=n)!=null&&d.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let p=t,a=(c=r)==null?void 0:c.errors;if(a!=null){let C=p.findIndex(P=>P.route.id&&(a==null?void 0:a[P.route.id])!==void 0);C>=0||Qa(!1),p=p.slice(0,Math.min(p.length,C+1))}let w=!1,E=-1;if(r&&n&&n.v7_partialHydration)for(let C=0;C<p.length;C++){let P=p[C];if((P.route.HydrateFallback||P.route.hydrateFallbackElement)&&(E=C),P.route.id){let{loaderData:R,errors:B}=r,V=P.route.loader&&R[P.route.id]===void 0&&(!B||B[P.route.id]===void 0);if(P.route.lazy||V){w=!0,E>=0?p=p.slice(0,E+1):p=[p[0]];break}}}return p.reduceRight((C,P,R)=>{let B,V=!1,W=null,K=null;r&&(B=a&&P.route.id?a[P.route.id]:void 0,W=P.route.errorElement||gle,w&&(E<0&&R===0?(V=!0,K=null):E===R&&(V=!0,K=P.route.hydrateFallbackElement||null)));let Z=e.concat(p.slice(0,R+1)),$=()=>{let X;return B?X=W:V?X=K:P.route.Component?X=z.createElement(P.route.Component,null):P.route.element?X=P.route.element:X=C,z.createElement(yle,{match:P,routeContext:{outlet:C,matches:Z,isDataRoute:r!=null},children:X})};return r&&(P.route.ErrorBoundary||P.route.errorElement||R===0)?z.createElement(_le,{location:r.location,revalidation:r.revalidation,component:W,error:B,children:$(),routeContext:{outlet:null,matches:Z,isDataRoute:!0}}):$()},null)}var A7=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(A7||{}),ON=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ON||{});function vle(t){let e=z.useContext(iC);return e||Qa(!1),e}function wle(t){let e=z.useContext(N7);return e||Qa(!1),e}function ble(t){let e=z.useContext(ff);return e||Qa(!1),e}function P7(t){let e=ble(),r=e.matches[e.matches.length-1];return r.route.id||Qa(!1),r.route.id}function Sle(){var t;let e=z.useContext(I7),r=wle(ON.UseRouteError),n=P7(ON.UseRouteError);return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function Ele(){let{router:t}=vle(A7.UseNavigateStable),e=P7(ON.UseNavigateStable),r=z.useRef(!1);return C7(()=>{r.current=!0}),z.useCallback(function(c,d){d===void 0&&(d={}),r.current&&(typeof c=="number"?t.navigate(c):t.navigate(c,kS({fromRouteId:e},d)))},[t,e])}function Tle(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function nD(t){let{to:e,replace:r,state:n,relative:c}=t;J0()||Qa(!1);let{future:d,static:p}=z.useContext(Cp),{matches:a}=z.useContext(ff),{pathname:w}=Ap(),E=Ra(),C=SL(e,bL(a,d.v7_relativeSplatPath),w,c==="path"),P=JSON.stringify(C);return z.useEffect(()=>E(JSON.parse(P),{replace:r,state:n,relative:c}),[E,P,c,r,n]),null}function jle(t){return hle(t.context)}function Us(t){Qa(!1)}function Nle(t){let{basename:e="/",children:r=null,location:n,navigationType:c=Wm.Pop,navigator:d,static:p=!1,future:a}=t;J0()&&Qa(!1);let w=e.replace(/^\/*/,"/"),E=z.useMemo(()=>({basename:w,navigator:d,static:p,future:kS({v7_relativeSplatPath:!1},a)}),[w,a,d,p]);typeof n=="string"&&(n=Ay(n));let{pathname:C="/",search:P="",hash:R="",state:B=null,key:V="default"}=n,W=z.useMemo(()=>{let K=w0(C,w);return K==null?null:{location:{pathname:K,search:P,hash:R,state:B,key:V},navigationType:c}},[w,C,P,R,B,V,c]);return W==null?null:z.createElement(Cp.Provider,{value:E},z.createElement(aC.Provider,{children:r,value:W}))}function Ile(t){let{children:e,location:r}=t;return fle(sD(e),r)}new Promise(()=>{});function sD(t,e){e===void 0&&(e=[]);let r=[];return z.Children.forEach(t,(n,c)=>{if(!z.isValidElement(n))return;let d=[...e,c];if(n.type===z.Fragment){r.push.apply(r,sD(n.props.children,d));return}n.type!==Us&&Qa(!1),!n.props.index||!n.props.children||Qa(!1);let p={id:n.props.id||d.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(p.children=sD(n.props.children,d)),r.push(p)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function LN(){return LN=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},LN.apply(this,arguments)}function k7(t,e){if(t==null)return{};var r={},n=Object.keys(t),c,d;for(d=0;d<n.length;d++)c=n[d],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function Cle(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Ale(t,e){return t.button===0&&(!e||e==="_self")&&!Cle(t)}function iD(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,r)=>{let n=t[r];return e.concat(Array.isArray(n)?n.map(c=>[r,c]):[[r,n]])},[]))}function Ple(t,e){let r=iD(t);return e&&e.forEach((n,c)=>{r.has(c)||e.getAll(c).forEach(d=>{r.append(c,d)})}),r}const kle=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Rle=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Mle="6";try{window.__reactRouterVersion=Mle}catch{}const Dle=z.createContext({isTransitioning:!1}),Ole="startTransition",T6=v9[Ole];function Lle(t){let{basename:e,children:r,future:n,window:c}=t,d=z.useRef();d.current==null&&(d.current=Foe({window:c,v5Compat:!0}));let p=d.current,[a,w]=z.useState({action:p.action,location:p.location}),{v7_startTransition:E}=n||{},C=z.useCallback(P=>{E&&T6?T6(()=>w(P)):w(P)},[w,E]);return z.useLayoutEffect(()=>p.listen(C),[p,C]),z.useEffect(()=>Tle(n),[n]),z.createElement(Nle,{basename:e,children:r,location:a.location,navigationType:a.action,navigator:p,future:n})}const Fle=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",zle=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Nr=z.forwardRef(function(e,r){let{onClick:n,relative:c,reloadDocument:d,replace:p,state:a,target:w,to:E,preventScrollReset:C,viewTransition:P}=e,R=k7(e,kle),{basename:B}=z.useContext(Cp),V,W=!1;if(typeof E=="string"&&zle.test(E)&&(V=E,Fle))try{let X=new URL(window.location.href),Q=E.startsWith("//")?new URL(X.protocol+E):new URL(E),re=w0(Q.pathname,B);Q.origin===X.origin&&re!=null?E=re+Q.search+Q.hash:W=!0}catch{}let K=cle(E,{relative:c}),Z=Vle(E,{replace:p,state:a,target:w,preventScrollReset:C,relative:c,viewTransition:P});function $(X){n&&n(X),X.defaultPrevented||Z(X)}return z.createElement("a",LN({},R,{href:V||K,onClick:W||d?n:$,ref:r,target:w}))}),Bh=z.forwardRef(function(e,r){let{"aria-current":n="page",caseSensitive:c=!1,className:d="",end:p=!1,style:a,to:w,viewTransition:E,children:C}=e,P=k7(e,Rle),R=oC(w,{relative:P.relative}),B=Ap(),V=z.useContext(N7),{navigator:W,basename:K}=z.useContext(Cp),Z=V!=null&&Ule(R)&&E===!0,$=W.encodeLocation?W.encodeLocation(R).pathname:R.pathname,X=B.pathname,Q=V&&V.navigation&&V.navigation.location?V.navigation.location.pathname:null;c||(X=X.toLowerCase(),Q=Q?Q.toLowerCase():null,$=$.toLowerCase()),Q&&K&&(Q=w0(Q,K)||Q);const re=$!=="/"&&$.endsWith("/")?$.length-1:$.length;let ve=X===$||!p&&X.startsWith($)&&X.charAt(re)==="/",pe=Q!=null&&(Q===$||!p&&Q.startsWith($)&&Q.charAt($.length)==="/"),ue={isActive:ve,isPending:pe,isTransitioning:Z},ge=ve?n:void 0,ce;typeof d=="function"?ce=d(ue):ce=[d,ve?"active":null,pe?"pending":null,Z?"transitioning":null].filter(Boolean).join(" ");let Se=typeof a=="function"?a(ue):a;return z.createElement(Nr,LN({},P,{"aria-current":ge,className:ce,ref:r,style:Se,to:w,viewTransition:E}),typeof C=="function"?C(ue):C)});var aD;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(aD||(aD={}));var j6;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(j6||(j6={}));function Ble(t){let e=z.useContext(iC);return e||Qa(!1),e}function Vle(t,e){let{target:r,replace:n,state:c,preventScrollReset:d,relative:p,viewTransition:a}=e===void 0?{}:e,w=Ra(),E=Ap(),C=oC(t,{relative:p});return z.useCallback(P=>{if(Ale(P,r)){P.preventDefault();let R=n!==void 0?n:MN(E)===MN(C);w(t,{replace:R,state:c,preventScrollReset:d,relative:p,viewTransition:a})}},[E,w,C,n,c,r,t,d,p,a])}function xE(t){let e=z.useRef(iD(t)),r=z.useRef(!1),n=Ap(),c=z.useMemo(()=>Ple(n.search,r.current?null:e.current),[n.search]),d=Ra(),p=z.useCallback((a,w)=>{const E=iD(typeof a=="function"?a(c):a);r.current=!0,d("?"+E,w)},[d,c]);return[c,p]}function Ule(t,e){e===void 0&&(e={});let r=z.useContext(Dle);r==null&&Qa(!1);let{basename:n}=Ble(aD.useViewTransitionState),c=oC(t,{relative:e.relative});if(!r.isTransitioning)return!1;let d=w0(r.currentLocation.pathname,n)||r.currentLocation.pathname,p=w0(r.nextLocation.pathname,n)||r.nextLocation.pathname;return DN(c.pathname,p)!=null||DN(c.pathname,d)!=null}var FN=["light","dark"],EL="(prefers-color-scheme: dark)",$le=typeof window>"u",TL=z.createContext(void 0),qle={setTheme:t=>{},themes:[]},lC=()=>{var t;return(t=z.useContext(TL))!=null?t:qle},Gle=t=>z.useContext(TL)?t.children:z.createElement(Wle,{...t}),Hle=["light","dark"],Wle=({forcedTheme:t,disableTransitionOnChange:e=!1,enableSystem:r=!0,enableColorScheme:n=!0,storageKey:c="theme",themes:d=Hle,defaultTheme:p=r?"system":"light",attribute:a="data-theme",value:w,children:E,nonce:C})=>{let[P,R]=z.useState(()=>N6(c,p)),[B,V]=z.useState(()=>N6(c)),W=w?Object.values(w):d,K=z.useCallback(Q=>{let re=Q;if(!re)return;Q==="system"&&r&&(re=I6());let ve=w?w[re]:re,pe=e?Kle():null,ue=document.documentElement;if(a==="class"?(ue.classList.remove(...W),ve&&ue.classList.add(ve)):ve?ue.setAttribute(a,ve):ue.removeAttribute(a),n){let ge=FN.includes(p)?p:null,ce=FN.includes(re)?re:ge;ue.style.colorScheme=ce}pe==null||pe()},[]),Z=z.useCallback(Q=>{let re=typeof Q=="function"?Q(Q):Q;R(re);try{localStorage.setItem(c,re)}catch{}},[t]),$=z.useCallback(Q=>{let re=I6(Q);V(re),P==="system"&&r&&!t&&K("system")},[P,t]);z.useEffect(()=>{let Q=window.matchMedia(EL);return Q.addListener($),$(Q),()=>Q.removeListener($)},[$]),z.useEffect(()=>{let Q=re=>{if(re.key!==c)return;let ve=re.newValue||p;Z(ve)};return window.addEventListener("storage",Q),()=>window.removeEventListener("storage",Q)},[Z]),z.useEffect(()=>{K(t??P)},[t,P]);let X=z.useMemo(()=>({theme:P,setTheme:Z,forcedTheme:t,resolvedTheme:P==="system"?B:P,themes:r?[...d,"system"]:d,systemTheme:r?B:void 0}),[P,Z,t,B,r,d]);return z.createElement(TL.Provider,{value:X},z.createElement(Zle,{forcedTheme:t,disableTransitionOnChange:e,enableSystem:r,enableColorScheme:n,storageKey:c,themes:d,defaultTheme:p,attribute:a,value:w,children:E,attrs:W,nonce:C}),E)},Zle=z.memo(({forcedTheme:t,storageKey:e,attribute:r,enableSystem:n,enableColorScheme:c,defaultTheme:d,value:p,attrs:a,nonce:w})=>{let E=d==="system",C=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(V=>`'${V}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,P=c?FN.includes(d)&&d?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${d}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",R=(V,W=!1,K=!0)=>{let Z=p?p[V]:V,$=W?V+"|| ''":`'${Z}'`,X="";return c&&K&&!W&&FN.includes(V)&&(X+=`d.style.colorScheme = '${V}';`),r==="class"?W||Z?X+=`c.add(${$})`:X+="null":Z&&(X+=`d[s](n,${$})`),X},B=t?`!function(){${C}${R(t)}}()`:n?`!function(){try{${C}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${E})){var t='${EL}',m=window.matchMedia(t);if(m.media!==t||m.matches){${R("dark")}}else{${R("light")}}}else if(e){${p?`var x=${JSON.stringify(p)};`:""}${R(p?"x[e]":"e",!0)}}${E?"":"else{"+R(d,!1,!1)+"}"}${P}}catch(e){}}()`:`!function(){try{${C}var e=localStorage.getItem('${e}');if(e){${p?`var x=${JSON.stringify(p)};`:""}${R(p?"x[e]":"e",!0)}}else{${R(d,!1,!1)};}${P}}catch(t){}}();`;return z.createElement("script",{nonce:w,dangerouslySetInnerHTML:{__html:B}})}),N6=(t,e)=>{if($le)return;let r;try{r=localStorage.getItem(t)||void 0}catch{}return r||e},Kle=()=>{let t=document.createElement("style");return t.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},I6=t=>(t||(t=window.matchMedia(EL)),t.matches?"dark":"light");let Xle={data:""},Yle=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||Xle,Jle=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Qle=/\/\*[^]*?\*\/|  +/g,C6=/\n+/g,Lm=(t,e)=>{let r="",n="",c="";for(let d in t){let p=t[d];d[0]=="@"?d[1]=="i"?r=d+" "+p+";":n+=d[1]=="f"?Lm(p,d):d+"{"+Lm(p,d[1]=="k"?"":e)+"}":typeof p=="object"?n+=Lm(p,e?e.replace(/([^,])+/g,a=>d.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,w=>/&/.test(w)?w.replace(/&/g,a):a?a+" "+w:w)):d):p!=null&&(d=/^--/.test(d)?d:d.replace(/[A-Z]/g,"-$&").toLowerCase(),c+=Lm.p?Lm.p(d,p):d+":"+p+";")}return r+(e&&c?e+"{"+c+"}":c)+n},$f={},R7=t=>{if(typeof t=="object"){let e="";for(let r in t)e+=r+R7(t[r]);return e}return t},ece=(t,e,r,n,c)=>{let d=R7(t),p=$f[d]||($f[d]=(w=>{let E=0,C=11;for(;E<w.length;)C=101*C+w.charCodeAt(E++)>>>0;return"go"+C})(d));if(!$f[p]){let w=d!==t?t:(E=>{let C,P,R=[{}];for(;C=Jle.exec(E.replace(Qle,""));)C[4]?R.shift():C[3]?(P=C[3].replace(C6," ").trim(),R.unshift(R[0][P]=R[0][P]||{})):R[0][C[1]]=C[2].replace(C6," ").trim();return R[0]})(t);$f[p]=Lm(c?{["@keyframes "+p]:w}:w,r?"":"."+p)}let a=r&&$f.g?$f.g:null;return r&&($f.g=$f[p]),((w,E,C,P)=>{P?E.data=E.data.replace(P,w):E.data.indexOf(w)===-1&&(E.data=C?w+E.data:E.data+w)})($f[p],e,n,a),p},tce=(t,e,r)=>t.reduce((n,c,d)=>{let p=e[d];if(p&&p.call){let a=p(r),w=a&&a.props&&a.props.className||/^go/.test(a)&&a;p=w?"."+w:a&&typeof a=="object"?a.props?"":Lm(a,""):a===!1?"":a}return n+c+(p??"")},"");function cC(t){let e=this||{},r=t.call?t(e.p):t;return ece(r.unshift?r.raw?tce(r,[].slice.call(arguments,1),e.p):r.reduce((n,c)=>Object.assign(n,c&&c.call?c(e.p):c),{}):r,Yle(e.target),e.g,e.o,e.k)}let M7,oD,lD;cC.bind({g:1});let mp=cC.bind({k:1});function rce(t,e,r,n){Lm.p=e,M7=t,oD=r,lD=n}function Ng(t,e){let r=this||{};return function(){let n=arguments;function c(d,p){let a=Object.assign({},d),w=a.className||c.className;r.p=Object.assign({theme:oD&&oD()},a),r.o=/ *go\d+/.test(w),a.className=cC.apply(r,n)+(w?" "+w:"");let E=t;return t[0]&&(E=a.as||t,delete a.as),lD&&E[0]&&lD(a),M7(E,a)}return c}}var nce=t=>typeof t=="function",zN=(t,e)=>nce(t)?t(e):t,sce=(()=>{let t=0;return()=>(++t).toString()})(),D7=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),ice=20,O7=(t,e)=>{switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,ice)};case 1:return{...t,toasts:t.toasts.map(d=>d.id===e.toast.id?{...d,...e.toast}:d)};case 2:let{toast:r}=e;return O7(t,{type:t.toasts.find(d=>d.id===r.id)?1:0,toast:r});case 3:let{toastId:n}=e;return{...t,toasts:t.toasts.map(d=>d.id===n||n===void 0?{...d,dismissed:!0,visible:!1}:d)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(d=>d.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let c=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(d=>({...d,pauseDuration:d.pauseDuration+c}))}}},Hj=[],F_={toasts:[],pausedAt:void 0},Py=t=>{F_=O7(F_,t),Hj.forEach(e=>{e(F_)})},ace={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},oce=(t={})=>{let[e,r]=z.useState(F_),n=z.useRef(F_);z.useEffect(()=>(n.current!==F_&&r(F_),Hj.push(r),()=>{let d=Hj.indexOf(r);d>-1&&Hj.splice(d,1)}),[]);let c=e.toasts.map(d=>{var p,a,w;return{...t,...t[d.type],...d,removeDelay:d.removeDelay||((p=t[d.type])==null?void 0:p.removeDelay)||(t==null?void 0:t.removeDelay),duration:d.duration||((a=t[d.type])==null?void 0:a.duration)||(t==null?void 0:t.duration)||ace[d.type],style:{...t.style,...(w=t[d.type])==null?void 0:w.style,...d.style}}});return{...e,toasts:c}},lce=(t,e="blank",r)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...r,id:(r==null?void 0:r.id)||sce()}),vE=t=>(e,r)=>{let n=lce(e,t,r);return Py({type:2,toast:n}),n.id},Za=(t,e)=>vE("blank")(t,e);Za.error=vE("error");Za.success=vE("success");Za.loading=vE("loading");Za.custom=vE("custom");Za.dismiss=t=>{Py({type:3,toastId:t})};Za.remove=t=>Py({type:4,toastId:t});Za.promise=(t,e,r)=>{let n=Za.loading(e.loading,{...r,...r==null?void 0:r.loading});return typeof t=="function"&&(t=t()),t.then(c=>{let d=e.success?zN(e.success,c):void 0;return d?Za.success(d,{id:n,...r,...r==null?void 0:r.success}):Za.dismiss(n),c}).catch(c=>{let d=e.error?zN(e.error,c):void 0;d?Za.error(d,{id:n,...r,...r==null?void 0:r.error}):Za.dismiss(n)}),t};var cce=(t,e)=>{Py({type:1,toast:{id:t,height:e}})},uce=()=>{Py({type:5,time:Date.now()})},tS=new Map,dce=1e3,hce=(t,e=dce)=>{if(tS.has(t))return;let r=setTimeout(()=>{tS.delete(t),Py({type:4,toastId:t})},e);tS.set(t,r)},fce=t=>{let{toasts:e,pausedAt:r}=oce(t);z.useEffect(()=>{if(r)return;let d=Date.now(),p=e.map(a=>{if(a.duration===1/0)return;let w=(a.duration||0)+a.pauseDuration-(d-a.createdAt);if(w<0){a.visible&&Za.dismiss(a.id);return}return setTimeout(()=>Za.dismiss(a.id),w)});return()=>{p.forEach(a=>a&&clearTimeout(a))}},[e,r]);let n=z.useCallback(()=>{r&&Py({type:6,time:Date.now()})},[r]),c=z.useCallback((d,p)=>{let{reverseOrder:a=!1,gutter:w=8,defaultPosition:E}=p||{},C=e.filter(B=>(B.position||E)===(d.position||E)&&B.height),P=C.findIndex(B=>B.id===d.id),R=C.filter((B,V)=>V<P&&B.visible).length;return C.filter(B=>B.visible).slice(...a?[R+1]:[0,R]).reduce((B,V)=>B+(V.height||0)+w,0)},[e]);return z.useEffect(()=>{e.forEach(d=>{if(d.dismissed)hce(d.id,d.removeDelay);else{let p=tS.get(d.id);p&&(clearTimeout(p),tS.delete(d.id))}})},[e]),{toasts:e,handlers:{updateHeight:cce,startPause:uce,endPause:n,calculateOffset:c}}},pce=mp`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,mce=mp`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,gce=mp`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,_ce=Ng("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${pce} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${mce} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${gce} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,yce=mp`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,xce=Ng("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${yce} 1s linear infinite;
`,vce=mp`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,wce=mp`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,bce=Ng("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${vce} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${wce} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Sce=Ng("div")`
  position: absolute;
`,Ece=Ng("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Tce=mp`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,jce=Ng("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Tce} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Nce=({toast:t})=>{let{icon:e,type:r,iconTheme:n}=t;return e!==void 0?typeof e=="string"?z.createElement(jce,null,e):e:r==="blank"?null:z.createElement(Ece,null,z.createElement(xce,{...n}),r!=="loading"&&z.createElement(Sce,null,r==="error"?z.createElement(_ce,{...n}):z.createElement(bce,{...n})))},Ice=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Cce=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,Ace="0%{opacity:0;} 100%{opacity:1;}",Pce="0%{opacity:1;} 100%{opacity:0;}",kce=Ng("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Rce=Ng("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Mce=(t,e)=>{let r=t.includes("top")?1:-1,[n,c]=D7()?[Ace,Pce]:[Ice(r),Cce(r)];return{animation:e?`${mp(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${mp(c)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Dce=z.memo(({toast:t,position:e,style:r,children:n})=>{let c=t.height?Mce(t.position||e||"top-center",t.visible):{opacity:0},d=z.createElement(Nce,{toast:t}),p=z.createElement(Rce,{...t.ariaProps},zN(t.message,t));return z.createElement(kce,{className:t.className,style:{...c,...r,...t.style}},typeof n=="function"?n({icon:d,message:p}):z.createElement(z.Fragment,null,d,p))});rce(z.createElement);var Oce=({id:t,className:e,style:r,onHeightUpdate:n,children:c})=>{let d=z.useCallback(p=>{if(p){let a=()=>{let w=p.getBoundingClientRect().height;n(t,w)};a(),new MutationObserver(a).observe(p,{subtree:!0,childList:!0,characterData:!0})}},[t,n]);return z.createElement("div",{ref:d,className:e,style:r},c)},Lce=(t,e)=>{let r=t.includes("top"),n=r?{top:0}:{bottom:0},c=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:D7()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(r?1:-1)}px)`,...n,...c}},Fce=cC`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,oj=16,zce=({reverseOrder:t,position:e="top-center",toastOptions:r,gutter:n,children:c,containerStyle:d,containerClassName:p})=>{let{toasts:a,handlers:w}=fce(r);return z.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:oj,left:oj,right:oj,bottom:oj,pointerEvents:"none",...d},className:p,onMouseEnter:w.startPause,onMouseLeave:w.endPause},a.map(E=>{let C=E.position||e,P=w.calculateOffset(E,{reverseOrder:t,gutter:n,defaultPosition:e}),R=Lce(C,P);return z.createElement(Oce,{id:E.id,key:E.id,onHeightUpdate:w.updateHeight,className:E.visible?Fce:"",style:R},E.type==="custom"?zN(E.message,E):c?c(E):z.createElement(Dce,{toast:E,position:C}))}))},Nt=Za;const Bce="modulepreload",Vce=function(t){return"/StudyMarket/"+t},A6={},ny=function(e,r,n){let c=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),a=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));c=Promise.allSettled(r.map(w=>{if(w=Vce(w),w in A6)return;A6[w]=!0;const E=w.endsWith(".css"),C=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${C}`))return;const P=document.createElement("link");if(P.rel=E?"stylesheet":Bce,E||(P.as="script"),P.crossOrigin="",P.href=w,a&&P.setAttribute("nonce",a),document.head.appendChild(P),E)return new Promise((R,B)=>{P.addEventListener("load",R),P.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${w}`)))})}))}function d(p){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=p,window.dispatchEvent(a),!a.defaultPrevented)throw p}return c.then(p=>{for(const a of p||[])a.status==="rejected"&&d(a.reason);return e().catch(d)})};var P6={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L7=function(t){const e=[];let r=0;for(let n=0;n<t.length;n++){let c=t.charCodeAt(n);c<128?e[r++]=c:c<2048?(e[r++]=c>>6|192,e[r++]=c&63|128):(c&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(c=65536+((c&1023)<<10)+(t.charCodeAt(++n)&1023),e[r++]=c>>18|240,e[r++]=c>>12&63|128,e[r++]=c>>6&63|128,e[r++]=c&63|128):(e[r++]=c>>12|224,e[r++]=c>>6&63|128,e[r++]=c&63|128)}return e},Uce=function(t){const e=[];let r=0,n=0;for(;r<t.length;){const c=t[r++];if(c<128)e[n++]=String.fromCharCode(c);else if(c>191&&c<224){const d=t[r++];e[n++]=String.fromCharCode((c&31)<<6|d&63)}else if(c>239&&c<365){const d=t[r++],p=t[r++],a=t[r++],w=((c&7)<<18|(d&63)<<12|(p&63)<<6|a&63)-65536;e[n++]=String.fromCharCode(55296+(w>>10)),e[n++]=String.fromCharCode(56320+(w&1023))}else{const d=t[r++],p=t[r++];e[n++]=String.fromCharCode((c&15)<<12|(d&63)<<6|p&63)}}return e.join("")},F7={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let c=0;c<t.length;c+=3){const d=t[c],p=c+1<t.length,a=p?t[c+1]:0,w=c+2<t.length,E=w?t[c+2]:0,C=d>>2,P=(d&3)<<4|a>>4;let R=(a&15)<<2|E>>6,B=E&63;w||(B=64,p||(R=64)),n.push(r[C],r[P],r[R],r[B])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(L7(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Uce(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let c=0;c<t.length;){const d=r[t.charAt(c++)],a=c<t.length?r[t.charAt(c)]:0;++c;const E=c<t.length?r[t.charAt(c)]:64;++c;const P=c<t.length?r[t.charAt(c)]:64;if(++c,d==null||a==null||E==null||P==null)throw new $ce;const R=d<<2|a>>4;if(n.push(R),E!==64){const B=a<<4&240|E>>2;if(n.push(B),P!==64){const V=E<<6&192|P;n.push(V)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class $ce extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const qce=function(t){const e=L7(t);return F7.encodeByteArray(e,!0)},BN=function(t){return qce(t).replace(/\./g,"")},z7=function(t){try{return F7.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gce(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hce=()=>Gce().__FIREBASE_DEFAULTS__,Wce=()=>{if(typeof process>"u"||typeof P6>"u")return;const t=P6.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Zce=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&z7(t[1]);return e&&JSON.parse(e)},uC=()=>{try{return Hce()||Wce()||Zce()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},B7=t=>{var e,r;return(r=(e=uC())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},V7=t=>{const e=B7(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),n]:[e.substring(0,r),n]},U7=()=>{var t;return(t=uC())===null||t===void 0?void 0:t.config},$7=t=>{var e;return(e=uC())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kce=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,n)=>{r?this.reject(r):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,n))}}};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q7(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},n=e||"demo-project",c=t.iat||0,d=t.sub||t.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:c,exp:c+3600,auth_time:c,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},t);return[BN(JSON.stringify(r)),BN(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zl(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Xce(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Zl())}function Yce(){var t;const e=(t=uC())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Jce(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function G7(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Qce(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function eue(){const t=Zl();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function tue(){return!Yce()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function H7(){try{return typeof indexedDB=="object"}catch{return!1}}function W7(){return new Promise((t,e)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(n);c.onsuccess=()=>{c.result.close(),r||self.indexedDB.deleteDatabase(n),t(!0)},c.onupgradeneeded=()=>{r=!1},c.onerror=()=>{var d;e(((d=c.error)===null||d===void 0?void 0:d.message)||"")}}catch(r){e(r)}})}function rue(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nue="FirebaseError";class dd extends Error{constructor(e,r,n){super(r),this.code=e,this.customData=n,this.name=nue,Object.setPrototypeOf(this,dd.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ky.prototype.create)}}class ky{constructor(e,r,n){this.service=e,this.serviceName=r,this.errors=n}create(e,...r){const n=r[0]||{},c=`${this.service}/${e}`,d=this.errors[e],p=d?sue(d,n):"Error",a=`${this.serviceName}: ${p} (${c}).`;return new dd(c,a,n)}}function sue(t,e){return t.replace(iue,(r,n)=>{const c=e[n];return c!=null?String(c):`<${n}?>`})}const iue=/\{\$([^}]+)}/g;function aue(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function RS(t,e){if(t===e)return!0;const r=Object.keys(t),n=Object.keys(e);for(const c of r){if(!n.includes(c))return!1;const d=t[c],p=e[c];if(k6(d)&&k6(p)){if(!RS(d,p))return!1}else if(d!==p)return!1}for(const c of n)if(!r.includes(c))return!1;return!0}function k6(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wE(t){const e=[];for(const[r,n]of Object.entries(t))Array.isArray(n)?n.forEach(c=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function D1(t){const e={};return t.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[c,d]=n.split("=");e[decodeURIComponent(c)]=decodeURIComponent(d)}}),e}function O1(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}function oue(t,e){const r=new lue(t,e);return r.subscribe.bind(r)}class lue{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,n){let c;if(e===void 0&&r===void 0&&n===void 0)throw new Error("Missing Observer.");cue(e,["next","error","complete"])?c=e:c={next:e,error:r,complete:n},c.next===void 0&&(c.next=sR),c.error===void 0&&(c.error=sR),c.complete===void 0&&(c.complete=sR);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function cue(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function sR(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uue=1e3,due=2,hue=4*60*60*1e3,fue=.5;function R6(t,e=uue,r=due){const n=e*Math.pow(r,t),c=Math.round(fue*n*(Math.random()-.5)*2);return Math.min(hue,n+c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ai(t){return t&&t._delegate?t._delegate:t}class ld{constructor(e,r,n){this.name=e,this.instanceFactory=r,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pue{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const n=new Kce;if(this.instancesDeferred.set(r,n),this.isInitialized(r)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:r});c&&n.resolve(c)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(d){if(c)return null;throw d}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(gue(e))try{this.getOrInitializeService({instanceIdentifier:A_})}catch{}for(const[r,n]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);try{const d=this.getOrInitializeService({instanceIdentifier:c});n.resolve(d)}catch{}}}}clearInstance(e=A_){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=A_){return this.instances.has(e)}getOptions(e=A_){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:n,options:r});for(const[d,p]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(d);n===a&&p.resolve(c)}return c}onInit(e,r){var n;const c=this.normalizeInstanceIdentifier(r),d=(n=this.onInitCallbacks.get(c))!==null&&n!==void 0?n:new Set;d.add(e),this.onInitCallbacks.set(c,d);const p=this.instances.get(c);return p&&e(p,c),()=>{d.delete(e)}}invokeOnInitCallbacks(e,r){const n=this.onInitCallbacks.get(r);if(n)for(const c of n)try{c(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:mue(e),options:r}),this.instances.set(e,n),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=A_){return this.component?this.component.multipleInstances?e:A_:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mue(t){return t===A_?void 0:t}function gue(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ue{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new pue(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wi;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(wi||(wi={}));const yue={debug:wi.DEBUG,verbose:wi.VERBOSE,info:wi.INFO,warn:wi.WARN,error:wi.ERROR,silent:wi.SILENT},xue=wi.INFO,vue={[wi.DEBUG]:"log",[wi.VERBOSE]:"log",[wi.INFO]:"info",[wi.WARN]:"warn",[wi.ERROR]:"error"},wue=(t,e,...r)=>{if(e<t.logLevel)return;const n=new Date().toISOString(),c=vue[e];if(c)console[c](`[${n}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class dC{constructor(e){this.name=e,this._logLevel=xue,this._logHandler=wue,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in wi))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?yue[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,wi.DEBUG,...e),this._logHandler(this,wi.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,wi.VERBOSE,...e),this._logHandler(this,wi.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,wi.INFO,...e),this._logHandler(this,wi.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,wi.WARN,...e),this._logHandler(this,wi.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,wi.ERROR,...e),this._logHandler(this,wi.ERROR,...e)}}const bue=(t,e)=>e.some(r=>t instanceof r);let M6,D6;function Sue(){return M6||(M6=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Eue(){return D6||(D6=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Z7=new WeakMap,cD=new WeakMap,K7=new WeakMap,iR=new WeakMap,jL=new WeakMap;function Tue(t){const e=new Promise((r,n)=>{const c=()=>{t.removeEventListener("success",d),t.removeEventListener("error",p)},d=()=>{r(ig(t.result)),c()},p=()=>{n(t.error),c()};t.addEventListener("success",d),t.addEventListener("error",p)});return e.then(r=>{r instanceof IDBCursor&&Z7.set(r,t)}).catch(()=>{}),jL.set(e,t),e}function jue(t){if(cD.has(t))return;const e=new Promise((r,n)=>{const c=()=>{t.removeEventListener("complete",d),t.removeEventListener("error",p),t.removeEventListener("abort",p)},d=()=>{r(),c()},p=()=>{n(t.error||new DOMException("AbortError","AbortError")),c()};t.addEventListener("complete",d),t.addEventListener("error",p),t.addEventListener("abort",p)});cD.set(t,e)}let uD={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return cD.get(t);if(e==="objectStoreNames")return t.objectStoreNames||K7.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ig(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Nue(t){uD=t(uD)}function Iue(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const n=t.call(aR(this),e,...r);return K7.set(n,e.sort?e.sort():[e]),ig(n)}:Eue().includes(t)?function(...e){return t.apply(aR(this),e),ig(Z7.get(this))}:function(...e){return ig(t.apply(aR(this),e))}}function Cue(t){return typeof t=="function"?Iue(t):(t instanceof IDBTransaction&&jue(t),bue(t,Sue())?new Proxy(t,uD):t)}function ig(t){if(t instanceof IDBRequest)return Tue(t);if(iR.has(t))return iR.get(t);const e=Cue(t);return e!==t&&(iR.set(t,e),jL.set(e,t)),e}const aR=t=>jL.get(t);function X7(t,e,{blocked:r,upgrade:n,blocking:c,terminated:d}={}){const p=indexedDB.open(t,e),a=ig(p);return n&&p.addEventListener("upgradeneeded",w=>{n(ig(p.result),w.oldVersion,w.newVersion,ig(p.transaction),w)}),r&&p.addEventListener("blocked",w=>r(w.oldVersion,w.newVersion,w)),a.then(w=>{d&&w.addEventListener("close",()=>d()),c&&w.addEventListener("versionchange",E=>c(E.oldVersion,E.newVersion,E))}).catch(()=>{}),a}const Aue=["get","getKey","getAll","getAllKeys","count"],Pue=["put","add","delete","clear"],oR=new Map;function O6(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(oR.get(e))return oR.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,c=Pue.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(c||Aue.includes(r)))return;const d=async function(p,...a){const w=this.transaction(p,c?"readwrite":"readonly");let E=w.store;return n&&(E=E.index(a.shift())),(await Promise.all([E[r](...a),c&&w.done]))[0]};return oR.set(e,d),d}Nue(t=>({...t,get:(e,r,n)=>O6(e,r)||t.get(e,r,n),has:(e,r)=>!!O6(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kue{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(Rue(r)){const n=r.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(r=>r).join(" ")}}function Rue(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const dD="@firebase/app",L6="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gp=new dC("@firebase/app"),Mue="@firebase/app-compat",Due="@firebase/analytics-compat",Oue="@firebase/analytics",Lue="@firebase/app-check-compat",Fue="@firebase/app-check",zue="@firebase/auth",Bue="@firebase/auth-compat",Vue="@firebase/database",Uue="@firebase/data-connect",$ue="@firebase/database-compat",que="@firebase/functions",Gue="@firebase/functions-compat",Hue="@firebase/installations",Wue="@firebase/installations-compat",Zue="@firebase/messaging",Kue="@firebase/messaging-compat",Xue="@firebase/performance",Yue="@firebase/performance-compat",Jue="@firebase/remote-config",Que="@firebase/remote-config-compat",ede="@firebase/storage",tde="@firebase/storage-compat",rde="@firebase/firestore",nde="@firebase/vertexai-preview",sde="@firebase/firestore-compat",ide="firebase",ade="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hD="[DEFAULT]",ode={[dD]:"fire-core",[Mue]:"fire-core-compat",[Oue]:"fire-analytics",[Due]:"fire-analytics-compat",[Fue]:"fire-app-check",[Lue]:"fire-app-check-compat",[zue]:"fire-auth",[Bue]:"fire-auth-compat",[Vue]:"fire-rtdb",[Uue]:"fire-data-connect",[$ue]:"fire-rtdb-compat",[que]:"fire-fn",[Gue]:"fire-fn-compat",[Hue]:"fire-iid",[Wue]:"fire-iid-compat",[Zue]:"fire-fcm",[Kue]:"fire-fcm-compat",[Xue]:"fire-perf",[Yue]:"fire-perf-compat",[Jue]:"fire-rc",[Que]:"fire-rc-compat",[ede]:"fire-gcs",[tde]:"fire-gcs-compat",[rde]:"fire-fst",[sde]:"fire-fst-compat",[nde]:"fire-vertex","fire-js":"fire-js",[ide]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VN=new Map,lde=new Map,fD=new Map;function F6(t,e){try{t.container.addComponent(e)}catch(r){gp.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function th(t){const e=t.name;if(fD.has(e))return gp.debug(`There were multiple attempts to register component ${e}.`),!1;fD.set(e,t);for(const r of VN.values())F6(r,t);for(const r of lde.values())F6(r,t);return!0}function Ig(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function td(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cde={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ag=new ky("app","Firebase",cde);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ude{constructor(e,r,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ld("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ag.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ry=ade;function Y7(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const n=Object.assign({name:hD,automaticDataCollectionEnabled:!1},e),c=n.name;if(typeof c!="string"||!c)throw ag.create("bad-app-name",{appName:String(c)});if(r||(r=U7()),!r)throw ag.create("no-options");const d=VN.get(c);if(d){if(RS(r,d.options)&&RS(n,d.config))return d;throw ag.create("duplicate-app",{appName:c})}const p=new _ue(c);for(const w of fD.values())p.addComponent(w);const a=new ude(r,n,p);return VN.set(c,a),a}function hC(t=hD){const e=VN.get(t);if(!e&&t===hD&&U7())return Y7();if(!e)throw ag.create("no-app",{appName:t});return e}function nu(t,e,r){var n;let c=(n=ode[t])!==null&&n!==void 0?n:t;r&&(c+=`-${r}`);const d=c.match(/\s|\//),p=e.match(/\s|\//);if(d||p){const a=[`Unable to register library "${c}" with version "${e}":`];d&&a.push(`library name "${c}" contains illegal characters (whitespace or "/")`),d&&p&&a.push("and"),p&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),gp.warn(a.join(" "));return}th(new ld(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dde="firebase-heartbeat-database",hde=1,MS="firebase-heartbeat-store";let lR=null;function J7(){return lR||(lR=X7(dde,hde,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(MS)}catch(r){console.warn(r)}}}}).catch(t=>{throw ag.create("idb-open",{originalErrorMessage:t.message})})),lR}async function fde(t){try{const r=(await J7()).transaction(MS),n=await r.objectStore(MS).get(Q7(t));return await r.done,n}catch(e){if(e instanceof dd)gp.warn(e.message);else{const r=ag.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});gp.warn(r.message)}}}async function z6(t,e){try{const n=(await J7()).transaction(MS,"readwrite");await n.objectStore(MS).put(e,Q7(t)),await n.done}catch(r){if(r instanceof dd)gp.warn(r.message);else{const n=ag.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});gp.warn(n.message)}}}function Q7(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pde=1024,mde=30*24*60*60*1e3;class gde{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new yde(r),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,r;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=B6();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(p=>p.date===d)?void 0:(this._heartbeatsCache.heartbeats.push({date:d,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(p=>{const a=new Date(p.date).valueOf();return Date.now()-a<=mde}),this._storage.overwrite(this._heartbeatsCache))}catch(n){gp.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=B6(),{heartbeatsToSend:n,unsentEntries:c}=_de(this._heartbeatsCache.heartbeats),d=BN(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=r,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(r){return gp.warn(r),""}}}function B6(){return new Date().toISOString().substring(0,10)}function _de(t,e=pde){const r=[];let n=t.slice();for(const c of t){const d=r.find(p=>p.agent===c.agent);if(d){if(d.dates.push(c.date),V6(r)>e){d.dates.pop();break}}else if(r.push({agent:c.agent,dates:[c.date]}),V6(r)>e){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class yde{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return H7()?W7().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await fde(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return z6(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return z6(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function V6(t){return BN(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xde(t){th(new ld("platform-logger",e=>new kue(e),"PRIVATE")),th(new ld("heartbeat",e=>new gde(e),"PRIVATE")),nu(dD,L6,t),nu(dD,L6,"esm2017"),nu("fire-js","")}xde("");var qh=function(){return qh=Object.assign||function(e){for(var r,n=1,c=arguments.length;n<c;n++){r=arguments[n];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(e[d]=r[d])}return e},qh.apply(this,arguments)};function bE(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(t);c<n.length;c++)e.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(t,n[c])&&(r[n[c]]=t[n[c]]);return r}function vde(t,e,r){if(r||arguments.length===2)for(var n=0,c=e.length,d;n<c;n++)(d||!(n in e))&&(d||(d=Array.prototype.slice.call(e,0,n)),d[n]=e[n]);return t.concat(d||Array.prototype.slice.call(e))}function eG(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const wde=eG,tG=new ky("auth","Firebase",eG());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UN=new dC("@firebase/auth");function bde(t,...e){UN.logLevel<=wi.WARN&&UN.warn(`Auth (${Ry}): ${t}`,...e)}function Wj(t,...e){UN.logLevel<=wi.ERROR&&UN.error(`Auth (${Ry}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ou(t,...e){throw IL(t,...e)}function Qh(t,...e){return IL(t,...e)}function NL(t,e,r){const n=Object.assign(Object.assign({},wde()),{[e]:r});return new ky("auth","Firebase",n).create(e,{appName:t.name})}function Xd(t){return NL(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Sde(t,e,r){const n=r;if(!(e instanceof n))throw n.name!==e.constructor.name&&Ou(t,"argument-error"),NL(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function IL(t,...e){if(typeof t!="string"){const r=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t._errorFactory.create(r,...n)}return tG.create(t,...e)}function Vn(t,e,...r){if(!t)throw IL(e,...r)}function rp(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Wj(e),new Error(e)}function _p(t,e){t||rp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pD(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Ede(){return U6()==="http:"||U6()==="https:"}function U6(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tde(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ede()||G7()||"connection"in navigator)?navigator.onLine:!0}function jde(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SE{constructor(e,r){this.shortDelay=e,this.longDelay=r,_p(r>e,"Short delay should be less than long delay!"),this.isMobile=Xce()||Qce()}get(){return Tde()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CL(t,e){_p(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rG{static initialize(e,r,n){this.fetchImpl=e,r&&(this.headersImpl=r),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;rp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;rp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;rp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nde={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ide=new SE(3e4,6e4);function ch(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function zu(t,e,r,n,c={}){return nG(t,c,async()=>{let d={},p={};n&&(e==="GET"?p=n:d={body:JSON.stringify(n)});const a=wE(Object.assign({key:t.config.apiKey},p)).slice(1),w=await t._getAdditionalHeaders();w["Content-Type"]="application/json",t.languageCode&&(w["X-Firebase-Locale"]=t.languageCode);const E=Object.assign({method:e,headers:w},d);return Jce()||(E.referrerPolicy="no-referrer"),rG.fetch()(sG(t,t.config.apiHost,r,a),E)})}async function nG(t,e,r){t._canInitEmulator=!1;const n=Object.assign(Object.assign({},Nde),e);try{const c=new Ade(t),d=await Promise.race([r(),c.promise]);c.clearNetworkTimeout();const p=await d.json();if("needConfirmation"in p)throw lj(t,"account-exists-with-different-credential",p);if(d.ok&&!("errorMessage"in p))return p;{const a=d.ok?p.errorMessage:p.error.message,[w,E]=a.split(" : ");if(w==="FEDERATED_USER_ID_ALREADY_LINKED")throw lj(t,"credential-already-in-use",p);if(w==="EMAIL_EXISTS")throw lj(t,"email-already-in-use",p);if(w==="USER_DISABLED")throw lj(t,"user-disabled",p);const C=n[w]||w.toLowerCase().replace(/[_\s]+/g,"-");if(E)throw NL(t,C,E);Ou(t,C)}}catch(c){if(c instanceof dd)throw c;Ou(t,"network-request-failed",{message:String(c)})}}async function EE(t,e,r,n,c={}){const d=await zu(t,e,r,n,c);return"mfaPendingCredential"in d&&Ou(t,"multi-factor-auth-required",{_serverResponse:d}),d}function sG(t,e,r,n){const c=`${e}${r}?${n}`;return t.config.emulator?CL(t.config,c):`${t.config.apiScheme}://${c}`}function Cde(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Ade{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,n)=>{this.timer=setTimeout(()=>n(Qh(this.auth,"network-request-failed")),Ide.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function lj(t,e,r){const n={appName:t.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const c=Qh(t,e,n);return c.customData._tokenResponse=r,c}function $6(t){return t!==void 0&&t.enterprise!==void 0}class Pde{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===e)return Cde(r.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function kde(t,e){return zu(t,"GET","/v2/recaptchaConfig",ch(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rde(t,e){return zu(t,"POST","/v1/accounts:delete",e)}async function iG(t,e){return zu(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rS(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Mde(t,e=!1){const r=ai(t),n=await r.getIdToken(e),c=AL(n);Vn(c&&c.exp&&c.auth_time&&c.iat,r.auth,"internal-error");const d=typeof c.firebase=="object"?c.firebase:void 0,p=d==null?void 0:d.sign_in_provider;return{claims:c,token:n,authTime:rS(cR(c.auth_time)),issuedAtTime:rS(cR(c.iat)),expirationTime:rS(cR(c.exp)),signInProvider:p||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function cR(t){return Number(t)*1e3}function AL(t){const[e,r,n]=t.split(".");if(e===void 0||r===void 0||n===void 0)return Wj("JWT malformed, contained fewer than 3 sections"),null;try{const c=z7(r);return c?JSON.parse(c):(Wj("Failed to decode base64 JWT payload"),null)}catch(c){return Wj("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function q6(t){const e=AL(t);return Vn(e,"internal-error"),Vn(typeof e.exp<"u","internal-error"),Vn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sy(t,e,r=!1){if(r)return e;try{return await e}catch(n){throw n instanceof dd&&Dde(n)&&t.auth.currentUser===t&&await t.auth.signOut(),n}}function Dde({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ode{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const c=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=rS(this.lastLoginAt),this.creationTime=rS(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $N(t){var e;const r=t.auth,n=await t.getIdToken(),c=await sy(t,iG(r,{idToken:n}));Vn(c==null?void 0:c.users.length,r,"internal-error");const d=c.users[0];t._notifyReloadListener(d);const p=!((e=d.providerUserInfo)===null||e===void 0)&&e.length?aG(d.providerUserInfo):[],a=Lde(t.providerData,p),w=t.isAnonymous,E=!(t.email&&d.passwordHash)&&!(a!=null&&a.length),C=w?E:!1,P={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:a,metadata:new mD(d.createdAt,d.lastLoginAt),isAnonymous:C};Object.assign(t,P)}async function gD(t){const e=ai(t);await $N(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Lde(t,e){return[...t.filter(n=>!e.some(c=>c.providerId===n.providerId)),...e]}function aG(t){return t.map(e=>{var{providerId:r}=e,n=bE(e,["providerId"]);return{providerId:r,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fde(t,e){const r=await nG(t,{},async()=>{const n=wE({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:d}=t.config,p=sG(t,c,"/v1/token",`key=${d}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",rG.fetch()(p,{method:"POST",headers:a,body:n})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function zde(t,e){return zu(t,"POST","/v2/accounts:revokeToken",ch(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Vn(e.idToken,"internal-error"),Vn(typeof e.idToken<"u","internal-error"),Vn(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):q6(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){Vn(e.length!==0,"internal-error");const r=q6(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(Vn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:n,refreshToken:c,expiresIn:d}=await Fde(e,r);this.updateTokensAndExpiration(n,c,Number(d))}updateTokensAndExpiration(e,r,n){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,r){const{refreshToken:n,accessToken:c,expirationTime:d}=r,p=new Qv;return n&&(Vn(typeof n=="string","internal-error",{appName:e}),p.refreshToken=n),c&&(Vn(typeof c=="string","internal-error",{appName:e}),p.accessToken=c),d&&(Vn(typeof d=="number","internal-error",{appName:e}),p.expirationTime=d),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Qv,this.toJSON())}_performRefresh(){return rp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Em(t,e){Vn(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class np{constructor(e){var{uid:r,auth:n,stsTokenManager:c}=e,d=bE(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ode(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=n,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new mD(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const r=await sy(this,this.stsTokenManager.getToken(this.auth,e));return Vn(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return Mde(this,e)}reload(){return gD(this)}_assign(e){this!==e&&(Vn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new np(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){Vn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),r&&await $N(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(td(this.auth.app))return Promise.reject(Xd(this.auth));const e=await this.getIdToken();return await sy(this,Rde(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var n,c,d,p,a,w,E,C;const P=(n=r.displayName)!==null&&n!==void 0?n:void 0,R=(c=r.email)!==null&&c!==void 0?c:void 0,B=(d=r.phoneNumber)!==null&&d!==void 0?d:void 0,V=(p=r.photoURL)!==null&&p!==void 0?p:void 0,W=(a=r.tenantId)!==null&&a!==void 0?a:void 0,K=(w=r._redirectEventId)!==null&&w!==void 0?w:void 0,Z=(E=r.createdAt)!==null&&E!==void 0?E:void 0,$=(C=r.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:X,emailVerified:Q,isAnonymous:re,providerData:ve,stsTokenManager:pe}=r;Vn(X&&pe,e,"internal-error");const ue=Qv.fromJSON(this.name,pe);Vn(typeof X=="string",e,"internal-error"),Em(P,e.name),Em(R,e.name),Vn(typeof Q=="boolean",e,"internal-error"),Vn(typeof re=="boolean",e,"internal-error"),Em(B,e.name),Em(V,e.name),Em(W,e.name),Em(K,e.name),Em(Z,e.name),Em($,e.name);const ge=new np({uid:X,auth:e,email:R,emailVerified:Q,displayName:P,isAnonymous:re,photoURL:V,phoneNumber:B,tenantId:W,stsTokenManager:ue,createdAt:Z,lastLoginAt:$});return ve&&Array.isArray(ve)&&(ge.providerData=ve.map(ce=>Object.assign({},ce))),K&&(ge._redirectEventId=K),ge}static async _fromIdTokenResponse(e,r,n=!1){const c=new Qv;c.updateFromServerResponse(r);const d=new np({uid:r.localId,auth:e,stsTokenManager:c,isAnonymous:n});return await $N(d),d}static async _fromGetAccountInfoResponse(e,r,n){const c=r.users[0];Vn(c.localId!==void 0,"internal-error");const d=c.providerUserInfo!==void 0?aG(c.providerUserInfo):[],p=!(c.email&&c.passwordHash)&&!(d!=null&&d.length),a=new Qv;a.updateFromIdToken(n);const w=new np({uid:c.localId,auth:e,stsTokenManager:a,isAnonymous:p}),E={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:d,metadata:new mD(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!(d!=null&&d.length)};return Object.assign(w,E),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G6=new Map;function sp(t){_p(t instanceof Function,"Expected a class definition");let e=G6.get(t);return e?(_p(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,G6.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oG{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}oG.type="NONE";const H6=oG;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zj(t,e,r){return`firebase:${t}:${e}:${r}`}class e0{constructor(e,r,n){this.persistence=e,this.auth=r,this.userKey=n;const{config:c,name:d}=this.auth;this.fullUserKey=Zj(this.userKey,c.apiKey,d),this.fullPersistenceKey=Zj("persistence",c.apiKey,d),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?np._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,n="authUser"){if(!r.length)return new e0(sp(H6),e,n);const c=(await Promise.all(r.map(async E=>{if(await E._isAvailable())return E}))).filter(E=>E);let d=c[0]||sp(H6);const p=Zj(n,e.config.apiKey,e.name);let a=null;for(const E of r)try{const C=await E._get(p);if(C){const P=np._fromJSON(e,C);E!==d&&(a=P),d=E;break}}catch{}const w=c.filter(E=>E._shouldAllowMigration);return!d._shouldAllowMigration||!w.length?new e0(d,e,n):(d=w[0],a&&await d._set(p,a.toJSON()),await Promise.all(r.map(async E=>{if(E!==d)try{await E._remove(p)}catch{}})),new e0(d,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W6(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(dG(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(lG(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fG(e))return"Blackberry";if(pG(e))return"Webos";if(cG(e))return"Safari";if((e.includes("chrome/")||uG(e))&&!e.includes("edge/"))return"Chrome";if(hG(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(r);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function lG(t=Zl()){return/firefox\//i.test(t)}function cG(t=Zl()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uG(t=Zl()){return/crios\//i.test(t)}function dG(t=Zl()){return/iemobile/i.test(t)}function hG(t=Zl()){return/android/i.test(t)}function fG(t=Zl()){return/blackberry/i.test(t)}function pG(t=Zl()){return/webos/i.test(t)}function PL(t=Zl()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Bde(t=Zl()){var e;return PL(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Vde(){return eue()&&document.documentMode===10}function mG(t=Zl()){return PL(t)||hG(t)||pG(t)||fG(t)||/windows phone/i.test(t)||dG(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gG(t,e=[]){let r;switch(t){case"Browser":r=W6(Zl());break;case"Worker":r=`${W6(Zl())}-${t}`;break;default:r=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${Ry}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ude{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const n=d=>new Promise((p,a)=>{try{const w=e(d);p(w)}catch(w){a(w)}});n.onAbort=r,this.queue.push(n);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const n of this.queue)await n(e),n.onAbort&&r.push(n.onAbort)}catch(n){r.reverse();for(const c of r)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $de(t,e={}){return zu(t,"GET","/v2/passwordPolicy",ch(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qde=6;class Gde{constructor(e){var r,n,c,d;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=p.minPasswordLength)!==null&&r!==void 0?r:qde,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(d=e.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,n,c,d,p,a;const w={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,w),this.validatePasswordCharacterOptions(e,w),w.isValid&&(w.isValid=(r=w.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),w.isValid&&(w.isValid=(n=w.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),w.isValid&&(w.isValid=(c=w.containsLowercaseLetter)!==null&&c!==void 0?c:!0),w.isValid&&(w.isValid=(d=w.containsUppercaseLetter)!==null&&d!==void 0?d:!0),w.isValid&&(w.isValid=(p=w.containsNumericCharacter)!==null&&p!==void 0?p:!0),w.isValid&&(w.isValid=(a=w.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),w}validatePasswordLengthOptions(e,r){const n=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;n&&(r.meetsMinPasswordLength=e.length>=n),c&&(r.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let n;for(let c=0;c<e.length;c++)n=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(r,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,r,n,c,d){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hde{constructor(e,r,n,c){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=n,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Z6(this),this.idTokenSubscription=new Z6(this),this.beforeStateQueue=new Ude(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tG,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=sp(r)),this._initializationPromise=this.queue(async()=>{var n,c;if(!this._deleted&&(this.persistenceManager=await e0.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await iG(this,{idToken:e}),n=await np._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(n)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(td(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let c=n,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,a=c==null?void 0:c._redirectEventId,w=await this.tryRedirectSignIn(e);(!p||p===a)&&(w!=null&&w.user)&&(c=w.user,d=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(c)}catch(p){c=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return Vn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await $N(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=jde()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(td(this.app))return Promise.reject(Xd(this));const r=e?ai(e):null;return r&&Vn(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&Vn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return td(this.app)?Promise.reject(Xd(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return td(this.app)?Promise.reject(Xd(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(sp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $de(this),r=new Gde(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ky("auth","Firebase",e())}onAuthStateChanged(e,r,n){return this.registerStateListener(this.authStateSubscription,e,r,n)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,n){return this.registerStateListener(this.idTokenSubscription,e,r,n)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(n.tenantId=this.tenantId),await zde(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const n=await this.getOrInitRedirectPersistenceManager(r);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&sp(e)||this._popupRedirectResolver;Vn(r,this,"argument-error"),this.redirectPersistenceManager=await e0.create(this,[sp(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,n;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,n,c){if(this._deleted)return()=>{};const d=typeof r=="function"?r:r.next.bind(r);let p=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Vn(a,this,"internal-error"),a.then(()=>{p||d(this.currentUser)}),typeof r=="function"){const w=e.addObserver(r,n,c);return()=>{p=!0,w()}}else{const w=e.addObserver(r);return()=>{p=!0,w()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Vn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=gG(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(r["X-Firebase-Client"]=n);const c=await this._getAppCheckToken();return c&&(r["X-Firebase-AppCheck"]=c),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&bde(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function pf(t){return ai(t)}class Z6{constructor(e){this.auth=e,this.observer=null,this.addObserver=oue(r=>this.observer=r)}get next(){return Vn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fC={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Wde(t){fC=t}function _G(t){return fC.loadJS(t)}function Zde(){return fC.recaptchaEnterpriseScript}function Kde(){return fC.gapiScript}function Xde(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const Yde="recaptcha-enterprise",Jde="NO_RECAPTCHA";class Qde{constructor(e){this.type=Yde,this.auth=pf(e)}async verify(e="verify",r=!1){async function n(d){if(!r){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(p,a)=>{kde(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(w=>{if(w.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const E=new Pde(w);return d.tenantId==null?d._agentRecaptchaConfig=E:d._tenantRecaptchaConfigs[d.tenantId]=E,p(E.siteKey)}}).catch(w=>{a(w)})})}function c(d,p,a){const w=window.grecaptcha;$6(w)?w.enterprise.ready(()=>{w.enterprise.execute(d,{action:e}).then(E=>{p(E)}).catch(()=>{p(Jde)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((d,p)=>{n(this.auth).then(a=>{if(!r&&$6(window.grecaptcha))c(a,d,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let w=Zde();w.length!==0&&(w+=a),_G(w).then(()=>{c(a,d,p)}).catch(E=>{p(E)})}}).catch(a=>{p(a)})})}}async function K6(t,e,r,n=!1){const c=new Qde(t);let d;try{d=await c.verify(r)}catch{d=await c.verify(r,!0)}const p=Object.assign({},e);return n?Object.assign(p,{captchaResp:d}):Object.assign(p,{captchaResponse:d}),Object.assign(p,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(p,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),p}async function _D(t,e,r,n){var c;if(!((c=t._getRecaptchaConfig())===null||c===void 0)&&c.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const d=await K6(t,e,r,r==="getOobCode");return n(t,d)}else return n(t,e).catch(async d=>{if(d.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const p=await K6(t,e,r,r==="getOobCode");return n(t,p)}else return Promise.reject(d)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ehe(t,e){const r=Ig(t,"auth");if(r.isInitialized()){const c=r.getImmediate(),d=r.getOptions();if(RS(d,e??{}))return c;Ou(c,"already-initialized")}return r.initialize({options:e})}function the(t,e){const r=(e==null?void 0:e.persistence)||[],n=(Array.isArray(r)?r:[r]).map(sp);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function rhe(t,e,r){const n=pf(t);Vn(n._canInitEmulator,n,"emulator-config-failed"),Vn(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const c=!1,d=yG(e),{host:p,port:a}=nhe(e),w=a===null?"":`:${a}`;n.config.emulator={url:`${d}//${p}${w}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:p,port:a,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:c})}),she()}function yG(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function nhe(t){const e=yG(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(n);if(c){const d=c[1];return{host:d,port:X6(n.substr(d.length+1))}}else{const[d,p]=n.split(":");return{host:d,port:X6(p)}}}function X6(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function she(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kL{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return rp("not implemented")}_getIdTokenResponse(e){return rp("not implemented")}_linkToIdToken(e,r){return rp("not implemented")}_getReauthenticationResolver(e){return rp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ihe(t,e){return zu(t,"POST","/v1/accounts:resetPassword",ch(t,e))}async function ahe(t,e){return zu(t,"POST","/v1/accounts:update",e)}async function ohe(t,e){return zu(t,"POST","/v1/accounts:signUp",e)}async function lhe(t,e){return zu(t,"POST","/v1/accounts:update",ch(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function che(t,e){return EE(t,"POST","/v1/accounts:signInWithPassword",ch(t,e))}async function uhe(t,e){return zu(t,"POST","/v1/accounts:sendOobCode",ch(t,e))}async function dhe(t,e){return uhe(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hhe(t,e){return EE(t,"POST","/v1/accounts:signInWithEmailLink",ch(t,e))}async function fhe(t,e){return EE(t,"POST","/v1/accounts:signInWithEmailLink",ch(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DS extends kL{constructor(e,r,n,c=null){super("password",n),this._email=e,this._password=r,this._tenantId=c}static _fromEmailAndPassword(e,r){return new DS(e,r,"password")}static _fromEmailAndCode(e,r,n=null){return new DS(e,r,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _D(e,r,"signInWithPassword",che);case"emailLink":return hhe(e,{email:this._email,oobCode:this._password});default:Ou(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":const n={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _D(e,n,"signUpPassword",ohe);case"emailLink":return fhe(e,{idToken:r,email:this._email,oobCode:this._password});default:Ou(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t0(t,e){return EE(t,"POST","/v1/accounts:signInWithIdp",ch(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const phe="http://localhost";class iy extends kL{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new iy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):Ou("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:c}=r,d=bE(r,["providerId","signInMethod"]);if(!n||!c)return null;const p=new iy(n,c);return p.idToken=d.idToken||void 0,p.accessToken=d.accessToken||void 0,p.secret=d.secret,p.nonce=d.nonce,p.pendingToken=d.pendingToken||null,p}_getIdTokenResponse(e){const r=this.buildRequest();return t0(e,r)}_linkToIdToken(e,r){const n=this.buildRequest();return n.idToken=r,t0(e,n)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,t0(e,r)}buildRequest(){const e={requestUri:phe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=wE(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mhe(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function ghe(t){const e=D1(O1(t)).link,r=e?D1(O1(e)).deep_link_id:null,n=D1(O1(t)).deep_link_id;return(n?D1(O1(n)).link:null)||n||r||e||t}class RL{constructor(e){var r,n,c,d,p,a;const w=D1(O1(e)),E=(r=w.apiKey)!==null&&r!==void 0?r:null,C=(n=w.oobCode)!==null&&n!==void 0?n:null,P=mhe((c=w.mode)!==null&&c!==void 0?c:null);Vn(E&&C&&P,"argument-error"),this.apiKey=E,this.operation=P,this.code=C,this.continueUrl=(d=w.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(p=w.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(a=w.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const r=ghe(e);try{return new RL(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(){this.providerId=cg.PROVIDER_ID}static credential(e,r){return DS._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const n=RL.parseLink(r);return Vn(n,"argument-error"),DS._fromEmailAndCode(e,n.code,n.tenantId)}}cg.PROVIDER_ID="password";cg.EMAIL_PASSWORD_SIGN_IN_METHOD="password";cg.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ML{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE extends ML{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm extends TE{constructor(){super("facebook.com")}static credential(e){return iy._fromParams({providerId:Fm.PROVIDER_ID,signInMethod:Fm.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fm.credentialFromTaggedObject(e)}static credentialFromError(e){return Fm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Fm.credential(e.oauthAccessToken)}catch{return null}}}Fm.FACEBOOK_SIGN_IN_METHOD="facebook.com";Fm.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf extends TE{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return iy._fromParams({providerId:Jf.PROVIDER_ID,signInMethod:Jf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return Jf.credentialFromTaggedObject(e)}static credentialFromError(e){return Jf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:n}=e;if(!r&&!n)return null;try{return Jf.credential(r,n)}catch{return null}}}Jf.GOOGLE_SIGN_IN_METHOD="google.com";Jf.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm extends TE{constructor(){super("github.com")}static credential(e){return iy._fromParams({providerId:zm.PROVIDER_ID,signInMethod:zm.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zm.credentialFromTaggedObject(e)}static credentialFromError(e){return zm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return zm.credential(e.oauthAccessToken)}catch{return null}}}zm.GITHUB_SIGN_IN_METHOD="github.com";zm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm extends TE{constructor(){super("twitter.com")}static credential(e,r){return iy._fromParams({providerId:Bm.PROVIDER_ID,signInMethod:Bm.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return Bm.credentialFromTaggedObject(e)}static credentialFromError(e){return Bm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:n}=e;if(!r||!n)return null;try{return Bm.credential(r,n)}catch{return null}}}Bm.TWITTER_SIGN_IN_METHOD="twitter.com";Bm.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _he(t,e){return EE(t,"POST","/v1/accounts:signUp",ch(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,n,c=!1){const d=await np._fromIdTokenResponse(e,n,c),p=Y6(n);return new ay({user:d,providerId:p,_tokenResponse:n,operationType:r})}static async _forOperation(e,r,n){await e._updateTokensIfNecessary(n,!0);const c=Y6(n);return new ay({user:e,providerId:c,_tokenResponse:n,operationType:r})}}function Y6(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qN extends dd{constructor(e,r,n,c){var d;super(r.code,r.message),this.operationType=n,this.user=c,Object.setPrototypeOf(this,qN.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:r.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,r,n,c){return new qN(e,r,n,c)}}function xG(t,e,r,n){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?qN._fromErrorAndOperation(t,d,e,n):d})}async function yhe(t,e,r=!1){const n=await sy(t,e._linkToIdToken(t.auth,await t.getIdToken()),r);return ay._forOperation(t,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vG(t,e,r=!1){const{auth:n}=t;if(td(n.app))return Promise.reject(Xd(n));const c="reauthenticate";try{const d=await sy(t,xG(n,c,e,t),r);Vn(d.idToken,n,"internal-error");const p=AL(d.idToken);Vn(p,n,"internal-error");const{sub:a}=p;return Vn(t.uid===a,n,"user-mismatch"),ay._forOperation(t,c,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Ou(n,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wG(t,e,r=!1){if(td(t.app))return Promise.reject(Xd(t));const n="signIn",c=await xG(t,n,e),d=await ay._fromIdTokenResponse(t,n,c);return r||await t._updateCurrentUser(d.user),d}async function xhe(t,e){return wG(pf(t),e)}async function J6(t,e){return vG(ai(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DL{constructor(e,r){this.factorId=e,this.uid=r.mfaEnrollmentId,this.enrollmentTime=new Date(r.enrolledAt).toUTCString(),this.displayName=r.displayName}static _fromServerResponse(e,r){return"phoneInfo"in r?OL._fromServerResponse(e,r):"totpInfo"in r?LL._fromServerResponse(e,r):Ou(e,"internal-error")}}class OL extends DL{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,r){return new OL(r)}}class LL extends DL{constructor(e){super("totp",e)}static _fromServerResponse(e,r){return new LL(r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vhe(t,e,r){var n;Vn(((n=r.url)===null||n===void 0?void 0:n.length)>0,t,"invalid-continue-uri"),Vn(typeof r.dynamicLinkDomain>"u"||r.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=r.url,e.dynamicLinkDomain=r.dynamicLinkDomain,e.canHandleCodeInApp=r.handleCodeInApp,r.iOS&&(Vn(r.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=r.iOS.bundleId),r.android&&(Vn(r.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=r.android.installApp,e.androidMinimumVersionCode=r.android.minimumVersion,e.androidPackageName=r.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bG(t){const e=pf(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function whe(t,e){await lhe(ai(t),{oobCode:e})}async function bhe(t,e){const r=ai(t),n=await ihe(r,{oobCode:e}),c=n.requestType;switch(Vn(c,r,"internal-error"),c){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Vn(n.newEmail,r,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Vn(n.mfaInfo,r,"internal-error");default:Vn(n.email,r,"internal-error")}let d=null;return n.mfaInfo&&(d=DL._fromServerResponse(pf(r),n.mfaInfo)),{data:{email:(n.requestType==="VERIFY_AND_CHANGE_EMAIL"?n.newEmail:n.email)||null,previousEmail:(n.requestType==="VERIFY_AND_CHANGE_EMAIL"?n.email:n.newEmail)||null,multiFactorInfo:d},operation:c}}async function SG(t,e,r){if(td(t.app))return Promise.reject(Xd(t));const n=pf(t),p=await _D(n,{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_he).catch(w=>{throw w.code==="auth/password-does-not-meet-requirements"&&bG(t),w}),a=await ay._fromIdTokenResponse(n,"signIn",p);return await n._updateCurrentUser(a.user),a}function EG(t,e,r){return td(t.app)?Promise.reject(Xd(t)):xhe(ai(t),cg.credential(e,r)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&bG(t),n})}async function Q6(t,e){const r=ai(t),c={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()};e&&vhe(r.auth,c,e);const{email:d}=await dhe(r.auth,c);d!==t.email&&await t.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function She(t,e){return zu(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OS(t,{displayName:e,photoURL:r}){if(e===void 0&&r===void 0)return;const n=ai(t),d={idToken:await n.getIdToken(),displayName:e,photoUrl:r,returnSecureToken:!0},p=await sy(n,She(n.auth,d));n.displayName=p.displayName||null,n.photoURL=p.photoUrl||null;const a=n.providerData.find(({providerId:w})=>w==="password");a&&(a.displayName=n.displayName,a.photoURL=n.photoURL),await n._updateTokensIfNecessary(p)}function Ehe(t,e){const r=ai(t);return td(r.auth.app)?Promise.reject(Xd(r.auth)):TG(r,e,null)}function The(t,e){return TG(ai(t),null,e)}async function TG(t,e,r){const{auth:n}=t,d={idToken:await t.getIdToken(),returnSecureToken:!0};e&&(d.email=e),r&&(d.password=r);const p=await sy(t,ahe(n,d));await t._updateTokensIfNecessary(p,!0)}function jhe(t,e,r,n){return ai(t).onIdTokenChanged(e,r,n)}function Nhe(t,e,r){return ai(t).beforeAuthStateChanged(e,r)}function Ihe(t,e,r,n){return ai(t).onAuthStateChanged(e,r,n)}function Che(t){return ai(t).signOut()}async function Ahe(t){return ai(t).delete()}const GN="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jG{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(GN,"1"),this.storage.removeItem(GN),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Phe=1e3,khe=10;class NG extends jG{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=mG(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const n=this.storage.getItem(r),c=this.localCache[r];n!==c&&e(r,c,n)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((p,a,w)=>{this.notifyListeners(p,w)});return}const n=e.key;r?this.detachListener():this.stopPolling();const c=()=>{const p=this.storage.getItem(n);!r&&this.localCache[n]===p||this.notifyListeners(n,p)},d=this.storage.getItem(n);Vde()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,khe):c()}notifyListeners(e,r){this.localCache[e]=r;const n=this.listeners[e];if(n)for(const c of Array.from(n))c(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:n}),!0)})},Phe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}NG.type="LOCAL";const Rhe=NG;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IG extends jG{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}IG.type="SESSION";const CG=IG;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mhe(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pC{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(c=>c.isListeningto(e));if(r)return r;const n=new pC(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:n,eventType:c,data:d}=r.data,p=this.handlersMap[c];if(!(p!=null&&p.size))return;r.ports[0].postMessage({status:"ack",eventId:n,eventType:c});const a=Array.from(p).map(async E=>E(r.origin,d)),w=await Mhe(a);r.ports[0].postMessage({status:"done",eventId:n,eventType:c,response:w})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}pC.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FL(t="",e=10){let r="";for(let n=0;n<e;n++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dhe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,n=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let d,p;return new Promise((a,w)=>{const E=FL("",20);c.port1.start();const C=setTimeout(()=>{w(new Error("unsupported_event"))},n);p={messageChannel:c,onMessage(P){const R=P;if(R.data.eventId===E)switch(R.data.status){case"ack":clearTimeout(C),d=setTimeout(()=>{w(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),a(R.data.response);break;default:clearTimeout(C),clearTimeout(d),w(new Error("invalid_response"));break}}},this.handlers.add(p),c.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:E,data:r},[c.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(){return window}function Ohe(t){ef().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AG(){return typeof ef().WorkerGlobalScope<"u"&&typeof ef().importScripts=="function"}async function Lhe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Fhe(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function zhe(){return AG()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PG="firebaseLocalStorageDb",Bhe=1,HN="firebaseLocalStorage",kG="fbase_key";class jE{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function mC(t,e){return t.transaction([HN],e?"readwrite":"readonly").objectStore(HN)}function Vhe(){const t=indexedDB.deleteDatabase(PG);return new jE(t).toPromise()}function yD(){const t=indexedDB.open(PG,Bhe);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const n=t.result;try{n.createObjectStore(HN,{keyPath:kG})}catch(c){r(c)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(HN)?e(n):(n.close(),await Vhe(),e(await yD()))})})}async function eU(t,e,r){const n=mC(t,!0).put({[kG]:e,value:r});return new jE(n).toPromise()}async function Uhe(t,e){const r=mC(t,!1).get(e),n=await new jE(r).toPromise();return n===void 0?null:n.value}function tU(t,e){const r=mC(t,!0).delete(e);return new jE(r).toPromise()}const $he=800,qhe=3;class RG{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await yD(),this.db)}async _withRetries(e){let r=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(r++>qhe)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return AG()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=pC._getInstance(zhe()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await Lhe(),!this.activeServiceWorker)return;this.sender=new Dhe(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((r=n[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Fhe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await yD();return await eU(e,GN,"1"),await tU(e,GN),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(n=>eU(n,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(n=>Uhe(n,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>tU(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const d=mC(c,!1).getAll();return new jE(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],n=new Set;if(e.length!==0)for(const{fbase_key:c,value:d}of e)n.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(d)&&(this.notifyListeners(c,d),r.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!n.has(c)&&(this.notifyListeners(c,null),r.push(c));return r}notifyListeners(e,r){this.localCache[e]=r;const n=this.listeners[e];if(n)for(const c of Array.from(n))c(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),$he)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}RG.type="LOCAL";const Ghe=RG;new SE(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MG(t,e){return e?sp(e):(Vn(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zL extends kL{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return t0(e,this._buildIdpRequest())}_linkToIdToken(e,r){return t0(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return t0(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Hhe(t){return wG(t.auth,new zL(t),t.bypassAuthState)}function Whe(t){const{auth:e,user:r}=t;return Vn(r,e,"internal-error"),vG(r,new zL(t),t.bypassAuthState)}async function Zhe(t){const{auth:e,user:r}=t;return Vn(r,e,"internal-error"),yhe(r,new zL(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DG{constructor(e,r,n,c,d=!1){this.auth=e,this.resolver=n,this.user=c,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:n,postBody:c,tenantId:d,error:p,type:a}=e;if(p){this.reject(p);return}const w={auth:this.auth,requestUri:r,sessionId:n,tenantId:d||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(w))}catch(E){this.reject(E)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Hhe;case"linkViaPopup":case"linkViaRedirect":return Zhe;case"reauthViaPopup":case"reauthViaRedirect":return Whe;default:Ou(this.auth,"internal-error")}}resolve(e){_p(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_p(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Khe=new SE(2e3,1e4);class Uv extends DG{constructor(e,r,n,c,d){super(e,r,c,d),this.provider=n,this.authWindow=null,this.pollId=null,Uv.currentPopupAction&&Uv.currentPopupAction.cancel(),Uv.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Vn(e,this.auth,"internal-error"),e}async onExecution(){_p(this.filter.length===1,"Popup operations only handle one event");const e=FL();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Qh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Qh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Uv.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,n;if(!((n=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Khe.get())};e()}}Uv.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xhe="pendingRedirect",Kj=new Map;class Yhe extends DG{constructor(e,r,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,n),this.eventId=null}async execute(){let e=Kj.get(this.auth._key());if(!e){try{const n=await Jhe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(r){e=()=>Promise.reject(r)}Kj.set(this.auth._key(),e)}return this.bypassAuthState||Kj.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Jhe(t,e){const r=LG(e),n=OG(t);if(!await n._isAvailable())return!1;const c=await n._get(r)==="true";return await n._remove(r),c}async function Qhe(t,e){return OG(t)._set(LG(e),"true")}function efe(t,e){Kj.set(t._key(),e)}function OG(t){return sp(t._redirectPersistence)}function LG(t){return Zj(Xhe,t.config.apiKey,t.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tfe(t,e,r){return rfe(t,e,r)}async function rfe(t,e,r){if(td(t.app))return Promise.reject(Xd(t));const n=pf(t);Sde(t,e,ML),await n._initializationPromise;const c=MG(n,r);return await Qhe(c,n),c._openRedirect(n,e,"signInViaRedirect")}async function nfe(t,e){return await pf(t)._initializationPromise,FG(t,e,!1)}async function FG(t,e,r=!1){if(td(t.app))return Promise.reject(Xd(t));const n=pf(t),c=MG(n,e),p=await new Yhe(n,c,r).execute();return p&&!r&&(delete p.user._redirectEventId,await n._persistUserIfCurrent(p.user),await n._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sfe=10*60*1e3;class ife{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(r=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!afe(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var n;if(e.error&&!zG(e)){const c=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";r.onError(Qh(this.auth,c))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const n=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=sfe&&this.cachedEventUids.clear(),this.cachedEventUids.has(rU(e))}saveEventToCache(e){this.cachedEventUids.add(rU(e)),this.lastProcessedEventTime=Date.now()}}function rU(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function zG({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function afe(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return zG(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ofe(t,e={}){return zu(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lfe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cfe=/^https?/;async function ufe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await ofe(t);for(const r of e)try{if(dfe(r))return}catch{}Ou(t,"unauthorized-domain")}function dfe(t){const e=pD(),{protocol:r,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const p=new URL(t);return p.hostname===""&&n===""?r==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&p.hostname===n}if(!cfe.test(r))return!1;if(lfe.test(t))return n===t;const c=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hfe=new SE(3e4,6e4);function nU(){const t=ef().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let r=0;r<t.CP.length;r++)t.CP[r]=null}}function ffe(t){return new Promise((e,r)=>{var n,c,d;function p(){nU(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{nU(),r(Qh(t,"network-request-failed"))},timeout:hfe.get()})}if(!((c=(n=ef().gapi)===null||n===void 0?void 0:n.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((d=ef().gapi)===null||d===void 0)&&d.load)p();else{const a=Xde("iframefcb");return ef()[a]=()=>{gapi.load?p():r(Qh(t,"network-request-failed"))},_G(`${Kde()}?onload=${a}`).catch(w=>r(w))}}).catch(e=>{throw Xj=null,e})}let Xj=null;function pfe(t){return Xj=Xj||ffe(t),Xj}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mfe=new SE(5e3,15e3),gfe="__/auth/iframe",_fe="emulator/auth/iframe",yfe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},xfe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vfe(t){const e=t.config;Vn(e.authDomain,t,"auth-domain-config-required");const r=e.emulator?CL(e,_fe):`https://${t.config.authDomain}/${gfe}`,n={apiKey:e.apiKey,appName:t.name,v:Ry},c=xfe.get(t.config.apiHost);c&&(n.eid=c);const d=t._getFrameworks();return d.length&&(n.fw=d.join(",")),`${r}?${wE(n).slice(1)}`}async function wfe(t){const e=await pfe(t),r=ef().gapi;return Vn(r,t,"internal-error"),e.open({where:document.body,url:vfe(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yfe,dontclear:!0},n=>new Promise(async(c,d)=>{await n.restyle({setHideOnLeave:!1});const p=Qh(t,"network-request-failed"),a=ef().setTimeout(()=>{d(p)},mfe.get());function w(){ef().clearTimeout(a),c(n)}n.ping(w).then(w,()=>{d(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bfe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Sfe=500,Efe=600,Tfe="_blank",jfe="http://localhost";class sU{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Nfe(t,e,r,n=Sfe,c=Efe){const d=Math.max((window.screen.availHeight-c)/2,0).toString(),p=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const w=Object.assign(Object.assign({},bfe),{width:n.toString(),height:c.toString(),top:d,left:p}),E=Zl().toLowerCase();r&&(a=uG(E)?Tfe:r),lG(E)&&(e=e||jfe,w.scrollbars="yes");const C=Object.entries(w).reduce((R,[B,V])=>`${R}${B}=${V},`,"");if(Bde(E)&&a!=="_self")return Ife(e||"",a),new sU(null);const P=window.open(e||"",a,C);Vn(P,t,"popup-blocked");try{P.focus()}catch{}return new sU(P)}function Ife(t,e){const r=document.createElement("a");r.href=t,r.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cfe="__/auth/handler",Afe="emulator/auth/handler",Pfe=encodeURIComponent("fac");async function iU(t,e,r,n,c,d){Vn(t.config.authDomain,t,"auth-domain-config-required"),Vn(t.config.apiKey,t,"invalid-api-key");const p={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:n,v:Ry,eventId:c};if(e instanceof ML){e.setDefaultLanguage(t.languageCode),p.providerId=e.providerId||"",aue(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,P]of Object.entries({}))p[C]=P}if(e instanceof TE){const C=e.getScopes().filter(P=>P!=="");C.length>0&&(p.scopes=C.join(","))}t.tenantId&&(p.tid=t.tenantId);const a=p;for(const C of Object.keys(a))a[C]===void 0&&delete a[C];const w=await t._getAppCheckToken(),E=w?`#${Pfe}=${encodeURIComponent(w)}`:"";return`${kfe(t)}?${wE(a).slice(1)}${E}`}function kfe({config:t}){return t.emulator?CL(t,Afe):`https://${t.authDomain}/${Cfe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uR="webStorageSupport";class Rfe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=CG,this._completeRedirectFn=FG,this._overrideRedirectResult=efe}async _openPopup(e,r,n,c){var d;_p((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const p=await iU(e,r,n,pD(),c);return Nfe(e,p,FL())}async _openRedirect(e,r,n,c){await this._originValidation(e);const d=await iU(e,r,n,pD(),c);return Ohe(d),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:c,promise:d}=this.eventManagers[r];return c?Promise.resolve(c):(_p(d,"If manager is not set, promise should be"),d)}const n=this.initAndGetManager(e);return this.eventManagers[r]={promise:n},n.catch(()=>{delete this.eventManagers[r]}),n}async initAndGetManager(e){const r=await wfe(e),n=new ife(e);return r.register("authEvent",c=>(Vn(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:n.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=r,n}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(uR,{type:uR},c=>{var d;const p=(d=c==null?void 0:c[0])===null||d===void 0?void 0:d[uR];p!==void 0&&r(!!p),Ou(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=ufe(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return mG()||cG()||PL()}}const Mfe=Rfe;var aU="@firebase/auth",oU="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dfe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){Vn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ofe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Lfe(t){th(new ld("auth",(e,{options:r})=>{const n=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),d=e.getProvider("app-check-internal"),{apiKey:p,authDomain:a}=n.options;Vn(p&&!p.includes(":"),"invalid-api-key",{appName:n.name});const w={apiKey:p,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:gG(t)},E=new Hde(n,c,d,w);return the(E,r),E},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,n)=>{e.getProvider("auth-internal").initialize()})),th(new ld("auth-internal",e=>{const r=pf(e.getProvider("auth").getImmediate());return(n=>new Dfe(n))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),nu(aU,oU,Ofe(t)),nu(aU,oU,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ffe=5*60,zfe=$7("authIdTokenMaxAge")||Ffe;let lU=null;const Bfe=t=>async e=>{const r=e&&await e.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>zfe)return;const c=r==null?void 0:r.token;lU!==c&&(lU=c,await fetch(t,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function Vfe(t=hC()){const e=Ig(t,"auth");if(e.isInitialized())return e.getImmediate();const r=ehe(t,{popupRedirectResolver:Mfe,persistence:[Ghe,Rhe,CG]}),n=$7("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(n,location.origin);if(location.origin===d.origin){const p=Bfe(d.toString());Nhe(r,p,()=>p(r.currentUser)),jhe(r,a=>p(a))}}const c=B7("auth");return c&&rhe(r,`http://${c}`),r}function Ufe(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Wde({loadJS(t){return new Promise((e,r)=>{const n=document.createElement("script");n.setAttribute("src",t),n.onload=e,n.onerror=c=>{const d=Qh("internal-error");d.customData=c,r(d)},n.type="text/javascript",n.charset="UTF-8",Ufe().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Lfe("Browser");var $fe="firebase",qfe="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nu($fe,qfe,"app");var cU=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var q_,BG;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(pe,ue){function ge(){}ge.prototype=ue.prototype,pe.D=ue.prototype,pe.prototype=new ge,pe.prototype.constructor=pe,pe.C=function(ce,Se,le){for(var J=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)J[ke-2]=arguments[ke];return ue.prototype[Se].apply(ce,J)}}function r(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,r),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(pe,ue,ge){ge||(ge=0);var ce=Array(16);if(typeof ue=="string")for(var Se=0;16>Se;++Se)ce[Se]=ue.charCodeAt(ge++)|ue.charCodeAt(ge++)<<8|ue.charCodeAt(ge++)<<16|ue.charCodeAt(ge++)<<24;else for(Se=0;16>Se;++Se)ce[Se]=ue[ge++]|ue[ge++]<<8|ue[ge++]<<16|ue[ge++]<<24;ue=pe.g[0],ge=pe.g[1],Se=pe.g[2];var le=pe.g[3],J=ue+(le^ge&(Se^le))+ce[0]+3614090360&4294967295;ue=ge+(J<<7&4294967295|J>>>25),J=le+(Se^ue&(ge^Se))+ce[1]+3905402710&4294967295,le=ue+(J<<12&4294967295|J>>>20),J=Se+(ge^le&(ue^ge))+ce[2]+606105819&4294967295,Se=le+(J<<17&4294967295|J>>>15),J=ge+(ue^Se&(le^ue))+ce[3]+3250441966&4294967295,ge=Se+(J<<22&4294967295|J>>>10),J=ue+(le^ge&(Se^le))+ce[4]+4118548399&4294967295,ue=ge+(J<<7&4294967295|J>>>25),J=le+(Se^ue&(ge^Se))+ce[5]+1200080426&4294967295,le=ue+(J<<12&4294967295|J>>>20),J=Se+(ge^le&(ue^ge))+ce[6]+2821735955&4294967295,Se=le+(J<<17&4294967295|J>>>15),J=ge+(ue^Se&(le^ue))+ce[7]+4249261313&4294967295,ge=Se+(J<<22&4294967295|J>>>10),J=ue+(le^ge&(Se^le))+ce[8]+1770035416&4294967295,ue=ge+(J<<7&4294967295|J>>>25),J=le+(Se^ue&(ge^Se))+ce[9]+2336552879&4294967295,le=ue+(J<<12&4294967295|J>>>20),J=Se+(ge^le&(ue^ge))+ce[10]+4294925233&4294967295,Se=le+(J<<17&4294967295|J>>>15),J=ge+(ue^Se&(le^ue))+ce[11]+2304563134&4294967295,ge=Se+(J<<22&4294967295|J>>>10),J=ue+(le^ge&(Se^le))+ce[12]+1804603682&4294967295,ue=ge+(J<<7&4294967295|J>>>25),J=le+(Se^ue&(ge^Se))+ce[13]+4254626195&4294967295,le=ue+(J<<12&4294967295|J>>>20),J=Se+(ge^le&(ue^ge))+ce[14]+2792965006&4294967295,Se=le+(J<<17&4294967295|J>>>15),J=ge+(ue^Se&(le^ue))+ce[15]+1236535329&4294967295,ge=Se+(J<<22&4294967295|J>>>10),J=ue+(Se^le&(ge^Se))+ce[1]+4129170786&4294967295,ue=ge+(J<<5&4294967295|J>>>27),J=le+(ge^Se&(ue^ge))+ce[6]+3225465664&4294967295,le=ue+(J<<9&4294967295|J>>>23),J=Se+(ue^ge&(le^ue))+ce[11]+643717713&4294967295,Se=le+(J<<14&4294967295|J>>>18),J=ge+(le^ue&(Se^le))+ce[0]+3921069994&4294967295,ge=Se+(J<<20&4294967295|J>>>12),J=ue+(Se^le&(ge^Se))+ce[5]+3593408605&4294967295,ue=ge+(J<<5&4294967295|J>>>27),J=le+(ge^Se&(ue^ge))+ce[10]+38016083&4294967295,le=ue+(J<<9&4294967295|J>>>23),J=Se+(ue^ge&(le^ue))+ce[15]+3634488961&4294967295,Se=le+(J<<14&4294967295|J>>>18),J=ge+(le^ue&(Se^le))+ce[4]+3889429448&4294967295,ge=Se+(J<<20&4294967295|J>>>12),J=ue+(Se^le&(ge^Se))+ce[9]+568446438&4294967295,ue=ge+(J<<5&4294967295|J>>>27),J=le+(ge^Se&(ue^ge))+ce[14]+3275163606&4294967295,le=ue+(J<<9&4294967295|J>>>23),J=Se+(ue^ge&(le^ue))+ce[3]+4107603335&4294967295,Se=le+(J<<14&4294967295|J>>>18),J=ge+(le^ue&(Se^le))+ce[8]+1163531501&4294967295,ge=Se+(J<<20&4294967295|J>>>12),J=ue+(Se^le&(ge^Se))+ce[13]+2850285829&4294967295,ue=ge+(J<<5&4294967295|J>>>27),J=le+(ge^Se&(ue^ge))+ce[2]+4243563512&4294967295,le=ue+(J<<9&4294967295|J>>>23),J=Se+(ue^ge&(le^ue))+ce[7]+1735328473&4294967295,Se=le+(J<<14&4294967295|J>>>18),J=ge+(le^ue&(Se^le))+ce[12]+2368359562&4294967295,ge=Se+(J<<20&4294967295|J>>>12),J=ue+(ge^Se^le)+ce[5]+4294588738&4294967295,ue=ge+(J<<4&4294967295|J>>>28),J=le+(ue^ge^Se)+ce[8]+2272392833&4294967295,le=ue+(J<<11&4294967295|J>>>21),J=Se+(le^ue^ge)+ce[11]+1839030562&4294967295,Se=le+(J<<16&4294967295|J>>>16),J=ge+(Se^le^ue)+ce[14]+4259657740&4294967295,ge=Se+(J<<23&4294967295|J>>>9),J=ue+(ge^Se^le)+ce[1]+2763975236&4294967295,ue=ge+(J<<4&4294967295|J>>>28),J=le+(ue^ge^Se)+ce[4]+1272893353&4294967295,le=ue+(J<<11&4294967295|J>>>21),J=Se+(le^ue^ge)+ce[7]+4139469664&4294967295,Se=le+(J<<16&4294967295|J>>>16),J=ge+(Se^le^ue)+ce[10]+3200236656&4294967295,ge=Se+(J<<23&4294967295|J>>>9),J=ue+(ge^Se^le)+ce[13]+681279174&4294967295,ue=ge+(J<<4&4294967295|J>>>28),J=le+(ue^ge^Se)+ce[0]+3936430074&4294967295,le=ue+(J<<11&4294967295|J>>>21),J=Se+(le^ue^ge)+ce[3]+3572445317&4294967295,Se=le+(J<<16&4294967295|J>>>16),J=ge+(Se^le^ue)+ce[6]+76029189&4294967295,ge=Se+(J<<23&4294967295|J>>>9),J=ue+(ge^Se^le)+ce[9]+3654602809&4294967295,ue=ge+(J<<4&4294967295|J>>>28),J=le+(ue^ge^Se)+ce[12]+3873151461&4294967295,le=ue+(J<<11&4294967295|J>>>21),J=Se+(le^ue^ge)+ce[15]+530742520&4294967295,Se=le+(J<<16&4294967295|J>>>16),J=ge+(Se^le^ue)+ce[2]+3299628645&4294967295,ge=Se+(J<<23&4294967295|J>>>9),J=ue+(Se^(ge|~le))+ce[0]+4096336452&4294967295,ue=ge+(J<<6&4294967295|J>>>26),J=le+(ge^(ue|~Se))+ce[7]+1126891415&4294967295,le=ue+(J<<10&4294967295|J>>>22),J=Se+(ue^(le|~ge))+ce[14]+2878612391&4294967295,Se=le+(J<<15&4294967295|J>>>17),J=ge+(le^(Se|~ue))+ce[5]+4237533241&4294967295,ge=Se+(J<<21&4294967295|J>>>11),J=ue+(Se^(ge|~le))+ce[12]+1700485571&4294967295,ue=ge+(J<<6&4294967295|J>>>26),J=le+(ge^(ue|~Se))+ce[3]+2399980690&4294967295,le=ue+(J<<10&4294967295|J>>>22),J=Se+(ue^(le|~ge))+ce[10]+4293915773&4294967295,Se=le+(J<<15&4294967295|J>>>17),J=ge+(le^(Se|~ue))+ce[1]+2240044497&4294967295,ge=Se+(J<<21&4294967295|J>>>11),J=ue+(Se^(ge|~le))+ce[8]+1873313359&4294967295,ue=ge+(J<<6&4294967295|J>>>26),J=le+(ge^(ue|~Se))+ce[15]+4264355552&4294967295,le=ue+(J<<10&4294967295|J>>>22),J=Se+(ue^(le|~ge))+ce[6]+2734768916&4294967295,Se=le+(J<<15&4294967295|J>>>17),J=ge+(le^(Se|~ue))+ce[13]+1309151649&4294967295,ge=Se+(J<<21&4294967295|J>>>11),J=ue+(Se^(ge|~le))+ce[4]+4149444226&4294967295,ue=ge+(J<<6&4294967295|J>>>26),J=le+(ge^(ue|~Se))+ce[11]+3174756917&4294967295,le=ue+(J<<10&4294967295|J>>>22),J=Se+(ue^(le|~ge))+ce[2]+718787259&4294967295,Se=le+(J<<15&4294967295|J>>>17),J=ge+(le^(Se|~ue))+ce[9]+3951481745&4294967295,pe.g[0]=pe.g[0]+ue&4294967295,pe.g[1]=pe.g[1]+(Se+(J<<21&4294967295|J>>>11))&4294967295,pe.g[2]=pe.g[2]+Se&4294967295,pe.g[3]=pe.g[3]+le&4294967295}n.prototype.u=function(pe,ue){ue===void 0&&(ue=pe.length);for(var ge=ue-this.blockSize,ce=this.B,Se=this.h,le=0;le<ue;){if(Se==0)for(;le<=ge;)c(this,pe,le),le+=this.blockSize;if(typeof pe=="string"){for(;le<ue;)if(ce[Se++]=pe.charCodeAt(le++),Se==this.blockSize){c(this,ce),Se=0;break}}else for(;le<ue;)if(ce[Se++]=pe[le++],Se==this.blockSize){c(this,ce),Se=0;break}}this.h=Se,this.o+=ue},n.prototype.v=function(){var pe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);pe[0]=128;for(var ue=1;ue<pe.length-8;++ue)pe[ue]=0;var ge=8*this.o;for(ue=pe.length-8;ue<pe.length;++ue)pe[ue]=ge&255,ge/=256;for(this.u(pe),pe=Array(16),ue=ge=0;4>ue;++ue)for(var ce=0;32>ce;ce+=8)pe[ge++]=this.g[ue]>>>ce&255;return pe};function d(pe,ue){var ge=a;return Object.prototype.hasOwnProperty.call(ge,pe)?ge[pe]:ge[pe]=ue(pe)}function p(pe,ue){this.h=ue;for(var ge=[],ce=!0,Se=pe.length-1;0<=Se;Se--){var le=pe[Se]|0;ce&&le==ue||(ge[Se]=le,ce=!1)}this.g=ge}var a={};function w(pe){return-128<=pe&&128>pe?d(pe,function(ue){return new p([ue|0],0>ue?-1:0)}):new p([pe|0],0>pe?-1:0)}function E(pe){if(isNaN(pe)||!isFinite(pe))return P;if(0>pe)return K(E(-pe));for(var ue=[],ge=1,ce=0;pe>=ge;ce++)ue[ce]=pe/ge|0,ge*=4294967296;return new p(ue,0)}function C(pe,ue){if(pe.length==0)throw Error("number format error: empty string");if(ue=ue||10,2>ue||36<ue)throw Error("radix out of range: "+ue);if(pe.charAt(0)=="-")return K(C(pe.substring(1),ue));if(0<=pe.indexOf("-"))throw Error('number format error: interior "-" character');for(var ge=E(Math.pow(ue,8)),ce=P,Se=0;Se<pe.length;Se+=8){var le=Math.min(8,pe.length-Se),J=parseInt(pe.substring(Se,Se+le),ue);8>le?(le=E(Math.pow(ue,le)),ce=ce.j(le).add(E(J))):(ce=ce.j(ge),ce=ce.add(E(J)))}return ce}var P=w(0),R=w(1),B=w(16777216);t=p.prototype,t.m=function(){if(W(this))return-K(this).m();for(var pe=0,ue=1,ge=0;ge<this.g.length;ge++){var ce=this.i(ge);pe+=(0<=ce?ce:4294967296+ce)*ue,ue*=4294967296}return pe},t.toString=function(pe){if(pe=pe||10,2>pe||36<pe)throw Error("radix out of range: "+pe);if(V(this))return"0";if(W(this))return"-"+K(this).toString(pe);for(var ue=E(Math.pow(pe,6)),ge=this,ce="";;){var Se=Q(ge,ue).g;ge=Z(ge,Se.j(ue));var le=((0<ge.g.length?ge.g[0]:ge.h)>>>0).toString(pe);if(ge=Se,V(ge))return le+ce;for(;6>le.length;)le="0"+le;ce=le+ce}},t.i=function(pe){return 0>pe?0:pe<this.g.length?this.g[pe]:this.h};function V(pe){if(pe.h!=0)return!1;for(var ue=0;ue<pe.g.length;ue++)if(pe.g[ue]!=0)return!1;return!0}function W(pe){return pe.h==-1}t.l=function(pe){return pe=Z(this,pe),W(pe)?-1:V(pe)?0:1};function K(pe){for(var ue=pe.g.length,ge=[],ce=0;ce<ue;ce++)ge[ce]=~pe.g[ce];return new p(ge,~pe.h).add(R)}t.abs=function(){return W(this)?K(this):this},t.add=function(pe){for(var ue=Math.max(this.g.length,pe.g.length),ge=[],ce=0,Se=0;Se<=ue;Se++){var le=ce+(this.i(Se)&65535)+(pe.i(Se)&65535),J=(le>>>16)+(this.i(Se)>>>16)+(pe.i(Se)>>>16);ce=J>>>16,le&=65535,J&=65535,ge[Se]=J<<16|le}return new p(ge,ge[ge.length-1]&-2147483648?-1:0)};function Z(pe,ue){return pe.add(K(ue))}t.j=function(pe){if(V(this)||V(pe))return P;if(W(this))return W(pe)?K(this).j(K(pe)):K(K(this).j(pe));if(W(pe))return K(this.j(K(pe)));if(0>this.l(B)&&0>pe.l(B))return E(this.m()*pe.m());for(var ue=this.g.length+pe.g.length,ge=[],ce=0;ce<2*ue;ce++)ge[ce]=0;for(ce=0;ce<this.g.length;ce++)for(var Se=0;Se<pe.g.length;Se++){var le=this.i(ce)>>>16,J=this.i(ce)&65535,ke=pe.i(Se)>>>16,Ze=pe.i(Se)&65535;ge[2*ce+2*Se]+=J*Ze,$(ge,2*ce+2*Se),ge[2*ce+2*Se+1]+=le*Ze,$(ge,2*ce+2*Se+1),ge[2*ce+2*Se+1]+=J*ke,$(ge,2*ce+2*Se+1),ge[2*ce+2*Se+2]+=le*ke,$(ge,2*ce+2*Se+2)}for(ce=0;ce<ue;ce++)ge[ce]=ge[2*ce+1]<<16|ge[2*ce];for(ce=ue;ce<2*ue;ce++)ge[ce]=0;return new p(ge,0)};function $(pe,ue){for(;(pe[ue]&65535)!=pe[ue];)pe[ue+1]+=pe[ue]>>>16,pe[ue]&=65535,ue++}function X(pe,ue){this.g=pe,this.h=ue}function Q(pe,ue){if(V(ue))throw Error("division by zero");if(V(pe))return new X(P,P);if(W(pe))return ue=Q(K(pe),ue),new X(K(ue.g),K(ue.h));if(W(ue))return ue=Q(pe,K(ue)),new X(K(ue.g),ue.h);if(30<pe.g.length){if(W(pe)||W(ue))throw Error("slowDivide_ only works with positive integers.");for(var ge=R,ce=ue;0>=ce.l(pe);)ge=re(ge),ce=re(ce);var Se=ve(ge,1),le=ve(ce,1);for(ce=ve(ce,2),ge=ve(ge,2);!V(ce);){var J=le.add(ce);0>=J.l(pe)&&(Se=Se.add(ge),le=J),ce=ve(ce,1),ge=ve(ge,1)}return ue=Z(pe,Se.j(ue)),new X(Se,ue)}for(Se=P;0<=pe.l(ue);){for(ge=Math.max(1,Math.floor(pe.m()/ue.m())),ce=Math.ceil(Math.log(ge)/Math.LN2),ce=48>=ce?1:Math.pow(2,ce-48),le=E(ge),J=le.j(ue);W(J)||0<J.l(pe);)ge-=ce,le=E(ge),J=le.j(ue);V(le)&&(le=R),Se=Se.add(le),pe=Z(pe,J)}return new X(Se,pe)}t.A=function(pe){return Q(this,pe).h},t.and=function(pe){for(var ue=Math.max(this.g.length,pe.g.length),ge=[],ce=0;ce<ue;ce++)ge[ce]=this.i(ce)&pe.i(ce);return new p(ge,this.h&pe.h)},t.or=function(pe){for(var ue=Math.max(this.g.length,pe.g.length),ge=[],ce=0;ce<ue;ce++)ge[ce]=this.i(ce)|pe.i(ce);return new p(ge,this.h|pe.h)},t.xor=function(pe){for(var ue=Math.max(this.g.length,pe.g.length),ge=[],ce=0;ce<ue;ce++)ge[ce]=this.i(ce)^pe.i(ce);return new p(ge,this.h^pe.h)};function re(pe){for(var ue=pe.g.length+1,ge=[],ce=0;ce<ue;ce++)ge[ce]=pe.i(ce)<<1|pe.i(ce-1)>>>31;return new p(ge,pe.h)}function ve(pe,ue){var ge=ue>>5;ue%=32;for(var ce=pe.g.length-ge,Se=[],le=0;le<ce;le++)Se[le]=0<ue?pe.i(le+ge)>>>ue|pe.i(le+ge+1)<<32-ue:pe.i(le+ge);return new p(Se,pe.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,BG=n,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=E,p.fromString=C,q_=p}).apply(typeof cU<"u"?cU:typeof self<"u"?self:typeof window<"u"?window:{});var cj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var VG,L1,UG,Yj,xD,$G,qG,GG;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(O,ae,we){return O==Array.prototype||O==Object.prototype||(O[ae]=we.value),O};function r(O){O=[typeof globalThis=="object"&&globalThis,O,typeof window=="object"&&window,typeof self=="object"&&self,typeof cj=="object"&&cj];for(var ae=0;ae<O.length;++ae){var we=O[ae];if(we&&we.Math==Math)return we}throw Error("Cannot find global object")}var n=r(this);function c(O,ae){if(ae)e:{var we=n;O=O.split(".");for(var Be=0;Be<O.length-1;Be++){var Lt=O[Be];if(!(Lt in we))break e;we=we[Lt]}O=O[O.length-1],Be=we[O],ae=ae(Be),ae!=Be&&ae!=null&&e(we,O,{configurable:!0,writable:!0,value:ae})}}function d(O,ae){O instanceof String&&(O+="");var we=0,Be=!1,Lt={next:function(){if(!Be&&we<O.length){var Qt=we++;return{value:ae(Qt,O[Qt]),done:!1}}return Be=!0,{done:!0,value:void 0}}};return Lt[Symbol.iterator]=function(){return Lt},Lt}c("Array.prototype.values",function(O){return O||function(){return d(this,function(ae,we){return we})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},a=this||self;function w(O){var ae=typeof O;return ae=ae!="object"?ae:O?Array.isArray(O)?"array":ae:"null",ae=="array"||ae=="object"&&typeof O.length=="number"}function E(O){var ae=typeof O;return ae=="object"&&O!=null||ae=="function"}function C(O,ae,we){return O.call.apply(O.bind,arguments)}function P(O,ae,we){if(!O)throw Error();if(2<arguments.length){var Be=Array.prototype.slice.call(arguments,2);return function(){var Lt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Lt,Be),O.apply(ae,Lt)}}return function(){return O.apply(ae,arguments)}}function R(O,ae,we){return R=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:P,R.apply(null,arguments)}function B(O,ae){var we=Array.prototype.slice.call(arguments,1);return function(){var Be=we.slice();return Be.push.apply(Be,arguments),O.apply(this,Be)}}function V(O,ae){function we(){}we.prototype=ae.prototype,O.aa=ae.prototype,O.prototype=new we,O.prototype.constructor=O,O.Qb=function(Be,Lt,Qt){for(var zr=Array(arguments.length-2),es=2;es<arguments.length;es++)zr[es-2]=arguments[es];return ae.prototype[Lt].apply(Be,zr)}}function W(O){const ae=O.length;if(0<ae){const we=Array(ae);for(let Be=0;Be<ae;Be++)we[Be]=O[Be];return we}return[]}function K(O,ae){for(let we=1;we<arguments.length;we++){const Be=arguments[we];if(w(Be)){const Lt=O.length||0,Qt=Be.length||0;O.length=Lt+Qt;for(let zr=0;zr<Qt;zr++)O[Lt+zr]=Be[zr]}else O.push(Be)}}class Z{constructor(ae,we){this.i=ae,this.j=we,this.h=0,this.g=null}get(){let ae;return 0<this.h?(this.h--,ae=this.g,this.g=ae.next,ae.next=null):ae=this.i(),ae}}function $(O){return/^[\s\xa0]*$/.test(O)}function X(){var O=a.navigator;return O&&(O=O.userAgent)?O:""}function Q(O){return Q[" "](O),O}Q[" "]=function(){};var re=X().indexOf("Gecko")!=-1&&!(X().toLowerCase().indexOf("webkit")!=-1&&X().indexOf("Edge")==-1)&&!(X().indexOf("Trident")!=-1||X().indexOf("MSIE")!=-1)&&X().indexOf("Edge")==-1;function ve(O,ae,we){for(const Be in O)ae.call(we,O[Be],Be,O)}function pe(O,ae){for(const we in O)ae.call(void 0,O[we],we,O)}function ue(O){const ae={};for(const we in O)ae[we]=O[we];return ae}const ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ce(O,ae){let we,Be;for(let Lt=1;Lt<arguments.length;Lt++){Be=arguments[Lt];for(we in Be)O[we]=Be[we];for(let Qt=0;Qt<ge.length;Qt++)we=ge[Qt],Object.prototype.hasOwnProperty.call(Be,we)&&(O[we]=Be[we])}}function Se(O){var ae=1;O=O.split(":");const we=[];for(;0<ae&&O.length;)we.push(O.shift()),ae--;return O.length&&we.push(O.join(":")),we}function le(O){a.setTimeout(()=>{throw O},0)}function J(){var O=st;let ae=null;return O.g&&(ae=O.g,O.g=O.g.next,O.g||(O.h=null),ae.next=null),ae}class ke{constructor(){this.h=this.g=null}add(ae,we){const Be=Ze.get();Be.set(ae,we),this.h?this.h.next=Be:this.g=Be,this.h=Be}}var Ze=new Z(()=>new Xe,O=>O.reset());class Xe{constructor(){this.next=this.g=this.h=null}set(ae,we){this.h=ae,this.g=we,this.next=null}reset(){this.next=this.g=this.h=null}}let qe,$e=!1,st=new ke,it=()=>{const O=a.Promise.resolve(void 0);qe=()=>{O.then(Mt)}};var Mt=()=>{for(var O;O=J();){try{O.h.call(O.g)}catch(we){le(we)}var ae=Ze;ae.j(O),100>ae.h&&(ae.h++,O.next=ae.g,ae.g=O)}$e=!1};function ar(){this.s=this.s,this.C=this.C}ar.prototype.s=!1,ar.prototype.ma=function(){this.s||(this.s=!0,this.N())},ar.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function St(O,ae){this.type=O,this.g=this.target=ae,this.defaultPrevented=!1}St.prototype.h=function(){this.defaultPrevented=!0};var Xt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var O=!1,ae=Object.defineProperty({},"passive",{get:function(){O=!0}});try{const we=()=>{};a.addEventListener("test",we,ae),a.removeEventListener("test",we,ae)}catch{}return O}();function dt(O,ae){if(St.call(this,O?O.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,O){var we=this.type=O.type,Be=O.changedTouches&&O.changedTouches.length?O.changedTouches[0]:null;if(this.target=O.target||O.srcElement,this.g=ae,ae=O.relatedTarget){if(re){e:{try{Q(ae.nodeName);var Lt=!0;break e}catch{}Lt=!1}Lt||(ae=null)}}else we=="mouseover"?ae=O.fromElement:we=="mouseout"&&(ae=O.toElement);this.relatedTarget=ae,Be?(this.clientX=Be.clientX!==void 0?Be.clientX:Be.pageX,this.clientY=Be.clientY!==void 0?Be.clientY:Be.pageY,this.screenX=Be.screenX||0,this.screenY=Be.screenY||0):(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0),this.button=O.button,this.key=O.key||"",this.ctrlKey=O.ctrlKey,this.altKey=O.altKey,this.shiftKey=O.shiftKey,this.metaKey=O.metaKey,this.pointerId=O.pointerId||0,this.pointerType=typeof O.pointerType=="string"?O.pointerType:ft[O.pointerType]||"",this.state=O.state,this.i=O,O.defaultPrevented&&dt.aa.h.call(this)}}V(dt,St);var ft={2:"touch",3:"pen",4:"mouse"};dt.prototype.h=function(){dt.aa.h.call(this);var O=this.i;O.preventDefault?O.preventDefault():O.returnValue=!1};var Wt="closure_listenable_"+(1e6*Math.random()|0),Wr=0;function jr(O,ae,we,Be,Lt){this.listener=O,this.proxy=null,this.src=ae,this.type=we,this.capture=!!Be,this.ha=Lt,this.key=++Wr,this.da=this.fa=!1}function Br(O){O.da=!0,O.listener=null,O.proxy=null,O.src=null,O.ha=null}function on(O){this.src=O,this.g={},this.h=0}on.prototype.add=function(O,ae,we,Be,Lt){var Qt=O.toString();O=this.g[Qt],O||(O=this.g[Qt]=[],this.h++);var zr=ln(O,ae,Be,Lt);return-1<zr?(ae=O[zr],we||(ae.fa=!1)):(ae=new jr(ae,this.src,Qt,!!Be,Lt),ae.fa=we,O.push(ae)),ae};function Zn(O,ae){var we=ae.type;if(we in O.g){var Be=O.g[we],Lt=Array.prototype.indexOf.call(Be,ae,void 0),Qt;(Qt=0<=Lt)&&Array.prototype.splice.call(Be,Lt,1),Qt&&(Br(ae),O.g[we].length==0&&(delete O.g[we],O.h--))}}function ln(O,ae,we,Be){for(var Lt=0;Lt<O.length;++Lt){var Qt=O[Lt];if(!Qt.da&&Qt.listener==ae&&Qt.capture==!!we&&Qt.ha==Be)return Lt}return-1}var dr="closure_lm_"+(1e6*Math.random()|0),Vr={};function nn(O,ae,we,Be,Lt){if(Array.isArray(ae)){for(var Qt=0;Qt<ae.length;Qt++)nn(O,ae[Qt],we,Be,Lt);return null}return we=Cs(we),O&&O[Wt]?O.K(ae,we,E(Be)?!!Be.capture:!!Be,Lt):Ln(O,ae,we,!1,Be,Lt)}function Ln(O,ae,we,Be,Lt,Qt){if(!ae)throw Error("Invalid event type");var zr=E(Lt)?!!Lt.capture:!!Lt,es=mr(O);if(es||(O[dr]=es=new on(O)),we=es.add(ae,we,Be,zr,Qt),we.proxy)return we;if(Be=Je(),we.proxy=Be,Be.src=O,Be.listener=we,O.addEventListener)Xt||(Lt=zr),Lt===void 0&&(Lt=!1),O.addEventListener(ae.toString(),Be,Lt);else if(O.attachEvent)O.attachEvent(or(ae.toString()),Be);else if(O.addListener&&O.removeListener)O.addListener(Be);else throw Error("addEventListener and attachEvent are unavailable.");return we}function Je(){function O(we){return ae.call(O.src,O.listener,we)}const ae=xr;return O}function xt(O,ae,we,Be,Lt){if(Array.isArray(ae))for(var Qt=0;Qt<ae.length;Qt++)xt(O,ae[Qt],we,Be,Lt);else Be=E(Be)?!!Be.capture:!!Be,we=Cs(we),O&&O[Wt]?(O=O.i,ae=String(ae).toString(),ae in O.g&&(Qt=O.g[ae],we=ln(Qt,we,Be,Lt),-1<we&&(Br(Qt[we]),Array.prototype.splice.call(Qt,we,1),Qt.length==0&&(delete O.g[ae],O.h--)))):O&&(O=mr(O))&&(ae=O.g[ae.toString()],O=-1,ae&&(O=ln(ae,we,Be,Lt)),(we=-1<O?ae[O]:null)&&Ft(we))}function Ft(O){if(typeof O!="number"&&O&&!O.da){var ae=O.src;if(ae&&ae[Wt])Zn(ae.i,O);else{var we=O.type,Be=O.proxy;ae.removeEventListener?ae.removeEventListener(we,Be,O.capture):ae.detachEvent?ae.detachEvent(or(we),Be):ae.addListener&&ae.removeListener&&ae.removeListener(Be),(we=mr(ae))?(Zn(we,O),we.h==0&&(we.src=null,ae[dr]=null)):Br(O)}}}function or(O){return O in Vr?Vr[O]:Vr[O]="on"+O}function xr(O,ae){if(O.da)O=!0;else{ae=new dt(ae,this);var we=O.listener,Be=O.ha||O.src;O.fa&&Ft(O),O=we.call(Be,ae)}return O}function mr(O){return O=O[dr],O instanceof on?O:null}var sn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Cs(O){return typeof O=="function"?O:(O[sn]||(O[sn]=function(ae){return O.handleEvent(ae)}),O[sn])}function ys(){ar.call(this),this.i=new on(this),this.M=this,this.F=null}V(ys,ar),ys.prototype[Wt]=!0,ys.prototype.removeEventListener=function(O,ae,we,Be){xt(this,O,ae,we,Be)};function Es(O,ae){var we,Be=O.F;if(Be)for(we=[];Be;Be=Be.F)we.push(Be);if(O=O.M,Be=ae.type||ae,typeof ae=="string")ae=new St(ae,O);else if(ae instanceof St)ae.target=ae.target||O;else{var Lt=ae;ae=new St(Be,O),ce(ae,Lt)}if(Lt=!0,we)for(var Qt=we.length-1;0<=Qt;Qt--){var zr=ae.g=we[Qt];Lt=so(zr,Be,!0,ae)&&Lt}if(zr=ae.g=O,Lt=so(zr,Be,!0,ae)&&Lt,Lt=so(zr,Be,!1,ae)&&Lt,we)for(Qt=0;Qt<we.length;Qt++)zr=ae.g=we[Qt],Lt=so(zr,Be,!1,ae)&&Lt}ys.prototype.N=function(){if(ys.aa.N.call(this),this.i){var O=this.i,ae;for(ae in O.g){for(var we=O.g[ae],Be=0;Be<we.length;Be++)Br(we[Be]);delete O.g[ae],O.h--}}this.F=null},ys.prototype.K=function(O,ae,we,Be){return this.i.add(String(O),ae,!1,we,Be)},ys.prototype.L=function(O,ae,we,Be){return this.i.add(String(O),ae,!0,we,Be)};function so(O,ae,we,Be){if(ae=O.i.g[String(ae)],!ae)return!0;ae=ae.concat();for(var Lt=!0,Qt=0;Qt<ae.length;++Qt){var zr=ae[Qt];if(zr&&!zr.da&&zr.capture==we){var es=zr.listener,Ji=zr.ha||zr.src;zr.fa&&Zn(O.i,zr),Lt=es.call(Ji,Be)!==!1&&Lt}}return Lt&&!Be.defaultPrevented}function io(O,ae,we){if(typeof O=="function")we&&(O=R(O,we));else if(O&&typeof O.handleEvent=="function")O=R(O.handleEvent,O);else throw Error("Invalid listener argument");return 2147483647<Number(ae)?-1:a.setTimeout(O,ae||0)}function Cl(O){O.g=io(()=>{O.g=null,O.i&&(O.i=!1,Cl(O))},O.l);const ae=O.h;O.h=null,O.m.apply(null,ae)}class Qo extends ar{constructor(ae,we){super(),this.m=ae,this.l=we,this.h=null,this.i=!1,this.g=null}j(ae){this.h=arguments,this.g?this.i=!0:Cl(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Al(O){ar.call(this),this.h=O,this.g={}}V(Al,ar);var kc=[];function zi(O){ve(O.g,function(ae,we){this.g.hasOwnProperty(we)&&Ft(ae)},O),O.g={}}Al.prototype.N=function(){Al.aa.N.call(this),zi(this)},Al.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Pl=a.JSON.stringify,hh=a.JSON.parse,lu=class{stringify(O){return a.JSON.stringify(O,void 0)}parse(O){return a.JSON.parse(O,void 0)}};function fl(){}fl.prototype.h=null;function pl(O){return O.h||(O.h=O.i())}function oi(){}var pa={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function cu(){St.call(this,"d")}V(cu,St);function Rc(){St.call(this,"c")}V(Rc,St);var Fa={},_f=null;function Bu(){return _f=_f||new ys}Fa.La="serverreachability";function Rp(O){St.call(this,Fa.La,O)}V(Rp,St);function Mc(O){const ae=Bu();Es(ae,new Rp(ae))}Fa.STAT_EVENT="statevent";function Rt(O,ae){St.call(this,Fa.STAT_EVENT,O),this.stat=ae}V(Rt,St);function ua(O){const ae=Bu();Es(ae,new Rt(ae,O))}Fa.Ma="timingevent";function fh(O,ae){St.call(this,Fa.Ma,O),this.size=ae}V(fh,St);function uu(O,ae){if(typeof O!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){O()},ae)}function Nn(){this.g=!0}Nn.prototype.xa=function(){this.g=!1};function _o(O,ae,we,Be,Lt,Qt){O.info(function(){if(O.g)if(Qt)for(var zr="",es=Qt.split("&"),Ji=0;Ji<es.length;Ji++){var cs=es[Ji].split("=");if(1<cs.length){var Va=cs[0];cs=cs[1];var Ta=Va.split("_");zr=2<=Ta.length&&Ta[1]=="type"?zr+(Va+"="+cs+"&"):zr+(Va+"=redacted&")}}else zr=null;else zr=Qt;return"XMLHTTP REQ ("+Be+") [attempt "+Lt+"]: "+ae+`
`+we+`
`+zr})}function Fg(O,ae,we,Be,Lt,Qt,zr){O.info(function(){return"XMLHTTP RESP ("+Be+") [ attempt "+Lt+"]: "+ae+`
`+we+`
`+Qt+" "+zr})}function Dc(O,ae,we,Be){O.info(function(){return"XMLHTTP TEXT ("+ae+"): "+oe(O,we)+(Be?" "+Be:"")})}function Qe(O,ae){O.info(function(){return"TIMEOUT: "+ae})}Nn.prototype.info=function(){};function oe(O,ae){if(!O.g)return ae;if(!ae)return null;try{var we=JSON.parse(ae);if(we){for(O=0;O<we.length;O++)if(Array.isArray(we[O])){var Be=we[O];if(!(2>Be.length)){var Lt=Be[1];if(Array.isArray(Lt)&&!(1>Lt.length)){var Qt=Lt[0];if(Qt!="noop"&&Qt!="stop"&&Qt!="close")for(var zr=1;zr<Lt.length;zr++)Lt[zr]=""}}}}return Pl(we)}catch{return ae}}var he={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ne={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ze;function Fe(){}V(Fe,fl),Fe.prototype.g=function(){return new XMLHttpRequest},Fe.prototype.i=function(){return{}},ze=new Fe;function We(O,ae,we,Be){this.j=O,this.i=ae,this.l=we,this.R=Be||1,this.U=new Al(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ct}function ct(){this.i=null,this.g="",this.h=!1}var Ye={},at={};function zt(O,ae,we){O.L=1,O.v=md(Ma(ae)),O.m=we,O.P=!0,At(O,null)}function At(O,ae){O.F=Date.now(),Fr(O),O.A=Ma(O.v);var we=O.A,Be=O.R;Array.isArray(Be)||(Be=[String(Be)]),pu(we.i,"t",Be),O.C=0,we=O.j.J,O.h=new ct,O.g=vd(O.j,we?ae:null,!O.m),0<O.O&&(O.M=new Qo(R(O.Y,O,O.g),O.O)),ae=O.U,we=O.g,Be=O.ca;var Lt="readystatechange";Array.isArray(Lt)||(Lt&&(kc[0]=Lt.toString()),Lt=kc);for(var Qt=0;Qt<Lt.length;Qt++){var zr=nn(we,Lt[Qt],Be||ae.handleEvent,!1,ae.h||ae);if(!zr)break;ae.g[zr.key]=zr}ae=O.H?ue(O.H):{},O.m?(O.u||(O.u="POST"),ae["Content-Type"]="application/x-www-form-urlencoded",O.g.ea(O.A,O.u,O.m,ae)):(O.u="GET",O.g.ea(O.A,O.u,null,ae)),Mc(),_o(O.i,O.u,O.A,O.l,O.R,O.m)}We.prototype.ca=function(O){O=O.target;const ae=this.M;ae&&Sa(O)==3?ae.j():this.Y(O)},We.prototype.Y=function(O){try{if(O==this.g)e:{const Ta=Sa(this.g);var ae=this.g.Ba();const Bi=this.g.Z();if(!(3>Ta)&&(Ta!=3||this.g&&(this.h.h||this.g.oa()||gh(this.g)))){this.J||Ta!=4||ae==7||(ae==8||0>=Bi?Mc(3):Mc(2)),mn(this);var we=this.g.Z();this.X=we;t:if(br(this)){var Be=gh(this.g);O="";var Lt=Be.length,Qt=Sa(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Kn(this),yn(this);var zr="";break t}this.h.i=new a.TextDecoder}for(ae=0;ae<Lt;ae++)this.h.h=!0,O+=this.h.i.decode(Be[ae],{stream:!(Qt&&ae==Lt-1)});Be.length=0,this.h.g+=O,this.C=0,zr=this.h.g}else zr=this.g.oa();if(this.o=we==200,Fg(this.i,this.u,this.A,this.l,this.R,Ta,we),this.o){if(this.T&&!this.K){t:{if(this.g){var es,Ji=this.g;if((es=Ji.g?Ji.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(es)){var cs=es;break t}}cs=null}if(we=cs)Dc(this.i,this.l,we,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,li(this,we);else{this.o=!1,this.s=3,ua(12),Kn(this),yn(this);break e}}if(this.P){we=!0;let Da;for(;!this.J&&this.C<zr.length;)if(Da=Kr(this,zr),Da==at){Ta==4&&(this.s=4,ua(14),we=!1),Dc(this.i,this.l,null,"[Incomplete Response]");break}else if(Da==Ye){this.s=4,ua(15),Dc(this.i,this.l,zr,"[Invalid Chunk]"),we=!1;break}else Dc(this.i,this.l,Da,null),li(this,Da);if(br(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ta!=4||zr.length!=0||this.h.h||(this.s=1,ua(16),we=!1),this.o=this.o&&we,!we)Dc(this.i,this.l,zr,"[Invalid Chunked Response]"),Kn(this),yn(this);else if(0<zr.length&&!this.W){this.W=!0;var Va=this.j;Va.g==this&&Va.ba&&!Va.M&&(Va.j.info("Great, no buffering proxy detected. Bytes received: "+zr.length),rc(Va),Va.M=!0,ua(11))}}else Dc(this.i,this.l,zr,null),li(this,zr);Ta==4&&Kn(this),this.o&&!this.J&&(Ta==4?xd(this.j,this):(this.o=!1,Fr(this)))}else _h(this.g),we==400&&0<zr.indexOf("Unknown SID")?(this.s=3,ua(12)):(this.s=0,ua(13)),Kn(this),yn(this)}}}catch{}finally{}};function br(O){return O.g?O.u=="GET"&&O.L!=2&&O.j.Ca:!1}function Kr(O,ae){var we=O.C,Be=ae.indexOf(`
`,we);return Be==-1?at:(we=Number(ae.substring(we,Be)),isNaN(we)?Ye:(Be+=1,Be+we>ae.length?at:(ae=ae.slice(Be,Be+we),O.C=Be+we,ae)))}We.prototype.cancel=function(){this.J=!0,Kn(this)};function Fr(O){O.S=Date.now()+O.I,Ar(O,O.I)}function Ar(O,ae){if(O.B!=null)throw Error("WatchDog timer not null");O.B=uu(R(O.ba,O),ae)}function mn(O){O.B&&(a.clearTimeout(O.B),O.B=null)}We.prototype.ba=function(){this.B=null;const O=Date.now();0<=O-this.S?(Qe(this.i,this.A),this.L!=2&&(Mc(),ua(17)),Kn(this),this.s=2,yn(this)):Ar(this,this.S-O)};function yn(O){O.j.G==0||O.J||xd(O.j,O)}function Kn(O){mn(O);var ae=O.M;ae&&typeof ae.ma=="function"&&ae.ma(),O.M=null,zi(O.U),O.g&&(ae=O.g,O.g=null,ae.abort(),ae.ma())}function li(O,ae){try{var we=O.j;if(we.G!=0&&(we.g==O||Rn(we.h,O))){if(!O.K&&Rn(we.h,O)&&we.G==3){try{var Be=we.Da.g.parse(ae)}catch{Be=null}if(Array.isArray(Be)&&Be.length==3){var Lt=Be;if(Lt[0]==0){e:if(!we.u){if(we.g)if(we.g.F+3e3<O.F)$o(we),yh(we);else break e;yd(we),ua(18)}}else we.za=Lt[1],0<we.za-we.T&&37500>Lt[2]&&we.F&&we.v==0&&!we.C&&(we.C=uu(R(we.Za,we),6e3));if(1>=fs(we.h)&&we.ca){try{we.ca()}catch{}we.ca=void 0}}else Mn(we,11)}else if((O.K||we.g==O)&&$o(we),!$(ae))for(Lt=we.Da.g.parse(ae),ae=0;ae<Lt.length;ae++){let cs=Lt[ae];if(we.T=cs[0],cs=cs[1],we.G==2)if(cs[0]=="c"){we.K=cs[1],we.ia=cs[2];const Va=cs[3];Va!=null&&(we.la=Va,we.j.info("VER="+we.la));const Ta=cs[4];Ta!=null&&(we.Aa=Ta,we.j.info("SVER="+we.Aa));const Bi=cs[5];Bi!=null&&typeof Bi=="number"&&0<Bi&&(Be=1.5*Bi,we.L=Be,we.j.info("backChannelRequestTimeoutMs_="+Be)),Be=we;const Da=O.g;if(Da){const Rl=Da.g?Da.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Rl){var Qt=Be.h;Qt.g||Rl.indexOf("spdy")==-1&&Rl.indexOf("quic")==-1&&Rl.indexOf("h2")==-1||(Qt.j=Qt.l,Qt.g=new Set,Qt.h&&(zs(Qt,Qt.h),Qt.h=null))}if(Be.D){const Si=Da.g?Da.g.getResponseHeader("X-HTTP-Session-Id"):null;Si&&(Be.ya=Si,Bs(Be.I,Be.D,Si))}}we.G=3,we.l&&we.l.ua(),we.ba&&(we.R=Date.now()-O.F,we.j.info("Handshake RTT: "+we.R+"ms")),Be=we;var zr=O;if(Be.qa=qo(Be,Be.J?Be.ia:null,Be.W),zr.K){ci(Be.h,zr);var es=zr,Ji=Be.L;Ji&&(es.I=Ji),es.B&&(mn(es),Fr(es)),Be.g=zr}else Ur(Be);0<we.i.length&&xh(we)}else cs[0]!="stop"&&cs[0]!="close"||Mn(we,7);else we.G==3&&(cs[0]=="stop"||cs[0]=="close"?cs[0]=="stop"?Mn(we,7):Yi(we):cs[0]!="noop"&&we.l&&we.l.ta(cs),we.v=0)}}Mc(4)}catch{}}var Xi=class{constructor(O,ae){this.g=O,this.map=ae}};function Ci(O){this.l=O||10,a.PerformanceNavigationTiming?(O=a.performance.getEntriesByType("navigation"),O=0<O.length&&(O[0].nextHopProtocol=="hq"||O[0].nextHopProtocol=="h2")):O=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=O?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function bi(O){return O.h?!0:O.g?O.g.size>=O.j:!1}function fs(O){return O.h?1:O.g?O.g.size:0}function Rn(O,ae){return O.h?O.h==ae:O.g?O.g.has(ae):!1}function zs(O,ae){O.g?O.g.add(ae):O.h=ae}function ci(O,ae){O.h&&O.h==ae?O.h=null:O.g&&O.g.has(ae)&&O.g.delete(ae)}Ci.prototype.cancel=function(){if(this.i=bs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const O of this.g.values())O.cancel();this.g.clear()}};function bs(O){if(O.h!=null)return O.i.concat(O.h.D);if(O.g!=null&&O.g.size!==0){let ae=O.i;for(const we of O.g.values())ae=ae.concat(we.D);return ae}return W(O.i)}function Ks(O){if(O.V&&typeof O.V=="function")return O.V();if(typeof Map<"u"&&O instanceof Map||typeof Set<"u"&&O instanceof Set)return Array.from(O.values());if(typeof O=="string")return O.split("");if(w(O)){for(var ae=[],we=O.length,Be=0;Be<we;Be++)ae.push(O[Be]);return ae}ae=[],we=0;for(Be in O)ae[we++]=O[Be];return ae}function da(O){if(O.na&&typeof O.na=="function")return O.na();if(!O.V||typeof O.V!="function"){if(typeof Map<"u"&&O instanceof Map)return Array.from(O.keys());if(!(typeof Set<"u"&&O instanceof Set)){if(w(O)||typeof O=="string"){var ae=[];O=O.length;for(var we=0;we<O;we++)ae.push(we);return ae}ae=[],we=0;for(const Be in O)ae[we++]=Be;return ae}}}function ao(O,ae){if(O.forEach&&typeof O.forEach=="function")O.forEach(ae,void 0);else if(w(O)||typeof O=="string")Array.prototype.forEach.call(O,ae,void 0);else for(var we=da(O),Be=Ks(O),Lt=Be.length,Qt=0;Qt<Lt;Qt++)ae.call(void 0,Be[Qt],we&&we[Qt],O)}var ml=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pd(O,ae){if(O){O=O.split("&");for(var we=0;we<O.length;we++){var Be=O[we].indexOf("="),Lt=null;if(0<=Be){var Qt=O[we].substring(0,Be);Lt=O[we].substring(Be+1)}else Qt=O[we];ae(Qt,Lt?decodeURIComponent(Lt.replace(/\+/g," ")):"")}}}function Mi(O){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,O instanceof Mi){this.h=O.h,za(this,O.j),this.o=O.o,this.g=O.g,el(this,O.s),this.l=O.l;var ae=O.i,we=new Ql;we.i=ae.i,ae.g&&(we.g=new Map(ae.g),we.h=ae.h),Uo(this,we),this.m=O.m}else O&&(ae=String(O).match(ml))?(this.h=!1,za(this,ae[1]||"",!0),this.o=du(ae[2]||""),this.g=du(ae[3]||"",!0),el(this,ae[4]),this.l=du(ae[5]||"",!0),Uo(this,ae[6]||"",!0),this.m=du(ae[7]||"")):(this.h=!1,this.i=new Ql(null,this.h))}Mi.prototype.toString=function(){var O=[],ae=this.j;ae&&O.push(hu(ae,Eo,!0),":");var we=this.g;return(we||ae=="file")&&(O.push("//"),(ae=this.o)&&O.push(hu(ae,Eo,!0),"@"),O.push(encodeURIComponent(String(we)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),we=this.s,we!=null&&O.push(":",String(we))),(we=this.l)&&(this.g&&we.charAt(0)!="/"&&O.push("/"),O.push(hu(we,we.charAt(0)=="/"?To:Jl,!0))),(we=this.i.toString())&&O.push("?",we),(we=this.m)&&O.push("#",hu(we,fu)),O.join("")};function Ma(O){return new Mi(O)}function za(O,ae,we){O.j=we?du(ae,!0):ae,O.j&&(O.j=O.j.replace(/:$/,""))}function el(O,ae){if(ae){if(ae=Number(ae),isNaN(ae)||0>ae)throw Error("Bad port number "+ae);O.s=ae}else O.s=null}function Uo(O,ae,we){ae instanceof Ql?(O.i=ae,Uy(O.i,O.h)):(we||(ae=hu(ae,gl)),O.i=new Ql(ae,O.h))}function Bs(O,ae,we){O.i.set(ae,we)}function md(O){return Bs(O,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),O}function du(O,ae){return O?ae?decodeURI(O.replace(/%25/g,"%2525")):decodeURIComponent(O):""}function hu(O,ae,we){return typeof O=="string"?(O=encodeURI(O).replace(ae,yf),we&&(O=O.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),O):null}function yf(O){return O=O.charCodeAt(0),"%"+(O>>4&15).toString(16)+(O&15).toString(16)}var Eo=/[#\/\?@]/g,Jl=/[#\?:]/g,To=/[#\?]/g,gl=/[#\?@]/g,fu=/#/g;function Ql(O,ae){this.h=this.g=null,this.i=O||null,this.j=!!ae}function ec(O){O.g||(O.g=new Map,O.h=0,O.i&&pd(O.i,function(ae,we){O.add(decodeURIComponent(ae.replace(/\+/g," ")),we)}))}t=Ql.prototype,t.add=function(O,ae){ec(this),this.i=null,O=Vu(this,O);var we=this.g.get(O);return we||this.g.set(O,we=[]),we.push(ae),this.h+=1,this};function xf(O,ae){ec(O),ae=Vu(O,ae),O.g.has(ae)&&(O.i=null,O.h-=O.g.get(ae).length,O.g.delete(ae))}function tc(O,ae){return ec(O),ae=Vu(O,ae),O.g.has(ae)}t.forEach=function(O,ae){ec(this),this.g.forEach(function(we,Be){we.forEach(function(Lt){O.call(ae,Lt,Be,this)},this)},this)},t.na=function(){ec(this);const O=Array.from(this.g.values()),ae=Array.from(this.g.keys()),we=[];for(let Be=0;Be<ae.length;Be++){const Lt=O[Be];for(let Qt=0;Qt<Lt.length;Qt++)we.push(ae[Be])}return we},t.V=function(O){ec(this);let ae=[];if(typeof O=="string")tc(this,O)&&(ae=ae.concat(this.g.get(Vu(this,O))));else{O=Array.from(this.g.values());for(let we=0;we<O.length;we++)ae=ae.concat(O[we])}return ae},t.set=function(O,ae){return ec(this),this.i=null,O=Vu(this,O),tc(this,O)&&(this.h-=this.g.get(O).length),this.g.set(O,[ae]),this.h+=1,this},t.get=function(O,ae){return O?(O=this.V(O),0<O.length?String(O[0]):ae):ae};function pu(O,ae,we){xf(O,ae),0<we.length&&(O.i=null,O.g.set(Vu(O,ae),W(we)),O.h+=we.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const O=[],ae=Array.from(this.g.keys());for(var we=0;we<ae.length;we++){var Be=ae[we];const Qt=encodeURIComponent(String(Be)),zr=this.V(Be);for(Be=0;Be<zr.length;Be++){var Lt=Qt;zr[Be]!==""&&(Lt+="="+encodeURIComponent(String(zr[Be]))),O.push(Lt)}}return this.i=O.join("&")};function Vu(O,ae){return ae=String(ae),O.j&&(ae=ae.toLowerCase()),ae}function Uy(O,ae){ae&&!O.j&&(ec(O),O.i=null,O.g.forEach(function(we,Be){var Lt=Be.toLowerCase();Be!=Lt&&(xf(this,Be),pu(this,Lt,we))},O)),O.j=ae}function kl(O,ae){const we=new Nn;if(a.Image){const Be=new Image;Be.onload=B(tl,we,"TestLoadImage: loaded",!0,ae,Be),Be.onerror=B(tl,we,"TestLoadImage: error",!1,ae,Be),Be.onabort=B(tl,we,"TestLoadImage: abort",!1,ae,Be),Be.ontimeout=B(tl,we,"TestLoadImage: timeout",!1,ae,Be),a.setTimeout(function(){Be.ontimeout&&Be.ontimeout()},1e4),Be.src=O}else ae(!1)}function zg(O,ae){const we=new Nn,Be=new AbortController,Lt=setTimeout(()=>{Be.abort(),tl(we,"TestPingServer: timeout",!1,ae)},1e4);fetch(O,{signal:Be.signal}).then(Qt=>{clearTimeout(Lt),Qt.ok?tl(we,"TestPingServer: ok",!0,ae):tl(we,"TestPingServer: server error",!1,ae)}).catch(()=>{clearTimeout(Lt),tl(we,"TestPingServer: error",!1,ae)})}function tl(O,ae,we,Be,Lt){try{Lt&&(Lt.onload=null,Lt.onerror=null,Lt.onabort=null,Lt.ontimeout=null),Be(we)}catch{}}function gd(){this.g=new lu}function Bg(O,ae,we){const Be=we||"";try{ao(O,function(Lt,Qt){let zr=Lt;E(Lt)&&(zr=Pl(Lt)),ae.push(Be+Qt+"="+encodeURIComponent(zr))})}catch(Lt){throw ae.push(Be+"type="+encodeURIComponent("_badmap")),Lt}}function Uu(O){this.l=O.Ub||null,this.j=O.eb||!1}V(Uu,fl),Uu.prototype.g=function(){return new mu(this.l,this.j)},Uu.prototype.i=function(O){return function(){return O}}({});function mu(O,ae){ys.call(this),this.D=O,this.o=ae,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}V(mu,ys),t=mu.prototype,t.open=function(O,ae){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=O,this.A=ae,this.readyState=1,gu(this)},t.send=function(O){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const ae={headers:this.u,method:this.B,credentials:this.m,cache:void 0};O&&(ae.body=O),(this.D||a).fetch(new Request(this.A,ae)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,_d(this)),this.readyState=0},t.Sa=function(O){if(this.g&&(this.l=O,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=O.headers,this.readyState=2,gu(this)),this.g&&(this.readyState=3,gu(this),this.g)))if(this.responseType==="arraybuffer")O.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in O){if(this.j=O.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Xn(this)}else O.text().then(this.Ra.bind(this),this.ga.bind(this))};function Xn(O){O.j.read().then(O.Pa.bind(O)).catch(O.ga.bind(O))}t.Pa=function(O){if(this.g){if(this.o&&O.value)this.response.push(O.value);else if(!this.o){var ae=O.value?O.value:new Uint8Array(0);(ae=this.v.decode(ae,{stream:!O.done}))&&(this.response=this.responseText+=ae)}O.done?_d(this):gu(this),this.readyState==3&&Xn(this)}},t.Ra=function(O){this.g&&(this.response=this.responseText=O,_d(this))},t.Qa=function(O){this.g&&(this.response=O,_d(this))},t.ga=function(){this.g&&_d(this)};function _d(O){O.readyState=4,O.l=null,O.j=null,O.v=null,gu(O)}t.setRequestHeader=function(O,ae){this.u.append(O,ae)},t.getResponseHeader=function(O){return this.h&&this.h.get(O.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const O=[],ae=this.h.entries();for(var we=ae.next();!we.done;)we=we.value,O.push(we[0]+": "+we[1]),we=ae.next();return O.join(`\r
`)};function gu(O){O.onreadystatechange&&O.onreadystatechange.call(O)}Object.defineProperty(mu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(O){this.m=O?"include":"same-origin"}});function ph(O){let ae="";return ve(O,function(we,Be){ae+=Be,ae+=":",ae+=we,ae+=`\r
`}),ae}function vf(O,ae,we){e:{for(Be in we){var Be=!1;break e}Be=!0}Be||(we=ph(we),typeof O=="string"?we!=null&&encodeURIComponent(String(we)):Bs(O,ae,we))}function qi(O){ys.call(this),this.headers=new Map,this.o=O||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}V(qi,ys);var wf=/^https?$/i,bf=["POST","PUT"];t=qi.prototype,t.Ha=function(O){this.J=O},t.ea=function(O,ae,we,Be){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+O);ae=ae?ae.toUpperCase():"GET",this.D=O,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ze.g(),this.v=this.o?pl(this.o):pl(ze),this.g.onreadystatechange=R(this.Ea,this);try{this.B=!0,this.g.open(ae,String(O),!0),this.B=!1}catch(Qt){$u(this,Qt);return}if(O=we||"",we=new Map(this.headers),Be)if(Object.getPrototypeOf(Be)===Object.prototype)for(var Lt in Be)we.set(Lt,Be[Lt]);else if(typeof Be.keys=="function"&&typeof Be.get=="function")for(const Qt of Be.keys())we.set(Qt,Be.get(Qt));else throw Error("Unknown input type for opt_headers: "+String(Be));Be=Array.from(we.keys()).find(Qt=>Qt.toLowerCase()=="content-type"),Lt=a.FormData&&O instanceof a.FormData,!(0<=Array.prototype.indexOf.call(bf,ae,void 0))||Be||Lt||we.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Qt,zr]of we)this.g.setRequestHeader(Qt,zr);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{mh(this),this.u=!0,this.g.send(O),this.u=!1}catch(Qt){$u(this,Qt)}};function $u(O,ae){O.h=!1,O.g&&(O.j=!0,O.g.abort(),O.j=!1),O.l=ae,O.m=5,Vg(O),Mp(O)}function Vg(O){O.A||(O.A=!0,Es(O,"complete"),Es(O,"error"))}t.abort=function(O){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=O||7,Es(this,"complete"),Es(this,"abort"),Mp(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mp(this,!0)),qi.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Sf(this):this.bb())},t.bb=function(){Sf(this)};function Sf(O){if(O.h&&typeof p<"u"&&(!O.v[1]||Sa(O)!=4||O.Z()!=2)){if(O.u&&Sa(O)==4)io(O.Ea,0,O);else if(Es(O,"readystatechange"),Sa(O)==4){O.h=!1;try{const zr=O.Z();e:switch(zr){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ae=!0;break e;default:ae=!1}var we;if(!(we=ae)){var Be;if(Be=zr===0){var Lt=String(O.D).match(ml)[1]||null;!Lt&&a.self&&a.self.location&&(Lt=a.self.location.protocol.slice(0,-1)),Be=!wf.test(Lt?Lt.toLowerCase():"")}we=Be}if(we)Es(O,"complete"),Es(O,"success");else{O.m=6;try{var Qt=2<Sa(O)?O.g.statusText:""}catch{Qt=""}O.l=Qt+" ["+O.Z()+"]",Vg(O)}}finally{Mp(O)}}}}function Mp(O,ae){if(O.g){mh(O);const we=O.g,Be=O.v[0]?()=>{}:null;O.g=null,O.v=null,ae||Es(O,"ready");try{we.onreadystatechange=Be}catch{}}}function mh(O){O.I&&(a.clearTimeout(O.I),O.I=null)}t.isActive=function(){return!!this.g};function Sa(O){return O.g?O.g.readyState:0}t.Z=function(){try{return 2<Sa(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(O){if(this.g){var ae=this.g.responseText;return O&&ae.indexOf(O)==0&&(ae=ae.substring(O.length)),hh(ae)}};function gh(O){try{if(!O.g)return null;if("response"in O.g)return O.g.response;switch(O.H){case"":case"text":return O.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in O.g)return O.g.mozResponseArrayBuffer}return null}catch{return null}}function _h(O){const ae={};O=(O.g&&2<=Sa(O)&&O.g.getAllResponseHeaders()||"").split(`\r
`);for(let Be=0;Be<O.length;Be++){if($(O[Be]))continue;var we=Se(O[Be]);const Lt=we[0];if(we=we[1],typeof we!="string")continue;we=we.trim();const Qt=ae[Lt]||[];ae[Lt]=Qt,Qt.push(we)}pe(ae,function(Be){return Be.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function _u(O,ae,we){return we&&we.internalChannelParams&&we.internalChannelParams[O]||ae}function Oc(O){this.Aa=0,this.i=[],this.j=new Nn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=_u("failFast",!1,O),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=_u("baseRetryDelayMs",5e3,O),this.cb=_u("retryDelaySeedMs",1e4,O),this.Wa=_u("forwardChannelMaxRetries",2,O),this.wa=_u("forwardChannelRequestTimeoutMs",2e4,O),this.pa=O&&O.xmlHttpFactory||void 0,this.Xa=O&&O.Tb||void 0,this.Ca=O&&O.useFetchStreams||!1,this.L=void 0,this.J=O&&O.supportsCrossDomainXhr||!1,this.K="",this.h=new Ci(O&&O.concurrentRequestLimit),this.Da=new gd,this.P=O&&O.fastHandshake||!1,this.O=O&&O.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=O&&O.Rb||!1,O&&O.xa&&this.j.xa(),O&&O.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&O&&O.detectBufferingProxy||!1,this.ja=void 0,O&&O.longPollingTimeout&&0<O.longPollingTimeout&&(this.ja=O.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Oc.prototype,t.la=8,t.G=1,t.connect=function(O,ae,we,Be){ua(0),this.W=O,this.H=ae||{},we&&Be!==void 0&&(this.H.OSID=we,this.H.OAID=Be),this.F=this.X,this.I=qo(this,null,this.W),xh(this)};function Yi(O){if(Dp(O),O.G==3){var ae=O.U++,we=Ma(O.I);if(Bs(we,"SID",O.K),Bs(we,"RID",ae),Bs(we,"TYPE","terminate"),vh(O,we),ae=new We(O,O.j,ae),ae.L=2,ae.v=md(Ma(we)),we=!1,a.navigator&&a.navigator.sendBeacon)try{we=a.navigator.sendBeacon(ae.v.toString(),"")}catch{}!we&&a.Image&&(new Image().src=ae.v,we=!0),we||(ae.g=vd(ae.j,null),ae.g.ea(ae.v)),ae.F=Date.now(),Fr(ae)}Yn(O)}function yh(O){O.g&&(rc(O),O.g.cancel(),O.g=null)}function Dp(O){yh(O),O.u&&(a.clearTimeout(O.u),O.u=null),$o(O),O.h.cancel(),O.s&&(typeof O.s=="number"&&a.clearTimeout(O.s),O.s=null)}function xh(O){if(!bi(O.h)&&!O.s){O.s=!0;var ae=O.Ga;qe||it(),$e||(qe(),$e=!0),st.add(ae,O),O.B=0}}function os(O,ae){return fs(O.h)>=O.h.j-(O.s?1:0)?!1:O.s?(O.i=ae.D.concat(O.i),!0):O.G==1||O.G==2||O.B>=(O.Va?0:O.Wa)?!1:(O.s=uu(R(O.Ga,O,ae),Tr(O,O.B)),O.B++,!0)}t.Ga=function(O){if(this.s)if(this.s=null,this.G==1){if(!O){this.U=Math.floor(1e5*Math.random()),O=this.U++;const Lt=new We(this,this.j,O);let Qt=this.o;if(this.S&&(Qt?(Qt=ue(Qt),ce(Qt,this.S)):Qt=this.S),this.m!==null||this.O||(Lt.H=Qt,Qt=null),this.P)e:{for(var ae=0,we=0;we<this.i.length;we++){t:{var Be=this.i[we];if("__data__"in Be.map&&(Be=Be.map.__data__,typeof Be=="string")){Be=Be.length;break t}Be=void 0}if(Be===void 0)break;if(ae+=Be,4096<ae){ae=we;break e}if(ae===4096||we===this.i.length-1){ae=we+1;break e}}ae=1e3}else ae=1e3;ae=Ug(this,Lt,ae),we=Ma(this.I),Bs(we,"RID",O),Bs(we,"CVER",22),this.D&&Bs(we,"X-HTTP-Session-Id",this.D),vh(this,we),Qt&&(this.O?ae="headers="+encodeURIComponent(String(ph(Qt)))+"&"+ae:this.m&&vf(we,this.m,Qt)),zs(this.h,Lt),this.Ua&&Bs(we,"TYPE","init"),this.P?(Bs(we,"$req",ae),Bs(we,"SID","null"),Lt.T=!0,zt(Lt,we,null)):zt(Lt,we,ae),this.G=2}}else this.G==3&&(O?Op(this,O):this.i.length==0||bi(this.h)||Op(this))};function Op(O,ae){var we;ae?we=ae.l:we=O.U++;const Be=Ma(O.I);Bs(Be,"SID",O.K),Bs(Be,"RID",we),Bs(Be,"AID",O.T),vh(O,Be),O.m&&O.o&&vf(Be,O.m,O.o),we=new We(O,O.j,we,O.B+1),O.m===null&&(we.H=O.o),ae&&(O.i=ae.D.concat(O.i)),ae=Ug(O,we,1e3),we.I=Math.round(.5*O.wa)+Math.round(.5*O.wa*Math.random()),zs(O.h,we),zt(we,Be,ae)}function vh(O,ae){O.H&&ve(O.H,function(we,Be){Bs(ae,Be,we)}),O.l&&ao({},function(we,Be){Bs(ae,Be,we)})}function Ug(O,ae,we){we=Math.min(O.i.length,we);var Be=O.l?R(O.l.Na,O.l,O):null;e:{var Lt=O.i;let Qt=-1;for(;;){const zr=["count="+we];Qt==-1?0<we?(Qt=Lt[0].g,zr.push("ofs="+Qt)):Qt=0:zr.push("ofs="+Qt);let es=!0;for(let Ji=0;Ji<we;Ji++){let cs=Lt[Ji].g;const Va=Lt[Ji].map;if(cs-=Qt,0>cs)Qt=Math.max(0,Lt[Ji].g-100),es=!1;else try{Bg(Va,zr,"req"+cs+"_")}catch{Be&&Be(Va)}}if(es){Be=zr.join("&");break e}}}return O=O.i.splice(0,we),ae.D=O,Be}function Ur(O){if(!O.g&&!O.u){O.Y=1;var ae=O.Fa;qe||it(),$e||(qe(),$e=!0),st.add(ae,O),O.v=0}}function yd(O){return O.g||O.u||3<=O.v?!1:(O.Y++,O.u=uu(R(O.Fa,O),Tr(O,O.v)),O.v++,!0)}t.Fa=function(){if(this.u=null,_l(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var O=2*this.R;this.j.info("BP detection timer enabled: "+O),this.A=uu(R(this.ab,this),O)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ua(10),yh(this),_l(this))};function rc(O){O.A!=null&&(a.clearTimeout(O.A),O.A=null)}function _l(O){O.g=new We(O,O.j,"rpc",O.Y),O.m===null&&(O.g.H=O.o),O.g.O=0;var ae=Ma(O.qa);Bs(ae,"RID","rpc"),Bs(ae,"SID",O.K),Bs(ae,"AID",O.T),Bs(ae,"CI",O.F?"0":"1"),!O.F&&O.ja&&Bs(ae,"TO",O.ja),Bs(ae,"TYPE","xmlhttp"),vh(O,ae),O.m&&O.o&&vf(ae,O.m,O.o),O.L&&(O.g.I=O.L);var we=O.g;O=O.ia,we.L=1,we.v=md(Ma(ae)),we.m=null,we.P=!0,At(we,O)}t.Za=function(){this.C!=null&&(this.C=null,yh(this),yd(this),ua(19))};function $o(O){O.C!=null&&(a.clearTimeout(O.C),O.C=null)}function xd(O,ae){var we=null;if(O.g==ae){$o(O),rc(O),O.g=null;var Be=2}else if(Rn(O.h,ae))we=ae.D,ci(O.h,ae),Be=1;else return;if(O.G!=0){if(ae.o)if(Be==1){we=ae.m?ae.m.length:0,ae=Date.now()-ae.F;var Lt=O.B;Be=Bu(),Es(Be,new fh(Be,we)),xh(O)}else Ur(O);else if(Lt=ae.s,Lt==3||Lt==0&&0<ae.X||!(Be==1&&os(O,ae)||Be==2&&yd(O)))switch(we&&0<we.length&&(ae=O.h,ae.i=ae.i.concat(we)),Lt){case 1:Mn(O,5);break;case 4:Mn(O,10);break;case 3:Mn(O,6);break;default:Mn(O,2)}}}function Tr(O,ae){let we=O.Ta+Math.floor(Math.random()*O.cb);return O.isActive()||(we*=2),we*ae}function Mn(O,ae){if(O.j.info("Error code "+ae),ae==2){var we=R(O.fb,O),Be=O.Xa;const Lt=!Be;Be=new Mi(Be||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||za(Be,"https"),md(Be),Lt?kl(Be.toString(),we):zg(Be.toString(),we)}else ua(2);O.G=0,O.l&&O.l.sa(ae),Yn(O),Dp(O)}t.fb=function(O){O?(this.j.info("Successfully pinged google.com"),ua(2)):(this.j.info("Failed to ping google.com"),ua(1))};function Yn(O){if(O.G=0,O.ka=[],O.l){const ae=bs(O.h);(ae.length!=0||O.i.length!=0)&&(K(O.ka,ae),K(O.ka,O.i),O.h.i.length=0,W(O.i),O.i.length=0),O.l.ra()}}function qo(O,ae,we){var Be=we instanceof Mi?Ma(we):new Mi(we);if(Be.g!="")ae&&(Be.g=ae+"."+Be.g),el(Be,Be.s);else{var Lt=a.location;Be=Lt.protocol,ae=ae?ae+"."+Lt.hostname:Lt.hostname,Lt=+Lt.port;var Qt=new Mi(null);Be&&za(Qt,Be),ae&&(Qt.g=ae),Lt&&el(Qt,Lt),we&&(Qt.l=we),Be=Qt}return we=O.D,ae=O.ya,we&&ae&&Bs(Be,we,ae),Bs(Be,"VER",O.la),vh(O,Be),Be}function vd(O,ae,we){if(ae&&!O.J)throw Error("Can't create secondary domain capable XhrIo object.");return ae=O.Ca&&!O.pa?new qi(new Uu({eb:we})):new qi(O.pa),ae.Ha(O.J),ae}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function ls(){}t=ls.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function qu(){}qu.prototype.g=function(O,ae){return new Ba(O,ae)};function Ba(O,ae){ys.call(this),this.g=new Oc(ae),this.l=O,this.h=ae&&ae.messageUrlParams||null,O=ae&&ae.messageHeaders||null,ae&&ae.clientProtocolHeaderRequired&&(O?O["X-Client-Protocol"]="webchannel":O={"X-Client-Protocol":"webchannel"}),this.g.o=O,O=ae&&ae.initMessageHeaders||null,ae&&ae.messageContentType&&(O?O["X-WebChannel-Content-Type"]=ae.messageContentType:O={"X-WebChannel-Content-Type":ae.messageContentType}),ae&&ae.va&&(O?O["X-WebChannel-Client-Profile"]=ae.va:O={"X-WebChannel-Client-Profile":ae.va}),this.g.S=O,(O=ae&&ae.Sb)&&!$(O)&&(this.g.m=O),this.v=ae&&ae.supportsCrossDomainXhr||!1,this.u=ae&&ae.sendRawJson||!1,(ae=ae&&ae.httpSessionIdParam)&&!$(ae)&&(this.g.D=ae,O=this.h,O!==null&&ae in O&&(O=this.h,ae in O&&delete O[ae])),this.j=new Ai(this)}V(Ba,ys),Ba.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ba.prototype.close=function(){Yi(this.g)},Ba.prototype.o=function(O){var ae=this.g;if(typeof O=="string"){var we={};we.__data__=O,O=we}else this.u&&(we={},we.__data__=Pl(O),O=we);ae.i.push(new Xi(ae.Ya++,O)),ae.G==3&&xh(ae)},Ba.prototype.N=function(){this.g.l=null,delete this.j,Yi(this.g),delete this.g,Ba.aa.N.call(this)};function wh(O){cu.call(this),O.__headers__&&(this.headers=O.__headers__,this.statusCode=O.__status__,delete O.__headers__,delete O.__status__);var ae=O.__sm__;if(ae){e:{for(const we in ae){O=we;break e}O=void 0}(this.i=O)&&(O=this.i,ae=ae!==null&&O in ae?ae[O]:void 0),this.data=ae}else this.data=O}V(wh,cu);function Ea(){Rc.call(this),this.status=1}V(Ea,Rc);function Ai(O){this.g=O}V(Ai,ls),Ai.prototype.ua=function(){Es(this.g,"a")},Ai.prototype.ta=function(O){Es(this.g,new wh(O))},Ai.prototype.sa=function(O){Es(this.g,new Ea)},Ai.prototype.ra=function(){Es(this.g,"b")},qu.prototype.createWebChannel=qu.prototype.g,Ba.prototype.send=Ba.prototype.o,Ba.prototype.open=Ba.prototype.m,Ba.prototype.close=Ba.prototype.close,GG=function(){return new qu},qG=function(){return Bu()},$G=Fa,xD={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},he.NO_ERROR=0,he.TIMEOUT=8,he.HTTP_ERROR=6,Yj=he,Ne.COMPLETE="complete",UG=Ne,oi.EventType=pa,pa.OPEN="a",pa.CLOSE="b",pa.ERROR="c",pa.MESSAGE="d",ys.prototype.listen=ys.prototype.K,L1=oi,qi.prototype.listenOnce=qi.prototype.L,qi.prototype.getLastError=qi.prototype.Ka,qi.prototype.getLastErrorCode=qi.prototype.Ba,qi.prototype.getStatus=qi.prototype.Z,qi.prototype.getResponseJson=qi.prototype.Oa,qi.prototype.getResponseText=qi.prototype.oa,qi.prototype.send=qi.prototype.ea,qi.prototype.setWithCredentials=qi.prototype.Ha,VG=qi}).apply(typeof cj<"u"?cj:typeof self<"u"?self:typeof window<"u"?window:{});const uU="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ul=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ul.UNAUTHENTICATED=new Ul(null),Ul.GOOGLE_CREDENTIALS=new Ul("google-credentials-uid"),Ul.FIRST_PARTY=new Ul("first-party-uid"),Ul.MOCK_USER=new Ul("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Q0="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy=new dC("@firebase/firestore");function b1(){return oy.logLevel}function An(t,...e){if(oy.logLevel<=wi.DEBUG){const r=e.map(BL);oy.debug(`Firestore (${Q0}): ${t}`,...r)}}function yp(t,...e){if(oy.logLevel<=wi.ERROR){const r=e.map(BL);oy.error(`Firestore (${Q0}): ${t}`,...r)}}function ly(t,...e){if(oy.logLevel<=wi.WARN){const r=e.map(BL);oy.warn(`Firestore (${Q0}): ${t}`,...r)}}function BL(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function js(t="Unexpected state"){const e=`FIRESTORE (${Q0}) INTERNAL ASSERTION FAILED: `+t;throw yp(e),new Error(e)}function sa(t,e){t||js()}function Ds(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rn extends dd{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HG{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class WG{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(Ul.UNAUTHENTICATED))}shutdown(){}}class Gfe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class Hfe{constructor(e){this.t=e,this.currentUser=Ul.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){sa(this.o===void 0);let n=this.i;const c=w=>this.i!==n?(n=this.i,r(w)):Promise.resolve();let d=new op;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new op,e.enqueueRetryable(()=>c(this.currentUser))};const p=()=>{const w=d;e.enqueueRetryable(async()=>{await w.promise,await c(this.currentUser)})},a=w=>{An("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=w,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(w=>a(w)),setTimeout(()=>{if(!this.auth){const w=this.t.getImmediate({optional:!0});w?a(w):(An("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new op)}},0),p()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(n=>this.i!==e?(An("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(sa(typeof n.accessToken=="string"),new HG(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return sa(e===null||typeof e=="string"),new Ul(e)}}class Wfe{constructor(e,r,n){this.l=e,this.h=r,this.P=n,this.type="FirstParty",this.user=Ul.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Zfe{constructor(e,r,n){this.l=e,this.h=r,this.P=n}getToken(){return Promise.resolve(new Wfe(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(Ul.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Kfe{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xfe{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){sa(this.o===void 0);const n=d=>{d.error!=null&&An("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const p=d.token!==this.R;return this.R=d.token,An("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?r(d.token):Promise.resolve()};this.o=d=>{e.enqueueRetryable(()=>n(d))};const c=d=>{An("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>c(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?c(d):An("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(sa(typeof r.token=="string"),this.R=r.token,new Kfe(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yfe(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let n=0;n<t;n++)r[n]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VL{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const c=Yfe(40);for(let d=0;d<c.length;++d)n.length<20&&c[d]<r&&(n+=e.charAt(c[d]%e.length))}return n}}function Li(t,e){return t<e?-1:t>e?1:0}function b0(t,e,r){return t.length===e.length&&t.every((n,c)=>r(n,e[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new rn(fr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new rn(fr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new rn(fr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new rn(fr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Lo.fromMillis(Date.now())}static fromDate(e){return Lo.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*r));return new Lo(r,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Li(this.nanoseconds,e.nanoseconds):Li(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ks(e)}static min(){return new ks(new Lo(0,0))}static max(){return new ks(new Lo(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(e,r,n){r===void 0?r=0:r>e.length&&js(),n===void 0?n=e.length-r:n>e.length-r&&js(),this.segments=e,this.offset=r,this.len=n}get length(){return this.len}isEqual(e){return LS.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof LS?e.forEach(n=>{r.push(n)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,n=this.limit();r<n;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const n=Math.min(e.length,r.length);for(let c=0;c<n;c++){const d=e.get(c),p=r.get(c);if(d<p)return-1;if(d>p)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class _a extends LS{construct(e,r,n){return new _a(e,r,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const n of e){if(n.indexOf("//")>=0)throw new rn(fr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);r.push(...n.split("/").filter(c=>c.length>0))}return new _a(r)}static emptyPath(){return new _a([])}}const Jfe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ll extends LS{construct(e,r,n){return new ll(e,r,n)}static isValidIdentifier(e){return Jfe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ll.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ll(["__name__"])}static fromServerFormat(e){const r=[];let n="",c=0;const d=()=>{if(n.length===0)throw new rn(fr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(n),n=""};let p=!1;for(;c<e.length;){const a=e[c];if(a==="\\"){if(c+1===e.length)throw new rn(fr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const w=e[c+1];if(w!=="\\"&&w!=="."&&w!=="`")throw new rn(fr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=w,c+=2}else a==="`"?(p=!p,c++):a!=="."||p?(n+=a,c++):(d(),c++)}if(d(),p)throw new rn(fr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ll(r)}static emptyPath(){return new ll([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e){this.path=e}static fromPath(e){return new zn(_a.fromString(e))}static fromName(e){return new zn(_a.fromString(e).popFirst(5))}static empty(){return new zn(_a.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&_a.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return _a.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new zn(new _a(e.slice()))}}function Qfe(t,e){const r=t.toTimestamp().seconds,n=t.toTimestamp().nanoseconds+1,c=ks.fromTimestamp(n===1e9?new Lo(r+1,0):new Lo(r,n));return new ug(c,zn.empty(),e)}function epe(t){return new ug(t.readTime,t.key,-1)}class ug{constructor(e,r,n){this.readTime=e,this.documentKey=r,this.largestBatchId=n}static min(){return new ug(ks.min(),zn.empty(),-1)}static max(){return new ug(ks.max(),zn.empty(),-1)}}function tpe(t,e){let r=t.readTime.compareTo(e.readTime);return r!==0?r:(r=zn.comparator(t.documentKey,e.documentKey),r!==0?r:Li(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rpe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class npe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NE(t){if(t.code!==fr.FAILED_PRECONDITION||t.message!==rpe)throw t;An("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&js(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new Cr((n,c)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(n,c)},this.catchCallback=d=>{this.wrapFailure(r,d).next(n,c)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof Cr?r:Cr.resolve(r)}catch(r){return Cr.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):Cr.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):Cr.reject(r)}static resolve(e){return new Cr((r,n)=>{r(e)})}static reject(e){return new Cr((r,n)=>{n(e)})}static waitFor(e){return new Cr((r,n)=>{let c=0,d=0,p=!1;e.forEach(a=>{++c,a.next(()=>{++d,p&&d===c&&r()},w=>n(w))}),p=!0,d===c&&r()})}static or(e){let r=Cr.resolve(!1);for(const n of e)r=r.next(c=>c?Cr.resolve(c):n());return r}static forEach(e,r){const n=[];return e.forEach((c,d)=>{n.push(r.call(this,c,d))}),this.waitFor(n)}static mapArray(e,r){return new Cr((n,c)=>{const d=e.length,p=new Array(d);let a=0;for(let w=0;w<d;w++){const E=w;r(e[E]).next(C=>{p[E]=C,++a,a===d&&n(p)},C=>c(C))}})}static doWhile(e,r){return new Cr((n,c)=>{const d=()=>{e()===!0?r().next(()=>{d()},c):n()};d()})}}function spe(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function IE(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UL{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=n=>this.ie(n),this.se=n=>r.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}UL.oe=-1;function gC(t){return t==null}function WN(t){return t===0&&1/t==-1/0}function ipe(t){return typeof t=="number"&&Number.isInteger(t)&&!WN(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dU(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function My(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function ZG(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(e,r){this.comparator=e,this.root=r||bl.EMPTY}insert(e,r){return new no(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,bl.BLACK,null,null))}remove(e){return new no(this.comparator,this.root.remove(e,this.comparator).copy(null,null,bl.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const n=this.comparator(e,r.key);if(n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}indexOf(e){let r=0,n=this.root;for(;!n.isEmpty();){const c=this.comparator(e,n.key);if(c===0)return r+n.left.size;c<0?n=n.left:(r+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,n)=>(e(r,n),!1))}toString(){const e=[];return this.inorderTraversal((r,n)=>(e.push(`${r}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new uj(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new uj(this.root,e,this.comparator,!1)}getReverseIterator(){return new uj(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new uj(this.root,e,this.comparator,!0)}}class uj{constructor(e,r,n,c){this.isReverse=c,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=r?n(e.key,r):1,r&&c&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class bl{constructor(e,r,n,c,d){this.key=e,this.value=r,this.color=n??bl.RED,this.left=c??bl.EMPTY,this.right=d??bl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,n,c,d){return new bl(e??this.key,r??this.value,n??this.color,c??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,n){let c=this;const d=n(e,c.key);return c=d<0?c.copy(null,null,null,c.left.insert(e,r,n),null):d===0?c.copy(null,r,null,null,null):c.copy(null,null,null,null,c.right.insert(e,r,n)),c.fixUp()}removeMin(){if(this.left.isEmpty())return bl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let n,c=this;if(r(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,r),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),r(e,c.key)===0){if(c.right.isEmpty())return bl.EMPTY;n=c.right.min(),c=c.copy(n.key,n.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,r))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,bl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,bl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw js();const e=this.left.check();if(e!==this.right.check())throw js();return e+(this.isRed()?0:1)}}bl.EMPTY=null,bl.RED=!0,bl.BLACK=!1;bl.EMPTY=new class{constructor(){this.size=0}get key(){throw js()}get value(){throw js()}get color(){throw js()}get left(){throw js()}get right(){throw js()}copy(e,r,n,c,d){return this}insert(e,r,n){return new bl(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl{constructor(e){this.comparator=e,this.data=new no(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,n)=>(e(r),!1))}forEachInRange(e,r){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const c=n.getNext();if(this.comparator(c.key,e[1])>=0)return;r(c.key)}}forEachWhile(e,r){let n;for(n=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new hU(this.data.getIterator())}getIteratorFrom(e){return new hU(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(n=>{r=r.add(n)}),r}isEqual(e){if(!(e instanceof Tl)||this.size!==e.size)return!1;const r=this.data.getIterator(),n=e.data.getIterator();for(;r.hasNext();){const c=r.getNext().key,d=n.getNext().key;if(this.comparator(c,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new Tl(this.comparator);return r.data=e,r}}class hU{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(e){this.fields=e,e.sort(ll.comparator)}static empty(){return new Iu([])}unionWith(e){let r=new Tl(ll.comparator);for(const n of this.fields)r=r.add(n);for(const n of e)r=r.add(n);return new Iu(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return b0(this.fields,e.fields,(r,n)=>r.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(c){try{return atob(c)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new KG("Invalid base64 string: "+d):d}}(e);return new hl(r)}static fromUint8Array(e){const r=function(c){let d="";for(let p=0;p<c.length;++p)d+=String.fromCharCode(c[p]);return d}(e);return new hl(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const n=new Uint8Array(r.length);for(let c=0;c<r.length;c++)n[c]=r.charCodeAt(c);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Li(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}hl.EMPTY_BYTE_STRING=new hl("");const ape=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function dg(t){if(sa(!!t),typeof t=="string"){let e=0;const r=ape.exec(t);if(sa(!!r),r[1]){let c=r[1];c=(c+"000000000").substr(0,9),e=Number(c)}const n=new Date(t);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:wo(t.seconds),nanos:wo(t.nanos)}}function wo(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function cy(t){return typeof t=="string"?hl.fromBase64String(t):hl.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _C(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function $L(t){const e=t.mapValue.fields.__previous_value__;return _C(e)?$L(e):e}function FS(t){const e=dg(t.mapValue.fields.__local_write_time__.timestampValue);return new Lo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ope{constructor(e,r,n,c,d,p,a,w,E){this.databaseId=e,this.appId=r,this.persistenceKey=n,this.host=c,this.ssl=d,this.forceLongPolling=p,this.autoDetectLongPolling=a,this.longPollingOptions=w,this.useFetchStreams=E}}class S0{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new S0("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof S0&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dj={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function uy(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?_C(t)?4:cpe(t)?9007199254740991:lpe(t)?10:11:js()}function sf(t,e){if(t===e)return!0;const r=uy(t);if(r!==uy(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return FS(t).isEqual(FS(e));case 3:return function(c,d){if(typeof c.timestampValue=="string"&&typeof d.timestampValue=="string"&&c.timestampValue.length===d.timestampValue.length)return c.timestampValue===d.timestampValue;const p=dg(c.timestampValue),a=dg(d.timestampValue);return p.seconds===a.seconds&&p.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(c,d){return cy(c.bytesValue).isEqual(cy(d.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(c,d){return wo(c.geoPointValue.latitude)===wo(d.geoPointValue.latitude)&&wo(c.geoPointValue.longitude)===wo(d.geoPointValue.longitude)}(t,e);case 2:return function(c,d){if("integerValue"in c&&"integerValue"in d)return wo(c.integerValue)===wo(d.integerValue);if("doubleValue"in c&&"doubleValue"in d){const p=wo(c.doubleValue),a=wo(d.doubleValue);return p===a?WN(p)===WN(a):isNaN(p)&&isNaN(a)}return!1}(t,e);case 9:return b0(t.arrayValue.values||[],e.arrayValue.values||[],sf);case 10:case 11:return function(c,d){const p=c.mapValue.fields||{},a=d.mapValue.fields||{};if(dU(p)!==dU(a))return!1;for(const w in p)if(p.hasOwnProperty(w)&&(a[w]===void 0||!sf(p[w],a[w])))return!1;return!0}(t,e);default:return js()}}function zS(t,e){return(t.values||[]).find(r=>sf(r,e))!==void 0}function E0(t,e){if(t===e)return 0;const r=uy(t),n=uy(e);if(r!==n)return Li(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return Li(t.booleanValue,e.booleanValue);case 2:return function(d,p){const a=wo(d.integerValue||d.doubleValue),w=wo(p.integerValue||p.doubleValue);return a<w?-1:a>w?1:a===w?0:isNaN(a)?isNaN(w)?0:-1:1}(t,e);case 3:return fU(t.timestampValue,e.timestampValue);case 4:return fU(FS(t),FS(e));case 5:return Li(t.stringValue,e.stringValue);case 6:return function(d,p){const a=cy(d),w=cy(p);return a.compareTo(w)}(t.bytesValue,e.bytesValue);case 7:return function(d,p){const a=d.split("/"),w=p.split("/");for(let E=0;E<a.length&&E<w.length;E++){const C=Li(a[E],w[E]);if(C!==0)return C}return Li(a.length,w.length)}(t.referenceValue,e.referenceValue);case 8:return function(d,p){const a=Li(wo(d.latitude),wo(p.latitude));return a!==0?a:Li(wo(d.longitude),wo(p.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return pU(t.arrayValue,e.arrayValue);case 10:return function(d,p){var a,w,E,C;const P=d.fields||{},R=p.fields||{},B=(a=P.value)===null||a===void 0?void 0:a.arrayValue,V=(w=R.value)===null||w===void 0?void 0:w.arrayValue,W=Li(((E=B==null?void 0:B.values)===null||E===void 0?void 0:E.length)||0,((C=V==null?void 0:V.values)===null||C===void 0?void 0:C.length)||0);return W!==0?W:pU(B,V)}(t.mapValue,e.mapValue);case 11:return function(d,p){if(d===dj.mapValue&&p===dj.mapValue)return 0;if(d===dj.mapValue)return 1;if(p===dj.mapValue)return-1;const a=d.fields||{},w=Object.keys(a),E=p.fields||{},C=Object.keys(E);w.sort(),C.sort();for(let P=0;P<w.length&&P<C.length;++P){const R=Li(w[P],C[P]);if(R!==0)return R;const B=E0(a[w[P]],E[C[P]]);if(B!==0)return B}return Li(w.length,C.length)}(t.mapValue,e.mapValue);default:throw js()}}function fU(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Li(t,e);const r=dg(t),n=dg(e),c=Li(r.seconds,n.seconds);return c!==0?c:Li(r.nanos,n.nanos)}function pU(t,e){const r=t.values||[],n=e.values||[];for(let c=0;c<r.length&&c<n.length;++c){const d=E0(r[c],n[c]);if(d)return d}return Li(r.length,n.length)}function T0(t){return vD(t)}function vD(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const n=dg(r);return`time(${n.seconds},${n.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(r){return cy(r).toBase64()}(t.bytesValue):"referenceValue"in t?function(r){return zn.fromName(r).toString()}(t.referenceValue):"geoPointValue"in t?function(r){return`geo(${r.latitude},${r.longitude})`}(t.geoPointValue):"arrayValue"in t?function(r){let n="[",c=!0;for(const d of r.values||[])c?c=!1:n+=",",n+=vD(d);return n+"]"}(t.arrayValue):"mapValue"in t?function(r){const n=Object.keys(r.fields||{}).sort();let c="{",d=!0;for(const p of n)d?d=!1:c+=",",c+=`${p}:${vD(r.fields[p])}`;return c+"}"}(t.mapValue):js()}function ZN(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function wD(t){return!!t&&"integerValue"in t}function qL(t){return!!t&&"arrayValue"in t}function mU(t){return!!t&&"nullValue"in t}function gU(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Jj(t){return!!t&&"mapValue"in t}function lpe(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function nS(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return My(t.mapValue.fields,(r,n)=>e.mapValue.fields[r]=nS(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=nS(t.arrayValue.values[r]);return e}return Object.assign({},t)}function cpe(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e){this.value=e}static empty(){return new Xc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let n=0;n<e.length-1;++n)if(r=(r.mapValue.fields||{})[e.get(n)],!Jj(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=nS(r)}setAll(e){let r=ll.emptyPath(),n={},c=[];e.forEach((p,a)=>{if(!r.isImmediateParentOf(a)){const w=this.getFieldsMap(r);this.applyChanges(w,n,c),n={},c=[],r=a.popLast()}p?n[a.lastSegment()]=nS(p):c.push(a.lastSegment())});const d=this.getFieldsMap(r);this.applyChanges(d,n,c)}delete(e){const r=this.field(e.popLast());Jj(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return sf(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let n=0;n<e.length;++n){let c=r.mapValue.fields[e.get(n)];Jj(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},r.mapValue.fields[e.get(n)]=c),r=c}return r.mapValue.fields}applyChanges(e,r,n){My(r,(c,d)=>e[c]=d);for(const c of n)delete e[c]}clone(){return new Xc(nS(this.value))}}function XG(t){const e=[];return My(t.fields,(r,n)=>{const c=new ll([r]);if(Jj(n)){const d=XG(n.mapValue).fields;if(d.length===0)e.push(c);else for(const p of d)e.push(c.child(p))}else e.push(c)}),new Iu(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e,r,n,c,d,p,a){this.key=e,this.documentType=r,this.version=n,this.readTime=c,this.createTime=d,this.data=p,this.documentState=a}static newInvalidDocument(e){return new ql(e,0,ks.min(),ks.min(),ks.min(),Xc.empty(),0)}static newFoundDocument(e,r,n,c){return new ql(e,1,r,ks.min(),n,c,0)}static newNoDocument(e,r){return new ql(e,2,r,ks.min(),ks.min(),Xc.empty(),0)}static newUnknownDocument(e,r){return new ql(e,3,r,ks.min(),ks.min(),Xc.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(ks.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Xc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Xc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ks.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ql&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ql(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0{constructor(e,r){this.position=e,this.inclusive=r}}function _U(t,e,r){let n=0;for(let c=0;c<t.position.length;c++){const d=e[c],p=t.position[c];if(d.field.isKeyField()?n=zn.comparator(zn.fromName(p.referenceValue),r.key):n=E0(p,r.data.field(d.field)),d.dir==="desc"&&(n*=-1),n!==0)break}return n}function yU(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let r=0;r<t.position.length;r++)if(!sf(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(e,r="asc"){this.field=e,this.dir=r}}function upe(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let YG=class{};class Mo extends YG{constructor(e,r,n){super(),this.field=e,this.op=r,this.value=n}static create(e,r,n){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,n):new hpe(e,r,n):r==="array-contains"?new mpe(e,n):r==="in"?new gpe(e,n):r==="not-in"?new _pe(e,n):r==="array-contains-any"?new ype(e,n):new Mo(e,r,n)}static createKeyFieldInFilter(e,r,n){return r==="in"?new fpe(e,n):new ppe(e,n)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(E0(r,this.value)):r!==null&&uy(this.value)===uy(r)&&this.matchesComparison(E0(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return js()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rh extends YG{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new rh(e,r)}matches(e){return JG(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function JG(t){return t.op==="and"}function QG(t){return dpe(t)&&JG(t)}function dpe(t){for(const e of t.filters)if(e instanceof rh)return!1;return!0}function bD(t){if(t instanceof Mo)return t.field.canonicalString()+t.op.toString()+T0(t.value);if(QG(t))return t.filters.map(e=>bD(e)).join(",");{const e=t.filters.map(r=>bD(r)).join(",");return`${t.op}(${e})`}}function eH(t,e){return t instanceof Mo?function(n,c){return c instanceof Mo&&n.op===c.op&&n.field.isEqual(c.field)&&sf(n.value,c.value)}(t,e):t instanceof rh?function(n,c){return c instanceof rh&&n.op===c.op&&n.filters.length===c.filters.length?n.filters.reduce((d,p,a)=>d&&eH(p,c.filters[a]),!0):!1}(t,e):void js()}function tH(t){return t instanceof Mo?function(r){return`${r.field.canonicalString()} ${r.op} ${T0(r.value)}`}(t):t instanceof rh?function(r){return r.op.toString()+" {"+r.getFilters().map(tH).join(" ,")+"}"}(t):"Filter"}class hpe extends Mo{constructor(e,r,n){super(e,r,n),this.key=zn.fromName(n.referenceValue)}matches(e){const r=zn.comparator(e.key,this.key);return this.matchesComparison(r)}}class fpe extends Mo{constructor(e,r){super(e,"in",r),this.keys=rH("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class ppe extends Mo{constructor(e,r){super(e,"not-in",r),this.keys=rH("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function rH(t,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(n=>zn.fromName(n.referenceValue))}class mpe extends Mo{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return qL(r)&&zS(r.arrayValue,this.value)}}class gpe extends Mo{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&zS(this.value.arrayValue,r)}}class _pe extends Mo{constructor(e,r){super(e,"not-in",r)}matches(e){if(zS(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!zS(this.value.arrayValue,r)}}class ype extends Mo{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!qL(r)||!r.arrayValue.values)&&r.arrayValue.values.some(n=>zS(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xpe{constructor(e,r=null,n=[],c=[],d=null,p=null,a=null){this.path=e,this.collectionGroup=r,this.orderBy=n,this.filters=c,this.limit=d,this.startAt=p,this.endAt=a,this.ue=null}}function xU(t,e=null,r=[],n=[],c=null,d=null,p=null){return new xpe(t,e,r,n,c,d,p)}function GL(t){const e=Ds(t);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(n=>bD(n)).join(","),r+="|ob:",r+=e.orderBy.map(n=>function(d){return d.field.canonicalString()+d.dir}(n)).join(","),gC(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(n=>T0(n)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(n=>T0(n)).join(",")),e.ue=r}return e.ue}function HL(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<t.orderBy.length;r++)if(!upe(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(!eH(t.filters[r],e.filters[r]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!yU(t.startAt,e.startAt)&&yU(t.endAt,e.endAt)}function SD(t){return zn.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dy{constructor(e,r=null,n=[],c=[],d=null,p="F",a=null,w=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=n,this.filters=c,this.limit=d,this.limitType=p,this.startAt=a,this.endAt=w,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function vpe(t,e,r,n,c,d,p,a){return new Dy(t,e,r,n,c,d,p,a)}function yC(t){return new Dy(t)}function vU(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function WL(t){return t.collectionGroup!==null}function r0(t){const e=Ds(t);if(e.ce===null){e.ce=[];const r=new Set;for(const d of e.explicitOrderBy)e.ce.push(d),r.add(d.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let a=new Tl(ll.comparator);return p.filters.forEach(w=>{w.getFlattenedFilters().forEach(E=>{E.isInequality()&&(a=a.add(E.field))})}),a})(e).forEach(d=>{r.has(d.canonicalString())||d.isKeyField()||e.ce.push(new BS(d,n))}),r.has(ll.keyField().canonicalString())||e.ce.push(new BS(ll.keyField(),n))}return e.ce}function tf(t){const e=Ds(t);return e.le||(e.le=wpe(e,r0(t))),e.le}function wpe(t,e){if(t.limitType==="F")return xU(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(c=>{const d=c.dir==="desc"?"asc":"desc";return new BS(c.field,d)});const r=t.endAt?new j0(t.endAt.position,t.endAt.inclusive):null,n=t.startAt?new j0(t.startAt.position,t.startAt.inclusive):null;return xU(t.path,t.collectionGroup,e,t.filters,t.limit,r,n)}}function ED(t,e){const r=t.filters.concat([e]);return new Dy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),r,t.limit,t.limitType,t.startAt,t.endAt)}function KN(t,e,r){return new Dy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function xC(t,e){return HL(tf(t),tf(e))&&t.limitType===e.limitType}function nH(t){return`${GL(tf(t))}|lt:${t.limitType}`}function Ev(t){return`Query(target=${function(r){let n=r.path.canonicalString();return r.collectionGroup!==null&&(n+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(n+=`, filters: [${r.filters.map(c=>tH(c)).join(", ")}]`),gC(r.limit)||(n+=", limit: "+r.limit),r.orderBy.length>0&&(n+=`, orderBy: [${r.orderBy.map(c=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(c)).join(", ")}]`),r.startAt&&(n+=", startAt: ",n+=r.startAt.inclusive?"b:":"a:",n+=r.startAt.position.map(c=>T0(c)).join(",")),r.endAt&&(n+=", endAt: ",n+=r.endAt.inclusive?"a:":"b:",n+=r.endAt.position.map(c=>T0(c)).join(",")),`Target(${n})`}(tf(t))}; limitType=${t.limitType})`}function vC(t,e){return e.isFoundDocument()&&function(n,c){const d=c.key.path;return n.collectionGroup!==null?c.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(d):zn.isDocumentKey(n.path)?n.path.isEqual(d):n.path.isImmediateParentOf(d)}(t,e)&&function(n,c){for(const d of r0(n))if(!d.field.isKeyField()&&c.data.field(d.field)===null)return!1;return!0}(t,e)&&function(n,c){for(const d of n.filters)if(!d.matches(c))return!1;return!0}(t,e)&&function(n,c){return!(n.startAt&&!function(p,a,w){const E=_U(p,a,w);return p.inclusive?E<=0:E<0}(n.startAt,r0(n),c)||n.endAt&&!function(p,a,w){const E=_U(p,a,w);return p.inclusive?E>=0:E>0}(n.endAt,r0(n),c))}(t,e)}function bpe(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function sH(t){return(e,r)=>{let n=!1;for(const c of r0(t)){const d=Spe(c,e,r);if(d!==0)return d;n=n||c.field.isKeyField()}return 0}}function Spe(t,e,r){const n=t.field.isKeyField()?zn.comparator(e.key,r.key):function(d,p,a){const w=p.data.field(d),E=a.data.field(d);return w!==null&&E!==null?E0(w,E):js()}(t.field,e,r);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return js()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),n=this.inner[r];if(n!==void 0){for(const[c,d]of n)if(this.equalsFn(c,e))return d}}has(e){return this.get(e)!==void 0}set(e,r){const n=this.mapKeyFn(e),c=this.inner[n];if(c===void 0)return this.inner[n]=[[e,r]],void this.innerSize++;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],e))return void(c[d]=[e,r]);c.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),n=this.inner[r];if(n===void 0)return!1;for(let c=0;c<n.length;c++)if(this.equalsFn(n[c][0],e))return n.length===1?delete this.inner[r]:n.splice(c,1),this.innerSize--,!0;return!1}forEach(e){My(this.inner,(r,n)=>{for(const[c,d]of n)e(c,d)})}isEmpty(){return ZG(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Epe=new no(zn.comparator);function xp(){return Epe}const iH=new no(zn.comparator);function F1(...t){let e=iH;for(const r of t)e=e.insert(r.key,r);return e}function aH(t){let e=iH;return t.forEach((r,n)=>e=e.insert(r,n.overlayedDocument)),e}function z_(){return sS()}function oH(){return sS()}function sS(){return new ew(t=>t.toString(),(t,e)=>t.isEqual(e))}const Tpe=new no(zn.comparator),jpe=new Tl(zn.comparator);function _i(...t){let e=jpe;for(const r of t)e=e.add(r);return e}const Npe=new Tl(Li);function Ipe(){return Npe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZL(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:WN(e)?"-0":e}}function lH(t){return{integerValue:""+t}}function cH(t,e){return ipe(e)?lH(e):ZL(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wC{constructor(){this._=void 0}}function Cpe(t,e,r){return t instanceof VS?function(c,d){const p={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return d&&_C(d)&&(d=$L(d)),d&&(p.fields.__previous_value__=d),{mapValue:p}}(r,e):t instanceof US?dH(t,e):t instanceof $S?hH(t,e):function(c,d){const p=uH(c,d),a=wU(p)+wU(c.Pe);return wD(p)&&wD(c.Pe)?lH(a):ZL(c.serializer,a)}(t,e)}function Ape(t,e,r){return t instanceof US?dH(t,e):t instanceof $S?hH(t,e):r}function uH(t,e){return t instanceof qS?function(n){return wD(n)||function(d){return!!d&&"doubleValue"in d}(n)}(e)?e:{integerValue:0}:null}class VS extends wC{}class US extends wC{constructor(e){super(),this.elements=e}}function dH(t,e){const r=fH(e);for(const n of t.elements)r.some(c=>sf(c,n))||r.push(n);return{arrayValue:{values:r}}}class $S extends wC{constructor(e){super(),this.elements=e}}function hH(t,e){let r=fH(e);for(const n of t.elements)r=r.filter(c=>!sf(c,n));return{arrayValue:{values:r}}}class qS extends wC{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function wU(t){return wo(t.integerValue||t.doubleValue)}function fH(t){return qL(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pH{constructor(e,r){this.field=e,this.transform=r}}function Ppe(t,e){return t.field.isEqual(e.field)&&function(n,c){return n instanceof US&&c instanceof US||n instanceof $S&&c instanceof $S?b0(n.elements,c.elements,sf):n instanceof qS&&c instanceof qS?sf(n.Pe,c.Pe):n instanceof VS&&c instanceof VS}(t.transform,e.transform)}class kpe{constructor(e,r){this.version=e,this.transformResults=r}}class Nc{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new Nc}static exists(e){return new Nc(void 0,e)}static updateTime(e){return new Nc(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Qj(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class bC{}function mH(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new SC(t.key,Nc.none()):new CE(t.key,t.data,Nc.none());{const r=t.data,n=Xc.empty();let c=new Tl(ll.comparator);for(let d of e.fields)if(!c.has(d)){let p=r.field(d);p===null&&d.length>1&&(d=d.popLast(),p=r.field(d)),p===null?n.delete(d):n.set(d,p),c=c.add(d)}return new Cg(t.key,n,new Iu(c.toArray()),Nc.none())}}function Rpe(t,e,r){t instanceof CE?function(c,d,p){const a=c.value.clone(),w=SU(c.fieldTransforms,d,p.transformResults);a.setAll(w),d.convertToFoundDocument(p.version,a).setHasCommittedMutations()}(t,e,r):t instanceof Cg?function(c,d,p){if(!Qj(c.precondition,d))return void d.convertToUnknownDocument(p.version);const a=SU(c.fieldTransforms,d,p.transformResults),w=d.data;w.setAll(gH(c)),w.setAll(a),d.convertToFoundDocument(p.version,w).setHasCommittedMutations()}(t,e,r):function(c,d,p){d.convertToNoDocument(p.version).setHasCommittedMutations()}(0,e,r)}function iS(t,e,r,n){return t instanceof CE?function(d,p,a,w){if(!Qj(d.precondition,p))return a;const E=d.value.clone(),C=EU(d.fieldTransforms,w,p);return E.setAll(C),p.convertToFoundDocument(p.version,E).setHasLocalMutations(),null}(t,e,r,n):t instanceof Cg?function(d,p,a,w){if(!Qj(d.precondition,p))return a;const E=EU(d.fieldTransforms,w,p),C=p.data;return C.setAll(gH(d)),C.setAll(E),p.convertToFoundDocument(p.version,C).setHasLocalMutations(),a===null?null:a.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(P=>P.field))}(t,e,r,n):function(d,p,a){return Qj(d.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):a}(t,e,r)}function Mpe(t,e){let r=null;for(const n of t.fieldTransforms){const c=e.data.field(n.field),d=uH(n.transform,c||null);d!=null&&(r===null&&(r=Xc.empty()),r.set(n.field,d))}return r||null}function bU(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,c){return n===void 0&&c===void 0||!(!n||!c)&&b0(n,c,(d,p)=>Ppe(d,p))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class CE extends bC{constructor(e,r,n,c=[]){super(),this.key=e,this.value=r,this.precondition=n,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class Cg extends bC{constructor(e,r,n,c,d=[]){super(),this.key=e,this.data=r,this.fieldMask=n,this.precondition=c,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function gH(t){const e=new Map;return t.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const n=t.data.field(r);e.set(r,n)}}),e}function SU(t,e,r){const n=new Map;sa(t.length===r.length);for(let c=0;c<r.length;c++){const d=t[c],p=d.transform,a=e.data.field(d.field);n.set(d.field,Ape(p,a,r[c]))}return n}function EU(t,e,r){const n=new Map;for(const c of t){const d=c.transform,p=r.data.field(c.field);n.set(c.field,Cpe(d,p,e))}return n}class SC extends bC{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Dpe extends bC{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ope{constructor(e,r,n,c){this.batchId=e,this.localWriteTime=r,this.baseMutations=n,this.mutations=c}applyToRemoteDocument(e,r){const n=r.mutationResults;for(let c=0;c<this.mutations.length;c++){const d=this.mutations[c];d.key.isEqual(e.key)&&Rpe(d,e,n[c])}}applyToLocalView(e,r){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(r=iS(n,e,r,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(r=iS(n,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const n=oH();return this.mutations.forEach(c=>{const d=e.get(c.key),p=d.overlayedDocument;let a=this.applyToLocalView(p,d.mutatedFields);a=r.has(c.key)?null:a;const w=mH(p,a);w!==null&&n.set(c.key,w),p.isValidDocument()||p.convertToNoDocument(ks.min())}),n}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),_i())}isEqual(e){return this.batchId===e.batchId&&b0(this.mutations,e.mutations,(r,n)=>bU(r,n))&&b0(this.baseMutations,e.baseMutations,(r,n)=>bU(r,n))}}class KL{constructor(e,r,n,c){this.batch=e,this.commitVersion=r,this.mutationResults=n,this.docVersions=c}static from(e,r,n){sa(e.mutations.length===n.length);let c=function(){return Tpe}();const d=e.mutations;for(let p=0;p<d.length;p++)c=c.insert(d[p].key,n[p].version);return new KL(e,r,n,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lpe=class{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fpe{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Po,Ni;function zpe(t){switch(t){default:return js();case fr.CANCELLED:case fr.UNKNOWN:case fr.DEADLINE_EXCEEDED:case fr.RESOURCE_EXHAUSTED:case fr.INTERNAL:case fr.UNAVAILABLE:case fr.UNAUTHENTICATED:return!1;case fr.INVALID_ARGUMENT:case fr.NOT_FOUND:case fr.ALREADY_EXISTS:case fr.PERMISSION_DENIED:case fr.FAILED_PRECONDITION:case fr.ABORTED:case fr.OUT_OF_RANGE:case fr.UNIMPLEMENTED:case fr.DATA_LOSS:return!0}}function _H(t){if(t===void 0)return yp("GRPC error has no .code"),fr.UNKNOWN;switch(t){case Po.OK:return fr.OK;case Po.CANCELLED:return fr.CANCELLED;case Po.UNKNOWN:return fr.UNKNOWN;case Po.DEADLINE_EXCEEDED:return fr.DEADLINE_EXCEEDED;case Po.RESOURCE_EXHAUSTED:return fr.RESOURCE_EXHAUSTED;case Po.INTERNAL:return fr.INTERNAL;case Po.UNAVAILABLE:return fr.UNAVAILABLE;case Po.UNAUTHENTICATED:return fr.UNAUTHENTICATED;case Po.INVALID_ARGUMENT:return fr.INVALID_ARGUMENT;case Po.NOT_FOUND:return fr.NOT_FOUND;case Po.ALREADY_EXISTS:return fr.ALREADY_EXISTS;case Po.PERMISSION_DENIED:return fr.PERMISSION_DENIED;case Po.FAILED_PRECONDITION:return fr.FAILED_PRECONDITION;case Po.ABORTED:return fr.ABORTED;case Po.OUT_OF_RANGE:return fr.OUT_OF_RANGE;case Po.UNIMPLEMENTED:return fr.UNIMPLEMENTED;case Po.DATA_LOSS:return fr.DATA_LOSS;default:return js()}}(Ni=Po||(Po={}))[Ni.OK=0]="OK",Ni[Ni.CANCELLED=1]="CANCELLED",Ni[Ni.UNKNOWN=2]="UNKNOWN",Ni[Ni.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ni[Ni.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ni[Ni.NOT_FOUND=5]="NOT_FOUND",Ni[Ni.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ni[Ni.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ni[Ni.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ni[Ni.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ni[Ni.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ni[Ni.ABORTED=10]="ABORTED",Ni[Ni.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ni[Ni.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ni[Ni.INTERNAL=13]="INTERNAL",Ni[Ni.UNAVAILABLE=14]="UNAVAILABLE",Ni[Ni.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bpe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vpe=new q_([4294967295,4294967295],0);function TU(t){const e=Bpe().encode(t),r=new BG;return r.update(e),new Uint8Array(r.digest())}function jU(t){const e=new DataView(t.buffer),r=e.getUint32(0,!0),n=e.getUint32(4,!0),c=e.getUint32(8,!0),d=e.getUint32(12,!0);return[new q_([r,n],0),new q_([c,d],0)]}class XL{constructor(e,r,n){if(this.bitmap=e,this.padding=r,this.hashCount=n,r<0||r>=8)throw new z1(`Invalid padding: ${r}`);if(n<0)throw new z1(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new z1(`Invalid hash count: ${n}`);if(e.length===0&&r!==0)throw new z1(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=q_.fromNumber(this.Ie)}Ee(e,r,n){let c=e.add(r.multiply(q_.fromNumber(n)));return c.compare(Vpe)===1&&(c=new q_([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=TU(e),[n,c]=jU(r);for(let d=0;d<this.hashCount;d++){const p=this.Ee(n,c,d);if(!this.de(p))return!1}return!0}static create(e,r,n){const c=e%8==0?0:8-e%8,d=new Uint8Array(Math.ceil(e/8)),p=new XL(d,c,r);return n.forEach(a=>p.insert(a)),p}insert(e){if(this.Ie===0)return;const r=TU(e),[n,c]=jU(r);for(let d=0;d<this.hashCount;d++){const p=this.Ee(n,c,d);this.Ae(p)}}Ae(e){const r=Math.floor(e/8),n=e%8;this.bitmap[r]|=1<<n}}class z1 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EC{constructor(e,r,n,c,d){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=n,this.documentUpdates=c,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,r,n){const c=new Map;return c.set(e,AE.createSynthesizedTargetChangeForCurrentChange(e,r,n)),new EC(ks.min(),c,new no(Li),xp(),_i())}}class AE{constructor(e,r,n,c,d){this.resumeToken=e,this.current=r,this.addedDocuments=n,this.modifiedDocuments=c,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,r,n){return new AE(n,r,_i(),_i(),_i())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{constructor(e,r,n,c){this.Re=e,this.removedTargetIds=r,this.key=n,this.Ve=c}}class yH{constructor(e,r){this.targetId=e,this.me=r}}class xH{constructor(e,r,n=hl.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=r,this.resumeToken=n,this.cause=c}}class NU{constructor(){this.fe=0,this.ge=CU(),this.pe=hl.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=_i(),r=_i(),n=_i();return this.ge.forEach((c,d)=>{switch(d){case 0:e=e.add(c);break;case 2:r=r.add(c);break;case 1:n=n.add(c);break;default:js()}}),new AE(this.pe,this.ye,e,r,n)}Ce(){this.we=!1,this.ge=CU()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,sa(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Upe{constructor(e){this.Le=e,this.Be=new Map,this.ke=xp(),this.qe=IU(),this.Qe=new no(Li)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const n=this.Ge(r);switch(e.state){case 0:this.ze(r)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),n.De(e.resumeToken));break;default:js()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((n,c)=>{this.ze(c)&&r(c)})}He(e){const r=e.targetId,n=e.me.count,c=this.Je(r);if(c){const d=c.target;if(SD(d))if(n===0){const p=new zn(d.path);this.Ue(r,p,ql.newNoDocument(p,ks.min()))}else sa(n===1);else{const p=this.Ye(r);if(p!==n){const a=this.Ze(e),w=a?this.Xe(a,e,p):1;if(w!==0){this.je(r);const E=w===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,E)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:n="",padding:c=0},hashCount:d=0}=r;let p,a;try{p=cy(n).toUint8Array()}catch(w){if(w instanceof KG)return ly("Decoding the base64 bloom filter in existence filter failed ("+w.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw w}try{a=new XL(p,c,d)}catch(w){return ly(w instanceof z1?"BloomFilter error: ":"Applying bloom filter failed: ",w),null}return a.Ie===0?null:a}Xe(e,r,n){return r.me.count===n-this.nt(e,r.targetId)?0:2}nt(e,r){const n=this.Le.getRemoteKeysForTarget(r);let c=0;return n.forEach(d=>{const p=this.Le.tt(),a=`projects/${p.projectId}/databases/${p.database}/documents/${d.path.canonicalString()}`;e.mightContain(a)||(this.Ue(r,d,null),c++)}),c}rt(e){const r=new Map;this.Be.forEach((d,p)=>{const a=this.Je(p);if(a){if(d.current&&SD(a.target)){const w=new zn(a.target.path);this.ke.get(w)!==null||this.it(p,w)||this.Ue(p,w,ql.newNoDocument(w,e))}d.be&&(r.set(p,d.ve()),d.Ce())}});let n=_i();this.qe.forEach((d,p)=>{let a=!0;p.forEachWhile(w=>{const E=this.Je(w);return!E||E.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(n=n.add(d))}),this.ke.forEach((d,p)=>p.setReadTime(e));const c=new EC(e,r,this.Qe,this.ke,n);return this.ke=xp(),this.qe=IU(),this.Qe=new no(Li),c}$e(e,r){if(!this.ze(e))return;const n=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,n),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,n){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,r)?c.Fe(r,1):c.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),n&&(this.ke=this.ke.insert(r,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new NU,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new Tl(Li),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||An("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new NU),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function IU(){return new no(zn.comparator)}function CU(){return new no(zn.comparator)}const $pe={asc:"ASCENDING",desc:"DESCENDING"},qpe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Gpe={and:"AND",or:"OR"};class Hpe{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function TD(t,e){return t.useProto3Json||gC(e)?e:{value:e}}function XN(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function vH(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Wpe(t,e){return XN(t,e.toTimestamp())}function rf(t){return sa(!!t),ks.fromTimestamp(function(r){const n=dg(r);return new Lo(n.seconds,n.nanos)}(t))}function YL(t,e){return jD(t,e).canonicalString()}function jD(t,e){const r=function(c){return new _a(["projects",c.projectId,"databases",c.database])}(t).child("documents");return e===void 0?r:r.child(e)}function wH(t){const e=_a.fromString(t);return sa(jH(e)),e}function ND(t,e){return YL(t.databaseId,e.path)}function dR(t,e){const r=wH(e);if(r.get(1)!==t.databaseId.projectId)throw new rn(fr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new rn(fr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new zn(SH(r))}function bH(t,e){return YL(t.databaseId,e)}function Zpe(t){const e=wH(t);return e.length===4?_a.emptyPath():SH(e)}function ID(t){return new _a(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function SH(t){return sa(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function AU(t,e,r){return{name:ND(t,e),fields:r.value.mapValue.fields}}function Kpe(t,e){let r;if("targetChange"in e){e.targetChange;const n=function(E){return E==="NO_CHANGE"?0:E==="ADD"?1:E==="REMOVE"?2:E==="CURRENT"?3:E==="RESET"?4:js()}(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],d=function(E,C){return E.useProto3Json?(sa(C===void 0||typeof C=="string"),hl.fromBase64String(C||"")):(sa(C===void 0||C instanceof Buffer||C instanceof Uint8Array),hl.fromUint8Array(C||new Uint8Array))}(t,e.targetChange.resumeToken),p=e.targetChange.cause,a=p&&function(E){const C=E.code===void 0?fr.UNKNOWN:_H(E.code);return new rn(C,E.message||"")}(p);r=new xH(n,c,d,a||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const c=dR(t,n.document.name),d=rf(n.document.updateTime),p=n.document.createTime?rf(n.document.createTime):ks.min(),a=new Xc({mapValue:{fields:n.document.fields}}),w=ql.newFoundDocument(c,d,p,a),E=n.targetIds||[],C=n.removedTargetIds||[];r=new eN(E,C,w.key,w)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const c=dR(t,n.document),d=n.readTime?rf(n.readTime):ks.min(),p=ql.newNoDocument(c,d),a=n.removedTargetIds||[];r=new eN([],a,p.key,p)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const c=dR(t,n.document),d=n.removedTargetIds||[];r=new eN([],d,c,null)}else{if(!("filter"in e))return js();{e.filter;const n=e.filter;n.targetId;const{count:c=0,unchangedNames:d}=n,p=new Fpe(c,d),a=n.targetId;r=new yH(a,p)}}return r}function Xpe(t,e){let r;if(e instanceof CE)r={update:AU(t,e.key,e.value)};else if(e instanceof SC)r={delete:ND(t,e.key)};else if(e instanceof Cg)r={update:AU(t,e.key,e.data),updateMask:ime(e.fieldMask)};else{if(!(e instanceof Dpe))return js();r={verify:ND(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(n=>function(d,p){const a=p.transform;if(a instanceof VS)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof US)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof $S)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof qS)return{fieldPath:p.field.canonicalString(),increment:a.Pe};throw js()}(0,n))),e.precondition.isNone||(r.currentDocument=function(c,d){return d.updateTime!==void 0?{updateTime:Wpe(c,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:js()}(t,e.precondition)),r}function Ype(t,e){return t&&t.length>0?(sa(e!==void 0),t.map(r=>function(c,d){let p=c.updateTime?rf(c.updateTime):rf(d);return p.isEqual(ks.min())&&(p=rf(d)),new kpe(p,c.transformResults||[])}(r,e))):[]}function Jpe(t,e){return{documents:[bH(t,e.path)]}}function Qpe(t,e){const r={structuredQuery:{}},n=e.path;let c;e.collectionGroup!==null?(c=n,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=bH(t,c);const d=function(E){if(E.length!==0)return TH(rh.create(E,"and"))}(e.filters);d&&(r.structuredQuery.where=d);const p=function(E){if(E.length!==0)return E.map(C=>function(R){return{field:Tv(R.field),direction:rme(R.dir)}}(C))}(e.orderBy);p&&(r.structuredQuery.orderBy=p);const a=TD(t,e.limit);return a!==null&&(r.structuredQuery.limit=a),e.startAt&&(r.structuredQuery.startAt=function(E){return{before:E.inclusive,values:E.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(E){return{before:!E.inclusive,values:E.position}}(e.endAt)),{_t:r,parent:c}}function eme(t){let e=Zpe(t.parent);const r=t.structuredQuery,n=r.from?r.from.length:0;let c=null;if(n>0){sa(n===1);const C=r.from[0];C.allDescendants?c=C.collectionId:e=e.child(C.collectionId)}let d=[];r.where&&(d=function(P){const R=EH(P);return R instanceof rh&&QG(R)?R.getFilters():[R]}(r.where));let p=[];r.orderBy&&(p=function(P){return P.map(R=>function(V){return new BS(jv(V.field),function(K){switch(K){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(V.direction))}(R))}(r.orderBy));let a=null;r.limit&&(a=function(P){let R;return R=typeof P=="object"?P.value:P,gC(R)?null:R}(r.limit));let w=null;r.startAt&&(w=function(P){const R=!!P.before,B=P.values||[];return new j0(B,R)}(r.startAt));let E=null;return r.endAt&&(E=function(P){const R=!P.before,B=P.values||[];return new j0(B,R)}(r.endAt)),vpe(e,c,p,d,a,"F",w,E)}function tme(t,e){const r=function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return js()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function EH(t){return t.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const n=jv(r.unaryFilter.field);return Mo.create(n,"==",{doubleValue:NaN});case"IS_NULL":const c=jv(r.unaryFilter.field);return Mo.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=jv(r.unaryFilter.field);return Mo.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=jv(r.unaryFilter.field);return Mo.create(p,"!=",{nullValue:"NULL_VALUE"});default:return js()}}(t):t.fieldFilter!==void 0?function(r){return Mo.create(jv(r.fieldFilter.field),function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return js()}}(r.fieldFilter.op),r.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(r){return rh.create(r.compositeFilter.filters.map(n=>EH(n)),function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return js()}}(r.compositeFilter.op))}(t):js()}function rme(t){return $pe[t]}function nme(t){return qpe[t]}function sme(t){return Gpe[t]}function Tv(t){return{fieldPath:t.canonicalString()}}function jv(t){return ll.fromServerFormat(t.fieldPath)}function TH(t){return t instanceof Mo?function(r){if(r.op==="=="){if(gU(r.value))return{unaryFilter:{field:Tv(r.field),op:"IS_NAN"}};if(mU(r.value))return{unaryFilter:{field:Tv(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(gU(r.value))return{unaryFilter:{field:Tv(r.field),op:"IS_NOT_NAN"}};if(mU(r.value))return{unaryFilter:{field:Tv(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Tv(r.field),op:nme(r.op),value:r.value}}}(t):t instanceof rh?function(r){const n=r.getFilters().map(c=>TH(c));return n.length===1?n[0]:{compositeFilter:{op:sme(r.op),filters:n}}}(t):js()}function ime(t){const e=[];return t.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function jH(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(e,r,n,c,d=ks.min(),p=ks.min(),a=hl.EMPTY_BYTE_STRING,w=null){this.target=e,this.targetId=r,this.purpose=n,this.sequenceNumber=c,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=a,this.expectedCount=w}withSequenceNumber(e){return new Zm(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new Zm(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Zm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Zm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ame{constructor(e){this.ct=e}}function ome(t){const e=eme({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?KN(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lme{constructor(){this.un=new cme}addToCollectionParentIndex(e,r){return this.un.add(r),Cr.resolve()}getCollectionParents(e,r){return Cr.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return Cr.resolve()}deleteFieldIndex(e,r){return Cr.resolve()}deleteAllFieldIndexes(e){return Cr.resolve()}createTargetIndexes(e,r){return Cr.resolve()}getDocumentsMatchingTarget(e,r){return Cr.resolve(null)}getIndexType(e,r){return Cr.resolve(0)}getFieldIndexes(e,r){return Cr.resolve([])}getNextCollectionGroupToUpdate(e){return Cr.resolve(null)}getMinOffset(e,r){return Cr.resolve(ug.min())}getMinOffsetFromCollectionGroup(e,r){return Cr.resolve(ug.min())}updateCollectionGroup(e,r,n){return Cr.resolve()}updateIndexEntries(e,r){return Cr.resolve()}}class cme{constructor(){this.index={}}add(e){const r=e.lastSegment(),n=e.popLast(),c=this.index[r]||new Tl(_a.comparator),d=!c.has(n);return this.index[r]=c.add(n),d}has(e){const r=e.lastSegment(),n=e.popLast(),c=this.index[r];return c&&c.has(n)}getEntries(e){return(this.index[e]||new Tl(_a.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new N0(0)}static kn(){return new N0(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ume{constructor(){this.changes=new ew(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,ql.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const n=this.changes.get(r);return n!==void 0?Cr.resolve(n):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dme{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hme{constructor(e,r,n,c){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=n,this.indexManager=c}getDocument(e,r){let n=null;return this.documentOverlayCache.getOverlay(e,r).next(c=>(n=c,this.remoteDocumentCache.getEntry(e,r))).next(c=>(n!==null&&iS(n.mutation,c,Iu.empty(),Lo.now()),c))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(n=>this.getLocalViewOfDocuments(e,n,_i()).next(()=>n))}getLocalViewOfDocuments(e,r,n=_i()){const c=z_();return this.populateOverlays(e,c,r).next(()=>this.computeViews(e,r,c,n).next(d=>{let p=F1();return d.forEach((a,w)=>{p=p.insert(a,w.overlayedDocument)}),p}))}getOverlayedDocuments(e,r){const n=z_();return this.populateOverlays(e,n,r).next(()=>this.computeViews(e,r,n,_i()))}populateOverlays(e,r,n){const c=[];return n.forEach(d=>{r.has(d)||c.push(d)}),this.documentOverlayCache.getOverlays(e,c).next(d=>{d.forEach((p,a)=>{r.set(p,a)})})}computeViews(e,r,n,c){let d=xp();const p=sS(),a=function(){return sS()}();return r.forEach((w,E)=>{const C=n.get(E.key);c.has(E.key)&&(C===void 0||C.mutation instanceof Cg)?d=d.insert(E.key,E):C!==void 0?(p.set(E.key,C.mutation.getFieldMask()),iS(C.mutation,E,C.mutation.getFieldMask(),Lo.now())):p.set(E.key,Iu.empty())}),this.recalculateAndSaveOverlays(e,d).next(w=>(w.forEach((E,C)=>p.set(E,C)),r.forEach((E,C)=>{var P;return a.set(E,new dme(C,(P=p.get(E))!==null&&P!==void 0?P:null))}),a))}recalculateAndSaveOverlays(e,r){const n=sS();let c=new no((p,a)=>p-a),d=_i();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(p=>{for(const a of p)a.keys().forEach(w=>{const E=r.get(w);if(E===null)return;let C=n.get(w)||Iu.empty();C=a.applyToLocalView(E,C),n.set(w,C);const P=(c.get(a.batchId)||_i()).add(w);c=c.insert(a.batchId,P)})}).next(()=>{const p=[],a=c.getReverseIterator();for(;a.hasNext();){const w=a.getNext(),E=w.key,C=w.value,P=oH();C.forEach(R=>{if(!d.has(R)){const B=mH(r.get(R),n.get(R));B!==null&&P.set(R,B),d=d.add(R)}}),p.push(this.documentOverlayCache.saveOverlays(e,E,P))}return Cr.waitFor(p)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,r,n,c){return function(p){return zn.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):WL(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,n,c):this.getDocumentsMatchingCollectionQuery(e,r,n,c)}getNextDocuments(e,r,n,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,n,c).next(d=>{const p=c-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,n.largestBatchId,c-d.size):Cr.resolve(z_());let a=-1,w=d;return p.next(E=>Cr.forEach(E,(C,P)=>(a<P.largestBatchId&&(a=P.largestBatchId),d.get(C)?Cr.resolve():this.remoteDocumentCache.getEntry(e,C).next(R=>{w=w.insert(C,R)}))).next(()=>this.populateOverlays(e,E,d)).next(()=>this.computeViews(e,w,E,_i())).next(C=>({batchId:a,changes:aH(C)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new zn(r)).next(n=>{let c=F1();return n.isFoundDocument()&&(c=c.insert(n.key,n)),c})}getDocumentsMatchingCollectionGroupQuery(e,r,n,c){const d=r.collectionGroup;let p=F1();return this.indexManager.getCollectionParents(e,d).next(a=>Cr.forEach(a,w=>{const E=function(P,R){return new Dy(R,null,P.explicitOrderBy.slice(),P.filters.slice(),P.limit,P.limitType,P.startAt,P.endAt)}(r,w.child(d));return this.getDocumentsMatchingCollectionQuery(e,E,n,c).next(C=>{C.forEach((P,R)=>{p=p.insert(P,R)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(e,r,n,c){let d;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,n.largestBatchId).next(p=>(d=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,n,d,c))).next(p=>{d.forEach((w,E)=>{const C=E.getKey();p.get(C)===null&&(p=p.insert(C,ql.newInvalidDocument(C)))});let a=F1();return p.forEach((w,E)=>{const C=d.get(w);C!==void 0&&iS(C.mutation,E,Iu.empty(),Lo.now()),vC(r,E)&&(a=a.insert(w,E))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fme{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return Cr.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(c){return{id:c.id,version:c.version,createTime:rf(c.createTime)}}(r)),Cr.resolve()}getNamedQuery(e,r){return Cr.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(c){return{name:c.name,query:ome(c.bundledQuery),readTime:rf(c.readTime)}}(r)),Cr.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pme{constructor(){this.overlays=new no(zn.comparator),this.Ir=new Map}getOverlay(e,r){return Cr.resolve(this.overlays.get(r))}getOverlays(e,r){const n=z_();return Cr.forEach(r,c=>this.getOverlay(e,c).next(d=>{d!==null&&n.set(c,d)})).next(()=>n)}saveOverlays(e,r,n){return n.forEach((c,d)=>{this.ht(e,r,d)}),Cr.resolve()}removeOverlaysForBatchId(e,r,n){const c=this.Ir.get(n);return c!==void 0&&(c.forEach(d=>this.overlays=this.overlays.remove(d)),this.Ir.delete(n)),Cr.resolve()}getOverlaysForCollection(e,r,n){const c=z_(),d=r.length+1,p=new zn(r.child("")),a=this.overlays.getIteratorFrom(p);for(;a.hasNext();){const w=a.getNext().value,E=w.getKey();if(!r.isPrefixOf(E.path))break;E.path.length===d&&w.largestBatchId>n&&c.set(w.getKey(),w)}return Cr.resolve(c)}getOverlaysForCollectionGroup(e,r,n,c){let d=new no((E,C)=>E-C);const p=this.overlays.getIterator();for(;p.hasNext();){const E=p.getNext().value;if(E.getKey().getCollectionGroup()===r&&E.largestBatchId>n){let C=d.get(E.largestBatchId);C===null&&(C=z_(),d=d.insert(E.largestBatchId,C)),C.set(E.getKey(),E)}}const a=z_(),w=d.getIterator();for(;w.hasNext()&&(w.getNext().value.forEach((E,C)=>a.set(E,C)),!(a.size()>=c)););return Cr.resolve(a)}ht(e,r,n){const c=this.overlays.get(n.key);if(c!==null){const p=this.Ir.get(c.largestBatchId).delete(n.key);this.Ir.set(c.largestBatchId,p)}this.overlays=this.overlays.insert(n.key,new Lpe(r,n));let d=this.Ir.get(r);d===void 0&&(d=_i(),this.Ir.set(r,d)),this.Ir.set(r,d.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mme{constructor(){this.sessionToken=hl.EMPTY_BYTE_STRING}getSessionToken(e){return Cr.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,Cr.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JL{constructor(){this.Tr=new Tl(al.Er),this.dr=new Tl(al.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const n=new al(e,r);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,r){e.forEach(n=>this.addReference(n,r))}removeReference(e,r){this.Vr(new al(e,r))}mr(e,r){e.forEach(n=>this.removeReference(n,r))}gr(e){const r=new zn(new _a([])),n=new al(r,e),c=new al(r,e+1),d=[];return this.dr.forEachInRange([n,c],p=>{this.Vr(p),d.push(p.key)}),d}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new zn(new _a([])),n=new al(r,e),c=new al(r,e+1);let d=_i();return this.dr.forEachInRange([n,c],p=>{d=d.add(p.key)}),d}containsKey(e){const r=new al(e,0),n=this.Tr.firstAfterOrEqual(r);return n!==null&&e.isEqual(n.key)}}class al{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return zn.comparator(e.key,r.key)||Li(e.wr,r.wr)}static Ar(e,r){return Li(e.wr,r.wr)||zn.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gme{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new Tl(al.Er)}checkEmpty(e){return Cr.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,n,c){const d=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new Ope(d,r,n,c);this.mutationQueue.push(p);for(const a of c)this.br=this.br.add(new al(a.key,d)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Cr.resolve(p)}lookupMutationBatch(e,r){return Cr.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const n=r+1,c=this.vr(n),d=c<0?0:c;return Cr.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Cr.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return Cr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const n=new al(r,0),c=new al(r,Number.POSITIVE_INFINITY),d=[];return this.br.forEachInRange([n,c],p=>{const a=this.Dr(p.wr);d.push(a)}),Cr.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,r){let n=new Tl(Li);return r.forEach(c=>{const d=new al(c,0),p=new al(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([d,p],a=>{n=n.add(a.wr)})}),Cr.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,r){const n=r.path,c=n.length+1;let d=n;zn.isDocumentKey(d)||(d=d.child(""));const p=new al(new zn(d),0);let a=new Tl(Li);return this.br.forEachWhile(w=>{const E=w.key.path;return!!n.isPrefixOf(E)&&(E.length===c&&(a=a.add(w.wr)),!0)},p),Cr.resolve(this.Cr(a))}Cr(e){const r=[];return e.forEach(n=>{const c=this.Dr(n);c!==null&&r.push(c)}),r}removeMutationBatch(e,r){sa(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return Cr.forEach(r.mutations,c=>{const d=new al(c.key,r.batchId);return n=n.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,r){const n=new al(r,0),c=this.br.firstAfterOrEqual(n);return Cr.resolve(r.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,Cr.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _me{constructor(e){this.Mr=e,this.docs=function(){return new no(zn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const n=r.key,c=this.docs.get(n),d=c?c.size:0,p=this.Mr(r);return this.docs=this.docs.insert(n,{document:r.mutableCopy(),size:p}),this.size+=p-d,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const n=this.docs.get(r);return Cr.resolve(n?n.document.mutableCopy():ql.newInvalidDocument(r))}getEntries(e,r){let n=xp();return r.forEach(c=>{const d=this.docs.get(c);n=n.insert(c,d?d.document.mutableCopy():ql.newInvalidDocument(c))}),Cr.resolve(n)}getDocumentsMatchingQuery(e,r,n,c){let d=xp();const p=r.path,a=new zn(p.child("")),w=this.docs.getIteratorFrom(a);for(;w.hasNext();){const{key:E,value:{document:C}}=w.getNext();if(!p.isPrefixOf(E.path))break;E.path.length>p.length+1||tpe(epe(C),n)<=0||(c.has(C.key)||vC(r,C))&&(d=d.insert(C.key,C.mutableCopy()))}return Cr.resolve(d)}getAllFromCollectionGroup(e,r,n,c){js()}Or(e,r){return Cr.forEach(this.docs,n=>r(n))}newChangeBuffer(e){return new yme(this)}getSize(e){return Cr.resolve(this.size)}}class yme extends ume{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((n,c)=>{c.isValidDocument()?r.push(this.cr.addEntry(e,c)):this.cr.removeEntry(n)}),Cr.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xme{constructor(e){this.persistence=e,this.Nr=new ew(r=>GL(r),HL),this.lastRemoteSnapshotVersion=ks.min(),this.highestTargetId=0,this.Lr=0,this.Br=new JL,this.targetCount=0,this.kr=N0.Bn()}forEachTarget(e,r){return this.Nr.forEach((n,c)=>r(c)),Cr.resolve()}getLastRemoteSnapshotVersion(e){return Cr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Cr.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Cr.resolve(this.highestTargetId)}setTargetsMetadata(e,r,n){return n&&(this.lastRemoteSnapshotVersion=n),r>this.Lr&&(this.Lr=r),Cr.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new N0(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,Cr.resolve()}updateTargetData(e,r){return this.Kn(r),Cr.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,Cr.resolve()}removeTargets(e,r,n){let c=0;const d=[];return this.Nr.forEach((p,a)=>{a.sequenceNumber<=r&&n.get(a.targetId)===null&&(this.Nr.delete(p),d.push(this.removeMatchingKeysForTargetId(e,a.targetId)),c++)}),Cr.waitFor(d).next(()=>c)}getTargetCount(e){return Cr.resolve(this.targetCount)}getTargetData(e,r){const n=this.Nr.get(r)||null;return Cr.resolve(n)}addMatchingKeys(e,r,n){return this.Br.Rr(r,n),Cr.resolve()}removeMatchingKeys(e,r,n){this.Br.mr(r,n);const c=this.persistence.referenceDelegate,d=[];return c&&r.forEach(p=>{d.push(c.markPotentiallyOrphaned(e,p))}),Cr.waitFor(d)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),Cr.resolve()}getMatchingKeysForTargetId(e,r){const n=this.Br.yr(r);return Cr.resolve(n)}containsKey(e,r){return Cr.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vme{constructor(e,r){this.qr={},this.overlays={},this.Qr=new UL(0),this.Kr=!1,this.Kr=!0,this.$r=new mme,this.referenceDelegate=e(this),this.Ur=new xme(this),this.indexManager=new lme,this.remoteDocumentCache=function(c){return new _me(c)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new ame(r),this.Gr=new fme(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new pme,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let n=this.qr[e.toKey()];return n||(n=new gme(r,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,n){An("MemoryPersistence","Starting transaction:",e);const c=new wme(this.Qr.next());return this.referenceDelegate.zr(),n(c).next(d=>this.referenceDelegate.jr(c).next(()=>d)).toPromise().then(d=>(c.raiseOnCommittedEvent(),d))}Hr(e,r){return Cr.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,r)))}}class wme extends npe{constructor(e){super(),this.currentSequenceNumber=e}}class QL{constructor(e){this.persistence=e,this.Jr=new JL,this.Yr=null}static Zr(e){return new QL(e)}get Xr(){if(this.Yr)return this.Yr;throw js()}addReference(e,r,n){return this.Jr.addReference(n,r),this.Xr.delete(n.toString()),Cr.resolve()}removeReference(e,r,n){return this.Jr.removeReference(n,r),this.Xr.add(n.toString()),Cr.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),Cr.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(c=>this.Xr.add(c.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,r.targetId).next(c=>{c.forEach(d=>this.Xr.add(d.toString()))}).next(()=>n.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Cr.forEach(this.Xr,n=>{const c=zn.fromPath(n);return this.ei(e,c).next(d=>{d||r.removeEntry(c,ks.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(n=>{n?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return Cr.or([()=>Cr.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3{constructor(e,r,n,c){this.targetId=e,this.fromCache=r,this.$i=n,this.Ui=c}static Wi(e,r){let n=_i(),c=_i();for(const d of r.docChanges)switch(d.type){case 0:n=n.add(d.doc.key);break;case 1:c=c.add(d.doc.key)}return new e3(e,r.fromCache,n,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bme{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sme{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return tue()?8:spe(Zl())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,n,c){const d={result:null};return this.Yi(e,r).next(p=>{d.result=p}).next(()=>{if(!d.result)return this.Zi(e,r,c,n).next(p=>{d.result=p})}).next(()=>{if(d.result)return;const p=new bme;return this.Xi(e,r,p).next(a=>{if(d.result=a,this.zi)return this.es(e,r,p,a.size)})}).next(()=>d.result)}es(e,r,n,c){return n.documentReadCount<this.ji?(b1()<=wi.DEBUG&&An("QueryEngine","SDK will not create cache indexes for query:",Ev(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Cr.resolve()):(b1()<=wi.DEBUG&&An("QueryEngine","Query:",Ev(r),"scans",n.documentReadCount,"local documents and returns",c,"documents as results."),n.documentReadCount>this.Hi*c?(b1()<=wi.DEBUG&&An("QueryEngine","The SDK decides to create cache indexes for query:",Ev(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,tf(r))):Cr.resolve())}Yi(e,r){if(vU(r))return Cr.resolve(null);let n=tf(r);return this.indexManager.getIndexType(e,n).next(c=>c===0?null:(r.limit!==null&&c===1&&(r=KN(r,null,"F"),n=tf(r)),this.indexManager.getDocumentsMatchingTarget(e,n).next(d=>{const p=_i(...d);return this.Ji.getDocuments(e,p).next(a=>this.indexManager.getMinOffset(e,n).next(w=>{const E=this.ts(r,a);return this.ns(r,E,p,w.readTime)?this.Yi(e,KN(r,null,"F")):this.rs(e,E,r,w)}))})))}Zi(e,r,n,c){return vU(r)||c.isEqual(ks.min())?Cr.resolve(null):this.Ji.getDocuments(e,n).next(d=>{const p=this.ts(r,d);return this.ns(r,p,n,c)?Cr.resolve(null):(b1()<=wi.DEBUG&&An("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),Ev(r)),this.rs(e,p,r,Qfe(c,-1)).next(a=>a))})}ts(e,r){let n=new Tl(sH(e));return r.forEach((c,d)=>{vC(e,d)&&(n=n.add(d))}),n}ns(e,r,n,c){if(e.limit===null)return!1;if(n.size!==r.size)return!0;const d=e.limitType==="F"?r.last():r.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(c)>0)}Xi(e,r,n){return b1()<=wi.DEBUG&&An("QueryEngine","Using full collection scan to execute query:",Ev(r)),this.Ji.getDocumentsMatchingQuery(e,r,ug.min(),n)}rs(e,r,n,c){return this.Ji.getDocumentsMatchingQuery(e,n,c).next(d=>(r.forEach(p=>{d=d.insert(p.key,p)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eme{constructor(e,r,n,c){this.persistence=e,this.ss=r,this.serializer=c,this.os=new no(Li),this._s=new ew(d=>GL(d),HL),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hme(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function Tme(t,e,r,n){return new Eme(t,e,r,n)}async function NH(t,e){const r=Ds(t);return await r.persistence.runTransaction("Handle user change","readonly",n=>{let c;return r.mutationQueue.getAllMutationBatches(n).next(d=>(c=d,r.ls(e),r.mutationQueue.getAllMutationBatches(n))).next(d=>{const p=[],a=[];let w=_i();for(const E of c){p.push(E.batchId);for(const C of E.mutations)w=w.add(C.key)}for(const E of d){a.push(E.batchId);for(const C of E.mutations)w=w.add(C.key)}return r.localDocuments.getDocuments(n,w).next(E=>({hs:E,removedBatchIds:p,addedBatchIds:a}))})})}function jme(t,e){const r=Ds(t);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const c=e.batch.keys(),d=r.cs.newChangeBuffer({trackRemovals:!0});return function(a,w,E,C){const P=E.batch,R=P.keys();let B=Cr.resolve();return R.forEach(V=>{B=B.next(()=>C.getEntry(w,V)).next(W=>{const K=E.docVersions.get(V);sa(K!==null),W.version.compareTo(K)<0&&(P.applyToRemoteDocument(W,E),W.isValidDocument()&&(W.setReadTime(E.commitVersion),C.addEntry(W)))})}),B.next(()=>a.mutationQueue.removeMutationBatch(w,P))}(r,n,e,d).next(()=>d.apply(n)).next(()=>r.mutationQueue.performConsistencyCheck(n)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(n,c,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(a){let w=_i();for(let E=0;E<a.mutationResults.length;++E)a.mutationResults[E].transformResults.length>0&&(w=w.add(a.batch.mutations[E].key));return w}(e))).next(()=>r.localDocuments.getDocuments(n,c))})}function IH(t){const e=Ds(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function Nme(t,e){const r=Ds(t),n=e.snapshotVersion;let c=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const p=r.cs.newChangeBuffer({trackRemovals:!0});c=r.os;const a=[];e.targetChanges.forEach((C,P)=>{const R=c.get(P);if(!R)return;a.push(r.Ur.removeMatchingKeys(d,C.removedDocuments,P).next(()=>r.Ur.addMatchingKeys(d,C.addedDocuments,P)));let B=R.withSequenceNumber(d.currentSequenceNumber);e.targetMismatches.get(P)!==null?B=B.withResumeToken(hl.EMPTY_BYTE_STRING,ks.min()).withLastLimboFreeSnapshotVersion(ks.min()):C.resumeToken.approximateByteSize()>0&&(B=B.withResumeToken(C.resumeToken,n)),c=c.insert(P,B),function(W,K,Z){return W.resumeToken.approximateByteSize()===0||K.snapshotVersion.toMicroseconds()-W.snapshotVersion.toMicroseconds()>=3e8?!0:Z.addedDocuments.size+Z.modifiedDocuments.size+Z.removedDocuments.size>0}(R,B,C)&&a.push(r.Ur.updateTargetData(d,B))});let w=xp(),E=_i();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(d,C))}),a.push(Ime(d,p,e.documentUpdates).next(C=>{w=C.Ps,E=C.Is})),!n.isEqual(ks.min())){const C=r.Ur.getLastRemoteSnapshotVersion(d).next(P=>r.Ur.setTargetsMetadata(d,d.currentSequenceNumber,n));a.push(C)}return Cr.waitFor(a).next(()=>p.apply(d)).next(()=>r.localDocuments.getLocalViewOfDocuments(d,w,E)).next(()=>w)}).then(d=>(r.os=c,d))}function Ime(t,e,r){let n=_i(),c=_i();return r.forEach(d=>n=n.add(d)),e.getEntries(t,n).next(d=>{let p=xp();return r.forEach((a,w)=>{const E=d.get(a);w.isFoundDocument()!==E.isFoundDocument()&&(c=c.add(a)),w.isNoDocument()&&w.version.isEqual(ks.min())?(e.removeEntry(a,w.readTime),p=p.insert(a,w)):!E.isValidDocument()||w.version.compareTo(E.version)>0||w.version.compareTo(E.version)===0&&E.hasPendingWrites?(e.addEntry(w),p=p.insert(a,w)):An("LocalStore","Ignoring outdated watch update for ",a,". Current version:",E.version," Watch version:",w.version)}),{Ps:p,Is:c}})}function Cme(t,e){const r=Ds(t);return r.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Ame(t,e){const r=Ds(t);return r.persistence.runTransaction("Allocate target","readwrite",n=>{let c;return r.Ur.getTargetData(n,e).next(d=>d?(c=d,Cr.resolve(c)):r.Ur.allocateTargetId(n).next(p=>(c=new Zm(e,p,"TargetPurposeListen",n.currentSequenceNumber),r.Ur.addTargetData(n,c).next(()=>c))))}).then(n=>{const c=r.os.get(n.targetId);return(c===null||n.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(r.os=r.os.insert(n.targetId,n),r._s.set(e,n.targetId)),n})}async function CD(t,e,r){const n=Ds(t),c=n.os.get(e),d=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",d,p=>n.persistence.referenceDelegate.removeTarget(p,c))}catch(p){if(!IE(p))throw p;An("LocalStore",`Failed to update sequence numbers for target ${e}: ${p}`)}n.os=n.os.remove(e),n._s.delete(c.target)}function PU(t,e,r){const n=Ds(t);let c=ks.min(),d=_i();return n.persistence.runTransaction("Execute query","readwrite",p=>function(w,E,C){const P=Ds(w),R=P._s.get(C);return R!==void 0?Cr.resolve(P.os.get(R)):P.Ur.getTargetData(E,C)}(n,p,tf(e)).next(a=>{if(a)return c=a.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(p,a.targetId).next(w=>{d=w})}).next(()=>n.ss.getDocumentsMatchingQuery(p,e,r?c:ks.min(),r?d:_i())).next(a=>(Pme(n,bpe(e),a),{documents:a,Ts:d})))}function Pme(t,e,r){let n=t.us.get(e)||ks.min();r.forEach((c,d)=>{d.readTime.compareTo(n)>0&&(n=d.readTime)}),t.us.set(e,n)}class kU{constructor(){this.activeTargetIds=Ipe()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class kme{constructor(){this.so=new kU,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,n){}addLocalQueryTarget(e,r=!0){return r&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,n){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new kU,Promise.resolve()}handleUserChange(e,r,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rme{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RU{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){An("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){An("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hj=null;function hR(){return hj===null?hj=function(){return 268435456+Math.round(2147483648*Math.random())}():hj++,"0x"+hj.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mme={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dme{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bl="WebChannelConnection";class Ome extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const n=r.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),d=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+r.host,this.vo=`projects/${c}/databases/${d}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${d}`}get Fo(){return!1}Mo(r,n,c,d,p){const a=hR(),w=this.xo(r,n.toUriEncodedString());An("RestConnection",`Sending RPC '${r}' ${a}:`,w,c);const E={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(E,d,p),this.No(r,w,E,c).then(C=>(An("RestConnection",`Received RPC '${r}' ${a}: `,C),C),C=>{throw ly("RestConnection",`RPC '${r}' ${a} failed with error: `,C,"url: ",w,"request:",c),C})}Lo(r,n,c,d,p,a){return this.Mo(r,n,c,d,p)}Oo(r,n,c){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Q0}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((d,p)=>r[p]=d),c&&c.headers.forEach((d,p)=>r[p]=d)}xo(r,n){const c=Mme[r];return`${this.Do}/v1/${n}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,n,c){const d=hR();return new Promise((p,a)=>{const w=new VG;w.setWithCredentials(!0),w.listenOnce(UG.COMPLETE,()=>{try{switch(w.getLastErrorCode()){case Yj.NO_ERROR:const C=w.getResponseJson();An(Bl,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(C)),p(C);break;case Yj.TIMEOUT:An(Bl,`RPC '${e}' ${d} timed out`),a(new rn(fr.DEADLINE_EXCEEDED,"Request time out"));break;case Yj.HTTP_ERROR:const P=w.getStatus();if(An(Bl,`RPC '${e}' ${d} failed with status:`,P,"response text:",w.getResponseText()),P>0){let R=w.getResponseJson();Array.isArray(R)&&(R=R[0]);const B=R==null?void 0:R.error;if(B&&B.status&&B.message){const V=function(K){const Z=K.toLowerCase().replace(/_/g,"-");return Object.values(fr).indexOf(Z)>=0?Z:fr.UNKNOWN}(B.status);a(new rn(V,B.message))}else a(new rn(fr.UNKNOWN,"Server responded with status "+w.getStatus()))}else a(new rn(fr.UNAVAILABLE,"Connection failed."));break;default:js()}}finally{An(Bl,`RPC '${e}' ${d} completed.`)}});const E=JSON.stringify(c);An(Bl,`RPC '${e}' ${d} sending request:`,c),w.send(r,"POST",E,n,15)})}Bo(e,r,n){const c=hR(),d=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=GG(),a=qG(),w={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},E=this.longPollingOptions.timeoutSeconds;E!==void 0&&(w.longPollingTimeout=Math.round(1e3*E)),this.useFetchStreams&&(w.useFetchStreams=!0),this.Oo(w.initMessageHeaders,r,n),w.encodeInitMessageHeaders=!0;const C=d.join("");An(Bl,`Creating RPC '${e}' stream ${c}: ${C}`,w);const P=p.createWebChannel(C,w);let R=!1,B=!1;const V=new Dme({Io:K=>{B?An(Bl,`Not sending because RPC '${e}' stream ${c} is closed:`,K):(R||(An(Bl,`Opening RPC '${e}' stream ${c} transport.`),P.open(),R=!0),An(Bl,`RPC '${e}' stream ${c} sending:`,K),P.send(K))},To:()=>P.close()}),W=(K,Z,$)=>{K.listen(Z,X=>{try{$(X)}catch(Q){setTimeout(()=>{throw Q},0)}})};return W(P,L1.EventType.OPEN,()=>{B||(An(Bl,`RPC '${e}' stream ${c} transport opened.`),V.yo())}),W(P,L1.EventType.CLOSE,()=>{B||(B=!0,An(Bl,`RPC '${e}' stream ${c} transport closed`),V.So())}),W(P,L1.EventType.ERROR,K=>{B||(B=!0,ly(Bl,`RPC '${e}' stream ${c} transport errored:`,K),V.So(new rn(fr.UNAVAILABLE,"The operation could not be completed")))}),W(P,L1.EventType.MESSAGE,K=>{var Z;if(!B){const $=K.data[0];sa(!!$);const X=$,Q=X.error||((Z=X[0])===null||Z===void 0?void 0:Z.error);if(Q){An(Bl,`RPC '${e}' stream ${c} received error:`,Q);const re=Q.status;let ve=function(ge){const ce=Po[ge];if(ce!==void 0)return _H(ce)}(re),pe=Q.message;ve===void 0&&(ve=fr.INTERNAL,pe="Unknown error status: "+re+" with message "+Q.message),B=!0,V.So(new rn(ve,pe)),P.close()}else An(Bl,`RPC '${e}' stream ${c} received:`,$),V.bo($)}}),W(a,$G.STAT_EVENT,K=>{K.stat===xD.PROXY?An(Bl,`RPC '${e}' stream ${c} detected buffering proxy`):K.stat===xD.NOPROXY&&An(Bl,`RPC '${e}' stream ${c} detected no buffering proxy`)}),setTimeout(()=>{V.wo()},0),V}}function fR(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TC(t){return new Hpe(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CH{constructor(e,r,n=1e3,c=1.5,d=6e4){this.ui=e,this.timerId=r,this.ko=n,this.qo=c,this.Qo=d,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),c=Math.max(0,r-n);c>0&&An("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AH{constructor(e,r,n,c,d,p,a,w){this.ui=e,this.Ho=n,this.Jo=c,this.connection=d,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=a,this.listener=w,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new CH(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===fr.RESOURCE_EXHAUSTED?(yp(r.toString()),yp("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===fr.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,c])=>{this.Yo===r&&this.P_(n,c)},n=>{e(()=>{const c=new rn(fr.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(c)})})}P_(e,r){const n=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(c=>{n(()=>this.I_(c))}),this.stream.onMessage(c=>{n(()=>++this.e_==1?this.E_(c):this.onNext(c))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return An("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():(An("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Lme extends AH{constructor(e,r,n,c,d,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,n,c,p),this.serializer=d}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=Kpe(this.serializer,e),n=function(d){if(!("targetChange"in d))return ks.min();const p=d.targetChange;return p.targetIds&&p.targetIds.length?ks.min():p.readTime?rf(p.readTime):ks.min()}(e);return this.listener.d_(r,n)}A_(e){const r={};r.database=ID(this.serializer),r.addTarget=function(d,p){let a;const w=p.target;if(a=SD(w)?{documents:Jpe(d,w)}:{query:Qpe(d,w)._t},a.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){a.resumeToken=vH(d,p.resumeToken);const E=TD(d,p.expectedCount);E!==null&&(a.expectedCount=E)}else if(p.snapshotVersion.compareTo(ks.min())>0){a.readTime=XN(d,p.snapshotVersion.toTimestamp());const E=TD(d,p.expectedCount);E!==null&&(a.expectedCount=E)}return a}(this.serializer,e);const n=tme(this.serializer,e);n&&(r.labels=n),this.a_(r)}R_(e){const r={};r.database=ID(this.serializer),r.removeTarget=e,this.a_(r)}}class Fme extends AH{constructor(e,r,n,c,d,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,n,c,p),this.serializer=d}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return sa(!!e.streamToken),this.lastStreamToken=e.streamToken,sa(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){sa(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=Ype(e.writeResults,e.commitTime),n=rf(e.commitTime);return this.listener.g_(n,r)}p_(){const e={};e.database=ID(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(n=>Xpe(this.serializer,n))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zme extends class{}{constructor(e,r,n,c){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=n,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new rn(fr.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,n,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,p])=>this.connection.Mo(e,jD(r,n),c,d,p)).catch(d=>{throw d.name==="FirebaseError"?(d.code===fr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new rn(fr.UNKNOWN,d.toString())})}Lo(e,r,n,c,d){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,a])=>this.connection.Lo(e,jD(r,n),c,p,a,d)).catch(p=>{throw p.name==="FirebaseError"?(p.code===fr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new rn(fr.UNKNOWN,p.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Bme{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(yp(r),this.D_=!1):An("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vme{constructor(e,r,n,c,d){this.localStore=e,this.datastore=r,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=d,this.k_._o(p=>{n.enqueueAndForget(async()=>{Oy(this)&&(An("RemoteStore","Restarting streams for network reachability change."),await async function(w){const E=Ds(w);E.L_.add(4),await PE(E),E.q_.set("Unknown"),E.L_.delete(4),await jC(E)}(this))})}),this.q_=new Bme(n,c)}}async function jC(t){if(Oy(t))for(const e of t.B_)await e(!0)}async function PE(t){for(const e of t.B_)await e(!1)}function PH(t,e){const r=Ds(t);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),s3(r)?n3(r):tw(r).r_()&&r3(r,e))}function t3(t,e){const r=Ds(t),n=tw(r);r.N_.delete(e),n.r_()&&kH(r,e),r.N_.size===0&&(n.r_()?n.o_():Oy(r)&&r.q_.set("Unknown"))}function r3(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ks.min())>0){const r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}tw(t).A_(e)}function kH(t,e){t.Q_.xe(e),tw(t).R_(e)}function n3(t){t.Q_=new Upe({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),tw(t).start(),t.q_.v_()}function s3(t){return Oy(t)&&!tw(t).n_()&&t.N_.size>0}function Oy(t){return Ds(t).L_.size===0}function RH(t){t.Q_=void 0}async function Ume(t){t.q_.set("Online")}async function $me(t){t.N_.forEach((e,r)=>{r3(t,e)})}async function qme(t,e){RH(t),s3(t)?(t.q_.M_(e),n3(t)):t.q_.set("Unknown")}async function Gme(t,e,r){if(t.q_.set("Online"),e instanceof xH&&e.state===2&&e.cause)try{await async function(c,d){const p=d.cause;for(const a of d.targetIds)c.N_.has(a)&&(await c.remoteSyncer.rejectListen(a,p),c.N_.delete(a),c.Q_.removeTarget(a))}(t,e)}catch(n){An("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await YN(t,n)}else if(e instanceof eN?t.Q_.Ke(e):e instanceof yH?t.Q_.He(e):t.Q_.We(e),!r.isEqual(ks.min()))try{const n=await IH(t.localStore);r.compareTo(n)>=0&&await function(d,p){const a=d.Q_.rt(p);return a.targetChanges.forEach((w,E)=>{if(w.resumeToken.approximateByteSize()>0){const C=d.N_.get(E);C&&d.N_.set(E,C.withResumeToken(w.resumeToken,p))}}),a.targetMismatches.forEach((w,E)=>{const C=d.N_.get(w);if(!C)return;d.N_.set(w,C.withResumeToken(hl.EMPTY_BYTE_STRING,C.snapshotVersion)),kH(d,w);const P=new Zm(C.target,w,E,C.sequenceNumber);r3(d,P)}),d.remoteSyncer.applyRemoteEvent(a)}(t,r)}catch(n){An("RemoteStore","Failed to raise snapshot:",n),await YN(t,n)}}async function YN(t,e,r){if(!IE(e))throw e;t.L_.add(1),await PE(t),t.q_.set("Offline"),r||(r=()=>IH(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{An("RemoteStore","Retrying IndexedDB access"),await r(),t.L_.delete(1),await jC(t)})}function MH(t,e){return e().catch(r=>YN(t,r,e))}async function NC(t){const e=Ds(t),r=hg(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Hme(e);)try{const c=await Cme(e.localStore,n);if(c===null){e.O_.length===0&&r.o_();break}n=c.batchId,Wme(e,c)}catch(c){await YN(e,c)}DH(e)&&OH(e)}function Hme(t){return Oy(t)&&t.O_.length<10}function Wme(t,e){t.O_.push(e);const r=hg(t);r.r_()&&r.V_&&r.m_(e.mutations)}function DH(t){return Oy(t)&&!hg(t).n_()&&t.O_.length>0}function OH(t){hg(t).start()}async function Zme(t){hg(t).p_()}async function Kme(t){const e=hg(t);for(const r of t.O_)e.m_(r.mutations)}async function Xme(t,e,r){const n=t.O_.shift(),c=KL.from(n,e,r);await MH(t,()=>t.remoteSyncer.applySuccessfulWrite(c)),await NC(t)}async function Yme(t,e){e&&hg(t).V_&&await async function(n,c){if(function(p){return zpe(p)&&p!==fr.ABORTED}(c.code)){const d=n.O_.shift();hg(n).s_(),await MH(n,()=>n.remoteSyncer.rejectFailedWrite(d.batchId,c)),await NC(n)}}(t,e),DH(t)&&OH(t)}async function MU(t,e){const r=Ds(t);r.asyncQueue.verifyOperationInProgress(),An("RemoteStore","RemoteStore received new credentials");const n=Oy(r);r.L_.add(3),await PE(r),n&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await jC(r)}async function Jme(t,e){const r=Ds(t);e?(r.L_.delete(2),await jC(r)):e||(r.L_.add(2),await PE(r),r.q_.set("Unknown"))}function tw(t){return t.K_||(t.K_=function(r,n,c){const d=Ds(r);return d.w_(),new Lme(n,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}(t.datastore,t.asyncQueue,{Eo:Ume.bind(null,t),Ro:$me.bind(null,t),mo:qme.bind(null,t),d_:Gme.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),s3(t)?n3(t):t.q_.set("Unknown")):(await t.K_.stop(),RH(t))})),t.K_}function hg(t){return t.U_||(t.U_=function(r,n,c){const d=Ds(r);return d.w_(),new Fme(n,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Zme.bind(null,t),mo:Yme.bind(null,t),f_:Kme.bind(null,t),g_:Xme.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await NC(t)):(await t.U_.stop(),t.O_.length>0&&(An("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i3{constructor(e,r,n,c,d){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=n,this.op=c,this.removalCallback=d,this.deferred=new op,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,n,c,d){const p=Date.now()+n,a=new i3(e,r,p,c,d);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new rn(fr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function a3(t,e){if(yp("AsyncQueue",`${e}: ${t}`),IE(t))return new rn(fr.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(e){this.comparator=e?(r,n)=>e(r,n)||zn.comparator(r.key,n.key):(r,n)=>zn.comparator(r.key,n.key),this.keyedMap=F1(),this.sortedSet=new no(this.comparator)}static emptySet(e){return new n0(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,n)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof n0)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;r.hasNext();){const c=r.getNext().key,d=n.getNext().key;if(!c.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const n=new n0;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=r,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DU{constructor(){this.W_=new no(zn.comparator)}track(e){const r=e.doc.key,n=this.W_.get(r);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(r,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(r,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(r):e.type===1&&n.type===2?this.W_=this.W_.insert(r,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):js():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,n)=>{e.push(n)}),e}}class I0{constructor(e,r,n,c,d,p,a,w,E){this.query=e,this.docs=r,this.oldDocs=n,this.docChanges=c,this.mutatedKeys=d,this.fromCache=p,this.syncStateChanged=a,this.excludesMetadataChanges=w,this.hasCachedResults=E}static fromInitialDocuments(e,r,n,c,d){const p=[];return r.forEach(a=>{p.push({type:0,doc:a})}),new I0(e,r,n0.emptySet(r),p,n,c,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&xC(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,n=e.docChanges;if(r.length!==n.length)return!1;for(let c=0;c<r.length;c++)if(r[c].type!==n[c].type||!r[c].doc.isEqual(n[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qme{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class ege{constructor(){this.queries=OU(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,n){const c=Ds(r),d=c.queries;c.queries=OU(),d.forEach((p,a)=>{for(const w of a.j_)w.onError(n)})})(this,new rn(fr.ABORTED,"Firestore shutting down"))}}function OU(){return new ew(t=>nH(t),xC)}async function o3(t,e){const r=Ds(t);let n=3;const c=e.query;let d=r.queries.get(c);d?!d.H_()&&e.J_()&&(n=2):(d=new Qme,n=e.J_()?0:1);try{switch(n){case 0:d.z_=await r.onListen(c,!0);break;case 1:d.z_=await r.onListen(c,!1);break;case 2:await r.onFirstRemoteStoreListen(c)}}catch(p){const a=a3(p,`Initialization of query '${Ev(e.query)}' failed`);return void e.onError(a)}r.queries.set(c,d),d.j_.push(e),e.Z_(r.onlineState),d.z_&&e.X_(d.z_)&&c3(r)}async function l3(t,e){const r=Ds(t),n=e.query;let c=3;const d=r.queries.get(n);if(d){const p=d.j_.indexOf(e);p>=0&&(d.j_.splice(p,1),d.j_.length===0?c=e.J_()?0:1:!d.H_()&&e.J_()&&(c=2))}switch(c){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function tge(t,e){const r=Ds(t);let n=!1;for(const c of e){const d=c.query,p=r.queries.get(d);if(p){for(const a of p.j_)a.X_(c)&&(n=!0);p.z_=c}}n&&c3(r)}function rge(t,e,r){const n=Ds(t),c=n.queries.get(e);if(c)for(const d of c.j_)d.onError(r);n.queries.delete(e)}function c3(t){t.Y_.forEach(e=>{e.next()})}var AD,LU;(LU=AD||(AD={})).ea="default",LU.Cache="cache";class u3{constructor(e,r,n){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const c of e.docChanges)c.type!==3&&n.push(c);e=new I0(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const n=r!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=I0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==AD.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LH{constructor(e){this.key=e}}class FH{constructor(e){this.key=e}}class nge{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=_i(),this.mutatedKeys=_i(),this.Aa=sH(e),this.Ra=new n0(this.Aa)}get Va(){return this.Ta}ma(e,r){const n=r?r.fa:new DU,c=r?r.Ra:this.Ra;let d=r?r.mutatedKeys:this.mutatedKeys,p=c,a=!1;const w=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,E=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((C,P)=>{const R=c.get(C),B=vC(this.query,P)?P:null,V=!!R&&this.mutatedKeys.has(R.key),W=!!B&&(B.hasLocalMutations||this.mutatedKeys.has(B.key)&&B.hasCommittedMutations);let K=!1;R&&B?R.data.isEqual(B.data)?V!==W&&(n.track({type:3,doc:B}),K=!0):this.ga(R,B)||(n.track({type:2,doc:B}),K=!0,(w&&this.Aa(B,w)>0||E&&this.Aa(B,E)<0)&&(a=!0)):!R&&B?(n.track({type:0,doc:B}),K=!0):R&&!B&&(n.track({type:1,doc:R}),K=!0,(w||E)&&(a=!0)),K&&(B?(p=p.add(B),d=W?d.add(C):d.delete(C)):(p=p.delete(C),d=d.delete(C)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const C=this.query.limitType==="F"?p.last():p.first();p=p.delete(C.key),d=d.delete(C.key),n.track({type:1,doc:C})}return{Ra:p,fa:n,ns:a,mutatedKeys:d}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,n,c){const d=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const p=e.fa.G_();p.sort((C,P)=>function(B,V){const W=K=>{switch(K){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return js()}};return W(B)-W(V)}(C.type,P.type)||this.Aa(C.doc,P.doc)),this.pa(n),c=c!=null&&c;const a=r&&!c?this.ya():[],w=this.da.size===0&&this.current&&!c?1:0,E=w!==this.Ea;return this.Ea=w,p.length!==0||E?{snapshot:new I0(this.query,e.Ra,d,p,e.mutatedKeys,w===0,E,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new DU,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=_i(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const r=[];return e.forEach(n=>{this.da.has(n)||r.push(new FH(n))}),this.da.forEach(n=>{e.has(n)||r.push(new LH(n))}),r}ba(e){this.Ta=e.Ts,this.da=_i();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return I0.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class sge{constructor(e,r,n){this.query=e,this.targetId=r,this.view=n}}class ige{constructor(e){this.key=e,this.va=!1}}class age{constructor(e,r,n,c,d,p){this.localStore=e,this.remoteStore=r,this.eventManager=n,this.sharedClientState=c,this.currentUser=d,this.maxConcurrentLimboResolutions=p,this.Ca={},this.Fa=new ew(a=>nH(a),xC),this.Ma=new Map,this.xa=new Set,this.Oa=new no(zn.comparator),this.Na=new Map,this.La=new JL,this.Ba={},this.ka=new Map,this.qa=N0.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function oge(t,e,r=!0){const n=qH(t);let c;const d=n.Fa.get(e);return d?(n.sharedClientState.addLocalQueryTarget(d.targetId),c=d.view.Da()):c=await zH(n,e,r,!0),c}async function lge(t,e){const r=qH(t);await zH(r,e,!0,!1)}async function zH(t,e,r,n){const c=await Ame(t.localStore,tf(e)),d=c.targetId,p=t.sharedClientState.addLocalQueryTarget(d,r);let a;return n&&(a=await cge(t,e,d,p==="current",c.resumeToken)),t.isPrimaryClient&&r&&PH(t.remoteStore,c),a}async function cge(t,e,r,n,c){t.Ka=(P,R,B)=>async function(W,K,Z,$){let X=K.view.ma(Z);X.ns&&(X=await PU(W.localStore,K.query,!1).then(({documents:pe})=>K.view.ma(pe,X)));const Q=$&&$.targetChanges.get(K.targetId),re=$&&$.targetMismatches.get(K.targetId)!=null,ve=K.view.applyChanges(X,W.isPrimaryClient,Q,re);return zU(W,K.targetId,ve.wa),ve.snapshot}(t,P,R,B);const d=await PU(t.localStore,e,!0),p=new nge(e,d.Ts),a=p.ma(d.documents),w=AE.createSynthesizedTargetChangeForCurrentChange(r,n&&t.onlineState!=="Offline",c),E=p.applyChanges(a,t.isPrimaryClient,w);zU(t,r,E.wa);const C=new sge(e,r,p);return t.Fa.set(e,C),t.Ma.has(r)?t.Ma.get(r).push(e):t.Ma.set(r,[e]),E.snapshot}async function uge(t,e,r){const n=Ds(t),c=n.Fa.get(e),d=n.Ma.get(c.targetId);if(d.length>1)return n.Ma.set(c.targetId,d.filter(p=>!xC(p,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(c.targetId),n.sharedClientState.isActiveQueryTarget(c.targetId)||await CD(n.localStore,c.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(c.targetId),r&&t3(n.remoteStore,c.targetId),PD(n,c.targetId)}).catch(NE)):(PD(n,c.targetId),await CD(n.localStore,c.targetId,!0))}async function dge(t,e){const r=Ds(t),n=r.Fa.get(e),c=r.Ma.get(n.targetId);r.isPrimaryClient&&c.length===1&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),t3(r.remoteStore,n.targetId))}async function hge(t,e,r){const n=xge(t);try{const c=await function(p,a){const w=Ds(p),E=Lo.now(),C=a.reduce((B,V)=>B.add(V.key),_i());let P,R;return w.persistence.runTransaction("Locally write mutations","readwrite",B=>{let V=xp(),W=_i();return w.cs.getEntries(B,C).next(K=>{V=K,V.forEach((Z,$)=>{$.isValidDocument()||(W=W.add(Z))})}).next(()=>w.localDocuments.getOverlayedDocuments(B,V)).next(K=>{P=K;const Z=[];for(const $ of a){const X=Mpe($,P.get($.key).overlayedDocument);X!=null&&Z.push(new Cg($.key,X,XG(X.value.mapValue),Nc.exists(!0)))}return w.mutationQueue.addMutationBatch(B,E,Z,a)}).next(K=>{R=K;const Z=K.applyToLocalDocumentSet(P,W);return w.documentOverlayCache.saveOverlays(B,K.batchId,Z)})}).then(()=>({batchId:R.batchId,changes:aH(P)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(c.batchId),function(p,a,w){let E=p.Ba[p.currentUser.toKey()];E||(E=new no(Li)),E=E.insert(a,w),p.Ba[p.currentUser.toKey()]=E}(n,c.batchId,r),await kE(n,c.changes),await NC(n.remoteStore)}catch(c){const d=a3(c,"Failed to persist write");r.reject(d)}}async function BH(t,e){const r=Ds(t);try{const n=await Nme(r.localStore,e);e.targetChanges.forEach((c,d)=>{const p=r.Na.get(d);p&&(sa(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?p.va=!0:c.modifiedDocuments.size>0?sa(p.va):c.removedDocuments.size>0&&(sa(p.va),p.va=!1))}),await kE(r,n,e)}catch(n){await NE(n)}}function FU(t,e,r){const n=Ds(t);if(n.isPrimaryClient&&r===0||!n.isPrimaryClient&&r===1){const c=[];n.Fa.forEach((d,p)=>{const a=p.view.Z_(e);a.snapshot&&c.push(a.snapshot)}),function(p,a){const w=Ds(p);w.onlineState=a;let E=!1;w.queries.forEach((C,P)=>{for(const R of P.j_)R.Z_(a)&&(E=!0)}),E&&c3(w)}(n.eventManager,e),c.length&&n.Ca.d_(c),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function fge(t,e,r){const n=Ds(t);n.sharedClientState.updateQueryState(e,"rejected",r);const c=n.Na.get(e),d=c&&c.key;if(d){let p=new no(zn.comparator);p=p.insert(d,ql.newNoDocument(d,ks.min()));const a=_i().add(d),w=new EC(ks.min(),new Map,new no(Li),p,a);await BH(n,w),n.Oa=n.Oa.remove(d),n.Na.delete(e),d3(n)}else await CD(n.localStore,e,!1).then(()=>PD(n,e,r)).catch(NE)}async function pge(t,e){const r=Ds(t),n=e.batch.batchId;try{const c=await jme(r.localStore,e);UH(r,n,null),VH(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await kE(r,c)}catch(c){await NE(c)}}async function mge(t,e,r){const n=Ds(t);try{const c=await function(p,a){const w=Ds(p);return w.persistence.runTransaction("Reject batch","readwrite-primary",E=>{let C;return w.mutationQueue.lookupMutationBatch(E,a).next(P=>(sa(P!==null),C=P.keys(),w.mutationQueue.removeMutationBatch(E,P))).next(()=>w.mutationQueue.performConsistencyCheck(E)).next(()=>w.documentOverlayCache.removeOverlaysForBatchId(E,C,a)).next(()=>w.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(E,C)).next(()=>w.localDocuments.getDocuments(E,C))})}(n.localStore,e);UH(n,e,r),VH(n,e),n.sharedClientState.updateMutationState(e,"rejected",r),await kE(n,c)}catch(c){await NE(c)}}function VH(t,e){(t.ka.get(e)||[]).forEach(r=>{r.resolve()}),t.ka.delete(e)}function UH(t,e,r){const n=Ds(t);let c=n.Ba[n.currentUser.toKey()];if(c){const d=c.get(e);d&&(r?d.reject(r):d.resolve(),c=c.remove(e)),n.Ba[n.currentUser.toKey()]=c}}function PD(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(const n of t.Ma.get(e))t.Fa.delete(n),r&&t.Ca.$a(n,r);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(n=>{t.La.containsKey(n)||$H(t,n)})}function $H(t,e){t.xa.delete(e.path.canonicalString());const r=t.Oa.get(e);r!==null&&(t3(t.remoteStore,r),t.Oa=t.Oa.remove(e),t.Na.delete(r),d3(t))}function zU(t,e,r){for(const n of r)n instanceof LH?(t.La.addReference(n.key,e),gge(t,n)):n instanceof FH?(An("SyncEngine","Document no longer in limbo: "+n.key),t.La.removeReference(n.key,e),t.La.containsKey(n.key)||$H(t,n.key)):js()}function gge(t,e){const r=e.key,n=r.path.canonicalString();t.Oa.get(r)||t.xa.has(n)||(An("SyncEngine","New document in limbo: "+r),t.xa.add(n),d3(t))}function d3(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const r=new zn(_a.fromString(e)),n=t.qa.next();t.Na.set(n,new ige(r)),t.Oa=t.Oa.insert(r,n),PH(t.remoteStore,new Zm(tf(yC(r.path)),n,"TargetPurposeLimboResolution",UL.oe))}}async function kE(t,e,r){const n=Ds(t),c=[],d=[],p=[];n.Fa.isEmpty()||(n.Fa.forEach((a,w)=>{p.push(n.Ka(w,e,r).then(E=>{var C;if((E||r)&&n.isPrimaryClient){const P=E?!E.fromCache:(C=r==null?void 0:r.targetChanges.get(w.targetId))===null||C===void 0?void 0:C.current;n.sharedClientState.updateQueryState(w.targetId,P?"current":"not-current")}if(E){c.push(E);const P=e3.Wi(w.targetId,E);d.push(P)}}))}),await Promise.all(p),n.Ca.d_(c),await async function(w,E){const C=Ds(w);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",P=>Cr.forEach(E,R=>Cr.forEach(R.$i,B=>C.persistence.referenceDelegate.addReference(P,R.targetId,B)).next(()=>Cr.forEach(R.Ui,B=>C.persistence.referenceDelegate.removeReference(P,R.targetId,B)))))}catch(P){if(!IE(P))throw P;An("LocalStore","Failed to update sequence numbers: "+P)}for(const P of E){const R=P.targetId;if(!P.fromCache){const B=C.os.get(R),V=B.snapshotVersion,W=B.withLastLimboFreeSnapshotVersion(V);C.os=C.os.insert(R,W)}}}(n.localStore,d))}async function _ge(t,e){const r=Ds(t);if(!r.currentUser.isEqual(e)){An("SyncEngine","User change. New user:",e.toKey());const n=await NH(r.localStore,e);r.currentUser=e,function(d,p){d.ka.forEach(a=>{a.forEach(w=>{w.reject(new rn(fr.CANCELLED,p))})}),d.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await kE(r,n.hs)}}function yge(t,e){const r=Ds(t),n=r.Na.get(e);if(n&&n.va)return _i().add(n.key);{let c=_i();const d=r.Ma.get(e);if(!d)return c;for(const p of d){const a=r.Fa.get(p);c=c.unionWith(a.view.Va)}return c}}function qH(t){const e=Ds(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=BH.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=yge.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fge.bind(null,e),e.Ca.d_=tge.bind(null,e.eventManager),e.Ca.$a=rge.bind(null,e.eventManager),e}function xge(t){const e=Ds(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=pge.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mge.bind(null,e),e}class JN{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=TC(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,r){return null}Ha(e,r){return null}za(e){return Tme(this.persistence,new Sme,e.initialUser,this.serializer)}Ga(e){return new vme(QL.Zr,this.serializer)}Wa(e){return new kme}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}JN.provider={build:()=>new JN};class kD{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>FU(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=_ge.bind(null,this.syncEngine),await Jme(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new ege}()}createDatastore(e){const r=TC(e.databaseInfo.databaseId),n=function(d){return new Ome(d)}(e.databaseInfo);return function(d,p,a,w){return new zme(d,p,a,w)}(e.authCredentials,e.appCheckCredentials,n,r)}createRemoteStore(e){return function(n,c,d,p,a){return new Vme(n,c,d,p,a)}(this.localStore,this.datastore,e.asyncQueue,r=>FU(this.syncEngine,r,0),function(){return RU.D()?new RU:new Rme}())}createSyncEngine(e,r){return function(c,d,p,a,w,E,C){const P=new age(c,d,p,a,w,E);return C&&(P.Qa=!0),P}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(c){const d=Ds(c);An("RemoteStore","RemoteStore shutting down."),d.L_.add(5),await PE(d),d.k_.shutdown(),d.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}kD.provider={build:()=>new kD};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):yp("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,r){setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vge{constructor(e,r,n,c,d){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=n,this.databaseInfo=c,this.user=Ul.UNAUTHENTICATED,this.clientId=VL.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(n,async p=>{An("FirestoreClient","Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(n,p=>(An("FirestoreClient","Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new op;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const n=a3(r,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function pR(t,e){t.asyncQueue.verifyOperationInProgress(),An("FirestoreClient","Initializing OfflineComponentProvider");const r=t.configuration;await e.initialize(r);let n=r.initialUser;t.setCredentialChangeListener(async c=>{n.isEqual(c)||(await NH(e.localStore,c),n=c)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function BU(t,e){t.asyncQueue.verifyOperationInProgress();const r=await wge(t);An("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,t.configuration),t.setCredentialChangeListener(n=>MU(e.remoteStore,n)),t.setAppCheckTokenChangeListener((n,c)=>MU(e.remoteStore,c)),t._onlineComponents=e}async function wge(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){An("FirestoreClient","Using user provided OfflineComponentProvider");try{await pR(t,t._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!function(c){return c.name==="FirebaseError"?c.code===fr.FAILED_PRECONDITION||c.code===fr.UNIMPLEMENTED:!(typeof DOMException<"u"&&c instanceof DOMException)||c.code===22||c.code===20||c.code===11}(r))throw r;ly("Error using user provided cache. Falling back to memory cache: "+r),await pR(t,new JN)}}else An("FirestoreClient","Using default OfflineComponentProvider"),await pR(t,new JN);return t._offlineComponents}async function GH(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(An("FirestoreClient","Using user provided OnlineComponentProvider"),await BU(t,t._uninitializedComponentsProvider._online)):(An("FirestoreClient","Using default OnlineComponentProvider"),await BU(t,new kD))),t._onlineComponents}function bge(t){return GH(t).then(e=>e.syncEngine)}async function QN(t){const e=await GH(t),r=e.eventManager;return r.onListen=oge.bind(null,e.syncEngine),r.onUnlisten=uge.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=lge.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=dge.bind(null,e.syncEngine),r}function Sge(t,e,r={}){const n=new op;return t.asyncQueue.enqueueAndForget(async()=>function(d,p,a,w,E){const C=new h3({next:R=>{C.Za(),p.enqueueAndForget(()=>l3(d,P));const B=R.docs.has(a);!B&&R.fromCache?E.reject(new rn(fr.UNAVAILABLE,"Failed to get document because the client is offline.")):B&&R.fromCache&&w&&w.source==="server"?E.reject(new rn(fr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):E.resolve(R)},error:R=>E.reject(R)}),P=new u3(yC(a.path),C,{includeMetadataChanges:!0,_a:!0});return o3(d,P)}(await QN(t),t.asyncQueue,e,r,n)),n.promise}function Ege(t,e,r={}){const n=new op;return t.asyncQueue.enqueueAndForget(async()=>function(d,p,a,w,E){const C=new h3({next:R=>{C.Za(),p.enqueueAndForget(()=>l3(d,P)),R.fromCache&&w.source==="server"?E.reject(new rn(fr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):E.resolve(R)},error:R=>E.reject(R)}),P=new u3(a,C,{includeMetadataChanges:!0,_a:!0});return o3(d,P)}(await QN(t),t.asyncQueue,e,r,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HH(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VU=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WH(t,e,r){if(!r)throw new rn(fr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ZH(t,e,r,n){if(e===!0&&n===!0)throw new rn(fr.INVALID_ARGUMENT,`${t} and ${r} cannot be used together.`)}function UU(t){if(!zn.isDocumentKey(t))throw new rn(fr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function $U(t){if(zn.isDocumentKey(t))throw new rn(fr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function IC(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":js()}function Gl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new rn(fr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=IC(t);throw new rn(fr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return t}function Tge(t,e){if(e<=0)throw new rn(fr.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qU{constructor(e){var r,n;if(e.host===void 0){if(e.ssl!==void 0)throw new rn(fr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new rn(fr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ZH("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=HH((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new rn(fr.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new rn(fr.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new rn(fr.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,c){return n.timeoutSeconds===c.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class CC{constructor(e,r,n,c){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=n,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qU({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rn(fr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new rn(fr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qU(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new WG;switch(n.type){case"firstParty":return new Zfe(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new rn(fr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const n=VU.get(r);n&&(An("ComponentProvider","Removing Datastore"),VU.delete(r),n.terminate())}(this),Promise.resolve()}}function KH(t,e,r,n={}){var c;const d=(t=Gl(t,CC))._getSettings(),p=`${e}:${r}`;if(d.host!=="firestore.googleapis.com"&&d.host!==p&&ly("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},d),{host:p,ssl:!1})),n.mockUserToken){let a,w;if(typeof n.mockUserToken=="string")a=n.mockUserToken,w=Ul.MOCK_USER;else{a=q7(n.mockUserToken,(c=t._app)===null||c===void 0?void 0:c.options.projectId);const E=n.mockUserToken.sub||n.mockUserToken.user_id;if(!E)throw new rn(fr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Ul(E)}t._authCredentials=new Gfe(new HG(a,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(e,r,n){this.converter=r,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new uh(this.firestore,e,this._query)}}class jl{constructor(e,r,n){this.converter=r,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new jl(this.firestore,e,this._key)}}class lp extends uh{constructor(e,r,n){super(e,r,yC(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new jl(this.firestore,null,new zn(e))}withConverter(e){return new lp(this.firestore,e,this._path)}}function jn(t,e,...r){if(t=ai(t),WH("collection","path",e),t instanceof CC){const n=_a.fromString(e,...r);return $U(n),new lp(t,null,n)}{if(!(t instanceof jl||t instanceof lp))throw new rn(fr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(_a.fromString(e,...r));return $U(n),new lp(t.firestore,null,n)}}function hn(t,e,...r){if(t=ai(t),arguments.length===1&&(e=VL.newId()),WH("doc","path",e),t instanceof CC){const n=_a.fromString(e,...r);return UU(n),new jl(t,null,new zn(n))}{if(!(t instanceof jl||t instanceof lp))throw new rn(fr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(_a.fromString(e,...r));return UU(n),new jl(t.firestore,t instanceof lp?t.converter:null,new zn(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GU{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new CH(this,"async_queue_retry"),this.Vu=()=>{const n=fR();n&&An("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const r=fR();r&&typeof r.addEventListener=="function"&&r.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const r=fR();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const r=new op;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!IE(e))throw e;An("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const r=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const c=function(p){let a=p.message||"";return p.stack&&(a=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),a}(n);throw yp("INTERNAL UNHANDLED ERROR: ",c),n}).then(n=>(this.du=!1,n))));return this.mu=r,r}enqueueAfterDelay(e,r,n){this.fu(),this.Ru.indexOf(e)>-1&&(r=0);const c=i3.createAndSchedule(this,e,r,n,d=>this.yu(d));return this.Tu.push(c),c}fu(){this.Eu&&js()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const r of this.Tu)if(r.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((r,n)=>r.targetTimeMs-n.targetTimeMs);for(const r of this.Tu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const r=this.Tu.indexOf(e);this.Tu.splice(r,1)}}function HU(t){return function(r,n){if(typeof r!="object"||r===null)return!1;const c=r;for(const d of n)if(d in c&&typeof c[d]=="function")return!0;return!1}(t,["next","error","complete"])}class nh extends CC{constructor(e,r,n,c){super(e,r,n,c),this.type="firestore",this._queue=new GU,this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new GU(e),this._firestoreClient=void 0,await e}}}function XH(t,e){const r=typeof t=="object"?t:hC(),n=typeof t=="string"?t:"(default)",c=Ig(r,"firestore").getImmediate({identifier:n});if(!c._initialized){const d=V7("firestore");d&&KH(c,...d)}return c}function rw(t){if(t._terminated)throw new rn(fr.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||jge(t),t._firestoreClient}function jge(t){var e,r,n;const c=t._freezeSettings(),d=function(a,w,E,C){return new ope(a,w,E,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,HH(C.experimentalLongPollingOptions),C.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,c);t._componentsProvider||!((r=c.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((n=c.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(t._componentsProvider={_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider}),t._firestoreClient=new vge(t._authCredentials,t._appCheckCredentials,t._queue,d,t._componentsProvider&&function(a){const w=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(w),_online:w}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dy(hl.fromBase64String(e))}catch(r){throw new rn(fr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new dy(hl.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new rn(fr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ll(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new rn(fr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new rn(fr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Li(this._lat,e._lat)||Li(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,c){if(n.length!==c.length)return!1;for(let d=0;d<n.length;++d)if(n[d]!==c[d])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nge=/^__.*__$/;class Ige{constructor(e,r,n){this.data=e,this.fieldMask=r,this.fieldTransforms=n}toMutation(e,r){return this.fieldMask!==null?new Cg(e,this.data,this.fieldMask,r,this.fieldTransforms):new CE(e,this.data,r,this.fieldTransforms)}}class YH{constructor(e,r,n){this.data=e,this.fieldMask=r,this.fieldTransforms=n}toMutation(e,r){return new Cg(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function JH(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw js()}}class f3{constructor(e,r,n,c,d,p){this.settings=e,this.databaseId=r,this.serializer=n,this.ignoreUndefinedProperties=c,d===void 0&&this.vu(),this.fieldTransforms=d||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new f3(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var r;const n=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.Fu({path:n,xu:!1});return c.Ou(e),c}Nu(e){var r;const n=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.Fu({path:n,xu:!1});return c.vu(),c}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return eI(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(JH(this.Cu)&&Nge.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Cge{constructor(e,r,n){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=n||TC(e)}Qu(e,r,n,c=!1){return new f3({Cu:e,methodName:r,qu:n,path:ll.emptyPath(),xu:!1,ku:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function iw(t){const e=t._freezeSettings(),r=TC(t._databaseId);return new Cge(t._databaseId,!!e.ignoreUndefinedProperties,r)}function p3(t,e,r,n,c,d={}){const p=t.Qu(d.merge||d.mergeFields?2:0,e,r,c);_3("Data must be an object, but it was:",p,n);const a=rW(n,p);let w,E;if(d.merge)w=new Iu(p.fieldMask),E=p.fieldTransforms;else if(d.mergeFields){const C=[];for(const P of d.mergeFields){const R=RD(e,P,r);if(!p.contains(R))throw new rn(fr.INVALID_ARGUMENT,`Field '${R}' is specified in your field mask but missing from your input data.`);sW(C,R)||C.push(R)}w=new Iu(C),E=p.fieldTransforms.filter(P=>w.covers(P.field))}else w=null,E=p.fieldTransforms;return new Ige(new Xc(a),w,E)}class kC extends sw{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof kC}}class m3 extends sw{_toFieldTransform(e){return new pH(e.path,new VS)}isEqual(e){return e instanceof m3}}class g3 extends sw{constructor(e,r){super(e),this.$u=r}_toFieldTransform(e){const r=new qS(e.serializer,cH(e.serializer,this.$u));return new pH(e.path,r)}isEqual(e){return e instanceof g3&&this.$u===e.$u}}function QH(t,e,r,n){const c=t.Qu(1,e,r);_3("Data must be an object, but it was:",c,n);const d=[],p=Xc.empty();My(n,(w,E)=>{const C=y3(e,w,r);E=ai(E);const P=c.Nu(C);if(E instanceof kC)d.push(C);else{const R=RE(E,P);R!=null&&(d.push(C),p.set(C,R))}});const a=new Iu(d);return new YH(p,a,c.fieldTransforms)}function eW(t,e,r,n,c,d){const p=t.Qu(1,e,r),a=[RD(e,n,r)],w=[c];if(d.length%2!=0)throw new rn(fr.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let R=0;R<d.length;R+=2)a.push(RD(e,d[R])),w.push(d[R+1]);const E=[],C=Xc.empty();for(let R=a.length-1;R>=0;--R)if(!sW(E,a[R])){const B=a[R];let V=w[R];V=ai(V);const W=p.Nu(B);if(V instanceof kC)E.push(B);else{const K=RE(V,W);K!=null&&(E.push(B),C.set(B,K))}}const P=new Iu(E);return new YH(C,P,p.fieldTransforms)}function tW(t,e,r,n=!1){return RE(r,t.Qu(n?4:3,e))}function RE(t,e){if(nW(t=ai(t)))return _3("Unsupported field value:",e,t),rW(t,e);if(t instanceof sw)return function(n,c){if(!JH(c.Cu))throw c.Bu(`${n._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Bu(`${n._methodName}() is not currently supported inside arrays`);const d=n._toFieldTransform(c);d&&c.fieldTransforms.push(d)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,c){const d=[];let p=0;for(const a of n){let w=RE(a,c.Lu(p));w==null&&(w={nullValue:"NULL_VALUE"}),d.push(w),p++}return{arrayValue:{values:d}}}(t,e)}return function(n,c){if((n=ai(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return cH(c.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const d=Lo.fromDate(n);return{timestampValue:XN(c.serializer,d)}}if(n instanceof Lo){const d=new Lo(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:XN(c.serializer,d)}}if(n instanceof AC)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof dy)return{bytesValue:vH(c.serializer,n._byteString)};if(n instanceof jl){const d=c.databaseId,p=n.firestore._databaseId;if(!p.isEqual(d))throw c.Bu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:YL(n.firestore._databaseId||c.databaseId,n._key.path)}}if(n instanceof PC)return function(p,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:p.toArray().map(w=>{if(typeof w!="number")throw a.Bu("VectorValues must only contain numeric values.");return ZL(a.serializer,w)})}}}}}}(n,c);throw c.Bu(`Unsupported field value: ${IC(n)}`)}(t,e)}function rW(t,e){const r={};return ZG(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):My(t,(n,c)=>{const d=RE(c,e.Mu(n));d!=null&&(r[n]=d)}),{mapValue:{fields:r}}}function nW(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Lo||t instanceof AC||t instanceof dy||t instanceof jl||t instanceof sw||t instanceof PC)}function _3(t,e,r){if(!nW(r)||!function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}(r)){const n=IC(r);throw n==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+n)}}function RD(t,e,r){if((e=ai(e))instanceof nw)return e._internalPath;if(typeof e=="string")return y3(t,e);throw eI("Field path arguments must be of type string or ",t,!1,void 0,r)}const Age=new RegExp("[~\\*/\\[\\]]");function y3(t,e,r){if(e.search(Age)>=0)throw eI(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new nw(...e.split("."))._internalPath}catch{throw eI(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function eI(t,e,r,n,c){const d=n&&!n.isEmpty(),p=c!==void 0;let a=`Function ${e}() called with invalid data`;r&&(a+=" (via `toFirestore()`)"),a+=". ";let w="";return(d||p)&&(w+=" (found",d&&(w+=` in field ${n}`),p&&(w+=` in document ${c}`),w+=")"),new rn(fr.INVALID_ARGUMENT,a+t+w)}function sW(t,e){return t.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x3{constructor(e,r,n,c,d){this._firestore=e,this._userDataWriter=r,this._key=n,this._document=c,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new jl(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Pge(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(RC("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class Pge extends x3{data(){return super.data()}}function RC(t,e){return typeof e=="string"?y3(t,e):e instanceof nw?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iW(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new rn(fr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class v3{}class ME extends v3{}function ms(t,e,...r){let n=[];e instanceof v3&&n.push(e),n=n.concat(r),function(d){const p=d.filter(w=>w instanceof MC).length,a=d.filter(w=>w instanceof DE).length;if(p>1||p>0&&a>0)throw new rn(fr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const c of n)t=c._apply(t);return t}class DE extends ME{constructor(e,r,n){super(),this._field=e,this._op=r,this._value=n,this.type="where"}static _create(e,r,n){return new DE(e,r,n)}_apply(e){const r=this._parse(e);return oW(e._query,r),new uh(e.firestore,e.converter,ED(e._query,r))}_parse(e){const r=iw(e.firestore);return function(d,p,a,w,E,C,P){let R;if(E.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new rn(fr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){ZU(P,C);const B=[];for(const V of P)B.push(WU(w,d,V));R={arrayValue:{values:B}}}else R=WU(w,d,P)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||ZU(P,C),R=tW(a,p,P,C==="in"||C==="not-in");return Mo.create(E,C,R)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}function ii(t,e,r){const n=e,c=RC("where",t);return DE._create(c,n,r)}class MC extends v3{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new MC(e,r)}_parse(e){const r=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return r.length===1?r[0]:rh.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:(function(c,d){let p=c;const a=d.getFlattenedFilters();for(const w of a)oW(p,w),p=ED(p,w)}(e._query,r),new uh(e.firestore,e.converter,ED(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class DC extends ME{constructor(e,r){super(),this._field=e,this._direction=r,this.type="orderBy"}static _create(e,r){return new DC(e,r)}_apply(e){const r=function(c,d,p){if(c.startAt!==null)throw new rn(fr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(c.endAt!==null)throw new rn(fr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new BS(d,p)}(e._query,this._field,this._direction);return new uh(e.firestore,e.converter,function(c,d){const p=c.explicitOrderBy.concat([d]);return new Dy(c.path,c.collectionGroup,p,c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(e._query,r))}}function eo(t,e="asc"){const r=e,n=RC("orderBy",t);return DC._create(n,r)}class OC extends ME{constructor(e,r,n){super(),this.type=e,this._limit=r,this._limitType=n}static _create(e,r,n){return new OC(e,r,n)}_apply(e){return new uh(e.firestore,e.converter,KN(e._query,this._limit,this._limitType))}}function la(t){return Tge("limit",t),OC._create("limit",t,"F")}class LC extends ME{constructor(e,r,n){super(),this.type=e,this._docOrFields=r,this._inclusive=n}static _create(e,r,n){return new LC(e,r,n)}_apply(e){const r=kge(e,this.type,this._docOrFields,this._inclusive);return new uh(e.firestore,e.converter,function(c,d){return new Dy(c.path,c.collectionGroup,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,d,c.endAt)}(e._query,r))}}function aW(...t){return LC._create("startAfter",t,!1)}function kge(t,e,r,n){if(r[0]=ai(r[0]),r[0]instanceof x3)return function(d,p,a,w,E){if(!w)throw new rn(fr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const C=[];for(const P of r0(d))if(P.field.isKeyField())C.push(ZN(p,w.key));else{const R=w.data.field(P.field);if(_C(R))throw new rn(fr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+P.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(R===null){const B=P.field.canonicalString();throw new rn(fr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${B}' (used as the orderBy) does not exist.`)}C.push(R)}return new j0(C,E)}(t._query,t.firestore._databaseId,e,r[0]._document,n);{const c=iw(t.firestore);return function(p,a,w,E,C,P){const R=p.explicitOrderBy;if(C.length>R.length)throw new rn(fr.INVALID_ARGUMENT,`Too many arguments provided to ${E}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const B=[];for(let V=0;V<C.length;V++){const W=C[V];if(R[V].field.isKeyField()){if(typeof W!="string")throw new rn(fr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${E}(), but got a ${typeof W}`);if(!WL(p)&&W.indexOf("/")!==-1)throw new rn(fr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${E}() must be a plain document ID, but '${W}' contains a slash.`);const K=p.path.child(_a.fromString(W));if(!zn.isDocumentKey(K))throw new rn(fr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${E}() must result in a valid document path, but '${K}' is not because it contains an odd number of segments.`);const Z=new zn(K);B.push(ZN(a,Z))}else{const K=tW(w,E,W);B.push(K)}}return new j0(B,P)}(t._query,t.firestore._databaseId,c,e,r,n)}}function WU(t,e,r){if(typeof(r=ai(r))=="string"){if(r==="")throw new rn(fr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!WL(e)&&r.indexOf("/")!==-1)throw new rn(fr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const n=e.path.child(_a.fromString(r));if(!zn.isDocumentKey(n))throw new rn(fr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ZN(t,new zn(n))}if(r instanceof jl)return ZN(t,r._key);throw new rn(fr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${IC(r)}.`)}function ZU(t,e){if(!Array.isArray(t)||t.length===0)throw new rn(fr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function oW(t,e){const r=function(c,d){for(const p of c)for(const a of p.getFlattenedFilters())if(d.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(r!==null)throw r===e.op?new rn(fr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new rn(fr.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}class lW{convertValue(e,r="none"){switch(uy(e)){case 0:return null;case 1:return e.booleanValue;case 2:return wo(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(cy(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw js()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const n={};return My(e,(c,d)=>{n[c]=this.convertValue(d,r)}),n}convertVectorValue(e){var r,n,c;const d=(c=(n=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||n===void 0?void 0:n.values)===null||c===void 0?void 0:c.map(p=>wo(p.doubleValue));return new PC(d)}convertGeoPoint(e){return new AC(wo(e.latitude),wo(e.longitude))}convertArray(e,r){return(e.values||[]).map(n=>this.convertValue(n,r))}convertServerTimestamp(e,r){switch(r){case"previous":const n=$L(e);return n==null?null:this.convertValue(n,r);case"estimate":return this.convertTimestamp(FS(e));default:return null}}convertTimestamp(e){const r=dg(e);return new Lo(r.seconds,r.nanos)}convertDocumentKey(e,r){const n=_a.fromString(e);sa(jH(n));const c=new S0(n.get(1),n.get(3)),d=new zn(n.popFirst(5));return c.isEqual(r)||yp(`Document ${d} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w3(t,e,r){let n;return n=t?r&&(r.merge||r.mergeFields)?t.toFirestore(e,r):t.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class b3 extends x3{constructor(e,r,n,c,d,p){super(e,r,n,c,p),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new aS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const n=this._document.data.field(RC("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,r.serverTimestamps)}}}class aS extends b3{data(e={}){return super.data(e)}}class S3{constructor(e,r,n,c){this._firestore=e,this._userDataWriter=r,this._snapshot=c,this.metadata=new $v(c.hasPendingWrites,c.fromCache),this.query=n}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(n=>{e.call(r,new aS(this._firestore,this._userDataWriter,n.key,n,new $v(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new rn(fr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(c,d){if(c._snapshot.oldDocs.isEmpty()){let p=0;return c._snapshot.docChanges.map(a=>{const w=new aS(c._firestore,c._userDataWriter,a.doc.key,a.doc,new $v(c._snapshot.mutatedKeys.has(a.doc.key),c._snapshot.fromCache),c.query.converter);return a.doc,{type:"added",doc:w,oldIndex:-1,newIndex:p++}})}{let p=c._snapshot.oldDocs;return c._snapshot.docChanges.filter(a=>d||a.type!==3).map(a=>{const w=new aS(c._firestore,c._userDataWriter,a.doc.key,a.doc,new $v(c._snapshot.mutatedKeys.has(a.doc.key),c._snapshot.fromCache),c.query.converter);let E=-1,C=-1;return a.type!==0&&(E=p.indexOf(a.doc.key),p=p.delete(a.doc.key)),a.type!==1&&(p=p.add(a.doc),C=p.indexOf(a.doc.key)),{type:Rge(a.type),doc:w,oldIndex:E,newIndex:C}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function Rge(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return js()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xa(t){t=Gl(t,jl);const e=Gl(t.firestore,nh);return Sge(rw(e),t._key).then(r=>cW(e,t,r))}class E3 extends lW{constructor(e){super(),this.firestore=e}convertBytes(e){return new dy(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new jl(this.firestore,null,r)}}function gs(t){t=Gl(t,uh);const e=Gl(t.firestore,nh),r=rw(e),n=new E3(e);return iW(t._query),Ege(r,t._query).then(c=>new S3(e,n,t,c))}function C0(t,e,r){t=Gl(t,jl);const n=Gl(t.firestore,nh),c=w3(t.converter,e,r);return aw(n,[p3(iw(n),"setDoc",t._key,c,t.converter!==null,r).toMutation(t._key,Nc.none())])}function Rs(t,e,r,...n){t=Gl(t,jl);const c=Gl(t.firestore,nh),d=iw(c);let p;return p=typeof(e=ai(e))=="string"||e instanceof nw?eW(d,"updateDoc",t._key,e,r,n):QH(d,"updateDoc",t._key,e),aw(c,[p.toMutation(t._key,Nc.exists(!0))])}function cd(t){return aw(Gl(t.firestore,nh),[new SC(t._key,Nc.none())])}function af(t,e){const r=Gl(t.firestore,nh),n=hn(t),c=w3(t.converter,e);return aw(r,[p3(iw(t.firestore),"addDoc",n._key,c,t.converter!==null,{}).toMutation(n._key,Nc.exists(!1))]).then(()=>n)}function hy(t,...e){var r,n,c;t=ai(t);let d={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||HU(e[p])||(d=e[p],p++);const a={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(HU(e[p])){const P=e[p];e[p]=(r=P.next)===null||r===void 0?void 0:r.bind(P),e[p+1]=(n=P.error)===null||n===void 0?void 0:n.bind(P),e[p+2]=(c=P.complete)===null||c===void 0?void 0:c.bind(P)}let w,E,C;if(t instanceof jl)E=Gl(t.firestore,nh),C=yC(t._key.path),w={next:P=>{e[p]&&e[p](cW(E,t,P))},error:e[p+1],complete:e[p+2]};else{const P=Gl(t,uh);E=Gl(P.firestore,nh),C=P._query;const R=new E3(E);w={next:B=>{e[p]&&e[p](new S3(E,R,P,B))},error:e[p+1],complete:e[p+2]},iW(t._query)}return function(R,B,V,W){const K=new h3(W),Z=new u3(B,K,V);return R.asyncQueue.enqueueAndForget(async()=>o3(await QN(R),Z)),()=>{K.Za(),R.asyncQueue.enqueueAndForget(async()=>l3(await QN(R),Z))}}(rw(E),C,a,w)}function aw(t,e){return function(n,c){const d=new op;return n.asyncQueue.enqueueAndForget(async()=>hge(await bge(n),c,d)),d.promise}(rw(t),e)}function cW(t,e,r){const n=r.docs.get(e._key),c=new E3(t);return new b3(t,c,e._key,n,new $v(r.hasPendingWrites,r.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uW{constructor(e,r){this._firestore=e,this._commitHandler=r,this._mutations=[],this._committed=!1,this._dataReader=iw(e)}set(e,r,n){this._verifyNotCommitted();const c=mR(e,this._firestore),d=w3(c.converter,r,n),p=p3(this._dataReader,"WriteBatch.set",c._key,d,c.converter!==null,n);return this._mutations.push(p.toMutation(c._key,Nc.none())),this}update(e,r,n,...c){this._verifyNotCommitted();const d=mR(e,this._firestore);let p;return p=typeof(r=ai(r))=="string"||r instanceof nw?eW(this._dataReader,"WriteBatch.update",d._key,r,n,c):QH(this._dataReader,"WriteBatch.update",d._key,r),this._mutations.push(p.toMutation(d._key,Nc.exists(!0))),this}delete(e){this._verifyNotCommitted();const r=mR(e,this._firestore);return this._mutations=this._mutations.concat(new SC(r._key,Nc.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rn(fr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function mR(t,e){if((t=ai(t)).firestore!==e)throw new rn(fr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function aa(){return new m3("serverTimestamp")}function MD(t){return new g3("increment",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T3(t){return rw(t=Gl(t,nh)),new uW(t,e=>aw(t,e))}(function(e,r=!0){(function(c){Q0=c})(Ry),th(new ld("firestore",(n,{instanceIdentifier:c,options:d})=>{const p=n.getProvider("app").getImmediate(),a=new nh(new Hfe(n.getProvider("auth-internal")),new Xfe(n.getProvider("app-check-internal")),function(E,C){if(!Object.prototype.hasOwnProperty.apply(E.options,["projectId"]))throw new rn(fr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new S0(E.options.projectId,C)}(p,c),p);return d=Object.assign({useFetchStreams:r},d),a._setSettings(d),a},"PUBLIC").setMultipleInstances(!0)),nu(uU,"4.7.3",e),nu(uU,"4.7.3","esm2017")})();const Mge=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:lW,Bytes:dy,CollectionReference:lp,DocumentReference:jl,DocumentSnapshot:b3,FieldPath:nw,FieldValue:sw,Firestore:nh,FirestoreError:rn,GeoPoint:AC,Query:uh,QueryCompositeFilterConstraint:MC,QueryConstraint:ME,QueryDocumentSnapshot:aS,QueryFieldFilterConstraint:DE,QueryLimitConstraint:OC,QueryOrderByConstraint:DC,QuerySnapshot:S3,QueryStartAtConstraint:LC,SnapshotMetadata:$v,Timestamp:Lo,VectorValue:PC,WriteBatch:uW,_AutoId:VL,_ByteString:hl,_DatabaseId:S0,_DocumentKey:zn,_EmptyAuthCredentialsProvider:WG,_FieldPath:ll,_cast:Gl,_logWarn:ly,_validateIsNotUsedTogether:ZH,addDoc:af,collection:jn,connectFirestoreEmulator:KH,deleteDoc:cd,doc:hn,ensureFirestoreConfigured:rw,executeWrite:aw,getDoc:Xa,getDocs:gs,getFirestore:XH,increment:MD,limit:la,onSnapshot:hy,orderBy:eo,query:ms,serverTimestamp:aa,setDoc:C0,startAfter:aW,updateDoc:Rs,where:ii,writeBatch:T3},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dW="firebasestorage.googleapis.com",hW="storageBucket",Dge=2*60*1e3,Oge=10*60*1e3,Lge=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let So=class fW extends dd{constructor(e,r,n=0){super(gR(e),`Firebase Storage: ${r} (${gR(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,fW.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return gR(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}};var ka;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ka||(ka={}));function gR(t){return"storage/"+t}function j3(){const t="An unknown error occurred, please check the error payload for server response.";return new So(ka.UNKNOWN,t)}function Fge(t){return new So(ka.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function zge(t){return new So(ka.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Bge(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new So(ka.UNAUTHENTICATED,t)}function Vge(){return new So(ka.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Uge(t){return new So(ka.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function pW(){return new So(ka.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function mW(){return new So(ka.CANCELED,"User canceled the upload/download.")}function $ge(t){return new So(ka.INVALID_URL,"Invalid URL '"+t+"'.")}function qge(t){return new So(ka.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Gge(){return new So(ka.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+hW+"' property when initializing the app?")}function gW(){return new So(ka.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Hge(){return new So(ka.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function Wge(){return new So(ka.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Zge(t){return new So(ka.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function DD(t){return new So(ka.INVALID_ARGUMENT,t)}function _W(){return new So(ka.APP_DELETED,"The Firebase app was deleted.")}function Kge(t){return new So(ka.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function oS(t,e){return new So(ka.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function S1(t){throw new So(ka.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let n;try{n=Cu.makeFromUrl(e,r)}catch{return new Cu(e,"")}if(n.path==="")return n;throw qge(e)}static makeFromUrl(e,r){let n=null;const c="([A-Za-z0-9.\\-_]+)";function d(Q){Q.path.charAt(Q.path.length-1)==="/"&&(Q.path_=Q.path_.slice(0,-1))}const p="(/(.*))?$",a=new RegExp("^gs://"+c+p,"i"),w={bucket:1,path:3};function E(Q){Q.path_=decodeURIComponent(Q.path)}const C="v[A-Za-z0-9_]+",P=r.replace(/[.]/g,"\\."),R="(/([^?#]*).*)?$",B=new RegExp(`^https?://${P}/${C}/b/${c}/o${R}`,"i"),V={bucket:1,path:3},W=r===dW?"(?:storage.googleapis.com|storage.cloud.google.com)":r,K="([^?#]*)",Z=new RegExp(`^https?://${W}/${c}/${K}`,"i"),X=[{regex:a,indices:w,postModify:d},{regex:B,indices:V,postModify:E},{regex:Z,indices:{bucket:1,path:2},postModify:E}];for(let Q=0;Q<X.length;Q++){const re=X[Q],ve=re.regex.exec(e);if(ve){const pe=ve[re.indices.bucket];let ue=ve[re.indices.path];ue||(ue=""),n=new Cu(pe,ue),re.postModify(n);break}}if(n==null)throw $ge(e);return n}}class Xge{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yge(t,e,r){let n=1,c=null,d=null,p=!1,a=0;function w(){return a===2}let E=!1;function C(...K){E||(E=!0,e.apply(null,K))}function P(K){c=setTimeout(()=>{c=null,t(B,w())},K)}function R(){d&&clearTimeout(d)}function B(K,...Z){if(E){R();return}if(K){R(),C.call(null,K,...Z);return}if(w()||p){R(),C.call(null,K,...Z);return}n<64&&(n*=2);let X;a===1?(a=2,X=0):X=(n+Math.random())*1e3,P(X)}let V=!1;function W(K){V||(V=!0,R(),!E&&(c!==null?(K||(a=2),clearTimeout(c),P(0)):K||(a=1)))}return P(0),d=setTimeout(()=>{p=!0,W(!0)},r),W}function Jge(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qge(t){return t!==void 0}function e_e(t){return typeof t=="function"}function t_e(t){return typeof t=="object"&&!Array.isArray(t)}function FC(t){return typeof t=="string"||t instanceof String}function KU(t){return N3()&&t instanceof Blob}function N3(){return typeof Blob<"u"}function XU(t,e,r,n){if(n<e)throw DD(`Invalid value for '${t}'. Expected ${e} or greater.`);if(n>r)throw DD(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ow(t,e,r){let n=e;return r==null&&(n=`https://${e}`),`${r}://${n}/v0${t}`}function yW(t){const e=encodeURIComponent;let r="?";for(const n in t)if(t.hasOwnProperty(n)){const c=e(n)+"="+e(t[n]);r=r+c+"&"}return r=r.slice(0,-1),r}var G_;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(G_||(G_={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xW(t,e){const r=t>=500&&t<600,c=[408,429].indexOf(t)!==-1,d=e.indexOf(t)!==-1;return r||c||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r_e{constructor(e,r,n,c,d,p,a,w,E,C,P,R=!0){this.url_=e,this.method_=r,this.headers_=n,this.body_=c,this.successCodes_=d,this.additionalRetryCodes_=p,this.callback_=a,this.errorCallback_=w,this.timeout_=E,this.progressCallback_=C,this.connectionFactory_=P,this.retry=R,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((B,V)=>{this.resolve_=B,this.reject_=V,this.start_()})}start_(){const e=(n,c)=>{if(c){n(!1,new fj(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const p=a=>{const w=a.loaded,E=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(w,E)};this.progressCallback_!==null&&d.addUploadProgressListener(p),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(p),this.pendingConnection_=null;const a=d.getErrorCode()===G_.NO_ERROR,w=d.getStatus();if(!a||xW(w,this.additionalRetryCodes_)&&this.retry){const C=d.getErrorCode()===G_.ABORT;n(!1,new fj(!1,null,C));return}const E=this.successCodes_.indexOf(w)!==-1;n(!0,new fj(E,d))})},r=(n,c)=>{const d=this.resolve_,p=this.reject_,a=c.connection;if(c.wasSuccessCode)try{const w=this.callback_(a,a.getResponse());Qge(w)?d(w):d()}catch(w){p(w)}else if(a!==null){const w=j3();w.serverResponse=a.getErrorText(),this.errorCallback_?p(this.errorCallback_(a,w)):p(w)}else if(c.canceled){const w=this.appDelete_?_W():mW();p(w)}else{const w=pW();p(w)}};this.canceled_?r(!1,new fj(!1,null,!0)):this.backoffId_=Yge(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Jge(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class fj{constructor(e,r,n){this.wasSuccessCode=e,this.connection=r,this.canceled=!!n}}function n_e(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function s_e(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function i_e(t,e){e&&(t["X-Firebase-GMPID"]=e)}function a_e(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function o_e(t,e,r,n,c,d,p=!0){const a=yW(t.urlParams),w=t.url+a,E=Object.assign({},t.headers);return i_e(E,e),n_e(E,r),s_e(E,d),a_e(E,n),new r_e(w,t.method,E,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,c,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l_e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function c_e(...t){const e=l_e();if(e!==void 0){const r=new e;for(let n=0;n<t.length;n++)r.append(t[n]);return r.getBlob()}else{if(N3())return new Blob(t);throw new So(ka.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function u_e(t,e,r){return t.webkitSlice?t.webkitSlice(e,r):t.mozSlice?t.mozSlice(e,r):t.slice?t.slice(e,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d_e(t){if(typeof atob>"u")throw Zge("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class _R{constructor(e,r){this.data=e,this.contentType=r||null}}function h_e(t,e){switch(t){case Wh.RAW:return new _R(vW(e));case Wh.BASE64:case Wh.BASE64URL:return new _R(wW(t,e));case Wh.DATA_URL:return new _R(p_e(e),m_e(e))}throw j3()}function vW(t){const e=[];for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);if(n<=127)e.push(n);else if(n<=2047)e.push(192|n>>6,128|n&63);else if((n&64512)===55296)if(!(r<t.length-1&&(t.charCodeAt(r+1)&64512)===56320))e.push(239,191,189);else{const d=n,p=t.charCodeAt(++r);n=65536|(d&1023)<<10|p&1023,e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}else(n&64512)===56320?e.push(239,191,189):e.push(224|n>>12,128|n>>6&63,128|n&63)}return new Uint8Array(e)}function f_e(t){let e;try{e=decodeURIComponent(t)}catch{throw oS(Wh.DATA_URL,"Malformed data URL.")}return vW(e)}function wW(t,e){switch(t){case Wh.BASE64:{const c=e.indexOf("-")!==-1,d=e.indexOf("_")!==-1;if(c||d)throw oS(t,"Invalid character '"+(c?"-":"_")+"' found: is it base64url encoded?");break}case Wh.BASE64URL:{const c=e.indexOf("+")!==-1,d=e.indexOf("/")!==-1;if(c||d)throw oS(t,"Invalid character '"+(c?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=d_e(e)}catch(c){throw c.message.includes("polyfill")?c:oS(t,"Invalid character found")}const n=new Uint8Array(r.length);for(let c=0;c<r.length;c++)n[c]=r.charCodeAt(c);return n}class bW{constructor(e){this.base64=!1,this.contentType=null;const r=e.match(/^data:([^,]+)?,/);if(r===null)throw oS(Wh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=r[1]||null;n!=null&&(this.base64=g_e(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}function p_e(t){const e=new bW(t);return e.base64?wW(Wh.BASE64,e.rest):f_e(e.rest)}function m_e(t){return new bW(t).contentType}function g_e(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e,r){let n=0,c="";KU(e)?(this.data_=e,n=e.size,c=e.type):e instanceof ArrayBuffer?(r?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(r?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=c}size(){return this.size_}type(){return this.type_}slice(e,r){if(KU(this.data_)){const n=this.data_,c=u_e(n,e,r);return c===null?null:new Qf(c)}else{const n=new Uint8Array(this.data_.buffer,e,r-e);return new Qf(n,!0)}}static getBlob(...e){if(N3()){const r=e.map(n=>n instanceof Qf?n.data_:n);return new Qf(c_e.apply(null,r))}else{const r=e.map(p=>FC(p)?h_e(Wh.RAW,p).data:p.data_);let n=0;r.forEach(p=>{n+=p.byteLength});const c=new Uint8Array(n);let d=0;return r.forEach(p=>{for(let a=0;a<p.length;a++)c[d++]=p[a]}),new Qf(c,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SW(t){let e;try{e=JSON.parse(t)}catch{return null}return t_e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __e(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function y_e(t,e){const r=e.split("/").filter(n=>n.length>0).join("/");return t.length===0?r:t+"/"+r}function EW(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x_e(t,e){return e}class _c{constructor(e,r,n,c){this.server=e,this.local=r||e,this.writable=!!n,this.xform=c||x_e}}let pj=null;function v_e(t){return!FC(t)||t.length<2?t:EW(t)}function I3(){if(pj)return pj;const t=[];t.push(new _c("bucket")),t.push(new _c("generation")),t.push(new _c("metageneration")),t.push(new _c("name","fullPath",!0));function e(d,p){return v_e(p)}const r=new _c("name");r.xform=e,t.push(r);function n(d,p){return p!==void 0?Number(p):p}const c=new _c("size");return c.xform=n,t.push(c),t.push(new _c("timeCreated")),t.push(new _c("updated")),t.push(new _c("md5Hash",null,!0)),t.push(new _c("cacheControl",null,!0)),t.push(new _c("contentDisposition",null,!0)),t.push(new _c("contentEncoding",null,!0)),t.push(new _c("contentLanguage",null,!0)),t.push(new _c("contentType",null,!0)),t.push(new _c("metadata","customMetadata",!0)),pj=t,pj}function w_e(t,e){function r(){const n=t.bucket,c=t.fullPath,d=new Cu(n,c);return e._makeStorageReference(d)}Object.defineProperty(t,"ref",{get:r})}function b_e(t,e,r){const n={};n.type="file";const c=r.length;for(let d=0;d<c;d++){const p=r[d];n[p.local]=p.xform(n,e[p.server])}return w_e(n,t),n}function TW(t,e,r){const n=SW(e);return n===null?null:b_e(t,n,r)}function S_e(t,e,r,n){const c=SW(e);if(c===null||!FC(c.downloadTokens))return null;const d=c.downloadTokens;if(d.length===0)return null;const p=encodeURIComponent;return d.split(",").map(E=>{const C=t.bucket,P=t.fullPath,R="/b/"+p(C)+"/o/"+p(P),B=ow(R,r,n),V=yW({alt:"media",token:E});return B+V})[0]}function jW(t,e){const r={},n=e.length;for(let c=0;c<n;c++){const d=e[c];d.writable&&(r[d.server]=t[d.local])}return JSON.stringify(r)}class Ly{constructor(e,r,n,c){this.url=e,this.method=r,this.handler=n,this.timeout=c,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cp(t){if(!t)throw j3()}function C3(t,e){function r(n,c){const d=TW(t,c,e);return cp(d!==null),d}return r}function E_e(t,e){function r(n,c){const d=TW(t,c,e);return cp(d!==null),S_e(d,c,t.host,t._protocol)}return r}function OE(t){function e(r,n){let c;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?c=Vge():c=Bge():r.getStatus()===402?c=zge(t.bucket):r.getStatus()===403?c=Uge(t.path):c=n,c.status=r.getStatus(),c.serverResponse=n.serverResponse,c}return e}function A3(t){const e=OE(t);function r(n,c){let d=e(n,c);return n.getStatus()===404&&(d=Fge(t.path)),d.serverResponse=c.serverResponse,d}return r}function T_e(t,e,r){const n=e.fullServerUrl(),c=ow(n,t.host,t._protocol),d="GET",p=t.maxOperationRetryTime,a=new Ly(c,d,C3(t,r),p);return a.errorHandler=A3(e),a}function j_e(t,e,r){const n=e.fullServerUrl(),c=ow(n,t.host,t._protocol),d="GET",p=t.maxOperationRetryTime,a=new Ly(c,d,E_e(t,r),p);return a.errorHandler=A3(e),a}function N_e(t,e){const r=e.fullServerUrl(),n=ow(r,t.host,t._protocol),c="DELETE",d=t.maxOperationRetryTime;function p(w,E){}const a=new Ly(n,c,p,d);return a.successCodes=[200,204],a.errorHandler=A3(e),a}function I_e(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function NW(t,e,r){const n=Object.assign({},r);return n.fullPath=t.path,n.size=e.size(),n.contentType||(n.contentType=I_e(null,e)),n}function IW(t,e,r,n,c){const d=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function a(){let X="";for(let Q=0;Q<2;Q++)X=X+Math.random().toString().slice(2);return X}const w=a();p["Content-Type"]="multipart/related; boundary="+w;const E=NW(e,n,c),C=jW(E,r),P="--"+w+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+w+`\r
Content-Type: `+E.contentType+`\r
\r
`,R=`\r
--`+w+"--",B=Qf.getBlob(P,n,R);if(B===null)throw gW();const V={name:E.fullPath},W=ow(d,t.host,t._protocol),K="POST",Z=t.maxUploadRetryTime,$=new Ly(W,K,C3(t,r),Z);return $.urlParams=V,$.headers=p,$.body=B.uploadData(),$.errorHandler=OE(e),$}class tI{constructor(e,r,n,c){this.current=e,this.total=r,this.finalized=!!n,this.metadata=c||null}}function P3(t,e){let r=null;try{r=t.getResponseHeader("X-Goog-Upload-Status")}catch{cp(!1)}return cp(!!r&&(e||["active"]).indexOf(r)!==-1),r}function C_e(t,e,r,n,c){const d=e.bucketOnlyServerUrl(),p=NW(e,n,c),a={name:p.fullPath},w=ow(d,t.host,t._protocol),E="POST",C={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n.size()}`,"X-Goog-Upload-Header-Content-Type":p.contentType,"Content-Type":"application/json; charset=utf-8"},P=jW(p,r),R=t.maxUploadRetryTime;function B(W){P3(W);let K;try{K=W.getResponseHeader("X-Goog-Upload-URL")}catch{cp(!1)}return cp(FC(K)),K}const V=new Ly(w,E,B,R);return V.urlParams=a,V.headers=C,V.body=P,V.errorHandler=OE(e),V}function A_e(t,e,r,n){const c={"X-Goog-Upload-Command":"query"};function d(E){const C=P3(E,["active","final"]);let P=null;try{P=E.getResponseHeader("X-Goog-Upload-Size-Received")}catch{cp(!1)}P||cp(!1);const R=Number(P);return cp(!isNaN(R)),new tI(R,n.size(),C==="final")}const p="POST",a=t.maxUploadRetryTime,w=new Ly(r,p,d,a);return w.headers=c,w.errorHandler=OE(e),w}const YU=256*1024;function P_e(t,e,r,n,c,d,p,a){const w=new tI(0,0);if(p?(w.current=p.current,w.total=p.total):(w.current=0,w.total=n.size()),n.size()!==w.total)throw Hge();const E=w.total-w.current;let C=E;c>0&&(C=Math.min(C,c));const P=w.current,R=P+C;let B="";C===0?B="finalize":E===C?B="upload, finalize":B="upload";const V={"X-Goog-Upload-Command":B,"X-Goog-Upload-Offset":`${w.current}`},W=n.slice(P,R);if(W===null)throw gW();function K(Q,re){const ve=P3(Q,["active","final"]),pe=w.current+C,ue=n.size();let ge;return ve==="final"?ge=C3(e,d)(Q,re):ge=null,new tI(pe,ue,ve==="final",ge)}const Z="POST",$=e.maxUploadRetryTime,X=new Ly(r,Z,K,$);return X.headers=V,X.body=W.uploadData(),X.progressCallback=a||null,X.errorHandler=OE(t),X}const Hc={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function yR(t){switch(t){case"running":case"pausing":case"canceling":return Hc.RUNNING;case"paused":return Hc.PAUSED;case"success":return Hc.SUCCESS;case"canceled":return Hc.CANCELED;case"error":return Hc.ERROR;default:return Hc.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_e{constructor(e,r,n){if(e_e(e)||r!=null||n!=null)this.next=e,this.error=r??void 0,this.complete=n??void 0;else{const d=e;this.next=d.next,this.error=d.error,this.complete=d.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dv(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class R_e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=G_.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=G_.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=G_.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,r,n,c){if(this.sent_)throw S1("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,e,!0),c!==void 0)for(const d in c)c.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,c[d].toString());return n!==void 0?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw S1("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw S1("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw S1("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw S1("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class M_e extends R_e{initXhr(){this.xhr_.responseType="text"}}function Vm(){return new M_e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_e{constructor(e,r,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=r,this._metadata=n,this._mappings=I3(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=c=>{if(this._request=void 0,this._chunkMultiplier=1,c._codeEquals(ka.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const d=this.isExponentialBackoffExpired();if(xW(c.status,[]))if(d)c=pW();else{this.sleepTime=Math.max(this.sleepTime*2,Lge),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=c,this._transition("error")}},this._metadataErrorHandler=c=>{this._request=void 0,c._codeEquals(ka.CANCELED)?this.completeTransitions_():(this._error=c,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((c,d)=>{this._resolve=c,this._reject=d,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return r=>this._updateProgress(e+r)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([r,n])=>{switch(this._state){case"running":e(r,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,r)=>{const n=C_e(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(n,Vm,e,r);this._request=c,c.getPromise().then(d=>{this._request=void 0,this._uploadUrl=d,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((r,n)=>{const c=A_e(this._ref.storage,this._ref._location,e,this._blob),d=this._ref.storage._makeRequest(c,Vm,r,n);this._request=d,d.getPromise().then(p=>{p=p,this._request=void 0,this._updateProgress(p.current),this._needToFetchStatus=!1,p.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=YU*this._chunkMultiplier,r=new tI(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken((c,d)=>{let p;try{p=P_e(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,r,this._makeProgressCallback())}catch(w){this._error=w,this._transition("error");return}const a=this._ref.storage._makeRequest(p,Vm,c,d,!1);this._request=a,a.getPromise().then(w=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(w.current),w.finalized?(this._metadata=w.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){YU*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,r)=>{const n=T_e(this._ref.storage,this._ref._location,this._mappings),c=this._ref.storage._makeRequest(n,Vm,e,r);this._request=c,c.getPromise().then(d=>{this._request=void 0,this._metadata=d,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,r)=>{const n=IW(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(n,Vm,e,r);this._request=c,c.getPromise().then(d=>{this._request=void 0,this._metadata=d,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const r=this._transferred;this._transferred=e,this._transferred!==r&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const r=this._state==="paused";this._state=e,r&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=mW(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=yR(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,r,n,c){const d=new k_e(r||void 0,n||void 0,c||void 0);return this._addObserver(d),()=>{this._removeObserver(d)}}then(e,r){return this._promise.then(e,r)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const r=this._observers.indexOf(e);r!==-1&&this._observers.splice(r,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(r=>{this._notifyObserver(r)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(yR(this._state)){case Hc.SUCCESS:dv(this._resolve.bind(null,this.snapshot))();break;case Hc.CANCELED:case Hc.ERROR:const r=this._reject;dv(r.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(yR(this._state)){case Hc.RUNNING:case Hc.PAUSED:e.next&&dv(e.next.bind(e,this.snapshot))();break;case Hc.SUCCESS:e.complete&&dv(e.complete.bind(e))();break;case Hc.CANCELED:case Hc.ERROR:e.error&&dv(e.error.bind(e,this._error))();break;default:e.error&&dv(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy{constructor(e,r){this._service=e,r instanceof Cu?this._location=r:this._location=Cu.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new fy(e,r)}get root(){const e=new Cu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return EW(this._location.path)}get storage(){return this._service}get parent(){const e=__e(this._location.path);if(e===null)return null;const r=new Cu(this._location.bucket,e);return new fy(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw Kge(e)}}function O_e(t,e,r){t._throwIfRoot("uploadBytes");const n=IW(t.storage,t._location,I3(),new Qf(e,!0),r);return t.storage.makeRequestWithTokens(n,Vm).then(c=>({metadata:c,ref:t}))}function L_e(t,e,r){return t._throwIfRoot("uploadBytesResumable"),new D_e(t,new Qf(e),r)}function F_e(t){t._throwIfRoot("getDownloadURL");const e=j_e(t.storage,t._location,I3());return t.storage.makeRequestWithTokens(e,Vm).then(r=>{if(r===null)throw Wge();return r})}function z_e(t){t._throwIfRoot("deleteObject");const e=N_e(t.storage,t._location);return t.storage.makeRequestWithTokens(e,Vm)}function B_e(t,e){const r=y_e(t._location.path,e),n=new Cu(t._location.bucket,r);return new fy(t.storage,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V_e(t){return/^[A-Za-z]+:\/\//.test(t)}function U_e(t,e){return new fy(t,e)}function CW(t,e){if(t instanceof k3){const r=t;if(r._bucket==null)throw Gge();const n=new fy(r,r._bucket);return e!=null?CW(n,e):n}else return e!==void 0?B_e(t,e):t}function $_e(t,e){if(e&&V_e(e)){if(t instanceof k3)return U_e(t,e);throw DD("To use ref(service, url), the first argument must be a Storage instance.")}else return CW(t,e)}function JU(t,e){const r=e==null?void 0:e[hW];return r==null?null:Cu.makeFromBucketSpec(r,t)}function q_e(t,e,r,n={}){t.host=`${e}:${r}`,t._protocol="http";const{mockUserToken:c}=n;c&&(t._overrideAuthToken=typeof c=="string"?c:q7(c,t.app.options.projectId))}class k3{constructor(e,r,n,c,d){this.app=e,this._authProvider=r,this._appCheckProvider=n,this._url=c,this._firebaseVersion=d,this._bucket=null,this._host=dW,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Dge,this._maxUploadRetryTime=Oge,this._requests=new Set,c!=null?this._bucket=Cu.makeFromBucketSpec(c,this._host):this._bucket=JU(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Cu.makeFromBucketSpec(this._url,e):this._bucket=JU(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){XU("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){XU("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new fy(this,e)}_makeRequest(e,r,n,c,d=!0){if(this._deleted)return new Xge(_W());{const p=o_e(e,this._appId,n,c,r,this._firebaseVersion,d);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,r){const[n,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,n,c).getPromise()}}const QU="@firebase/storage",e8="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AW="storage";function R3(t,e,r){return t=ai(t),O_e(t,e,r)}function G_e(t,e,r){return t=ai(t),L_e(t,e,r)}function zC(t){return t=ai(t),F_e(t)}function PW(t){return t=ai(t),z_e(t)}function A0(t,e){return t=ai(t),$_e(t,e)}function H_e(t=hC(),e){t=ai(t);const n=Ig(t,AW).getImmediate({identifier:e}),c=V7("storage");return c&&W_e(n,...c),n}function W_e(t,e,r,n={}){q_e(t,e,r,n)}function Z_e(t,{instanceIdentifier:e}){const r=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),c=t.getProvider("app-check-internal");return new k3(r,n,c,e,Ry)}function K_e(){th(new ld(AW,Z_e,"PUBLIC").setMultipleInstances(!0)),nu(QU,e8,""),nu(QU,e8,"esm2017")}K_e();const kW="@firebase/installations",M3="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RW=1e4,MW=`w:${M3}`,DW="FIS_v2",X_e="https://firebaseinstallations.googleapis.com/v1",Y_e=60*60*1e3,J_e="installations",Q_e="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eye={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},py=new ky(J_e,Q_e,eye);function OW(t){return t instanceof dd&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LW({projectId:t}){return`${X_e}/projects/${t}/installations`}function FW(t){return{token:t.token,requestStatus:2,expiresIn:rye(t.expiresIn),creationTime:Date.now()}}async function zW(t,e){const n=(await e.json()).error;return py.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function BW({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function tye(t,{refreshToken:e}){const r=BW(t);return r.append("Authorization",nye(e)),r}async function VW(t){const e=await t();return e.status>=500&&e.status<600?t():e}function rye(t){return Number(t.replace("s","000"))}function nye(t){return`${DW} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sye({appConfig:t,heartbeatServiceProvider:e},{fid:r}){const n=LW(t),c=BW(t),d=e.getImmediate({optional:!0});if(d){const E=await d.getHeartbeatsHeader();E&&c.append("x-firebase-client",E)}const p={fid:r,authVersion:DW,appId:t.appId,sdkVersion:MW},a={method:"POST",headers:c,body:JSON.stringify(p)},w=await VW(()=>fetch(n,a));if(w.ok){const E=await w.json();return{fid:E.fid||r,registrationStatus:2,refreshToken:E.refreshToken,authToken:FW(E.authToken)}}else throw await zW("Create Installation",w)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UW(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iye(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aye=/^[cdef][\w-]{21}$/,OD="";function oye(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const r=lye(t);return aye.test(r)?r:OD}catch{return OD}}function lye(t){return iye(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BC(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $W=new Map;function qW(t,e){const r=BC(t);GW(r,e),cye(r,e)}function GW(t,e){const r=$W.get(t);if(r)for(const n of r)n(e)}function cye(t,e){const r=uye();r&&r.postMessage({key:t,fid:e}),dye()}let B_=null;function uye(){return!B_&&"BroadcastChannel"in self&&(B_=new BroadcastChannel("[Firebase] FID Change"),B_.onmessage=t=>{GW(t.data.key,t.data.fid)}),B_}function dye(){$W.size===0&&B_&&(B_.close(),B_=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hye="firebase-installations-database",fye=1,my="firebase-installations-store";let xR=null;function D3(){return xR||(xR=X7(hye,fye,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(my)}}})),xR}async function rI(t,e){const r=BC(t),c=(await D3()).transaction(my,"readwrite"),d=c.objectStore(my),p=await d.get(r);return await d.put(e,r),await c.done,(!p||p.fid!==e.fid)&&qW(t,e.fid),e}async function HW(t){const e=BC(t),n=(await D3()).transaction(my,"readwrite");await n.objectStore(my).delete(e),await n.done}async function VC(t,e){const r=BC(t),c=(await D3()).transaction(my,"readwrite"),d=c.objectStore(my),p=await d.get(r),a=e(p);return a===void 0?await d.delete(r):await d.put(a,r),await c.done,a&&(!p||p.fid!==a.fid)&&qW(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O3(t){let e;const r=await VC(t.appConfig,n=>{const c=pye(n),d=mye(t,c);return e=d.registrationPromise,d.installationEntry});return r.fid===OD?{installationEntry:await e}:{installationEntry:r,registrationPromise:e}}function pye(t){const e=t||{fid:oye(),registrationStatus:0};return WW(e)}function mye(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const c=Promise.reject(py.create("app-offline"));return{installationEntry:e,registrationPromise:c}}const r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=gye(t,r);return{installationEntry:r,registrationPromise:n}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:_ye(t)}:{installationEntry:e}}async function gye(t,e){try{const r=await sye(t,e);return rI(t.appConfig,r)}catch(r){throw OW(r)&&r.customData.serverCode===409?await HW(t.appConfig):await rI(t.appConfig,{fid:e.fid,registrationStatus:0}),r}}async function _ye(t){let e=await t8(t.appConfig);for(;e.registrationStatus===1;)await UW(100),e=await t8(t.appConfig);if(e.registrationStatus===0){const{installationEntry:r,registrationPromise:n}=await O3(t);return n||r}return e}function t8(t){return VC(t,e=>{if(!e)throw py.create("installation-not-found");return WW(e)})}function WW(t){return yye(t)?{fid:t.fid,registrationStatus:0}:t}function yye(t){return t.registrationStatus===1&&t.registrationTime+RW<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xye({appConfig:t,heartbeatServiceProvider:e},r){const n=vye(t,r),c=tye(t,r),d=e.getImmediate({optional:!0});if(d){const E=await d.getHeartbeatsHeader();E&&c.append("x-firebase-client",E)}const p={installation:{sdkVersion:MW,appId:t.appId}},a={method:"POST",headers:c,body:JSON.stringify(p)},w=await VW(()=>fetch(n,a));if(w.ok){const E=await w.json();return FW(E)}else throw await zW("Generate Auth Token",w)}function vye(t,{fid:e}){return`${LW(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L3(t,e=!1){let r;const n=await VC(t.appConfig,d=>{if(!ZW(d))throw py.create("not-registered");const p=d.authToken;if(!e&&Sye(p))return d;if(p.requestStatus===1)return r=wye(t,e),d;{if(!navigator.onLine)throw py.create("app-offline");const a=Tye(d);return r=bye(t,a),a}});return r?await r:n.authToken}async function wye(t,e){let r=await r8(t.appConfig);for(;r.authToken.requestStatus===1;)await UW(100),r=await r8(t.appConfig);const n=r.authToken;return n.requestStatus===0?L3(t,e):n}function r8(t){return VC(t,e=>{if(!ZW(e))throw py.create("not-registered");const r=e.authToken;return jye(r)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function bye(t,e){try{const r=await xye(t,e),n=Object.assign(Object.assign({},e),{authToken:r});return await rI(t.appConfig,n),r}catch(r){if(OW(r)&&(r.customData.serverCode===401||r.customData.serverCode===404))await HW(t.appConfig);else{const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await rI(t.appConfig,n)}throw r}}function ZW(t){return t!==void 0&&t.registrationStatus===2}function Sye(t){return t.requestStatus===2&&!Eye(t)}function Eye(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Y_e}function Tye(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function jye(t){return t.requestStatus===1&&t.requestTime+RW<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nye(t){const e=t,{installationEntry:r,registrationPromise:n}=await O3(e);return n?n.catch(console.error):L3(e).catch(console.error),r.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Iye(t,e=!1){const r=t;return await Cye(r),(await L3(r,e)).token}async function Cye(t){const{registrationPromise:e}=await O3(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aye(t){if(!t||!t.options)throw vR("App Configuration");if(!t.name)throw vR("App Name");const e=["projectId","apiKey","appId"];for(const r of e)if(!t.options[r])throw vR(r);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function vR(t){return py.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KW="installations",Pye="installations-internal",kye=t=>{const e=t.getProvider("app").getImmediate(),r=Aye(e),n=Ig(e,"heartbeat");return{app:e,appConfig:r,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},Rye=t=>{const e=t.getProvider("app").getImmediate(),r=Ig(e,KW).getImmediate();return{getId:()=>Nye(r),getToken:c=>Iye(r,c)}};function Mye(){th(new ld(KW,kye,"PUBLIC")),th(new ld(Pye,Rye,"PRIVATE"))}Mye();nu(kW,M3);nu(kW,M3,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nI="analytics",Dye="firebase_id",Oye="origin",Lye=60*1e3,Fye="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",F3="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su=new dC("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zye={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Pu=new ky("analytics","Analytics",zye);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bye(t){if(!t.startsWith(F3)){const e=Pu.create("invalid-gtag-resource",{gtagURL:t});return su.warn(e.message),""}return t}function XW(t){return Promise.all(t.map(e=>e.catch(r=>r)))}function Vye(t,e){let r;return window.trustedTypes&&(r=window.trustedTypes.createPolicy(t,e)),r}function Uye(t,e){const r=Vye("firebase-js-sdk-policy",{createScriptURL:Bye}),n=document.createElement("script"),c=`${F3}?l=${t}&id=${e}`;n.src=r?r==null?void 0:r.createScriptURL(c):c,n.async=!0,document.head.appendChild(n)}function $ye(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function qye(t,e,r,n,c,d){const p=n[c];try{if(p)await e[p];else{const w=(await XW(r)).find(E=>E.measurementId===c);w&&await e[w.appId]}}catch(a){su.error(a)}t("config",c,d)}async function Gye(t,e,r,n,c){try{let d=[];if(c&&c.send_to){let p=c.send_to;Array.isArray(p)||(p=[p]);const a=await XW(r);for(const w of p){const E=a.find(P=>P.measurementId===w),C=E&&e[E.appId];if(C)d.push(C);else{d=[];break}}}d.length===0&&(d=Object.values(e)),await Promise.all(d),t("event",n,c||{})}catch(d){su.error(d)}}function Hye(t,e,r,n){async function c(d,...p){try{if(d==="event"){const[a,w]=p;await Gye(t,e,r,a,w)}else if(d==="config"){const[a,w]=p;await qye(t,e,r,n,a,w)}else if(d==="consent"){const[a,w]=p;t("consent",a,w)}else if(d==="get"){const[a,w,E]=p;t("get",a,w,E)}else if(d==="set"){const[a]=p;t("set",a)}else t(d,...p)}catch(a){su.error(a)}}return c}function Wye(t,e,r,n,c){let d=function(...p){window[n].push(arguments)};return window[c]&&typeof window[c]=="function"&&(d=window[c]),window[c]=Hye(d,t,e,r),{gtagCore:d,wrappedGtag:window[c]}}function Zye(t){const e=window.document.getElementsByTagName("script");for(const r of Object.values(e))if(r.src&&r.src.includes(F3)&&r.src.includes(t))return r;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kye=30,Xye=1e3;class Yye{constructor(e={},r=Xye){this.throttleMetadata=e,this.intervalMillis=r}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,r){this.throttleMetadata[e]=r}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const YW=new Yye;function Jye(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Qye(t){var e;const{appId:r,apiKey:n}=t,c={method:"GET",headers:Jye(n)},d=Fye.replace("{app-id}",r),p=await fetch(d,c);if(p.status!==200&&p.status!==304){let a="";try{const w=await p.json();!((e=w.error)===null||e===void 0)&&e.message&&(a=w.error.message)}catch{}throw Pu.create("config-fetch-failed",{httpStatus:p.status,responseMessage:a})}return p.json()}async function exe(t,e=YW,r){const{appId:n,apiKey:c,measurementId:d}=t.options;if(!n)throw Pu.create("no-app-id");if(!c){if(d)return{measurementId:d,appId:n};throw Pu.create("no-api-key")}const p=e.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new nxe;return setTimeout(async()=>{a.abort()},Lye),JW({appId:n,apiKey:c,measurementId:d},p,a,e)}async function JW(t,{throttleEndTimeMillis:e,backoffCount:r},n,c=YW){var d;const{appId:p,measurementId:a}=t;try{await txe(n,e)}catch(w){if(a)return su.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${w==null?void 0:w.message}]`),{appId:p,measurementId:a};throw w}try{const w=await Qye(t);return c.deleteThrottleMetadata(p),w}catch(w){const E=w;if(!rxe(E)){if(c.deleteThrottleMetadata(p),a)return su.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${E==null?void 0:E.message}]`),{appId:p,measurementId:a};throw w}const C=Number((d=E==null?void 0:E.customData)===null||d===void 0?void 0:d.httpStatus)===503?R6(r,c.intervalMillis,Kye):R6(r,c.intervalMillis),P={throttleEndTimeMillis:Date.now()+C,backoffCount:r+1};return c.setThrottleMetadata(p,P),su.debug(`Calling attemptFetch again in ${C} millis`),JW(t,P,n,c)}}function txe(t,e){return new Promise((r,n)=>{const c=Math.max(e-Date.now(),0),d=setTimeout(r,c);t.addEventListener(()=>{clearTimeout(d),n(Pu.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function rxe(t){if(!(t instanceof dd)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class nxe{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function sxe(t,e,r,n,c){if(c&&c.global){t("event",r,n);return}else{const d=await e,p=Object.assign(Object.assign({},n),{send_to:d});t("event",r,p)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ixe(){if(H7())try{await W7()}catch(t){return su.warn(Pu.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return su.warn(Pu.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function axe(t,e,r,n,c,d,p){var a;const w=exe(t);w.then(B=>{r[B.measurementId]=B.appId,t.options.measurementId&&B.measurementId!==t.options.measurementId&&su.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${B.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(B=>su.error(B)),e.push(w);const E=ixe().then(B=>{if(B)return n.getId()}),[C,P]=await Promise.all([w,E]);Zye(d)||Uye(d,C.measurementId),c("js",new Date);const R=(a=p==null?void 0:p.config)!==null&&a!==void 0?a:{};return R[Oye]="firebase",R.update=!0,P!=null&&(R[Dye]=P),c("config",C.measurementId,R),C.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oxe{constructor(e){this.app=e}_delete(){return delete lS[this.app.options.appId],Promise.resolve()}}let lS={},n8=[];const s8={};let wR="dataLayer",lxe="gtag",i8,QW,a8=!1;function cxe(){const t=[];if(G7()&&t.push("This is a browser extension environment."),rue()||t.push("Cookies are not available."),t.length>0){const e=t.map((n,c)=>`(${c+1}) ${n}`).join(" "),r=Pu.create("invalid-analytics-context",{errorInfo:e});su.warn(r.message)}}function uxe(t,e,r){cxe();const n=t.options.appId;if(!n)throw Pu.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)su.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Pu.create("no-api-key");if(lS[n]!=null)throw Pu.create("already-exists",{id:n});if(!a8){$ye(wR);const{wrappedGtag:d,gtagCore:p}=Wye(lS,n8,s8,wR,lxe);QW=d,i8=p,a8=!0}return lS[n]=axe(t,n8,s8,e,i8,wR,r),new oxe(t)}function dxe(t=hC()){t=ai(t);const e=Ig(t,nI);return e.isInitialized()?e.getImmediate():hxe(t)}function hxe(t,e={}){const r=Ig(t,nI);if(r.isInitialized()){const c=r.getImmediate();if(RS(e,r.getOptions()))return c;throw Pu.create("already-initialized")}return r.initialize({options:e})}function fxe(t,e,r,n){t=ai(t),sxe(QW,lS[t.app.options.appId],e,r,n).catch(c=>su.error(c))}const o8="@firebase/analytics",l8="0.10.8";function pxe(){th(new ld(nI,(e,{options:r})=>{const n=e.getProvider("app").getImmediate(),c=e.getProvider("installations-internal").getImmediate();return uxe(n,c,r)},"PUBLIC")),th(new ld("analytics-internal",t,"PRIVATE")),nu(o8,l8),nu(o8,l8,"esm2017");function t(e){try{const r=e.getProvider(nI).getImmediate();return{logEvent:(n,c,d)=>fxe(r,n,c,d)}}catch(r){throw Pu.create("interop-component-reg-failed",{reason:r})}}}pxe();const mxe={apiKey:"AIzaSyDXD6WpZoQNLNU0DAqH1wd3q9Q4vthOWv4",authDomain:"annonces-app-44d27.firebaseapp.com",projectId:"annonces-app-44d27",storageBucket:"annonces-app-44d27.firebasestorage.app",messagingSenderId:"603697837611",appId:"1:603697837611:web:858cf99bb80004d0f25c6e",measurementId:"G-35RWYRR568"},LE=Y7(mxe),ko=Vfe(LE),rr=XH(LE),gy=H_e(LE);dxe(LE);const Dd={USERS:"users",LISTINGS:"listings",REVIEWS:"reviews",FAVORITES:"favorites",CONVERSATIONS:"conversations",MESSAGES:"messages",REPORTS:"reports",CHAT_HISTORY:"chatHistory"},LD={actionCodeSettings:{url:`${window.location.origin}/StudyMarket/verify-email`,handleCodeInApp:!0}};ko.useDeviceLanguage();ko.settings.appVerificationDisabledForTesting=!1;const gxe=Object.freeze(Object.defineProperty({__proto__:null,COLLECTIONS:Dd,app:LE,auth:ko,db:rr,emailConfig:LD,storage:gy},Symbol.toStringTag,{value:"Module"}));class mj{static async createUser(e,r){const n=hn(rr,Dd.USERS,e),c={id:e,email:r.email,displayName:r.displayName||"Utilisateur",photoURL:r.photoURL||null,phone:null,isVerified:!1,verificationStatus:"pending",university:r.university||"Université non spécifiée",fieldOfStudy:r.fieldOfStudy||"Non spécifié",graduationYear:r.graduationYear||new Date().getFullYear()+2,campus:r.campus||"Campus principal",bio:null,location:"Paris, France",rating:0,reviewCount:0,trustScore:0,co2Saved:0,transactionsCount:0,donationsCount:0,notificationPreferences:{email:!0,push:!0,sms:!1,alerts:!0},createdAt:new Date,lastSeen:new Date};await C0(n,{...c,...r,id:e,createdAt:aa(),lastSeen:aa()})}static async getUser(e){try{const r=await Xa(hn(rr,Dd.USERS,e));if(!r.exists())return null;const n=r.data();let c=new Date,d=new Date;return n.createdAt&&(typeof n.createdAt=="string"?c=new Date(n.createdAt):n.createdAt.toDate&&typeof n.createdAt.toDate=="function"?c=n.createdAt.toDate():n.createdAt instanceof Date&&(c=n.createdAt)),n.lastSeen&&(typeof n.lastSeen=="string"?d=new Date(n.lastSeen):n.lastSeen.toDate&&typeof n.lastSeen.toDate=="function"?d=n.lastSeen.toDate():n.lastSeen instanceof Date&&(d=n.lastSeen)),{...n,id:e,createdAt:c,lastSeen:d}}catch(r){return console.error("Error getting user:",r),null}}static async updateUser(e,r){const n=hn(rr,Dd.USERS,e),c=Object.fromEntries(Object.entries(r).filter(([d,p])=>p!==void 0));await Rs(n,{...c,updatedAt:aa()})}static async updateUserStats(e,r){const n=hn(rr,Dd.USERS,e),c={};r.reviewCount!==void 0&&(c.reviewCount=r.reviewCount),r.averageRating!==void 0&&(c.rating=r.averageRating),r.transactionsCount!==void 0&&(c.transactionsCount=MD(r.transactionsCount)),r.co2Saved!==void 0&&(c.co2Saved=MD(r.co2Saved)),await Rs(n,c)}static async deleteUser(e){const r=T3(rr);r.delete(hn(rr,Dd.USERS,e));const n=ms(jn(rr,Dd.LISTINGS),ii("sellerId","==",e));(await gs(n)).forEach(E=>{r.delete(E.ref)});const d=ms(jn(rr,Dd.FAVORITES),ii("userId","==",e));(await gs(d)).forEach(E=>{r.delete(E.ref)});const a=ms(jn(rr,Dd.REVIEWS),ii("reviewerId","==",e));(await gs(a)).forEach(E=>{r.delete(E.ref)}),await r.commit()}static async searchUsers(e,r=10){try{const n=jn(rr,Dd.USERS),c=e(n,ii("displayName",">=",e),ii("displayName","<=",e+""),eo("displayName"),r(r));return(await gs(c)).docs.map(p=>{var a,w;return{...p.data(),id:p.id,createdAt:((a=p.data().createdAt)==null?void 0:a.toDate())||new Date,lastSeen:((w=p.data().lastSeen)==null?void 0:w.toDate())||new Date}})}catch(n){return console.error("Error searching users:",n),[]}}static async getUsersByUniversity(e,r=20){try{const n=jn(rr,Dd.USERS),c=ms(n,ii("university","==",e),eo("createdAt","desc"),r(r));return(await gs(c)).docs.map(p=>{var a,w;return{...p.data(),id:p.id,createdAt:((a=p.data().createdAt)==null?void 0:a.toDate())||new Date,lastSeen:((w=p.data().lastSeen)==null?void 0:w.toDate())||new Date}})}catch(n){return console.error("Error getting users by university:",n),[]}}}const eZ=z.createContext(void 0),$i=()=>{const t=z.useContext(eZ);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},_xe=({children:t})=>{const[e,r]=z.useState(null),[n,c]=z.useState(null),[d,p]=z.useState(!0),a=async(W,K)=>{try{const Z=await mj.getUser(W.uid);if(Z)c(Z);else{const $={email:W.email,displayName:W.displayName||"Utilisateur",photoURL:W.photoURL||null,university:K==null?void 0:K.university,fieldOfStudy:K==null?void 0:K.fieldOfStudy,graduationYear:K==null?void 0:K.graduationYear,campus:K==null?void 0:K.campus,...K};await mj.createUser(W.uid,$),c($)}}catch(Z){console.error("Error creating/updating user profile:",Z),Nt.error("Erreur lors de la création du profil")}},w=async()=>{if(e)try{const W=await mj.getUser(e.uid);c(W)}catch(W){console.error("Error refreshing user profile:",W)}},E=async(W,K)=>{try{await EG(ko,W,K),Nt.success("Connexion réussie !")}catch(Z){let $="Erreur de connexion";if(Z instanceof Error){const X=Z;switch(X.code){case"auth/user-not-found":$="Aucun compte trouvé avec cet email";break;case"auth/wrong-password":$="Mot de passe incorrect";break;case"auth/invalid-email":$="Format d'email invalide";break;case"auth/too-many-requests":$="Trop de tentatives. Réessayez plus tard";break;default:$=X.message}}throw Nt.error($),Z}},C=async(W,K,Z,$)=>{try{const{user:X}=await SG(ko,W,K);await OS(X,{displayName:Z}),await a(X,$),Nt.success("Compte créé avec succès !")}catch(X){let Q="Erreur lors de la création du compte";if(X instanceof Error){const re=X;switch(re.code){case"auth/email-already-in-use":Q="Cet email est déjà utilisé";break;case"auth/weak-password":Q="Le mot de passe est trop faible";break;case"auth/invalid-email":Q="Format d'email invalide";break;default:Q=re.message}}throw Nt.error(Q),X}},P=async()=>{try{const W=new Jf;W.setCustomParameters({prompt:"select_account"}),W.addScope("email"),W.addScope("profile"),await tfe(ko,W)}catch(W){throw console.error("Google sign in error:",W),W instanceof Error&&Nt.error("Erreur de connexion Google : "+W.message),W}},R=async()=>{try{await Che(ko),c(null),Nt.success("Déconnexion réussie !")}catch(W){throw Nt.error("Erreur lors de la déconnexion"),W}},B=async W=>{if(!(!e||!n))try{await mj.updateUser(e.uid,W),c({...n,...W}),Nt.success("Profil mis à jour !")}catch(K){throw console.error("Error updating profile:",K),Nt.error("Erreur lors de la mise à jour du profil"),K}};z.useEffect(()=>{let W=null;const K=Ihe(ko,async $=>{if(W&&(W(),W=null),r($),$){await a($);const{onSnapshot:X,doc:Q}=await ny(async()=>{const{onSnapshot:ve,doc:pe}=await Promise.resolve().then(()=>Mge);return{onSnapshot:ve,doc:pe}},void 0),{db:re}=await ny(async()=>{const{db:ve}=await Promise.resolve().then(()=>gxe);return{db:ve}},void 0);W=X(Q(re,"users",$.uid),ve=>{if(ve.exists()){const pe=ve.data();c(pe)}},ve=>{console.error("Erreur listener Firestore userProfile:",ve)})}else c(null);p(!1)});return(async()=>{try{const $=await nfe(ko);$!=null&&$.user&&(await a($.user),Nt.success("Connexion Google réussie !"))}catch($){if(console.error("Redirect result error:",$),$ instanceof Error){const X=$;X.code!=="auth/null-user"&&Nt.error("Erreur de connexion Google : "+X.message)}}})(),()=>{K(),W&&W()}},[]);const V={currentUser:e,userProfile:n,loading:d,signIn:E,signUp:C,signInWithGoogle:P,logout:R,updateUserProfile:B,refreshUserProfile:w};return i.jsx(eZ.Provider,{value:V,children:!d&&t})};/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yxe=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),tZ=(...t)=>t.filter((e,r,n)=>!!e&&n.indexOf(e)===r).join(" ");/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var xxe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vxe=z.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:c="",children:d,iconNode:p,...a},w)=>z.createElement("svg",{ref:w,...xxe,width:e,height:e,stroke:t,strokeWidth:n?Number(r)*24/Number(e):r,className:tZ("lucide",c),...a},[...p.map(([E,C])=>z.createElement(E,C)),...Array.isArray(d)?d:[d]]));/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=(t,e)=>{const r=z.forwardRef(({className:n,...c},d)=>z.createElement(vxe,{ref:d,iconNode:e,className:tZ(`lucide-${yxe(t)}`,n),...c}));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wxe=pr("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bR=pr("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rZ=pr("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bxe=pr("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vp=pr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=pr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c8=pr("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SR=pr("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nZ=pr("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sxe=pr("Baby",[["path",{d:"M9 12h.01",key:"157uk2"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"5yv0yz"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z3=pr("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bd=pr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Exe=pr("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Txe=pr("Blocks",[["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["path",{d:"M10 21V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H3",key:"1fpvtg"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sZ=pr("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iZ=pr("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B3=pr("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jxe=pr("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cS=pr("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nxe=pr("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=pr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H_=pr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aZ=pr("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V3=pr("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ixe=pr("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oZ=pr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cxe=pr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zh=pr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yd=pr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=pr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hd=pr("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sI=pr("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=pr("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fi=pr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lZ=pr("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=pr("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UC=pr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=pr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u8=pr("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Axe=pr("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _y=pr("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ec=pr("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pxe=pr("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fo=pr("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kxe=pr("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rxe=pr("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U3=pr("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $C=pr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V_=pr("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mxe=pr("Gamepad2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=pr("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cZ=pr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=pr("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uZ=pr("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tc=pr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=pr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dZ=pr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yy=pr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dxe=pr("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oxe=pr("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lxe=pr("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jd=pr("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hZ=pr("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fxe=pr("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fZ=pr("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=pr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zxe=pr("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xy=pr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bxe=pr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nl=pr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=pr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vxe=pr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=pr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iI=pr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pZ=pr("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d8=pr("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aI=pr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=pr("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uxe=pr("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h8=pr("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lw=pr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mZ=pr("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W_=pr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $xe=pr("Recycle",[["path",{d:"M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5",key:"x6z5xu"}],["path",{d:"M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775l-1.226-2.12",key:"1x4zh5"}],["path",{d:"m14 16-3 3 3 3",key:"f6jyew"}],["path",{d:"M8.293 13.596 7.196 9.5 3.1 10.598",key:"wf1obh"}],["path",{d:"m9.344 5.811 1.093-1.892A1.83 1.83 0 0 1 11.985 3a1.784 1.784 0 0 1 1.546.888l3.943 6.843",key:"9tzpgr"}],["path",{d:"m13.378 9.633 4.096 1.098 1.097-4.096",key:"1oe83g"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=pr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ER=pr("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f8=pr("School",[["path",{d:"M14 22v-4a2 2 0 1 0-4 0v4",key:"hhkicm"}],["path",{d:"m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2",key:"1vwozw"}],["path",{d:"M18 5v17",key:"1sw6gf"}],["path",{d:"m4 6 8-4 8 4",key:"1q0ilc"}],["path",{d:"M6 5v17",key:"1xfsm0"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oo=pr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vy=pr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qC=pr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $3=pr("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=pr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q3=pr("Shirt",[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z_=pr("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wp=pr("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=pr("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FD=pr("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gZ=pr("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Km=pr("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p8=pr("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oI=pr("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S_=pr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qxe=pr("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gxe=pr("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nd=pr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hxe=pr("TreePine",[["path",{d:"m17 14 3 3.3a1 1 0 0 1-.7 1.7H4.7a1 1 0 0 1-.7-1.7L7 14h-.3a1 1 0 0 1-.7-1.7L9 9h-.2A1 1 0 0 1 8 7.3L12 3l4 4.3a1 1 0 0 1-.8 1.7H15l3 3.3a1 1 0 0 1-.7 1.7H17Z",key:"cpyugq"}],["path",{d:"M12 22v-3",key:"kmzjlo"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bp=pr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=pr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=pr("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wxe=pr("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wy=pr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Z=pr("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zxe=pr("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=pr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sp=pr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yZ=pr("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kxe=pr("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xxe=pr("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const of=pr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cw=pr("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function Yxe(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function GC(...t){return e=>t.forEach(r=>Yxe(r,e))}function Fs(...t){return z.useCallback(GC(...t),t)}var Ep=z.forwardRef((t,e)=>{const{children:r,...n}=t,c=z.Children.toArray(r),d=c.find(Qxe);if(d){const p=d.props.children,a=c.map(w=>w===d?z.Children.count(p)>1?z.Children.only(null):z.isValidElement(p)?p.props.children:null:w);return i.jsx(zD,{...n,ref:e,children:z.isValidElement(p)?z.cloneElement(p,void 0,a):null})}return i.jsx(zD,{...n,ref:e,children:r})});Ep.displayName="Slot";var zD=z.forwardRef((t,e)=>{const{children:r,...n}=t;if(z.isValidElement(r)){const c=tve(r);return z.cloneElement(r,{...eve(n,r.props),ref:e?GC(e,c):c})}return z.Children.count(r)>1?z.Children.only(null):null});zD.displayName="SlotClone";var Jxe=({children:t})=>i.jsx(i.Fragment,{children:t});function Qxe(t){return z.isValidElement(t)&&t.type===Jxe}function eve(t,e){const r={...e};for(const n in e){const c=t[n],d=e[n];/^on[A-Z]/.test(n)?c&&d?r[n]=(...a)=>{d(...a),c(...a)}:c&&(r[n]=c):n==="style"?r[n]={...c,...d}:n==="className"&&(r[n]=[c,d].filter(Boolean).join(" "))}return{...t,...r}}function tve(t){var n,c;let e=(n=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:n.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=(c=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:c.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function xZ(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(r=xZ(t[e]))&&(n&&(n+=" "),n+=r);else for(e in t)t[e]&&(n&&(n+=" "),n+=e);return n}function rve(){for(var t,e,r=0,n="";r<arguments.length;)(t=arguments[r++])&&(e=xZ(t))&&(n&&(n+=" "),n+=e);return n}const m8=t=>typeof t=="boolean"?"".concat(t):t===0?"0":t,g8=rve,HC=(t,e)=>r=>{var n;if((e==null?void 0:e.variants)==null)return g8(t,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:c,defaultVariants:d}=e,p=Object.keys(c).map(E=>{const C=r==null?void 0:r[E],P=d==null?void 0:d[E];if(C===null)return null;const R=m8(C)||m8(P);return c[E][R]}),a=r&&Object.entries(r).reduce((E,C)=>{let[P,R]=C;return R===void 0||(E[P]=R),E},{}),w=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((E,C)=>{let{class:P,className:R,...B}=C;return Object.entries(B).every(V=>{let[W,K]=V;return Array.isArray(K)?K.includes({...d,...a}[W]):{...d,...a}[W]===K})?[...E,P,R]:E},[]);return g8(t,p,w,r==null?void 0:r.class,r==null?void 0:r.className)};function vZ(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var c=t.length;for(e=0;e<c;e++)t[e]&&(r=vZ(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function nve(){for(var t,e,r=0,n="",c=arguments.length;r<c;r++)(t=arguments[r])&&(e=vZ(t))&&(n&&(n+=" "),n+=e);return n}const G3="-",sve=t=>{const e=ave(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:p=>{const a=p.split(G3);return a[0]===""&&a.length!==1&&a.shift(),wZ(a,e)||ive(p)},getConflictingClassGroupIds:(p,a)=>{const w=r[p]||[];return a&&n[p]?[...w,...n[p]]:w}}},wZ=(t,e)=>{var p;if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),c=n?wZ(t.slice(1),n):void 0;if(c)return c;if(e.validators.length===0)return;const d=t.join(G3);return(p=e.validators.find(({validator:a})=>a(d)))==null?void 0:p.classGroupId},_8=/^\[(.+)\]$/,ive=t=>{if(_8.test(t)){const e=_8.exec(t)[1],r=e==null?void 0:e.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},ave=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return lve(Object.entries(t.classGroups),r).forEach(([d,p])=>{BD(p,n,d,e)}),n},BD=(t,e,r,n)=>{t.forEach(c=>{if(typeof c=="string"){const d=c===""?e:y8(e,c);d.classGroupId=r;return}if(typeof c=="function"){if(ove(c)){BD(c(n),e,r,n);return}e.validators.push({validator:c,classGroupId:r});return}Object.entries(c).forEach(([d,p])=>{BD(p,y8(e,d),r,n)})})},y8=(t,e)=>{let r=t;return e.split(G3).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},ove=t=>t.isThemeGetter,lve=(t,e)=>e?t.map(([r,n])=>{const c=n.map(d=>typeof d=="string"?e+d:typeof d=="object"?Object.fromEntries(Object.entries(d).map(([p,a])=>[e+p,a])):d);return[r,c]}):t,cve=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const c=(d,p)=>{r.set(d,p),e++,e>t&&(e=0,n=r,r=new Map)};return{get(d){let p=r.get(d);if(p!==void 0)return p;if((p=n.get(d))!==void 0)return c(d,p),p},set(d,p){r.has(d)?r.set(d,p):c(d,p)}}},bZ="!",uve=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,c=e[0],d=e.length,p=a=>{const w=[];let E=0,C=0,P;for(let K=0;K<a.length;K++){let Z=a[K];if(E===0){if(Z===c&&(n||a.slice(K,K+d)===e)){w.push(a.slice(C,K)),C=K+d;continue}if(Z==="/"){P=K;continue}}Z==="["?E++:Z==="]"&&E--}const R=w.length===0?a:a.substring(C),B=R.startsWith(bZ),V=B?R.substring(1):R,W=P&&P>C?P-C:void 0;return{modifiers:w,hasImportantModifier:B,baseClassName:V,maybePostfixModifierPosition:W}};return r?a=>r({className:a,parseClassName:p}):p},dve=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},hve=t=>({cache:cve(t.cacheSize),parseClassName:uve(t),...sve(t)}),fve=/\s+/,pve=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:c}=e,d=[],p=t.trim().split(fve);let a="";for(let w=p.length-1;w>=0;w-=1){const E=p[w],{modifiers:C,hasImportantModifier:P,baseClassName:R,maybePostfixModifierPosition:B}=r(E);let V=!!B,W=n(V?R.substring(0,B):R);if(!W){if(!V){a=E+(a.length>0?" "+a:a);continue}if(W=n(R),!W){a=E+(a.length>0?" "+a:a);continue}V=!1}const K=dve(C).join(":"),Z=P?K+bZ:K,$=Z+W;if(d.includes($))continue;d.push($);const X=c(W,V);for(let Q=0;Q<X.length;++Q){const re=X[Q];d.push(Z+re)}a=E+(a.length>0?" "+a:a)}return a};function mve(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=SZ(e))&&(n&&(n+=" "),n+=r);return n}const SZ=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=SZ(t[n]))&&(r&&(r+=" "),r+=e);return r};function gve(t,...e){let r,n,c,d=p;function p(w){const E=e.reduce((C,P)=>P(C),t());return r=hve(E),n=r.cache.get,c=r.cache.set,d=a,a(w)}function a(w){const E=n(w);if(E)return E;const C=pve(w,r);return c(w,C),C}return function(){return d(mve.apply(null,arguments))}}const Na=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},EZ=/^\[(?:([a-z-]+):)?(.+)\]$/i,_ve=/^\d+\/\d+$/,yve=new Set(["px","full","screen"]),xve=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,vve=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,wve=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,bve=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Sve=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,qf=t=>s0(t)||yve.has(t)||_ve.test(t),Tm=t=>uw(t,"length",Pve),s0=t=>!!t&&!Number.isNaN(Number(t)),TR=t=>uw(t,"number",s0),E1=t=>!!t&&Number.isInteger(Number(t)),Eve=t=>t.endsWith("%")&&s0(t.slice(0,-1)),Zs=t=>EZ.test(t),jm=t=>xve.test(t),Tve=new Set(["length","size","percentage"]),jve=t=>uw(t,Tve,TZ),Nve=t=>uw(t,"position",TZ),Ive=new Set(["image","url"]),Cve=t=>uw(t,Ive,Rve),Ave=t=>uw(t,"",kve),T1=()=>!0,uw=(t,e,r)=>{const n=EZ.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},Pve=t=>vve.test(t)&&!wve.test(t),TZ=()=>!1,kve=t=>bve.test(t),Rve=t=>Sve.test(t),Mve=()=>{const t=Na("colors"),e=Na("spacing"),r=Na("blur"),n=Na("brightness"),c=Na("borderColor"),d=Na("borderRadius"),p=Na("borderSpacing"),a=Na("borderWidth"),w=Na("contrast"),E=Na("grayscale"),C=Na("hueRotate"),P=Na("invert"),R=Na("gap"),B=Na("gradientColorStops"),V=Na("gradientColorStopPositions"),W=Na("inset"),K=Na("margin"),Z=Na("opacity"),$=Na("padding"),X=Na("saturate"),Q=Na("scale"),re=Na("sepia"),ve=Na("skew"),pe=Na("space"),ue=Na("translate"),ge=()=>["auto","contain","none"],ce=()=>["auto","hidden","clip","visible","scroll"],Se=()=>["auto",Zs,e],le=()=>[Zs,e],J=()=>["",qf,Tm],ke=()=>["auto",s0,Zs],Ze=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Xe=()=>["solid","dashed","dotted","double","none"],qe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$e=()=>["start","end","center","between","around","evenly","stretch"],st=()=>["","0",Zs],it=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Mt=()=>[s0,Zs];return{cacheSize:500,separator:":",theme:{colors:[T1],spacing:[qf,Tm],blur:["none","",jm,Zs],brightness:Mt(),borderColor:[t],borderRadius:["none","","full",jm,Zs],borderSpacing:le(),borderWidth:J(),contrast:Mt(),grayscale:st(),hueRotate:Mt(),invert:st(),gap:le(),gradientColorStops:[t],gradientColorStopPositions:[Eve,Tm],inset:Se(),margin:Se(),opacity:Mt(),padding:le(),saturate:Mt(),scale:Mt(),sepia:st(),skew:Mt(),space:le(),translate:le()},classGroups:{aspect:[{aspect:["auto","square","video",Zs]}],container:["container"],columns:[{columns:[jm]}],"break-after":[{"break-after":it()}],"break-before":[{"break-before":it()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ze(),Zs]}],overflow:[{overflow:ce()}],"overflow-x":[{"overflow-x":ce()}],"overflow-y":[{"overflow-y":ce()}],overscroll:[{overscroll:ge()}],"overscroll-x":[{"overscroll-x":ge()}],"overscroll-y":[{"overscroll-y":ge()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[W]}],"inset-x":[{"inset-x":[W]}],"inset-y":[{"inset-y":[W]}],start:[{start:[W]}],end:[{end:[W]}],top:[{top:[W]}],right:[{right:[W]}],bottom:[{bottom:[W]}],left:[{left:[W]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",E1,Zs]}],basis:[{basis:Se()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Zs]}],grow:[{grow:st()}],shrink:[{shrink:st()}],order:[{order:["first","last","none",E1,Zs]}],"grid-cols":[{"grid-cols":[T1]}],"col-start-end":[{col:["auto",{span:["full",E1,Zs]},Zs]}],"col-start":[{"col-start":ke()}],"col-end":[{"col-end":ke()}],"grid-rows":[{"grid-rows":[T1]}],"row-start-end":[{row:["auto",{span:[E1,Zs]},Zs]}],"row-start":[{"row-start":ke()}],"row-end":[{"row-end":ke()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Zs]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Zs]}],gap:[{gap:[R]}],"gap-x":[{"gap-x":[R]}],"gap-y":[{"gap-y":[R]}],"justify-content":[{justify:["normal",...$e()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...$e(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...$e(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[$]}],px:[{px:[$]}],py:[{py:[$]}],ps:[{ps:[$]}],pe:[{pe:[$]}],pt:[{pt:[$]}],pr:[{pr:[$]}],pb:[{pb:[$]}],pl:[{pl:[$]}],m:[{m:[K]}],mx:[{mx:[K]}],my:[{my:[K]}],ms:[{ms:[K]}],me:[{me:[K]}],mt:[{mt:[K]}],mr:[{mr:[K]}],mb:[{mb:[K]}],ml:[{ml:[K]}],"space-x":[{"space-x":[pe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[pe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Zs,e]}],"min-w":[{"min-w":[Zs,e,"min","max","fit"]}],"max-w":[{"max-w":[Zs,e,"none","full","min","max","fit","prose",{screen:[jm]},jm]}],h:[{h:[Zs,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Zs,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Zs,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Zs,e,"auto","min","max","fit"]}],"font-size":[{text:["base",jm,Tm]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",TR]}],"font-family":[{font:[T1]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Zs]}],"line-clamp":[{"line-clamp":["none",s0,TR]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",qf,Zs]}],"list-image":[{"list-image":["none",Zs]}],"list-style-type":[{list:["none","disc","decimal",Zs]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[Z]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[Z]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",qf,Tm]}],"underline-offset":[{"underline-offset":["auto",qf,Zs]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:le()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Zs]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Zs]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Z]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ze(),Nve]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",jve]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Cve]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[V]}],"gradient-via-pos":[{via:[V]}],"gradient-to-pos":[{to:[V]}],"gradient-from":[{from:[B]}],"gradient-via":[{via:[B]}],"gradient-to":[{to:[B]}],rounded:[{rounded:[d]}],"rounded-s":[{"rounded-s":[d]}],"rounded-e":[{"rounded-e":[d]}],"rounded-t":[{"rounded-t":[d]}],"rounded-r":[{"rounded-r":[d]}],"rounded-b":[{"rounded-b":[d]}],"rounded-l":[{"rounded-l":[d]}],"rounded-ss":[{"rounded-ss":[d]}],"rounded-se":[{"rounded-se":[d]}],"rounded-ee":[{"rounded-ee":[d]}],"rounded-es":[{"rounded-es":[d]}],"rounded-tl":[{"rounded-tl":[d]}],"rounded-tr":[{"rounded-tr":[d]}],"rounded-br":[{"rounded-br":[d]}],"rounded-bl":[{"rounded-bl":[d]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[Z]}],"border-style":[{border:[...Xe(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Z]}],"divide-style":[{divide:Xe()}],"border-color":[{border:[c]}],"border-color-x":[{"border-x":[c]}],"border-color-y":[{"border-y":[c]}],"border-color-s":[{"border-s":[c]}],"border-color-e":[{"border-e":[c]}],"border-color-t":[{"border-t":[c]}],"border-color-r":[{"border-r":[c]}],"border-color-b":[{"border-b":[c]}],"border-color-l":[{"border-l":[c]}],"divide-color":[{divide:[c]}],"outline-style":[{outline:["",...Xe()]}],"outline-offset":[{"outline-offset":[qf,Zs]}],"outline-w":[{outline:[qf,Tm]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:J()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[Z]}],"ring-offset-w":[{"ring-offset":[qf,Tm]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",jm,Ave]}],"shadow-color":[{shadow:[T1]}],opacity:[{opacity:[Z]}],"mix-blend":[{"mix-blend":[...qe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":qe()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[w]}],"drop-shadow":[{"drop-shadow":["","none",jm,Zs]}],grayscale:[{grayscale:[E]}],"hue-rotate":[{"hue-rotate":[C]}],invert:[{invert:[P]}],saturate:[{saturate:[X]}],sepia:[{sepia:[re]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[w]}],"backdrop-grayscale":[{"backdrop-grayscale":[E]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[C]}],"backdrop-invert":[{"backdrop-invert":[P]}],"backdrop-opacity":[{"backdrop-opacity":[Z]}],"backdrop-saturate":[{"backdrop-saturate":[X]}],"backdrop-sepia":[{"backdrop-sepia":[re]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[p]}],"border-spacing-x":[{"border-spacing-x":[p]}],"border-spacing-y":[{"border-spacing-y":[p]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Zs]}],duration:[{duration:Mt()}],ease:[{ease:["linear","in","out","in-out",Zs]}],delay:[{delay:Mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Zs]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Q]}],"scale-x":[{"scale-x":[Q]}],"scale-y":[{"scale-y":[Q]}],rotate:[{rotate:[E1,Zs]}],"translate-x":[{"translate-x":[ue]}],"translate-y":[{"translate-y":[ue]}],"skew-x":[{"skew-x":[ve]}],"skew-y":[{"skew-y":[ve]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Zs]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Zs]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":le()}],"scroll-mx":[{"scroll-mx":le()}],"scroll-my":[{"scroll-my":le()}],"scroll-ms":[{"scroll-ms":le()}],"scroll-me":[{"scroll-me":le()}],"scroll-mt":[{"scroll-mt":le()}],"scroll-mr":[{"scroll-mr":le()}],"scroll-mb":[{"scroll-mb":le()}],"scroll-ml":[{"scroll-ml":le()}],"scroll-p":[{"scroll-p":le()}],"scroll-px":[{"scroll-px":le()}],"scroll-py":[{"scroll-py":le()}],"scroll-ps":[{"scroll-ps":le()}],"scroll-pe":[{"scroll-pe":le()}],"scroll-pt":[{"scroll-pt":le()}],"scroll-pr":[{"scroll-pr":le()}],"scroll-pb":[{"scroll-pb":le()}],"scroll-pl":[{"scroll-pl":le()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Zs]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[qf,Tm,TR]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Dve=gve(Mve);function kn(...t){return Dve(nve(t))}const VD=HC("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Ge=z.forwardRef(({className:t,variant:e,size:r,asChild:n=!1,...c},d)=>{const p=n?Ep:"button";return i.jsx(p,{className:kn(VD({variant:e,size:r,className:t})),ref:d,...c})});Ge.displayName="Button";const Gr=z.forwardRef(({className:t,type:e,...r},n)=>i.jsx("input",{type:e,className:kn("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...r}));Gr.displayName="Input";function tn(t,e,{checkForDefaultPrevented:r=!0}={}){return function(c){if(t==null||t(c),r===!1||!c.defaultPrevented)return e==null?void 0:e(c)}}function Ove(t,e){const r=z.createContext(e),n=d=>{const{children:p,...a}=d,w=z.useMemo(()=>a,Object.values(a));return i.jsx(r.Provider,{value:w,children:p})};n.displayName=t+"Provider";function c(d){const p=z.useContext(r);if(p)return p;if(e!==void 0)return e;throw new Error(`\`${d}\` must be used within \`${t}\``)}return[n,c]}function hd(t,e=[]){let r=[];function n(d,p){const a=z.createContext(p),w=r.length;r=[...r,p];const E=P=>{var Z;const{scope:R,children:B,...V}=P,W=((Z=R==null?void 0:R[t])==null?void 0:Z[w])||a,K=z.useMemo(()=>V,Object.values(V));return i.jsx(W.Provider,{value:K,children:B})};E.displayName=d+"Provider";function C(P,R){var W;const B=((W=R==null?void 0:R[t])==null?void 0:W[w])||a,V=z.useContext(B);if(V)return V;if(p!==void 0)return p;throw new Error(`\`${P}\` must be used within \`${d}\``)}return[E,C]}const c=()=>{const d=r.map(p=>z.createContext(p));return function(a){const w=(a==null?void 0:a[t])||d;return z.useMemo(()=>({[`__scope${t}`]:{...a,[t]:w}}),[a,w])}};return c.scopeName=t,[n,Lve(c,...e)]}function Lve(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const p=n.reduce((a,{useScope:w,scopeName:E})=>{const P=w(d)[`__scope${E}`];return{...a,...P}},{});return z.useMemo(()=>({[`__scope${e.scopeName}`]:p}),[p])}};return r.scopeName=e.scopeName,r}function Do(t){const e=z.useRef(t);return z.useEffect(()=>{e.current=t}),z.useMemo(()=>(...r)=>{var n;return(n=e.current)==null?void 0:n.call(e,...r)},[])}function ud({prop:t,defaultProp:e,onChange:r=()=>{}}){const[n,c]=Fve({defaultProp:e,onChange:r}),d=t!==void 0,p=d?t:n,a=Do(r),w=z.useCallback(E=>{if(d){const P=typeof E=="function"?E(t):E;P!==t&&a(P)}else c(E)},[d,t,c,a]);return[p,w]}function Fve({defaultProp:t,onChange:e}){const r=z.useState(t),[n]=r,c=z.useRef(n),d=Do(e);return z.useEffect(()=>{c.current!==n&&(d(n),c.current=n)},[n,c,d]),r}var zve=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Pn=zve.reduce((t,e)=>{const r=z.forwardRef((n,c)=>{const{asChild:d,...p}=n,a=d?Ep:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(a,{...p,ref:c})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function jZ(t,e){t&&Y0.flushSync(()=>t.dispatchEvent(e))}function Bve(t,e=[]){let r=[];function n(d,p){const a=z.createContext(p),w=r.length;r=[...r,p];function E(P){const{scope:R,children:B,...V}=P,W=(R==null?void 0:R[t][w])||a,K=z.useMemo(()=>V,Object.values(V));return i.jsx(W.Provider,{value:K,children:B})}function C(P,R){const B=(R==null?void 0:R[t][w])||a,V=z.useContext(B);if(V)return V;if(p!==void 0)return p;throw new Error(`\`${P}\` must be used within \`${d}\``)}return E.displayName=d+"Provider",[E,C]}const c=()=>{const d=r.map(p=>z.createContext(p));return function(a){const w=(a==null?void 0:a[t])||d;return z.useMemo(()=>({[`__scope${t}`]:{...a,[t]:w}}),[a,w])}};return c.scopeName=t,[n,Vve(c,...e)]}function Vve(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const p=n.reduce((a,{useScope:w,scopeName:E})=>{const P=w(d)[`__scope${E}`];return{...a,...P}},{});return z.useMemo(()=>({[`__scope${e.scopeName}`]:p}),[p])}};return r.scopeName=e.scopeName,r}function FE(t){const e=t+"CollectionProvider",[r,n]=Bve(e),[c,d]=r(e,{collectionRef:{current:null},itemMap:new Map}),p=B=>{const{scope:V,children:W}=B,K=_n.useRef(null),Z=_n.useRef(new Map).current;return i.jsx(c,{scope:V,itemMap:Z,collectionRef:K,children:W})};p.displayName=e;const a=t+"CollectionSlot",w=_n.forwardRef((B,V)=>{const{scope:W,children:K}=B,Z=d(a,W),$=Fs(V,Z.collectionRef);return i.jsx(Ep,{ref:$,children:K})});w.displayName=a;const E=t+"CollectionItemSlot",C="data-radix-collection-item",P=_n.forwardRef((B,V)=>{const{scope:W,children:K,...Z}=B,$=_n.useRef(null),X=Fs(V,$),Q=d(E,W);return _n.useEffect(()=>(Q.itemMap.set($,{ref:$,...Z}),()=>void Q.itemMap.delete($))),i.jsx(Ep,{[C]:"",ref:X,children:K})});P.displayName=E;function R(B){const V=d(t+"CollectionConsumer",B);return _n.useCallback(()=>{const K=V.collectionRef.current;if(!K)return[];const Z=Array.from(K.querySelectorAll(`[${C}]`));return Array.from(V.itemMap.values()).sort((Q,re)=>Z.indexOf(Q.ref.current)-Z.indexOf(re.ref.current))},[V.collectionRef,V.itemMap])}return[{Provider:p,Slot:w,ItemSlot:P},R,n]}var Uve=z.createContext(void 0);function Fy(t){const e=z.useContext(Uve);return t||e||"ltr"}function $ve(t,e=globalThis==null?void 0:globalThis.document){const r=Do(t);z.useEffect(()=>{const n=c=>{c.key==="Escape"&&r(c)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[r,e])}var qve="DismissableLayer",UD="dismissableLayer.update",Gve="dismissableLayer.pointerDownOutside",Hve="dismissableLayer.focusOutside",x8,NZ=z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),zE=z.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:p,onDismiss:a,...w}=t,E=z.useContext(NZ),[C,P]=z.useState(null),R=(C==null?void 0:C.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,B]=z.useState({}),V=Fs(e,pe=>P(pe)),W=Array.from(E.layers),[K]=[...E.layersWithOutsidePointerEventsDisabled].slice(-1),Z=W.indexOf(K),$=C?W.indexOf(C):-1,X=E.layersWithOutsidePointerEventsDisabled.size>0,Q=$>=Z,re=Kve(pe=>{const ue=pe.target,ge=[...E.branches].some(ce=>ce.contains(ue));!Q||ge||(c==null||c(pe),p==null||p(pe),pe.defaultPrevented||a==null||a())},R),ve=Xve(pe=>{const ue=pe.target;[...E.branches].some(ce=>ce.contains(ue))||(d==null||d(pe),p==null||p(pe),pe.defaultPrevented||a==null||a())},R);return $ve(pe=>{$===E.layers.size-1&&(n==null||n(pe),!pe.defaultPrevented&&a&&(pe.preventDefault(),a()))},R),z.useEffect(()=>{if(C)return r&&(E.layersWithOutsidePointerEventsDisabled.size===0&&(x8=R.body.style.pointerEvents,R.body.style.pointerEvents="none"),E.layersWithOutsidePointerEventsDisabled.add(C)),E.layers.add(C),v8(),()=>{r&&E.layersWithOutsidePointerEventsDisabled.size===1&&(R.body.style.pointerEvents=x8)}},[C,R,r,E]),z.useEffect(()=>()=>{C&&(E.layers.delete(C),E.layersWithOutsidePointerEventsDisabled.delete(C),v8())},[C,E]),z.useEffect(()=>{const pe=()=>B({});return document.addEventListener(UD,pe),()=>document.removeEventListener(UD,pe)},[]),i.jsx(Pn.div,{...w,ref:V,style:{pointerEvents:X?Q?"auto":"none":void 0,...t.style},onFocusCapture:tn(t.onFocusCapture,ve.onFocusCapture),onBlurCapture:tn(t.onBlurCapture,ve.onBlurCapture),onPointerDownCapture:tn(t.onPointerDownCapture,re.onPointerDownCapture)})});zE.displayName=qve;var Wve="DismissableLayerBranch",Zve=z.forwardRef((t,e)=>{const r=z.useContext(NZ),n=z.useRef(null),c=Fs(e,n);return z.useEffect(()=>{const d=n.current;if(d)return r.branches.add(d),()=>{r.branches.delete(d)}},[r.branches]),i.jsx(Pn.div,{...t,ref:c})});Zve.displayName=Wve;function Kve(t,e=globalThis==null?void 0:globalThis.document){const r=Do(t),n=z.useRef(!1),c=z.useRef(()=>{});return z.useEffect(()=>{const d=a=>{if(a.target&&!n.current){let w=function(){IZ(Gve,r,E,{discrete:!0})};const E={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",c.current),c.current=w,e.addEventListener("click",c.current,{once:!0})):w()}else e.removeEventListener("click",c.current);n.current=!1},p=window.setTimeout(()=>{e.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(p),e.removeEventListener("pointerdown",d),e.removeEventListener("click",c.current)}},[e,r]),{onPointerDownCapture:()=>n.current=!0}}function Xve(t,e=globalThis==null?void 0:globalThis.document){const r=Do(t),n=z.useRef(!1);return z.useEffect(()=>{const c=d=>{d.target&&!n.current&&IZ(Hve,r,{originalEvent:d},{discrete:!1})};return e.addEventListener("focusin",c),()=>e.removeEventListener("focusin",c)},[e,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function v8(){const t=new CustomEvent(UD);document.dispatchEvent(t)}function IZ(t,e,r,{discrete:n}){const c=r.originalEvent.target,d=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&c.addEventListener(t,e,{once:!0}),n?jZ(c,d):c.dispatchEvent(d)}var jR=0;function WC(){z.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??w8()),document.body.insertAdjacentElement("beforeend",t[1]??w8()),jR++,()=>{jR===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),jR--}},[])}function w8(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var NR="focusScope.autoFocusOnMount",IR="focusScope.autoFocusOnUnmount",b8={bubbles:!1,cancelable:!0},Yve="FocusScope",BE=z.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:c,onUnmountAutoFocus:d,...p}=t,[a,w]=z.useState(null),E=Do(c),C=Do(d),P=z.useRef(null),R=Fs(e,W=>w(W)),B=z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;z.useEffect(()=>{if(n){let W=function(X){if(B.paused||!a)return;const Q=X.target;a.contains(Q)?P.current=Q:Cm(P.current,{select:!0})},K=function(X){if(B.paused||!a)return;const Q=X.relatedTarget;Q!==null&&(a.contains(Q)||Cm(P.current,{select:!0}))},Z=function(X){if(document.activeElement===document.body)for(const re of X)re.removedNodes.length>0&&Cm(a)};document.addEventListener("focusin",W),document.addEventListener("focusout",K);const $=new MutationObserver(Z);return a&&$.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",W),document.removeEventListener("focusout",K),$.disconnect()}}},[n,a,B.paused]),z.useEffect(()=>{if(a){E8.add(B);const W=document.activeElement;if(!a.contains(W)){const Z=new CustomEvent(NR,b8);a.addEventListener(NR,E),a.dispatchEvent(Z),Z.defaultPrevented||(Jve(n0e(CZ(a)),{select:!0}),document.activeElement===W&&Cm(a))}return()=>{a.removeEventListener(NR,E),setTimeout(()=>{const Z=new CustomEvent(IR,b8);a.addEventListener(IR,C),a.dispatchEvent(Z),Z.defaultPrevented||Cm(W??document.body,{select:!0}),a.removeEventListener(IR,C),E8.remove(B)},0)}}},[a,E,C,B]);const V=z.useCallback(W=>{if(!r&&!n||B.paused)return;const K=W.key==="Tab"&&!W.altKey&&!W.ctrlKey&&!W.metaKey,Z=document.activeElement;if(K&&Z){const $=W.currentTarget,[X,Q]=Qve($);X&&Q?!W.shiftKey&&Z===Q?(W.preventDefault(),r&&Cm(X,{select:!0})):W.shiftKey&&Z===X&&(W.preventDefault(),r&&Cm(Q,{select:!0})):Z===$&&W.preventDefault()}},[r,n,B.paused]);return i.jsx(Pn.div,{tabIndex:-1,...p,ref:R,onKeyDown:V})});BE.displayName=Yve;function Jve(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if(Cm(n,{select:e}),document.activeElement!==r)return}function Qve(t){const e=CZ(t),r=S8(e,t),n=S8(e.reverse(),t);return[r,n]}function CZ(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const c=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||c?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function S8(t,e){for(const r of t)if(!e0e(r,{upTo:e}))return r}function e0e(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function t0e(t){return t instanceof HTMLInputElement&&"select"in t}function Cm(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&t0e(t)&&e&&t.select()}}var E8=r0e();function r0e(){let t=[];return{add(e){const r=t[0];e!==r&&(r==null||r.pause()),t=T8(t,e),t.unshift(e)},remove(e){var r;t=T8(t,e),(r=t[0])==null||r.resume()}}}function T8(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function n0e(t){return t.filter(e=>e.tagName!=="A")}var Jo=globalThis!=null&&globalThis.document?z.useLayoutEffect:()=>{},s0e=v9.useId||(()=>{}),i0e=0;function ku(t){const[e,r]=z.useState(s0e());return Jo(()=>{r(n=>n??String(i0e++))},[t]),e?`radix-${e}`:""}const a0e=["top","right","bottom","left"],pg=Math.min,ju=Math.max,lI=Math.round,gj=Math.floor,mg=t=>({x:t,y:t}),o0e={left:"right",right:"left",bottom:"top",top:"bottom"},l0e={start:"end",end:"start"};function $D(t,e,r){return ju(t,pg(e,r))}function Tp(t,e){return typeof t=="function"?t(e):t}function jp(t){return t.split("-")[0]}function dw(t){return t.split("-")[1]}function H3(t){return t==="x"?"y":"x"}function W3(t){return t==="y"?"height":"width"}function gg(t){return["top","bottom"].includes(jp(t))?"y":"x"}function Z3(t){return H3(gg(t))}function c0e(t,e,r){r===void 0&&(r=!1);const n=dw(t),c=Z3(t),d=W3(c);let p=c==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[d]>e.floating[d]&&(p=cI(p)),[p,cI(p)]}function u0e(t){const e=cI(t);return[qD(t),e,qD(e)]}function qD(t){return t.replace(/start|end/g,e=>l0e[e])}function d0e(t,e,r){const n=["left","right"],c=["right","left"],d=["top","bottom"],p=["bottom","top"];switch(t){case"top":case"bottom":return r?e?c:n:e?n:c;case"left":case"right":return e?d:p;default:return[]}}function h0e(t,e,r,n){const c=dw(t);let d=d0e(jp(t),r==="start",n);return c&&(d=d.map(p=>p+"-"+c),e&&(d=d.concat(d.map(qD)))),d}function cI(t){return t.replace(/left|right|bottom|top/g,e=>o0e[e])}function f0e(t){return{top:0,right:0,bottom:0,left:0,...t}}function AZ(t){return typeof t!="number"?f0e(t):{top:t,right:t,bottom:t,left:t}}function uI(t){const{x:e,y:r,width:n,height:c}=t;return{width:n,height:c,top:r,left:e,right:e+n,bottom:r+c,x:e,y:r}}function j8(t,e,r){let{reference:n,floating:c}=t;const d=gg(e),p=Z3(e),a=W3(p),w=jp(e),E=d==="y",C=n.x+n.width/2-c.width/2,P=n.y+n.height/2-c.height/2,R=n[a]/2-c[a]/2;let B;switch(w){case"top":B={x:C,y:n.y-c.height};break;case"bottom":B={x:C,y:n.y+n.height};break;case"right":B={x:n.x+n.width,y:P};break;case"left":B={x:n.x-c.width,y:P};break;default:B={x:n.x,y:n.y}}switch(dw(e)){case"start":B[p]-=R*(r&&E?-1:1);break;case"end":B[p]+=R*(r&&E?-1:1);break}return B}const p0e=async(t,e,r)=>{const{placement:n="bottom",strategy:c="absolute",middleware:d=[],platform:p}=r,a=d.filter(Boolean),w=await(p.isRTL==null?void 0:p.isRTL(e));let E=await p.getElementRects({reference:t,floating:e,strategy:c}),{x:C,y:P}=j8(E,n,w),R=n,B={},V=0;for(let W=0;W<a.length;W++){const{name:K,fn:Z}=a[W],{x:$,y:X,data:Q,reset:re}=await Z({x:C,y:P,initialPlacement:n,placement:R,strategy:c,middlewareData:B,rects:E,platform:p,elements:{reference:t,floating:e}});C=$??C,P=X??P,B={...B,[K]:{...B[K],...Q}},re&&V<=50&&(V++,typeof re=="object"&&(re.placement&&(R=re.placement),re.rects&&(E=re.rects===!0?await p.getElementRects({reference:t,floating:e,strategy:c}):re.rects),{x:C,y:P}=j8(E,R,w)),W=-1)}return{x:C,y:P,placement:R,strategy:c,middlewareData:B}};async function GS(t,e){var r;e===void 0&&(e={});const{x:n,y:c,platform:d,rects:p,elements:a,strategy:w}=t,{boundary:E="clippingAncestors",rootBoundary:C="viewport",elementContext:P="floating",altBoundary:R=!1,padding:B=0}=Tp(e,t),V=AZ(B),K=a[R?P==="floating"?"reference":"floating":P],Z=uI(await d.getClippingRect({element:(r=await(d.isElement==null?void 0:d.isElement(K)))==null||r?K:K.contextElement||await(d.getDocumentElement==null?void 0:d.getDocumentElement(a.floating)),boundary:E,rootBoundary:C,strategy:w})),$=P==="floating"?{x:n,y:c,width:p.floating.width,height:p.floating.height}:p.reference,X=await(d.getOffsetParent==null?void 0:d.getOffsetParent(a.floating)),Q=await(d.isElement==null?void 0:d.isElement(X))?await(d.getScale==null?void 0:d.getScale(X))||{x:1,y:1}:{x:1,y:1},re=uI(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:$,offsetParent:X,strategy:w}):$);return{top:(Z.top-re.top+V.top)/Q.y,bottom:(re.bottom-Z.bottom+V.bottom)/Q.y,left:(Z.left-re.left+V.left)/Q.x,right:(re.right-Z.right+V.right)/Q.x}}const m0e=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:c,rects:d,platform:p,elements:a,middlewareData:w}=e,{element:E,padding:C=0}=Tp(t,e)||{};if(E==null)return{};const P=AZ(C),R={x:r,y:n},B=Z3(c),V=W3(B),W=await p.getDimensions(E),K=B==="y",Z=K?"top":"left",$=K?"bottom":"right",X=K?"clientHeight":"clientWidth",Q=d.reference[V]+d.reference[B]-R[B]-d.floating[V],re=R[B]-d.reference[B],ve=await(p.getOffsetParent==null?void 0:p.getOffsetParent(E));let pe=ve?ve[X]:0;(!pe||!await(p.isElement==null?void 0:p.isElement(ve)))&&(pe=a.floating[X]||d.floating[V]);const ue=Q/2-re/2,ge=pe/2-W[V]/2-1,ce=pg(P[Z],ge),Se=pg(P[$],ge),le=ce,J=pe-W[V]-Se,ke=pe/2-W[V]/2+ue,Ze=$D(le,ke,J),Xe=!w.arrow&&dw(c)!=null&&ke!==Ze&&d.reference[V]/2-(ke<le?ce:Se)-W[V]/2<0,qe=Xe?ke<le?ke-le:ke-J:0;return{[B]:R[B]+qe,data:{[B]:Ze,centerOffset:ke-Ze-qe,...Xe&&{alignmentOffset:qe}},reset:Xe}}}),g0e=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:c,middlewareData:d,rects:p,initialPlacement:a,platform:w,elements:E}=e,{mainAxis:C=!0,crossAxis:P=!0,fallbackPlacements:R,fallbackStrategy:B="bestFit",fallbackAxisSideDirection:V="none",flipAlignment:W=!0,...K}=Tp(t,e);if((r=d.arrow)!=null&&r.alignmentOffset)return{};const Z=jp(c),$=gg(a),X=jp(a)===a,Q=await(w.isRTL==null?void 0:w.isRTL(E.floating)),re=R||(X||!W?[cI(a)]:u0e(a)),ve=V!=="none";!R&&ve&&re.push(...h0e(a,W,V,Q));const pe=[a,...re],ue=await GS(e,K),ge=[];let ce=((n=d.flip)==null?void 0:n.overflows)||[];if(C&&ge.push(ue[Z]),P){const ke=c0e(c,p,Q);ge.push(ue[ke[0]],ue[ke[1]])}if(ce=[...ce,{placement:c,overflows:ge}],!ge.every(ke=>ke<=0)){var Se,le;const ke=(((Se=d.flip)==null?void 0:Se.index)||0)+1,Ze=pe[ke];if(Ze)return{data:{index:ke,overflows:ce},reset:{placement:Ze}};let Xe=(le=ce.filter(qe=>qe.overflows[0]<=0).sort((qe,$e)=>qe.overflows[1]-$e.overflows[1])[0])==null?void 0:le.placement;if(!Xe)switch(B){case"bestFit":{var J;const qe=(J=ce.filter($e=>{if(ve){const st=gg($e.placement);return st===$||st==="y"}return!0}).map($e=>[$e.placement,$e.overflows.filter(st=>st>0).reduce((st,it)=>st+it,0)]).sort(($e,st)=>$e[1]-st[1])[0])==null?void 0:J[0];qe&&(Xe=qe);break}case"initialPlacement":Xe=a;break}if(c!==Xe)return{reset:{placement:Xe}}}return{}}}};function N8(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function I8(t){return a0e.some(e=>t[e]>=0)}const _0e=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...c}=Tp(t,e);switch(n){case"referenceHidden":{const d=await GS(e,{...c,elementContext:"reference"}),p=N8(d,r.reference);return{data:{referenceHiddenOffsets:p,referenceHidden:I8(p)}}}case"escaped":{const d=await GS(e,{...c,altBoundary:!0}),p=N8(d,r.floating);return{data:{escapedOffsets:p,escaped:I8(p)}}}default:return{}}}}};async function y0e(t,e){const{placement:r,platform:n,elements:c}=t,d=await(n.isRTL==null?void 0:n.isRTL(c.floating)),p=jp(r),a=dw(r),w=gg(r)==="y",E=["left","top"].includes(p)?-1:1,C=d&&w?-1:1,P=Tp(e,t);let{mainAxis:R,crossAxis:B,alignmentAxis:V}=typeof P=="number"?{mainAxis:P,crossAxis:0,alignmentAxis:null}:{mainAxis:P.mainAxis||0,crossAxis:P.crossAxis||0,alignmentAxis:P.alignmentAxis};return a&&typeof V=="number"&&(B=a==="end"?V*-1:V),w?{x:B*C,y:R*E}:{x:R*E,y:B*C}}const x0e=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:c,y:d,placement:p,middlewareData:a}=e,w=await y0e(e,t);return p===((r=a.offset)==null?void 0:r.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:c+w.x,y:d+w.y,data:{...w,placement:p}}}}},v0e=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:c}=e,{mainAxis:d=!0,crossAxis:p=!1,limiter:a={fn:K=>{let{x:Z,y:$}=K;return{x:Z,y:$}}},...w}=Tp(t,e),E={x:r,y:n},C=await GS(e,w),P=gg(jp(c)),R=H3(P);let B=E[R],V=E[P];if(d){const K=R==="y"?"top":"left",Z=R==="y"?"bottom":"right",$=B+C[K],X=B-C[Z];B=$D($,B,X)}if(p){const K=P==="y"?"top":"left",Z=P==="y"?"bottom":"right",$=V+C[K],X=V-C[Z];V=$D($,V,X)}const W=a.fn({...e,[R]:B,[P]:V});return{...W,data:{x:W.x-r,y:W.y-n,enabled:{[R]:d,[P]:p}}}}}},w0e=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:c,rects:d,middlewareData:p}=e,{offset:a=0,mainAxis:w=!0,crossAxis:E=!0}=Tp(t,e),C={x:r,y:n},P=gg(c),R=H3(P);let B=C[R],V=C[P];const W=Tp(a,e),K=typeof W=="number"?{mainAxis:W,crossAxis:0}:{mainAxis:0,crossAxis:0,...W};if(w){const X=R==="y"?"height":"width",Q=d.reference[R]-d.floating[X]+K.mainAxis,re=d.reference[R]+d.reference[X]-K.mainAxis;B<Q?B=Q:B>re&&(B=re)}if(E){var Z,$;const X=R==="y"?"width":"height",Q=["top","left"].includes(jp(c)),re=d.reference[P]-d.floating[X]+(Q&&((Z=p.offset)==null?void 0:Z[P])||0)+(Q?0:K.crossAxis),ve=d.reference[P]+d.reference[X]+(Q?0:(($=p.offset)==null?void 0:$[P])||0)-(Q?K.crossAxis:0);V<re?V=re:V>ve&&(V=ve)}return{[R]:B,[P]:V}}}},b0e=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,n;const{placement:c,rects:d,platform:p,elements:a}=e,{apply:w=()=>{},...E}=Tp(t,e),C=await GS(e,E),P=jp(c),R=dw(c),B=gg(c)==="y",{width:V,height:W}=d.floating;let K,Z;P==="top"||P==="bottom"?(K=P,Z=R===(await(p.isRTL==null?void 0:p.isRTL(a.floating))?"start":"end")?"left":"right"):(Z=P,K=R==="end"?"top":"bottom");const $=W-C.top-C.bottom,X=V-C.left-C.right,Q=pg(W-C[K],$),re=pg(V-C[Z],X),ve=!e.middlewareData.shift;let pe=Q,ue=re;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(ue=X),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(pe=$),ve&&!R){const ce=ju(C.left,0),Se=ju(C.right,0),le=ju(C.top,0),J=ju(C.bottom,0);B?ue=V-2*(ce!==0||Se!==0?ce+Se:ju(C.left,C.right)):pe=W-2*(le!==0||J!==0?le+J:ju(C.top,C.bottom))}await w({...e,availableWidth:ue,availableHeight:pe});const ge=await p.getDimensions(a.floating);return V!==ge.width||W!==ge.height?{reset:{rects:!0}}:{}}}};function ZC(){return typeof window<"u"}function hw(t){return PZ(t)?(t.nodeName||"").toLowerCase():"#document"}function Ru(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function mf(t){var e;return(e=(PZ(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function PZ(t){return ZC()?t instanceof Node||t instanceof Ru(t).Node:!1}function sh(t){return ZC()?t instanceof Element||t instanceof Ru(t).Element:!1}function lf(t){return ZC()?t instanceof HTMLElement||t instanceof Ru(t).HTMLElement:!1}function C8(t){return!ZC()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ru(t).ShadowRoot}function VE(t){const{overflow:e,overflowX:r,overflowY:n,display:c}=ih(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(c)}function S0e(t){return["table","td","th"].includes(hw(t))}function KC(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function K3(t){const e=X3(),r=sh(t)?ih(t):t;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function E0e(t){let e=_g(t);for(;lf(e)&&!R0(e);){if(K3(e))return e;if(KC(e))return null;e=_g(e)}return null}function X3(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function R0(t){return["html","body","#document"].includes(hw(t))}function ih(t){return Ru(t).getComputedStyle(t)}function XC(t){return sh(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function _g(t){if(hw(t)==="html")return t;const e=t.assignedSlot||t.parentNode||C8(t)&&t.host||mf(t);return C8(e)?e.host:e}function kZ(t){const e=_g(t);return R0(e)?t.ownerDocument?t.ownerDocument.body:t.body:lf(e)&&VE(e)?e:kZ(e)}function HS(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const c=kZ(t),d=c===((n=t.ownerDocument)==null?void 0:n.body),p=Ru(c);if(d){const a=GD(p);return e.concat(p,p.visualViewport||[],VE(c)?c:[],a&&r?HS(a):[])}return e.concat(c,HS(c,[],r))}function GD(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function RZ(t){const e=ih(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const c=lf(t),d=c?t.offsetWidth:r,p=c?t.offsetHeight:n,a=lI(r)!==d||lI(n)!==p;return a&&(r=d,n=p),{width:r,height:n,$:a}}function Y3(t){return sh(t)?t:t.contextElement}function i0(t){const e=Y3(t);if(!lf(e))return mg(1);const r=e.getBoundingClientRect(),{width:n,height:c,$:d}=RZ(e);let p=(d?lI(r.width):r.width)/n,a=(d?lI(r.height):r.height)/c;return(!p||!Number.isFinite(p))&&(p=1),(!a||!Number.isFinite(a))&&(a=1),{x:p,y:a}}const T0e=mg(0);function MZ(t){const e=Ru(t);return!X3()||!e.visualViewport?T0e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function j0e(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==Ru(t)?!1:e}function by(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const c=t.getBoundingClientRect(),d=Y3(t);let p=mg(1);e&&(n?sh(n)&&(p=i0(n)):p=i0(t));const a=j0e(d,r,n)?MZ(d):mg(0);let w=(c.left+a.x)/p.x,E=(c.top+a.y)/p.y,C=c.width/p.x,P=c.height/p.y;if(d){const R=Ru(d),B=n&&sh(n)?Ru(n):n;let V=R,W=GD(V);for(;W&&n&&B!==V;){const K=i0(W),Z=W.getBoundingClientRect(),$=ih(W),X=Z.left+(W.clientLeft+parseFloat($.paddingLeft))*K.x,Q=Z.top+(W.clientTop+parseFloat($.paddingTop))*K.y;w*=K.x,E*=K.y,C*=K.x,P*=K.y,w+=X,E+=Q,V=Ru(W),W=GD(V)}}return uI({width:C,height:P,x:w,y:E})}function N0e(t){let{elements:e,rect:r,offsetParent:n,strategy:c}=t;const d=c==="fixed",p=mf(n),a=e?KC(e.floating):!1;if(n===p||a&&d)return r;let w={scrollLeft:0,scrollTop:0},E=mg(1);const C=mg(0),P=lf(n);if((P||!P&&!d)&&((hw(n)!=="body"||VE(p))&&(w=XC(n)),lf(n))){const R=by(n);E=i0(n),C.x=R.x+n.clientLeft,C.y=R.y+n.clientTop}return{width:r.width*E.x,height:r.height*E.y,x:r.x*E.x-w.scrollLeft*E.x+C.x,y:r.y*E.y-w.scrollTop*E.y+C.y}}function I0e(t){return Array.from(t.getClientRects())}function HD(t,e){const r=XC(t).scrollLeft;return e?e.left+r:by(mf(t)).left+r}function C0e(t){const e=mf(t),r=XC(t),n=t.ownerDocument.body,c=ju(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),d=ju(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let p=-r.scrollLeft+HD(t);const a=-r.scrollTop;return ih(n).direction==="rtl"&&(p+=ju(e.clientWidth,n.clientWidth)-c),{width:c,height:d,x:p,y:a}}function A0e(t,e){const r=Ru(t),n=mf(t),c=r.visualViewport;let d=n.clientWidth,p=n.clientHeight,a=0,w=0;if(c){d=c.width,p=c.height;const E=X3();(!E||E&&e==="fixed")&&(a=c.offsetLeft,w=c.offsetTop)}return{width:d,height:p,x:a,y:w}}function P0e(t,e){const r=by(t,!0,e==="fixed"),n=r.top+t.clientTop,c=r.left+t.clientLeft,d=lf(t)?i0(t):mg(1),p=t.clientWidth*d.x,a=t.clientHeight*d.y,w=c*d.x,E=n*d.y;return{width:p,height:a,x:w,y:E}}function A8(t,e,r){let n;if(e==="viewport")n=A0e(t,r);else if(e==="document")n=C0e(mf(t));else if(sh(e))n=P0e(e,r);else{const c=MZ(t);n={...e,x:e.x-c.x,y:e.y-c.y}}return uI(n)}function DZ(t,e){const r=_g(t);return r===e||!sh(r)||R0(r)?!1:ih(r).position==="fixed"||DZ(r,e)}function k0e(t,e){const r=e.get(t);if(r)return r;let n=HS(t,[],!1).filter(a=>sh(a)&&hw(a)!=="body"),c=null;const d=ih(t).position==="fixed";let p=d?_g(t):t;for(;sh(p)&&!R0(p);){const a=ih(p),w=K3(p);!w&&a.position==="fixed"&&(c=null),(d?!w&&!c:!w&&a.position==="static"&&!!c&&["absolute","fixed"].includes(c.position)||VE(p)&&!w&&DZ(t,p))?n=n.filter(C=>C!==p):c=a,p=_g(p)}return e.set(t,n),n}function R0e(t){let{element:e,boundary:r,rootBoundary:n,strategy:c}=t;const p=[...r==="clippingAncestors"?KC(e)?[]:k0e(e,this._c):[].concat(r),n],a=p[0],w=p.reduce((E,C)=>{const P=A8(e,C,c);return E.top=ju(P.top,E.top),E.right=pg(P.right,E.right),E.bottom=pg(P.bottom,E.bottom),E.left=ju(P.left,E.left),E},A8(e,a,c));return{width:w.right-w.left,height:w.bottom-w.top,x:w.left,y:w.top}}function M0e(t){const{width:e,height:r}=RZ(t);return{width:e,height:r}}function D0e(t,e,r){const n=lf(e),c=mf(e),d=r==="fixed",p=by(t,!0,d,e);let a={scrollLeft:0,scrollTop:0};const w=mg(0);if(n||!n&&!d)if((hw(e)!=="body"||VE(c))&&(a=XC(e)),n){const B=by(e,!0,d,e);w.x=B.x+e.clientLeft,w.y=B.y+e.clientTop}else c&&(w.x=HD(c));let E=0,C=0;if(c&&!n&&!d){const B=c.getBoundingClientRect();C=B.top+a.scrollTop,E=B.left+a.scrollLeft-HD(c,B)}const P=p.left+a.scrollLeft-w.x-E,R=p.top+a.scrollTop-w.y-C;return{x:P,y:R,width:p.width,height:p.height}}function CR(t){return ih(t).position==="static"}function P8(t,e){if(!lf(t)||ih(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return mf(t)===r&&(r=r.ownerDocument.body),r}function OZ(t,e){const r=Ru(t);if(KC(t))return r;if(!lf(t)){let c=_g(t);for(;c&&!R0(c);){if(sh(c)&&!CR(c))return c;c=_g(c)}return r}let n=P8(t,e);for(;n&&S0e(n)&&CR(n);)n=P8(n,e);return n&&R0(n)&&CR(n)&&!K3(n)?r:n||E0e(t)||r}const O0e=async function(t){const e=this.getOffsetParent||OZ,r=this.getDimensions,n=await r(t.floating);return{reference:D0e(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function L0e(t){return ih(t).direction==="rtl"}const F0e={convertOffsetParentRelativeRectToViewportRelativeRect:N0e,getDocumentElement:mf,getClippingRect:R0e,getOffsetParent:OZ,getElementRects:O0e,getClientRects:I0e,getDimensions:M0e,getScale:i0,isElement:sh,isRTL:L0e};function z0e(t,e){let r=null,n;const c=mf(t);function d(){var a;clearTimeout(n),(a=r)==null||a.disconnect(),r=null}function p(a,w){a===void 0&&(a=!1),w===void 0&&(w=1),d();const{left:E,top:C,width:P,height:R}=t.getBoundingClientRect();if(a||e(),!P||!R)return;const B=gj(C),V=gj(c.clientWidth-(E+P)),W=gj(c.clientHeight-(C+R)),K=gj(E),$={rootMargin:-B+"px "+-V+"px "+-W+"px "+-K+"px",threshold:ju(0,pg(1,w))||1};let X=!0;function Q(re){const ve=re[0].intersectionRatio;if(ve!==w){if(!X)return p();ve?p(!1,ve):n=setTimeout(()=>{p(!1,1e-7)},1e3)}X=!1}try{r=new IntersectionObserver(Q,{...$,root:c.ownerDocument})}catch{r=new IntersectionObserver(Q,$)}r.observe(t)}return p(!0),d}function B0e(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:c=!0,ancestorResize:d=!0,elementResize:p=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:w=!1}=n,E=Y3(t),C=c||d?[...E?HS(E):[],...HS(e)]:[];C.forEach(Z=>{c&&Z.addEventListener("scroll",r,{passive:!0}),d&&Z.addEventListener("resize",r)});const P=E&&a?z0e(E,r):null;let R=-1,B=null;p&&(B=new ResizeObserver(Z=>{let[$]=Z;$&&$.target===E&&B&&(B.unobserve(e),cancelAnimationFrame(R),R=requestAnimationFrame(()=>{var X;(X=B)==null||X.observe(e)})),r()}),E&&!w&&B.observe(E),B.observe(e));let V,W=w?by(t):null;w&&K();function K(){const Z=by(t);W&&(Z.x!==W.x||Z.y!==W.y||Z.width!==W.width||Z.height!==W.height)&&r(),W=Z,V=requestAnimationFrame(K)}return r(),()=>{var Z;C.forEach($=>{c&&$.removeEventListener("scroll",r),d&&$.removeEventListener("resize",r)}),P==null||P(),(Z=B)==null||Z.disconnect(),B=null,w&&cancelAnimationFrame(V)}}const V0e=x0e,U0e=v0e,$0e=g0e,q0e=b0e,G0e=_0e,k8=m0e,H0e=w0e,W0e=(t,e,r)=>{const n=new Map,c={platform:F0e,...r},d={...c.platform,_c:n};return p0e(t,e,{...c,platform:d})};var tN=typeof document<"u"?z.useLayoutEffect:z.useEffect;function dI(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,c;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!dI(t[n],e[n]))return!1;return!0}if(c=Object.keys(t),r=c.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,c[n]))return!1;for(n=r;n--!==0;){const d=c[n];if(!(d==="_owner"&&t.$$typeof)&&!dI(t[d],e[d]))return!1}return!0}return t!==t&&e!==e}function LZ(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function R8(t,e){const r=LZ(t);return Math.round(e*r)/r}function AR(t){const e=z.useRef(t);return tN(()=>{e.current=t}),e}function Z0e(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:c,elements:{reference:d,floating:p}={},transform:a=!0,whileElementsMounted:w,open:E}=t,[C,P]=z.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[R,B]=z.useState(n);dI(R,n)||B(n);const[V,W]=z.useState(null),[K,Z]=z.useState(null),$=z.useCallback($e=>{$e!==ve.current&&(ve.current=$e,W($e))},[]),X=z.useCallback($e=>{$e!==pe.current&&(pe.current=$e,Z($e))},[]),Q=d||V,re=p||K,ve=z.useRef(null),pe=z.useRef(null),ue=z.useRef(C),ge=w!=null,ce=AR(w),Se=AR(c),le=AR(E),J=z.useCallback(()=>{if(!ve.current||!pe.current)return;const $e={placement:e,strategy:r,middleware:R};Se.current&&($e.platform=Se.current),W0e(ve.current,pe.current,$e).then(st=>{const it={...st,isPositioned:le.current!==!1};ke.current&&!dI(ue.current,it)&&(ue.current=it,Y0.flushSync(()=>{P(it)}))})},[R,e,r,Se,le]);tN(()=>{E===!1&&ue.current.isPositioned&&(ue.current.isPositioned=!1,P($e=>({...$e,isPositioned:!1})))},[E]);const ke=z.useRef(!1);tN(()=>(ke.current=!0,()=>{ke.current=!1}),[]),tN(()=>{if(Q&&(ve.current=Q),re&&(pe.current=re),Q&&re){if(ce.current)return ce.current(Q,re,J);J()}},[Q,re,J,ce,ge]);const Ze=z.useMemo(()=>({reference:ve,floating:pe,setReference:$,setFloating:X}),[$,X]),Xe=z.useMemo(()=>({reference:Q,floating:re}),[Q,re]),qe=z.useMemo(()=>{const $e={position:r,left:0,top:0};if(!Xe.floating)return $e;const st=R8(Xe.floating,C.x),it=R8(Xe.floating,C.y);return a?{...$e,transform:"translate("+st+"px, "+it+"px)",...LZ(Xe.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:st,top:it}},[r,a,Xe.floating,C.x,C.y]);return z.useMemo(()=>({...C,update:J,refs:Ze,elements:Xe,floatingStyles:qe}),[C,J,Ze,Xe,qe])}const K0e=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:c}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?k8({element:n.current,padding:c}).fn(r):{}:n?k8({element:n,padding:c}).fn(r):{}}}},X0e=(t,e)=>({...V0e(t),options:[t,e]}),Y0e=(t,e)=>({...U0e(t),options:[t,e]}),J0e=(t,e)=>({...H0e(t),options:[t,e]}),Q0e=(t,e)=>({...$0e(t),options:[t,e]}),ewe=(t,e)=>({...q0e(t),options:[t,e]}),twe=(t,e)=>({...G0e(t),options:[t,e]}),rwe=(t,e)=>({...K0e(t),options:[t,e]});var nwe="Arrow",FZ=z.forwardRef((t,e)=>{const{children:r,width:n=10,height:c=5,...d}=t;return i.jsx(Pn.svg,{...d,ref:e,width:n,height:c,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:i.jsx("polygon",{points:"0,0 30,0 15,10"})})});FZ.displayName=nwe;var swe=FZ;function iwe(t,e=[]){let r=[];function n(d,p){const a=z.createContext(p),w=r.length;r=[...r,p];function E(P){const{scope:R,children:B,...V}=P,W=(R==null?void 0:R[t][w])||a,K=z.useMemo(()=>V,Object.values(V));return i.jsx(W.Provider,{value:K,children:B})}function C(P,R){const B=(R==null?void 0:R[t][w])||a,V=z.useContext(B);if(V)return V;if(p!==void 0)return p;throw new Error(`\`${P}\` must be used within \`${d}\``)}return E.displayName=d+"Provider",[E,C]}const c=()=>{const d=r.map(p=>z.createContext(p));return function(a){const w=(a==null?void 0:a[t])||d;return z.useMemo(()=>({[`__scope${t}`]:{...a,[t]:w}}),[a,w])}};return c.scopeName=t,[n,awe(c,...e)]}function awe(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const p=n.reduce((a,{useScope:w,scopeName:E})=>{const P=w(d)[`__scope${E}`];return{...a,...P}},{});return z.useMemo(()=>({[`__scope${e.scopeName}`]:p}),[p])}};return r.scopeName=e.scopeName,r}function J3(t){const[e,r]=z.useState(void 0);return Jo(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(c=>{if(!Array.isArray(c)||!c.length)return;const d=c[0];let p,a;if("borderBoxSize"in d){const w=d.borderBoxSize,E=Array.isArray(w)?w[0]:w;p=E.inlineSize,a=E.blockSize}else p=t.offsetWidth,a=t.offsetHeight;r({width:p,height:a})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e}var Q3="Popper",[zZ,fw]=iwe(Q3),[owe,BZ]=zZ(Q3),VZ=t=>{const{__scopePopper:e,children:r}=t,[n,c]=z.useState(null);return i.jsx(owe,{scope:e,anchor:n,onAnchorChange:c,children:r})};VZ.displayName=Q3;var UZ="PopperAnchor",$Z=z.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...c}=t,d=BZ(UZ,r),p=z.useRef(null),a=Fs(e,p);return z.useEffect(()=>{d.onAnchorChange((n==null?void 0:n.current)||p.current)}),n?null:i.jsx(Pn.div,{...c,ref:a})});$Z.displayName=UZ;var e4="PopperContent",[lwe,cwe]=zZ(e4),qZ=z.forwardRef((t,e)=>{var Wt,Wr,jr,Br,on,Zn;const{__scopePopper:r,side:n="bottom",sideOffset:c=0,align:d="center",alignOffset:p=0,arrowPadding:a=0,avoidCollisions:w=!0,collisionBoundary:E=[],collisionPadding:C=0,sticky:P="partial",hideWhenDetached:R=!1,updatePositionStrategy:B="optimized",onPlaced:V,...W}=t,K=BZ(e4,r),[Z,$]=z.useState(null),X=Fs(e,ln=>$(ln)),[Q,re]=z.useState(null),ve=J3(Q),pe=(ve==null?void 0:ve.width)??0,ue=(ve==null?void 0:ve.height)??0,ge=n+(d!=="center"?"-"+d:""),ce=typeof C=="number"?C:{top:0,right:0,bottom:0,left:0,...C},Se=Array.isArray(E)?E:[E],le=Se.length>0,J={padding:ce,boundary:Se.filter(dwe),altBoundary:le},{refs:ke,floatingStyles:Ze,placement:Xe,isPositioned:qe,middlewareData:$e}=Z0e({strategy:"fixed",placement:ge,whileElementsMounted:(...ln)=>B0e(...ln,{animationFrame:B==="always"}),elements:{reference:K.anchor},middleware:[X0e({mainAxis:c+ue,alignmentAxis:p}),w&&Y0e({mainAxis:!0,crossAxis:!1,limiter:P==="partial"?J0e():void 0,...J}),w&&Q0e({...J}),ewe({...J,apply:({elements:ln,rects:dr,availableWidth:Vr,availableHeight:nn})=>{const{width:Ln,height:Je}=dr.reference,xt=ln.floating.style;xt.setProperty("--radix-popper-available-width",`${Vr}px`),xt.setProperty("--radix-popper-available-height",`${nn}px`),xt.setProperty("--radix-popper-anchor-width",`${Ln}px`),xt.setProperty("--radix-popper-anchor-height",`${Je}px`)}}),Q&&rwe({element:Q,padding:a}),hwe({arrowWidth:pe,arrowHeight:ue}),R&&twe({strategy:"referenceHidden",...J})]}),[st,it]=WZ(Xe),Mt=Do(V);Jo(()=>{qe&&(Mt==null||Mt())},[qe,Mt]);const ar=(Wt=$e.arrow)==null?void 0:Wt.x,St=(Wr=$e.arrow)==null?void 0:Wr.y,Xt=((jr=$e.arrow)==null?void 0:jr.centerOffset)!==0,[dt,ft]=z.useState();return Jo(()=>{Z&&ft(window.getComputedStyle(Z).zIndex)},[Z]),i.jsx("div",{ref:ke.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ze,transform:qe?Ze.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:dt,"--radix-popper-transform-origin":[(Br=$e.transformOrigin)==null?void 0:Br.x,(on=$e.transformOrigin)==null?void 0:on.y].join(" "),...((Zn=$e.hide)==null?void 0:Zn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:i.jsx(lwe,{scope:r,placedSide:st,onArrowChange:re,arrowX:ar,arrowY:St,shouldHideArrow:Xt,children:i.jsx(Pn.div,{"data-side":st,"data-align":it,...W,ref:X,style:{...W.style,animation:qe?void 0:"none"}})})})});qZ.displayName=e4;var GZ="PopperArrow",uwe={top:"bottom",right:"left",bottom:"top",left:"right"},HZ=z.forwardRef(function(e,r){const{__scopePopper:n,...c}=e,d=cwe(GZ,n),p=uwe[d.placedSide];return i.jsx("span",{ref:d.onArrowChange,style:{position:"absolute",left:d.arrowX,top:d.arrowY,[p]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[d.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[d.placedSide],visibility:d.shouldHideArrow?"hidden":void 0},children:i.jsx(swe,{...c,ref:r,style:{...c.style,display:"block"}})})});HZ.displayName=GZ;function dwe(t){return t!==null}var hwe=t=>({name:"transformOrigin",options:t,fn(e){var K,Z,$;const{placement:r,rects:n,middlewareData:c}=e,p=((K=c.arrow)==null?void 0:K.centerOffset)!==0,a=p?0:t.arrowWidth,w=p?0:t.arrowHeight,[E,C]=WZ(r),P={start:"0%",center:"50%",end:"100%"}[C],R=(((Z=c.arrow)==null?void 0:Z.x)??0)+a/2,B=((($=c.arrow)==null?void 0:$.y)??0)+w/2;let V="",W="";return E==="bottom"?(V=p?P:`${R}px`,W=`${-w}px`):E==="top"?(V=p?P:`${R}px`,W=`${n.floating.height+w}px`):E==="right"?(V=`${-w}px`,W=p?P:`${B}px`):E==="left"&&(V=`${n.floating.width+w}px`,W=p?P:`${B}px`),{data:{x:V,y:W}}}});function WZ(t){const[e,r="center"]=t.split("-");return[e,r]}var t4=VZ,YC=$Z,r4=qZ,n4=HZ,fwe="Portal",UE=z.forwardRef((t,e)=>{var a;const{container:r,...n}=t,[c,d]=z.useState(!1);Jo(()=>d(!0),[]);const p=r||c&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return p?Loe.createPortal(i.jsx(Pn.div,{...n,ref:e}),p):null});UE.displayName=fwe;function pwe(t,e){return z.useReducer((r,n)=>e[r][n]??r,t)}var Xl=t=>{const{present:e,children:r}=t,n=mwe(e),c=typeof r=="function"?r({present:n.isPresent}):z.Children.only(r),d=Fs(n.ref,gwe(c));return typeof r=="function"||n.isPresent?z.cloneElement(c,{ref:d}):null};Xl.displayName="Presence";function mwe(t){const[e,r]=z.useState(),n=z.useRef({}),c=z.useRef(t),d=z.useRef("none"),p=t?"mounted":"unmounted",[a,w]=pwe(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return z.useEffect(()=>{const E=_j(n.current);d.current=a==="mounted"?E:"none"},[a]),Jo(()=>{const E=n.current,C=c.current;if(C!==t){const R=d.current,B=_j(E);t?w("MOUNT"):B==="none"||(E==null?void 0:E.display)==="none"?w("UNMOUNT"):w(C&&R!==B?"ANIMATION_OUT":"UNMOUNT"),c.current=t}},[t,w]),Jo(()=>{if(e){let E;const C=e.ownerDocument.defaultView??window,P=B=>{const W=_j(n.current).includes(B.animationName);if(B.target===e&&W&&(w("ANIMATION_END"),!c.current)){const K=e.style.animationFillMode;e.style.animationFillMode="forwards",E=C.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=K)})}},R=B=>{B.target===e&&(d.current=_j(n.current))};return e.addEventListener("animationstart",R),e.addEventListener("animationcancel",P),e.addEventListener("animationend",P),()=>{C.clearTimeout(E),e.removeEventListener("animationstart",R),e.removeEventListener("animationcancel",P),e.removeEventListener("animationend",P)}}else w("ANIMATION_END")},[e,w]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:z.useCallback(E=>{E&&(n.current=getComputedStyle(E)),r(E)},[])}}function _j(t){return(t==null?void 0:t.animationName)||"none"}function gwe(t){var n,c;let e=(n=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:n.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=(c=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:c.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function _we(t,e=[]){let r=[];function n(d,p){const a=z.createContext(p),w=r.length;r=[...r,p];function E(P){const{scope:R,children:B,...V}=P,W=(R==null?void 0:R[t][w])||a,K=z.useMemo(()=>V,Object.values(V));return i.jsx(W.Provider,{value:K,children:B})}function C(P,R){const B=(R==null?void 0:R[t][w])||a,V=z.useContext(B);if(V)return V;if(p!==void 0)return p;throw new Error(`\`${P}\` must be used within \`${d}\``)}return E.displayName=d+"Provider",[E,C]}const c=()=>{const d=r.map(p=>z.createContext(p));return function(a){const w=(a==null?void 0:a[t])||d;return z.useMemo(()=>({[`__scope${t}`]:{...a,[t]:w}}),[a,w])}};return c.scopeName=t,[n,ywe(c,...e)]}function ywe(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const p=n.reduce((a,{useScope:w,scopeName:E})=>{const P=w(d)[`__scope${E}`];return{...a,...P}},{});return z.useMemo(()=>({[`__scope${e.scopeName}`]:p}),[p])}};return r.scopeName=e.scopeName,r}var PR="rovingFocusGroup.onEntryFocus",xwe={bubbles:!1,cancelable:!0},JC="RovingFocusGroup",[WD,ZZ,vwe]=FE(JC),[wwe,QC]=_we(JC,[vwe]),[bwe,Swe]=wwe(JC),KZ=z.forwardRef((t,e)=>i.jsx(WD.Provider,{scope:t.__scopeRovingFocusGroup,children:i.jsx(WD.Slot,{scope:t.__scopeRovingFocusGroup,children:i.jsx(Ewe,{...t,ref:e})})}));KZ.displayName=JC;var Ewe=z.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:c=!1,dir:d,currentTabStopId:p,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:w,onEntryFocus:E,preventScrollOnEntryFocus:C=!1,...P}=t,R=z.useRef(null),B=Fs(e,R),V=Fy(d),[W=null,K]=ud({prop:p,defaultProp:a,onChange:w}),[Z,$]=z.useState(!1),X=Do(E),Q=ZZ(r),re=z.useRef(!1),[ve,pe]=z.useState(0);return z.useEffect(()=>{const ue=R.current;if(ue)return ue.addEventListener(PR,X),()=>ue.removeEventListener(PR,X)},[X]),i.jsx(bwe,{scope:r,orientation:n,dir:V,loop:c,currentTabStopId:W,onItemFocus:z.useCallback(ue=>K(ue),[K]),onItemShiftTab:z.useCallback(()=>$(!0),[]),onFocusableItemAdd:z.useCallback(()=>pe(ue=>ue+1),[]),onFocusableItemRemove:z.useCallback(()=>pe(ue=>ue-1),[]),children:i.jsx(Pn.div,{tabIndex:Z||ve===0?-1:0,"data-orientation":n,...P,ref:B,style:{outline:"none",...t.style},onMouseDown:tn(t.onMouseDown,()=>{re.current=!0}),onFocus:tn(t.onFocus,ue=>{const ge=!re.current;if(ue.target===ue.currentTarget&&ge&&!Z){const ce=new CustomEvent(PR,xwe);if(ue.currentTarget.dispatchEvent(ce),!ce.defaultPrevented){const Se=Q().filter(Xe=>Xe.focusable),le=Se.find(Xe=>Xe.active),J=Se.find(Xe=>Xe.id===W),Ze=[le,J,...Se].filter(Boolean).map(Xe=>Xe.ref.current);JZ(Ze,C)}}re.current=!1}),onBlur:tn(t.onBlur,()=>$(!1))})})}),XZ="RovingFocusGroupItem",YZ=z.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:c=!1,tabStopId:d,...p}=t,a=ku(),w=d||a,E=Swe(XZ,r),C=E.currentTabStopId===w,P=ZZ(r),{onFocusableItemAdd:R,onFocusableItemRemove:B}=E;return z.useEffect(()=>{if(n)return R(),()=>B()},[n,R,B]),i.jsx(WD.ItemSlot,{scope:r,id:w,focusable:n,active:c,children:i.jsx(Pn.span,{tabIndex:C?0:-1,"data-orientation":E.orientation,...p,ref:e,onMouseDown:tn(t.onMouseDown,V=>{n?E.onItemFocus(w):V.preventDefault()}),onFocus:tn(t.onFocus,()=>E.onItemFocus(w)),onKeyDown:tn(t.onKeyDown,V=>{if(V.key==="Tab"&&V.shiftKey){E.onItemShiftTab();return}if(V.target!==V.currentTarget)return;const W=Nwe(V,E.orientation,E.dir);if(W!==void 0){if(V.metaKey||V.ctrlKey||V.altKey||V.shiftKey)return;V.preventDefault();let Z=P().filter($=>$.focusable).map($=>$.ref.current);if(W==="last")Z.reverse();else if(W==="prev"||W==="next"){W==="prev"&&Z.reverse();const $=Z.indexOf(V.currentTarget);Z=E.loop?Iwe(Z,$+1):Z.slice($+1)}setTimeout(()=>JZ(Z))}})})})});YZ.displayName=XZ;var Twe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function jwe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Nwe(t,e,r){const n=jwe(t.key,r);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return Twe[n]}function JZ(t,e=!1){const r=document.activeElement;for(const n of t)if(n===r||(n.focus({preventScroll:e}),document.activeElement!==r))return}function Iwe(t,e){return t.map((r,n)=>t[(e+n)%t.length])}var QZ=KZ,eK=YZ,Cwe=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},hv=new WeakMap,yj=new WeakMap,xj={},kR=0,tK=function(t){return t&&(t.host||tK(t.parentNode))},Awe=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=tK(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},Pwe=function(t,e,r,n){var c=Awe(e,Array.isArray(t)?t:[t]);xj[r]||(xj[r]=new WeakMap);var d=xj[r],p=[],a=new Set,w=new Set(c),E=function(P){!P||a.has(P)||(a.add(P),E(P.parentNode))};c.forEach(E);var C=function(P){!P||w.has(P)||Array.prototype.forEach.call(P.children,function(R){if(a.has(R))C(R);else try{var B=R.getAttribute(n),V=B!==null&&B!=="false",W=(hv.get(R)||0)+1,K=(d.get(R)||0)+1;hv.set(R,W),d.set(R,K),p.push(R),W===1&&V&&yj.set(R,!0),K===1&&R.setAttribute(r,"true"),V||R.setAttribute(n,"true")}catch(Z){console.error("aria-hidden: cannot operate on ",R,Z)}})};return C(e),a.clear(),kR++,function(){p.forEach(function(P){var R=hv.get(P)-1,B=d.get(P)-1;hv.set(P,R),d.set(P,B),R||(yj.has(P)||P.removeAttribute(n),yj.delete(P)),B||P.removeAttribute(r)}),kR--,kR||(hv=new WeakMap,hv=new WeakMap,yj=new WeakMap,xj={})}},eA=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),c=Cwe(t);return c?(n.push.apply(n,Array.from(c.querySelectorAll("[aria-live]"))),Pwe(n,c,r,"aria-hidden")):function(){return null}},rN="right-scroll-bar-position",nN="width-before-scroll-bar",kwe="with-scroll-bars-hidden",Rwe="--removed-body-scroll-bar-size";function RR(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Mwe(t,e){var r=z.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var c=r.value;c!==n&&(r.value=n,r.callback(n,c))}}}})[0];return r.callback=e,r.facade}var Dwe=typeof window<"u"?z.useLayoutEffect:z.useEffect,M8=new WeakMap;function Owe(t,e){var r=Mwe(null,function(n){return t.forEach(function(c){return RR(c,n)})});return Dwe(function(){var n=M8.get(r);if(n){var c=new Set(n),d=new Set(t),p=r.current;c.forEach(function(a){d.has(a)||RR(a,null)}),d.forEach(function(a){c.has(a)||RR(a,p)})}M8.set(r,t)},[t]),r}function Lwe(t){return t}function Fwe(t,e){e===void 0&&(e=Lwe);var r=[],n=!1,c={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(d){var p=e(d,n);return r.push(p),function(){r=r.filter(function(a){return a!==p})}},assignSyncMedium:function(d){for(n=!0;r.length;){var p=r;r=[],p.forEach(d)}r={push:function(a){return d(a)},filter:function(){return r}}},assignMedium:function(d){n=!0;var p=[];if(r.length){var a=r;r=[],a.forEach(d),p=r}var w=function(){var C=p;p=[],C.forEach(d)},E=function(){return Promise.resolve().then(w)};E(),r={push:function(C){p.push(C),E()},filter:function(C){return p=p.filter(C),r}}}};return c}function zwe(t){t===void 0&&(t={});var e=Fwe(null);return e.options=qh({async:!0,ssr:!1},t),e}var rK=function(t){var e=t.sideCar,r=bE(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return z.createElement(n,qh({},r))};rK.isSideCarExport=!0;function Bwe(t,e){return t.useMedium(e),rK}var nK=zwe(),MR=function(){},tA=z.forwardRef(function(t,e){var r=z.useRef(null),n=z.useState({onScrollCapture:MR,onWheelCapture:MR,onTouchMoveCapture:MR}),c=n[0],d=n[1],p=t.forwardProps,a=t.children,w=t.className,E=t.removeScrollBar,C=t.enabled,P=t.shards,R=t.sideCar,B=t.noIsolation,V=t.inert,W=t.allowPinchZoom,K=t.as,Z=K===void 0?"div":K,$=t.gapMode,X=bE(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),Q=R,re=Owe([r,e]),ve=qh(qh({},X),c);return z.createElement(z.Fragment,null,C&&z.createElement(Q,{sideCar:nK,removeScrollBar:E,shards:P,noIsolation:B,inert:V,setCallbacks:d,allowPinchZoom:!!W,lockRef:r,gapMode:$}),p?z.cloneElement(z.Children.only(a),qh(qh({},ve),{ref:re})):z.createElement(Z,qh({},ve,{className:w,ref:re}),a))});tA.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};tA.classNames={fullWidth:nN,zeroRight:rN};var Vwe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Uwe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Vwe();return e&&t.setAttribute("nonce",e),t}function $we(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function qwe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Gwe=function(){var t=0,e=null;return{add:function(r){t==0&&(e=Uwe())&&($we(e,r),qwe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Hwe=function(){var t=Gwe();return function(e,r){z.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},sK=function(){var t=Hwe(),e=function(r){var n=r.styles,c=r.dynamic;return t(n,c),null};return e},Wwe={left:0,top:0,right:0,gap:0},DR=function(t){return parseInt(t||"",10)||0},Zwe=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],c=e[t==="padding"?"paddingRight":"marginRight"];return[DR(r),DR(n),DR(c)]},Kwe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Wwe;var e=Zwe(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},Xwe=sK(),a0="data-scroll-locked",Ywe=function(t,e,r,n){var c=t.left,d=t.top,p=t.right,a=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(kwe,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(a0,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(c,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(rN,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(nN,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(rN," .").concat(rN,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(nN," .").concat(nN,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(a0,`] {
    `).concat(Rwe,": ").concat(a,`px;
  }
`)},D8=function(){var t=parseInt(document.body.getAttribute(a0)||"0",10);return isFinite(t)?t:0},Jwe=function(){z.useEffect(function(){return document.body.setAttribute(a0,(D8()+1).toString()),function(){var t=D8()-1;t<=0?document.body.removeAttribute(a0):document.body.setAttribute(a0,t.toString())}},[])},Qwe=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,c=n===void 0?"margin":n;Jwe();var d=z.useMemo(function(){return Kwe(c)},[c]);return z.createElement(Xwe,{styles:Ywe(d,!e,c,r?"":"!important")})},ZD=!1;if(typeof window<"u")try{var vj=Object.defineProperty({},"passive",{get:function(){return ZD=!0,!0}});window.addEventListener("test",vj,vj),window.removeEventListener("test",vj,vj)}catch{ZD=!1}var fv=ZD?{passive:!1}:!1,ebe=function(t){return t.tagName==="TEXTAREA"},iK=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!ebe(t)&&r[e]==="visible")},tbe=function(t){return iK(t,"overflowY")},rbe=function(t){return iK(t,"overflowX")},O8=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var c=aK(t,n);if(c){var d=oK(t,n),p=d[1],a=d[2];if(p>a)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},nbe=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},sbe=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},aK=function(t,e){return t==="v"?tbe(e):rbe(e)},oK=function(t,e){return t==="v"?nbe(e):sbe(e)},ibe=function(t,e){return t==="h"&&e==="rtl"?-1:1},abe=function(t,e,r,n,c){var d=ibe(t,window.getComputedStyle(e).direction),p=d*n,a=r.target,w=e.contains(a),E=!1,C=p>0,P=0,R=0;do{var B=oK(t,a),V=B[0],W=B[1],K=B[2],Z=W-K-d*V;(V||Z)&&aK(t,a)&&(P+=Z,R+=V),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!w&&a!==document.body||w&&(e.contains(a)||e===a));return(C&&(Math.abs(P)<1||!c)||!C&&(Math.abs(R)<1||!c))&&(E=!0),E},wj=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},L8=function(t){return[t.deltaX,t.deltaY]},F8=function(t){return t&&"current"in t?t.current:t},obe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},lbe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},cbe=0,pv=[];function ube(t){var e=z.useRef([]),r=z.useRef([0,0]),n=z.useRef(),c=z.useState(cbe++)[0],d=z.useState(sK)[0],p=z.useRef(t);z.useEffect(function(){p.current=t},[t]),z.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(c));var W=vde([t.lockRef.current],(t.shards||[]).map(F8),!0).filter(Boolean);return W.forEach(function(K){return K.classList.add("allow-interactivity-".concat(c))}),function(){document.body.classList.remove("block-interactivity-".concat(c)),W.forEach(function(K){return K.classList.remove("allow-interactivity-".concat(c))})}}},[t.inert,t.lockRef.current,t.shards]);var a=z.useCallback(function(W,K){if("touches"in W&&W.touches.length===2||W.type==="wheel"&&W.ctrlKey)return!p.current.allowPinchZoom;var Z=wj(W),$=r.current,X="deltaX"in W?W.deltaX:$[0]-Z[0],Q="deltaY"in W?W.deltaY:$[1]-Z[1],re,ve=W.target,pe=Math.abs(X)>Math.abs(Q)?"h":"v";if("touches"in W&&pe==="h"&&ve.type==="range")return!1;var ue=O8(pe,ve);if(!ue)return!0;if(ue?re=pe:(re=pe==="v"?"h":"v",ue=O8(pe,ve)),!ue)return!1;if(!n.current&&"changedTouches"in W&&(X||Q)&&(n.current=re),!re)return!0;var ge=n.current||re;return abe(ge,K,W,ge==="h"?X:Q,!0)},[]),w=z.useCallback(function(W){var K=W;if(!(!pv.length||pv[pv.length-1]!==d)){var Z="deltaY"in K?L8(K):wj(K),$=e.current.filter(function(re){return re.name===K.type&&(re.target===K.target||K.target===re.shadowParent)&&obe(re.delta,Z)})[0];if($&&$.should){K.cancelable&&K.preventDefault();return}if(!$){var X=(p.current.shards||[]).map(F8).filter(Boolean).filter(function(re){return re.contains(K.target)}),Q=X.length>0?a(K,X[0]):!p.current.noIsolation;Q&&K.cancelable&&K.preventDefault()}}},[]),E=z.useCallback(function(W,K,Z,$){var X={name:W,delta:K,target:Z,should:$,shadowParent:dbe(Z)};e.current.push(X),setTimeout(function(){e.current=e.current.filter(function(Q){return Q!==X})},1)},[]),C=z.useCallback(function(W){r.current=wj(W),n.current=void 0},[]),P=z.useCallback(function(W){E(W.type,L8(W),W.target,a(W,t.lockRef.current))},[]),R=z.useCallback(function(W){E(W.type,wj(W),W.target,a(W,t.lockRef.current))},[]);z.useEffect(function(){return pv.push(d),t.setCallbacks({onScrollCapture:P,onWheelCapture:P,onTouchMoveCapture:R}),document.addEventListener("wheel",w,fv),document.addEventListener("touchmove",w,fv),document.addEventListener("touchstart",C,fv),function(){pv=pv.filter(function(W){return W!==d}),document.removeEventListener("wheel",w,fv),document.removeEventListener("touchmove",w,fv),document.removeEventListener("touchstart",C,fv)}},[]);var B=t.removeScrollBar,V=t.inert;return z.createElement(z.Fragment,null,V?z.createElement(d,{styles:lbe(c)}):null,B?z.createElement(Qwe,{gapMode:t.gapMode}):null)}function dbe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const hbe=Bwe(nK,ube);var $E=z.forwardRef(function(t,e){return z.createElement(tA,qh({},t,{ref:e,sideCar:hbe}))});$E.classNames=tA.classNames;var KD=["Enter"," "],fbe=["ArrowDown","PageUp","Home"],lK=["ArrowUp","PageDown","End"],pbe=[...fbe,...lK],mbe={ltr:[...KD,"ArrowRight"],rtl:[...KD,"ArrowLeft"]},gbe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},qE="Menu",[WS,_be,ybe]=FE(qE),[zy,cK]=hd(qE,[ybe,fw,QC]),rA=fw(),uK=QC(),[xbe,By]=zy(qE),[vbe,GE]=zy(qE),dK=t=>{const{__scopeMenu:e,open:r=!1,children:n,dir:c,onOpenChange:d,modal:p=!0}=t,a=rA(e),[w,E]=z.useState(null),C=z.useRef(!1),P=Do(d),R=Fy(c);return z.useEffect(()=>{const B=()=>{C.current=!0,document.addEventListener("pointerdown",V,{capture:!0,once:!0}),document.addEventListener("pointermove",V,{capture:!0,once:!0})},V=()=>C.current=!1;return document.addEventListener("keydown",B,{capture:!0}),()=>{document.removeEventListener("keydown",B,{capture:!0}),document.removeEventListener("pointerdown",V,{capture:!0}),document.removeEventListener("pointermove",V,{capture:!0})}},[]),i.jsx(t4,{...a,children:i.jsx(xbe,{scope:e,open:r,onOpenChange:P,content:w,onContentChange:E,children:i.jsx(vbe,{scope:e,onClose:z.useCallback(()=>P(!1),[P]),isUsingKeyboardRef:C,dir:R,modal:p,children:n})})})};dK.displayName=qE;var wbe="MenuAnchor",s4=z.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t,c=rA(r);return i.jsx(YC,{...c,...n,ref:e})});s4.displayName=wbe;var i4="MenuPortal",[bbe,hK]=zy(i4,{forceMount:void 0}),fK=t=>{const{__scopeMenu:e,forceMount:r,children:n,container:c}=t,d=By(i4,e);return i.jsx(bbe,{scope:e,forceMount:r,children:i.jsx(Xl,{present:r||d.open,children:i.jsx(UE,{asChild:!0,container:c,children:n})})})};fK.displayName=i4;var sd="MenuContent",[Sbe,a4]=zy(sd),pK=z.forwardRef((t,e)=>{const r=hK(sd,t.__scopeMenu),{forceMount:n=r.forceMount,...c}=t,d=By(sd,t.__scopeMenu),p=GE(sd,t.__scopeMenu);return i.jsx(WS.Provider,{scope:t.__scopeMenu,children:i.jsx(Xl,{present:n||d.open,children:i.jsx(WS.Slot,{scope:t.__scopeMenu,children:p.modal?i.jsx(Ebe,{...c,ref:e}):i.jsx(Tbe,{...c,ref:e})})})})}),Ebe=z.forwardRef((t,e)=>{const r=By(sd,t.__scopeMenu),n=z.useRef(null),c=Fs(e,n);return z.useEffect(()=>{const d=n.current;if(d)return eA(d)},[]),i.jsx(o4,{...t,ref:c,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:tn(t.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),Tbe=z.forwardRef((t,e)=>{const r=By(sd,t.__scopeMenu);return i.jsx(o4,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),o4=z.forwardRef((t,e)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:c,onOpenAutoFocus:d,onCloseAutoFocus:p,disableOutsidePointerEvents:a,onEntryFocus:w,onEscapeKeyDown:E,onPointerDownOutside:C,onFocusOutside:P,onInteractOutside:R,onDismiss:B,disableOutsideScroll:V,...W}=t,K=By(sd,r),Z=GE(sd,r),$=rA(r),X=uK(r),Q=_be(r),[re,ve]=z.useState(null),pe=z.useRef(null),ue=Fs(e,pe,K.onContentChange),ge=z.useRef(0),ce=z.useRef(""),Se=z.useRef(0),le=z.useRef(null),J=z.useRef("right"),ke=z.useRef(0),Ze=V?$E:z.Fragment,Xe=V?{as:Ep,allowPinchZoom:!0}:void 0,qe=st=>{var Wt,Wr;const it=ce.current+st,Mt=Q().filter(jr=>!jr.disabled),ar=document.activeElement,St=(Wt=Mt.find(jr=>jr.ref.current===ar))==null?void 0:Wt.textValue,Xt=Mt.map(jr=>jr.textValue),dt=Lbe(Xt,it,St),ft=(Wr=Mt.find(jr=>jr.textValue===dt))==null?void 0:Wr.ref.current;(function jr(Br){ce.current=Br,window.clearTimeout(ge.current),Br!==""&&(ge.current=window.setTimeout(()=>jr(""),1e3))})(it),ft&&setTimeout(()=>ft.focus())};z.useEffect(()=>()=>window.clearTimeout(ge.current),[]),WC();const $e=z.useCallback(st=>{var Mt,ar;return J.current===((Mt=le.current)==null?void 0:Mt.side)&&zbe(st,(ar=le.current)==null?void 0:ar.area)},[]);return i.jsx(Sbe,{scope:r,searchRef:ce,onItemEnter:z.useCallback(st=>{$e(st)&&st.preventDefault()},[$e]),onItemLeave:z.useCallback(st=>{var it;$e(st)||((it=pe.current)==null||it.focus(),ve(null))},[$e]),onTriggerLeave:z.useCallback(st=>{$e(st)&&st.preventDefault()},[$e]),pointerGraceTimerRef:Se,onPointerGraceIntentChange:z.useCallback(st=>{le.current=st},[]),children:i.jsx(Ze,{...Xe,children:i.jsx(BE,{asChild:!0,trapped:c,onMountAutoFocus:tn(d,st=>{var it;st.preventDefault(),(it=pe.current)==null||it.focus({preventScroll:!0})}),onUnmountAutoFocus:p,children:i.jsx(zE,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:E,onPointerDownOutside:C,onFocusOutside:P,onInteractOutside:R,onDismiss:B,children:i.jsx(QZ,{asChild:!0,...X,dir:Z.dir,orientation:"vertical",loop:n,currentTabStopId:re,onCurrentTabStopIdChange:ve,onEntryFocus:tn(w,st=>{Z.isUsingKeyboardRef.current||st.preventDefault()}),preventScrollOnEntryFocus:!0,children:i.jsx(r4,{role:"menu","aria-orientation":"vertical","data-state":AK(K.open),"data-radix-menu-content":"",dir:Z.dir,...$,...W,ref:ue,style:{outline:"none",...W.style},onKeyDown:tn(W.onKeyDown,st=>{const Mt=st.target.closest("[data-radix-menu-content]")===st.currentTarget,ar=st.ctrlKey||st.altKey||st.metaKey,St=st.key.length===1;Mt&&(st.key==="Tab"&&st.preventDefault(),!ar&&St&&qe(st.key));const Xt=pe.current;if(st.target!==Xt||!pbe.includes(st.key))return;st.preventDefault();const ft=Q().filter(Wt=>!Wt.disabled).map(Wt=>Wt.ref.current);lK.includes(st.key)&&ft.reverse(),Dbe(ft)}),onBlur:tn(t.onBlur,st=>{st.currentTarget.contains(st.target)||(window.clearTimeout(ge.current),ce.current="")}),onPointerMove:tn(t.onPointerMove,ZS(st=>{const it=st.target,Mt=ke.current!==st.clientX;if(st.currentTarget.contains(it)&&Mt){const ar=st.clientX>ke.current?"right":"left";J.current=ar,ke.current=st.clientX}}))})})})})})})});pK.displayName=sd;var jbe="MenuGroup",l4=z.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return i.jsx(Pn.div,{role:"group",...n,ref:e})});l4.displayName=jbe;var Nbe="MenuLabel",mK=z.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return i.jsx(Pn.div,{...n,ref:e})});mK.displayName=Nbe;var hI="MenuItem",z8="menu.itemSelect",nA=z.forwardRef((t,e)=>{const{disabled:r=!1,onSelect:n,...c}=t,d=z.useRef(null),p=GE(hI,t.__scopeMenu),a=a4(hI,t.__scopeMenu),w=Fs(e,d),E=z.useRef(!1),C=()=>{const P=d.current;if(!r&&P){const R=new CustomEvent(z8,{bubbles:!0,cancelable:!0});P.addEventListener(z8,B=>n==null?void 0:n(B),{once:!0}),jZ(P,R),R.defaultPrevented?E.current=!1:p.onClose()}};return i.jsx(gK,{...c,ref:w,disabled:r,onClick:tn(t.onClick,C),onPointerDown:P=>{var R;(R=t.onPointerDown)==null||R.call(t,P),E.current=!0},onPointerUp:tn(t.onPointerUp,P=>{var R;E.current||(R=P.currentTarget)==null||R.click()}),onKeyDown:tn(t.onKeyDown,P=>{const R=a.searchRef.current!=="";r||R&&P.key===" "||KD.includes(P.key)&&(P.currentTarget.click(),P.preventDefault())})})});nA.displayName=hI;var gK=z.forwardRef((t,e)=>{const{__scopeMenu:r,disabled:n=!1,textValue:c,...d}=t,p=a4(hI,r),a=uK(r),w=z.useRef(null),E=Fs(e,w),[C,P]=z.useState(!1),[R,B]=z.useState("");return z.useEffect(()=>{const V=w.current;V&&B((V.textContent??"").trim())},[d.children]),i.jsx(WS.ItemSlot,{scope:r,disabled:n,textValue:c??R,children:i.jsx(eK,{asChild:!0,...a,focusable:!n,children:i.jsx(Pn.div,{role:"menuitem","data-highlighted":C?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...d,ref:E,onPointerMove:tn(t.onPointerMove,ZS(V=>{n?p.onItemLeave(V):(p.onItemEnter(V),V.defaultPrevented||V.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:tn(t.onPointerLeave,ZS(V=>p.onItemLeave(V))),onFocus:tn(t.onFocus,()=>P(!0)),onBlur:tn(t.onBlur,()=>P(!1))})})})}),Ibe="MenuCheckboxItem",_K=z.forwardRef((t,e)=>{const{checked:r=!1,onCheckedChange:n,...c}=t;return i.jsx(bK,{scope:t.__scopeMenu,checked:r,children:i.jsx(nA,{role:"menuitemcheckbox","aria-checked":fI(r)?"mixed":r,...c,ref:e,"data-state":u4(r),onSelect:tn(c.onSelect,()=>n==null?void 0:n(fI(r)?!0:!r),{checkForDefaultPrevented:!1})})})});_K.displayName=Ibe;var yK="MenuRadioGroup",[Cbe,Abe]=zy(yK,{value:void 0,onValueChange:()=>{}}),xK=z.forwardRef((t,e)=>{const{value:r,onValueChange:n,...c}=t,d=Do(n);return i.jsx(Cbe,{scope:t.__scopeMenu,value:r,onValueChange:d,children:i.jsx(l4,{...c,ref:e})})});xK.displayName=yK;var vK="MenuRadioItem",wK=z.forwardRef((t,e)=>{const{value:r,...n}=t,c=Abe(vK,t.__scopeMenu),d=r===c.value;return i.jsx(bK,{scope:t.__scopeMenu,checked:d,children:i.jsx(nA,{role:"menuitemradio","aria-checked":d,...n,ref:e,"data-state":u4(d),onSelect:tn(n.onSelect,()=>{var p;return(p=c.onValueChange)==null?void 0:p.call(c,r)},{checkForDefaultPrevented:!1})})})});wK.displayName=vK;var c4="MenuItemIndicator",[bK,Pbe]=zy(c4,{checked:!1}),SK=z.forwardRef((t,e)=>{const{__scopeMenu:r,forceMount:n,...c}=t,d=Pbe(c4,r);return i.jsx(Xl,{present:n||fI(d.checked)||d.checked===!0,children:i.jsx(Pn.span,{...c,ref:e,"data-state":u4(d.checked)})})});SK.displayName=c4;var kbe="MenuSeparator",EK=z.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return i.jsx(Pn.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});EK.displayName=kbe;var Rbe="MenuArrow",TK=z.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t,c=rA(r);return i.jsx(n4,{...c,...n,ref:e})});TK.displayName=Rbe;var Mbe="MenuSub",[mLe,jK]=zy(Mbe),B1="MenuSubTrigger",NK=z.forwardRef((t,e)=>{const r=By(B1,t.__scopeMenu),n=GE(B1,t.__scopeMenu),c=jK(B1,t.__scopeMenu),d=a4(B1,t.__scopeMenu),p=z.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:w}=d,E={__scopeMenu:t.__scopeMenu},C=z.useCallback(()=>{p.current&&window.clearTimeout(p.current),p.current=null},[]);return z.useEffect(()=>C,[C]),z.useEffect(()=>{const P=a.current;return()=>{window.clearTimeout(P),w(null)}},[a,w]),i.jsx(s4,{asChild:!0,...E,children:i.jsx(gK,{id:c.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":c.contentId,"data-state":AK(r.open),...t,ref:GC(e,c.onTriggerChange),onClick:P=>{var R;(R=t.onClick)==null||R.call(t,P),!(t.disabled||P.defaultPrevented)&&(P.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:tn(t.onPointerMove,ZS(P=>{d.onItemEnter(P),!P.defaultPrevented&&!t.disabled&&!r.open&&!p.current&&(d.onPointerGraceIntentChange(null),p.current=window.setTimeout(()=>{r.onOpenChange(!0),C()},100))})),onPointerLeave:tn(t.onPointerLeave,ZS(P=>{var B,V;C();const R=(B=r.content)==null?void 0:B.getBoundingClientRect();if(R){const W=(V=r.content)==null?void 0:V.dataset.side,K=W==="right",Z=K?-5:5,$=R[K?"left":"right"],X=R[K?"right":"left"];d.onPointerGraceIntentChange({area:[{x:P.clientX+Z,y:P.clientY},{x:$,y:R.top},{x:X,y:R.top},{x:X,y:R.bottom},{x:$,y:R.bottom}],side:W}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>d.onPointerGraceIntentChange(null),300)}else{if(d.onTriggerLeave(P),P.defaultPrevented)return;d.onPointerGraceIntentChange(null)}})),onKeyDown:tn(t.onKeyDown,P=>{var B;const R=d.searchRef.current!=="";t.disabled||R&&P.key===" "||mbe[n.dir].includes(P.key)&&(r.onOpenChange(!0),(B=r.content)==null||B.focus(),P.preventDefault())})})})});NK.displayName=B1;var IK="MenuSubContent",CK=z.forwardRef((t,e)=>{const r=hK(sd,t.__scopeMenu),{forceMount:n=r.forceMount,...c}=t,d=By(sd,t.__scopeMenu),p=GE(sd,t.__scopeMenu),a=jK(IK,t.__scopeMenu),w=z.useRef(null),E=Fs(e,w);return i.jsx(WS.Provider,{scope:t.__scopeMenu,children:i.jsx(Xl,{present:n||d.open,children:i.jsx(WS.Slot,{scope:t.__scopeMenu,children:i.jsx(o4,{id:a.contentId,"aria-labelledby":a.triggerId,...c,ref:E,align:"start",side:p.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:C=>{var P;p.isUsingKeyboardRef.current&&((P=w.current)==null||P.focus()),C.preventDefault()},onCloseAutoFocus:C=>C.preventDefault(),onFocusOutside:tn(t.onFocusOutside,C=>{C.target!==a.trigger&&d.onOpenChange(!1)}),onEscapeKeyDown:tn(t.onEscapeKeyDown,C=>{p.onClose(),C.preventDefault()}),onKeyDown:tn(t.onKeyDown,C=>{var B;const P=C.currentTarget.contains(C.target),R=gbe[p.dir].includes(C.key);P&&R&&(d.onOpenChange(!1),(B=a.trigger)==null||B.focus(),C.preventDefault())})})})})})});CK.displayName=IK;function AK(t){return t?"open":"closed"}function fI(t){return t==="indeterminate"}function u4(t){return fI(t)?"indeterminate":t?"checked":"unchecked"}function Dbe(t){const e=document.activeElement;for(const r of t)if(r===e||(r.focus(),document.activeElement!==e))return}function Obe(t,e){return t.map((r,n)=>t[(e+n)%t.length])}function Lbe(t,e,r){const c=e.length>1&&Array.from(e).every(E=>E===e[0])?e[0]:e,d=r?t.indexOf(r):-1;let p=Obe(t,Math.max(d,0));c.length===1&&(p=p.filter(E=>E!==r));const w=p.find(E=>E.toLowerCase().startsWith(c.toLowerCase()));return w!==r?w:void 0}function Fbe(t,e){const{x:r,y:n}=t;let c=!1;for(let d=0,p=e.length-1;d<e.length;p=d++){const a=e[d].x,w=e[d].y,E=e[p].x,C=e[p].y;w>n!=C>n&&r<(E-a)*(n-w)/(C-w)+a&&(c=!c)}return c}function zbe(t,e){if(!e)return!1;const r={x:t.clientX,y:t.clientY};return Fbe(r,e)}function ZS(t){return e=>e.pointerType==="mouse"?t(e):void 0}var Bbe=dK,Vbe=s4,Ube=fK,$be=pK,qbe=l4,Gbe=mK,Hbe=nA,Wbe=_K,Zbe=xK,Kbe=wK,Xbe=SK,Ybe=EK,Jbe=TK,Qbe=NK,e1e=CK,d4="DropdownMenu",[t1e,gLe]=hd(d4,[cK]),Pc=cK(),[r1e,PK]=t1e(d4),kK=t=>{const{__scopeDropdownMenu:e,children:r,dir:n,open:c,defaultOpen:d,onOpenChange:p,modal:a=!0}=t,w=Pc(e),E=z.useRef(null),[C=!1,P]=ud({prop:c,defaultProp:d,onChange:p});return i.jsx(r1e,{scope:e,triggerId:ku(),triggerRef:E,contentId:ku(),open:C,onOpenChange:P,onOpenToggle:z.useCallback(()=>P(R=>!R),[P]),modal:a,children:i.jsx(Bbe,{...w,open:C,onOpenChange:P,dir:n,modal:a,children:r})})};kK.displayName=d4;var RK="DropdownMenuTrigger",MK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...c}=t,d=PK(RK,r),p=Pc(r);return i.jsx(Vbe,{asChild:!0,...p,children:i.jsx(Pn.button,{type:"button",id:d.triggerId,"aria-haspopup":"menu","aria-expanded":d.open,"aria-controls":d.open?d.contentId:void 0,"data-state":d.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...c,ref:GC(e,d.triggerRef),onPointerDown:tn(t.onPointerDown,a=>{!n&&a.button===0&&a.ctrlKey===!1&&(d.onOpenToggle(),d.open||a.preventDefault())}),onKeyDown:tn(t.onKeyDown,a=>{n||(["Enter"," "].includes(a.key)&&d.onOpenToggle(),a.key==="ArrowDown"&&d.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});MK.displayName=RK;var n1e="DropdownMenuPortal",DK=t=>{const{__scopeDropdownMenu:e,...r}=t,n=Pc(e);return i.jsx(Ube,{...n,...r})};DK.displayName=n1e;var OK="DropdownMenuContent",LK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=PK(OK,r),d=Pc(r),p=z.useRef(!1);return i.jsx($be,{id:c.contentId,"aria-labelledby":c.triggerId,...d,...n,ref:e,onCloseAutoFocus:tn(t.onCloseAutoFocus,a=>{var w;p.current||(w=c.triggerRef.current)==null||w.focus(),p.current=!1,a.preventDefault()}),onInteractOutside:tn(t.onInteractOutside,a=>{const w=a.detail.originalEvent,E=w.button===0&&w.ctrlKey===!0,C=w.button===2||E;(!c.modal||C)&&(p.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});LK.displayName=OK;var s1e="DropdownMenuGroup",i1e=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(qbe,{...c,...n,ref:e})});i1e.displayName=s1e;var a1e="DropdownMenuLabel",FK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Gbe,{...c,...n,ref:e})});FK.displayName=a1e;var o1e="DropdownMenuItem",zK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Hbe,{...c,...n,ref:e})});zK.displayName=o1e;var l1e="DropdownMenuCheckboxItem",BK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Wbe,{...c,...n,ref:e})});BK.displayName=l1e;var c1e="DropdownMenuRadioGroup",u1e=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Zbe,{...c,...n,ref:e})});u1e.displayName=c1e;var d1e="DropdownMenuRadioItem",VK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Kbe,{...c,...n,ref:e})});VK.displayName=d1e;var h1e="DropdownMenuItemIndicator",UK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Xbe,{...c,...n,ref:e})});UK.displayName=h1e;var f1e="DropdownMenuSeparator",$K=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Ybe,{...c,...n,ref:e})});$K.displayName=f1e;var p1e="DropdownMenuArrow",m1e=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Jbe,{...c,...n,ref:e})});m1e.displayName=p1e;var g1e="DropdownMenuSubTrigger",qK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(Qbe,{...c,...n,ref:e})});qK.displayName=g1e;var _1e="DropdownMenuSubContent",GK=z.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,c=Pc(r);return i.jsx(e1e,{...c,...n,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});GK.displayName=_1e;var y1e=kK,x1e=MK,v1e=DK,HK=LK,WK=FK,ZK=zK,KK=BK,XK=VK,YK=UK,JK=$K,QK=qK,eX=GK;function Pg(t,e){if(t==null)return{};var r={},n=Object.keys(t),c,d;for(d=0;d<n.length;d++)c=n[d],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}var w1e=["color"],b1e=z.forwardRef(function(t,e){var r=t.color,n=r===void 0?"currentColor":r,c=Pg(t,w1e);return z.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c,{ref:e}),z.createElement("path",{d:"M4.93179 5.43179C4.75605 5.60753 4.75605 5.89245 4.93179 6.06819C5.10753 6.24392 5.39245 6.24392 5.56819 6.06819L7.49999 4.13638L9.43179 6.06819C9.60753 6.24392 9.89245 6.24392 10.0682 6.06819C10.2439 5.89245 10.2439 5.60753 10.0682 5.43179L7.81819 3.18179C7.73379 3.0974 7.61933 3.04999 7.49999 3.04999C7.38064 3.04999 7.26618 3.0974 7.18179 3.18179L4.93179 5.43179ZM10.0682 9.56819C10.2439 9.39245 10.2439 9.10753 10.0682 8.93179C9.89245 8.75606 9.60753 8.75606 9.43179 8.93179L7.49999 10.8636L5.56819 8.93179C5.39245 8.75606 5.10753 8.75606 4.93179 8.93179C4.75605 9.10753 4.75605 9.39245 4.93179 9.56819L7.18179 11.8182C7.35753 11.9939 7.64245 11.9939 7.81819 11.8182L10.0682 9.56819Z",fill:n,fillRule:"evenodd",clipRule:"evenodd"}))}),S1e=["color"],tX=z.forwardRef(function(t,e){var r=t.color,n=r===void 0?"currentColor":r,c=Pg(t,S1e);return z.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c,{ref:e}),z.createElement("path",{d:"M11.4669 3.72684C11.7558 3.91574 11.8369 4.30308 11.648 4.59198L7.39799 11.092C7.29783 11.2452 7.13556 11.3467 6.95402 11.3699C6.77247 11.3931 6.58989 11.3355 6.45446 11.2124L3.70446 8.71241C3.44905 8.48022 3.43023 8.08494 3.66242 7.82953C3.89461 7.57412 4.28989 7.55529 4.5453 7.78749L6.75292 9.79441L10.6018 3.90792C10.7907 3.61902 11.178 3.53795 11.4669 3.72684Z",fill:n,fillRule:"evenodd",clipRule:"evenodd"}))}),E1e=["color"],rX=z.forwardRef(function(t,e){var r=t.color,n=r===void 0?"currentColor":r,c=Pg(t,E1e);return z.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c,{ref:e}),z.createElement("path",{d:"M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z",fill:n,fillRule:"evenodd",clipRule:"evenodd"}))}),T1e=["color"],j1e=z.forwardRef(function(t,e){var r=t.color,n=r===void 0?"currentColor":r,c=Pg(t,T1e);return z.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c,{ref:e}),z.createElement("path",{d:"M8.84182 3.13514C9.04327 3.32401 9.05348 3.64042 8.86462 3.84188L5.43521 7.49991L8.86462 11.1579C9.05348 11.3594 9.04327 11.6758 8.84182 11.8647C8.64036 12.0535 8.32394 12.0433 8.13508 11.8419L4.38508 7.84188C4.20477 7.64955 4.20477 7.35027 4.38508 7.15794L8.13508 3.15794C8.32394 2.95648 8.64036 2.94628 8.84182 3.13514Z",fill:n,fillRule:"evenodd",clipRule:"evenodd"}))}),N1e=["color"],nX=z.forwardRef(function(t,e){var r=t.color,n=r===void 0?"currentColor":r,c=Pg(t,N1e);return z.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c,{ref:e}),z.createElement("path",{d:"M6.1584 3.13508C6.35985 2.94621 6.67627 2.95642 6.86514 3.15788L10.6151 7.15788C10.7954 7.3502 10.7954 7.64949 10.6151 7.84182L6.86514 11.8418C6.67627 12.0433 6.35985 12.0535 6.1584 11.8646C5.95694 11.6757 5.94673 11.3593 6.1356 11.1579L9.565 7.49985L6.1356 3.84182C5.94673 3.64036 5.95694 3.32394 6.1584 3.13508Z",fill:n,fillRule:"evenodd",clipRule:"evenodd"}))}),I1e=["color"],C1e=z.forwardRef(function(t,e){var r=t.color,n=r===void 0?"currentColor":r,c=Pg(t,I1e);return z.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c,{ref:e}),z.createElement("path",{d:"M3.13523 8.84197C3.3241 9.04343 3.64052 9.05363 3.84197 8.86477L7.5 5.43536L11.158 8.86477C11.3595 9.05363 11.6759 9.04343 11.8648 8.84197C12.0536 8.64051 12.0434 8.32409 11.842 8.13523L7.84197 4.38523C7.64964 4.20492 7.35036 4.20492 7.15803 4.38523L3.15803 8.13523C2.95657 8.32409 2.94637 8.64051 3.13523 8.84197Z",fill:n,fillRule:"evenodd",clipRule:"evenodd"}))}),A1e=["color"],P1e=z.forwardRef(function(t,e){var r=t.color,n=r===void 0?"currentColor":r,c=Pg(t,A1e);return z.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c,{ref:e}),z.createElement("path",{d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:n,fillRule:"evenodd",clipRule:"evenodd"}))}),k1e=["color"],R1e=z.forwardRef(function(t,e){var r=t.color,n=r===void 0?"currentColor":r,c=Pg(t,k1e);return z.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c,{ref:e}),z.createElement("path",{d:"M9.875 7.5C9.875 8.81168 8.81168 9.875 7.5 9.875C6.18832 9.875 5.125 8.81168 5.125 7.5C5.125 6.18832 6.18832 5.125 7.5 5.125C8.81168 5.125 9.875 6.18832 9.875 7.5Z",fill:n}))});const XD=y1e,YD=x1e,M1e=z.forwardRef(({className:t,inset:e,children:r,...n},c)=>i.jsxs(QK,{ref:c,className:kn("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",e&&"pl-8",t),...n,children:[r,i.jsx(nX,{className:"ml-auto h-4 w-4"})]}));M1e.displayName=QK.displayName;const D1e=z.forwardRef(({className:t,...e},r)=>i.jsx(eX,{ref:r,className:kn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e}));D1e.displayName=eX.displayName;const pI=z.forwardRef(({className:t,sideOffset:e=4,...r},n)=>i.jsx(v1e,{children:i.jsx(HK,{ref:n,sideOffset:e,className:kn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));pI.displayName=HK.displayName;const Oi=z.forwardRef(({className:t,inset:e,...r},n)=>i.jsx(ZK,{ref:n,className:kn("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e&&"pl-8",t),...r}));Oi.displayName=ZK.displayName;const O1e=z.forwardRef(({className:t,children:e,checked:r,...n},c)=>i.jsxs(KK,{ref:c,className:kn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...n,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(YK,{children:i.jsx(tX,{className:"h-4 w-4"})})}),e]}));O1e.displayName=KK.displayName;const L1e=z.forwardRef(({className:t,children:e,...r},n)=>i.jsxs(XK,{ref:n,className:kn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(YK,{children:i.jsx(R1e,{className:"h-4 w-4 fill-current"})})}),e]}));L1e.displayName=XK.displayName;const F1e=z.forwardRef(({className:t,inset:e,...r},n)=>i.jsx(WK,{ref:n,className:kn("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...r}));F1e.displayName=WK.displayName;const Eu=z.forwardRef(({className:t,...e},r)=>i.jsx(JK,{ref:r,className:kn("-mx-1 my-1 h-px bg-muted",t),...e}));Eu.displayName=JK.displayName;var h4="Avatar",[z1e,_Le]=hd(h4),[B1e,sX]=z1e(h4),iX=z.forwardRef((t,e)=>{const{__scopeAvatar:r,...n}=t,[c,d]=z.useState("idle");return i.jsx(B1e,{scope:r,imageLoadingStatus:c,onImageLoadingStatusChange:d,children:i.jsx(Pn.span,{...n,ref:e})})});iX.displayName=h4;var aX="AvatarImage",oX=z.forwardRef((t,e)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:c=()=>{},...d}=t,p=sX(aX,r),a=V1e(n,d.referrerPolicy),w=Do(E=>{c(E),p.onImageLoadingStatusChange(E)});return Jo(()=>{a!=="idle"&&w(a)},[a,w]),a==="loaded"?i.jsx(Pn.img,{...d,ref:e,src:n}):null});oX.displayName=aX;var lX="AvatarFallback",cX=z.forwardRef((t,e)=>{const{__scopeAvatar:r,delayMs:n,...c}=t,d=sX(lX,r),[p,a]=z.useState(n===void 0);return z.useEffect(()=>{if(n!==void 0){const w=window.setTimeout(()=>a(!0),n);return()=>window.clearTimeout(w)}},[n]),p&&d.imageLoadingStatus!=="loaded"?i.jsx(Pn.span,{...c,ref:e}):null});cX.displayName=lX;function V1e(t,e){const[r,n]=z.useState("idle");return Jo(()=>{if(!t){n("error");return}let c=!0;const d=new window.Image,p=a=>()=>{c&&n(a)};return n("loading"),d.onload=p("loaded"),d.onerror=p("error"),d.src=t,e&&(d.referrerPolicy=e),()=>{c=!1}},[t,e]),r}var uX=iX,dX=oX,hX=cX;const Jc=z.forwardRef(({className:t,...e},r)=>i.jsx(uX,{ref:r,className:kn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...e}));Jc.displayName=uX.displayName;const cf=z.forwardRef(({className:t,...e},r)=>i.jsx(dX,{ref:r,className:kn("aspect-square h-full w-full",t),...e}));cf.displayName=dX.displayName;const Sc=z.forwardRef(({className:t,...e},r)=>i.jsx(hX,{ref:r,className:kn("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...e}));Sc.displayName=hX.displayName;const U1e=HC("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ir({className:t,variant:e,...r}){return i.jsx("div",{className:kn(U1e({variant:e}),t),...r})}const $1e={BASE_URL:"/StudyMarket/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ADMIN_EMAILS:"",VITE_ADMIN_UIDS:"",VITE_ALGOLIA_APP_ID:"placeholder",VITE_ALGOLIA_SEARCH_KEY:"placeholder",VITE_STRIPE_COUNTRY:"fr",VITE_STRIPE_CURRENCY:"eur",VITE_STRIPE_PUBLISHABLE_KEY:"pk_test_51RY7Vw2XLhzYQhT9mWGOChkOK9Lp7QGPlTA5mqrZhHCDwiRGdgXeEpCanybQGuvXy4FsNTyDOTlYNkGsBGXEGNhS00ORRyOHto",VITE_SUPABASE_ANON_KEY:"placeholder_key",VITE_SUPABASE_URL:"https://placeholder.supabase.co"},B8=t=>{let e;const r=new Set,n=(C,P)=>{const R=typeof C=="function"?C(e):C;if(!Object.is(R,e)){const B=e;e=P??(typeof R!="object"||R===null)?R:Object.assign({},e,R),r.forEach(V=>V(e,B))}},c=()=>e,w={setState:n,getState:c,getInitialState:()=>E,subscribe:C=>(r.add(C),()=>r.delete(C)),destroy:()=>{($1e?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},E=e=t(n,c,w);return w},q1e=t=>t?B8(t):B8;var fX={exports:{}},pX={},mX={exports:{}},gX={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M0=z;function G1e(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var H1e=typeof Object.is=="function"?Object.is:G1e,W1e=M0.useState,Z1e=M0.useEffect,K1e=M0.useLayoutEffect,X1e=M0.useDebugValue;function Y1e(t,e){var r=e(),n=W1e({inst:{value:r,getSnapshot:e}}),c=n[0].inst,d=n[1];return K1e(function(){c.value=r,c.getSnapshot=e,OR(c)&&d({inst:c})},[t,r,e]),Z1e(function(){return OR(c)&&d({inst:c}),t(function(){OR(c)&&d({inst:c})})},[t]),X1e(r),r}function OR(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!H1e(t,r)}catch{return!0}}function J1e(t,e){return e()}var Q1e=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?J1e:Y1e;gX.useSyncExternalStore=M0.useSyncExternalStore!==void 0?M0.useSyncExternalStore:Q1e;mX.exports=gX;var eSe=mX.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sA=z,tSe=eSe;function rSe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var nSe=typeof Object.is=="function"?Object.is:rSe,sSe=tSe.useSyncExternalStore,iSe=sA.useRef,aSe=sA.useEffect,oSe=sA.useMemo,lSe=sA.useDebugValue;pX.useSyncExternalStoreWithSelector=function(t,e,r,n,c){var d=iSe(null);if(d.current===null){var p={hasValue:!1,value:null};d.current=p}else p=d.current;d=oSe(function(){function w(B){if(!E){if(E=!0,C=B,B=n(B),c!==void 0&&p.hasValue){var V=p.value;if(c(V,B))return P=V}return P=B}if(V=P,nSe(C,B))return V;var W=n(B);return c!==void 0&&c(V,W)?(C=B,V):(C=B,P=W)}var E=!1,C,P,R=r===void 0?null:r;return[function(){return w(e())},R===null?void 0:function(){return w(R())}]},[e,r,n,c]);var a=sSe(t,d[0],d[1]);return aSe(function(){p.hasValue=!0,p.value=a},[a]),lSe(a),a};fX.exports=pX;var cSe=fX.exports;const uSe=W0(cSe),_X={BASE_URL:"/StudyMarket/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ADMIN_EMAILS:"",VITE_ADMIN_UIDS:"",VITE_ALGOLIA_APP_ID:"placeholder",VITE_ALGOLIA_SEARCH_KEY:"placeholder",VITE_STRIPE_COUNTRY:"fr",VITE_STRIPE_CURRENCY:"eur",VITE_STRIPE_PUBLISHABLE_KEY:"pk_test_51RY7Vw2XLhzYQhT9mWGOChkOK9Lp7QGPlTA5mqrZhHCDwiRGdgXeEpCanybQGuvXy4FsNTyDOTlYNkGsBGXEGNhS00ORRyOHto",VITE_SUPABASE_ANON_KEY:"placeholder_key",VITE_SUPABASE_URL:"https://placeholder.supabase.co"},{useDebugValue:dSe}=_n,{useSyncExternalStoreWithSelector:hSe}=uSe;let V8=!1;const fSe=t=>t;function pSe(t,e=fSe,r){(_X?"production":void 0)!=="production"&&r&&!V8&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),V8=!0);const n=hSe(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,r);return dSe(n),n}const U8=t=>{(_X?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?q1e(t):t,r=(n,c)=>pSe(e,n,c);return Object.assign(r,e),r},pw=t=>t?U8(t):U8,E_=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch{return new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return t&&typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date},mSe=(t,e,r)=>{const n=[t,e].sort();return`${n[0]}_${n[1]}_${r}`},gSe=async(t,e,r,n,c,d,p)=>{try{if(!t||!t.includes("@")){console.log("No valid email address for notification");return}const a=`${window.location.origin}/messages?conversation=${p}`,w=await fetch("/api/send-message-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipientEmail:t,recipientName:e,senderName:r,senderUniversity:n,listingTitle:c,messagePreview:d,conversationUrl:a})});w.ok?console.log("Email notification sent successfully"):console.error("Failed to send email notification:",await w.text())}catch(a){console.error("Error sending email notification:",a)}},iA=pw((t,e)=>({conversations:[],currentConversation:null,messages:[],loading:!1,fetchConversations:r=>{t({loading:!0});const{unsubscribeConversations:n}=e();n&&n();try{const c=ms(jn(rr,"conversations"),ii("participants","array-contains",r),eo("updatedAt","desc"),la(50)),d=hy(c,p=>{const a=[];p.docs.forEach(w=>{const E=w.data();E.deletedFor&&E.deletedFor.includes(r)||E.blockedBy&&E.blockedBy.includes(r)||a.push({id:w.id,participants:E.participants||[],listingId:E.listingId||"",listingTitle:E.listingTitle||"",listingImage:E.listingImage,listingPrice:E.listingPrice||0,participantDetails:E.participantDetails||{},lastMessage:E.lastMessage?{...E.lastMessage,sentAt:E_(E.lastMessage.sentAt)}:void 0,unreadCount:E.unreadCount||{},blockedBy:E.blockedBy||[],deletedFor:E.deletedFor||[],status:E.status||"active",createdAt:E_(E.createdAt),updatedAt:E_(E.updatedAt)})}),t({conversations:a,loading:!1,unsubscribeConversations:d})},p=>{console.error("Error fetching conversations:",p),Nt.error("Erreur lors du chargement des conversations"),t({loading:!1})})}catch(c){console.error("Error setting up conversations listener:",c),t({loading:!1})}},fetchMessages:r=>{const{unsubscribeMessages:n}=e();n&&n();try{const c=ms(jn(rr,"conversations",r,"messages"),eo("sentAt","asc"),la(100)),d=hy(c,p=>{const a=p.docs.map(w=>{const E=w.data();return{id:w.id,conversationId:r,senderId:E.senderId,senderName:E.senderName,senderAvatar:E.senderAvatar,text:E.text,type:E.type||"text",attachments:E.attachments||[],seen:E.seen||!1,sentAt:E_(E.sentAt)}});t({messages:a,unsubscribeMessages:d})},p=>{console.error("Error fetching messages:",p),Nt.error("Erreur lors du chargement des messages")})}catch(c){console.error("Error setting up messages listener:",c)}},sendMessage:async(r,n,c,d,p)=>{try{console.log("Sending message:",{conversationId:r,text:n,senderId:c,senderName:d});const a=e().currentConversation;if(!a){console.error("No current conversation");return}if(a.blockedBy&&a.blockedBy.includes(c)){Nt.error("Vous ne pouvez pas envoyer de message dans cette conversation");return}const w={conversationId:r,senderId:c,senderName:d,senderAvatar:p||null,text:n,type:"text",seen:!1,sentAt:aa()};console.log("Adding message to Firestore:",w);const E=await af(jn(rr,"conversations",r,"messages"),w);console.log("Message added with ID:",E.id);const C=a.participants.filter(R=>R!==c),P={};C.forEach(R=>{P[`unreadCount.${R}`]=(a.unreadCount[R]||0)+1}),console.log("Updating conversation with:",{lastMessage:{text:n,sentAt:aa(),senderId:c,senderName:d},updatedAt:aa(),...P}),await Rs(hn(rr,"conversations",r),{lastMessage:{text:n,sentAt:aa(),senderId:c,senderName:d},updatedAt:aa(),...P}),C.forEach(async R=>{const B=a.participantDetails[R];if(B&&B.email){const V=a.participantDetails[c];await gSe(B.email,B.name,d,(V==null?void 0:V.university)||"Université non spécifiée",a.listingTitle,n,r)}}),console.log("Message sent successfully")}catch(a){console.error("Error sending message:",a),Nt.error("Erreur lors de l'envoi du message")}},createConversation:async(r,n,c,d,p,a,w,E,C)=>{try{console.log("Creating conversation:",{listingId:r,buyerId:p,sellerId:a});const P=mSe(p,a,r);console.log("Generated conversation ID:",P);const R=await Xa(hn(rr,"conversations",P));if(R.exists()){console.log("Conversation already exists, sending message");const W=R.data(),K={id:P,participants:W.participants||[],listingId:W.listingId||"",listingTitle:W.listingTitle||"",listingImage:W.listingImage,listingPrice:W.listingPrice||0,participantDetails:W.participantDetails||{},lastMessage:W.lastMessage?{...W.lastMessage,sentAt:E_(W.lastMessage.sentAt)}:void 0,unreadCount:W.unreadCount||{},blockedBy:W.blockedBy||[],deletedFor:W.deletedFor||[],status:W.status||"active",createdAt:E_(W.createdAt),updatedAt:E_(W.updatedAt)};return t({currentConversation:K}),await e().sendMessage(P,C,p,w.displayName,w.photoURL),P}console.log("Creating new conversation");const B={participants:[p,a],listingId:r,listingTitle:n,listingImage:d||null,listingPrice:c,participantDetails:{[p]:{name:w.displayName,avatar:w.photoURL||null,university:w.university,verified:w.isVerified||!1,email:w.email||null},[a]:{name:E.sellerName,avatar:E.sellerAvatar||null,university:E.sellerUniversity,verified:E.sellerVerified||!1,email:E.email||null}},unreadCount:{[p]:0,[a]:1},status:"active",createdAt:aa(),updatedAt:aa()};console.log("Setting conversation document:",B),await C0(hn(rr,"conversations",P),B);const V={id:P,participants:[p,a],listingId:r,listingTitle:n,listingImage:d||void 0,listingPrice:c,participantDetails:B.participantDetails,unreadCount:B.unreadCount,status:"active",createdAt:new Date,updatedAt:new Date};return t({currentConversation:V}),console.log("Sending initial message"),await e().sendMessage(P,C,p,w.displayName,w.photoURL),P}catch(P){throw console.error("Error creating conversation:",P),Nt.error("Erreur lors de la création de la conversation"),P}},markMessagesAsSeen:async(r,n)=>{try{const c=hn(rr,"conversations",r);await Rs(c,{[`unreadCount.${n}`]:0})}catch(c){console.error("Error marking messages as seen:",c)}},setCurrentConversation:r=>{t({currentConversation:r})},blockUser:async(r,n)=>{try{const c=hn(rr,"conversations",r),d=await Xa(c);if(d.exists()){const a=d.data().blockedBy||[];a.includes(n)||(await Rs(c,{blockedBy:[...a,n],status:"blocked",updatedAt:aa()}),Nt.success("Utilisateur bloqué"))}}catch(c){console.error("Error blocking user:",c),Nt.error("Erreur lors du blocage")}},reportUser:async(r,n,c,d,p)=>{try{const a={reporterId:n,reportedUserId:c,conversationId:r,reason:d,description:p,status:"pending",createdAt:aa()};await af(jn(rr,"reports"),a),Nt.success("Signalement envoyé")}catch(a){console.error("Error reporting user:",a),Nt.error("Erreur lors du signalement")}},deleteConversation:async(r,n)=>{try{const c=hn(rr,"conversations",r),d=await Xa(c);if(d.exists()){const p=d.data(),a=p.deletedFor||[];if(!a.includes(n)){const w=[...a,n];w.length===p.participants.length?await cd(c):await Rs(c,{deletedFor:w,updatedAt:aa()}),Nt.success("Conversation supprimée")}}}catch(c){console.error("Error deleting conversation:",c),Nt.error("Erreur lors de la suppression")}},findConversationByListing:(r,n)=>{const{conversations:c}=e();return c.find(d=>d.listingId===r&&d.participants.includes(n))||null},cleanup:()=>{const{unsubscribeConversations:r,unsubscribeMessages:n}=e();r&&r(),n&&n(),t({conversations:[],currentConversation:null,messages:[],unsubscribeConversations:void 0,unsubscribeMessages:void 0})}})),_Se={BASE_URL:"/StudyMarket/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ADMIN_EMAILS:"",VITE_ADMIN_UIDS:"",VITE_ALGOLIA_APP_ID:"placeholder",VITE_ALGOLIA_SEARCH_KEY:"placeholder",VITE_STRIPE_COUNTRY:"fr",VITE_STRIPE_CURRENCY:"eur",VITE_STRIPE_PUBLISHABLE_KEY:"pk_test_51RY7Vw2XLhzYQhT9mWGOChkOK9Lp7QGPlTA5mqrZhHCDwiRGdgXeEpCanybQGuvXy4FsNTyDOTlYNkGsBGXEGNhS00ORRyOHto",VITE_SUPABASE_ANON_KEY:"placeholder_key",VITE_SUPABASE_URL:"https://placeholder.supabase.co"};function ySe(t,e){let r;try{r=t()}catch{return}return{getItem:c=>{var d;const p=w=>w===null?null:JSON.parse(w,void 0),a=(d=r.getItem(c))!=null?d:null;return a instanceof Promise?a.then(p):p(a)},setItem:(c,d)=>r.setItem(c,JSON.stringify(d,void 0)),removeItem:c=>r.removeItem(c)}}const KS=t=>e=>{try{const r=t(e);return r instanceof Promise?r:{then(n){return KS(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return KS(n)(r)}}}},xSe=(t,e)=>(r,n,c)=>{let d={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:K=>K,version:0,merge:(K,Z)=>({...Z,...K}),...e},p=!1;const a=new Set,w=new Set;let E;try{E=d.getStorage()}catch{}if(!E)return t((...K)=>{console.warn(`[zustand persist middleware] Unable to update item '${d.name}', the given storage is currently unavailable.`),r(...K)},n,c);const C=KS(d.serialize),P=()=>{const K=d.partialize({...n()});let Z;const $=C({state:K,version:d.version}).then(X=>E.setItem(d.name,X)).catch(X=>{Z=X});if(Z)throw Z;return $},R=c.setState;c.setState=(K,Z)=>{R(K,Z),P()};const B=t((...K)=>{r(...K),P()},n,c);let V;const W=()=>{var K;if(!E)return;p=!1,a.forEach($=>$(n()));const Z=((K=d.onRehydrateStorage)==null?void 0:K.call(d,n()))||void 0;return KS(E.getItem.bind(E))(d.name).then($=>{if($)return d.deserialize($)}).then($=>{if($)if(typeof $.version=="number"&&$.version!==d.version){if(d.migrate)return d.migrate($.state,$.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return $.state}).then($=>{var X;return V=d.merge($,(X=n())!=null?X:B),r(V,!0),P()}).then(()=>{Z==null||Z(V,void 0),p=!0,w.forEach($=>$(V))}).catch($=>{Z==null||Z(void 0,$)})};return c.persist={setOptions:K=>{d={...d,...K},K.getStorage&&(E=K.getStorage())},clearStorage:()=>{E==null||E.removeItem(d.name)},getOptions:()=>d,rehydrate:()=>W(),hasHydrated:()=>p,onHydrate:K=>(a.add(K),()=>{a.delete(K)}),onFinishHydration:K=>(w.add(K),()=>{w.delete(K)})},W(),V||B},vSe=(t,e)=>(r,n,c)=>{let d={storage:ySe(()=>localStorage),partialize:W=>W,version:0,merge:(W,K)=>({...K,...W}),...e},p=!1;const a=new Set,w=new Set;let E=d.storage;if(!E)return t((...W)=>{console.warn(`[zustand persist middleware] Unable to update item '${d.name}', the given storage is currently unavailable.`),r(...W)},n,c);const C=()=>{const W=d.partialize({...n()});return E.setItem(d.name,{state:W,version:d.version})},P=c.setState;c.setState=(W,K)=>{P(W,K),C()};const R=t((...W)=>{r(...W),C()},n,c);c.getInitialState=()=>R;let B;const V=()=>{var W,K;if(!E)return;p=!1,a.forEach($=>{var X;return $((X=n())!=null?X:R)});const Z=((K=d.onRehydrateStorage)==null?void 0:K.call(d,(W=n())!=null?W:R))||void 0;return KS(E.getItem.bind(E))(d.name).then($=>{if($)if(typeof $.version=="number"&&$.version!==d.version){if(d.migrate)return[!0,d.migrate($.state,$.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,$.state];return[!1,void 0]}).then($=>{var X;const[Q,re]=$;if(B=d.merge(re,(X=n())!=null?X:R),r(B,!0),Q)return C()}).then(()=>{Z==null||Z(B,void 0),B=n(),p=!0,w.forEach($=>$(B))}).catch($=>{Z==null||Z(void 0,$)})};return c.persist={setOptions:W=>{d={...d,...W},W.storage&&(E=W.storage)},clearStorage:()=>{E==null||E.removeItem(d.name)},getOptions:()=>d,rehydrate:()=>V(),hasHydrated:()=>p,onHydrate:W=>(a.add(W),()=>{a.delete(W)}),onFinishHydration:W=>(w.add(W),()=>{w.delete(W)})},d.skipHydration||V(),B||R},wSe=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((_Se?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),xSe(t,e)):vSe(t,e),bSe=wSe,HE=pw()(bSe((t,e)=>({cart:[],cartTotal:0,addToCart:r=>{const{cart:n}=e(),c=n.find(d=>d.id===r.id);t(c?{cart:n.map(d=>d.id===r.id?{...d,quantity:d.quantity+1}:d),cartTotal:e().cartTotal+r.price}:{cart:[...n,{...r,quantity:1}],cartTotal:e().cartTotal+r.price}),Nt.success("Article ajouté au panier")},removeFromCart:r=>{const{cart:n}=e(),c=n.find(d=>d.id===r);c&&t({cart:n.filter(d=>d.id!==r),cartTotal:e().cartTotal-c.price*c.quantity})},updateQuantity:(r,n)=>{const{cart:c}=e(),d=c.find(p=>p.id===r);if(d){const p=n-d.quantity;t({cart:c.map(a=>a.id===r?{...a,quantity:n}:a),cartTotal:e().cartTotal+d.price*p})}},clearCart:()=>{t({cart:[],cartTotal:0})},getCartItemCount:()=>e().cart.reduce((r,n)=>r+n.quantity,0)}),{name:"cart-storage",partialize:t=>({cart:t.cart,cartTotal:t.cartTotal})})),SSe=()=>{var K,Z;const{currentUser:t,userProfile:e,logout:r}=$i(),{conversations:n,fetchConversations:c}=iA(),{getCartItemCount:d}=HE(),{theme:p,setTheme:a}=lC(),w=Ra(),[E,C]=z.useState(""),P=_n.useMemo(()=>{if(!t)return!1;const $="".split(",").map(Q=>Q.trim()).filter(Boolean),X="".split(",").map(Q=>Q.trim()).filter(Boolean);return t.email&&$.includes(t.email)||X.includes(t.uid)},[t]),R=_n.useMemo(()=>!t||!n.length?0:n.reduce(($,X)=>{const Q=X.unreadCount[t.uid]||0;return $+Q},0),[n,t]);z.useEffect(()=>{t&&c(t.uid)},[t,c]);const B=$=>{$.preventDefault(),E.trim()&&w(`/listings?q=${encodeURIComponent(E.trim())}`)},V=async()=>{try{await r(),w("/")}catch($){console.error("Logout error:",$)}},W=d();return i.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border",children:i.jsx("div",{className:"container mx-auto px-3 sm:px-4 lg:px-6",children:i.jsxs("div",{className:"flex h-14 sm:h-16 items-center justify-between gap-2 sm:gap-4",children:[i.jsxs(Nr,{to:"/",className:"flex items-center space-x-2",children:[i.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center",children:i.jsx(up,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),i.jsxs("div",{className:"hidden sm:block",children:[i.jsx("span",{className:"font-bold text-lg sm:text-xl bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"StudyMarket"}),i.jsx("div",{className:"text-xs text-muted-foreground -mt-1",children:"Étudiants certifiés"})]})]}),i.jsx("form",{onSubmit:B,className:"flex-1 max-w-sm sm:max-w-md lg:max-w-lg mx-2 sm:mx-4",children:i.jsxs("div",{className:"relative",children:[i.jsx(Oo,{className:"absolute left-2.5 sm:left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{type:"text",placeholder:"Rechercher...",value:E,onChange:$=>C($.target.value),className:"pl-8 sm:pl-10 pr-3 h-9 sm:h-10 text-sm w-full"})]})}),i.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[i.jsxs("div",{onClick:()=>a(p==="dark"?"light":"dark"),className:"relative cursor-pointer text-foreground hover:text-primary transition-colors p-2","aria-label":"Changer le thème",children:[i.jsx(p8,{className:"h-4 w-4 sm:h-5 sm:w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),i.jsx(d8,{className:"absolute top-2 left-2 h-4 w-4 sm:h-5 sm:w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"})]}),t?i.jsxs(i.Fragment,{children:[i.jsx(Ge,{asChild:!0,className:"hidden md:flex bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 h-8 sm:h-9 text-xs sm:text-sm",children:i.jsxs(Nr,{to:"/create",children:[i.jsx(W_,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),i.jsx("span",{className:"hidden lg:inline",children:"Publier"})]})}),i.jsxs("div",{className:"relative hidden sm:block",children:[i.jsx(Ge,{variant:"ghost",size:"icon",asChild:!0,className:"h-8 w-8 sm:h-9 sm:w-9",children:i.jsx(Nr,{to:"/cart",children:i.jsx(wp,{className:"w-4 h-4"})})}),W>0&&i.jsx(Ir,{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs min-w-[16px] h-4 flex items-center justify-center px-1 rounded-full border-2 border-background",children:W>99?"99+":W})]}),i.jsx(Ge,{variant:"ghost",size:"icon",asChild:!0,className:"hidden sm:flex h-8 w-8 sm:h-9 sm:w-9",children:i.jsx(Nr,{to:"/saved-searches",children:i.jsx(Bd,{className:"w-4 h-4"})})}),i.jsxs("div",{className:"relative hidden sm:block",children:[i.jsx(Ge,{variant:"ghost",size:"icon",asChild:!0,className:"h-8 w-8 sm:h-9 sm:w-9",children:i.jsx(Nr,{to:"/messages",children:i.jsx(xa,{className:"w-4 h-4"})})}),R>0&&i.jsx(Ir,{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs min-w-[16px] h-4 flex items-center justify-center px-1 rounded-full border-2 border-background",children:R>99?"99+":R})]}),i.jsxs(XD,{children:[i.jsx(YD,{asChild:!0,children:i.jsxs(Ge,{variant:"ghost",className:"relative h-8 w-8 sm:h-9 sm:w-9 rounded-full p-0",children:[i.jsxs(Jc,{className:"h-7 w-7 sm:h-8 sm:w-8",children:[i.jsx(cf,{src:e==null?void 0:e.photoURL}),i.jsx(Sc,{className:"text-xs sm:text-sm",children:((Z=(K=e==null?void 0:e.displayName)==null?void 0:K[0])==null?void 0:Z.toUpperCase())||"U"})]}),(e==null?void 0:e.isVerified)&&i.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 sm:w-4 sm:h-4 bg-green-500 rounded-full flex items-center justify-center",children:i.jsx(Ms,{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 text-white"})})]})}),i.jsxs(pI,{className:"w-64",align:"end",children:[i.jsx("div",{className:"flex items-center justify-start gap-2 p-2",children:i.jsxs("div",{className:"flex flex-col space-y-1 leading-none",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("p",{className:"font-medium",children:e==null?void 0:e.displayName}),(e==null?void 0:e.isVerified)&&i.jsxs(Ir,{variant:"secondary",className:"text-xs bg-green-100 text-green-800",children:[i.jsx(Ms,{className:"w-3 h-3 mr-1"}),"Vérifié"]})]}),i.jsx("p",{className:"w-[200px] truncate text-sm text-muted-foreground",children:e==null?void 0:e.university}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[i.jsx(Jd,{className:"w-3 h-3 text-green-600"}),i.jsxs("span",{children:[(e==null?void 0:e.co2Saved)||0," kg CO₂ économisés"]})]})]})}),i.jsx(Eu,{}),P&&i.jsxs(i.Fragment,{children:[i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/admin",className:"cursor-pointer bg-gradient-to-r from-primary/10 to-secondary/10",children:[i.jsx(Ms,{className:"w-4 h-4 mr-2 text-primary"}),i.jsx("span",{className:"font-semibold text-primary",children:"Administration"})]})}),i.jsx(Eu,{})]}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/profile",className:"cursor-pointer",children:[i.jsx(Hl,{className:"w-4 h-4 mr-2"}),"Mon profil"]})}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/settings",className:"cursor-pointer",children:[i.jsx(qC,{className:"w-4 h-4 mr-2"}),"Paramètres"]})}),i.jsx(Eu,{}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/orders",className:"cursor-pointer",children:[i.jsx(gi,{className:"w-4 h-4 mr-2"}),"Mes commandes"]})}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/sales",className:"cursor-pointer",children:[i.jsx(bp,{className:"w-4 h-4 mr-2"}),"Mes ventes"]})}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/payments",className:"cursor-pointer",children:[i.jsx(bp,{className:"w-4 h-4 mr-2"}),"Paiements"]})}),i.jsx(Eu,{}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/favorites",className:"cursor-pointer",children:[i.jsx(Tc,{className:"w-4 h-4 mr-2"}),"Mes favoris"]})}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/saved-searches",className:"cursor-pointer",children:[i.jsx(B3,{className:"w-4 h-4 mr-2"}),"Alertes sauvegardées"]})}),i.jsx(Eu,{}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/messages",className:"cursor-pointer relative",children:[i.jsx(xa,{className:"w-4 h-4 mr-2"}),"Messages",R>0&&i.jsx(Ir,{className:"ml-auto bg-red-500 text-white text-xs min-w-[16px] h-4 flex items-center justify-center px-1",children:R>99?"99+":R})]})}),i.jsx(Eu,{}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/impact",className:"cursor-pointer",children:[i.jsx(Jd,{className:"w-4 h-4 mr-2"}),"Mon impact écologique"]})}),i.jsx(Eu,{}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/help",className:"cursor-pointer",children:[i.jsx(va,{className:"w-4 h-4 mr-2"}),"Aide & Support"]})}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/safety",className:"cursor-pointer",children:[i.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Conseils de sécurité"]})}),i.jsx(Eu,{}),i.jsxs(Oi,{onClick:V,className:"cursor-pointer text-destructive",children:[i.jsx(Bxe,{className:"w-4 h-4 mr-2"}),"Se déconnecter"]})]})]}),i.jsx(Ge,{size:"icon",asChild:!0,className:"md:hidden bg-gradient-to-r from-primary to-secondary h-8 w-8",children:i.jsx(Nr,{to:"/create",children:i.jsx(W_,{className:"w-4 h-4"})})})]}):i.jsxs(i.Fragment,{children:[i.jsx(Ge,{variant:"ghost",asChild:!0,className:"hidden sm:flex h-8 sm:h-9 text-xs sm:text-sm",children:i.jsx(Nr,{to:"/auth",children:"Se connecter"})}),i.jsx(Ge,{asChild:!0,className:"bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 h-8 sm:h-9 text-xs sm:text-sm px-2 sm:px-4",children:i.jsxs(Nr,{to:"/auth",children:[i.jsx("span",{className:"hidden sm:inline",children:"Rejoindre"}),i.jsx("span",{className:"sm:hidden",children:"Connexion"})]})})]}),i.jsxs(XD,{children:[i.jsx(YD,{asChild:!0,className:"sm:hidden",children:i.jsx(Ge,{className:"p-2 text-foreground hover:text-primary transition-colors sm:hidden","aria-label":"Menu mobile",children:i.jsx(Vxe,{className:"w-4 h-4"})})}),i.jsxs(pI,{className:"w-56",align:"end",children:[i.jsxs(Oi,{onClick:()=>a(p==="dark"?"light":"dark"),className:"cursor-pointer",children:[i.jsxs("div",{className:"relative mr-2",children:[i.jsx(p8,{className:"h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),i.jsx(d8,{className:"absolute top-0 left-0 h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"})]}),"Changer le thème"]}),i.jsx(Eu,{}),i.jsx(Oi,{asChild:!0,children:i.jsx(Nr,{to:"/listings",className:"cursor-pointer",children:"Toutes les annonces"})}),i.jsx(Oi,{asChild:!0,children:i.jsx(Nr,{to:"/listings?transactionType=donation",className:"cursor-pointer",children:"Dons entre étudiants"})}),i.jsx(Oi,{asChild:!0,children:i.jsx(Nr,{to:"/listings?transactionType=exchange",className:"cursor-pointer",children:"Troc & Échanges"})}),i.jsx(Oi,{asChild:!0,children:i.jsx(Nr,{to:"/listings?category=services",className:"cursor-pointer",children:"Services étudiants"})}),i.jsx(Oi,{asChild:!0,children:i.jsx(Nr,{to:"/housing",className:"cursor-pointer",children:"Logement & Colocation"})}),i.jsx(Oi,{asChild:!0,children:i.jsx(Nr,{to:"/products",className:"cursor-pointer",children:"Boutique"})}),t&&i.jsxs(i.Fragment,{children:[i.jsx(Eu,{}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/create",className:"cursor-pointer",children:[i.jsx(W_,{className:"w-4 h-4 mr-2"}),"Publier une annonce"]})}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/cart",className:"cursor-pointer relative",children:[i.jsx(wp,{className:"w-4 h-4 mr-2"}),"Panier",W>0&&i.jsx(Ir,{className:"ml-auto bg-red-500 text-white text-xs min-w-[16px] h-4 flex items-center justify-center px-1",children:W>99?"99+":W})]})}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/messages",className:"cursor-pointer relative",children:[i.jsx(xa,{className:"w-4 h-4 mr-2"}),"Messages",R>0&&i.jsx(Ir,{className:"ml-auto bg-red-500 text-white text-xs min-w-[16px] h-4 flex items-center justify-center px-1",children:R>99?"99+":R})]})}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/favorites",className:"cursor-pointer",children:[i.jsx(Tc,{className:"w-4 h-4 mr-2"}),"Mes favoris"]})})]}),!t&&i.jsxs(i.Fragment,{children:[i.jsx(Eu,{}),i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:"/auth",className:"cursor-pointer",children:[i.jsx(Hl,{className:"w-4 h-4 mr-2"}),"Se connecter"]})})]})]})]})]})]})})})};function ESe({icon:t,size:e=100,gradientId:r}){return i.jsxs("svg",{width:e,height:e,viewBox:`0 0 ${e} ${e}`,xmlns:"http://www.w3.org/2000/svg",children:[i.jsx("defs",{children:i.jsxs("linearGradient",{id:r,x1:"0",y1:"0",x2:"1",y2:"1",children:[i.jsx("stop",{offset:"0%",stopColor:"#2ECC71"}),i.jsx("stop",{offset:"100%",stopColor:"#4A90E2"})]})}),i.jsx(t,{width:e,height:e,fill:`url(#${r})`})]})}const TSe=()=>i.jsx("footer",{className:"bg-muted/50 border-t border-border mt-auto",children:i.jsxs("div",{className:"container mx-auto px-4 py-12",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ESe,{icon:up,gradientId:"gradient-footer",size:32}),i.jsxs("div",{children:[i.jsx("span",{className:"font-bold text-xl bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"StudyMarket"}),i.jsx("div",{className:"text-xs text-muted-foreground -mt-1",children:"Étudiants certifiés"})]})]}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"La première plateforme d'échange entre étudiants vérifiés. Achetez, vendez, donnez et échangez en toute sécurité au sein de votre communauté universitaire."}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("a",{href:"https://facebook.com/studymarket",target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-primary transition-colors",children:i.jsx(kxe,{className:"w-5 h-5"})}),i.jsx("a",{href:"https://twitter.com/studymarket",target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-primary transition-colors",children:i.jsx(Wxe,{className:"w-5 h-5"})}),i.jsx("a",{href:"https://instagram.com/studymarket",target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-primary transition-colors",children:i.jsx(Dxe,{className:"w-5 h-5"})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-semibold",children:"Navigation"}),i.jsxs("ul",{className:"space-y-2 text-sm",children:[i.jsx("li",{children:i.jsx(Nr,{to:"/listings",className:"text-muted-foreground hover:text-primary transition-colors",children:"Toutes les annonces"})}),i.jsx("li",{children:i.jsx(Nr,{to:"/listings?transactionType=donation",className:"text-muted-foreground hover:text-primary transition-colors",children:"Dons entre étudiants"})}),i.jsx("li",{children:i.jsx(Nr,{to:"/listings?transactionType=exchange",className:"text-muted-foreground hover:text-primary transition-colors",children:"Troc & Échanges"})}),i.jsx("li",{children:i.jsx(Nr,{to:"/create",className:"text-muted-foreground hover:text-primary transition-colors",children:"Publier une annonce"})}),i.jsx("li",{children:i.jsx(Nr,{to:"/how-it-works",className:"text-muted-foreground hover:text-primary transition-colors",children:"Comment ça marche"})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-semibold",children:"Catégories populaires"}),i.jsxs("ul",{className:"space-y-2 text-sm",children:[i.jsx("li",{children:i.jsx(Nr,{to:"/listings?category=books",className:"text-muted-foreground hover:text-primary transition-colors",children:"Livres & Cours"})}),i.jsx("li",{children:i.jsx(Nr,{to:"/listings?category=electronics",className:"text-muted-foreground hover:text-primary transition-colors",children:"Électronique"})}),i.jsx("li",{children:i.jsx(Nr,{to:"/housing",className:"text-muted-foreground hover:text-primary transition-colors",children:"Logement & Colocation"})}),i.jsx("li",{children:i.jsx(Nr,{to:"/listings?category=services",className:"text-muted-foreground hover:text-primary transition-colors",children:"Services étudiants"})}),i.jsx("li",{children:i.jsx(Nr,{to:"/listings?category=jobs",className:"text-muted-foreground hover:text-primary transition-colors",children:"Jobs & Stages"})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-semibold",children:"Sécurité & Confiance"}),i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[i.jsx(Ms,{className:"w-4 h-4 text-green-600"}),i.jsx("span",{children:"Étudiants 100% vérifiés"})]}),i.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[i.jsx(Jd,{className:"w-4 h-4 text-green-600"}),i.jsx("span",{children:"Impact écologique mesuré"})]}),i.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[i.jsx(Nl,{className:"w-4 h-4"}),i.jsx("span",{children:"support@studymarket.fr"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Nr,{to:"/safety",className:"block text-muted-foreground hover:text-primary transition-colors text-sm",children:"Conseils de sécurité"}),i.jsx(Nr,{to:"/verification",className:"block text-muted-foreground hover:text-primary transition-colors text-sm",children:"Processus de vérification"}),i.jsx(Nr,{to:"/community-guidelines",className:"block text-muted-foreground hover:text-primary transition-colors text-sm",children:"Règles de la communauté"}),i.jsx(Nr,{to:"/help",className:"block text-muted-foreground hover:text-primary transition-colors text-sm",children:"Centre d'aide"})]})]})]}),i.jsxs("div",{className:"border-t border-border mt-8 pt-8 flex flex-col sm:flex-row justify-between items-center",children:[i.jsx("p",{className:"text-muted-foreground text-sm",children:"© 2024 StudyMarket. Tous droits réservés. Plateforme dédiée aux étudiants vérifiés."}),i.jsxs("div",{className:"flex space-x-6 mt-4 sm:mt-0",children:[i.jsx(Nr,{to:"/terms",className:"text-muted-foreground hover:text-primary transition-colors text-sm",children:"Conditions d'utilisation"}),i.jsx(Nr,{to:"/privacy",className:"text-muted-foreground hover:text-primary transition-colors text-sm",children:"Politique de confidentialité"}),i.jsx(Nr,{to:"/cookies",className:"text-muted-foreground hover:text-primary transition-colors text-sm",children:"Cookies"}),i.jsxs("a",{href:"mailto:support@studymarket.fr",className:"text-muted-foreground hover:text-primary transition-colors text-sm flex items-center gap-1",children:[i.jsx(Ec,{className:"w-3 h-3"}),"Contact"]})]})]})]})}),Tt=z.forwardRef(({className:t,...e},r)=>i.jsx("div",{ref:r,className:kn("rounded-xl border bg-card text-card-foreground shadow",t),...e}));Tt.displayName="Card";const Dr=z.forwardRef(({className:t,...e},r)=>i.jsx("div",{ref:r,className:kn("flex flex-col space-y-1.5 p-6",t),...e}));Dr.displayName="CardHeader";const kr=z.forwardRef(({className:t,...e},r)=>i.jsx("h3",{ref:r,className:kn("font-semibold leading-none tracking-tight",t),...e}));kr.displayName="CardTitle";const Ls=z.forwardRef(({className:t,...e},r)=>i.jsx("p",{ref:r,className:kn("text-sm text-muted-foreground",t),...e}));Ls.displayName="CardDescription";const jt=z.forwardRef(({className:t,...e},r)=>i.jsx("div",{ref:r,className:kn("p-6 pt-0",t),...e}));jt.displayName="CardContent";const yX=z.forwardRef(({className:t,...e},r)=>i.jsx("div",{ref:r,className:kn("flex items-center p-6 pt-0",t),...e}));yX.displayName="CardFooter";class jSe{constructor(){Uf(this,"cache",new Map)}set(e,r,n=5*60*1e3){this.cache.set(e,{data:r,timestamp:Date.now(),ttl:n}),console.log(`📦 Cache SET: ${e} (TTL: ${n}ms)`)}get(e){const r=this.cache.get(e);if(!r)return console.log(`❌ Cache MISS: ${e}`),null;const n=Date.now()-r.timestamp;return n>r.ttl?(console.log(`⏰ Cache EXPIRED: ${e} (age: ${n}ms, ttl: ${r.ttl}ms)`),this.cache.delete(e),null):(console.log(`✅ Cache HIT: ${e} (age: ${n}ms)`),r.data)}has(e){return this.get(e)!==null}invalidate(e){this.cache.delete(e)&&console.log(`🗑️ Cache INVALIDATED: ${e}`)}invalidatePrefix(e){let r=0;for(const n of this.cache.keys())n.startsWith(e)&&(this.cache.delete(n),r++);console.log(`🗑️ Cache INVALIDATED (prefix: ${e}): ${r} entries`)}clear(){const e=this.cache.size;this.cache.clear(),console.log(`🗑️ Cache CLEARED: ${e} entries`)}cleanup(){const e=Date.now();let r=0;for(const[n,c]of this.cache.entries())e-c.timestamp>c.ttl&&(this.cache.delete(n),r++);r>0&&console.log(`🧹 Cache CLEANUP: ${r} expired entries removed`)}getStats(){const e=Date.now();let r=0,n=0;for(const c of this.cache.values())e-c.timestamp>c.ttl?n++:r++;return{total:this.cache.size,active:r,expired:n}}}const qv=new jSe;typeof window<"u"&&(setInterval(()=>{qv.cleanup()},5*60*1e3),window.addEventListener("beforeunload",()=>{const t=qv.getStats();console.log("📊 Cache stats avant fermeture:",t)}));const mI=t=>{if(t==null)return null;if(Array.isArray(t))return t.map(mI).filter(e=>e!==void 0);if(typeof t=="object"&&t!==null){const e={};return Object.keys(t).forEach(r=>{const n=mI(t[r]);n!==void 0&&(e[r]=n)}),e}return t},$8=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch(e){return console.warn("Error converting timestamp:",e),new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return t&&typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date},j1=t=>{var r,n,c,d,p,a;const e=t.data();return{id:t.id,...e,createdAt:$8(e.createdAt),updatedAt:$8(e.updatedAt),title:e.title||"Sans titre",description:e.description||"",price:e.price||0,currency:e.currency||"EUR",category:e.category||"electronics",condition:e.condition||"good",images:e.images||[],tags:e.tags||[],location:{city:((r=e.location)==null?void 0:r.city)||"Paris",state:((n=e.location)==null?void 0:n.state)||"Île-de-France",country:((c=e.location)==null?void 0:c.country)||"France",campus:((d=e.location)==null?void 0:d.campus)||null,university:((p=e.location)==null?void 0:p.university)||null,coordinates:((a=e.location)==null?void 0:a.coordinates)||null},transactionType:e.transactionType||"sale",sellerId:e.sellerId||"",sellerName:e.sellerName||"Utilisateur",sellerAvatar:e.sellerAvatar||null,sellerUniversity:e.sellerUniversity||"Université non spécifiée",sellerVerified:e.sellerVerified||!1,status:e.status||"active",views:e.views||0,likes:e.likes||0,saves:e.saves||0,reportCount:e.reportCount||0,moderationStatus:e.moderationStatus||"approved"}},mw=pw((t,e)=>({listings:[],featuredListings:[],currentListing:null,loading:!1,hasMore:!0,lastDoc:null,error:null,realtimeListeners:new Map,fetchListings:async(r={},n=!1)=>{const{listings:c,lastDoc:d}=e();if(!(!n&&!d)){t({loading:!0,error:null});try{let p=ms(jn(rr,"listings"),eo("createdAt","desc"),la(20));!n&&d&&(p=ms(p,aW(d)));const a=await gs(p);let w=a.docs.map(j1);if(r.category&&r.category!=="all"&&(w=w.filter(C=>C.category===r.category)),r.minPrice!==void 0&&(w=w.filter(C=>C.price>=r.minPrice)),r.maxPrice!==void 0&&(w=w.filter(C=>C.price<=r.maxPrice)),r.query){const C=r.query.toLowerCase();w=w.filter(P=>{var R;return P.title.toLowerCase().includes(C)||P.description.toLowerCase().includes(C)||((R=P.tags)==null?void 0:R.some(B=>B.toLowerCase().includes(C)))})}if(r.condition&&r.condition.length>0&&(w=w.filter(C=>r.condition.includes(C.condition))),r.sortBy)switch(r.sortBy){case"price-asc":w.sort((C,P)=>C.price-P.price);break;case"price-desc":w.sort((C,P)=>P.price-C.price);break;case"date":default:w.sort((C,P)=>new Date(P.createdAt).getTime()-new Date(C.createdAt).getTime());break}const E=a.docs[a.docs.length-1];t({listings:n?w:[...c,...w],lastDoc:E,hasMore:a.docs.length===20,loading:!1,error:null})}catch(p){console.error("Error fetching listings:",p);const a=p instanceof Error?p.message:"Erreur inconnue";Nt.error(`Erreur lors du chargement des annonces: ${a}`),t({loading:!1,error:a})}}},fetchFeaturedListings:async()=>{try{console.log("🔍 Fetching featured listings...");const r=ms(jn(rr,"listings"),eo("createdAt","desc"),la(6)),n=await gs(r);console.log(`📊 Found ${n.docs.length} documents`);const c=n.docs.map((d,p)=>{try{console.log(`🔄 Processing document ${p+1}:`,d.id);const a=j1(d);return console.log(`✅ Successfully converted listing: ${a.title}`),a}catch(a){return console.error(`❌ Error converting document ${d.id}:`,a),{id:d.id,title:"Annonce non disponible",description:"Cette annonce ne peut pas être affichée pour le moment.",price:0,currency:"EUR",category:"electronics",condition:"good",images:[],tags:[],location:{city:"Paris",state:"Île-de-France",country:"France",campus:null,university:null,coordinates:null},transactionType:"sale",sellerId:"",sellerName:"Utilisateur",sellerAvatar:null,sellerUniversity:"Université non spécifiée",sellerVerified:!1,status:"active",views:0,likes:0,saves:0,reportCount:0,moderationStatus:"approved",createdAt:new Date,updatedAt:new Date}}});console.log(`🎉 Successfully processed ${c.length} featured listings`),t({featuredListings:c})}catch(r){console.error("❌ Error fetching featured listings:",r),t({featuredListings:[]})}},fetchListingById:async r=>{const n=qv.get(`listing:${r}`);if(n){console.log("✅ Listing from cache:",r),t({currentListing:n,loading:!1});return}t({loading:!0});try{const c=hn(rr,"listings",r),d=await Xa(c);if(d.exists()){const p=j1(d);qv.set(`listing:${r}`,p,5*60*1e3),Rs(c,{views:(p.views||0)+1}).catch(console.error),t({currentListing:p,loading:!1})}else t({currentListing:null,loading:!1}),Nt.error("Annonce introuvable")}catch(c){console.error("Error fetching listing:",c),Nt.error("Erreur lors du chargement de l'annonce"),t({currentListing:null,loading:!1})}},createListing:async r=>{var n,c,d,p,a,w;try{const E=mI({...r,views:0,likes:0,saves:0,reportCount:0,moderationStatus:"approved",status:"active",createdAt:new Date,updatedAt:new Date,location:{city:((n=r.location)==null?void 0:n.city)||"Paris",state:((c=r.location)==null?void 0:c.state)||"Île-de-France",country:((d=r.location)==null?void 0:d.country)||"France",campus:((p=r.location)==null?void 0:p.campus)||null,university:((a=r.location)==null?void 0:a.university)||null,coordinates:((w=r.location)==null?void 0:w.coordinates)||null},currency:r.currency||"EUR",images:r.images||[],tags:r.tags||[],condition:r.condition||"good",transactionType:r.transactionType||"sale"});console.log("Creating listing with data:",E);const C=await af(jn(rr,"listings"),E);return Nt.success("Annonce créée avec succès !"),C.id}catch(E){throw console.error("Error creating listing:",E),Nt.error("Erreur lors de la création de l'annonce"),E}},updateListing:async(r,n)=>{try{const c=hn(rr,"listings",r),d=mI({...n,updatedAt:new Date});await Rs(c,d),qv.invalidate(`listing:${r}`);const{listings:p,currentListing:a}=e(),w=p.map(E=>E.id===r?{...E,...n}:E);t({listings:w,currentListing:(a==null?void 0:a.id)===r?{...a,...n}:a}),Nt.success("Annonce mise à jour !")}catch(c){throw console.error("Error updating listing:",c),Nt.error("Erreur lors de la mise à jour"),c}},deleteListing:async r=>{try{await cd(hn(rr,"listings",r));const{listings:n}=e(),c=n.filter(d=>d.id!==r);t({listings:c}),Nt.success("Annonce supprimée !")}catch(n){throw console.error("Error deleting listing:",n),Nt.error("Erreur lors de la suppression"),n}},searchListings:async r=>{await e().fetchListings(r,!0)},clearListings:()=>{t({listings:[],lastDoc:null,hasMore:!0,currentListing:null})},subscribeToListing:r=>{console.log("🔔 Subscribing to listing:",r);const n=hy(hn(rr,"listings",r),c=>{if(c.exists()){const d=j1(c);qv.set(`listing:${r}`,d,5*60*1e3),t(p=>{var a;return{currentListing:((a=p.currentListing)==null?void 0:a.id)===r?d:p.currentListing,listings:p.listings.map(w=>w.id===r?d:w)}}),console.log("✅ Listing mis à jour en real-time:",r,d.status)}},c=>{console.error("❌ Erreur listener listing:",c)});return e().realtimeListeners.set(`listing:${r}`,n),n},subscribeToListings:(r={})=>{console.log("🔔 Subscribing to listings");let n=ms(jn(rr,"listings"),ii("status","in",["active","sold","reserved"]),eo("createdAt","desc"),la(50));const c=hy(n,d=>{const p=d.docs.map(j1);t({listings:p,loading:!1}),console.log("✅ Listings mis à jour en real-time:",p.length)},d=>{console.error("❌ Erreur listener listings:",d),t({error:d.message})});return e().realtimeListeners.set("listings",c),c},unsubscribeAll:()=>{console.log("🔕 Unsubscribing all listeners");const{realtimeListeners:r}=e();r.forEach((n,c)=>{console.log("🔕 Unsubscribing:",c),n()}),r.clear()}})),q8=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch{return new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return t&&typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date},xX=pw((t,e)=>({favorites:[],userFavoriteIds:new Set,loading:!1,fetchUserFavorites:async r=>{if(r){t({loading:!0});try{const n=ms(jn(rr,"favorites"),ii("userId","==",r),la(100)),c=await gs(n),d=[],p=new Set;c.forEach(a=>{const w=a.data(),E={id:a.id,...w,createdAt:q8(w.createdAt),updatedAt:q8(w.updatedAt)};d.push(E),p.add(E.listingId)}),d.sort((a,w)=>w.createdAt.getTime()-a.createdAt.getTime()),t({favorites:d,userFavoriteIds:p,loading:!1})}catch(n){console.error("Erreur lors du chargement des favoris:",n),Nt.error("Erreur lors du chargement des favoris"),t({loading:!1})}}},addToFavorites:async(r,n)=>{var c;if(!(!r||!n))try{if(e().userFavoriteIds.has(n.id)){Nt.info("Déjà dans vos favoris");return}const d={userId:r,listingId:n.id,listingTitle:n.title,listingPrice:n.price,listingImage:((c=n.images)==null?void 0:c[0])||null,listingCategory:n.category,listingTransactionType:n.transactionType,sellerName:n.sellerName,sellerUniversity:n.sellerUniversity,notes:"",tags:n.tags||[],createdAt:aa(),updatedAt:aa()},a={id:(await af(jn(rr,"favorites"),d)).id,...d,createdAt:new Date,updatedAt:new Date},{favorites:w,userFavoriteIds:E}=e(),C=new Set(E);C.add(n.id),t({favorites:[a,...w],userFavoriteIds:C});try{await Rs(hn(rr,"listings",n.id),{likes:(n.likes||0)+1})}catch(P){console.error("Erreur lors de la mise à jour du compteur de likes:",P)}Nt.success("Ajouté aux favoris ❤️")}catch(d){console.error("Erreur lors de l'ajout aux favoris:",d),Nt.error("Erreur lors de l'ajout aux favoris")}},removeFromFavorites:async(r,n)=>{if(!(!r||!n))try{const c=ms(jn(rr,"favorites"),ii("userId","==",r),ii("listingId","==",n)),d=await gs(c);if(d.empty){Nt.info("Pas dans vos favoris");return}const p=d.docs[0];await cd(hn(rr,"favorites",p.id));const{favorites:a,userFavoriteIds:w}=e(),E=new Set(w);E.delete(n),t({favorites:a.filter(C=>C.listingId!==n),userFavoriteIds:E});try{const C=hn(rr,"listings",n),P=await gs(ms(jn(rr,"listings"),ii("__name__","==",n)));if(!P.empty){const R=P.docs[0].data().likes||0;await Rs(C,{likes:Math.max(0,R-1)})}}catch(C){console.error("Erreur lors de la mise à jour du compteur de likes:",C)}Nt.success("Retiré des favoris")}catch(c){console.error("Erreur lors de la suppression des favoris:",c),Nt.error("Erreur lors de la suppression des favoris")}},isFavorite:r=>e().userFavoriteIds.has(r),toggleFavorite:async(r,n)=>{const{isFavorite:c,addToFavorites:d,removeFromFavorites:p}=e();c(n.id)?await p(r,n.id):await d(r,n)},clearFavorites:()=>{t({favorites:[],userFavoriteIds:new Set,loading:!1})}})),vX=({listing:t,size:e="default",showText:r=!0,className:n=""})=>{const{currentUser:c}=$i(),{isFavorite:d,toggleFavorite:p}=xX(),a=Ra(),w=d(t.id),E=P=>{if(P.preventDefault(),P.stopPropagation(),!c){Nt.error("Connectez-vous pour ajouter aux favoris"),a("/auth");return}p(c.uid,t)},C=()=>{switch(e){case"sm":return"h-8 w-8";case"lg":return"h-10 w-10";default:return"h-9 w-9"}};return i.jsx(Ge,{variant:"ghost",size:"icon",onClick:E,className:`${C()} ${w?"text-red-500 hover:text-red-600":"text-foreground hover:text-red-500"} ${n}`,"aria-label":w?"Retirer des favoris":"Ajouter aux favoris",children:i.jsx(Tc,{className:`w-4 h-4 ${w?"fill-current":""}`})})},wX=({listing:t,size:e="default",showText:r=!0,className:n=""})=>{const c=async p=>{p.preventDefault(),p.stopPropagation();const a={title:t.title,text:`Découvrez cette annonce sur StudyMarket: ${t.title}`,url:window.location.href};try{navigator.share?await navigator.share(a):(await navigator.clipboard.writeText(window.location.href),Nt.success("Lien copié dans le presse-papiers"))}catch(w){console.error("Error sharing:",w)}},d=()=>{switch(e){case"sm":return"h-8 w-8";case"lg":return"h-10 w-10";default:return"h-9 w-9"}};return i.jsx(Ge,{variant:"ghost",size:"icon",onClick:c,className:`${d()} ${n}`,"aria-label":"Partager",children:i.jsx($3,{className:"w-4 h-4"})})};var Tn=(t=>(t.UNVERIFIED="unverified",t.DOCUMENTS_SUBMITTED="documents_submitted",t.UNDER_REVIEW="under_review",t.VERIFIED="verified",t.REJECTED="rejected",t.SUSPENDED="suspended",t))(Tn||{});const D0=({status:t,size:e="md",showText:r=!0})=>{const n=typeof t=="boolean"?t?"verified":"unverified":t,c={sm:"h-4 w-4 text-xs",md:"h-5 w-5 text-sm",lg:"h-6 w-6 text-base"},d={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},a=(()=>{switch(n){case Tn.VERIFIED:case"verified":return{variant:"success",icon:i.jsx(Hd,{className:d[e]}),text:"Vérifié",className:"bg-green-100 text-green-800 border-green-200"};case Tn.DOCUMENTS_SUBMITTED:return{variant:"secondary",icon:i.jsx(wy,{className:d[e]}),text:"En cours",className:"bg-blue-100 text-blue-800 border-blue-200"};case Tn.UNDER_REVIEW:return{variant:"secondary",icon:i.jsx(Fo,{className:d[e]}),text:"En revue",className:"bg-purple-100 text-purple-800 border-purple-200"};case Tn.REJECTED:case"rejected":return{variant:"destructive",icon:i.jsx(fo,{className:d[e]}),text:"Rejeté",className:"bg-red-100 text-red-800 border-red-200"};case Tn.SUSPENDED:return{variant:"destructive",icon:i.jsx(Ms,{className:d[e]}),text:"Suspendu",className:"bg-orange-100 text-orange-800 border-orange-200"};case Tn.UNVERIFIED:default:return{variant:"secondary",icon:i.jsx(Fi,{className:d[e]}),text:"Non vérifié",className:"bg-gray-100 text-gray-800 border-gray-200"}}})();return r?i.jsxs("div",{className:`inline-flex items-center gap-1 rounded-md border pl-2 pr-10 py-1 text-xs font-semibold whitespace-nowrap ${a.className}`,children:[a.icon,i.jsx("span",{className:c[e],children:a.text})]}):i.jsx("div",{className:`inline-flex items-center justify-center rounded-full ${a.className} ${c[e]} p-1 flex-shrink-0`,title:a.text,children:a.icon})};function Ns(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function au(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function wc(t,e){const r=Ns(t);return isNaN(e)?au(t,NaN):(e&&r.setDate(r.getDate()+e),r)}function ah(t,e){const r=Ns(t);if(isNaN(e))return au(t,NaN);if(!e)return r;const n=r.getDate(),c=au(t,r.getTime());c.setMonth(r.getMonth()+e+1,0);const d=c.getDate();return n>=d?c:(r.setFullYear(c.getFullYear(),c.getMonth(),n),r)}const f4=6048e5,NSe=864e5,bj=43200,G8=1440;let ISe={};function gw(){return ISe}function uf(t,e){var a,w,E,C;const r=gw(),n=(e==null?void 0:e.weekStartsOn)??((w=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:w.weekStartsOn)??r.weekStartsOn??((C=(E=r.locale)==null?void 0:E.options)==null?void 0:C.weekStartsOn)??0,c=Ns(t),d=c.getDay(),p=(d<n?7:0)+d-n;return c.setDate(c.getDate()-p),c.setHours(0,0,0,0),c}function Sy(t){return uf(t,{weekStartsOn:1})}function bX(t){const e=Ns(t),r=e.getFullYear(),n=au(t,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const c=Sy(n),d=au(t,0);d.setFullYear(r,0,4),d.setHours(0,0,0,0);const p=Sy(d);return e.getTime()>=c.getTime()?r+1:e.getTime()>=p.getTime()?r:r-1}function O0(t){const e=Ns(t);return e.setHours(0,0,0,0),e}function L0(t){const e=Ns(t),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return r.setUTCFullYear(e.getFullYear()),+t-+r}function Kh(t,e){const r=O0(t),n=O0(e),c=+r-L0(r),d=+n-L0(n);return Math.round((c-d)/NSe)}function CSe(t){const e=bX(t),r=au(t,0);return r.setFullYear(e,0,4),r.setHours(0,0,0,0),Sy(r)}function JD(t,e){const r=e*7;return wc(t,r)}function ASe(t,e){return ah(t,e*12)}function PSe(t){let e;return t.forEach(function(r){const n=Ns(r);(e===void 0||e<n||isNaN(Number(n)))&&(e=n)}),e||new Date(NaN)}function kSe(t){let e;return t.forEach(r=>{const n=Ns(r);(!e||e>n||isNaN(+n))&&(e=n)}),e||new Date(NaN)}function sN(t,e){const r=Ns(t),n=Ns(e),c=r.getTime()-n.getTime();return c<0?-1:c>0?1:c}function RSe(t){return au(t,Date.now())}function Qc(t,e){const r=O0(t),n=O0(e);return+r==+n}function p4(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function MSe(t){if(!p4(t)&&typeof t!="number")return!1;const e=Ns(t);return!isNaN(Number(e))}function F0(t,e){const r=Ns(t),n=Ns(e),c=r.getFullYear()-n.getFullYear(),d=r.getMonth()-n.getMonth();return c*12+d}function DSe(t,e,r){const n=uf(t,r),c=uf(e,r),d=+n-L0(n),p=+c-L0(c);return Math.round((d-p)/f4)}function OSe(t){return e=>{const n=(t?Math[t]:Math.trunc)(e);return n===0?0:n}}function LSe(t,e){return+Ns(t)-+Ns(e)}function FSe(t){const e=Ns(t);return e.setHours(23,59,59,999),e}function aA(t){const e=Ns(t),r=e.getMonth();return e.setFullYear(e.getFullYear(),r+1,0),e.setHours(23,59,59,999),e}function zSe(t){const e=Ns(t);return+FSe(e)==+aA(e)}function BSe(t,e){const r=Ns(t),n=Ns(e),c=sN(r,n),d=Math.abs(F0(r,n));let p;if(d<1)p=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-c*d);let a=sN(r,n)===-c;zSe(Ns(t))&&d===1&&sN(t,n)===1&&(a=!1),p=c*(d-Number(a))}return p===0?0:p}function VSe(t,e,r){const n=LSe(t,e)/1e3;return OSe(r==null?void 0:r.roundingMethod)(n)}function iu(t){const e=Ns(t);return e.setDate(1),e.setHours(0,0,0,0),e}function SX(t){const e=Ns(t),r=au(t,0);return r.setFullYear(e.getFullYear(),0,1),r.setHours(0,0,0,0),r}function m4(t,e){var a,w,E,C;const r=gw(),n=(e==null?void 0:e.weekStartsOn)??((w=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:w.weekStartsOn)??r.weekStartsOn??((C=(E=r.locale)==null?void 0:E.options)==null?void 0:C.weekStartsOn)??0,c=Ns(t),d=c.getDay(),p=(d<n?-7:0)+6-(d-n);return c.setDate(c.getDate()+p),c.setHours(23,59,59,999),c}function EX(t){return m4(t,{weekStartsOn:1})}const USe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},$Se=(t,e,r)=>{let n;const c=USe[t];return typeof c=="string"?n=c:e===1?n=c.one:n=c.other.replace("{{count}}",e.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function o0(t){return(e={})=>{const r=e.width?String(e.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const qSe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},GSe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},HSe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},WSe={date:o0({formats:qSe,defaultWidth:"full"}),time:o0({formats:GSe,defaultWidth:"full"}),dateTime:o0({formats:HSe,defaultWidth:"full"})},ZSe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},KSe=(t,e,r,n)=>ZSe[t];function Gh(t){return(e,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let c;if(n==="formatting"&&t.formattingValues){const p=t.defaultFormattingWidth||t.defaultWidth,a=r!=null&&r.width?String(r.width):p;c=t.formattingValues[a]||t.formattingValues[p]}else{const p=t.defaultWidth,a=r!=null&&r.width?String(r.width):t.defaultWidth;c=t.values[a]||t.values[p]}const d=t.argumentCallback?t.argumentCallback(e):e;return c[d]}}const XSe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},YSe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},JSe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},QSe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},eEe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},tEe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},rEe=(t,e)=>{const r=Number(t),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},nEe={ordinalNumber:rEe,era:Gh({values:XSe,defaultWidth:"wide"}),quarter:Gh({values:YSe,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Gh({values:JSe,defaultWidth:"wide"}),day:Gh({values:QSe,defaultWidth:"wide"}),dayPeriod:Gh({values:eEe,defaultWidth:"wide",formattingValues:tEe,defaultFormattingWidth:"wide"})};function Hh(t){return(e,r={})=>{const n=r.width,c=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],d=e.match(c);if(!d)return null;const p=d[0],a=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],w=Array.isArray(a)?iEe(a,P=>P.test(p)):sEe(a,P=>P.test(p));let E;E=t.valueCallback?t.valueCallback(w):w,E=r.valueCallback?r.valueCallback(E):E;const C=e.slice(p.length);return{value:E,rest:C}}}function sEe(t,e){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return r}function iEe(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return r}function TX(t){return(e,r={})=>{const n=e.match(t.matchPattern);if(!n)return null;const c=n[0],d=e.match(t.parsePattern);if(!d)return null;let p=t.valueCallback?t.valueCallback(d[0]):d[0];p=r.valueCallback?r.valueCallback(p):p;const a=e.slice(c.length);return{value:p,rest:a}}}const aEe=/^(\d+)(th|st|nd|rd)?/i,oEe=/\d+/i,lEe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},cEe={any:[/^b/i,/^(a|c)/i]},uEe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},dEe={any:[/1/i,/2/i,/3/i,/4/i]},hEe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},fEe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},pEe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},mEe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},gEe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},_Ee={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},yEe={ordinalNumber:TX({matchPattern:aEe,parsePattern:oEe,valueCallback:t=>parseInt(t,10)}),era:Hh({matchPatterns:lEe,defaultMatchWidth:"wide",parsePatterns:cEe,defaultParseWidth:"any"}),quarter:Hh({matchPatterns:uEe,defaultMatchWidth:"wide",parsePatterns:dEe,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Hh({matchPatterns:hEe,defaultMatchWidth:"wide",parsePatterns:fEe,defaultParseWidth:"any"}),day:Hh({matchPatterns:pEe,defaultMatchWidth:"wide",parsePatterns:mEe,defaultParseWidth:"any"}),dayPeriod:Hh({matchPatterns:gEe,defaultMatchWidth:"any",parsePatterns:_Ee,defaultParseWidth:"any"})},g4={code:"en-US",formatDistance:$Se,formatLong:WSe,formatRelative:KSe,localize:nEe,match:yEe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function xEe(t){const e=Ns(t);return Kh(e,SX(e))+1}function jX(t){const e=Ns(t),r=+Sy(e)-+CSe(e);return Math.round(r/f4)+1}function NX(t,e){var C,P,R,B;const r=Ns(t),n=r.getFullYear(),c=gw(),d=(e==null?void 0:e.firstWeekContainsDate)??((P=(C=e==null?void 0:e.locale)==null?void 0:C.options)==null?void 0:P.firstWeekContainsDate)??c.firstWeekContainsDate??((B=(R=c.locale)==null?void 0:R.options)==null?void 0:B.firstWeekContainsDate)??1,p=au(t,0);p.setFullYear(n+1,0,d),p.setHours(0,0,0,0);const a=uf(p,e),w=au(t,0);w.setFullYear(n,0,d),w.setHours(0,0,0,0);const E=uf(w,e);return r.getTime()>=a.getTime()?n+1:r.getTime()>=E.getTime()?n:n-1}function vEe(t,e){var a,w,E,C;const r=gw(),n=(e==null?void 0:e.firstWeekContainsDate)??((w=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:w.firstWeekContainsDate)??r.firstWeekContainsDate??((C=(E=r.locale)==null?void 0:E.options)==null?void 0:C.firstWeekContainsDate)??1,c=NX(t,e),d=au(t,0);return d.setFullYear(c,0,n),d.setHours(0,0,0,0),uf(d,e)}function IX(t,e){const r=Ns(t),n=+uf(r,e)-+vEe(r,e);return Math.round(n/f4)+1}function ea(t,e){const r=t<0?"-":"",n=Math.abs(t).toString().padStart(e,"0");return r+n}const Nm={y(t,e){const r=t.getFullYear(),n=r>0?r:1-r;return ea(e==="yy"?n%100:n,e.length)},M(t,e){const r=t.getMonth();return e==="M"?String(r+1):ea(r+1,2)},d(t,e){return ea(t.getDate(),e.length)},a(t,e){const r=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,e){return ea(t.getHours()%12||12,e.length)},H(t,e){return ea(t.getHours(),e.length)},m(t,e){return ea(t.getMinutes(),e.length)},s(t,e){return ea(t.getSeconds(),e.length)},S(t,e){const r=e.length,n=t.getMilliseconds(),c=Math.trunc(n*Math.pow(10,r-3));return ea(c,e.length)}},mv={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},H8={G:function(t,e,r){const n=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(t,e,r){if(e==="yo"){const n=t.getFullYear(),c=n>0?n:1-n;return r.ordinalNumber(c,{unit:"year"})}return Nm.y(t,e)},Y:function(t,e,r,n){const c=NX(t,n),d=c>0?c:1-c;if(e==="YY"){const p=d%100;return ea(p,2)}return e==="Yo"?r.ordinalNumber(d,{unit:"year"}):ea(d,e.length)},R:function(t,e){const r=bX(t);return ea(r,e.length)},u:function(t,e){const r=t.getFullYear();return ea(r,e.length)},Q:function(t,e,r){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return ea(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,e,r){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return ea(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,e,r){const n=t.getMonth();switch(e){case"M":case"MM":return Nm.M(t,e);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(t,e,r){const n=t.getMonth();switch(e){case"L":return String(n+1);case"LL":return ea(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(t,e,r,n){const c=IX(t,n);return e==="wo"?r.ordinalNumber(c,{unit:"week"}):ea(c,e.length)},I:function(t,e,r){const n=jX(t);return e==="Io"?r.ordinalNumber(n,{unit:"week"}):ea(n,e.length)},d:function(t,e,r){return e==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):Nm.d(t,e)},D:function(t,e,r){const n=xEe(t);return e==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):ea(n,e.length)},E:function(t,e,r){const n=t.getDay();switch(e){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(t,e,r,n){const c=t.getDay(),d=(c-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(d);case"ee":return ea(d,2);case"eo":return r.ordinalNumber(d,{unit:"day"});case"eee":return r.day(c,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(c,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(c,{width:"short",context:"formatting"});case"eeee":default:return r.day(c,{width:"wide",context:"formatting"})}},c:function(t,e,r,n){const c=t.getDay(),d=(c-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(d);case"cc":return ea(d,e.length);case"co":return r.ordinalNumber(d,{unit:"day"});case"ccc":return r.day(c,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(c,{width:"narrow",context:"standalone"});case"cccccc":return r.day(c,{width:"short",context:"standalone"});case"cccc":default:return r.day(c,{width:"wide",context:"standalone"})}},i:function(t,e,r){const n=t.getDay(),c=n===0?7:n;switch(e){case"i":return String(c);case"ii":return ea(c,e.length);case"io":return r.ordinalNumber(c,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(t,e,r){const c=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(c,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(c,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(c,{width:"wide",context:"formatting"})}},b:function(t,e,r){const n=t.getHours();let c;switch(n===12?c=mv.noon:n===0?c=mv.midnight:c=n/12>=1?"pm":"am",e){case"b":case"bb":return r.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(c,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(c,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(c,{width:"wide",context:"formatting"})}},B:function(t,e,r){const n=t.getHours();let c;switch(n>=17?c=mv.evening:n>=12?c=mv.afternoon:n>=4?c=mv.morning:c=mv.night,e){case"B":case"BB":case"BBB":return r.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(c,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(c,{width:"wide",context:"formatting"})}},h:function(t,e,r){if(e==="ho"){let n=t.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return Nm.h(t,e)},H:function(t,e,r){return e==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):Nm.H(t,e)},K:function(t,e,r){const n=t.getHours()%12;return e==="Ko"?r.ordinalNumber(n,{unit:"hour"}):ea(n,e.length)},k:function(t,e,r){let n=t.getHours();return n===0&&(n=24),e==="ko"?r.ordinalNumber(n,{unit:"hour"}):ea(n,e.length)},m:function(t,e,r){return e==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):Nm.m(t,e)},s:function(t,e,r){return e==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):Nm.s(t,e)},S:function(t,e){return Nm.S(t,e)},X:function(t,e,r){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return Z8(n);case"XXXX":case"XX":return P_(n);case"XXXXX":case"XXX":default:return P_(n,":")}},x:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"x":return Z8(n);case"xxxx":case"xx":return P_(n);case"xxxxx":case"xxx":default:return P_(n,":")}},O:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+W8(n,":");case"OOOO":default:return"GMT"+P_(n,":")}},z:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+W8(n,":");case"zzzz":default:return"GMT"+P_(n,":")}},t:function(t,e,r){const n=Math.trunc(t.getTime()/1e3);return ea(n,e.length)},T:function(t,e,r){const n=t.getTime();return ea(n,e.length)}};function W8(t,e=""){const r=t>0?"-":"+",n=Math.abs(t),c=Math.trunc(n/60),d=n%60;return d===0?r+String(c):r+String(c)+e+ea(d,2)}function Z8(t,e){return t%60===0?(t>0?"-":"+")+ea(Math.abs(t)/60,2):P_(t,e)}function P_(t,e=""){const r=t>0?"-":"+",n=Math.abs(t),c=ea(Math.trunc(n/60),2),d=ea(n%60,2);return r+c+e+d}const K8=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},CX=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},wEe=(t,e)=>{const r=t.match(/(P+)(p+)?/)||[],n=r[1],c=r[2];if(!c)return K8(t,e);let d;switch(n){case"P":d=e.dateTime({width:"short"});break;case"PP":d=e.dateTime({width:"medium"});break;case"PPP":d=e.dateTime({width:"long"});break;case"PPPP":default:d=e.dateTime({width:"full"});break}return d.replace("{{date}}",K8(n,e)).replace("{{time}}",CX(c,e))},bEe={p:CX,P:wEe},SEe=/^D+$/,EEe=/^Y+$/,TEe=["D","DD","YY","YYYY"];function jEe(t){return SEe.test(t)}function NEe(t){return EEe.test(t)}function IEe(t,e,r){const n=CEe(t,e,r);if(console.warn(n),TEe.includes(t))throw new RangeError(n)}function CEe(t,e,r){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const AEe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,PEe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,kEe=/^'([^]*?)'?$/,REe=/''/g,MEe=/[a-zA-Z]/;function Pa(t,e,r){var C,P,R,B,V,W,K,Z;const n=gw(),c=(r==null?void 0:r.locale)??n.locale??g4,d=(r==null?void 0:r.firstWeekContainsDate)??((P=(C=r==null?void 0:r.locale)==null?void 0:C.options)==null?void 0:P.firstWeekContainsDate)??n.firstWeekContainsDate??((B=(R=n.locale)==null?void 0:R.options)==null?void 0:B.firstWeekContainsDate)??1,p=(r==null?void 0:r.weekStartsOn)??((W=(V=r==null?void 0:r.locale)==null?void 0:V.options)==null?void 0:W.weekStartsOn)??n.weekStartsOn??((Z=(K=n.locale)==null?void 0:K.options)==null?void 0:Z.weekStartsOn)??0,a=Ns(t);if(!MSe(a))throw new RangeError("Invalid time value");let w=e.match(PEe).map($=>{const X=$[0];if(X==="p"||X==="P"){const Q=bEe[X];return Q($,c.formatLong)}return $}).join("").match(AEe).map($=>{if($==="''")return{isToken:!1,value:"'"};const X=$[0];if(X==="'")return{isToken:!1,value:DEe($)};if(H8[X])return{isToken:!0,value:$};if(X.match(MEe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+X+"`");return{isToken:!1,value:$}});c.localize.preprocessor&&(w=c.localize.preprocessor(a,w));const E={firstWeekContainsDate:d,weekStartsOn:p,locale:c};return w.map($=>{if(!$.isToken)return $.value;const X=$.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&NEe(X)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&jEe(X))&&IEe(X,e,String(t));const Q=H8[X[0]];return Q(a,X,c.localize,E)}).join("")}function DEe(t){const e=t.match(kEe);return e?e[1].replace(REe,"'"):t}function OEe(t,e,r){const n=gw(),c=(r==null?void 0:r.locale)??n.locale??g4,d=2520,p=sN(t,e);if(isNaN(p))throw new RangeError("Invalid time value");const a=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:p});let w,E;p>0?(w=Ns(e),E=Ns(t)):(w=Ns(t),E=Ns(e));const C=VSe(E,w),P=(L0(E)-L0(w))/1e3,R=Math.round((C-P)/60);let B;if(R<2)return r!=null&&r.includeSeconds?C<5?c.formatDistance("lessThanXSeconds",5,a):C<10?c.formatDistance("lessThanXSeconds",10,a):C<20?c.formatDistance("lessThanXSeconds",20,a):C<40?c.formatDistance("halfAMinute",0,a):C<60?c.formatDistance("lessThanXMinutes",1,a):c.formatDistance("xMinutes",1,a):R===0?c.formatDistance("lessThanXMinutes",1,a):c.formatDistance("xMinutes",R,a);if(R<45)return c.formatDistance("xMinutes",R,a);if(R<90)return c.formatDistance("aboutXHours",1,a);if(R<G8){const V=Math.round(R/60);return c.formatDistance("aboutXHours",V,a)}else{if(R<d)return c.formatDistance("xDays",1,a);if(R<bj){const V=Math.round(R/G8);return c.formatDistance("xDays",V,a)}else if(R<bj*2)return B=Math.round(R/bj),c.formatDistance("aboutXMonths",B,a)}if(B=BSe(E,w),B<12){const V=Math.round(R/bj);return c.formatDistance("xMonths",V,a)}else{const V=B%12,W=Math.trunc(B/12);return V<3?c.formatDistance("aboutXYears",W,a):V<9?c.formatDistance("overXYears",W,a):c.formatDistance("almostXYears",W+1,a)}}function _w(t,e){return OEe(t,RSe(t),e)}function LEe(t){const e=Ns(t),r=e.getFullYear(),n=e.getMonth(),c=au(t,0);return c.setFullYear(r,n+1,0),c.setHours(0,0,0,0),c.getDate()}function FEe(t){return Math.trunc(+Ns(t)/1e3)}function zEe(t){const e=Ns(t),r=e.getMonth();return e.setFullYear(e.getFullYear(),r+1,0),e.setHours(0,0,0,0),e}function BEe(t,e){return DSe(zEe(t),iu(t),e)+1}function QD(t,e){const r=Ns(t),n=Ns(e);return r.getTime()>n.getTime()}function AX(t,e){const r=Ns(t),n=Ns(e);return+r<+n}function _4(t,e){const r=Ns(t),n=Ns(e);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function VEe(t,e){const r=Ns(t),n=Ns(e);return r.getFullYear()===n.getFullYear()}function LR(t,e){return wc(t,-e)}function FR(t,e){const r=Ns(t),n=r.getFullYear(),c=r.getDate(),d=au(t,0);d.setFullYear(n,e,15),d.setHours(0,0,0,0);const p=LEe(d);return r.setMonth(e,Math.min(c,p)),r}function X8(t,e){const r=Ns(t);return isNaN(+r)?au(t,NaN):(r.setFullYear(e),r)}const UEe={lessThanXSeconds:{one:"moins d’une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins d’une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus d’un an",other:"plus de {{count}} ans"},almostXYears:{one:"presqu’un an",other:"presque {{count}} ans"}},$Ee=(t,e,r)=>{let n;const c=UEe[t];return typeof c=="string"?n=c:e===1?n=c.one:n=c.other.replace("{{count}}",String(e)),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"dans "+n:"il y a "+n:n},qEe={full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},GEe={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},HEe={full:"{{date}} 'à' {{time}}",long:"{{date}} 'à' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},WEe={date:o0({formats:qEe,defaultWidth:"full"}),time:o0({formats:GEe,defaultWidth:"full"}),dateTime:o0({formats:HEe,defaultWidth:"full"})},ZEe={lastWeek:"eeee 'dernier à' p",yesterday:"'hier à' p",today:"'aujourd’hui à' p",tomorrow:"'demain à' p'",nextWeek:"eeee 'prochain à' p",other:"P"},KEe=(t,e,r,n)=>ZEe[t],XEe={narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant Jésus-Christ","après Jésus-Christ"]},YEe={narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2ème trim.","3ème trim.","4ème trim."],wide:["1er trimestre","2ème trimestre","3ème trimestre","4ème trimestre"]},JEe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],wide:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"]},QEe={narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},eTe={narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"après-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de l’après-midi",evening:"du soir",night:"du matin"}},tTe=(t,e)=>{const r=Number(t),n=e==null?void 0:e.unit;if(r===0)return"0";const c=["year","week","hour","minute","second"];let d;return r===1?d=n&&c.includes(n)?"ère":"er":d="ème",r+d},rTe=["MMM","MMMM"],nTe={preprocessor:(t,e)=>t.getDate()===1||!e.some(n=>n.isToken&&rTe.includes(n.value))?e:e.map(n=>n.isToken&&n.value==="do"?{isToken:!0,value:"d"}:n),ordinalNumber:tTe,era:Gh({values:XEe,defaultWidth:"wide"}),quarter:Gh({values:YEe,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Gh({values:JEe,defaultWidth:"wide"}),day:Gh({values:QEe,defaultWidth:"wide"}),dayPeriod:Gh({values:eTe,defaultWidth:"wide"})},sTe=/^(\d+)(ième|ère|ème|er|e)?/i,iTe=/\d+/i,aTe={narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant Jésus-Christ|après Jésus-Christ)/i},oTe={any:[/^av/i,/^ap/i]},lTe={narrow:/^T?[1234]/i,abbreviated:/^[1234](er|ème|e)? trim\.?/i,wide:/^[1234](er|ème|e)? trimestre/i},cTe={any:[/1/i,/2/i,/3/i,/4/i]},uTe={narrow:/^[jfmasond]/i,abbreviated:/^(janv|févr|mars|avr|mai|juin|juill|juil|août|sept|oct|nov|déc)\.?/i,wide:/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i},dTe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},hTe={narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},fTe={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},pTe={narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'après[-\s]midi|du soir|de la nuit)/i},mTe={any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},gTe={ordinalNumber:TX({matchPattern:sTe,parsePattern:iTe,valueCallback:t=>parseInt(t)}),era:Hh({matchPatterns:aTe,defaultMatchWidth:"wide",parsePatterns:oTe,defaultParseWidth:"any"}),quarter:Hh({matchPatterns:lTe,defaultMatchWidth:"wide",parsePatterns:cTe,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Hh({matchPatterns:uTe,defaultMatchWidth:"wide",parsePatterns:dTe,defaultParseWidth:"any"}),day:Hh({matchPatterns:hTe,defaultMatchWidth:"wide",parsePatterns:fTe,defaultParseWidth:"any"}),dayPeriod:Hh({matchPatterns:pTe,defaultMatchWidth:"any",parsePatterns:mTe,defaultParseWidth:"any"})},po={code:"fr",formatDistance:$Ee,formatLong:WEe,formatRelative:KEe,localize:nTe,match:gTe,options:{weekStartsOn:1,firstWeekContainsDate:4}},XS=({listing:t,showActions:e=!1,onEdit:r,onDelete:n})=>{var V,W,K,Z,$,X;const c=(Q,re)=>{if(t.transactionType==="donation")return"Gratuit";if(t.transactionType==="exchange")return"Échange";const ve=re||"EUR";try{return new Intl.NumberFormat("fr-FR",{style:"currency",currency:ve}).format(Q)}catch{return`${Q} €`}},d=Q=>{switch(Q){case"new":return"bg-emerald-100 text-emerald-700 border-emerald-200";case"like-new":return"bg-blue-100 text-blue-700 border-blue-200";case"good":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"fair":return"bg-blue-100 text-blue-700 border-blue-200";case"poor":return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},p=Q=>{switch(Q){case"new":return"Neuf";case"like-new":return"Comme neuf";case"good":return"Bon état";case"fair":return"État correct";case"poor":return"Mauvais état";default:return Q}},a=()=>{switch(t.transactionType){case"donation":return i.jsx(P0,{className:"w-3 h-3"});case"exchange":return i.jsx(Yo,{className:"w-3 h-3"});default:return null}},w=()=>{switch(t.transactionType){case"donation":return"bg-green-500 text-white hover:bg-green-600";case"exchange":return"bg-purple-500 text-white hover:bg-purple-600";default:return"bg-primary text-white hover:bg-primary/90"}},E=Q=>{try{let re;if(!Q)return"Date inconnue";if(Q instanceof Date)re=Q;else if(typeof Q=="string"||typeof Q=="number")re=new Date(Q);else if(Q&&typeof Q.toDate=="function")re=Q.toDate();else if(Q&&typeof Q=="object"&&Q.seconds)re=new Date(Q.seconds*1e3);else return"Date inconnue";return isNaN(re.getTime())?"Date inconnue":_w(re,{addSuffix:!0,locale:po})}catch(re){return console.warn("Error formatting date:",re),"Date inconnue"}},C=t.price||0,P=t.currency||"EUR",R=t.condition||"good",B=t.transactionType||"sale";return i.jsxs(Tt,{className:"group relative bg-card text-card-foreground rounded-xl border border-border hover:border-border shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden w-full max-w-sm",children:[i.jsx(Nr,{to:`/listing/${t.id}`,className:"block",children:i.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-gray-100",children:[i.jsx("img",{src:((V=t.images)==null?void 0:V[0])||"/placeholder.jpg",alt:t.title,className:"w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-500"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/10 via-transparent to-black/20 pointer-events-none"}),i.jsxs("div",{className:"absolute top-3 right-3 flex flex-col gap-2",children:[i.jsx(vX,{listing:t,size:"sm",className:"bg-white/90 dark:bg-black/40 backdrop-blur-sm hover:bg-white dark:hover:bg-black/60 shadow-sm border-0 rounded-full p-2"}),i.jsx(wX,{listing:t,size:"sm",className:"bg-white/90 dark:bg-black/40 backdrop-blur-sm hover:bg-white dark:hover:bg-black/60 shadow-sm border-0 rounded-full p-2"})]}),B!=="sale"&&i.jsxs(Ir,{className:`absolute top-3 left-3 ${w()} border-0 shadow-sm font-medium px-3 py-1.5 rounded-full`,children:[a(),i.jsx("span",{className:"ml-1.5 text-sm",children:B==="donation"?"Don":"Troc"})]}),t.status==="sold"&&i.jsx(Ir,{className:"absolute top-3 left-3 bg-red-500 text-white font-bold px-4 py-2 rounded-full shadow-md border-0",children:"VENDU"}),B==="sale"&&t.status!=="sold"&&i.jsx(Ir,{className:`absolute top-3 left-3 ${d(R)} font-medium px-3 py-1.5 rounded-full shadow-sm`,children:p(R)}),t.environmentalImpact&&i.jsxs(Ir,{className:"absolute bottom-3 left-3 bg-emerald-500 text-white border-0 shadow-sm font-medium px-3 py-1.5 rounded-full",children:[i.jsx(Jd,{className:"w-3 h-3 mr-1.5"}),"-",t.environmentalImpact.co2Saved,"kg CO₂"]}),t.images&&t.images.length>1&&i.jsxs("div",{className:"absolute bottom-3 right-3 bg-black/70 backdrop-blur-sm text-white text-sm px-2.5 py-1 rounded-full font-medium",children:["+",t.images.length-1]})]})}),i.jsxs(jt,{className:"p-6 space-y-4",children:[i.jsxs(Nr,{to:`/listing/${t.id}`,className:"block",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("span",{className:`text-2xl font-bold ${B==="donation"?"text-green-600":B==="exchange"?"text-purple-600":"text-foreground"}`,children:c(C,P)}),i.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground bg-muted px-2.5 py-1 rounded-full",children:[i.jsx(Fo,{className:"w-3.5 h-3.5"}),i.jsx("span",{className:"font-medium",children:t.views||0})]})]}),i.jsx("h3",{className:"text-lg font-semibold text-foreground line-clamp-2 mb-3 leading-tight text-left",children:t.title||"Sans titre"}),B==="exchange"&&t.exchangeFor&&i.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground dark:text-purple-200 bg-purple-50 dark:bg-purple-900/20 px-3 py-2 rounded-lg mb-4",children:[i.jsx(Yo,{className:"w-4 h-4 text-purple-500"}),i.jsxs("span",{children:[i.jsx("span",{className:"font-medium",children:"Contre:"})," ",t.exchangeFor]})]}),i.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground mb-4",children:[i.jsxs("div",{className:"flex items-center gap-1.5 flex-1 min-w-0",children:[i.jsx(dl,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),i.jsx("span",{className:"truncate",children:((W=t.location)==null?void 0:W.campus)||((K=t.location)!=null&&K.city&&((Z=t.location)!=null&&Z.state)?`${t.location.city}, ${t.location.state}`:"Localisation non spécifiée")})]}),i.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0 ml-3",children:[i.jsx(Fi,{className:"w-4 h-4 text-muted-foreground"}),i.jsx("span",{className:"whitespace-nowrap",children:E(t.createdAt)})]})]})]}),i.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[i.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[i.jsxs(Jc,{className:"w-9 h-9 border-2 border-border",children:[i.jsx(cf,{src:t.sellerAvatar}),i.jsx(Sc,{className:"text-sm bg-muted text-muted-foreground font-medium",children:((X=($=t.sellerName)==null?void 0:$[0])==null?void 0:X.toUpperCase())||"U"})]}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:t.sellerName||"Utilisateur"}),t.sellerVerificationStatus?i.jsx(D0,{status:t.sellerVerificationStatus,size:"sm",showText:!1}):t.sellerVerified&&i.jsx(Ms,{className:"w-4 h-4 text-green-500 flex-shrink-0"})]}),i.jsx("span",{className:"text-xs text-muted-foreground truncate block text-left",children:t.sellerUniversity||"Université non spécifiée"})]})]}),t.aiPriceEstimate&&B==="sale"&&i.jsx(Ir,{className:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border-green-200 dark:border-green-800 hover:bg-green-100 text-xs font-medium px-2.5 py-1 rounded-full flex-shrink-0 ml-2",children:"Prix juste ✓"})]}),e&&i.jsxs("div",{className:"flex items-center justify-end gap-2 pt-3 border-t border-border",children:[i.jsxs(Ge,{variant:"outline",size:"sm",onClick:()=>r==null?void 0:r(t),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:hover:bg-blue-950/20",children:[i.jsx(gZ,{className:"w-4 h-4 mr-1"}),"Modifier"]}),i.jsxs(Ge,{variant:"outline",size:"sm",onClick:()=>n==null?void 0:n(t),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950/20",children:[i.jsx(nd,{className:"w-4 h-4 mr-1"}),"Supprimer"]})]})]})]})};var PX={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Y8=_n.createContext&&_n.createContext(PX),_Te=["attr","size","title"];function yTe(t,e){if(t==null)return{};var r=xTe(t,e),n,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(t);for(c=0;c<d.length;c++)n=d[c],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function xTe(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function gI(){return gI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},gI.apply(this,arguments)}function J8(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,n)}return r}function _I(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?J8(Object(r),!0).forEach(function(n){vTe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):J8(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function vTe(t,e,r){return e=wTe(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function wTe(t){var e=bTe(t,"string");return typeof e=="symbol"?e:e+""}function bTe(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function kX(t){return t&&t.map((e,r)=>_n.createElement(e.tag,_I({key:r},e.attr),kX(e.child)))}function kg(t){return e=>_n.createElement(STe,gI({attr:_I({},t.attr)},e),kX(t.child))}function STe(t){var e=r=>{var{attr:n,size:c,title:d}=t,p=yTe(t,_Te),a=c||r.size||"1em",w;return r.className&&(w=r.className),t.className&&(w=(w?w+" ":"")+t.className),_n.createElement("svg",gI({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,p,{className:w,style:_I(_I({color:t.color||r.color},r.style),t.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),d&&_n.createElement("title",null,d),t.children)};return Y8!==void 0?_n.createElement(Y8.Consumer,null,r=>e(r)):e(PX)}function ETe(t){return kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M16 9.226l-8-6.21-8 6.21v-2.532l8-6.21 8 6.21zM14 9v6h-4v-4h-4v4h-4v-6l6-4.5z"},child:[]}]})(t)}function TTe(t){return kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M14 2v13h-10.5c-0.829 0-1.5-0.672-1.5-1.5s0.671-1.5 1.5-1.5h9.5v-12h-10c-1.1 0-2 0.9-2 2v12c0 1.1 0.9 2 2 2h12v-14h-1z"},child:[]},{tag:"path",attr:{d:"M3.501 13v0c-0 0-0.001 0-0.001 0-0.276 0-0.5 0.224-0.5 0.5s0.224 0.5 0.5 0.5c0 0 0.001-0 0.001-0v0h9.498v-1h-9.498z"},child:[]}]})(t)}function jTe(t){return kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 0c-2.761 0-5 2.239-5 5 0 5 5 11 5 11s5-6 5-11c0-2.761-2.239-5-5-5zM8 8c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"},child:[]}]})(t)}function NTe(t){return kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M11.5 0h-7c-0.825 0-1.5 0.675-1.5 1.5v13c0 0.825 0.675 1.5 1.5 1.5h7c0.825 0 1.5-0.675 1.5-1.5v-13c0-0.825-0.675-1.5-1.5-1.5zM6 0.75h4v0.5h-4v-0.5zM8 15c-0.552 0-1-0.448-1-1s0.448-1 1-1 1 0.448 1 1-0.448 1-1 1zM12 12h-8v-10h8v10z"},child:[]}]})(t)}function ITe(t){return kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 18 16"},child:[{tag:"path",attr:{d:"M12 12.041v-0.825c1.102-0.621 2-2.168 2-3.716 0-2.485 0-4.5-3-4.5s-3 2.015-3 4.5c0 1.548 0.898 3.095 2 3.716v0.825c-3.392 0.277-6 1.944-6 3.959h14c0-2.015-2.608-3.682-6-3.959z"},child:[]},{tag:"path",attr:{d:"M5.112 12.427c0.864-0.565 1.939-0.994 3.122-1.256-0.235-0.278-0.449-0.588-0.633-0.922-0.475-0.863-0.726-1.813-0.726-2.748 0-1.344 0-2.614 0.478-3.653 0.464-1.008 1.299-1.633 2.488-1.867-0.264-1.195-0.968-1.98-2.841-1.98-3 0-3 2.015-3 4.5 0 1.548 0.898 3.095 2 3.716v0.825c-3.392 0.277-6 1.944-6 3.959h4.359c0.227-0.202 0.478-0.393 0.753-0.573z"},child:[]}]})(t)}function CTe(t){return kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M5 3c0-1.657 1.343-3 3-3s3 1.343 3 3c0 1.657-1.343 3-3 3s-3-1.343-3-3zM12.001 7h-0.553l-3.111 6.316 1.163-5.816-1.5-1.5-1.5 1.5 1.163 5.816-3.111-6.316h-0.554c-1.999 0-1.999 1.344-1.999 3v5h12v-5c0-1.656 0-3-1.999-3z"},child:[]}]})(t)}function ATe(t){return kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 0c-4.355 0-7.898 3.481-7.998 7.812 0.092-3.779 2.966-6.812 6.498-6.812 3.59 0 6.5 3.134 6.5 7 0 0.828 0.672 1.5 1.5 1.5s1.5-0.672 1.5-1.5c0-4.418-3.582-8-8-8zM8 16c4.355 0 7.898-3.481 7.998-7.812-0.092 3.779-2.966 6.812-6.498 6.812-3.59 0-6.5-3.134-6.5-7 0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5c0 4.418 3.582 8 8 8z"},child:[]}]})(t)}function PTe(t){return kg({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M12.055 5c0.283-0.201 0.555-0.425 0.804-0.674 0.522-0.522 0.871-1.164 0.983-1.808 0.123-0.706-0.057-1.362-0.494-1.798-0.348-0.348-0.82-0.533-1.365-0.533-0.775 0-1.593 0.372-2.242 1.021-1.039 1.039-1.644 2.472-1.97 3.496-0.241-1.028-0.722-2.416-1.657-3.351-0.501-0.501-1.142-0.759-1.748-0.759-0.495 0-0.965 0.172-1.317 0.523-0.781 0.781-0.675 2.153 0.236 3.064 0.325 0.325 0.705 0.595 1.105 0.819h-3.391v4h1v7h12v-7h1v-4h-2.945zM10.536 2.003c0.433-0.433 0.974-0.692 1.446-0.692 0.167 0 0.402 0.035 0.57 0.203 0.407 0.407 0.178 1.349-0.489 2.016-0.687 0.687-1.61 1.159-2.413 1.47h-0.792c0.29-0.899 0.813-2.132 1.678-2.997zM3.655 2.514c-0.011-0.143-0.001-0.41 0.191-0.601 0.16-0.16 0.372-0.194 0.521-0.194v0c0.332 0 0.679 0.157 0.952 0.429 0.529 0.529 0.965 1.371 1.26 2.436 0.008 0.029 0.016 0.057 0.023 0.086-0.028-0.008-0.057-0.015-0.086-0.023-1.064-0.295-1.906-0.731-2.436-1.26-0.247-0.247-0.403-0.565-0.426-0.872zM7 15h-4v-6.5h4v6.5zM7 8h-5v-2h5v2zM13 15h-4v-6.5h4v6.5zM14 8h-5v-2h5v2z"},child:[]}]})(t)}const kTe=()=>{const[t,e]=z.useState(""),r=Ra(),n=c=>{c.preventDefault(),t.trim()&&r(`/listings?search=${encodeURIComponent(t.trim())}`)};return i.jsx("form",{onSubmit:n,className:"w-full max-w-2xl mx-auto",children:i.jsxs("div",{className:"relative flex items-center",children:[i.jsx(Oo,{className:"absolute left-3 text-muted-foreground w-4 h-4"}),i.jsx(Gr,{type:"text",placeholder:"Rechercher des annonces, services, logements...",value:t,onChange:c=>e(c.target.value),className:"pl-10 pr-24 h-12 text-base"}),i.jsx(Ge,{type:"submit",className:"absolute right-1 h-10 px-4 bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90",children:"Rechercher"})]})})},RTe={electronics:"/StudyMarket/assets/Icon/Gradient/electronic.svg",books:"/StudyMarket/assets/Icon/Gradient/livre.svg",furniture:"/StudyMarket/assets/Icon/Gradient/mobilier.svg",housing:"/StudyMarket/assets/Icon/Gradient/logement.svg",services:"/StudyMarket/assets/Icon/Gradient/services.svg",jobs:"/StudyMarket/assets/Icon/Gradient/job.svg",donations:"/StudyMarket/assets/Icon/Gradient/don.svg",exchange:"/StudyMarket/assets/Icon/Gradient/troc.svg"},MTe=({className:t})=>i.jsx("img",{src:"/StudyMarket/assets/Icon/Gradient/launch.svg",alt:"Trending Up",className:t}),DTe=({className:t})=>i.jsx("img",{src:"/StudyMarket/assets/Icon/Gradient/handshake.svg",alt:"Give Up",className:t}),OTe=({className:t})=>i.jsx("img",{src:"/StudyMarket/assets/Icon/Gradient/refresh.svg",alt:"Exchange",className:t}),LTe=({className:t})=>i.jsx("img",{src:"/StudyMarket/assets/Icon/Bleu/chat.svg",alt:"Chat",className:t}),FTe=[{id:"electronics",name:"Électronique",icon:NTe,color:"text-blue-600",description:"Ordinateurs, téléphones, accessoires tech"},{id:"books",name:"Livres & Cours",icon:TTe,color:"text-blue-600",description:"Manuels, livres, notes de cours"},{id:"furniture",name:"Mobilier",icon:ETe,color:"text-blue-600",description:"Meubles, déco, électroménager"},{id:"housing",name:"Logement",icon:jTe,color:"text-blue-600",description:"Colocations, studios, chambres"},{id:"services",name:"Services",icon:ITe,color:"text-blue-600",description:"Cours particuliers, aide, babysitting"},{id:"jobs",name:"Jobs & Stages",icon:CTe,color:"text-blue-600",description:"Petits boulots, stages, missions"},{id:"donations",name:"Dons",icon:PTe,color:"text-blue-600",description:"Objets gratuits, entraide"},{id:"exchange",name:"Troc",icon:ATe,color:"text-blue-600",description:"Échanges de services et objets"}],zTe=[{icon:Ms,title:"Étudiants vérifiés uniquement",description:'Chaque membre est vérifié avec son adresse universitaire. Badge "Étudiant certifié" sur tous les profils.'},{icon:LTe,title:"Chat sécurisé intégré",description:"Messagerie avec proposition de rendez-vous, points de rencontre campus et protection des données."},{icon:Jd,title:"Impact écologique mesuré",description:"Suivez votre impact environnemental : CO₂ économisé, ressources préservées grâce à vos achats d'occasion."},{icon:nZ,title:"Avis publics et réputation",description:"Système de notation transparent. Consultez les avis avant chaque transaction pour échanger en confiance."}],BTe=[{title:"Vendre rapidement",description:"Publiez votre annonce en moins d'une minute",icon:MTe,link:"/create",color:"border-2 border-green-500 text-green-500"},{title:"Donner gratuitement",description:"Offrez ce dont vous n'avez plus besoin",icon:DTe,link:"/create?type=donation",color:"border-2 border-green-500 text-green-500"},{title:"Proposer un troc",description:"Échangez services et objets sans argent",icon:OTe,link:"/create?type=exchange",color:"border-2 border-green-500 text-green-500"}],VTe=()=>{const{featuredListings:t,fetchFeaturedListings:e}=mw();return z.useEffect(()=>{e()},[e]),i.jsxs("div",{className:"w-full min-h-screen bg-gray-50 dark:bg-gray-950",children:[i.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 py-3 sm:py-4"}),i.jsxs("section",{className:"relative bg-gradient-to-br from-primary/10 via-background to-secondary/10 rounded-lg sm:rounded-xl overflow-hidden mb-8",children:[i.jsx("div",{className:"w-full py-6 sm:py-8 lg:py-12 px-3 sm:px-6 lg:px-8"}),i.jsxs("div",{className:"container mx-auto text-center max-w-4xl",children:[i.jsx("div",{className:"flex items-center justify-center mb-3 sm:mb-4 lg:mb-6",children:i.jsxs(Ir,{className:"bg-green-100 text-green-800 border-green-200 px-2 sm:px-3 lg:px-4 py-1 sm:py-1.5 lg:py-2 text-xs sm:text-sm",children:[i.jsx(Ms,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),i.jsx("span",{className:"hidden sm:inline",children:"Communauté 100% étudiants vérifiés"}),i.jsx("span",{className:"sm:hidden",children:"Étudiants vérifiés"})]})}),i.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl xl:text-5xl font-bold mb-3 sm:mb-4 lg:mb-6 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent px-2",children:"La marketplace des étudiants"}),i.jsx("p",{className:"text-sm sm:text-base lg:text-lg text-muted-foreground mb-4 sm:mb-6 lg:mb-8 max-w-2xl mx-auto px-2",children:"Achetez, vendez, donnez et échangez entre étudiants certifiés de votre région. Sécurisé, écologique et pensé pour la vie étudiante."}),i.jsx("div",{className:"mb-4 sm:mb-6 lg:mb-8 px-2 sm:px-4",children:i.jsx(kTe,{})}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 sm:mb-8",children:BTe.map((r,n)=>i.jsx(Nr,{to:r.link,className:"group",children:i.jsx(Tt,{className:"border-2 hover:border-primary/20 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:i.jsxs(jt,{className:"p-3 sm:p-4 text-center",children:[i.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 ${r.color} rounded-full flex items-center justify-center mx-auto mb-2 sm:mb-3 group-hover:scale-110 transition-transform`,children:i.jsx(r.icon,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),i.jsx("h3",{className:"font-semibold mb-1 text-sm sm:text-base",children:r.title}),i.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:r.description})]})})},n))}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center px-2",children:[i.jsx(Ge,{size:"lg",asChild:!0,className:"bg-gradient-to-r from-primary to-secondary w-full sm:w-auto text-sm sm:text-base",children:i.jsxs(Nr,{to:"/listings",children:["Parcourir les annonces",i.jsx(fg,{className:"w-4 h-4 ml-2"})]})}),i.jsx(Ge,{size:"lg",variant:"outline",asChild:!0,className:"w-full sm:w-auto text-sm sm:text-base",children:i.jsx(Nr,{to:"/auth",children:"Rejoindre la communauté"})})]})]})]}),i.jsx("section",{className:"py-8 sm:py-10 lg:py-16 px-2 sm:px-4",children:i.jsxs("div",{className:"container mx-auto",children:[i.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-center mb-2 sm:mb-3 lg:mb-4",children:"Catégories étudiantes"}),i.jsx("p",{className:"text-center text-muted-foreground mb-6 sm:mb-8 lg:mb-12 max-w-2xl mx-auto text-xs sm:text-sm lg:text-base px-2",children:"Des catégories pensées spécifiquement pour la vie étudiante, avec des filtres adaptés à vos besoins"}),i.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4",children:FTe.map(r=>{let n;return r.id==="jobs"?n="/jobs":r.id==="housing"?n="/housing":n=`/listings?category=${r.id}`,i.jsx(Nr,{to:n,className:"group",children:i.jsx(Tt,{className:"h-full transition-all duration-300 hover:shadow-lg hover:-translate-y-1 border-2 hover:border-primary/20",children:i.jsxs(jt,{className:"p-3 sm:p-4 text-center",children:[i.jsx("img",{src:RTe[r.id],alt:r.name,className:"w-8 h-8 sm:w-12 sm:h-12 lg:w-16 lg:h-16 mx-auto mb-2 sm:mb-3"}),i.jsx("h3",{className:"font-semibold text-xs sm:text-sm lg:text-base mb-1",children:r.name}),i.jsx("p",{className:"text-xs text-muted-foreground hidden sm:block",children:r.description})]})})},r.id)})})]})}),t.length>0&&i.jsx("section",{className:"py-8 sm:py-12 lg:py-16 px-2 sm:px-4 bg-muted/30",children:i.jsxs("div",{className:"container mx-auto",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[i.jsx("div",{className:"text-center sm:text-left",children:i.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1 sm:mb-2",children:"Annonces récentes"})}),i.jsx(Ge,{variant:"outline",asChild:!0,className:"w-full sm:w-auto",children:i.jsxs(Nr,{to:"/listings",children:["Voir tout",i.jsx(fg,{className:"w-4 h-4 ml-2"})]})})]}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:t.slice(0,6).map(r=>i.jsx(XS,{listing:r},r.id))})]})}),i.jsx("section",{className:"py-8 sm:py-12 lg:py-16 px-2 sm:px-4",children:i.jsxs("div",{className:"container mx-auto",children:[i.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-center mb-3 sm:mb-4",children:"Pourquoi StudyMarket ?"}),i.jsx("p",{className:"text-center text-muted-foreground mb-8 sm:mb-12 max-w-2xl mx-auto text-sm sm:text-base px-2",children:"Une plateforme pensée par et pour les étudiants, avec des fonctionnalités uniques pour votre sécurité et votre tranquillité d'esprit"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:zTe.map((r,n)=>i.jsx(Tt,{className:"border-0 shadow-none",children:i.jsx(jt,{className:"p-4 sm:p-6",children:i.jsxs("div",{className:"flex items-start space-x-3 sm:space-x-4",children:[i.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0",children:i.jsx(r.icon,{className:"w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6 text-primary"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold mb-1 sm:mb-2",children:r.title}),i.jsx("p",{className:"text-xs sm:text-sm lg:text-base text-muted-foreground",children:r.description})]})]})})},n))})]})}),i.jsx("section",{className:"py-8 sm:py-12 lg:py-16 px-2 sm:px-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-emerald-950/20 rounded-lg sm:rounded-xl",children:i.jsx("div",{className:"container mx-auto text-center",children:i.jsxs("div",{className:"max-w-3xl mx-auto",children:[i.jsx(Jd,{className:"w-8 h-8 sm:w-12 sm:h-12 lg:w-16 lg:h-16 text-green-600 mx-auto mb-4 sm:mb-6"}),i.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-3 sm:mb-4",children:"Votre impact écologique compte"}),i.jsx("p",{className:"text-sm sm:text-base lg:text-xl text-muted-foreground mb-6 sm:mb-8 px-2",children:"Chaque achat d'occasion évite la production d'un objet neuf. Suivez votre impact environnemental et découvrez combien de CO₂ vous économisez grâce à vos échanges étudiants."}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-green-600 mb-1 sm:mb-2",children:"2.5T"}),i.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground",children:"CO₂ économisé par la communauté"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-green-600 mb-1 sm:mb-2",children:"15K"}),i.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground",children:"Objets donnés cette année"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-green-600 mb-1 sm:mb-2",children:"8K"}),i.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground",children:"Étudiants engagés"})]})]}),i.jsx(Ge,{size:"lg",variant:"outline",className:"border-green-600 text-green-600 hover:bg-green-600 hover:text-white w-full sm:w-auto",children:i.jsx(Nr,{to:"/impact",className:"cursor-pointer",children:"Découvrir mon impact"})})]})})}),i.jsx("section",{className:"py-8 sm:py-12 lg:py-16 px-2 sm:px-4 bg-gradient-to-r from-primary to-secondary rounded-lg sm:rounded-xl",children:i.jsxs("div",{className:"container mx-auto text-center",children:[i.jsx(up,{className:"w-8 h-8 sm:w-12 sm:h-12 lg:w-16 lg:h-16 text-white mx-auto mb-4 sm:mb-6"}),i.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-white mb-3 sm:mb-4",children:"Rejoignez la communauté étudiante"}),i.jsx("p",{className:"text-sm sm:text-base lg:text-xl text-white/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-2",children:"Plus de 10 000 étudiants font déjà confiance à StudyMarket pour leurs achats, ventes et échanges. Rejoignez une communauté sûre, vérifiée et solidaire."}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center",children:[i.jsx(Ge,{size:"lg",variant:"secondary",asChild:!0,className:"w-full sm:w-auto",children:i.jsxs(Nr,{to:"/auth",children:[i.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Inscription vérifiée"]})}),i.jsx(Ge,{size:"lg",variant:"outline",className:"border-white text-white bg-transparent hover:bg-white hover:text-primary w-full sm:w-auto",asChild:!0,children:i.jsx(Nr,{to:"/listings",children:"Commencer à explorer"})})]})]})})]})};function YS(t,[e,r]){return Math.min(r,Math.max(e,t))}function y4(t){const e=z.useRef({value:t,previous:t});return z.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var UTe="VisuallyHidden",RX=z.forwardRef((t,e)=>i.jsx(Pn.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));RX.displayName=UTe;var $Te=[" ","Enter","ArrowUp","ArrowDown"],qTe=[" ","Enter"],WE="Select",[oA,lA,GTe]=FE(WE),[yw,yLe]=hd(WE,[GTe,fw]),cA=fw(),[HTe,Rg]=yw(WE),[WTe,ZTe]=yw(WE),MX=t=>{const{__scopeSelect:e,children:r,open:n,defaultOpen:c,onOpenChange:d,value:p,defaultValue:a,onValueChange:w,dir:E,name:C,autoComplete:P,disabled:R,required:B,form:V}=t,W=cA(e),[K,Z]=z.useState(null),[$,X]=z.useState(null),[Q,re]=z.useState(!1),ve=Fy(E),[pe=!1,ue]=ud({prop:n,defaultProp:c,onChange:d}),[ge,ce]=ud({prop:p,defaultProp:a,onChange:w}),Se=z.useRef(null),le=K?V||!!K.closest("form"):!0,[J,ke]=z.useState(new Set),Ze=Array.from(J).map(Xe=>Xe.props.value).join(";");return i.jsx(t4,{...W,children:i.jsxs(HTe,{required:B,scope:e,trigger:K,onTriggerChange:Z,valueNode:$,onValueNodeChange:X,valueNodeHasChildren:Q,onValueNodeHasChildrenChange:re,contentId:ku(),value:ge,onValueChange:ce,open:pe,onOpenChange:ue,dir:ve,triggerPointerDownPosRef:Se,disabled:R,children:[i.jsx(oA.Provider,{scope:e,children:i.jsx(WTe,{scope:t.__scopeSelect,onNativeOptionAdd:z.useCallback(Xe=>{ke(qe=>new Set(qe).add(Xe))},[]),onNativeOptionRemove:z.useCallback(Xe=>{ke(qe=>{const $e=new Set(qe);return $e.delete(Xe),$e})},[]),children:r})}),le?i.jsxs(iY,{"aria-hidden":!0,required:B,tabIndex:-1,name:C,autoComplete:P,value:ge,onChange:Xe=>ce(Xe.target.value),disabled:R,form:V,children:[ge===void 0?i.jsx("option",{value:""}):null,Array.from(J)]},Ze):null]})})};MX.displayName=WE;var DX="SelectTrigger",OX=z.forwardRef((t,e)=>{const{__scopeSelect:r,disabled:n=!1,...c}=t,d=cA(r),p=Rg(DX,r),a=p.disabled||n,w=Fs(e,p.onTriggerChange),E=lA(r),C=z.useRef("touch"),[P,R,B]=aY(W=>{const K=E().filter(X=>!X.disabled),Z=K.find(X=>X.value===p.value),$=oY(K,W,Z);$!==void 0&&p.onValueChange($.value)}),V=W=>{a||(p.onOpenChange(!0),B()),W&&(p.triggerPointerDownPosRef.current={x:Math.round(W.pageX),y:Math.round(W.pageY)})};return i.jsx(YC,{asChild:!0,...d,children:i.jsx(Pn.button,{type:"button",role:"combobox","aria-controls":p.contentId,"aria-expanded":p.open,"aria-required":p.required,"aria-autocomplete":"none",dir:p.dir,"data-state":p.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":sY(p.value)?"":void 0,...c,ref:w,onClick:tn(c.onClick,W=>{W.currentTarget.focus(),C.current!=="mouse"&&V(W)}),onPointerDown:tn(c.onPointerDown,W=>{C.current=W.pointerType;const K=W.target;K.hasPointerCapture(W.pointerId)&&K.releasePointerCapture(W.pointerId),W.button===0&&W.ctrlKey===!1&&W.pointerType==="mouse"&&(V(W),W.preventDefault())}),onKeyDown:tn(c.onKeyDown,W=>{const K=P.current!=="";!(W.ctrlKey||W.altKey||W.metaKey)&&W.key.length===1&&R(W.key),!(K&&W.key===" ")&&$Te.includes(W.key)&&(V(),W.preventDefault())})})})});OX.displayName=DX;var LX="SelectValue",FX=z.forwardRef((t,e)=>{const{__scopeSelect:r,className:n,style:c,children:d,placeholder:p="",...a}=t,w=Rg(LX,r),{onValueNodeHasChildrenChange:E}=w,C=d!==void 0,P=Fs(e,w.onValueNodeChange);return Jo(()=>{E(C)},[E,C]),i.jsx(Pn.span,{...a,ref:P,style:{pointerEvents:"none"},children:sY(w.value)?i.jsx(i.Fragment,{children:p}):d})});FX.displayName=LX;var KTe="SelectIcon",zX=z.forwardRef((t,e)=>{const{__scopeSelect:r,children:n,...c}=t;return i.jsx(Pn.span,{"aria-hidden":!0,...c,ref:e,children:n||"▼"})});zX.displayName=KTe;var XTe="SelectPortal",BX=t=>i.jsx(UE,{asChild:!0,...t});BX.displayName=XTe;var Ey="SelectContent",VX=z.forwardRef((t,e)=>{const r=Rg(Ey,t.__scopeSelect),[n,c]=z.useState();if(Jo(()=>{c(new DocumentFragment)},[]),!r.open){const d=n;return d?Y0.createPortal(i.jsx(UX,{scope:t.__scopeSelect,children:i.jsx(oA.Slot,{scope:t.__scopeSelect,children:i.jsx("div",{children:t.children})})}),d):null}return i.jsx($X,{...t,ref:e})});VX.displayName=Ey;var Ld=10,[UX,Mg]=yw(Ey),YTe="SelectContentImpl",$X=z.forwardRef((t,e)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:c,onEscapeKeyDown:d,onPointerDownOutside:p,side:a,sideOffset:w,align:E,alignOffset:C,arrowPadding:P,collisionBoundary:R,collisionPadding:B,sticky:V,hideWhenDetached:W,avoidCollisions:K,...Z}=t,$=Rg(Ey,r),[X,Q]=z.useState(null),[re,ve]=z.useState(null),pe=Fs(e,Wt=>Q(Wt)),[ue,ge]=z.useState(null),[ce,Se]=z.useState(null),le=lA(r),[J,ke]=z.useState(!1),Ze=z.useRef(!1);z.useEffect(()=>{if(X)return eA(X)},[X]),WC();const Xe=z.useCallback(Wt=>{const[Wr,...jr]=le().map(Zn=>Zn.ref.current),[Br]=jr.slice(-1),on=document.activeElement;for(const Zn of Wt)if(Zn===on||(Zn==null||Zn.scrollIntoView({block:"nearest"}),Zn===Wr&&re&&(re.scrollTop=0),Zn===Br&&re&&(re.scrollTop=re.scrollHeight),Zn==null||Zn.focus(),document.activeElement!==on))return},[le,re]),qe=z.useCallback(()=>Xe([ue,X]),[Xe,ue,X]);z.useEffect(()=>{J&&qe()},[J,qe]);const{onOpenChange:$e,triggerPointerDownPosRef:st}=$;z.useEffect(()=>{if(X){let Wt={x:0,y:0};const Wr=Br=>{var on,Zn;Wt={x:Math.abs(Math.round(Br.pageX)-(((on=st.current)==null?void 0:on.x)??0)),y:Math.abs(Math.round(Br.pageY)-(((Zn=st.current)==null?void 0:Zn.y)??0))}},jr=Br=>{Wt.x<=10&&Wt.y<=10?Br.preventDefault():X.contains(Br.target)||$e(!1),document.removeEventListener("pointermove",Wr),st.current=null};return st.current!==null&&(document.addEventListener("pointermove",Wr),document.addEventListener("pointerup",jr,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Wr),document.removeEventListener("pointerup",jr,{capture:!0})}}},[X,$e,st]),z.useEffect(()=>{const Wt=()=>$e(!1);return window.addEventListener("blur",Wt),window.addEventListener("resize",Wt),()=>{window.removeEventListener("blur",Wt),window.removeEventListener("resize",Wt)}},[$e]);const[it,Mt]=aY(Wt=>{const Wr=le().filter(on=>!on.disabled),jr=Wr.find(on=>on.ref.current===document.activeElement),Br=oY(Wr,Wt,jr);Br&&setTimeout(()=>Br.ref.current.focus())}),ar=z.useCallback((Wt,Wr,jr)=>{const Br=!Ze.current&&!jr;($.value!==void 0&&$.value===Wr||Br)&&(ge(Wt),Br&&(Ze.current=!0))},[$.value]),St=z.useCallback(()=>X==null?void 0:X.focus(),[X]),Xt=z.useCallback((Wt,Wr,jr)=>{const Br=!Ze.current&&!jr;($.value!==void 0&&$.value===Wr||Br)&&Se(Wt)},[$.value]),dt=n==="popper"?eO:qX,ft=dt===eO?{side:a,sideOffset:w,align:E,alignOffset:C,arrowPadding:P,collisionBoundary:R,collisionPadding:B,sticky:V,hideWhenDetached:W,avoidCollisions:K}:{};return i.jsx(UX,{scope:r,content:X,viewport:re,onViewportChange:ve,itemRefCallback:ar,selectedItem:ue,onItemLeave:St,itemTextRefCallback:Xt,focusSelectedItem:qe,selectedItemText:ce,position:n,isPositioned:J,searchRef:it,children:i.jsx($E,{as:Ep,allowPinchZoom:!0,children:i.jsx(BE,{asChild:!0,trapped:$.open,onMountAutoFocus:Wt=>{Wt.preventDefault()},onUnmountAutoFocus:tn(c,Wt=>{var Wr;(Wr=$.trigger)==null||Wr.focus({preventScroll:!0}),Wt.preventDefault()}),children:i.jsx(zE,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:Wt=>Wt.preventDefault(),onDismiss:()=>$.onOpenChange(!1),children:i.jsx(dt,{role:"listbox",id:$.contentId,"data-state":$.open?"open":"closed",dir:$.dir,onContextMenu:Wt=>Wt.preventDefault(),...Z,...ft,onPlaced:()=>ke(!0),ref:pe,style:{display:"flex",flexDirection:"column",outline:"none",...Z.style},onKeyDown:tn(Z.onKeyDown,Wt=>{const Wr=Wt.ctrlKey||Wt.altKey||Wt.metaKey;if(Wt.key==="Tab"&&Wt.preventDefault(),!Wr&&Wt.key.length===1&&Mt(Wt.key),["ArrowUp","ArrowDown","Home","End"].includes(Wt.key)){let Br=le().filter(on=>!on.disabled).map(on=>on.ref.current);if(["ArrowUp","End"].includes(Wt.key)&&(Br=Br.slice().reverse()),["ArrowUp","ArrowDown"].includes(Wt.key)){const on=Wt.target,Zn=Br.indexOf(on);Br=Br.slice(Zn+1)}setTimeout(()=>Xe(Br)),Wt.preventDefault()}})})})})})})});$X.displayName=YTe;var JTe="SelectItemAlignedPosition",qX=z.forwardRef((t,e)=>{const{__scopeSelect:r,onPlaced:n,...c}=t,d=Rg(Ey,r),p=Mg(Ey,r),[a,w]=z.useState(null),[E,C]=z.useState(null),P=Fs(e,pe=>C(pe)),R=lA(r),B=z.useRef(!1),V=z.useRef(!0),{viewport:W,selectedItem:K,selectedItemText:Z,focusSelectedItem:$}=p,X=z.useCallback(()=>{if(d.trigger&&d.valueNode&&a&&E&&W&&K&&Z){const pe=d.trigger.getBoundingClientRect(),ue=E.getBoundingClientRect(),ge=d.valueNode.getBoundingClientRect(),ce=Z.getBoundingClientRect();if(d.dir!=="rtl"){const on=ce.left-ue.left,Zn=ge.left-on,ln=pe.left-Zn,dr=pe.width+ln,Vr=Math.max(dr,ue.width),nn=window.innerWidth-Ld,Ln=YS(Zn,[Ld,Math.max(Ld,nn-Vr)]);a.style.minWidth=dr+"px",a.style.left=Ln+"px"}else{const on=ue.right-ce.right,Zn=window.innerWidth-ge.right-on,ln=window.innerWidth-pe.right-Zn,dr=pe.width+ln,Vr=Math.max(dr,ue.width),nn=window.innerWidth-Ld,Ln=YS(Zn,[Ld,Math.max(Ld,nn-Vr)]);a.style.minWidth=dr+"px",a.style.right=Ln+"px"}const Se=R(),le=window.innerHeight-Ld*2,J=W.scrollHeight,ke=window.getComputedStyle(E),Ze=parseInt(ke.borderTopWidth,10),Xe=parseInt(ke.paddingTop,10),qe=parseInt(ke.borderBottomWidth,10),$e=parseInt(ke.paddingBottom,10),st=Ze+Xe+J+$e+qe,it=Math.min(K.offsetHeight*5,st),Mt=window.getComputedStyle(W),ar=parseInt(Mt.paddingTop,10),St=parseInt(Mt.paddingBottom,10),Xt=pe.top+pe.height/2-Ld,dt=le-Xt,ft=K.offsetHeight/2,Wt=K.offsetTop+ft,Wr=Ze+Xe+Wt,jr=st-Wr;if(Wr<=Xt){const on=Se.length>0&&K===Se[Se.length-1].ref.current;a.style.bottom="0px";const Zn=E.clientHeight-W.offsetTop-W.offsetHeight,ln=Math.max(dt,ft+(on?St:0)+Zn+qe),dr=Wr+ln;a.style.height=dr+"px"}else{const on=Se.length>0&&K===Se[0].ref.current;a.style.top="0px";const ln=Math.max(Xt,Ze+W.offsetTop+(on?ar:0)+ft)+jr;a.style.height=ln+"px",W.scrollTop=Wr-Xt+W.offsetTop}a.style.margin=`${Ld}px 0`,a.style.minHeight=it+"px",a.style.maxHeight=le+"px",n==null||n(),requestAnimationFrame(()=>B.current=!0)}},[R,d.trigger,d.valueNode,a,E,W,K,Z,d.dir,n]);Jo(()=>X(),[X]);const[Q,re]=z.useState();Jo(()=>{E&&re(window.getComputedStyle(E).zIndex)},[E]);const ve=z.useCallback(pe=>{pe&&V.current===!0&&(X(),$==null||$(),V.current=!1)},[X,$]);return i.jsx(e2e,{scope:r,contentWrapper:a,shouldExpandOnScrollRef:B,onScrollButtonChange:ve,children:i.jsx("div",{ref:w,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Q},children:i.jsx(Pn.div,{...c,ref:P,style:{boxSizing:"border-box",maxHeight:"100%",...c.style}})})})});qX.displayName=JTe;var QTe="SelectPopperPosition",eO=z.forwardRef((t,e)=>{const{__scopeSelect:r,align:n="start",collisionPadding:c=Ld,...d}=t,p=cA(r);return i.jsx(r4,{...p,...d,ref:e,align:n,collisionPadding:c,style:{boxSizing:"border-box",...d.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});eO.displayName=QTe;var[e2e,x4]=yw(Ey,{}),tO="SelectViewport",GX=z.forwardRef((t,e)=>{const{__scopeSelect:r,nonce:n,...c}=t,d=Mg(tO,r),p=x4(tO,r),a=Fs(e,d.onViewportChange),w=z.useRef(0);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),i.jsx(oA.Slot,{scope:r,children:i.jsx(Pn.div,{"data-radix-select-viewport":"",role:"presentation",...c,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...c.style},onScroll:tn(c.onScroll,E=>{const C=E.currentTarget,{contentWrapper:P,shouldExpandOnScrollRef:R}=p;if(R!=null&&R.current&&P){const B=Math.abs(w.current-C.scrollTop);if(B>0){const V=window.innerHeight-Ld*2,W=parseFloat(P.style.minHeight),K=parseFloat(P.style.height),Z=Math.max(W,K);if(Z<V){const $=Z+B,X=Math.min(V,$),Q=$-X;P.style.height=X+"px",P.style.bottom==="0px"&&(C.scrollTop=Q>0?Q:0,P.style.justifyContent="flex-end")}}}w.current=C.scrollTop})})})]})});GX.displayName=tO;var HX="SelectGroup",[t2e,r2e]=yw(HX),n2e=z.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,c=ku();return i.jsx(t2e,{scope:r,id:c,children:i.jsx(Pn.div,{role:"group","aria-labelledby":c,...n,ref:e})})});n2e.displayName=HX;var WX="SelectLabel",ZX=z.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,c=r2e(WX,r);return i.jsx(Pn.div,{id:c.id,...n,ref:e})});ZX.displayName=WX;var yI="SelectItem",[s2e,KX]=yw(yI),XX=z.forwardRef((t,e)=>{const{__scopeSelect:r,value:n,disabled:c=!1,textValue:d,...p}=t,a=Rg(yI,r),w=Mg(yI,r),E=a.value===n,[C,P]=z.useState(d??""),[R,B]=z.useState(!1),V=Fs(e,$=>{var X;return(X=w.itemRefCallback)==null?void 0:X.call(w,$,n,c)}),W=ku(),K=z.useRef("touch"),Z=()=>{c||(a.onValueChange(n),a.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return i.jsx(s2e,{scope:r,value:n,disabled:c,textId:W,isSelected:E,onItemTextChange:z.useCallback($=>{P(X=>X||(($==null?void 0:$.textContent)??"").trim())},[]),children:i.jsx(oA.ItemSlot,{scope:r,value:n,disabled:c,textValue:C,children:i.jsx(Pn.div,{role:"option","aria-labelledby":W,"data-highlighted":R?"":void 0,"aria-selected":E&&R,"data-state":E?"checked":"unchecked","aria-disabled":c||void 0,"data-disabled":c?"":void 0,tabIndex:c?void 0:-1,...p,ref:V,onFocus:tn(p.onFocus,()=>B(!0)),onBlur:tn(p.onBlur,()=>B(!1)),onClick:tn(p.onClick,()=>{K.current!=="mouse"&&Z()}),onPointerUp:tn(p.onPointerUp,()=>{K.current==="mouse"&&Z()}),onPointerDown:tn(p.onPointerDown,$=>{K.current=$.pointerType}),onPointerMove:tn(p.onPointerMove,$=>{var X;K.current=$.pointerType,c?(X=w.onItemLeave)==null||X.call(w):K.current==="mouse"&&$.currentTarget.focus({preventScroll:!0})}),onPointerLeave:tn(p.onPointerLeave,$=>{var X;$.currentTarget===document.activeElement&&((X=w.onItemLeave)==null||X.call(w))}),onKeyDown:tn(p.onKeyDown,$=>{var Q;((Q=w.searchRef)==null?void 0:Q.current)!==""&&$.key===" "||(qTe.includes($.key)&&Z(),$.key===" "&&$.preventDefault())})})})})});XX.displayName=yI;var V1="SelectItemText",YX=z.forwardRef((t,e)=>{const{__scopeSelect:r,className:n,style:c,...d}=t,p=Rg(V1,r),a=Mg(V1,r),w=KX(V1,r),E=ZTe(V1,r),[C,P]=z.useState(null),R=Fs(e,Z=>P(Z),w.onItemTextChange,Z=>{var $;return($=a.itemTextRefCallback)==null?void 0:$.call(a,Z,w.value,w.disabled)}),B=C==null?void 0:C.textContent,V=z.useMemo(()=>i.jsx("option",{value:w.value,disabled:w.disabled,children:B},w.value),[w.disabled,w.value,B]),{onNativeOptionAdd:W,onNativeOptionRemove:K}=E;return Jo(()=>(W(V),()=>K(V)),[W,K,V]),i.jsxs(i.Fragment,{children:[i.jsx(Pn.span,{id:w.textId,...d,ref:R}),w.isSelected&&p.valueNode&&!p.valueNodeHasChildren?Y0.createPortal(d.children,p.valueNode):null]})});YX.displayName=V1;var JX="SelectItemIndicator",QX=z.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t;return KX(JX,r).isSelected?i.jsx(Pn.span,{"aria-hidden":!0,...n,ref:e}):null});QX.displayName=JX;var rO="SelectScrollUpButton",eY=z.forwardRef((t,e)=>{const r=Mg(rO,t.__scopeSelect),n=x4(rO,t.__scopeSelect),[c,d]=z.useState(!1),p=Fs(e,n.onScrollButtonChange);return Jo(()=>{if(r.viewport&&r.isPositioned){let a=function(){const E=w.scrollTop>0;d(E)};const w=r.viewport;return a(),w.addEventListener("scroll",a),()=>w.removeEventListener("scroll",a)}},[r.viewport,r.isPositioned]),c?i.jsx(rY,{...t,ref:p,onAutoScroll:()=>{const{viewport:a,selectedItem:w}=r;a&&w&&(a.scrollTop=a.scrollTop-w.offsetHeight)}}):null});eY.displayName=rO;var nO="SelectScrollDownButton",tY=z.forwardRef((t,e)=>{const r=Mg(nO,t.__scopeSelect),n=x4(nO,t.__scopeSelect),[c,d]=z.useState(!1),p=Fs(e,n.onScrollButtonChange);return Jo(()=>{if(r.viewport&&r.isPositioned){let a=function(){const E=w.scrollHeight-w.clientHeight,C=Math.ceil(w.scrollTop)<E;d(C)};const w=r.viewport;return a(),w.addEventListener("scroll",a),()=>w.removeEventListener("scroll",a)}},[r.viewport,r.isPositioned]),c?i.jsx(rY,{...t,ref:p,onAutoScroll:()=>{const{viewport:a,selectedItem:w}=r;a&&w&&(a.scrollTop=a.scrollTop+w.offsetHeight)}}):null});tY.displayName=nO;var rY=z.forwardRef((t,e)=>{const{__scopeSelect:r,onAutoScroll:n,...c}=t,d=Mg("SelectScrollButton",r),p=z.useRef(null),a=lA(r),w=z.useCallback(()=>{p.current!==null&&(window.clearInterval(p.current),p.current=null)},[]);return z.useEffect(()=>()=>w(),[w]),Jo(()=>{var C;const E=a().find(P=>P.ref.current===document.activeElement);(C=E==null?void 0:E.ref.current)==null||C.scrollIntoView({block:"nearest"})},[a]),i.jsx(Pn.div,{"aria-hidden":!0,...c,ref:e,style:{flexShrink:0,...c.style},onPointerDown:tn(c.onPointerDown,()=>{p.current===null&&(p.current=window.setInterval(n,50))}),onPointerMove:tn(c.onPointerMove,()=>{var E;(E=d.onItemLeave)==null||E.call(d),p.current===null&&(p.current=window.setInterval(n,50))}),onPointerLeave:tn(c.onPointerLeave,()=>{w()})})}),i2e="SelectSeparator",nY=z.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t;return i.jsx(Pn.div,{"aria-hidden":!0,...n,ref:e})});nY.displayName=i2e;var sO="SelectArrow",a2e=z.forwardRef((t,e)=>{const{__scopeSelect:r,...n}=t,c=cA(r),d=Rg(sO,r),p=Mg(sO,r);return d.open&&p.position==="popper"?i.jsx(n4,{...c,...n,ref:e}):null});a2e.displayName=sO;function sY(t){return t===""||t===void 0}var iY=z.forwardRef((t,e)=>{const{value:r,...n}=t,c=z.useRef(null),d=Fs(e,c),p=y4(r);return z.useEffect(()=>{const a=c.current,w=window.HTMLSelectElement.prototype,C=Object.getOwnPropertyDescriptor(w,"value").set;if(p!==r&&C){const P=new Event("change",{bubbles:!0});C.call(a,r),a.dispatchEvent(P)}},[p,r]),i.jsx(RX,{asChild:!0,children:i.jsx("select",{...n,ref:d,defaultValue:r})})});iY.displayName="BubbleSelect";function aY(t){const e=Do(t),r=z.useRef(""),n=z.useRef(0),c=z.useCallback(p=>{const a=r.current+p;e(a),function w(E){r.current=E,window.clearTimeout(n.current),E!==""&&(n.current=window.setTimeout(()=>w(""),1e3))}(a)},[e]),d=z.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return z.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,c,d]}function oY(t,e,r){const c=e.length>1&&Array.from(e).every(E=>E===e[0])?e[0]:e,d=r?t.indexOf(r):-1;let p=o2e(t,Math.max(d,0));c.length===1&&(p=p.filter(E=>E!==r));const w=p.find(E=>E.textValue.toLowerCase().startsWith(c.toLowerCase()));return w!==r?w:void 0}function o2e(t,e){return t.map((r,n)=>t[(e+n)%t.length])}var l2e=MX,lY=OX,c2e=FX,u2e=zX,d2e=BX,cY=VX,h2e=GX,uY=ZX,dY=XX,f2e=YX,p2e=QX,hY=eY,fY=tY,pY=nY;const ds=l2e,hs=c2e,is=z.forwardRef(({className:t,children:e,...r},n)=>i.jsxs(lY,{ref:n,className:kn("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[e,i.jsx(u2e,{asChild:!0,children:i.jsx(b1e,{className:"h-4 w-4 opacity-50"})})]}));is.displayName=lY.displayName;const mY=z.forwardRef(({className:t,...e},r)=>i.jsx(hY,{ref:r,className:kn("flex cursor-default items-center justify-center py-1",t),...e,children:i.jsx(C1e,{})}));mY.displayName=hY.displayName;const gY=z.forwardRef(({className:t,...e},r)=>i.jsx(fY,{ref:r,className:kn("flex cursor-default items-center justify-center py-1",t),...e,children:i.jsx(rX,{})}));gY.displayName=fY.displayName;const as=z.forwardRef(({className:t,children:e,position:r="popper",...n},c)=>i.jsx(d2e,{children:i.jsxs(cY,{ref:c,className:kn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...n,children:[i.jsx(mY,{}),i.jsx(h2e,{className:kn("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),i.jsx(gY,{})]})}));as.displayName=cY.displayName;const m2e=z.forwardRef(({className:t,...e},r)=>i.jsx(uY,{ref:r,className:kn("px-2 py-1.5 text-sm font-semibold",t),...e}));m2e.displayName=uY.displayName;const Bt=z.forwardRef(({className:t,children:e,...r},n)=>i.jsxs(dY,{ref:n,className:kn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[i.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(p2e,{children:i.jsx(tX,{className:"h-4 w-4"})})}),i.jsx(f2e,{children:e})]}));Bt.displayName=dY.displayName;const g2e=z.forwardRef(({className:t,...e},r)=>i.jsx(pY,{ref:r,className:kn("-mx-1 my-1 h-px bg-muted",t),...e}));g2e.displayName=pY.displayName;var _2e="Separator",Q8="horizontal",y2e=["horizontal","vertical"],_Y=z.forwardRef((t,e)=>{const{decorative:r,orientation:n=Q8,...c}=t,d=x2e(n)?n:Q8,a=r?{role:"none"}:{"aria-orientation":d==="vertical"?d:void 0,role:"separator"};return i.jsx(Pn.div,{"data-orientation":d,...a,...c,ref:e})});_Y.displayName=_2e;function x2e(t){return y2e.includes(t)}var yY=_Y;const Zc=z.forwardRef(({className:t,orientation:e="horizontal",decorative:r=!0,...n},c)=>i.jsx(yY,{ref:c,decorative:r,orientation:e,className:kn("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...n}));Zc.displayName=yY.displayName;const zR=[{value:"all",label:"Toutes catégories",icon:null},{value:"electronics",label:"Électronique",icon:Ag},{value:"vehicles",label:"Véhicules",icon:aZ},{value:"real-estate",label:"Immobilier",icon:qd},{value:"fashion",label:"Mode",icon:q3},{value:"gaming",label:"Jeux & Jouets",icon:Mxe},{value:"baby",label:"Bébé & Enfant",icon:Sxe},{value:"business",label:"Équipement Pro",icon:cS}],v2e=[{value:"new",label:"Neuf"},{value:"like-new",label:"Comme neuf"},{value:"good",label:"Bon état"},{value:"fair",label:"État correct"},{value:"poor",label:"Mauvais état"}],w2e=[{value:"relevance",label:"Pertinence"},{value:"date",label:"Plus récent"},{value:"price-asc",label:"Prix croissant"},{value:"price-desc",label:"Prix décroissant"}],b2e=()=>{var Z;const[t,e]=xE(),{listings:r,loading:n,hasMore:c,fetchListings:d,searchListings:p}=mw(),[a,w]=z.useState({query:t.get("q")||"",category:t.get("category")||"",sortBy:"date"}),[E,C]=z.useState("grid"),[P,R]=z.useState(!1);z.useEffect(()=>{const $={query:t.get("q")||"",category:t.get("category")||"",sortBy:"date"};w($),p($)},[t,p]);const B=()=>{const $={...a};p($);const X=new URLSearchParams;$.query&&X.set("q",$.query),$.category&&X.set("category",$.category),e(X)},V=($,X)=>{const Q={...a,[$]:X};w(Q)},W=()=>{d(a,!1)},K=()=>{const $={query:"",sortBy:"date"};w($),p($),e({})};return i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Toutes les annonces"}),i.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-6",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Oo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{type:"text",placeholder:"Rechercher des articles...",value:a.query||"",onChange:$=>V("query",$.target.value),onKeyPress:$=>$.key==="Enter"&&B(),className:"pl-10"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Ge,{onClick:B,className:"whitespace-nowrap",children:[i.jsx(Oo,{className:"w-4 h-4 mr-2"}),"Rechercher"]}),i.jsxs(Ge,{variant:"outline",onClick:()=>R(!P),className:"lg:hidden",children:[i.jsx($C,{className:"w-4 h-4 mr-2"}),"Filtres"]})]})]}),i.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:zR.slice(1,6).map($=>{const X=$.icon;return i.jsxs(Ge,{variant:a.category===$.value?"default":"outline",size:"sm",onClick:()=>V("category",a.category===$.value?"":$.value),className:"flex items-center gap-2",children:[X&&i.jsx(X,{className:"w-4 h-4"}),$.label]},$.value)})})]}),i.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[i.jsx("aside",{className:`lg:w-80 space-y-6 ${P?"block":"hidden lg:block"}`,children:i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Filtres"}),i.jsx(Ge,{variant:"ghost",size:"sm",onClick:K,children:"Effacer"})]})}),i.jsxs(jt,{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Catégorie"}),i.jsxs(ds,{value:a.category||"all",onValueChange:$=>V("category",$==="all"?"":$),children:[i.jsx(is,{children:i.jsx(hs,{})}),i.jsx(as,{children:zR.map($=>{const X=$.icon;return i.jsx(Bt,{value:$.value,children:i.jsxs("div",{className:"flex items-center gap-2",children:[X&&i.jsx(X,{className:"w-4 h-4"}),$.label]})},$.value)})})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Prix"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Gr,{type:"number",placeholder:"Min",value:a.minPrice||"",onChange:$=>V("minPrice",$.target.value?parseInt($.target.value):void 0)}),i.jsx(Gr,{type:"number",placeholder:"Max",value:a.maxPrice||"",onChange:$=>V("maxPrice",$.target.value?parseInt($.target.value):void 0)})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium mb-2 block",children:"État"}),i.jsx("div",{className:"space-y-2",children:v2e.map($=>{var X;return i.jsxs("label",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",checked:((X=a.condition)==null?void 0:X.includes($.value))||!1,onChange:Q=>{const re=a.condition||[],ve=Q.target.checked?[...re,$.value]:re.filter(pe=>pe!==$.value);V("condition",ve.length>0?ve:void 0)},className:"rounded border-border"}),i.jsx("span",{className:"text-sm",children:$.label})]},$.value)})})]}),i.jsx(Ge,{onClick:B,className:"w-full",children:"Appliquer les filtres"})]})]})}),i.jsxs("main",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("span",{className:"text-muted-foreground",children:[r.length," résultat(s)"]}),(a.query||a.category||a.minPrice||a.maxPrice)&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-sm text-muted-foreground",children:"Filtres actifs:"}),a.query&&i.jsxs(Ir,{variant:"secondary",children:['"',a.query,'"']}),a.category&&i.jsx(Ir,{variant:"secondary",children:(Z=zR.find($=>$.value===a.category))==null?void 0:Z.label})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(ds,{value:a.sortBy||"date",onValueChange:$=>V("sortBy",$),children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{})}),i.jsx(as,{children:w2e.map($=>i.jsx(Bt,{value:$.value,children:$.label},$.value))})]}),i.jsx(Zc,{orientation:"vertical",className:"h-6"}),i.jsxs("div",{className:"flex border rounded-lg overflow-hidden",children:[i.jsx(Ge,{variant:E==="grid"?"default":"ghost",size:"icon",onClick:()=>C("grid"),className:"rounded-none w-15 h-15",title:"Vue en grille",children:i.jsx(uZ,{className:"w-4 h-4"})}),i.jsx(Ge,{variant:E==="list"?"default":"ghost",size:"icon",onClick:()=>C("list"),className:"rounded-none w-15 h-15",title:"Vue en liste",children:i.jsx(fZ,{className:"w-4 h-4"})})]})]})]}),n&&r.length===0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map(($,X)=>i.jsxs(Tt,{className:"animate-pulse",children:[i.jsx("div",{className:"aspect-[4/3] bg-muted"}),i.jsxs(jt,{className:"p-4 space-y-2",children:[i.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/4"})]})]},X))}):r.length>0?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:`grid gap-8 justify-items-center ${E==="grid"?"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3":"grid-cols-1"}`,children:r.map($=>i.jsx(XS,{listing:$},$.id))}),c&&i.jsx("div",{className:"text-center mt-8",children:i.jsx(Ge,{onClick:W,disabled:n,variant:"outline",size:"lg",children:n?"Chargement...":"Charger plus"})})]}):i.jsxs("div",{className:"text-center py-12",children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucun résultat trouvé"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Essayez de modifier vos critères de recherche"}),i.jsx(Ge,{onClick:K,variant:"outline",children:"Effacer les filtres"})]})]})]})]})};var v4="Dialog",[xY,xLe]=hd(v4),[S2e,dh]=xY(v4),vY=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:c,onOpenChange:d,modal:p=!0}=t,a=z.useRef(null),w=z.useRef(null),[E=!1,C]=ud({prop:n,defaultProp:c,onChange:d});return i.jsx(S2e,{scope:e,triggerRef:a,contentRef:w,contentId:ku(),titleId:ku(),descriptionId:ku(),open:E,onOpenChange:C,onOpenToggle:z.useCallback(()=>C(P=>!P),[C]),modal:p,children:r})};vY.displayName=v4;var wY="DialogTrigger",bY=z.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,c=dh(wY,r),d=Fs(e,c.triggerRef);return i.jsx(Pn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":c.open,"aria-controls":c.contentId,"data-state":S4(c.open),...n,ref:d,onClick:tn(t.onClick,c.onOpenToggle)})});bY.displayName=wY;var w4="DialogPortal",[E2e,SY]=xY(w4,{forceMount:void 0}),EY=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:c}=t,d=dh(w4,e);return i.jsx(E2e,{scope:e,forceMount:r,children:z.Children.map(n,p=>i.jsx(Xl,{present:r||d.open,children:i.jsx(UE,{asChild:!0,container:c,children:p})}))})};EY.displayName=w4;var xI="DialogOverlay",TY=z.forwardRef((t,e)=>{const r=SY(xI,t.__scopeDialog),{forceMount:n=r.forceMount,...c}=t,d=dh(xI,t.__scopeDialog);return d.modal?i.jsx(Xl,{present:n||d.open,children:i.jsx(T2e,{...c,ref:e})}):null});TY.displayName=xI;var T2e=z.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,c=dh(xI,r);return i.jsx($E,{as:Ep,allowPinchZoom:!0,shards:[c.contentRef],children:i.jsx(Pn.div,{"data-state":S4(c.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),Ty="DialogContent",jY=z.forwardRef((t,e)=>{const r=SY(Ty,t.__scopeDialog),{forceMount:n=r.forceMount,...c}=t,d=dh(Ty,t.__scopeDialog);return i.jsx(Xl,{present:n||d.open,children:d.modal?i.jsx(j2e,{...c,ref:e}):i.jsx(N2e,{...c,ref:e})})});jY.displayName=Ty;var j2e=z.forwardRef((t,e)=>{const r=dh(Ty,t.__scopeDialog),n=z.useRef(null),c=Fs(e,r.contentRef,n);return z.useEffect(()=>{const d=n.current;if(d)return eA(d)},[]),i.jsx(NY,{...t,ref:c,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:tn(t.onCloseAutoFocus,d=>{var p;d.preventDefault(),(p=r.triggerRef.current)==null||p.focus()}),onPointerDownOutside:tn(t.onPointerDownOutside,d=>{const p=d.detail.originalEvent,a=p.button===0&&p.ctrlKey===!0;(p.button===2||a)&&d.preventDefault()}),onFocusOutside:tn(t.onFocusOutside,d=>d.preventDefault())})}),N2e=z.forwardRef((t,e)=>{const r=dh(Ty,t.__scopeDialog),n=z.useRef(!1),c=z.useRef(!1);return i.jsx(NY,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:d=>{var p,a;(p=t.onCloseAutoFocus)==null||p.call(t,d),d.defaultPrevented||(n.current||(a=r.triggerRef.current)==null||a.focus(),d.preventDefault()),n.current=!1,c.current=!1},onInteractOutside:d=>{var w,E;(w=t.onInteractOutside)==null||w.call(t,d),d.defaultPrevented||(n.current=!0,d.detail.originalEvent.type==="pointerdown"&&(c.current=!0));const p=d.target;((E=r.triggerRef.current)==null?void 0:E.contains(p))&&d.preventDefault(),d.detail.originalEvent.type==="focusin"&&c.current&&d.preventDefault()}})}),NY=z.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:c,onCloseAutoFocus:d,...p}=t,a=dh(Ty,r),w=z.useRef(null),E=Fs(e,w);return WC(),i.jsxs(i.Fragment,{children:[i.jsx(BE,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:c,onUnmountAutoFocus:d,children:i.jsx(zE,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":S4(a.open),...p,ref:E,onDismiss:()=>a.onOpenChange(!1)})}),i.jsxs(i.Fragment,{children:[i.jsx(I2e,{titleId:a.titleId}),i.jsx(A2e,{contentRef:w,descriptionId:a.descriptionId})]})]})}),b4="DialogTitle",IY=z.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,c=dh(b4,r);return i.jsx(Pn.h2,{id:c.titleId,...n,ref:e})});IY.displayName=b4;var CY="DialogDescription",AY=z.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,c=dh(CY,r);return i.jsx(Pn.p,{id:c.descriptionId,...n,ref:e})});AY.displayName=CY;var PY="DialogClose",kY=z.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,c=dh(PY,r);return i.jsx(Pn.button,{type:"button",...n,ref:e,onClick:tn(t.onClick,()=>c.onOpenChange(!1))})});kY.displayName=PY;function S4(t){return t?"open":"closed"}var RY="DialogTitleWarning",[vLe,MY]=Ove(RY,{contentName:Ty,titleName:b4,docsSlug:"dialog"}),I2e=({titleId:t})=>{const e=MY(RY),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return z.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},C2e="DialogDescriptionWarning",A2e=({contentRef:t,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${MY(C2e).contentName}}.`;return z.useEffect(()=>{var d;const c=(d=t.current)==null?void 0:d.getAttribute("aria-describedby");e&&c&&(document.getElementById(e)||console.warn(n))},[n,t,e]),null},P2e=vY,k2e=bY,R2e=EY,DY=TY,OY=jY,LY=IY,FY=AY,M2e=kY;const ta=P2e,l0=k2e,D2e=R2e,zY=z.forwardRef(({className:t,...e},r)=>i.jsx(DY,{ref:r,className:kn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));zY.displayName=DY.displayName;const Ki=z.forwardRef(({className:t,children:e,...r},n)=>i.jsxs(D2e,{children:[i.jsx(zY,{}),i.jsxs(OY,{ref:n,className:kn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[e,i.jsxs(M2e,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[i.jsx(P1e,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ki.displayName=OY.displayName;const oa=({className:t,...e})=>i.jsx("div",{className:kn("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});oa.displayName="DialogHeader";const mo=({className:t,...e})=>i.jsx("div",{className:kn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});mo.displayName="DialogFooter";const ra=z.forwardRef(({className:t,...e},r)=>i.jsx(LY,{ref:r,className:kn("text-lg font-semibold leading-none tracking-tight",t),...e}));ra.displayName=LY.displayName;const go=z.forwardRef(({className:t,...e},r)=>i.jsx(FY,{ref:r,className:kn("text-sm text-muted-foreground",t),...e}));go.displayName=FY.displayName;const id=z.forwardRef(({className:t,...e},r)=>i.jsx("textarea",{className:kn("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...e}));id.displayName="Textarea";var O2e="Label",BY=z.forwardRef((t,e)=>i.jsx(Pn.label,{...t,ref:e,onMouseDown:r=>{var c;r.target.closest("button, input, select, textarea")||((c=t.onMouseDown)==null||c.call(t,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));BY.displayName=O2e;var VY=BY;const L2e=HC("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Zr=z.forwardRef(({className:t,...e},r)=>i.jsx(VY,{ref:r,className:kn(L2e(),t),...e}));Zr.displayName=VY.displayName;const F2e=HC("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Ys=z.forwardRef(({className:t,variant:e,...r},n)=>i.jsx("div",{ref:n,role:"alert",className:kn(F2e({variant:e}),t),...r}));Ys.displayName="Alert";const z2e=z.forwardRef(({className:t,...e},r)=>i.jsx("h5",{ref:r,className:kn("mb-1 font-medium leading-none tracking-tight",t),...e}));z2e.displayName="AlertTitle";const Js=z.forwardRef(({className:t,...e},r)=>i.jsx("div",{ref:r,className:kn("text-sm [&_p]:leading-relaxed",t),...e}));Js.displayName="AlertDescription";var vs=function(){return vs=Object.assign||function(e){for(var r,n=1,c=arguments.length;n<c;n++){r=arguments[n];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(e[d]=r[d])}return e},vs.apply(this,arguments)};function B2e(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(t);c<n.length;c++)e.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(t,n[c])&&(r[n[c]]=t[n[c]]);return r}function UY(t,e,r){for(var n=0,c=e.length,d;n<c;n++)(d||!(n in e))&&(d||(d=Array.prototype.slice.call(e,0,n)),d[n]=e[n]);return t.concat(d||Array.prototype.slice.call(e))}function ZE(t){return t.mode==="multiple"}function KE(t){return t.mode==="range"}function uA(t){return t.mode==="single"}var V2e={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function U2e(t,e){return Pa(t,"LLLL y",e)}function $2e(t,e){return Pa(t,"d",e)}function q2e(t,e){return Pa(t,"LLLL",e)}function G2e(t){return"".concat(t)}function H2e(t,e){return Pa(t,"cccccc",e)}function W2e(t,e){return Pa(t,"yyyy",e)}var Z2e=Object.freeze({__proto__:null,formatCaption:U2e,formatDay:$2e,formatMonthCaption:q2e,formatWeekNumber:G2e,formatWeekdayName:H2e,formatYearCaption:W2e}),K2e=function(t,e,r){return Pa(t,"do MMMM (EEEE)",r)},X2e=function(){return"Month: "},Y2e=function(){return"Go to next month"},J2e=function(){return"Go to previous month"},Q2e=function(t,e){return Pa(t,"cccc",e)},eje=function(t){return"Week n. ".concat(t)},tje=function(){return"Year: "},rje=Object.freeze({__proto__:null,labelDay:K2e,labelMonthDropdown:X2e,labelNext:Y2e,labelPrevious:J2e,labelWeekNumber:eje,labelWeekday:Q2e,labelYearDropdown:tje});function nje(){var t="buttons",e=V2e,r=g4,n={},c={},d=1,p={},a=new Date;return{captionLayout:t,classNames:e,formatters:Z2e,labels:rje,locale:r,modifiersClassNames:n,modifiers:c,numberOfMonths:d,styles:p,today:a,mode:"default"}}function sje(t){var e=t.fromYear,r=t.toYear,n=t.fromMonth,c=t.toMonth,d=t.fromDate,p=t.toDate;return n?d=iu(n):e&&(d=new Date(e,0,1)),c?p=aA(c):r&&(p=new Date(r,11,31)),{fromDate:d?O0(d):void 0,toDate:p?O0(p):void 0}}var $Y=z.createContext(void 0);function ije(t){var e,r=t.initialProps,n=nje(),c=sje(r),d=c.fromDate,p=c.toDate,a=(e=r.captionLayout)!==null&&e!==void 0?e:n.captionLayout;a!=="buttons"&&(!d||!p)&&(a="buttons");var w;(uA(r)||ZE(r)||KE(r))&&(w=r.onSelect);var E=vs(vs(vs({},n),r),{captionLayout:a,classNames:vs(vs({},n.classNames),r.classNames),components:vs({},r.components),formatters:vs(vs({},n.formatters),r.formatters),fromDate:d,labels:vs(vs({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:vs(vs({},n.modifiers),r.modifiers),modifiersClassNames:vs(vs({},n.modifiersClassNames),r.modifiersClassNames),onSelect:w,styles:vs(vs({},n.styles),r.styles),toDate:p});return i.jsx($Y.Provider,{value:E,children:t.children})}function ba(){var t=z.useContext($Y);if(!t)throw new Error("useDayPicker must be used within a DayPickerProvider.");return t}function qY(t){var e=ba(),r=e.locale,n=e.classNames,c=e.styles,d=e.formatters.formatCaption;return i.jsx("div",{className:n.caption_label,style:c.caption_label,"aria-live":"polite",role:"presentation",id:t.id,children:d(t.displayMonth,{locale:r})})}function aje(t){return i.jsx("svg",vs({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},t,{children:i.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function GY(t){var e,r,n=t.onChange,c=t.value,d=t.children,p=t.caption,a=t.className,w=t.style,E=ba(),C=(r=(e=E.components)===null||e===void 0?void 0:e.IconDropdown)!==null&&r!==void 0?r:aje;return i.jsxs("div",{className:a,style:w,children:[i.jsx("span",{className:E.classNames.vhidden,children:t["aria-label"]}),i.jsx("select",{name:t.name,"aria-label":t["aria-label"],className:E.classNames.dropdown,style:E.styles.dropdown,value:c,onChange:n,children:d}),i.jsxs("div",{className:E.classNames.caption_label,style:E.styles.caption_label,"aria-hidden":"true",children:[p,i.jsx(C,{className:E.classNames.dropdown_icon,style:E.styles.dropdown_icon})]})]})}function oje(t){var e,r=ba(),n=r.fromDate,c=r.toDate,d=r.styles,p=r.locale,a=r.formatters.formatMonthCaption,w=r.classNames,E=r.components,C=r.labels.labelMonthDropdown;if(!n)return i.jsx(i.Fragment,{});if(!c)return i.jsx(i.Fragment,{});var P=[];if(VEe(n,c))for(var R=iu(n),B=n.getMonth();B<=c.getMonth();B++)P.push(FR(R,B));else for(var R=iu(new Date),B=0;B<=11;B++)P.push(FR(R,B));var V=function(K){var Z=Number(K.target.value),$=FR(iu(t.displayMonth),Z);t.onChange($)},W=(e=E==null?void 0:E.Dropdown)!==null&&e!==void 0?e:GY;return i.jsx(W,{name:"months","aria-label":C(),className:w.dropdown_month,style:d.dropdown_month,onChange:V,value:t.displayMonth.getMonth(),caption:a(t.displayMonth,{locale:p}),children:P.map(function(K){return i.jsx("option",{value:K.getMonth(),children:a(K,{locale:p})},K.getMonth())})})}function lje(t){var e,r=t.displayMonth,n=ba(),c=n.fromDate,d=n.toDate,p=n.locale,a=n.styles,w=n.classNames,E=n.components,C=n.formatters.formatYearCaption,P=n.labels.labelYearDropdown,R=[];if(!c)return i.jsx(i.Fragment,{});if(!d)return i.jsx(i.Fragment,{});for(var B=c.getFullYear(),V=d.getFullYear(),W=B;W<=V;W++)R.push(X8(SX(new Date),W));var K=function($){var X=X8(iu(r),Number($.target.value));t.onChange(X)},Z=(e=E==null?void 0:E.Dropdown)!==null&&e!==void 0?e:GY;return i.jsx(Z,{name:"years","aria-label":P(),className:w.dropdown_year,style:a.dropdown_year,onChange:K,value:r.getFullYear(),caption:C(r,{locale:p}),children:R.map(function($){return i.jsx("option",{value:$.getFullYear(),children:C($,{locale:p})},$.getFullYear())})})}function cje(t,e){var r=z.useState(t),n=r[0],c=r[1],d=e===void 0?n:e;return[d,c]}function uje(t){var e=t.month,r=t.defaultMonth,n=t.today,c=e||r||n||new Date,d=t.toDate,p=t.fromDate,a=t.numberOfMonths,w=a===void 0?1:a;if(d&&F0(d,c)<0){var E=-1*(w-1);c=ah(d,E)}return p&&F0(c,p)<0&&(c=p),iu(c)}function dje(){var t=ba(),e=uje(t),r=cje(e,t.month),n=r[0],c=r[1],d=function(p){var a;if(!t.disableNavigation){var w=iu(p);c(w),(a=t.onMonthChange)===null||a===void 0||a.call(t,w)}};return[n,d]}function hje(t,e){for(var r=e.reverseMonths,n=e.numberOfMonths,c=iu(t),d=iu(ah(c,n)),p=F0(d,c),a=[],w=0;w<p;w++){var E=ah(c,w);a.push(E)}return r&&(a=a.reverse()),a}function fje(t,e){if(!e.disableNavigation){var r=e.toDate,n=e.pagedNavigation,c=e.numberOfMonths,d=c===void 0?1:c,p=n?d:1,a=iu(t);if(!r)return ah(a,p);var w=F0(r,t);if(!(w<d))return ah(a,p)}}function pje(t,e){if(!e.disableNavigation){var r=e.fromDate,n=e.pagedNavigation,c=e.numberOfMonths,d=c===void 0?1:c,p=n?d:1,a=iu(t);if(!r)return ah(a,-p);var w=F0(a,r);if(!(w<=0))return ah(a,-p)}}var HY=z.createContext(void 0);function mje(t){var e=ba(),r=dje(),n=r[0],c=r[1],d=hje(n,e),p=fje(n,e),a=pje(n,e),w=function(P){return d.some(function(R){return _4(P,R)})},E=function(P,R){w(P)||(R&&AX(P,R)?c(ah(P,1+e.numberOfMonths*-1)):c(P))},C={currentMonth:n,displayMonths:d,goToMonth:c,goToDate:E,previousMonth:a,nextMonth:p,isDateDisplayed:w};return i.jsx(HY.Provider,{value:C,children:t.children})}function XE(){var t=z.useContext(HY);if(!t)throw new Error("useNavigation must be used within a NavigationProvider");return t}function e$(t){var e,r=ba(),n=r.classNames,c=r.styles,d=r.components,p=XE().goToMonth,a=function(C){p(ah(C,t.displayIndex?-t.displayIndex:0))},w=(e=d==null?void 0:d.CaptionLabel)!==null&&e!==void 0?e:qY,E=i.jsx(w,{id:t.id,displayMonth:t.displayMonth});return i.jsxs("div",{className:n.caption_dropdowns,style:c.caption_dropdowns,children:[i.jsx("div",{className:n.vhidden,children:E}),i.jsx(oje,{onChange:a,displayMonth:t.displayMonth}),i.jsx(lje,{onChange:a,displayMonth:t.displayMonth})]})}function gje(t){return i.jsx("svg",vs({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:i.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function _je(t){return i.jsx("svg",vs({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:i.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var vI=z.forwardRef(function(t,e){var r=ba(),n=r.classNames,c=r.styles,d=[n.button_reset,n.button];t.className&&d.push(t.className);var p=d.join(" "),a=vs(vs({},c.button_reset),c.button);return t.style&&Object.assign(a,t.style),i.jsx("button",vs({},t,{ref:e,type:"button",className:p,style:a}))});function yje(t){var e,r,n=ba(),c=n.dir,d=n.locale,p=n.classNames,a=n.styles,w=n.labels,E=w.labelPrevious,C=w.labelNext,P=n.components;if(!t.nextMonth&&!t.previousMonth)return i.jsx(i.Fragment,{});var R=E(t.previousMonth,{locale:d}),B=[p.nav_button,p.nav_button_previous].join(" "),V=C(t.nextMonth,{locale:d}),W=[p.nav_button,p.nav_button_next].join(" "),K=(e=P==null?void 0:P.IconRight)!==null&&e!==void 0?e:_je,Z=(r=P==null?void 0:P.IconLeft)!==null&&r!==void 0?r:gje;return i.jsxs("div",{className:p.nav,style:a.nav,children:[!t.hidePrevious&&i.jsx(vI,{name:"previous-month","aria-label":R,className:B,style:a.nav_button_previous,disabled:!t.previousMonth,onClick:t.onPreviousClick,children:c==="rtl"?i.jsx(K,{className:p.nav_icon,style:a.nav_icon}):i.jsx(Z,{className:p.nav_icon,style:a.nav_icon})}),!t.hideNext&&i.jsx(vI,{name:"next-month","aria-label":V,className:W,style:a.nav_button_next,disabled:!t.nextMonth,onClick:t.onNextClick,children:c==="rtl"?i.jsx(Z,{className:p.nav_icon,style:a.nav_icon}):i.jsx(K,{className:p.nav_icon,style:a.nav_icon})})]})}function t$(t){var e=ba().numberOfMonths,r=XE(),n=r.previousMonth,c=r.nextMonth,d=r.goToMonth,p=r.displayMonths,a=p.findIndex(function(V){return _4(t.displayMonth,V)}),w=a===0,E=a===p.length-1,C=e>1&&(w||!E),P=e>1&&(E||!w),R=function(){n&&d(n)},B=function(){c&&d(c)};return i.jsx(yje,{displayMonth:t.displayMonth,hideNext:C,hidePrevious:P,nextMonth:c,previousMonth:n,onPreviousClick:R,onNextClick:B})}function xje(t){var e,r=ba(),n=r.classNames,c=r.disableNavigation,d=r.styles,p=r.captionLayout,a=r.components,w=(e=a==null?void 0:a.CaptionLabel)!==null&&e!==void 0?e:qY,E;return c?E=i.jsx(w,{id:t.id,displayMonth:t.displayMonth}):p==="dropdown"?E=i.jsx(e$,{displayMonth:t.displayMonth,id:t.id}):p==="dropdown-buttons"?E=i.jsxs(i.Fragment,{children:[i.jsx(e$,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id}),i.jsx(t$,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id})]}):E=i.jsxs(i.Fragment,{children:[i.jsx(w,{id:t.id,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),i.jsx(t$,{displayMonth:t.displayMonth,id:t.id})]}),i.jsx("div",{className:n.caption,style:d.caption,children:E})}function vje(t){var e=ba(),r=e.footer,n=e.styles,c=e.classNames.tfoot;return r?i.jsx("tfoot",{className:c,style:n.tfoot,children:i.jsx("tr",{children:i.jsx("td",{colSpan:8,children:r})})}):i.jsx(i.Fragment,{})}function wje(t,e,r){for(var n=r?Sy(new Date):uf(new Date,{locale:t,weekStartsOn:e}),c=[],d=0;d<7;d++){var p=wc(n,d);c.push(p)}return c}function bje(){var t=ba(),e=t.classNames,r=t.styles,n=t.showWeekNumber,c=t.locale,d=t.weekStartsOn,p=t.ISOWeek,a=t.formatters.formatWeekdayName,w=t.labels.labelWeekday,E=wje(c,d,p);return i.jsxs("tr",{style:r.head_row,className:e.head_row,children:[n&&i.jsx("td",{style:r.head_cell,className:e.head_cell}),E.map(function(C,P){return i.jsx("th",{scope:"col",className:e.head_cell,style:r.head_cell,"aria-label":w(C,{locale:c}),children:a(C,{locale:c})},P)})]})}function Sje(){var t,e=ba(),r=e.classNames,n=e.styles,c=e.components,d=(t=c==null?void 0:c.HeadRow)!==null&&t!==void 0?t:bje;return i.jsx("thead",{style:n.head,className:r.head,children:i.jsx(d,{})})}function Eje(t){var e=ba(),r=e.locale,n=e.formatters.formatDay;return i.jsx(i.Fragment,{children:n(t.date,{locale:r})})}var E4=z.createContext(void 0);function Tje(t){if(!ZE(t.initialProps)){var e={selected:void 0,modifiers:{disabled:[]}};return i.jsx(E4.Provider,{value:e,children:t.children})}return i.jsx(jje,{initialProps:t.initialProps,children:t.children})}function jje(t){var e=t.initialProps,r=t.children,n=e.selected,c=e.min,d=e.max,p=function(E,C,P){var R,B;(R=e.onDayClick)===null||R===void 0||R.call(e,E,C,P);var V=!!(C.selected&&c&&(n==null?void 0:n.length)===c);if(!V){var W=!!(!C.selected&&d&&(n==null?void 0:n.length)===d);if(!W){var K=n?UY([],n):[];if(C.selected){var Z=K.findIndex(function($){return Qc(E,$)});K.splice(Z,1)}else K.push(E);(B=e.onSelect)===null||B===void 0||B.call(e,K,E,C,P)}}},a={disabled:[]};n&&a.disabled.push(function(E){var C=d&&n.length>d-1,P=n.some(function(R){return Qc(R,E)});return!!(C&&!P)});var w={selected:n,onDayClick:p,modifiers:a};return i.jsx(E4.Provider,{value:w,children:r})}function T4(){var t=z.useContext(E4);if(!t)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return t}function Nje(t,e){var r=e||{},n=r.from,c=r.to;return n&&c?Qc(c,t)&&Qc(n,t)?void 0:Qc(c,t)?{from:c,to:void 0}:Qc(n,t)?void 0:QD(n,t)?{from:t,to:c}:{from:n,to:t}:c?QD(t,c)?{from:c,to:t}:{from:t,to:c}:n?AX(t,n)?{from:t,to:n}:{from:n,to:t}:{from:t,to:void 0}}var j4=z.createContext(void 0);function Ije(t){if(!KE(t.initialProps)){var e={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return i.jsx(j4.Provider,{value:e,children:t.children})}return i.jsx(Cje,{initialProps:t.initialProps,children:t.children})}function Cje(t){var e=t.initialProps,r=t.children,n=e.selected,c=n||{},d=c.from,p=c.to,a=e.min,w=e.max,E=function(B,V,W){var K,Z;(K=e.onDayClick)===null||K===void 0||K.call(e,B,V,W);var $=Nje(B,n);(Z=e.onSelect)===null||Z===void 0||Z.call(e,$,B,V,W)},C={range_start:[],range_end:[],range_middle:[],disabled:[]};if(d?(C.range_start=[d],p?(C.range_end=[p],Qc(d,p)||(C.range_middle=[{after:d,before:p}])):C.range_end=[d]):p&&(C.range_start=[p],C.range_end=[p]),a&&(d&&!p&&C.disabled.push({after:LR(d,a-1),before:wc(d,a-1)}),d&&p&&C.disabled.push({after:d,before:wc(d,a-1)}),!d&&p&&C.disabled.push({after:LR(p,a-1),before:wc(p,a-1)})),w){if(d&&!p&&(C.disabled.push({before:wc(d,-w+1)}),C.disabled.push({after:wc(d,w-1)})),d&&p){var P=Kh(p,d)+1,R=w-P;C.disabled.push({before:LR(d,R)}),C.disabled.push({after:wc(p,R)})}!d&&p&&(C.disabled.push({before:wc(p,-w+1)}),C.disabled.push({after:wc(p,w-1)}))}return i.jsx(j4.Provider,{value:{selected:n,onDayClick:E,modifiers:C},children:r})}function N4(){var t=z.useContext(j4);if(!t)throw new Error("useSelectRange must be used within a SelectRangeProvider");return t}function iN(t){return Array.isArray(t)?UY([],t):t!==void 0?[t]:[]}function Aje(t){var e={};return Object.entries(t).forEach(function(r){var n=r[0],c=r[1];e[n]=iN(c)}),e}var oh;(function(t){t.Outside="outside",t.Disabled="disabled",t.Selected="selected",t.Hidden="hidden",t.Today="today",t.RangeStart="range_start",t.RangeEnd="range_end",t.RangeMiddle="range_middle"})(oh||(oh={}));var Pje=oh.Selected,Gf=oh.Disabled,kje=oh.Hidden,Rje=oh.Today,BR=oh.RangeEnd,VR=oh.RangeMiddle,UR=oh.RangeStart,Mje=oh.Outside;function Dje(t,e,r){var n,c=(n={},n[Pje]=iN(t.selected),n[Gf]=iN(t.disabled),n[kje]=iN(t.hidden),n[Rje]=[t.today],n[BR]=[],n[VR]=[],n[UR]=[],n[Mje]=[],n);return t.fromDate&&c[Gf].push({before:t.fromDate}),t.toDate&&c[Gf].push({after:t.toDate}),ZE(t)?c[Gf]=c[Gf].concat(e.modifiers[Gf]):KE(t)&&(c[Gf]=c[Gf].concat(r.modifiers[Gf]),c[UR]=r.modifiers[UR],c[VR]=r.modifiers[VR],c[BR]=r.modifiers[BR]),c}var WY=z.createContext(void 0);function Oje(t){var e=ba(),r=T4(),n=N4(),c=Dje(e,r,n),d=Aje(e.modifiers),p=vs(vs({},c),d);return i.jsx(WY.Provider,{value:p,children:t.children})}function ZY(){var t=z.useContext(WY);if(!t)throw new Error("useModifiers must be used within a ModifiersProvider");return t}function Lje(t){return!!(t&&typeof t=="object"&&"before"in t&&"after"in t)}function Fje(t){return!!(t&&typeof t=="object"&&"from"in t)}function zje(t){return!!(t&&typeof t=="object"&&"after"in t)}function Bje(t){return!!(t&&typeof t=="object"&&"before"in t)}function Vje(t){return!!(t&&typeof t=="object"&&"dayOfWeek"in t)}function Uje(t,e){var r,n=e.from,c=e.to;if(n&&c){var d=Kh(c,n)<0;d&&(r=[c,n],n=r[0],c=r[1]);var p=Kh(t,n)>=0&&Kh(c,t)>=0;return p}return c?Qc(c,t):n?Qc(n,t):!1}function $je(t){return p4(t)}function qje(t){return Array.isArray(t)&&t.every(p4)}function Gje(t,e){return e.some(function(r){if(typeof r=="boolean")return r;if($je(r))return Qc(t,r);if(qje(r))return r.includes(t);if(Fje(r))return Uje(t,r);if(Vje(r))return r.dayOfWeek.includes(t.getDay());if(Lje(r)){var n=Kh(r.before,t),c=Kh(r.after,t),d=n>0,p=c<0,a=QD(r.before,r.after);return a?p&&d:d||p}return zje(r)?Kh(t,r.after)>0:Bje(r)?Kh(r.before,t)>0:typeof r=="function"?r(t):!1})}function I4(t,e,r){var n=Object.keys(e).reduce(function(d,p){var a=e[p];return Gje(t,a)&&d.push(p),d},[]),c={};return n.forEach(function(d){return c[d]=!0}),r&&!_4(t,r)&&(c.outside=!0),c}function Hje(t,e){for(var r=iu(t[0]),n=aA(t[t.length-1]),c,d,p=r;p<=n;){var a=I4(p,e),w=!a.disabled&&!a.hidden;if(!w){p=wc(p,1);continue}if(a.selected)return p;a.today&&!d&&(d=p),c||(c=p),p=wc(p,1)}return d||c}var Wje=365;function KY(t,e){var r=e.moveBy,n=e.direction,c=e.context,d=e.modifiers,p=e.retry,a=p===void 0?{count:0,lastFocused:t}:p,w=c.weekStartsOn,E=c.fromDate,C=c.toDate,P=c.locale,R={day:wc,week:JD,month:ah,year:ASe,startOfWeek:function(K){return c.ISOWeek?Sy(K):uf(K,{locale:P,weekStartsOn:w})},endOfWeek:function(K){return c.ISOWeek?EX(K):m4(K,{locale:P,weekStartsOn:w})}},B=R[r](t,n==="after"?1:-1);n==="before"&&E?B=PSe([E,B]):n==="after"&&C&&(B=kSe([C,B]));var V=!0;if(d){var W=I4(B,d);V=!W.disabled&&!W.hidden}return V?B:a.count>Wje?a.lastFocused:KY(B,{moveBy:r,direction:n,context:c,modifiers:d,retry:vs(vs({},a),{count:a.count+1})})}var XY=z.createContext(void 0);function Zje(t){var e=XE(),r=ZY(),n=z.useState(),c=n[0],d=n[1],p=z.useState(),a=p[0],w=p[1],E=Hje(e.displayMonths,r),C=c??(a&&e.isDateDisplayed(a))?a:E,P=function(){w(c),d(void 0)},R=function(K){d(K)},B=ba(),V=function(K,Z){if(c){var $=KY(c,{moveBy:K,direction:Z,context:B,modifiers:r});Qc(c,$)||(e.goToDate($,c),R($))}},W={focusedDay:c,focusTarget:C,blur:P,focus:R,focusDayAfter:function(){return V("day","after")},focusDayBefore:function(){return V("day","before")},focusWeekAfter:function(){return V("week","after")},focusWeekBefore:function(){return V("week","before")},focusMonthBefore:function(){return V("month","before")},focusMonthAfter:function(){return V("month","after")},focusYearBefore:function(){return V("year","before")},focusYearAfter:function(){return V("year","after")},focusStartOfWeek:function(){return V("startOfWeek","before")},focusEndOfWeek:function(){return V("endOfWeek","after")}};return i.jsx(XY.Provider,{value:W,children:t.children})}function C4(){var t=z.useContext(XY);if(!t)throw new Error("useFocusContext must be used within a FocusProvider");return t}function Kje(t,e){var r=ZY(),n=I4(t,r,e);return n}var A4=z.createContext(void 0);function Xje(t){if(!uA(t.initialProps)){var e={selected:void 0};return i.jsx(A4.Provider,{value:e,children:t.children})}return i.jsx(Yje,{initialProps:t.initialProps,children:t.children})}function Yje(t){var e=t.initialProps,r=t.children,n=function(d,p,a){var w,E,C;if((w=e.onDayClick)===null||w===void 0||w.call(e,d,p,a),p.selected&&!e.required){(E=e.onSelect)===null||E===void 0||E.call(e,void 0,d,p,a);return}(C=e.onSelect)===null||C===void 0||C.call(e,d,d,p,a)},c={selected:e.selected,onDayClick:n};return i.jsx(A4.Provider,{value:c,children:r})}function YY(){var t=z.useContext(A4);if(!t)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return t}function Jje(t,e){var r=ba(),n=YY(),c=T4(),d=N4(),p=C4(),a=p.focusDayAfter,w=p.focusDayBefore,E=p.focusWeekAfter,C=p.focusWeekBefore,P=p.blur,R=p.focus,B=p.focusMonthBefore,V=p.focusMonthAfter,W=p.focusYearBefore,K=p.focusYearAfter,Z=p.focusStartOfWeek,$=p.focusEndOfWeek,X=function(qe){var $e,st,it,Mt;uA(r)?($e=n.onDayClick)===null||$e===void 0||$e.call(n,t,e,qe):ZE(r)?(st=c.onDayClick)===null||st===void 0||st.call(c,t,e,qe):KE(r)?(it=d.onDayClick)===null||it===void 0||it.call(d,t,e,qe):(Mt=r.onDayClick)===null||Mt===void 0||Mt.call(r,t,e,qe)},Q=function(qe){var $e;R(t),($e=r.onDayFocus)===null||$e===void 0||$e.call(r,t,e,qe)},re=function(qe){var $e;P(),($e=r.onDayBlur)===null||$e===void 0||$e.call(r,t,e,qe)},ve=function(qe){var $e;($e=r.onDayMouseEnter)===null||$e===void 0||$e.call(r,t,e,qe)},pe=function(qe){var $e;($e=r.onDayMouseLeave)===null||$e===void 0||$e.call(r,t,e,qe)},ue=function(qe){var $e;($e=r.onDayPointerEnter)===null||$e===void 0||$e.call(r,t,e,qe)},ge=function(qe){var $e;($e=r.onDayPointerLeave)===null||$e===void 0||$e.call(r,t,e,qe)},ce=function(qe){var $e;($e=r.onDayTouchCancel)===null||$e===void 0||$e.call(r,t,e,qe)},Se=function(qe){var $e;($e=r.onDayTouchEnd)===null||$e===void 0||$e.call(r,t,e,qe)},le=function(qe){var $e;($e=r.onDayTouchMove)===null||$e===void 0||$e.call(r,t,e,qe)},J=function(qe){var $e;($e=r.onDayTouchStart)===null||$e===void 0||$e.call(r,t,e,qe)},ke=function(qe){var $e;($e=r.onDayKeyUp)===null||$e===void 0||$e.call(r,t,e,qe)},Ze=function(qe){var $e;switch(qe.key){case"ArrowLeft":qe.preventDefault(),qe.stopPropagation(),r.dir==="rtl"?a():w();break;case"ArrowRight":qe.preventDefault(),qe.stopPropagation(),r.dir==="rtl"?w():a();break;case"ArrowDown":qe.preventDefault(),qe.stopPropagation(),E();break;case"ArrowUp":qe.preventDefault(),qe.stopPropagation(),C();break;case"PageUp":qe.preventDefault(),qe.stopPropagation(),qe.shiftKey?W():B();break;case"PageDown":qe.preventDefault(),qe.stopPropagation(),qe.shiftKey?K():V();break;case"Home":qe.preventDefault(),qe.stopPropagation(),Z();break;case"End":qe.preventDefault(),qe.stopPropagation(),$();break}($e=r.onDayKeyDown)===null||$e===void 0||$e.call(r,t,e,qe)},Xe={onClick:X,onFocus:Q,onBlur:re,onKeyDown:Ze,onKeyUp:ke,onMouseEnter:ve,onMouseLeave:pe,onPointerEnter:ue,onPointerLeave:ge,onTouchCancel:ce,onTouchEnd:Se,onTouchMove:le,onTouchStart:J};return Xe}function Qje(){var t=ba(),e=YY(),r=T4(),n=N4(),c=uA(t)?e.selected:ZE(t)?r.selected:KE(t)?n.selected:void 0;return c}function eNe(t){return Object.values(oh).includes(t)}function tNe(t,e){var r=[t.classNames.day];return Object.keys(e).forEach(function(n){var c=t.modifiersClassNames[n];if(c)r.push(c);else if(eNe(n)){var d=t.classNames["day_".concat(n)];d&&r.push(d)}}),r}function rNe(t,e){var r=vs({},t.styles.day);return Object.keys(e).forEach(function(n){var c;r=vs(vs({},r),(c=t.modifiersStyles)===null||c===void 0?void 0:c[n])}),r}function nNe(t,e,r){var n,c,d,p=ba(),a=C4(),w=Kje(t,e),E=Jje(t,w),C=Qje(),P=!!(p.onDayClick||p.mode!=="default");z.useEffect(function(){var ve;w.outside||a.focusedDay&&P&&Qc(a.focusedDay,t)&&((ve=r.current)===null||ve===void 0||ve.focus())},[a.focusedDay,t,r,P,w.outside]);var R=tNe(p,w).join(" "),B=rNe(p,w),V=!!(w.outside&&!p.showOutsideDays||w.hidden),W=(d=(c=p.components)===null||c===void 0?void 0:c.DayContent)!==null&&d!==void 0?d:Eje,K=i.jsx(W,{date:t,displayMonth:e,activeModifiers:w}),Z={style:B,className:R,children:K,role:"gridcell"},$=a.focusTarget&&Qc(a.focusTarget,t)&&!w.outside,X=a.focusedDay&&Qc(a.focusedDay,t),Q=vs(vs(vs({},Z),(n={disabled:w.disabled,role:"gridcell"},n["aria-selected"]=w.selected,n.tabIndex=X||$?0:-1,n)),E),re={isButton:P,isHidden:V,activeModifiers:w,selectedDays:C,buttonProps:Q,divProps:Z};return re}function sNe(t){var e=z.useRef(null),r=nNe(t.date,t.displayMonth,e);return r.isHidden?i.jsx("div",{role:"gridcell"}):r.isButton?i.jsx(vI,vs({name:"day",ref:e},r.buttonProps)):i.jsx("div",vs({},r.divProps))}function iNe(t){var e=t.number,r=t.dates,n=ba(),c=n.onWeekNumberClick,d=n.styles,p=n.classNames,a=n.locale,w=n.labels.labelWeekNumber,E=n.formatters.formatWeekNumber,C=E(Number(e),{locale:a});if(!c)return i.jsx("span",{className:p.weeknumber,style:d.weeknumber,children:C});var P=w(Number(e),{locale:a}),R=function(B){c(e,r,B)};return i.jsx(vI,{name:"week-number","aria-label":P,className:p.weeknumber,style:d.weeknumber,onClick:R,children:C})}function aNe(t){var e,r,n=ba(),c=n.styles,d=n.classNames,p=n.showWeekNumber,a=n.components,w=(e=a==null?void 0:a.Day)!==null&&e!==void 0?e:sNe,E=(r=a==null?void 0:a.WeekNumber)!==null&&r!==void 0?r:iNe,C;return p&&(C=i.jsx("td",{className:d.cell,style:c.cell,children:i.jsx(E,{number:t.weekNumber,dates:t.dates})})),i.jsxs("tr",{className:d.row,style:c.row,children:[C,t.dates.map(function(P){return i.jsx("td",{className:d.cell,style:c.cell,role:"presentation",children:i.jsx(w,{displayMonth:t.displayMonth,date:P})},FEe(P))})]})}function r$(t,e,r){for(var n=r!=null&&r.ISOWeek?EX(e):m4(e,r),c=r!=null&&r.ISOWeek?Sy(t):uf(t,r),d=Kh(n,c),p=[],a=0;a<=d;a++)p.push(wc(c,a));var w=p.reduce(function(E,C){var P=r!=null&&r.ISOWeek?jX(C):IX(C,r),R=E.find(function(B){return B.weekNumber===P});return R?(R.dates.push(C),E):(E.push({weekNumber:P,dates:[C]}),E)},[]);return w}function oNe(t,e){var r=r$(iu(t),aA(t),e);if(e!=null&&e.useFixedWeeks){var n=BEe(t,e);if(n<6){var c=r[r.length-1],d=c.dates[c.dates.length-1],p=JD(d,6-n),a=r$(JD(d,1),p,e);r.push.apply(r,a)}}return r}function lNe(t){var e,r,n,c=ba(),d=c.locale,p=c.classNames,a=c.styles,w=c.hideHead,E=c.fixedWeeks,C=c.components,P=c.weekStartsOn,R=c.firstWeekContainsDate,B=c.ISOWeek,V=oNe(t.displayMonth,{useFixedWeeks:!!E,ISOWeek:B,locale:d,weekStartsOn:P,firstWeekContainsDate:R}),W=(e=C==null?void 0:C.Head)!==null&&e!==void 0?e:Sje,K=(r=C==null?void 0:C.Row)!==null&&r!==void 0?r:aNe,Z=(n=C==null?void 0:C.Footer)!==null&&n!==void 0?n:vje;return i.jsxs("table",{id:t.id,className:p.table,style:a.table,role:"grid","aria-labelledby":t["aria-labelledby"],children:[!w&&i.jsx(W,{}),i.jsx("tbody",{className:p.tbody,style:a.tbody,children:V.map(function($){return i.jsx(K,{displayMonth:t.displayMonth,dates:$.dates,weekNumber:$.weekNumber},$.weekNumber)})}),i.jsx(Z,{displayMonth:t.displayMonth})]})}function cNe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var uNe=cNe()?z.useLayoutEffect:z.useEffect,$R=!1,dNe=0;function n$(){return"react-day-picker-".concat(++dNe)}function hNe(t){var e,r=t??($R?n$():null),n=z.useState(r),c=n[0],d=n[1];return uNe(function(){c===null&&d(n$())},[]),z.useEffect(function(){$R===!1&&($R=!0)},[]),(e=t??c)!==null&&e!==void 0?e:void 0}function fNe(t){var e,r,n=ba(),c=n.dir,d=n.classNames,p=n.styles,a=n.components,w=XE().displayMonths,E=hNe(n.id?"".concat(n.id,"-").concat(t.displayIndex):void 0),C=n.id?"".concat(n.id,"-grid-").concat(t.displayIndex):void 0,P=[d.month],R=p.month,B=t.displayIndex===0,V=t.displayIndex===w.length-1,W=!B&&!V;c==="rtl"&&(e=[B,V],V=e[0],B=e[1]),B&&(P.push(d.caption_start),R=vs(vs({},R),p.caption_start)),V&&(P.push(d.caption_end),R=vs(vs({},R),p.caption_end)),W&&(P.push(d.caption_between),R=vs(vs({},R),p.caption_between));var K=(r=a==null?void 0:a.Caption)!==null&&r!==void 0?r:xje;return i.jsxs("div",{className:P.join(" "),style:R,children:[i.jsx(K,{id:E,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),i.jsx(lNe,{id:C,"aria-labelledby":E,displayMonth:t.displayMonth})]},t.displayIndex)}function pNe(t){var e=ba(),r=e.classNames,n=e.styles;return i.jsx("div",{className:r.months,style:n.months,children:t.children})}function mNe(t){var e,r,n=t.initialProps,c=ba(),d=C4(),p=XE(),a=z.useState(!1),w=a[0],E=a[1];z.useEffect(function(){c.initialFocus&&d.focusTarget&&(w||(d.focus(d.focusTarget),E(!0)))},[c.initialFocus,w,d.focus,d.focusTarget,d]);var C=[c.classNames.root,c.className];c.numberOfMonths>1&&C.push(c.classNames.multiple_months),c.showWeekNumber&&C.push(c.classNames.with_weeknumber);var P=vs(vs({},c.styles.root),c.style),R=Object.keys(n).filter(function(V){return V.startsWith("data-")}).reduce(function(V,W){var K;return vs(vs({},V),(K={},K[W]=n[W],K))},{}),B=(r=(e=n.components)===null||e===void 0?void 0:e.Months)!==null&&r!==void 0?r:pNe;return i.jsx("div",vs({className:C.join(" "),style:P,dir:c.dir,id:c.id,nonce:n.nonce,title:n.title,lang:n.lang},R,{children:i.jsx(B,{children:p.displayMonths.map(function(V,W){return i.jsx(fNe,{displayIndex:W,displayMonth:V},W)})})}))}function gNe(t){var e=t.children,r=B2e(t,["children"]);return i.jsx(ije,{initialProps:r,children:i.jsx(mje,{children:i.jsx(Xje,{initialProps:r,children:i.jsx(Tje,{initialProps:r,children:i.jsx(Ije,{initialProps:r,children:i.jsx(Oje,{children:i.jsx(Zje,{children:e})})})})})})})}function _Ne(t){return i.jsx(gNe,vs({},t,{children:i.jsx(mNe,{initialProps:t})}))}function JY({className:t,classNames:e,showOutsideDays:r=!0,...n}){return i.jsx(_Ne,{showOutsideDays:r,className:kn("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:kn(VD({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:kn("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",n.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:kn(VD({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50  aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...e},components:{IconLeft:({...c})=>i.jsx(j1e,{className:"h-4 w-4"}),IconRight:({...c})=>i.jsx(nX,{className:"h-4 w-4"})},...n})}JY.displayName="Calendar";var P4="Popover",[QY,wLe]=hd(P4,[fw]),YE=fw(),[yNe,Dg]=QY(P4),eJ=t=>{const{__scopePopover:e,children:r,open:n,defaultOpen:c,onOpenChange:d,modal:p=!1}=t,a=YE(e),w=z.useRef(null),[E,C]=z.useState(!1),[P=!1,R]=ud({prop:n,defaultProp:c,onChange:d});return i.jsx(t4,{...a,children:i.jsx(yNe,{scope:e,contentId:ku(),triggerRef:w,open:P,onOpenChange:R,onOpenToggle:z.useCallback(()=>R(B=>!B),[R]),hasCustomAnchor:E,onCustomAnchorAdd:z.useCallback(()=>C(!0),[]),onCustomAnchorRemove:z.useCallback(()=>C(!1),[]),modal:p,children:r})})};eJ.displayName=P4;var tJ="PopoverAnchor",xNe=z.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,c=Dg(tJ,r),d=YE(r),{onCustomAnchorAdd:p,onCustomAnchorRemove:a}=c;return z.useEffect(()=>(p(),()=>a()),[p,a]),i.jsx(YC,{...d,...n,ref:e})});xNe.displayName=tJ;var rJ="PopoverTrigger",nJ=z.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,c=Dg(rJ,r),d=YE(r),p=Fs(e,c.triggerRef),a=i.jsx(Pn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":c.open,"aria-controls":c.contentId,"data-state":lJ(c.open),...n,ref:p,onClick:tn(t.onClick,c.onOpenToggle)});return c.hasCustomAnchor?a:i.jsx(YC,{asChild:!0,...d,children:a})});nJ.displayName=rJ;var k4="PopoverPortal",[vNe,wNe]=QY(k4,{forceMount:void 0}),sJ=t=>{const{__scopePopover:e,forceMount:r,children:n,container:c}=t,d=Dg(k4,e);return i.jsx(vNe,{scope:e,forceMount:r,children:i.jsx(Xl,{present:r||d.open,children:i.jsx(UE,{asChild:!0,container:c,children:n})})})};sJ.displayName=k4;var z0="PopoverContent",iJ=z.forwardRef((t,e)=>{const r=wNe(z0,t.__scopePopover),{forceMount:n=r.forceMount,...c}=t,d=Dg(z0,t.__scopePopover);return i.jsx(Xl,{present:n||d.open,children:d.modal?i.jsx(bNe,{...c,ref:e}):i.jsx(SNe,{...c,ref:e})})});iJ.displayName=z0;var bNe=z.forwardRef((t,e)=>{const r=Dg(z0,t.__scopePopover),n=z.useRef(null),c=Fs(e,n),d=z.useRef(!1);return z.useEffect(()=>{const p=n.current;if(p)return eA(p)},[]),i.jsx($E,{as:Ep,allowPinchZoom:!0,children:i.jsx(aJ,{...t,ref:c,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:tn(t.onCloseAutoFocus,p=>{var a;p.preventDefault(),d.current||(a=r.triggerRef.current)==null||a.focus()}),onPointerDownOutside:tn(t.onPointerDownOutside,p=>{const a=p.detail.originalEvent,w=a.button===0&&a.ctrlKey===!0,E=a.button===2||w;d.current=E},{checkForDefaultPrevented:!1}),onFocusOutside:tn(t.onFocusOutside,p=>p.preventDefault(),{checkForDefaultPrevented:!1})})})}),SNe=z.forwardRef((t,e)=>{const r=Dg(z0,t.__scopePopover),n=z.useRef(!1),c=z.useRef(!1);return i.jsx(aJ,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:d=>{var p,a;(p=t.onCloseAutoFocus)==null||p.call(t,d),d.defaultPrevented||(n.current||(a=r.triggerRef.current)==null||a.focus(),d.preventDefault()),n.current=!1,c.current=!1},onInteractOutside:d=>{var w,E;(w=t.onInteractOutside)==null||w.call(t,d),d.defaultPrevented||(n.current=!0,d.detail.originalEvent.type==="pointerdown"&&(c.current=!0));const p=d.target;((E=r.triggerRef.current)==null?void 0:E.contains(p))&&d.preventDefault(),d.detail.originalEvent.type==="focusin"&&c.current&&d.preventDefault()}})}),aJ=z.forwardRef((t,e)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:c,onCloseAutoFocus:d,disableOutsidePointerEvents:p,onEscapeKeyDown:a,onPointerDownOutside:w,onFocusOutside:E,onInteractOutside:C,...P}=t,R=Dg(z0,r),B=YE(r);return WC(),i.jsx(BE,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:c,onUnmountAutoFocus:d,children:i.jsx(zE,{asChild:!0,disableOutsidePointerEvents:p,onInteractOutside:C,onEscapeKeyDown:a,onPointerDownOutside:w,onFocusOutside:E,onDismiss:()=>R.onOpenChange(!1),children:i.jsx(r4,{"data-state":lJ(R.open),role:"dialog",id:R.contentId,...B,...P,ref:e,style:{...P.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),oJ="PopoverClose",ENe=z.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,c=Dg(oJ,r);return i.jsx(Pn.button,{type:"button",...n,ref:e,onClick:tn(t.onClick,()=>c.onOpenChange(!1))})});ENe.displayName=oJ;var TNe="PopoverArrow",jNe=z.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,c=YE(r);return i.jsx(n4,{...c,...n,ref:e})});jNe.displayName=TNe;function lJ(t){return t?"open":"closed"}var NNe=eJ,INe=nJ,CNe=sJ,cJ=iJ;const ANe=NNe,PNe=INe,uJ=z.forwardRef(({className:t,align:e="center",sideOffset:r=4,...n},c)=>i.jsx(CNe,{children:i.jsx(cJ,{ref:c,align:e,sideOffset:r,className:kn("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}));uJ.displayName=cJ.displayName;const gv=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch{return new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return t&&typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date},dA=pw((t,e)=>({paymentMethods:[],paymentRequests:[],loading:!1,initializePaymentMethods:()=>{t({paymentMethods:[{id:"cash",type:"cash",name:"Espèces",icon:"💵",description:"Paiement en liquide lors de la rencontre",fees:0,processingTime:"Immédiat",securityLevel:"medium",available:!0},{id:"transfer",type:"transfer",name:"Virement bancaire",icon:"🏦",description:"Virement SEPA sécurisé",fees:0,processingTime:"1-2 jours ouvrés",securityLevel:"high",available:!0},{id:"paypal",type:"paypal",name:"PayPal",icon:"💳",description:"Paiement sécurisé via PayPal",fees:2.9,processingTime:"Immédiat",securityLevel:"high",available:!0},{id:"lydia",type:"lydia",name:"Lydia",icon:"📱",description:"Paiement mobile instantané",fees:0,processingTime:"Immédiat",securityLevel:"medium",available:!0}]})},createPaymentRequest:async r=>{try{t({loading:!0});const n=e().generateSecurityCode(),c={...r,securityCode:n,status:"pending",createdAt:aa(),updatedAt:aa()},d=await af(jn(rr,"paymentRequests"),c),p={id:d.id,...r,securityCode:n,status:"pending",createdAt:new Date,updatedAt:new Date};return t(a=>({paymentRequests:[p,...a.paymentRequests],loading:!1})),Nt.success("Demande de paiement créée avec succès"),d.id}catch(n){throw console.error("Erreur lors de la création de la demande de paiement:",n),Nt.error("Erreur lors de la création de la demande de paiement"),t({loading:!1}),n}},updatePaymentStatus:async(r,n,c)=>{try{const d={status:n,updatedAt:aa()};c&&(d.notes=c),await Rs(hn(rr,"paymentRequests",r),d),t(a=>({paymentRequests:a.paymentRequests.map(w=>w.id===r?{...w,status:n,notes:c||w.notes,updatedAt:new Date}:w)}));const p={confirmed:"Paiement confirmé",completed:"Paiement terminé",cancelled:"Paiement annulé",disputed:"Litige signalé"};Nt.success(p[n]||"Statut mis à jour")}catch(d){console.error("Erreur lors de la mise à jour du statut:",d),Nt.error("Erreur lors de la mise à jour du statut")}},fetchUserPaymentRequests:async r=>{if(r)try{t({loading:!0});const n=ms(jn(rr,"paymentRequests"),ii("buyerId","==",r),la(50)),c=ms(jn(rr,"paymentRequests"),ii("sellerId","==",r),la(50)),[d,p]=await Promise.all([gs(n),gs(c)]),a=[];d.forEach(w=>{const E=w.data();a.push({id:w.id,...E,createdAt:gv(E.createdAt),updatedAt:gv(E.updatedAt),meetingDateTime:E.meetingDateTime?gv(E.meetingDateTime):void 0})}),p.forEach(w=>{const E=w.data();a.find(C=>C.id===w.id)||a.push({id:w.id,...E,createdAt:gv(E.createdAt),updatedAt:gv(E.updatedAt),meetingDateTime:E.meetingDateTime?gv(E.meetingDateTime):void 0})}),a.sort((w,E)=>E.createdAt.getTime()-w.createdAt.getTime()),t({paymentRequests:a,loading:!1})}catch(n){console.error("Erreur lors du chargement des demandes de paiement:",n),Nt.error("Erreur lors du chargement des demandes de paiement"),t({loading:!1})}},generateSecurityCode:()=>Math.random().toString(36).substring(2,8).toUpperCase(),validatePaymentMethod:(r,n)=>{switch(r){case"cash":return!0;case"transfer":return n.bankDetails&&n.bankDetails.iban&&n.bankDetails.accountName;case"paypal":return n.paypalEmail&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.paypalEmail);case"lydia":return n.lydiaPhone&&/^(\+33|0)[1-9](\d{8})$/.test(n.lydiaPhone.replace(/\s/g,""));default:return!1}},calculateFees:(r,n)=>{const{paymentMethods:c}=e(),d=c.find(p=>p.type===n);return d?r*d.fees/100:0},getPaymentInstructions:(r,n)=>{var d,p,a;const c=[];switch(r){case"cash":c.push("💵 Paiement en espèces","📍 Rencontrez-vous au lieu convenu","🔍 Vérifiez l'objet avant de payer","🧾 Demandez un reçu si nécessaire",`🔐 Code de sécurité : ${n.securityCode}`);break;case"transfer":c.push("🏦 Virement bancaire SEPA","📋 Utilisez les coordonnées bancaires fournies","💬 Indiquez la référence de transaction","⏱️ Délai : 1-2 jours ouvrés",`🔐 Code de sécurité : ${n.securityCode}`),(d=n.paymentDetails)!=null&&d.bankDetails&&c.push(`📊 IBAN : ${n.paymentDetails.bankDetails.iban}`,`🏛️ Titulaire : ${n.paymentDetails.bankDetails.accountName}`);break;case"paypal":c.push("💳 Paiement PayPal","📧 Envoyez le paiement à l'adresse email fournie",'🛡️ Utilisez "Biens et services" pour la protection',"⚡ Paiement instantané",`🔐 Code de sécurité : ${n.securityCode}`),(p=n.paymentDetails)!=null&&p.paypalEmail&&c.push(`📧 Email PayPal : ${n.paymentDetails.paypalEmail}`);break;case"lydia":c.push("📱 Paiement Lydia","📞 Envoyez le paiement au numéro fourni","💬 Indiquez la référence de transaction","⚡ Paiement instantané",`🔐 Code de sécurité : ${n.securityCode}`),(a=n.paymentDetails)!=null&&a.lydiaPhone&&c.push(`📞 Numéro Lydia : ${n.paymentDetails.lydiaPhone}`);break}return c}}));var dJ={exports:{}},kNe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",RNe=kNe,MNe=RNe;function hJ(){}function fJ(){}fJ.resetWarningCache=hJ;var DNe=function(){function t(n,c,d,p,a,w){if(w!==MNe){var E=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw E.name="Invariant Violation",E}}t.isRequired=t;function e(){return t}var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:fJ,resetWarningCache:hJ};return r.PropTypes=r,r};dJ.exports=DNe();var ONe=dJ.exports;const Ga=W0(ONe);function s$(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,n)}return r}function i$(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?s$(Object(r),!0).forEach(function(n){pJ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s$(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function aN(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?aN=function(e){return typeof e}:aN=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},aN(t)}function pJ(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mJ(t,e){return LNe(t)||FNe(t,e)||zNe(t,e)||BNe()}function LNe(t){if(Array.isArray(t))return t}function FNe(t,e){var r=t&&(typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"]);if(r!=null){var n=[],c=!0,d=!1,p,a;try{for(r=r.call(t);!(c=(p=r.next()).done)&&(n.push(p.value),!(e&&n.length===e));c=!0);}catch(w){d=!0,a=w}finally{try{!c&&r.return!=null&&r.return()}finally{if(d)throw a}}return n}}function zNe(t,e){if(t){if(typeof t=="string")return a$(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a$(t,e)}}function a$(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function BNe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Su=function(e,r,n){var c=!!n,d=_n.useRef(n);_n.useEffect(function(){d.current=n},[n]),_n.useEffect(function(){if(!c||!e)return function(){};var p=function(){d.current&&d.current.apply(d,arguments)};return e.on(r,p),function(){e.off(r,p)}},[c,r,e,d])},iO=function(e){var r=_n.useRef(e);return _n.useEffect(function(){r.current=e},[e]),r.current},B0=function(e){return e!==null&&aN(e)==="object"},VNe=function(e){return B0(e)&&typeof e.then=="function"},UNe=function(e){return B0(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},o$="[object Object]",$Ne=function t(e,r){if(!B0(e)||!B0(r))return e===r;var n=Array.isArray(e),c=Array.isArray(r);if(n!==c)return!1;var d=Object.prototype.toString.call(e)===o$,p=Object.prototype.toString.call(r)===o$;if(d!==p)return!1;if(!d&&!n)return e===r;var a=Object.keys(e),w=Object.keys(r);if(a.length!==w.length)return!1;for(var E={},C=0;C<a.length;C+=1)E[a[C]]=!0;for(var P=0;P<w.length;P+=1)E[w[P]]=!0;var R=Object.keys(E);if(R.length!==a.length)return!1;var B=e,V=r,W=function(Z){return t(B[Z],V[Z])};return R.every(W)},gJ=function(e,r,n){return B0(e)?Object.keys(e).reduce(function(c,d){var p=!B0(r)||!$Ne(e[d],r[d]);return n.includes(d)?(p&&console.warn("Unsupported prop change: options.".concat(d," is not a mutable property.")),c):p?i$(i$({},c||{}),{},pJ({},d,e[d])):c},null):null},_J="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",l$=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_J;if(e===null||UNe(e))return e;throw new Error(r)},qNe=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_J;if(VNe(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(c){return l$(c,r)})};var n=l$(e,r);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},GNe=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"2.8.1"}),e.registerAppInfo({name:"react-stripe-js",version:"2.8.1",url:"https://stripe.com/docs/stripe-js/react"}))},hA=_n.createContext(null);hA.displayName="ElementsContext";var yJ=function(e,r){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return e},xJ=function(e){var r=e.stripe,n=e.options,c=e.children,d=_n.useMemo(function(){return qNe(r)},[r]),p=_n.useState(function(){return{stripe:d.tag==="sync"?d.stripe:null,elements:d.tag==="sync"?d.stripe.elements(n):null}}),a=mJ(p,2),w=a[0],E=a[1];_n.useEffect(function(){var R=!0,B=function(W){E(function(K){return K.stripe?K:{stripe:W,elements:W.elements(n)}})};return d.tag==="async"&&!w.stripe?d.stripePromise.then(function(V){V&&R&&B(V)}):d.tag==="sync"&&!w.stripe&&B(d.stripe),function(){R=!1}},[d,w,n]);var C=iO(r);_n.useEffect(function(){C!==null&&C!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[C,r]);var P=iO(n);return _n.useEffect(function(){if(w.elements){var R=gJ(n,P,["clientSecret","fonts"]);R&&w.elements.update(R)}},[n,P,w.elements]),_n.useEffect(function(){GNe(w.stripe)},[w.stripe]),_n.createElement(hA.Provider,{value:w},c)};xJ.propTypes={stripe:Ga.any,options:Ga.object};var HNe=function(e){var r=_n.useContext(hA);return yJ(r,e)},WNe=function(){var e=HNe("calls useElements()"),r=e.elements;return r};Ga.func.isRequired;var vJ=_n.createContext(null);vJ.displayName="CustomCheckoutSdkContext";var ZNe=function(e,r){if(!e)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(r," in an <CustomCheckoutProvider> provider."));return e},KNe=_n.createContext(null);KNe.displayName="CustomCheckoutContext";Ga.any,Ga.shape({clientSecret:Ga.string.isRequired,elementsOptions:Ga.object}).isRequired;var aO=function(e){var r=_n.useContext(vJ),n=_n.useContext(hA);if(r&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CustomCheckoutProvider> and <Elements> providers."));return r?ZNe(r,e):yJ(n,e)},XNe=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},Bo=function(e,r){var n="".concat(XNe(e),"Element"),c=function(w){var E=w.id,C=w.className,P=w.options,R=P===void 0?{}:P,B=w.onBlur,V=w.onFocus,W=w.onReady,K=w.onChange,Z=w.onEscape,$=w.onClick,X=w.onLoadError,Q=w.onLoaderStart,re=w.onNetworksChange,ve=w.onConfirm,pe=w.onCancel,ue=w.onShippingAddressChange,ge=w.onShippingRateChange,ce=aO("mounts <".concat(n,">")),Se="elements"in ce?ce.elements:null,le="customCheckoutSdk"in ce?ce.customCheckoutSdk:null,J=_n.useState(null),ke=mJ(J,2),Ze=ke[0],Xe=ke[1],qe=_n.useRef(null),$e=_n.useRef(null);Su(Ze,"blur",B),Su(Ze,"focus",V),Su(Ze,"escape",Z),Su(Ze,"click",$),Su(Ze,"loaderror",X),Su(Ze,"loaderstart",Q),Su(Ze,"networkschange",re),Su(Ze,"confirm",ve),Su(Ze,"cancel",pe),Su(Ze,"shippingaddresschange",ue),Su(Ze,"shippingratechange",ge),Su(Ze,"change",K);var st;W&&(e==="expressCheckout"?st=W:st=function(){W(Ze)}),Su(Ze,"ready",st),_n.useLayoutEffect(function(){if(qe.current===null&&$e.current!==null&&(Se||le)){var Mt=null;le?Mt=le.createElement(e,R):Se&&(Mt=Se.create(e,R)),qe.current=Mt,Xe(Mt),Mt&&Mt.mount($e.current)}},[Se,le,R]);var it=iO(R);return _n.useEffect(function(){if(qe.current){var Mt=gJ(R,it,["paymentRequest"]);Mt&&"update"in qe.current&&qe.current.update(Mt)}},[R,it]),_n.useLayoutEffect(function(){return function(){if(qe.current&&typeof qe.current.destroy=="function")try{qe.current.destroy(),qe.current=null}catch{}}},[]),_n.createElement("div",{id:E,className:C,ref:$e})},d=function(w){aO("mounts <".concat(n,">"));var E=w.id,C=w.className;return _n.createElement("div",{id:E,className:C})},p=r?d:c;return p.propTypes={id:Ga.string,className:Ga.string,onChange:Ga.func,onBlur:Ga.func,onFocus:Ga.func,onReady:Ga.func,onEscape:Ga.func,onClick:Ga.func,onLoadError:Ga.func,onLoaderStart:Ga.func,onNetworksChange:Ga.func,onConfirm:Ga.func,onCancel:Ga.func,onShippingAddressChange:Ga.func,onShippingRateChange:Ga.func,options:Ga.object},p.displayName=n,p.__elementType=e,p},Vo=typeof window>"u",YNe=_n.createContext(null);YNe.displayName="EmbeddedCheckoutProviderContext";var JNe=function(){var e=aO("calls useStripe()"),r=e.stripe;return r};Bo("auBankAccount",Vo);Bo("card",Vo);Bo("cardNumber",Vo);Bo("cardExpiry",Vo);Bo("cardCvc",Vo);Bo("fpxBank",Vo);Bo("iban",Vo);Bo("idealBank",Vo);Bo("p24Bank",Vo);Bo("epsBank",Vo);var QNe=Bo("payment",Vo);Bo("expressCheckout",Vo);Bo("currencySelector",Vo);Bo("paymentRequestButton",Vo);Bo("linkAuthentication",Vo);Bo("address",Vo);Bo("shippingAddress",Vo);Bo("paymentMethodMessaging",Vo);Bo("affirmMessage",Vo);Bo("afterpayClearpayMessage",Vo);var wJ="https://js.stripe.com/v3",eIe=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,c$="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",tIe=function(){for(var e=document.querySelectorAll('script[src^="'.concat(wJ,'"]')),r=0;r<e.length;r++){var n=e[r];if(eIe.test(n.src))return n}return null},u$=function(e){var r="",n=document.createElement("script");n.src="".concat(wJ).concat(r);var c=document.head||document.body;if(!c)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return c.appendChild(n),n},rIe=function(e,r){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:r})},N1=null,Sj=null,Ej=null,nIe=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},sIe=function(e,r){return function(){window.Stripe?e(window.Stripe):r(new Error("Stripe.js not available"))}},iIe=function(e){return N1!==null?N1:(N1=new Promise(function(r,n){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe&&e&&console.warn(c$),window.Stripe){r(window.Stripe);return}try{var c=tIe();if(c&&e)console.warn(c$);else if(!c)c=u$(e);else if(c&&Ej!==null&&Sj!==null){var d;c.removeEventListener("load",Ej),c.removeEventListener("error",Sj),(d=c.parentNode)===null||d===void 0||d.removeChild(c),c=u$(e)}Ej=sIe(r,n),Sj=nIe(n),c.addEventListener("load",Ej),c.addEventListener("error",Sj)}catch(p){n(p);return}}),N1.catch(function(r){return N1=null,Promise.reject(r)}))},aIe=function(e,r,n){if(e===null)return null;var c=e.apply(void 0,r);return rIe(c,n),c},I1,bJ=!1,SJ=function(){return I1||(I1=iIe(null).catch(function(e){return I1=null,Promise.reject(e)}),I1)};Promise.resolve().then(function(){return SJ()}).catch(function(t){bJ||console.warn(t)});var oIe=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];bJ=!0;var c=Date.now();return SJ().then(function(d){return aIe(d,r,c)})};const EJ="pk_test_51RY7Vw2XLhzYQhT9mWGOChkOK9Lp7QGPlTA5mqrZhHCDwiRGdgXeEpCanybQGuvXy4FsNTyDOTlYNkGsBGXEGNhS00ORRyOHto",TJ="eur".toLowerCase(),lIe={isConfigured:EJ.startsWith("pk_"),currency:TJ,country:"fr"};let qR;const cIe=()=>(qR||(qR=oIe(EJ)),qR),Am={mode:"payment",currency:TJ,appearance:{theme:"stripe",variables:{colorPrimary:"#3b82f6",colorBackground:"#ffffff",colorText:"#1a202c",colorDanger:"#ef4444",fontFamily:"Inter, system-ui, sans-serif",spacingUnit:"4px",borderRadius:"8px"},rules:{".Input":{border:"1px solid #e2e8f0",borderRadius:"8px",padding:"12px",fontSize:"16px"},".Input:focus":{borderColor:"#3b82f6",boxShadow:"0 0 0 3px rgba(59, 130, 246, 0.1)"},".Label":{fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"6px"}}}},uIe={...Am,appearance:{...Am.appearance,theme:"night",variables:{...Am.appearance.variables,colorBackground:"#1a202c",colorText:"#f7fafc",colorPrimary:"#60a5fa"},rules:{...Am.appearance.rules,".Input":{...Am.appearance.rules[".Input"],backgroundColor:"#2d3748",borderColor:"#4a5568",color:"#f7fafc"},".Input:focus":{...Am.appearance.rules[".Input:focus"],borderColor:"#60a5fa",boxShadow:"0 0 0 3px rgba(96, 165, 250, 0.1)"},".Label":{...Am.appearance.rules[".Label"],color:"#e2e8f0"}}}},dIe=async t=>(console.log("getUserSubscription called for user:",t),null),hIe=async t=>(console.log("getUserOrders called for user:",t),[]),jJ=({children:t,clientSecret:e,amount:r=0,currency:n="eur"})=>{const{resolvedTheme:c}=lC(),d=(c==="dark"?uIe:Am).appearance,p=z.useMemo(()=>e?{clientSecret:e,appearance:d}:{mode:"payment",amount:Math.round((r||0)*100),currency:(n||"eur").toLowerCase(),appearance:d},[e,c]);return i.jsx(xJ,{stripe:cIe(),options:p,children:t},`${c}_${e?`cs_${e.slice(-8)}`:"deferred"}`)},fIe=({amount:t,currency:e,onMethodSelect:r,selectedMethod:n})=>{const{paymentMethods:c,calculateFees:d}=dA(),[p,a]=z.useState({}),[w,E]=z.useState({}),[C,P]=z.useState(null),R=[{id:"card",type:"card",name:"Carte bancaire",icon:Aa,description:"Paiement sécurisé par carte",fees:1.5,processingTime:"Immédiat",securityLevel:"high",available:!0},...c],B=re=>{switch(re){case"card":return Aa;case"cash":return z3;case"transfer":return Nxe;case"paypal":return Aa;case"lydia":return Ag;default:return Aa}},V=re=>{switch(re){case"high":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},W=(re,ve)=>{var ue,ge;const pe={};switch(re){case"card":return!0;case"transfer":(ue=ve.bankDetails)!=null&&ue.iban?/^[A-Z]{2}\d{2}[A-Z0-9]{4}\d{7}([A-Z0-9]?){0,16}$/.test(ve.bankDetails.iban.replace(/\s/g,""))||(pe.iban="Format IBAN invalide"):pe.iban="IBAN requis",(ge=ve.bankDetails)!=null&&ge.accountName||(pe.accountName="Nom du titulaire requis");break;case"paypal":ve.paypalEmail?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ve.paypalEmail)||(pe.paypalEmail="Format email invalide"):pe.paypalEmail="Email PayPal requis";break;case"lydia":ve.lydiaPhone?/^(\+33|0)[1-9](\d{8})$/.test(ve.lydiaPhone.replace(/\s/g,""))||(pe.lydiaPhone="Format de téléphone invalide"):pe.lydiaPhone="Numéro de téléphone requis";break}return E(pe),Object.keys(pe).length===0},K=re=>{if(re==="card"){r(re,{});return}const ve=p[re]||{};(re==="cash"||W(re,ve))&&r(re,ve)},Z=(re,ve,pe)=>{a(ue=>({...ue,[re]:{...ue[re],[ve]:pe}}))},$=(re,ve)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:ve||"EUR"}).format(re),X=re=>{P(re),r("card",{stripePaymentId:re})},Q=re=>{console.error("Stripe payment error:",re)};return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Choisissez votre mode de paiement"}),i.jsxs("p",{className:"text-muted-foreground",children:["Montant à payer : ",i.jsx("span",{className:"font-semibold text-primary",children:$(t,e)})]})]}),n==="card"?i.jsx(jJ,{amount:t,currency:e,onPaymentSuccess:X,onPaymentError:Q}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:R.map(re=>{var ce,Se,le,J,ke,Ze,Xe,qe;const ve=B(re.type),pe=re.type==="card"?t*re.fees/100:d(t,re.type),ue=t+pe,ge=n===re.type;return i.jsxs(Tt,{className:`cursor-pointer transition-all hover:shadow-md ${ge?"ring-2 ring-primary bg-primary/5":""} ${re.available?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>re.available&&K(re.type),children:[i.jsx(Dr,{className:"pb-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:i.jsx(ve,{className:"w-6 h-6 text-primary"})}),i.jsxs("div",{children:[i.jsx(kr,{className:"text-lg",children:re.name}),i.jsx(Ls,{className:"text-sm",children:re.description})]})]}),ge&&i.jsx(qs,{className:"w-6 h-6 text-green-600"})]})}),i.jsxs(jt,{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Fi,{className:"w-4 h-4 text-muted-foreground"}),i.jsx("span",{children:re.processingTime})]}),i.jsxs(Ir,{className:V(re.securityLevel),children:[i.jsx(Ms,{className:"w-3 h-3 mr-1"}),re.securityLevel==="high"?"Très sécurisé":re.securityLevel==="medium"?"Sécurisé":"Basique"]})]}),pe>0&&i.jsxs("div",{className:"text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{children:"Montant :"}),i.jsx("span",{children:$(t,e)})]}),i.jsxs("div",{className:"flex justify-between text-blue-600",children:[i.jsxs("span",{children:["Frais (",re.fees,"%) :"]}),i.jsx("span",{children:$(pe,e)})]}),i.jsxs("div",{className:"flex justify-between font-semibold border-t pt-1",children:[i.jsx("span",{children:"Total :"}),i.jsx("span",{children:$(ue,e)})]})]}),ge&&re.type!=="cash"&&re.type!=="card"&&i.jsxs("div",{className:"space-y-3 pt-3 border-t",children:[re.type==="transfer"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:`iban-${re.id}`,children:"IBAN *"}),i.jsx(Gr,{id:`iban-${re.id}`,placeholder:"FR76 1234 5678 9012 3456 7890 123",value:((Se=(ce=p[re.type])==null?void 0:ce.bankDetails)==null?void 0:Se.iban)||"",onChange:$e=>{var st;return Z(re.type,"bankDetails",{...(st=p[re.type])==null?void 0:st.bankDetails,iban:$e.target.value})},className:w.iban?"border-red-500":""}),w.iban&&i.jsx("p",{className:"text-sm text-red-500 mt-1",children:w.iban})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:`account-name-${re.id}`,children:"Nom du titulaire *"}),i.jsx(Gr,{id:`account-name-${re.id}`,placeholder:"Jean Dupont",value:((J=(le=p[re.type])==null?void 0:le.bankDetails)==null?void 0:J.accountName)||"",onChange:$e=>{var st;return Z(re.type,"bankDetails",{...(st=p[re.type])==null?void 0:st.bankDetails,accountName:$e.target.value})},className:w.accountName?"border-red-500":""}),w.accountName&&i.jsx("p",{className:"text-sm text-red-500 mt-1",children:w.accountName})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:`bic-${re.id}`,children:"BIC (optionnel)"}),i.jsx(Gr,{id:`bic-${re.id}`,placeholder:"BNPAFRPP",value:((Ze=(ke=p[re.type])==null?void 0:ke.bankDetails)==null?void 0:Ze.bic)||"",onChange:$e=>{var st;return Z(re.type,"bankDetails",{...(st=p[re.type])==null?void 0:st.bankDetails,bic:$e.target.value})}})]})]}),re.type==="paypal"&&i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:`paypal-email-${re.id}`,children:"Email PayPal *"}),i.jsx(Gr,{id:`paypal-email-${re.id}`,type:"email",placeholder:"votre.email@example.com",value:((Xe=p[re.type])==null?void 0:Xe.paypalEmail)||"",onChange:$e=>Z(re.type,"paypalEmail",$e.target.value),className:w.paypalEmail?"border-red-500":""}),w.paypalEmail&&i.jsx("p",{className:"text-sm text-red-500 mt-1",children:w.paypalEmail})]}),re.type==="lydia"&&i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:`lydia-phone-${re.id}`,children:"Numéro de téléphone *"}),i.jsx(Gr,{id:`lydia-phone-${re.id}`,type:"tel",placeholder:"06 12 34 56 78",value:((qe=p[re.type])==null?void 0:qe.lydiaPhone)||"",onChange:$e=>Z(re.type,"lydiaPhone",$e.target.value),className:w.lydiaPhone?"border-red-500":""}),w.lydiaPhone&&i.jsx("p",{className:"text-sm text-red-500 mt-1",children:w.lydiaPhone})]})]}),ge&&re.type!=="card"&&i.jsxs(Ys,{className:"mt-3",children:[i.jsx(yy,{className:"h-4 w-4"}),i.jsxs(Js,{children:[re.type==="cash"&&"Rencontrez-vous dans un lieu public et vérifiez l'objet avant de payer.",re.type==="transfer"&&"Le virement sera effectué après confirmation de la transaction. Délai : 1-2 jours ouvrés.",re.type==="paypal"&&"Utilisez l'option 'Biens et services' pour bénéficier de la protection PayPal.",re.type==="lydia"&&"Le paiement Lydia est instantané. Vérifiez le numéro avant d'envoyer."]})]})]})]},re.id)})}),i.jsxs(Ys,{className:"border-yellow-200 bg-yellow-50",children:[i.jsx(va,{className:"h-4 w-4 text-yellow-600"}),i.jsxs(Js,{className:"text-yellow-800",children:[i.jsx("strong",{children:"Conseils de sécurité :"})," Ne communiquez jamais vos informations bancaires par message. Utilisez uniquement les canaux sécurisés de StudyMarket pour les transactions."]})]})]})},pIe=({open:t,onOpenChange:e,listing:r})=>{var Q;const{currentUser:n,userProfile:c}=$i(),{createPaymentRequest:d,loading:p}=dA(),[a,w]=z.useState("method"),[E,C]=z.useState(null),[P,R]=z.useState({}),[B,V]=z.useState({location:"",date:void 0,time:"",notes:""}),W=(re,ve)=>{C(re),R(ve),w("details")},K=async()=>{if(!(!n||!E))try{const re=B.date&&B.time?new Date(`${Pa(B.date,"yyyy-MM-dd")} ${B.time}`):void 0;await d({listingId:r.id,buyerId:n.uid,sellerId:r.sellerId,amount:r.price,currency:r.currency||"EUR",paymentMethod:E,meetingLocation:B.location,meetingDateTime:re,paymentDetails:P,notes:B.notes}),e(!1),Z()}catch(re){console.error("Erreur lors de la création de la demande:",re)}},Z=()=>{w("method"),C(null),R({}),V({location:"",date:void 0,time:"",notes:""})},$=(re,ve)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:ve||"EUR"}).format(re),X=re=>({cash:"Espèces",transfer:"Virement bancaire",paypal:"PayPal",lydia:"Lydia"})[re]||re;return i.jsx(ta,{open:t,onOpenChange:e,children:i.jsxs(Ki,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(oa,{children:[i.jsxs(ra,{className:"flex items-center gap-2",children:[i.jsx(Aa,{className:"w-5 h-5"}),"Demande de paiement"]}),i.jsxs(go,{children:['Créez une demande de paiement sécurisée pour "',r.title,'"']})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[i.jsxs("div",{className:`flex items-center ${a==="method"?"text-primary":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${a==="method"?"border-primary bg-primary text-white":"border-muted-foreground"}`,children:"1"}),i.jsx("span",{className:"ml-2 text-sm font-medium",children:"Mode de paiement"})]}),i.jsx("div",{className:"w-8 h-px bg-muted-foreground"}),i.jsxs("div",{className:`flex items-center ${a==="details"?"text-primary":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${a==="details"?"border-primary bg-primary text-white":"border-muted-foreground"}`,children:"2"}),i.jsx("span",{className:"ml-2 text-sm font-medium",children:"Détails"})]}),i.jsx("div",{className:"w-8 h-px bg-muted-foreground"}),i.jsxs("div",{className:`flex items-center ${a==="confirmation"?"text-primary":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${a==="confirmation"?"border-primary bg-primary text-white":"border-muted-foreground"}`,children:"3"}),i.jsx("span",{className:"ml-2 text-sm font-medium",children:"Confirmation"})]})]}),i.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:i.jsxs("div",{className:"flex items-center gap-4",children:[((Q=r.images)==null?void 0:Q[0])&&i.jsx("img",{src:r.images[0],alt:r.title,className:"w-16 h-16 object-cover rounded"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold",children:r.title}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Vendeur : ",r.sellerName," • ",r.sellerUniversity]}),i.jsx("p",{className:"text-lg font-bold text-primary",children:$(r.price,r.currency||"EUR")})]})]})}),a==="method"&&i.jsx(fIe,{amount:r.price,currency:r.currency||"EUR",onMethodSelect:W,selectedMethod:E}),a==="details"&&E&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(qs,{className:"w-5 h-5 text-green-600"}),i.jsxs("span",{className:"font-medium",children:["Mode de paiement sélectionné : ",X(E)]})]}),E==="cash"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[i.jsx(dl,{className:"w-5 h-5"}),"Détails de la rencontre"]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"meeting-location",children:"Lieu de rencontre *"}),i.jsx(Gr,{id:"meeting-location",placeholder:"Ex: Bibliothèque universitaire, Hall principal...",value:B.location,onChange:re=>V(ve=>({...ve,location:re.target.value})),className:"mt-1"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{children:"Date de rencontre"}),i.jsxs(ANe,{children:[i.jsx(PNe,{asChild:!0,children:i.jsxs(Ge,{variant:"outline",className:"w-full justify-start text-left font-normal mt-1",children:[i.jsx(cl,{className:"mr-2 h-4 w-4"}),B.date?Pa(B.date,"PPP",{locale:po}):i.jsx("span",{children:"Choisir une date"})]})}),i.jsx(uJ,{className:"w-auto p-0",children:i.jsx(JY,{mode:"single",selected:B.date,onSelect:re=>V(ve=>({...ve,date:re})),disabled:re=>re<new Date,initialFocus:!0})})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"meeting-time",children:"Heure de rencontre"}),i.jsx(Gr,{id:"meeting-time",type:"time",value:B.time,onChange:re=>V(ve=>({...ve,time:re.target.value})),className:"mt-1"})]})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"payment-notes",children:"Notes additionnelles (optionnel)"}),i.jsx(id,{id:"payment-notes",placeholder:"Informations complémentaires pour le vendeur...",value:B.notes,onChange:re=>V(ve=>({...ve,notes:re.target.value})),rows:3,className:"mt-1"})]}),i.jsxs(Ys,{className:"border-blue-200 bg-blue-50",children:[i.jsx(Ms,{className:"h-4 w-4 text-blue-600"}),i.jsxs(Js,{className:"text-blue-800",children:[i.jsx("strong",{children:"Sécurité :"})," Un code de sécurité unique sera généré pour cette transaction. Partagez-le uniquement avec le vendeur lors de la finalisation du paiement."]})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx(Ge,{variant:"outline",onClick:()=>w("method"),className:"flex-1",children:"Retour"}),i.jsx(Ge,{onClick:()=>w("confirmation"),className:"flex-1",disabled:E==="cash"&&!B.location,children:"Continuer"})]})]}),a==="confirmation"&&E&&i.jsxs("div",{className:"space-y-6",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Récapitulatif de la demande"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Mode de paiement :"}),i.jsx("p",{className:"font-medium",children:X(E)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Montant :"}),i.jsx("p",{className:"font-medium",children:$(r.price,r.currency||"EUR")})]}),E==="cash"&&B.location&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Lieu de rencontre :"}),i.jsx("p",{className:"font-medium",children:B.location})]}),B.date&&B.time&&i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Date et heure :"}),i.jsxs("p",{className:"font-medium",children:[Pa(B.date,"PPP",{locale:po})," à ",B.time]})]})]})]}),B.notes&&i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground text-sm",children:"Notes :"}),i.jsx("p",{className:"text-sm bg-muted/50 p-2 rounded",children:B.notes})]})]}),i.jsxs(Ys,{children:[i.jsx(yy,{className:"h-4 w-4"}),i.jsx(Js,{children:"En créant cette demande, vous vous engagez à effectuer le paiement selon les modalités convenues. Le vendeur recevra une notification et pourra accepter ou refuser votre demande."})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx(Ge,{variant:"outline",onClick:()=>w("details"),className:"flex-1",children:"Retour"}),i.jsx(Ge,{onClick:K,className:"flex-1",disabled:p,children:p?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Création..."]}):i.jsxs(i.Fragment,{children:[i.jsx(qs,{className:"w-4 h-4 mr-2"}),"Créer la demande"]})})]})]})]})]})})},mIe=({listing:t,className:e})=>{const{currentUser:r,userProfile:n}=$i(),{createConversation:c,setCurrentConversation:d,conversations:p}=iA(),a=Ra(),[w,E]=z.useState(!1),[C,P]=z.useState(!1),[R,B]=z.useState(""),[V,W]=z.useState(""),[K,Z]=z.useState(!1);if((r==null?void 0:r.uid)===t.sellerId)return null;const $=p.find(pe=>pe.listingId===t.id&&pe.participants.includes((r==null?void 0:r.uid)||"")&&pe.participants.includes(t.sellerId)),X=()=>{if(!r){a("/auth");return}if($){d($),a("/messages");return}const pe=`Bonjour ${t.sellerName},

Je suis intéressé(e) par votre annonce "${t.title}".

Pourriez-vous me donner plus d'informations ? Je suis disponible pour un rendez-vous si nécessaire.

Cordialement,
${(n==null?void 0:n.displayName)||"Un étudiant intéressé"}`;B(pe),W((n==null?void 0:n.email)||""),E(!0)},Q=()=>{if(!r){a("/auth");return}P(!0)},re=async()=>{var pe;if(!R.trim()||!V.trim()||!r||!n){Nt.error("Veuillez remplir tous les champs");return}Z(!0);try{const ue=await c(t.id,t.title,t.price,(pe=t.images)==null?void 0:pe[0],r.uid,t.sellerId,{displayName:n.displayName,photoURL:n.photoURL,university:n.university,isVerified:n.isVerified,email:n.email},{sellerName:t.sellerName,sellerAvatar:t.sellerAvatar,sellerUniversity:t.sellerUniversity,sellerVerified:t.sellerVerified,email:t.sellerEmail||null},R.trim());E(!1),Nt.success(i.jsxs("div",{className:"flex items-center justify-between w-full",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:"Message envoyé !"}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:["📧 ",t.sellerName," recevra une notification email"]})]}),i.jsxs(Ge,{size:"sm",variant:"ghost",onClick:()=>{Nt.dismiss(),a("/messages")},className:"ml-2 text-xs",children:["Voir la conversation",i.jsx(fg,{className:"w-3 h-3 ml-1"})]})]}),{duration:6e3,style:{minWidth:"350px"}}),setTimeout(()=>{a("/messages")},2e3)}catch(ue){console.error("Erreur lors de l'envoi du message:",ue),Nt.error("Erreur lors de l'envoi du message")}finally{Z(!1)}},ve=(pe,ue)=>{if(t.transactionType==="donation")return"Gratuit";if(t.transactionType==="exchange")return"Échange";const ge=ue||"EUR";try{return new Intl.NumberFormat("fr-FR",{style:"currency",currency:ge}).format(pe)}catch{return`${pe} €`}};return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Ge,{onClick:X,className:`flex-1 bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 ${e}`,children:[i.jsx(xa,{className:"w-4 h-4 mr-2"}),$?"Continuer la conversation":"Contacter le vendeur"]}),t.transactionType==="sale"&&t.price>0&&i.jsxs(Ge,{onClick:Q,variant:"outline",className:"flex items-center gap-2",children:[i.jsx(Aa,{className:"w-4 h-4"}),"Payer"]})]}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsxs(Ki,{className:"max-w-md",children:[i.jsx(oa,{children:i.jsxs(ra,{className:"flex items-center gap-2",children:[i.jsx(xa,{className:"w-5 h-5"}),"Contacter le vendeur"]})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsxs(Jc,{className:"w-8 h-8",children:[i.jsx(cf,{src:t.sellerAvatar||void 0}),i.jsx(Sc,{children:t.sellerName[0]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-sm",children:t.sellerName}),i.jsx("p",{className:"text-xs text-muted-foreground",children:t.sellerUniversity})]})]}),i.jsx("p",{className:"text-sm font-medium",children:t.title}),i.jsx("p",{className:"text-sm text-primary font-semibold",children:ve(t.price,t.currency)})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"contact-email",children:"Votre email"}),i.jsx(Gr,{id:"contact-email",type:"email",value:V,onChange:pe=>W(pe.target.value),placeholder:"votre.email@universite.fr",className:"mt-1"})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"contact-message",children:"Votre message"}),i.jsx(id,{id:"contact-message",value:R,onChange:pe=>B(pe.target.value),placeholder:"Décrivez votre intérêt pour cette annonce...",rows:6,className:"mt-1"})]}),i.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(yy,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"text-sm text-blue-800",children:[i.jsx("p",{className:"font-medium mb-1",children:"📧 Notification automatique"}),i.jsxs("p",{children:["Votre message sera envoyé via la messagerie StudyMarket ET ",t.sellerName," recevra une notification email pour répondre rapidement."]})]})]})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Ge,{variant:"outline",onClick:()=>E(!1),className:"flex-1",children:"Annuler"}),i.jsx(Ge,{onClick:re,disabled:K||!R.trim()||!V.trim(),className:"flex-1",children:K?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Envoi..."]}):i.jsxs(i.Fragment,{children:[i.jsx(vy,{className:"w-4 h-4 mr-2"}),"Envoyer + Notifier"]})})]})]})]})}),i.jsx(pIe,{open:C,onOpenChange:P,listing:t})]})};var NJ={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(Ya,function(){var r,n,c;function d(a,w){if(!r)r=w;else if(!n)n=w;else{var E="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",C={};r(C),c=w(C),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([E],{type:"text/javascript"})))}}d(["exports"],function(a){var w=1e-6,E=typeof Float32Array<"u"?Float32Array:Array;function C(u,s){var l=s[0],f=s[1],m=s[2],y=s[3],x=l*y-m*f;return x?(u[0]=y*(x=1/x),u[1]=-f*x,u[2]=-m*x,u[3]=l*x,u):null}function P(){var u=new E(9);return E!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function R(u,s){var l=s[0],f=s[1],m=s[2],y=s[3],x=s[4],b=s[5],j=s[6],N=s[7],k=s[8];return u[0]=x*k-b*N,u[1]=m*N-f*k,u[2]=f*b-m*x,u[3]=b*j-y*k,u[4]=l*k-m*j,u[5]=m*y-l*b,u[6]=y*N-x*j,u[7]=f*j-l*N,u[8]=l*x-f*y,u}function B(u,s,l){var f=s[0],m=s[1],y=s[2],x=s[3],b=s[4],j=s[5],N=s[6],k=s[7],M=s[8],D=l[0],q=l[1],G=l[2],ee=l[3],ne=l[4],ie=l[5],me=l[6],ye=l[7],be=l[8];return u[0]=D*f+q*x+G*N,u[1]=D*m+q*b+G*k,u[2]=D*y+q*j+G*M,u[3]=ee*f+ne*x+ie*N,u[4]=ee*m+ne*b+ie*k,u[5]=ee*y+ne*j+ie*M,u[6]=me*f+ye*x+be*N,u[7]=me*m+ye*b+be*k,u[8]=me*y+ye*j+be*M,u}function V(){var u=new E(16);return E!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function W(u){var s=new E(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s}function K(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Z(u,s){var l=s[0],f=s[1],m=s[2],y=s[3],x=s[4],b=s[5],j=s[6],N=s[7],k=s[8],M=s[9],D=s[10],q=s[11],G=s[12],ee=s[13],ne=s[14],ie=s[15],me=l*b-f*x,ye=l*j-m*x,be=l*N-y*x,Me=f*j-m*b,Ce=f*N-y*b,Le=m*N-y*j,Ve=k*ee-M*G,He=k*ne-D*G,mt=k*ie-q*G,rt=M*ne-D*ee,gt=M*ie-q*ee,bt=D*ie-q*ne,Ct=me*bt-ye*gt+be*rt+Me*mt-Ce*He+Le*Ve;return Ct?(u[0]=(b*bt-j*gt+N*rt)*(Ct=1/Ct),u[1]=(m*gt-f*bt-y*rt)*Ct,u[2]=(ee*Le-ne*Ce+ie*Me)*Ct,u[3]=(D*Ce-M*Le-q*Me)*Ct,u[4]=(j*mt-x*bt-N*He)*Ct,u[5]=(l*bt-m*mt+y*He)*Ct,u[6]=(ne*be-G*Le-ie*ye)*Ct,u[7]=(k*Le-D*be+q*ye)*Ct,u[8]=(x*gt-b*mt+N*Ve)*Ct,u[9]=(f*mt-l*gt-y*Ve)*Ct,u[10]=(G*Ce-ee*be+ie*me)*Ct,u[11]=(M*be-k*Ce-q*me)*Ct,u[12]=(b*He-x*rt-j*Ve)*Ct,u[13]=(l*rt-f*He+m*Ve)*Ct,u[14]=(ee*ye-G*Me-ne*me)*Ct,u[15]=(k*Me-M*ye+D*me)*Ct,u):null}function $(u,s,l){var f=s[0],m=s[1],y=s[2],x=s[3],b=s[4],j=s[5],N=s[6],k=s[7],M=s[8],D=s[9],q=s[10],G=s[11],ee=s[12],ne=s[13],ie=s[14],me=s[15],ye=l[0],be=l[1],Me=l[2],Ce=l[3];return u[0]=ye*f+be*b+Me*M+Ce*ee,u[1]=ye*m+be*j+Me*D+Ce*ne,u[2]=ye*y+be*N+Me*q+Ce*ie,u[3]=ye*x+be*k+Me*G+Ce*me,u[4]=(ye=l[4])*f+(be=l[5])*b+(Me=l[6])*M+(Ce=l[7])*ee,u[5]=ye*m+be*j+Me*D+Ce*ne,u[6]=ye*y+be*N+Me*q+Ce*ie,u[7]=ye*x+be*k+Me*G+Ce*me,u[8]=(ye=l[8])*f+(be=l[9])*b+(Me=l[10])*M+(Ce=l[11])*ee,u[9]=ye*m+be*j+Me*D+Ce*ne,u[10]=ye*y+be*N+Me*q+Ce*ie,u[11]=ye*x+be*k+Me*G+Ce*me,u[12]=(ye=l[12])*f+(be=l[13])*b+(Me=l[14])*M+(Ce=l[15])*ee,u[13]=ye*m+be*j+Me*D+Ce*ne,u[14]=ye*y+be*N+Me*q+Ce*ie,u[15]=ye*x+be*k+Me*G+Ce*me,u}function X(u,s,l){var f,m,y,x,b,j,N,k,M,D,q,G,ee=l[0],ne=l[1],ie=l[2];return s===u?(u[12]=s[0]*ee+s[4]*ne+s[8]*ie+s[12],u[13]=s[1]*ee+s[5]*ne+s[9]*ie+s[13],u[14]=s[2]*ee+s[6]*ne+s[10]*ie+s[14],u[15]=s[3]*ee+s[7]*ne+s[11]*ie+s[15]):(m=s[1],y=s[2],x=s[3],b=s[4],j=s[5],N=s[6],k=s[7],M=s[8],D=s[9],q=s[10],G=s[11],u[0]=f=s[0],u[1]=m,u[2]=y,u[3]=x,u[4]=b,u[5]=j,u[6]=N,u[7]=k,u[8]=M,u[9]=D,u[10]=q,u[11]=G,u[12]=f*ee+b*ne+M*ie+s[12],u[13]=m*ee+j*ne+D*ie+s[13],u[14]=y*ee+N*ne+q*ie+s[14],u[15]=x*ee+k*ne+G*ie+s[15]),u}function Q(u,s,l){var f=l[0],m=l[1],y=l[2];return u[0]=s[0]*f,u[1]=s[1]*f,u[2]=s[2]*f,u[3]=s[3]*f,u[4]=s[4]*m,u[5]=s[5]*m,u[6]=s[6]*m,u[7]=s[7]*m,u[8]=s[8]*y,u[9]=s[9]*y,u[10]=s[10]*y,u[11]=s[11]*y,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u}function re(u,s,l){var f=Math.sin(l),m=Math.cos(l),y=s[4],x=s[5],b=s[6],j=s[7],N=s[8],k=s[9],M=s[10],D=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=y*m+N*f,u[5]=x*m+k*f,u[6]=b*m+M*f,u[7]=j*m+D*f,u[8]=N*m-y*f,u[9]=k*m-x*f,u[10]=M*m-b*f,u[11]=D*m-j*f,u}function ve(u,s,l){var f=Math.sin(l),m=Math.cos(l),y=s[0],x=s[1],b=s[2],j=s[3],N=s[8],k=s[9],M=s[10],D=s[11];return s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=y*m-N*f,u[1]=x*m-k*f,u[2]=b*m-M*f,u[3]=j*m-D*f,u[8]=y*f+N*m,u[9]=x*f+k*m,u[10]=b*f+M*m,u[11]=j*f+D*m,u}function pe(u,s,l){var f=Math.sin(l),m=Math.cos(l),y=s[0],x=s[1],b=s[2],j=s[3],N=s[4],k=s[5],M=s[6],D=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=y*m+N*f,u[1]=x*m+k*f,u[2]=b*m+M*f,u[3]=j*m+D*f,u[4]=N*m-y*f,u[5]=k*m-x*f,u[6]=M*m-b*f,u[7]=D*m-j*f,u}function ue(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ge(u,s,l){var f,m,y,x=l[0],b=l[1],j=l[2],N=Math.sqrt(x*x+b*b+j*j);return N<w?null:(x*=N=1/N,b*=N,j*=N,f=Math.sin(s),m=Math.cos(s),u[0]=x*x*(y=1-m)+m,u[1]=b*x*y+j*f,u[2]=j*x*y-b*f,u[3]=0,u[4]=x*b*y-j*f,u[5]=b*b*y+m,u[6]=j*b*y+x*f,u[7]=0,u[8]=x*j*y+b*f,u[9]=b*j*y-x*f,u[10]=j*j*y+m,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function ce(u,s){var l=s[0],f=s[1],m=s[2],y=s[4],x=s[5],b=s[6],j=s[8],N=s[9],k=s[10];return u[0]=Math.sqrt(l*l+f*f+m*m),u[1]=Math.sqrt(y*y+x*x+b*b),u[2]=Math.sqrt(j*j+N*N+k*k),u}function Se(u,s){var l=s[0],f=s[1],m=s[2],y=s[3],x=l+l,b=f+f,j=m+m,N=l*x,k=f*x,M=f*b,D=m*x,q=m*b,G=m*j,ee=y*x,ne=y*b,ie=y*j;return u[0]=1-M-G,u[1]=k+ie,u[2]=D-ne,u[3]=0,u[4]=k-ie,u[5]=1-N-G,u[6]=q+ee,u[7]=0,u[8]=D+ne,u[9]=q-ee,u[10]=1-N-M,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}var le=$;function J(){var u=new E(3);return E!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function ke(u){var s=new E(3);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s}function Ze(u){var s=u[0],l=u[1],f=u[2];return Math.sqrt(s*s+l*l+f*f)}function Xe(u,s,l){var f=new E(3);return f[0]=u,f[1]=s,f[2]=l,f}function qe(u,s,l,f){return u[0]=s,u[1]=l,u[2]=f,u}function $e(u,s,l){return u[0]=s[0]+l[0],u[1]=s[1]+l[1],u[2]=s[2]+l[2],u}function st(u,s,l){return u[0]=s[0]-l[0],u[1]=s[1]-l[1],u[2]=s[2]-l[2],u}function it(u,s,l){return u[0]=s[0]*l[0],u[1]=s[1]*l[1],u[2]=s[2]*l[2],u}function Mt(u,s,l){return u[0]=Math.min(s[0],l[0]),u[1]=Math.min(s[1],l[1]),u[2]=Math.min(s[2],l[2]),u}function ar(u,s,l){return u[0]=Math.max(s[0],l[0]),u[1]=Math.max(s[1],l[1]),u[2]=Math.max(s[2],l[2]),u}function St(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u[2]=s[2]*l,u}function Xt(u,s,l,f){return u[0]=s[0]+l[0]*f,u[1]=s[1]+l[1]*f,u[2]=s[2]+l[2]*f,u}function dt(u,s){var l=s[0]-u[0],f=s[1]-u[1],m=s[2]-u[2];return Math.sqrt(l*l+f*f+m*m)}function ft(u,s){var l=s[0]-u[0],f=s[1]-u[1],m=s[2]-u[2];return l*l+f*f+m*m}function Wt(u){var s=u[0],l=u[1],f=u[2];return s*s+l*l+f*f}function Wr(u,s){return u[0]=-s[0],u[1]=-s[1],u[2]=-s[2],u}function jr(u,s){var l=s[0],f=s[1],m=s[2],y=l*l+f*f+m*m;return y>0&&(y=1/Math.sqrt(y)),u[0]=s[0]*y,u[1]=s[1]*y,u[2]=s[2]*y,u}function Br(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]}function on(u,s,l){var f=s[0],m=s[1],y=s[2],x=l[0],b=l[1],j=l[2];return u[0]=m*j-y*b,u[1]=y*x-f*j,u[2]=f*b-m*x,u}function Zn(u,s,l,f){var m=s[0],y=s[1],x=s[2];return u[0]=m+f*(l[0]-m),u[1]=y+f*(l[1]-y),u[2]=x+f*(l[2]-x),u}function ln(u,s,l){var f=s[0],m=s[1],y=s[2],x=l[3]*f+l[7]*m+l[11]*y+l[15];return u[0]=(l[0]*f+l[4]*m+l[8]*y+l[12])/(x=x||1),u[1]=(l[1]*f+l[5]*m+l[9]*y+l[13])/x,u[2]=(l[2]*f+l[6]*m+l[10]*y+l[14])/x,u}function dr(u,s,l){var f=s[0],m=s[1],y=s[2];return u[0]=f*l[0]+m*l[3]+y*l[6],u[1]=f*l[1]+m*l[4]+y*l[7],u[2]=f*l[2]+m*l[5]+y*l[8],u}function Vr(u,s,l){var f=l[0],m=l[1],y=l[2],x=l[3],b=s[0],j=s[1],N=s[2],k=m*N-y*j,M=y*b-f*N,D=f*j-m*b;return u[0]=b+x*(k+=k)+m*(D+=D)-y*(M+=M),u[1]=j+x*M+y*k-f*D,u[2]=N+x*D+f*M-m*k,u}function nn(u){return u[0]=0,u[1]=0,u[2]=0,u}function Ln(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]}var Je=st,xt=it,Ft=Ze;function or(){var u=new E(4);return E!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function xr(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u[2]=s[2]*l,u[3]=s[3]*l,u}function mr(u,s){var l=s[0],f=s[1],m=s[2],y=s[3],x=l*l+f*f+m*m+y*y;return x>0&&(x=1/Math.sqrt(x)),u[0]=l*x,u[1]=f*x,u[2]=m*x,u[3]=y*x,u}function sn(u,s,l){var f=s[0],m=s[1],y=s[2],x=s[3];return u[0]=l[0]*f+l[4]*m+l[8]*y+l[12]*x,u[1]=l[1]*f+l[5]*m+l[9]*y+l[13]*x,u[2]=l[2]*f+l[6]*m+l[10]*y+l[14]*x,u[3]=l[3]*f+l[7]*m+l[11]*y+l[15]*x,u}function Cs(){var u=new E(4);return E!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function ys(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function Es(u,s,l){l*=.5;var f=s[0],m=s[1],y=s[2],x=s[3],b=Math.sin(l),j=Math.cos(l);return u[0]=f*j+x*b,u[1]=m*j+y*b,u[2]=y*j-m*b,u[3]=x*j-f*b,u}function so(u,s,l){l*=.5;var f=s[0],m=s[1],y=s[2],x=s[3],b=Math.sin(l),j=Math.cos(l);return u[0]=f*j-y*b,u[1]=m*j+x*b,u[2]=y*j+f*b,u[3]=x*j-m*b,u}J(),or();var io,Cl,Qo,Al=mr,kc=(io=J(),Cl=Xe(1,0,0),Qo=Xe(0,1,0),function(u,s,l){var f=Br(s,l);return f<-.999999?(on(io,Cl,s),Ft(io)<1e-6&&on(io,Qo,s),jr(io,io),function(m,y,x){x*=.5;var b=Math.sin(x);m[0]=b*y[0],m[1]=b*y[1],m[2]=b*y[2],m[3]=Math.cos(x)}(u,io,Math.PI),u):f>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(on(io,s,l),u[0]=io[0],u[1]=io[1],u[2]=io[2],u[3]=1+f,Al(u,u))});function zi(){var u=new E(2);return E!=Float32Array&&(u[0]=0,u[1]=0),u}function Pl(u,s){var l=new E(2);return l[0]=u,l[1]=s,l}function hh(u,s,l){return u[0]=s,u[1]=l,u}function lu(u,s,l){return u[0]=s[0]+l[0],u[1]=s[1]+l[1],u}function fl(u,s,l){return u[0]=s[0]-l[0],u[1]=s[1]-l[1],u}function pl(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u}function oi(u){var s=u[0],l=u[1];return Math.sqrt(s*s+l*l)}function pa(u,s){var l=s[0],f=s[1],m=l*l+f*f;return m>0&&(m=1/Math.sqrt(m)),u[0]=s[0]*m,u[1]=s[1]*m,u}function cu(u,s){return u[0]*s[0]+u[1]*s[1]}Cs(),Cs(),P();var Rc,Fa,_f=fl;function Bu(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}zi();var Rp=function(){if(Fa)return Rc;function u(s,l,f,m){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=f,this.p2y=m}return Fa=1,Rc=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var f=s,m=0;m<8;m++){var y=this.sampleCurveX(f)-s;if(Math.abs(y)<l)return f;var x=this.sampleCurveDerivativeX(f);if(Math.abs(x)<1e-6)break;f-=y/x}var b=0,j=1;for(f=s,m=0;m<20&&(y=this.sampleCurveX(f),!(Math.abs(y-s)<l));m++)s>y?b=f:j=f,f=.5*(j-b)+b;return f},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},Rc}(),Mc=Bu(Rp);function Rt(u,s){this.x=u,this.y=s}function ua(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let l=0;l<u.length;l++)if(!ua(u[l],s[l]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const l in u)if(!ua(u[l],s[l]))return!1;return!0}return u===s}Rt.prototype={clone(){return new Rt(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,s){return this.clone()._rotateAround(u,s)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const s=u.x-this.x,l=u.y-this.y;return s*s+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,s){return Math.atan2(this.x*s-this.y*u,this.x*u+this.y*s)},_matMult(u){const s=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=s,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const s=Math.cos(u),l=Math.sin(u),f=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=f,this},_rotateAround(u,s){const l=Math.cos(u),f=Math.sin(u),m=s.y+f*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-f*(this.y-s.y),this.y=m,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Rt},Rt.convert=function(u){if(u instanceof Rt)return u;if(Array.isArray(u))return new Rt(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new Rt(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};const fh=Math.PI/180,uu=180/Math.PI;function Nn(u){return u*fh}function _o(u){return u*uu}const Fg=[[0,0],[1,0],[1,1],[0,1]];function Dc(u){if(u<=0)return 0;if(u>=1)return 1;const s=u*u,l=s*u;return 4*(u<.5?l:3*(u-s)+l-.75)}function Qe(u,s,l,f){const m=new Mc(u,s,l,f);return function(y){return m.solve(y)}}const oe=Qe(.25,.1,.25,1);function he(u,s,l){return Math.min(l,Math.max(s,u))}function Ne(u,s,l){return(l=he((l-u)/(s-u),0,1))*l*(3-2*l)}function ze(u,s,l){const f=l-s,m=((u-s)%f+f)%f+s;return m===s?l:m}function Fe(u,s,l){if(!u.length)return l(null,[]);let f=u.length;const m=new Array(u.length);let y=null;u.forEach((x,b)=>{s(x,(j,N)=>{j&&(y=j),m[b]=N,--f==0&&l(y,m)})})}let We=1;function ct(){return We++}function Ye(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log2(u)))}function at(u,s){u.forEach(l=>{s[l]&&(s[l]=s[l].bind(s))})}function zt(u,s,l){const f={};for(const m in u)f[m]=s.call(this,u[m],m,u);return f}function At(u,s,l){const f={};for(const m in u)s.call(this,u[m],m,u)&&(f[m]=u[m]);return f}function br(u){return Array.isArray(u)?u.map(br):typeof u=="object"&&u?zt(u,br):u}function Kr(u,s){for(let l=0;l<u.length;l++)if(s.indexOf(u[l])>=0)return!0;return!1}const Fr={};function Ar(u){Fr[u]||(typeof console<"u"&&console.warn(u),Fr[u]=!0)}function mn(u,s,l){return(l.y-u.y)*(s.x-u.x)>(s.y-u.y)*(l.x-u.x)}function yn(u){let s=0;for(let l,f,m=0,y=u.length,x=y-1;m<y;x=m++)l=u[m],f=u[x],s+=(f.x-l.x)*(l.y+f.y);return s}function Kn([u,s,l]){const f=Nn(s+90),m=Nn(l);return{x:u*Math.cos(f)*Math.sin(m),y:u*Math.sin(f)*Math.sin(m),z:u*Math.cos(m),azimuthal:s,polar:l}}function li(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function Xi(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,m,y)=>{const x=m||y;return s[f]=!x||x.toLowerCase(),""}),s["max-age"]){const l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}let Ci=null;function bi(u,s){return[u[4*s],u[4*s+1],u[4*s+2],u[4*s+3]]}function fs(u,s,l,f){for(;s<l;){const m=s+l>>1;u[m]<f?s=m+1:l=m}return s}function Rn(u,s,l,f){for(;s<l;){const m=s+l>>1;u[m]<=f?s=m+1:l=m}return s}function zs(u){return u>0?1/(1.001-u):1+u}function ci(u){return u>0?1-1/(1.001-u):-u}function bs(u,s,l){return(u-s.min)*(l.max-l.min)/(s.max-s.min)+l.min}const Ks={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ks.API_URL)return null;try{const u=new URL(Ks.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function da(u){return Ks.API_URL_REGEX.test(u)}function ao(u){return Ks.API_SPRITE_REGEX.test(u)}let ml,pd,Mi,Ma,za,el;function Uo(){return ml==null&&(ml=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ml}const Bs={now:()=>Ma!==void 0?Ma:performance.now(),setNow(u){Ma=u},restoreNow(){Ma=void 0},frame(u){const s=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(u,s=0){const{width:l,height:f}=u;za||(za=document.createElement("canvas"));const m=za.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(l>za.width||f>za.height)&&(za.width=l,za.height=f),m.clearRect(-s,-s,l+2*s,f+2*s),m.drawImage(u,0,0,l,f),m.getImageData(-s,-s,l+2*s,f+2*s)},resolveURL:u=>(pd||(pd=document.createElement("a")),pd.href=u,pd.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Mi==null&&(Mi=window.matchMedia("(prefers-reduced-motion: reduce)")),Mi.matches)},hasCanvasFingerprintNoise(){if(el!==void 0)return el;if(!Uo())return el=!1,!1;const u=new OffscreenCanvas(85,1),s=u.getContext("2d",{willReadFrequently:!0});let l=0;for(let m=0;m<u.width;++m)s.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,s.fillRect(m,0,1,1);const f=s.getImageData(0,0,u.width,u.height);l=0;for(let m=0;m<f.data.length;++m)if(m%4!=3&&l++!==f.data[m])return el=!0,!0;return el=!1,!1}};function md(u,s){const l=u.indexOf("?");if(l<0)return`${u}?${new URLSearchParams(s).toString()}`;const f=new URLSearchParams(u.slice(l));for(const m in s)f.set(m,s[m]);return`${u.slice(0,l)}?${f.toString()}`}function du(u,s={persistentParams:[]}){const l=u.indexOf("?");if(l<0)return u;const f=new URLSearchParams,m=new URLSearchParams(u.slice(l));for(const x of s.persistentParams){const b=m.get(x);b&&f.set(x,b)}const y=f.toString();return`${u.slice(0,l)}${y.length>0?`?${y}`:""}`}const hu="mapbox-tiles";let yf=500,Eo=50;const Jl=["language","worldview","jobid"];let To,gl;function fu(){try{return caches}catch{}}function Ql(){const u=fu();u&&To==null&&(To=u.open(hu))}let ec=1/0;const xf={supported:!1,testSupport:function(u){!Vu&&pu&&(Uy?zg(u):tc=u)}};let tc,pu,Vu=!1,Uy=!1;const kl=typeof self<"u"?self:{};function zg(u){const s=u.createTexture();u.bindTexture(u.TEXTURE_2D,s);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,pu),u.isContextLost())return;xf.supported=!0}catch{}u.deleteTexture(s),Vu=!0}kl.document&&(pu=kl.document.createElement("img"),pu.onload=function(){tc&&zg(tc),tc=null,Uy=!0},pu.onerror=function(){Vu=!0,tc=null},pu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const tl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(tl);class gd extends Error{constructor(s,l,f){l===401&&da(f)&&(s+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(s),this.status=l,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Bg=li()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Uu=function(u,s){if(!(/^file:/.test(l=u.url)||/^file:/.test(Bg())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(f,m){const y=new AbortController,x=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Bg(),referrerPolicy:f.referrerPolicy,signal:y.signal});let b=!1,j=!1;const N=(k=x.url).indexOf("sku=")>0&&da(k);var k;f.type==="json"&&x.headers.set("Accept","application/json");const M=(q,G,ee)=>{if(j)return;if(q&&q.message!=="SecurityError"&&Ar(q.toString()),G&&ee)return D(G);const ne=Date.now();fetch(x).then(ie=>{if(ie.ok){const me=N?ie.clone():null;return D(ie,me,ne)}return m(new gd(ie.statusText,ie.status,f.url))}).catch(ie=>{ie.name!=="AbortError"&&m(new Error(`${ie.message} ${f.url}`))})},D=(q,G,ee)=>{(f.type==="arrayBuffer"?q.arrayBuffer():f.type==="json"?q.json():q.text()).then(ne=>{j||(G&&ee&&function(ie,me,ye){if(Ql(),To==null)return;const be=Xi(me.headers.get("Cache-Control")||"");if(be["no-store"])return;const Me={status:me.status,statusText:me.statusText,headers:new Headers};me.headers.forEach((Ve,He)=>Me.headers.set(He,Ve)),be["max-age"]&&Me.headers.set("Expires",new Date(ye+1e3*be["max-age"]).toUTCString());const Ce=Me.headers.get("Expires");if(!Ce||new Date(Ce).getTime()-ye<42e4)return;let Le=du(ie.url,{persistentParams:Jl});if(me.status===206){const Ve=ie.headers.get("Range");if(!Ve)return;Me.status=200,Le=md(Le,{range:Ve})}(function(Ve,He){if(gl===void 0)try{new Response(new ReadableStream),gl=!0}catch{gl=!1}gl?He(Ve.body):Ve.blob().then(He).catch(mt=>Ar(mt.message))})(me,Ve=>{const He=new Response((mt=me.status)!==200&&mt!==404&&[101,103,204,205,304].includes(mt)?null:Ve,Me);var mt;Ql(),To!=null&&To.then(rt=>rt.put(Le,He)).catch(rt=>Ar(rt.message))})}(x,G,ee),b=!0,m(null,ne,q.headers))}).catch(ne=>{j||m(new Error(ne.message))})};return N?function(q,G){if(Ql(),To==null)return G(null);To.then(ee=>{let ne=du(q.url,{persistentParams:Jl});const ie=q.headers.get("Range");ie&&(ne=md(ne,{range:ie})),ee.match(ne).then(me=>{const ye=function(be){if(!be)return!1;const Me=new Date(be.headers.get("Expires")||0),Ce=Xi(be.headers.get("Cache-Control")||"");return Number(Me)>Date.now()&&!Ce["no-cache"]}(me);ee.delete(ne).catch(G),ye&&ee.put(ne,me.clone()).catch(G),G(null,me,ye)}).catch(G)}).catch(G)}(x,M):M(null,null),{cancel:()=>{j=!0,b||y.abort()}}}(u,s);if(li(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,s,void 0,!0)}var l;return function(f,m){const y=new XMLHttpRequest;y.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const x in f.headers)y.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=f.credentials==="include",y.onerror=()=>{m(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let x=y.response;if(f.type==="json")try{x=JSON.parse(y.response)}catch(j){return m(j)}const b=new Headers;y.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(j=>{const N=j.split(": "),k=N.shift(),M=N.join(": ");b.append(k,M)}),m(null,x,b)}else m(new gd(y.statusText,y.status,f.url))},y.send(f.body),{cancel:()=>y.abort()}}(u,s)},mu=function(u,s){return Uu(Object.assign(u,{type:"arrayBuffer"}),s)};function Xn(u){const s=document.createElement("a");return s.href=u,s.protocol===location.protocol&&s.host===location.host}const _d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let gu,ph;gu=[],ph=0;const vf=function(u,s){if(xf.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),ph>=Ks.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:u,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return gu.push(y),y}ph++;let l=!1;const f=()=>{if(!l)for(l=!0,ph--;gu.length&&ph<Ks.MAX_PARALLEL_IMAGE_REQUESTS;){const y=gu.shift(),{requestParameters:x,callback:b,cancelled:j}=y;j||(y.cancel=vf(x,b).cancel)}},m=mu(u,(y,x,b)=>{f(),y?s(y):x&&(self.createImageBitmap?function(j,N){const k=new Blob([new Uint8Array(j)],{type:"image/png"});createImageBitmap(k).then(M=>{N(null,M)}).catch(M=>{N(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(j,N)=>s(j,N,b)):function(j,N){const k=new Image;k.onload=()=>{N(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame(()=>{k.src=_d})},k.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(j)],{type:"image/png"});k.src=j.byteLength?URL.createObjectURL(M):_d}(x,(j,N)=>s(j,N,b)))});return{cancel:()=>{m.cancel(),f()}}};var qi,wf,bf,$u={exports:{}},Vg={exports:{}},Sf={exports:{}},Mp=function(){if(bf)return $u.exports;bf=1;var u=(qi||(qi=1,Vg.exports=function(l,f){var m,y,x,b,j,N,k,M;for(y=l.length-(m=3&l.length),x=f,j=3432918353,N=461845907,M=0;M<y;)k=255&l.charCodeAt(M)|(255&l.charCodeAt(++M))<<8|(255&l.charCodeAt(++M))<<16|(255&l.charCodeAt(++M))<<24,++M,x=27492+(65535&(b=5*(65535&(x=(x^=k=(65535&(k=(k=(65535&k)*j+(((k>>>16)*j&65535)<<16)&4294967295)<<15|k>>>17))*N+(((k>>>16)*N&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(k=0,m){case 3:k^=(255&l.charCodeAt(M+2))<<16;case 2:k^=(255&l.charCodeAt(M+1))<<8;case 1:x^=k=(65535&(k=(k=(65535&(k^=255&l.charCodeAt(M)))*j+(((k>>>16)*j&65535)<<16)&4294967295)<<15|k>>>17))*N+(((k>>>16)*N&65535)<<16)&4294967295}return x^=l.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),Vg.exports),s=(wf||(wf=1,Sf.exports=function(l,f){for(var m,y=l.length,x=f^y,b=0;y>=4;)m=1540483477*(65535&(m=255&l.charCodeAt(b)|(255&l.charCodeAt(++b))<<8|(255&l.charCodeAt(++b))<<16|(255&l.charCodeAt(++b))<<24))+((1540483477*(m>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),y-=4,++b;switch(y){case 3:x^=(255&l.charCodeAt(b+2))<<16;case 2:x^=(255&l.charCodeAt(b+1))<<8;case 1:x=1540483477*(65535&(x^=255&l.charCodeAt(b)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),Sf.exports);return $u.exports=u,$u.exports.murmur3=u,$u.exports.murmur2=s,$u.exports}(),mh=Bu(Mp);class Sa{constructor(s,...l){Object.assign(this,l[0]||{}),this.type=s}}class gh extends Sa{constructor(s,l={}){super("error",Object.assign({error:s},l))}}function _h(u,s,l){l[u]&&l[u].indexOf(s)!==-1||(l[u]=l[u]||[],l[u].push(s))}function _u(u,s,l){if(l&&l[u]){const f=l[u].indexOf(s);f!==-1&&l[u].splice(f,1)}}class Oc{on(s,l){return this._listeners=this._listeners||{},_h(s,l,this._listeners),this}off(s,l){return _u(s,l,this._listeners),_u(s,l,this._oneTimeListeners),this}once(s,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},_h(s,l,this._oneTimeListeners),this):new Promise(f=>{this.once(s,f)})}fire(s,l){const f=typeof s=="string"?new Sa(s,l):s,m=f.type;if(this.listens(m)){f.target=this;const y=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const j of y)j.call(this,f);const x=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const j of x)_u(m,j,this._oneTimeListeners),j.call(this,f);const b=this._eventedParent;if(b){const j=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(f,j),b.fire(f)}}else f instanceof gh&&console.error(f.error);return this}listens(s){return!!(this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s))}setEventedParent(s,l){return this._eventedParent=s,this._eventedParentData=l,this}}class Yi{constructor(s){typeof s=="string"?this.name=s:(this.name=s.name,this.iconsetId=s.iconsetId)}static from(s){return new Yi(s)}static toString(s){return s.iconsetId?`${s.name}${s.iconsetId}`:s.name}static parse(s){const[l,f]=s.split("");return new Yi({name:l,iconsetId:f})}static isEqual(s,l){return s.name===l.name&&s.iconsetId===l.iconsetId}toString(){return Yi.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var yh,Dp={},xh=function(){if(yh)return Dp;yh=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(y){return(y=Math.round(y))<0?0:y>255?255:y}function l(y){return s(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function f(y){return(x=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:x>1?1:x;var x}function m(y,x,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?y+(x-y)*b*6:2*b<1?x:3*b<2?y+(x-y)*(2/3-b)*6:y}try{Dp.parseCSSColor=function(y){var x,b=y.replace(/ /g,"").toLowerCase();if(b in u)return u[b].slice();if(b[0]==="#")return b.length===4?(x=parseInt(b.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:b.length===7&&(x=parseInt(b.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var j=b.indexOf("("),N=b.indexOf(")");if(j!==-1&&N+1===b.length){var k=b.substr(0,j),M=b.substr(j+1,N-(j+1)).split(","),D=1;switch(k){case"rgba":if(M.length!==4)return null;D=f(M.pop());case"rgb":return M.length!==3?null:[l(M[0]),l(M[1]),l(M[2]),D];case"hsla":if(M.length!==4)return null;D=f(M.pop());case"hsl":if(M.length!==3)return null;var q=(parseFloat(M[0])%360+360)%360/360,G=f(M[1]),ee=f(M[2]),ne=ee<=.5?ee*(G+1):ee+G-ee*G,ie=2*ee-ne;return[s(255*m(ie,ne,q+1/3)),s(255*m(ie,ne,q)),s(255*m(ie,ne,q-1/3)),D];default:return null}}return null}}catch{}return Dp}();class os{constructor(s,l,f,m=1){this.r=s,this.g=l,this.b=f,this.a=m}static parse(s){if(!s)return;if(s instanceof os)return s;if(typeof s!="string")return;const l=xh.parseCSSColor(s);return l?new os(l[0]/255,l[1]/255,l[2]/255,l[3]):void 0}toString(){const[s,l,f,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*s)},${Math.round(255*l)},${Math.round(255*f)},${m})`}toNonPremultipliedRenderColor(s){const{r:l,g:f,b:m,a:y}=this;return new vh(s,l,f,m,y)}toPremultipliedRenderColor(s){const{r:l,g:f,b:m,a:y}=this;return new Ug(s,l*y,f*y,m*y,y)}clone(){return new os(this.r,this.g,this.b,this.a)}}class Op{constructor(s,l,f,m,y,x=!1){if(this.premultiplied=!1,this.premultiplied=x,s){const b=s.image.height,j=b*b;this.premultiplied?(l=y===0?0:l/y*(b-1),f=y===0?0:f/y*(b-1),m=y===0?0:m/y*(b-1)):(l*=b-1,f*=b-1,m*=b-1);const N=Math.floor(l),k=Math.floor(f),M=Math.floor(m),D=Math.ceil(l),q=Math.ceil(f),G=Math.ceil(m),ee=l-N,ne=f-k,ie=m-M,me=s.image.data,ye=4*(N+k*j+M*b),be=4*(N+k*j+G*b),Me=4*(N+q*j+M*b),Ce=4*(N+q*j+G*b),Le=4*(D+k*j+M*b),Ve=4*(D+k*j+G*b),He=4*(D+q*j+M*b),mt=4*(D+q*j+G*b);if(ye<0||mt>=me.length)throw new Error("out of range");this.r=Ur(Ur(Ur(me[ye],me[be],ie),Ur(me[Me],me[Ce],ie),ne),Ur(Ur(me[Le],me[Ve],ie),Ur(me[He],me[mt],ie),ne),ee)/255*(this.premultiplied?y:1),this.g=Ur(Ur(Ur(me[ye+1],me[be+1],ie),Ur(me[Me+1],me[Ce+1],ie),ne),Ur(Ur(me[Le+1],me[Ve+1],ie),Ur(me[He+1],me[mt+1],ie),ne),ee)/255*(this.premultiplied?y:1),this.b=Ur(Ur(Ur(me[ye+2],me[be+2],ie),Ur(me[Me+2],me[Ce+2],ie),ne),Ur(Ur(me[Le+2],me[Ve+2],ie),Ur(me[He+2],me[mt+2],ie),ne),ee)/255*(this.premultiplied?y:1),this.a=y}else this.r=l,this.g=f,this.b=m,this.a=y}toArray(){const{r:s,g:l,b:f,a:m}=this;return[255*s,255*l,255*f,m]}toHslaArray(){let{r:s,g:l,b:f,a:m}=this;if(this.premultiplied){if(m===0)return[0,0,0,0];const G=1/m;s*=G,l*=G,f*=G}const y=Math.min(Math.max(s,0),1),x=Math.min(Math.max(l,0),1),b=Math.min(Math.max(f,0),1),j=Math.min(y,x,b),N=Math.max(y,x,b),k=N-j,M=.5*(j+N);if(k===0)return[0,0,100*M,m];const D=M>.5?k/(2-N-j):k/(N+j);let q;switch(N){case y:q=60*((x-b)/k+(x<b?6:0));break;case x:q=60*((b-y)/k+2);break;default:q=60*((y-x)/k+4)}return[q,100*D,100*M,m]}toArray01(){const{r:s,g:l,b:f,a:m}=this;return[s,l,f,m]}toArray01Scaled(s){const{r:l,g:f,b:m}=this;return[l*s,f*s,m*s]}toArray01Linear(){const{r:s,g:l,b:f,a:m}=this;return[Math.pow(s,2.2),Math.pow(l,2.2),Math.pow(f,2.2),m]}}class vh extends Op{constructor(s,l,f,m,y){super(s,l,f,m,y,!1)}}class Ug extends Op{constructor(s,l,f,m,y){super(s,l,f,m,y,!0)}}function Ur(u,s,l){return u*(1-l)+s*l}function yd(u,s,l){return u.map((f,m)=>Ur(f,s[m],l))}os.black=new os(0,0,0,1),os.white=new os(1,1,1,1),os.transparent=new os(0,0,0,0),os.red=new os(1,0,0,1),os.blue=new os(0,0,1,1);var rc=Object.freeze({__proto__:null,array:yd,color:function(u,s,l){return new os(Ur(u.r,s.r,l),Ur(u.g,s.g,l),Ur(u.b,s.b,l),Ur(u.a,s.a,l))},number:Ur});class _l extends Error{constructor(s,l){super(l),this.message=l,this.key=s}}class $o{constructor(s,l=[]){this.parent=s,this.bindings={};for(const[f,m]of l)this.bindings[f]=m}concat(s){return new $o(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const xd={kind:"null"},Tr={kind:"number"},Mn={kind:"string"},Yn={kind:"boolean"},qo={kind:"color"},vd={kind:"object"},ls={kind:"value"},qu={kind:"collator"},Ba={kind:"formatted"},wh={kind:"resolvedImage"};function Ea(u,s){return{kind:"array",itemType:u,N:s}}function Ai(u){if(u.kind==="array"){const s=Ai(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const O=[xd,Tr,Mn,Yn,qo,Ba,vd,Ea(ls),wh];function ae(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!ae(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const l of O)if(!ae(l,s))return null}}return`Expected ${Ai(u)} but found ${Ai(s)} instead.`}function we(u,s){return s.some(l=>l.kind===u.kind)}function Be(u,s){return s.some(l=>l==="null"?u===null:l==="array"?Array.isArray(u):l==="object"?u&&!Array.isArray(u)&&typeof u=="object":l===typeof u)}function Lt(u,s){return u.kind==="array"&&s.kind==="array"?u.N===s.N&&Lt(u.itemType,s.itemType):u.kind===s.kind}class Qt{constructor(s,l,f){this.sensitivity=s?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,l){return this.collator.compare(s,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zr{constructor(s,l,f,m,y){this.text=s.normalize?s.normalize():s,this.image=l,this.scale=f,this.fontStack=m,this.textColor=y}}class es{constructor(s){this.sections=s}static fromString(s){return new es([new zr(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||!!s.image&&s.image.hasPrimary())}static factory(s){return s instanceof es?s:es.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}serialize(){const s=["format"];for(const l of this.sections){if(l.image){const m=l.image.getPrimary().id.toString();s.push(["image",m]);continue}s.push(l.text);const f={};l.fontStack&&(f["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(f["font-scale"]=l.scale),l.textColor&&(f["text-color"]=["rgba"].concat(l.textColor.toNonPremultipliedRenderColor(null).toArray())),s.push(f)}return s}}class Ji{constructor(s,l={}){if(this.id=Yi.from(s),this.options=Object.assign({},l),l.transform){const{a:f,b:m,c:y,d:x,e:b,f:j}=l.transform;this.options.transform=new DOMMatrix([f,m,y,x,b,j])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:s,b:l,c:f,d:m,e:y,f:x}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:s,b:l,c:f,d:m,e:y,f:x}})}static parse(s){let l,f,m,y;try{({name:l,iconsetId:f,params:m,transform:y}=JSON.parse(s)||{})}catch{return null}if(!l)return null;const{a:x,b,c:j,d:N,e:k,f:M}=y||{};return new Ji({name:l,iconsetId:f},{params:m,transform:new DOMMatrix([x,b,j,N,k,M])})}scaleSelf(s,l){return this.options.transform.scaleSelf(s,l),this}}class cs{constructor(s,l,f,m,y=!1){this.primaryId=Yi.from(s),this.primaryOptions=l,f&&(this.secondaryId=Yi.from(f)),this.secondaryOptions=m,this.available=y}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ji(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ji(this.secondaryId,this.secondaryOptions):null}static from(s){return typeof s=="string"?cs.build({name:s}):s}static build(s,l,f,m){return!s||typeof s=="object"&&!("name"in s)?null:new cs(s,f,l,m)}}function Va(u,s,l,f){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[u,s,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[u,s,l,f]:[u,s,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ta(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof os||u instanceof Qt||u instanceof es||u instanceof cs)return!0;if(Array.isArray(u)){for(const s of u)if(!Ta(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!Ta(u[s]))return!1;return!0}return!1}function Bi(u){if(u===null)return xd;if(typeof u=="string")return Mn;if(typeof u=="boolean")return Yn;if(typeof u=="number")return Tr;if(u instanceof os)return qo;if(u instanceof Qt)return qu;if(u instanceof es)return Ba;if(u instanceof cs)return wh;if(Array.isArray(u)){const s=u.length;let l;for(const f of u){const m=Bi(f);if(l){if(l===m)continue;l=ls;break}l=m}return Ea(l||ls,s)}return vd}function Da(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof es||u instanceof cs||u instanceof os?u.toString():JSON.stringify(u)}class Rl{constructor(s,l){this.type=s,this.value=l}static parse(s,l){if(s.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Ta(s[1]))return l.error("invalid value");const f=s[1];let m=Bi(f);const y=l.expectedType;return m.kind!=="array"||m.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(m=y),new Rl(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof os?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof es?this.value.serialize():this.value}}class Si{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const vn={string:Mn,number:Tr,boolean:Yn,object:vd};class wr{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let f,m=1;const y=s[0];if(y==="array"){let b,j;if(s.length>2){const N=s[1];if(typeof N!="string"||!(N in vn)||N==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);b=vn[N],m++}else b=ls;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return l.error('The length argument to "array" must be a positive integer literal',2);j=s[2],m++}f=Ea(b,j)}else f=vn[y];const x=[];for(;m<s.length;m++){const b=l.parse(s[m],m,ls);if(!b)return null;x.push(b)}return new wr(f,x)}evaluate(s){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(s);if(!ae(this.type,Bi(f)))return f;if(l===this.args.length-1)throw new Si(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${Ai(Bi(f))} but was expected to be of type ${Ai(this.type)}.`)}return null}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=this.type,l=[s.kind];if(s.kind==="array"){const f=s.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){l.push(f.kind);const m=s.N;(typeof m=="number"||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(f=>f.serialize()))}}class Ef{constructor(s){this.type=Ba,this.sections=s}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");const m=[];let y=!1;for(let x=1;x<=s.length-1;++x){const b=s[x];if(y&&typeof b=="object"&&!Array.isArray(b)){y=!1;let j=null;if(b["font-scale"]&&(j=l.parseObjectValue(b["font-scale"],x,"font-scale",Tr),!j))return null;let N=null;if(b["text-font"]&&(N=l.parseObjectValue(b["text-font"],x,"text-font",Ea(Mn)),!N))return null;let k=null;if(b["text-color"]&&(k=l.parseObjectValue(b["text-color"],x,"text-color",qo),!k))return null;const M=m[m.length-1];M.scale=j,M.font=N,M.textColor=k}else{const j=l.parse(s[x],x,ls);if(!j)return null;const N=j.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,m.push({content:j,scale:null,font:null,textColor:null})}}return new Ef(m)}evaluate(s){return new es(this.sections.map(l=>{const f=l.content.evaluate(s);return Lt(Bi(f),wh)?new zr("",f,null,null,null):new zr(Da(f),null,l.scale?l.scale.evaluate(s):null,l.font?l.font.evaluate(s).join(","):null,l.textColor?l.textColor.evaluate(s):null)}))}eachChild(s){for(const l of this.sections)s(l.content),l.scale&&s(l.scale),l.font&&s(l.font),l.textColor&&s(l.textColor)}outputDefined(){return!1}serialize(){const s=["format"];for(const l of this.sections){s.push(l.content.serialize());const f={};l.scale&&(f["font-scale"]=l.scale.serialize()),l.font&&(f["text-font"]=l.font.serialize()),l.textColor&&(f["text-color"]=l.textColor.serialize()),s.push(f)}return s}}class en{constructor(s,l,f,m){this._imageWarnHistory={},this.type=wh,this.namePrimary=s,this.nameSecondary=l,f&&(this.paramsPrimary=f.params,this.iconsetIdPrimary=f.iconset?f.iconset.id:void 0),m&&(this.paramsSecondary=m.params,this.iconsetIdSecondary=m.iconset?m.iconset.id:void 0)}static parse(s,l){if(s.length<2)return l.error("Expected two or more arguments.");let f=1;const m=[];function y(){if(f<s.length){const b=l.parse(s[f],f++,Mn);return b?(m.push({image:b,options:{}}),!0):(l.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function x(){if(f<s.length){const j=s[f];if((b=j)===null||typeof b!="object"||Array.isArray(b))return!0;const N=j.params,k=j.iconset,M=l.concat(f);if(!N&&!k)return f++,!0;if(N){if(typeof N!="object"||N.constructor!==Object)return M.error('Image options "params" should be an object'),!1;const D={},q=M.concat(void 0,"params");for(const G in N){if(!G)return q.error("Image parameter name should be non-empty"),!1;const ee=q.concat(void 0,G).parse(N[G],void 0,qo,void 0,{typeAnnotation:"coerce"});if(!ee)return!1;D[G]=ee}m[m.length-1].options.params=D}if(k){if(typeof k!="object"||k.constructor!==Object)return M.error('Image options "iconset" should be an object'),!1;if(!k.id)return M.error('Image options "iconset" should have an "id" property'),!1;m[m.length-1].options.iconset=k}return f++,!0}var b;return!0}for(let b=0;b<2;b++)if(!y()||!x())return;return new en(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(s,l){const f={};if(l){for(const m in l)if(l[m])try{f[m]=l[m].evaluate(s)}catch{continue}if(Object.keys(f).length!==0)return{params:f}}}evaluate(s){const l={name:this.namePrimary.evaluate(s),iconsetId:this.iconsetIdPrimary},f=this.nameSecondary?{name:this.nameSecondary.evaluate(s),iconsetId:this.iconsetIdSecondary}:void 0,m=cs.build(l,f,this.paramsPrimary?this.evaluateParams(s,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(s,this.paramsSecondary):void 0);if(m&&s.availableImages){const y=m.getPrimary().id;if(m.available=s.availableImages.some(x=>Yi.isEqual(x,y)),m.available){const x=m.getSecondary()?m.getSecondary().id:null;x&&(m.available=s.availableImages.some(b=>Yi.isEqual(b,x)))}}return m}eachChild(s){if(s(this.namePrimary),this.paramsPrimary)for(const l in this.paramsPrimary)this.paramsPrimary[l]&&s(this.paramsPrimary[l]);if(this.nameSecondary&&(s(this.nameSecondary),this.paramsSecondary))for(const l in this.paramsSecondary)this.paramsSecondary[l]&&s(this.paramsSecondary[l])}outputDefined(){return!1}serializeOptions(s,l){const f={};if(l&&(f.iconset={id:l}),s){f.params={};for(const m in s)s[m]&&(f.params[m]=s[m].serialize())}return Object.keys(f).length>0?f:void 0}serialize(){const s=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const l=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);l&&s.push(l)}if(this.nameSecondary&&(s.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const l=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);l&&s.push(l)}return s}}function Lp(u){return Xr(u)?"string":$g(u)?"number":qy(u)?"boolean":Array.isArray(u)?"array":u===null?"null":$y(u)?"object":typeof u}function $y(u){return u!=null&&!Array.isArray(u)&&typeof u!="function"&&!(u instanceof String||u instanceof Number||u instanceof Boolean)&&typeof u=="object"}function Xr(u){return typeof u=="string"||u instanceof String}function $g(u){return typeof u=="number"||u instanceof Number}function qy(u){return typeof u=="boolean"||u instanceof Boolean}const nT={"to-boolean":Yn,"to-color":qo,"to-number":Tr,"to-string":Mn};class Gu{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const f=s[0],m=[];let y=xd;if(f==="to-array"){if(!Array.isArray(s[1]))return null;const x=s[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);y=Ea(l.expectedType.itemType,x)}else{if(!(x>0&&Ta(s[1][0])))return null;y=Ea(Bi(s[1][0]),x)}for(let b=0;b<x;b++){const j=s[1][b];let N;if(Array.isArray(j))N=l.parse(j,void 0,y.itemType);else{const k=Lp(j);if(k!==y.itemType.kind)return l.error(`Expected ${y.itemType.kind} but found ${k}.`);N=l.registry.literal.parse(["literal",j===void 0?null:j],l)}if(!N)return null;m.push(N)}}else{if((f==="to-boolean"||f==="to-string")&&s.length!==2)return l.error("Expected one argument.");y=nT[f];for(let x=1;x<s.length;x++){const b=l.parse(s[x],x,ls);if(!b)return null;m.push(b)}}return new Gu(y,m)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let l,f;for(const m of this.args){if(l=m.evaluate(s),f=null,l instanceof os)return l;if(typeof l=="string"){const y=s.parseColor(l);if(y)return y}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Va(l[0],l[1],l[2],l[3]),!f))return new os(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Si(f||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const f of this.args){if(l=f.evaluate(s),l===null)return 0;const m=Number(l);if(!isNaN(m))return m}throw new Si(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?es.fromString(Da(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?cs.build(Da(this.args[0].evaluate(s))):this.type.kind==="array"?this.args.map(l=>l.evaluate(s)):Da(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ef([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new en(this.args[0]).serialize();const s=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{s.push(l.serialize())}),s}}const Gy=["Unknown","Point","LineString","Polygon"];class oo{constructor(s,l,f){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=s,this.options=l,this.iconImageUseTheme=f}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(s){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:f,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(f*l-s[0])+this.featureDistanceData.bearing[1]*(m*l-s[1])}return 0}parseColor(s){let l=this._parseColorCache[s];return l||(l=this._parseColorCache[s]=os.parse(s)),l}getConfig(s){return this.options?this.options.get(s):null}}class Go{constructor(s,l,f,m,y){this.name=s,this.type=l,this._evaluate=f,this.args=m,this._overloadIndex=y}evaluate(s){if(!this._evaluate){const l=Go.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(s=>s.serialize()))}static parse(s,l){const f=s[0],m=Go.definitions[f];if(!m)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,b=[];let j=null,N=-1;for(const[k,M]of x){if(Array.isArray(k)&&k.length!==s.length-1)continue;b.push(k),N++,j=new tx(l.registry,l.path,null,l.scope,void 0,l._scope,l.options,l.iconImageUseTheme);const D=[];let q=!1;for(let G=1;G<s.length;G++){const ee=s[G],ne=Array.isArray(k)?k[G-1]:k.type,ie=j.parse(ee,1+D.length,ne);if(!ie){q=!0;break}D.push(ie)}if(!q)if(Array.isArray(k)&&k.length!==D.length)j.error(`Expected ${k.length} arguments, but found ${D.length} instead.`);else{for(let G=0;G<D.length;G++){const ee=Array.isArray(k)?k[G]:k.type,ne=D[G];j.concat(G+1).checkSubtype(ee,ne.type)}if(j.errors.length===0)return new Go(f,y,M,D,N)}}if(b.length===1)l.errors.push(...j.errors);else{const k=(b.length?b:x.map(([D])=>D)).map(Tf).join(" | "),M=[];for(let D=1;D<s.length;D++){const q=l.parse(s[D],1+M.length);if(!q)return null;M.push(Ai(q.type))}l.error(`Expected arguments of type ${k}, but found (${M.join(", ")}) instead.`)}return null}static register(s,l){Go.definitions=l;for(const f in l)s[f]=Go}}function Tf(u){return Array.isArray(u)?`(${u.map(Ai).join(", ")})`:`(${Ai(u.type)}...)`}class Fp{constructor(s,l,f){this.type=qu,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=l}static parse(s,l){if(s.length!==2)return l.error("Expected one argument.");const f=s[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");const m=f["case-sensitive"]===void 0?l.parse(!1,1,Yn):l.parseObjectValue(f["case-sensitive"],1,"case-sensitive",Yn);if(!m)return null;const y=f["diacritic-sensitive"]===void 0?l.parse(!1,1,Yn):l.parseObjectValue(f["diacritic-sensitive"],1,"diacritic-sensitive",Yn);if(!y)return null;let x=null;return f.locale&&(x=l.parseObjectValue(f.locale,1,"locale",Mn),!x)?null:new Fp(m,y,x)}evaluate(s){return new Qt(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}serialize(){const s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]}}function wd(u,s,l=0,f=u.length-1,m=AA){for(;f>l;){if(f-l>600){const j=f-l+1,N=s-l+1,k=Math.log(j),M=.5*Math.exp(2*k/3),D=.5*Math.sqrt(k*M*(j-M)/j)*(N-j/2<0?-1:1);wd(u,s,Math.max(l,Math.floor(s-N*M/j+D)),Math.min(f,Math.floor(s+(j-N)*M/j+D)),m)}const y=u[s];let x=l,b=f;for(lo(u,l,s),m(u[f],y)>0&&lo(u,l,f);x<b;){for(lo(u,x,b),x++,b--;m(u[x],y)<0;)x++;for(;m(u[b],y)>0;)b--}m(u[l],y)===0?lo(u,l,b):(b++,lo(u,b,f)),b<=s&&(l=b+1),s<=b&&(f=b-1)}}function lo(u,s,l){const f=u[s];u[s]=u[l],u[l]=f}function AA(u,s){return u<s?-1:u>s?1:0}function PA(u){let s=0;for(let l,f,m=0,y=u.length,x=y-1;m<y;x=m++)l=u[m],f=u[x],s+=(f.x-l.x)*(l.y+f.y);return s}function qg(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function bh(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function sT(u,s,l){const f=u[0]-s[0],m=u[1]-s[1],y=u[0]-l[0],x=u[1]-l[1];return f*x-y*m==0&&f*y<=0&&m*x<=0}function Lc(u,s,l=!1){let f=!1;for(let b=0,j=s.length;b<j;b++){const N=s[b];for(let k=0,M=N.length,D=M-1;k<M;D=k++){const q=N[D],G=N[k];if(sT(u,q,G))return l;(y=q)[1]>(m=u)[1]!=(x=G)[1]>m[1]&&m[0]<(x[0]-y[0])*(m[1]-y[1])/(x[1]-y[1])+y[0]&&(f=!f)}}var m,y,x;return f}function iT(u,s,l,f){const m=f[0]-l[0],y=f[1]-l[1],x=(u[0]-l[0])*y-m*(u[1]-l[1]),b=(s[0]-l[0])*y-m*(s[1]-l[1]);return x>0&&b<0||x<0&&b>0}function Hy(u,s,l,f){return(m=[f[0]-l[0],f[1]-l[1]])[0]*(y=[s[0]-u[0],s[1]-u[1]])[1]-m[1]*y[0]!=0&&!(!iT(u,s,l,f)||!iT(l,f,u,s));var m,y}function Gg(u){const s=new Rt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new Rt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const f of u[0])s.x>f.x&&(s.x=f.x),s.y>f.y&&(s.y=f.y),l.x<f.x&&(l.x=f.x),l.y<f.y&&(l.y=f.y);return{min:s,max:l}}const Sh=8192;function kA(u,s){const l=(180+u[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,m=Math.pow(2,s.z);return[Math.round(l*m*Sh),Math.round(f*m*Sh)]}function aT(u,s){for(let l=0;l<s.length;l++)if(Lc(u,s[l]))return!0;return!1}function RA(u,s,l){for(const f of l)for(let m=0,y=f.length,x=y-1;m<y;x=m++)if(Hy(u,s,f[x],f[m]))return!0;return!1}function Eh(u,s){for(let l=0;l<u.length;++l)if(!Lc(u[l],s))return!1;for(let l=0;l<u.length-1;++l)if(RA(u[l],u[l+1],s))return!1;return!0}function MA(u,s){for(let l=0;l<s.length;l++)if(Eh(u,s[l]))return!0;return!1}function Sw(u,s,l){const f=[];for(let m=0;m<u.length;m++){const y=[];for(let x=0;x<u[m].length;x++){const b=kA(u[m][x],l);qg(s,b),y.push(b)}f.push(y)}return f}function Wy(u,s,l){const f=[];for(let m=0;m<u.length;m++){const y=Sw(u[m],s,l);f.push(y)}return f}function Ew(u,s,l,f){if(u[0]<l[0]||u[0]>l[2]){const m=.5*f;let y=u[0]-l[0]>m?-f:l[0]-u[0]>m?f:0;y===0&&(y=u[0]-l[2]>m?-f:l[2]-u[0]>m?f:0),u[0]+=y}qg(s,u)}function Tw(u,s,l,f){const m=Math.pow(2,f.z)*Sh,y=[f.x*Sh,f.y*Sh],x=[];if(!u)return x;for(const b of u)for(const j of b){const N=[j.x+y[0],j.y+y[1]];Ew(N,s,l,m),x.push(N)}return x}function Fc(u,s,l,f){const m=Math.pow(2,f.z)*Sh,y=[f.x*Sh,f.y*Sh],x=[];if(!u)return x;for(const j of u){const N=[];for(const k of j){const M=[k.x+y[0],k.y+y[1]];qg(s,M),N.push(M)}x.push(N)}if(s[2]-s[0]<=m/2){(b=s)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const j of x)for(const N of j)Ew(N,s,l,m)}var b;return x}class jf{constructor(s,l){this.type=Yn,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Ta(s[1])){const f=s[1];if(f.type==="FeatureCollection")for(let m=0;m<f.features.length;++m){const y=f.features[m].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new jf(f,f.features[m].geometry)}else if(f.type==="Feature"){const m=f.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new jf(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new jf(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(l,f){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if(f.type==="Polygon"){const b=Sw(f.coordinates,y,x),j=Tw(l.geometry(),m,y,x);if(!bh(m,y))return!1;for(const N of j)if(!Lc(N,b))return!1}if(f.type==="MultiPolygon"){const b=Wy(f.coordinates,y,x),j=Tw(l.geometry(),m,y,x);if(!bh(m,y))return!1;for(const N of j)if(!aT(N,b))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(l,f){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if(f.type==="Polygon"){const b=Sw(f.coordinates,y,x),j=Fc(l.geometry(),m,y,x);if(!bh(m,y))return!1;for(const N of j)if(!Eh(N,b))return!1}if(f.type==="MultiPolygon"){const b=Wy(f.coordinates,y,x),j=Fc(l.geometry(),m,y,x);if(!bh(m,y))return!1;for(const N of j)if(!MA(N,b))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Hg={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},jw=1/298.257223563,Nw=jw*(2-jw),zp=Math.PI/180;class Bp{static fromTile(s,l,f){const m=Math.PI*(1-2*(s+.5)/Math.pow(2,l)),y=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/zp;return new Bp(y,f)}static get units(){return Hg}constructor(s,l){if(s===void 0)throw new Error("No latitude given.");if(l&&!Hg[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(Hg).join(", ")}`);const f=6378.137*zp*(l?Hg[l]:1),m=Math.cos(s*zp),y=1/(1-Nw*(1-m*m)),x=Math.sqrt(y);this.kx=f*x*m,this.ky=f*x*y*(1-Nw)}distance(s,l){const f=nc(s[0]-l[0])*this.kx,m=(s[1]-l[1])*this.ky;return Math.sqrt(f*f+m*m)}bearing(s,l){const f=nc(l[0]-s[0])*this.kx;return Math.atan2(f,(l[1]-s[1])*this.ky)/zp}destination(s,l,f){const m=f*zp;return this.offset(s,Math.sin(m)*l,Math.cos(m)*l)}offset(s,l,f){return[s[0]+l/this.kx,s[1]+f/this.ky]}lineDistance(s){let l=0;for(let f=0;f<s.length-1;f++)l+=this.distance(s[f],s[f+1]);return l}area(s){let l=0;for(let f=0;f<s.length;f++){const m=s[f];for(let y=0,x=m.length,b=x-1;y<x;b=y++)l+=nc(m[y][0]-m[b][0])*(m[y][1]+m[b][1])*(f?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(s,l){let f=0;if(l<=0)return s[0];for(let m=0;m<s.length-1;m++){const y=s[m],x=s[m+1],b=this.distance(y,x);if(f+=b,f>l)return Zy(y,x,(l-(f-b))/b)}return s[s.length-1]}pointToSegmentDistance(s,l,f){let[m,y]=l,x=nc(f[0]-m)*this.kx,b=(f[1]-y)*this.ky;if(x!==0||b!==0){const j=(nc(s[0]-m)*this.kx*x+(s[1]-y)*this.ky*b)/(x*x+b*b);j>1?(m=f[0],y=f[1]):j>0&&(m+=x/this.kx*j,y+=b/this.ky*j)}return x=nc(s[0]-m)*this.kx,b=(s[1]-y)*this.ky,Math.sqrt(x*x+b*b)}pointOnLine(s,l){let f=1/0,m=s[0][0],y=s[0][1],x=0,b=0;for(let j=0;j<s.length-1;j++){let N=s[j][0],k=s[j][1],M=nc(s[j+1][0]-N)*this.kx,D=(s[j+1][1]-k)*this.ky,q=0;M===0&&D===0||(q=(nc(l[0]-N)*this.kx*M+(l[1]-k)*this.ky*D)/(M*M+D*D),q>1?(N=s[j+1][0],k=s[j+1][1]):q>0&&(N+=M/this.kx*q,k+=D/this.ky*q)),M=nc(l[0]-N)*this.kx,D=(l[1]-k)*this.ky;const G=M*M+D*D;G<f&&(f=G,m=N,y=k,x=j,b=q)}return{point:[m,y],index:x,t:Math.max(0,Math.min(1,b))}}lineSlice(s,l,f){let m=this.pointOnLine(f,s),y=this.pointOnLine(f,l);if(m.index>y.index||m.index===y.index&&m.t>y.t){const N=m;m=y,y=N}const x=[m.point],b=m.index+1,j=y.index;!Iw(f[b],x[0])&&b<=j&&x.push(f[b]);for(let N=b+1;N<=j;N++)x.push(f[N]);return Iw(f[j],y.point)||x.push(y.point),x}lineSliceAlong(s,l,f){let m=0;const y=[];for(let x=0;x<f.length-1;x++){const b=f[x],j=f[x+1],N=this.distance(b,j);if(m+=N,m>s&&y.length===0&&y.push(Zy(b,j,(s-(m-N))/N)),m>=l)return y.push(Zy(b,j,(l-(m-N))/N)),y;m>s&&y.push(j)}return y}bufferPoint(s,l){const f=l/this.ky,m=l/this.kx;return[s[0]-m,s[1]-f,s[0]+m,s[1]+f]}bufferBBox(s,l){const f=l/this.ky,m=l/this.kx;return[s[0]-m,s[1]-f,s[2]+m,s[3]+f]}insideBBox(s,l){return nc(s[0]-l[0])>=0&&nc(s[0]-l[2])<=0&&s[1]>=l[1]&&s[1]<=l[3]}}function Iw(u,s){return u[0]===s[0]&&u[1]===s[1]}function Zy(u,s,l){const f=nc(s[0]-u[0]);return[u[0]+f*l,u[1]+(s[1]-u[1])*l]}function nc(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class Ky{constructor(s=[],l=(f,m)=>f<m?-1:f>m?1:0){if(this.data=s,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:l,compare:f}=this,m=l[s];for(;s>0;){const y=s-1>>1,x=l[y];if(f(m,x)>=0)break;l[s]=x,s=y}l[s]=m}_down(s){const{data:l,compare:f}=this,m=this.length>>1,y=l[s];for(;s<m;){let x=1+(s<<1);const b=x+1;if(b<this.length&&f(l[b],l[x])<0&&(x=b),f(l[x],y)>=0)break;l[s]=l[x],s=x}l[s]=y}}var Zt=8192;function Cw(u,s){return s.dist-u.dist}const Vp=100,Up=50;function Wg(u){const s=[1/0,1/0,-1/0,-1/0];if(s.length!==u.length)return!1;for(let l=0;l<s.length;l++)if(s[l]!==u[l])return!1;return!0}function Zg(u){return u[1]-u[0]+1}function Hu(u,s){const l=u[1]>=u[0]&&u[1]<s;return l||console.warn("Distance Expression: Index is out of range"),l}function Xy(u,s){if(u[0]>u[1])return[null,null];const l=Zg(u);if(s){if(l===2)return[u,null];const f=Math.floor(l/2);return[[u[0],u[0]+f],[u[0]+f,u[1]]]}{if(l===1)return[u,null];const f=Math.floor(l/2)-1;return[[u[0],u[0]+f],[u[0]+f+1,u[1]]]}}function zc(u,s){const l=[1/0,1/0,-1/0,-1/0];if(!Hu(s,u.length))return l;for(let f=s[0];f<=s[1];++f)qg(l,u[f]);return l}function Dn(u){const s=[1/0,1/0,-1/0,-1/0];for(let l=0;l<u.length;++l)for(let f=0;f<u[l].length;++f)qg(s,u[l][f]);return s}function $p(u,s,l){if(Wg(u)||Wg(s))return NaN;let f=0,m=0;return u[2]<s[0]&&(f=s[0]-u[2]),u[0]>s[2]&&(f=u[0]-s[2]),u[1]>s[3]&&(m=u[1]-s[3]),u[3]<s[1]&&(m=s[1]-u[3]),l.distance([0,0],[f,m])}function DA(u){return 360*u-180}function OA(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Yy(u,s){const l=Math.pow(2,s.z),f=(u.y/Zt+s.y)/l;return[DA((u.x/Zt+s.x)/l),OA(f)]}function LA(u,s){const l=[];for(let f=0;f<u.length;++f)l.push(Yy(u[f],s));return l}function yi(u,s,l){const f=l.pointOnLine(s,u).point;return l.distance(u,f)}function oT(u,s,l,f,m){const y=l.slice(f[0],f[1]+1);let x=1/0;for(let b=s[0];b<=s[1];++b)if((x=Math.min(x,yi(u[b],y,m)))===0)return 0;return x}function Aw(u,s,l,f,m){const y=Math.min(m.pointToSegmentDistance(u,l,f),m.pointToSegmentDistance(s,l,f)),x=Math.min(m.pointToSegmentDistance(l,u,s),m.pointToSegmentDistance(f,u,s));return Math.min(y,x)}function FA(u,s,l,f,m){if(!Hu(s,u.length)||!Hu(f,l.length))return NaN;let y=1/0;for(let x=s[0];x<s[1];++x)for(let b=f[0];b<f[1];++b){if(Hy(u[x],u[x+1],l[b],l[b+1]))return 0;y=Math.min(y,Aw(u[x],u[x+1],l[b],l[b+1],m))}return y}function zA(u,s,l,f,m){if(!Hu(s,u.length)||!Hu(f,l.length))return NaN;let y=1/0;for(let x=s[0];x<=s[1];++x)for(let b=f[0];b<=f[1];++b)if((y=Math.min(y,m.distance(u[x],l[b])))===0)return y;return y}function BA(u,s,l){if(Lc(u,s,!0))return 0;let f=1/0;for(const m of s){const y=m.length;if(y<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[y-1]&&(f=Math.min(f,l.pointToSegmentDistance(u,m[y-1],m[0])))===0||(f=Math.min(f,yi(u,m,l)))===0)return f}return f}function VA(u,s,l,f){if(!Hu(s,u.length))return NaN;for(let y=s[0];y<=s[1];++y)if(Lc(u[y],l,!0))return 0;let m=1/0;for(let y=s[0];y<s[1];++y)for(const x of l)for(let b=0,j=x.length,N=j-1;b<j;N=b++){if(Hy(u[y],u[y+1],x[N],x[b]))return 0;m=Math.min(m,Aw(u[y],u[y+1],x[N],x[b],f))}return m}function lT(u,s){for(const l of u)for(let f=0;f<=l.length-1;++f)if(Lc(l[f],s,!0))return!0;return!1}function UA(u,s,l,f=1/0){const m=Dn(u),y=Dn(s);if(f!==1/0&&$p(m,y,l)>=f)return f;if(bh(m,y)){if(lT(u,s))return 0}else if(lT(s,u))return 0;let x=f;for(const b of u)for(let j=0,N=b.length,k=N-1;j<N;k=j++)for(const M of s)for(let D=0,q=M.length,G=q-1;D<q;G=D++){if(Hy(b[k],b[j],M[G],M[D]))return 0;x=Math.min(x,Aw(b[k],b[j],M[G],M[D],l))}return x}function Jy(u,s,l,f,m,y,x){if(y===null||x===null)return;const b=$p(zc(f,y),zc(m,x),l);b<s&&u.push({dist:b,range1:y,range2:x})}function $A(u,s,l,f,m=1/0){let y=Math.min(f.distance(u[0],l[0][0]),m);if(y===0)return y;const x=new Ky([{dist:0,range1:[0,u.length-1],range2:[0,0]}],Cw),b=s?Up:Vp,j=Dn(l);for(;x.length;){const N=x.pop();if(N.dist>=y)continue;const k=N.range1;if(Zg(k)<=b){if(!Hu(k,u.length))return NaN;if(s){const M=VA(u,k,l,f);if((y=Math.min(y,M))===0)return y}else for(let M=k[0];M<=k[1];++M){const D=BA(u[M],l,f);if((y=Math.min(y,D))===0)return y}}else{const M=Xy(k,s);if(M[0]!==null){const D=$p(zc(u,M[0]),j,f);D<y&&x.push({dist:D,range1:M[0],range2:[0,0]})}if(M[1]!==null){const D=$p(zc(u,M[1]),j,f);D<y&&x.push({dist:D,range1:M[1],range2:[0,0]})}}}return y}function cT(u,s,l,f,m,y=1/0){let x=Math.min(y,m.distance(u[0],l[0]));if(x===0)return x;const b=new Ky([{dist:0,range1:[0,u.length-1],range2:[0,l.length-1]}],Cw),j=s?Up:Vp,N=f?Up:Vp;for(;b.length;){const k=b.pop();if(k.dist>=x)continue;const M=k.range1,D=k.range2;if(Zg(M)<=j&&Zg(D)<=N){if(!Hu(M,u.length)||!Hu(D,l.length))return NaN;if(s&&f?x=Math.min(x,FA(u,M,l,D,m)):s||f?s&&!f?x=Math.min(x,oT(l,D,u,M,m)):!s&&f&&(x=Math.min(x,oT(u,M,l,D,m))):x=Math.min(x,zA(u,M,l,D,m)),x===0)return x}else{const q=Xy(M,s),G=Xy(D,f);Jy(b,x,m,u,l,q[0],G[0]),Jy(b,x,m,u,l,q[0],G[1]),Jy(b,x,m,u,l,q[1],G[0]),Jy(b,x,m,u,l,q[1],G[1])}}return x}function Pw(u,s,l,f,m=1/0){let y=m;const x=zc(u,[0,u.length-1]);for(const b of l)if(!(y!==1/0&&$p(x,zc(b,[0,b.length-1]),f)>=y)&&(y=Math.min(y,cT(u,s,b,!0,f,y)),y===0))return y;return y}function Qy(u,s,l,f,m=1/0){let y=m;const x=zc(u,[0,u.length-1]);for(const b of l){if(y!==1/0&&$p(x,Dn(b),f)>=y)continue;const j=$A(u,s,b,f,y);if(isNaN(j))return j;if((y=Math.min(y,j))===0)return y}return y}function kw(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class Nf{constructor(s,l){this.type=Tr,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${s.length-1} instead.`);if(Ta(s[1])){const f=s[1];if(f.type==="FeatureCollection"){for(let m=0;m<f.features.length;++m)if(kw(f.features[m].geometry.type))return new Nf(f,f.features[m].geometry)}else if(f.type==="Feature"){if(kw(f.geometry.type))return new Nf(f,f.geometry)}else if(kw(f.type))return new Nf(f,f)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(s){const l=s.geometry(),f=s.canonicalID();if(l!=null&&f!=null){if(s.geometryType()==="Point")return function(m,y,x){const b=[];for(const N of m)for(const k of N)b.push(Yy(k,y));const j=new Bp(b[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?cT(b,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",j):x.type==="MultiLineString"?Pw(b,!1,x.coordinates,j):x.type==="Polygon"||x.type==="MultiPolygon"?Qy(b,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,j):null}(l,f,this.geometries);if(s.geometryType()==="LineString")return function(m,y,x){const b=[];for(const N of m){const k=[];for(const M of N)k.push(Yy(M,y));b.push(k)}const j=new Bp(b[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Pw(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",b,j);if(x.type==="MultiLineString"){let N=1/0;for(let k=0;k<x.coordinates.length;k++){const M=Pw(x.coordinates[k],!0,b,j,N);if(isNaN(M))return M;if((N=Math.min(N,M))===0)return N}return N}if(x.type==="Polygon"||x.type==="MultiPolygon"){let N=1/0;for(let k=0;k<b.length;k++){const M=Qy(b[k],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,j,N);if(isNaN(M))return M;if((N=Math.min(N,M))===0)return N}return N}return null}(l,f,this.geometries);if(s.geometryType()==="Polygon")return function(m,y,x){const b=[];for(const N of function(k,M){const D=k.length;if(D<=1)return[k];const q=[];let G,ee;for(let ne=0;ne<D;ne++){const ie=PA(k[ne]);ie!==0&&(k[ne].area=Math.abs(ie),ee===void 0&&(ee=ie<0),ee===ie<0?(G&&q.push(G),G=[k[ne]]):G.push(k[ne]))}return G&&q.push(G),q}(m)){const k=[];for(let M=0;M<N.length;++M)k.push(LA(N[M],y));b.push(k)}const j=new Bp(b[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Qy(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",b,j);if(x.type==="MultiLineString"){let N=1/0;for(let k=0;k<x.coordinates.length;k++){const M=Qy(x.coordinates[k],!0,b,j,N);if(isNaN(M))return M;if((N=Math.min(N,M))===0)return N}return N}return x.type==="Polygon"||x.type==="MultiPolygon"?function(N,k,M){let D=1/0;for(const q of N)for(const G of k){const ee=UA(q,G,M,D);if(isNaN(ee))return ee;if((D=Math.min(D,ee))===0)return D}return D}(x.type==="Polygon"?[x.coordinates]:x.coordinates,b,j):null}(l,f,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function qp(u){if(u instanceof Go&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof jf||u instanceof Nf)return!1;if(u instanceof Hp)return u.featureConstant;let s=!0;return u.eachChild(l=>{s&&!qp(l)&&(s=!1)}),s}function Kg(u){if(u instanceof Go&&u.name==="feature-state")return!1;let s=!0;return u.eachChild(l=>{s&&!Kg(l)&&(s=!1)}),s}function Gp(u,s){if(u instanceof Go&&s.indexOf(u.name)>=0)return!1;let l=!0;return u.eachChild(f=>{l&&!Gp(f,s)&&(l=!1)}),l}function uT(u,s,l){return[u,s,l].filter(Boolean).join("")}function Rw(u,s){switch(u){case"string":return Da(s);case"number":return+s;case"boolean":return!!s;case"color":return os.parse(s);case"formatted":return es.fromString(Da(s));case"resolvedImage":return cs.build(Da(s))}return s}function dT(u,s,l,f){return f!==void 0&&(u=f*Math.round(u/f)),s!==void 0&&u<s&&(u=s),l!==void 0&&u>l&&(u=l),u}class Hp{constructor(s,l,f,m=!1){this.type=s,this.key=l,this.scope=f,this.featureConstant=m}static parse(s,l){let f=l.expectedType;if(f==null&&(f=ls),s.length<2||s.length>3)return l.error("Invalid number of arguments for 'config' expression.");const m=l.parse(s[1],1);if(!(m instanceof Rl))return l.error("Key name of 'config' expression must be a string literal.");let y,x=!0;const b=Da(m.value);if(s.length>=3){const j=l.parse(s[2],2);if(!(j instanceof Rl))return l.error("Scope of 'config' expression must be a string literal.");y=Da(j.value)}if(l.options){const j=uT(b,y,l._scope),N=l.options.get(j);N&&(x=qp(N.value||N.default))}return new Hp(f,b,y,x)}evaluate(s){const l=uT(this.key,this.scope,s.scope),f=s.getConfig(l);if(!f)return null;const{type:m,value:y,values:x,minValue:b,maxValue:j,stepValue:N}=f,k=f.default.evaluate(s);let M=k;if(y){const D=s.scope;s.scope=(D||"").split("").slice(1).join(""),M=y.evaluate(s),s.scope=D}return m&&(M=Rw(m,M)),M===void 0||b===void 0&&j===void 0&&N===void 0||(typeof M=="number"?M=dT(M,b,j,N):Array.isArray(M)&&(M=M.map(D=>typeof D=="number"?dT(D,b,j,N):D))),y!==void 0&&M!==void 0&&x&&!x.includes(M)&&(M=k,m&&(M=Rw(m,M))),(m&&m!==this.type||M!==void 0&&!Lt(Bi(M),this.type))&&(M=Rw(this.type.kind,M)),M}eachChild(){}outputDefined(){return!1}serialize(){const s=["config",this.key];return this.scope&&s.concat(this.scope),s}}class ex{constructor(s,l){this.type=l.type,this.name=s,this.boundExpression=l}static parse(s,l){if(s.length!==2||typeof s[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const f=s[1];return l.scope.has(f)?new ex(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class tx{constructor(s,l=[],f,m=new $o,y=[],x,b,j){this.registry=s,this.path=l,this.key=l.map(N=>typeof N=="string"?`['${N}']`:`[${N}]`).join(""),this.scope=m,this.errors=y,this.expectedType=f,this._scope=x,this.options=b,this.iconImageUseTheme=j}parse(s,l,f,m,y={}){return l||f?this.concat(l,null,f,m)._parse(s,y):this._parse(s,y)}parseObjectValue(s,l,f,m,y,x={}){return this.concat(l,f,m,y)._parse(s,x)}_parse(s,l){function f(m,y,x){return x==="assert"?new wr(y,[m]):x==="coerce"?new Gu(y,[m]):m}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof s[0]=="string"?this.registry[s[0]]:void 0;if(m){let y=m.parse(s,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,b=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||b.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(x,b))return null}else y=f(y,x,l.typeAnnotation||"coerce");else y=f(y,x,l.typeAnnotation||"assert")}if(!(y instanceof Rl)&&y.type.kind!=="resolvedImage"&&Mw(y)){const x=new oo(this._scope,this.options,this.iconImageUseTheme);try{y=new Rl(y.type,y.evaluate(x))}catch(b){return this.error(b.message),null}}return y}return Gu.parse(["to-array",s],this)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,l,f,m){let y=typeof s=="number"?this.path.concat(s):this.path;y=typeof l=="string"?y.concat(l):y;const x=m?this.scope.concat(m):this.scope;return new tx(this.registry,y,f||null,x,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(s,...l){const f=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new _l(f,s))}checkSubtype(s,l){const f=ae(s,l);return f&&this.error(f),f}}function Mw(u){if(u instanceof ex)return Mw(u.boundExpression);if(u instanceof Go&&u.name==="error"||u instanceof Fp||u instanceof jf||u instanceof Nf||u instanceof Hp)return!1;const s=u instanceof Gu||u instanceof wr;let l=!0;return u.eachChild(f=>{l=s?l&&Mw(f):l&&f instanceof Rl}),!!l&&qp(u)&&Gp(u,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function rx(u,s){const l=u.length-1;let f,m,y=0,x=l,b=0;for(;y<=x;)if(b=Math.floor((y+x)/2),f=u[b],m=u[b+1],f<=s){if(b===l||s<m)return b;y=b+1}else{if(!(f>s))throw new Si("Input is not a number.");x=b-1}return 0}class Xg{constructor(s,l,f){this.type=s,this.input=l,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static parse(s,l){if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(s[1],1,Tr);if(!f)return null;const m=[];let y=null;l.expectedType&&l.expectedType.kind!=="value"&&(y=l.expectedType);for(let x=1;x<s.length;x+=2){const b=x===1?-1/0:s[x],j=s[x+1],N=x,k=x+1;if(typeof b!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(m.length&&m[m.length-1][0]>=b)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const M=l.parse(j,k,y);if(!M)return null;y=y||M.type,m.push([b,M])}return new Xg(y,f,m)}evaluate(s){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(s);const m=this.input.evaluate(s);if(m<=l[0])return f[0].evaluate(s);const y=l.length;return m>=l[y-1]?f[y-1].evaluate(s):f[rx(l,m)].evaluate(s)}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){const s=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&s.push(this.labels[l]),s.push(this.outputs[l].serialize());return s}}const hT=.95047,fT=1.08883,pT=4/29,Wp=6/29,nx=3*Wp*Wp,qA=Wp*Wp*Wp,mT=Math.PI/180,GA=180/Math.PI;function Dw(u){return u>qA?Math.pow(u,1/3):u/nx+pT}function Ow(u){return u>Wp?u*u*u:nx*(u-pT)}function sx(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function ix(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function If(u){const s=ix(u.r),l=ix(u.g),f=ix(u.b),m=Dw((.4124564*s+.3575761*l+.1804375*f)/hT),y=Dw((.2126729*s+.7151522*l+.072175*f)/1);return{l:116*y-16,a:500*(m-y),b:200*(y-Dw((.0193339*s+.119192*l+.9503041*f)/fT)),alpha:u.a}}function Lw(u){let s=(u.l+16)/116,l=isNaN(u.a)?s:s+u.a/500,f=isNaN(u.b)?s:s-u.b/200;return s=1*Ow(s),l=hT*Ow(l),f=fT*Ow(f),new os(sx(3.2404542*l-1.5371385*s-.4985314*f),sx(-.969266*l+1.8760108*s+.041556*f),sx(.0556434*l-.2040259*s+1.0572252*f),u.alpha)}function gT(u,s,l){const f=s-u;return u+l*(f>180||f<-180?f-360*Math.round(f/360):f)}const Yg={forward:If,reverse:Lw,interpolate:function(u,s,l){return{l:Ur(u.l,s.l,l),a:Ur(u.a,s.a,l),b:Ur(u.b,s.b,l),alpha:Ur(u.alpha,s.alpha,l)}}},Cf={forward:function(u){const{l:s,a:l,b:f}=If(u),m=Math.atan2(f,l)*GA;return{h:m<0?m+360:m,c:Math.sqrt(l*l+f*f),l:s,alpha:u.a}},reverse:function(u){const s=u.h*mT,l=u.c;return Lw({l:u.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:u.alpha})},interpolate:function(u,s,l){return{h:gT(u.h,s.h,l),c:Ur(u.c,s.c,l),l:Ur(u.l,s.l,l),alpha:Ur(u.alpha,s.alpha,l)}}};var ax=Object.freeze({__proto__:null,hcl:Cf,lab:Yg});class sc{constructor(s,l,f,m,y){this.type=s,this.operator=l,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[x,b]of y)this.labels.push(x),this.outputs.push(b)}static interpolationFactor(s,l,f,m){let y=0;if(s.name==="exponential")y=Fw(l,s.base,f,m);else if(s.name==="linear")y=Fw(l,1,f,m);else if(s.name==="cubic-bezier"){const x=s.controlPoints;y=new Mc(x[0],x[1],x[2],x[3]).solve(Fw(l,1,f,m))}return y}static parse(s,l){let[f,m,y,...x]=s;if(!Array.isArray(m)||m.length===0)return l.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const N=m[1];if(typeof N!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:N}}else{if(m[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const N=m.slice(1);if(N.length!==4||N.some(k=>typeof k!="number"||k<0||k>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:N}}}if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length-1>3&&(s.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(y=l.parse(y,2,Tr),!y)return null;const b=[];let j=null;f==="interpolate-hcl"||f==="interpolate-lab"?j=qo:l.expectedType&&l.expectedType.kind!=="value"&&(j=l.expectedType);for(let N=0;N<x.length;N+=2){const k=x[N],M=x[N+1],D=N+3,q=N+4;if(typeof k!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(b.length&&b[b.length-1][0]>=k)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const G=l.parse(M,q,j);if(!G)return null;j=j||G.type,b.push([k,G])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new sc(j,f,m,y,b):l.error(`Type ${Ai(j)} is not interpolatable.`)}evaluate(s){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(s);const m=this.input.evaluate(s);if(m<=l[0])return f[0].evaluate(s);const y=l.length;if(m>=l[y-1])return f[y-1].evaluate(s);const x=rx(l,m),b=sc.interpolationFactor(this.interpolation,m,l[x],l[x+1]),j=f[x].evaluate(s),N=f[x+1].evaluate(s);return this.operator==="interpolate"?rc[this.type.kind.toLowerCase()](j,N,b):this.operator==="interpolate-hcl"?Cf.reverse(Cf.interpolate(Cf.forward(j),Cf.forward(N),b)):Yg.reverse(Yg.interpolate(Yg.forward(j),Yg.forward(N),b))}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){let s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const l=[this.operator,s,this.input.serialize()];for(let f=0;f<this.labels.length;f++)l.push(this.labels[f],this.outputs[f].serialize());return l}}function Fw(u,s,l,f){const m=f-l,y=u-l;return m===0?0:s===1?y/m:(Math.pow(s,y)-1)/(Math.pow(s,m)-1)}class Jg{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expectected at least one argument.");let f=null;const m=l.expectedType;m&&m.kind!=="value"&&(f=m);const y=[];for(const b of s.slice(1)){const j=l.parse(b,1+y.length,f,void 0,{typeAnnotation:"omit"});if(!j)return null;f=f||j.type,y.push(j)}const x=m&&y.some(b=>ae(m,b.type));return new Jg(x?ls:f,y)}evaluate(s){let l,f=null,m=0;for(const y of this.args){if(m++,f=y.evaluate(s),f&&f instanceof cs&&!f.available&&(l||(l=f),f=null,m===this.args.length))return l;if(f!==null)break}return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=["coalesce"];return this.eachChild(l=>{s.push(l.serialize())}),s}}class Qg{constructor(s,l){this.type=l.type,this.bindings=[].concat(s),this.result=l}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const l of this.bindings)s(l[1]);s(this.result)}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let y=1;y<s.length-1;y+=2){const x=s[y];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,y);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",y);const b=l.parse(s[y+1],y+1);if(!b)return null;f.push([x,b])}const m=l.parse(s[s.length-1],s.length-1,l.expectedType,f);return m?new Qg(f,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const s=["let"];for(const[l,f]of this.bindings)s.push(l,f.serialize());return s.push(this.result.serialize()),s}}class zw{constructor(s,l,f){this.type=s,this.index=l,this.input=f}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,Tr),m=l.parse(s[2],2,Ea(l.expectedType||ls));return f&&m?new zw(m.type.itemType,f,m):null}evaluate(s){const l=this.index.evaluate(s),f=this.input.evaluate(s);if(l<0)throw new Si("Array index out of bounds: negative index");if(l>=f.length)throw new Si("Array index out of bounds: index exceeds array size");if(l!==Math.floor(l))throw new Si("Array index must be an integer. Use at-interpolated for fractional indices");return f[l]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Bw{constructor(s,l,f){this.type=s,this.index=l,this.input=f}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,Tr),m=l.parse(s[2],2,Ea(l.expectedType||ls));return f&&m?new Bw(m.type.itemType,f,m):null}evaluate(s){const l=this.index.evaluate(s),f=this.input.evaluate(s);if(l<0)throw new Si(`Array index out of bounds: ${l} < 0.`);if(l>f.length-1)throw new Si(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l===Math.floor(l))return f[l];const m=Math.floor(l),y=Math.ceil(l),x=f[m],b=f[y];if(typeof x!="number"||typeof b!="number")throw new Si(`Cannot interpolate between non-number values at index ${l}.`);const j=l-m;return x*(1-j)+b*j}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Vw{constructor(s,l){this.type=Yn,this.needle=s,this.haystack=l}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,ls),m=l.parse(s[2],2,ls);return f&&m?we(f.type,[Yn,Mn,Tr,xd,ls])?new Vw(f,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(f.type)} instead`):null}evaluate(s){const l=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(f==null)return!1;if(!Be(l,["boolean","string","number","null"]))throw new Si(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(Bi(l))} instead.`);if(!Be(f,["string","array"]))throw new Si(`Expected second argument to be of type array or string, but found ${Ai(Bi(f))} instead.`);return f.indexOf(l)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class e_{constructor(s,l,f){this.type=Tr,this.needle=s,this.haystack=l,this.fromIndex=f}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,ls),m=l.parse(s[2],2,ls);if(!f||!m)return null;if(!we(f.type,[Yn,Mn,Tr,xd,ls]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(f.type)} instead`);if(s.length===4){const y=l.parse(s[3],3,Tr);return y?new e_(f,m,y):null}return new e_(f,m)}evaluate(s){const l=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!Be(l,["boolean","string","number","null"]))throw new Si(`Expected first argument to be of type boolean, string, number or null, but found ${Ai(Bi(l))} instead.`);if(!Be(f,["string","array"]))throw new Si(`Expected second argument to be of type array or string, but found ${Ai(Bi(f))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(s);return f.indexOf(l,m)}return f.indexOf(l)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ox{constructor(s,l,f,m,y,x){this.inputType=s,this.type=l,this.input=f,this.cases=m,this.outputs=y,this.otherwise=x}static parse(s,l){if(s.length<5)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return l.error("Expected an even number of arguments.");let f,m;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);const y={},x=[];for(let N=2;N<s.length-1;N+=2){let k=s[N];const M=s[N+1];Array.isArray(k)||(k=[k]);const D=l.concat(N);if(k.length===0)return D.error("Expected at least one branch label.");for(const G of k){if(typeof G!="number"&&typeof G!="string")return D.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return D.error("Numeric branch labels must be integer values.");if(f){if(D.checkSubtype(f,Bi(G)))return null}else f=Bi(G);if(y[String(G)]!==void 0)return D.error("Branch labels must be unique.");y[String(G)]=x.length}const q=l.parse(M,N,m);if(!q)return null;m=m||q.type,x.push(q)}const b=l.parse(s[1],1,ls);if(!b)return null;const j=l.parse(s[s.length-1],s.length-1,m);return j?b.type.kind!=="value"&&l.concat(1).checkSubtype(f,b.type)?null:new ox(f,m,b,y,x,j):null}evaluate(s){const l=this.input.evaluate(s);return(Lt(Bi(l),this.inputType)&&this.outputs[this.cases[l]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),f=[],m={};for(const x of l){const b=m[this.cases[x]];b===void 0?(m[this.cases[x]]=f.length,f.push([this.cases[x],[x]])):f[b][1].push(x)}const y=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,b]of f)s.push(b.length===1?y(b[0]):b.map(y)),s.push(this.outputs[x].serialize());return s.push(this.otherwise.serialize()),s}}class Zp{constructor(s,l,f){this.type=s,this.branches=l,this.otherwise=f}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);const m=[];for(let x=1;x<s.length-1;x+=2){const b=l.parse(s[x],x,Yn);if(!b)return null;const j=l.parse(s[x+1],x+1,f);if(!j)return null;m.push([b,j]),f=f||j.type}const y=l.parse(s[s.length-1],s.length-1,f);return y?new Zp(f,m,y):null}evaluate(s){for(const[l,f]of this.branches)if(l.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[l,f]of this.branches)s(l),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["case"];return this.eachChild(l=>{s.push(l.serialize())}),s}}class lx{constructor(s,l,f,m){this.type=s,this.input=l,this.beginIndex=f,this.endIndex=m}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,ls),m=l.parse(s[2],2,Tr);if(!f||!m)return null;if(!we(f.type,[Ea(ls),Mn,ls]))return l.error(`Expected first argument to be of type array or string, but found ${Ai(f.type)} instead`);if(s.length===4){const y=l.parse(s[3],3,Tr);return y?new lx(f.type,f,m,y):null}return new lx(f.type,f,m)}evaluate(s){const l=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!Be(l,["string","array"]))throw new Si(`Expected first argument to be of type array or string, but found ${Ai(Bi(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(s);return l.slice(f,m)}return l.slice(f)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class cx{constructor(s,l){this.type=Ea(Mn),this.str=s,this.delimiter=l}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,Mn),m=l.parse(s[2],2,Mn);return f&&m?new cx(f,m):void 0}evaluate(s){const l=this.str.evaluate(s),f=this.delimiter.evaluate(s);return l.split(f)}eachChild(s){s(this.str),s(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function _T(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function yT(u,s,l,f){return f.compare(s,l)===0}function Kp(u,s,l){const f=u!=="=="&&u!=="!=";return class IJ{constructor(y,x,b){this.type=Yn,this.lhs=y,this.rhs=x,this.collator=b,this.hasUntypedArgument=y.type.kind==="value"||x.type.kind==="value"}static parse(y,x){if(y.length!==3&&y.length!==4)return x.error("Expected two or three arguments.");const b=y[0];let j=x.parse(y[1],1,ls);if(!j)return null;if(!_T(b,j.type))return x.concat(1).error(`"${b}" comparisons are not supported for type '${Ai(j.type)}'.`);let N=x.parse(y[2],2,ls);if(!N)return null;if(!_T(b,N.type))return x.concat(2).error(`"${b}" comparisons are not supported for type '${Ai(N.type)}'.`);if(j.type.kind!==N.type.kind&&j.type.kind!=="value"&&N.type.kind!=="value")return x.error(`Cannot compare types '${Ai(j.type)}' and '${Ai(N.type)}'.`);f&&(j.type.kind==="value"&&N.type.kind!=="value"?j=new wr(N.type,[j]):j.type.kind!=="value"&&N.type.kind==="value"&&(N=new wr(j.type,[N])));let k=null;if(y.length===4){if(j.type.kind!=="string"&&N.type.kind!=="string"&&j.type.kind!=="value"&&N.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(k=x.parse(y[3],3,qu),!k)return null}return new IJ(j,N,k)}evaluate(y){const x=this.lhs.evaluate(y),b=this.rhs.evaluate(y);if(f&&this.hasUntypedArgument){const j=Bi(x),N=Bi(b);if(j.kind!==N.kind||j.kind!=="string"&&j.kind!=="number")throw new Si(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${j.kind}, ${N.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const j=Bi(x),N=Bi(b);if(j.kind!=="string"||N.kind!=="string")return s(y,x,b)}return this.collator?l(y,x,b,this.collator.evaluate(y)):s(y,x,b)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[u];return this.eachChild(x=>{y.push(x.serialize())}),y}}}const xT=Kp("==",function(u,s,l){return s===l},yT),vT=Kp("!=",function(u,s,l){return s!==l},function(u,s,l,f){return!yT(0,s,l,f)}),HA=Kp("<",function(u,s,l){return s<l},function(u,s,l,f){return f.compare(s,l)<0}),WA=Kp(">",function(u,s,l){return s>l},function(u,s,l,f){return f.compare(s,l)>0}),ZA=Kp("<=",function(u,s,l){return s<=l},function(u,s,l,f){return f.compare(s,l)<=0}),ux=Kp(">=",function(u,s,l){return s>=l},function(u,s,l,f){return f.compare(s,l)>=0});class Uw{constructor(s,l,f,m,y,x){this.type=Mn,this.number=s,this.locale=l,this.currency=f,this.unit=m,this.minFractionDigits=y,this.maxFractionDigits=x}static parse(s,l){if(s.length!==3)return l.error("Expected two arguments.");const f=l.parse(s[1],1,Tr);if(!f)return null;const m=s[2];if(typeof m!="object"||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let y=null;if(m.locale&&(y=l.parseObjectValue(m.locale,2,"locale",Mn),!y))return null;let x=null;if(m.currency&&(x=l.parseObjectValue(m.currency,2,"currency",Mn),!x))return null;let b=null;if(m.unit&&(b=l.parseObjectValue(m.unit,2,"unit",Mn),!b))return null;let j=null;if(m["min-fraction-digits"]&&(j=l.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",Tr),!j))return null;let N=null;return m["max-fraction-digits"]&&(N=l.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",Tr),!N)?null:new Uw(f,y,x,b,j,N)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(s):void 0,unit:this.unit?this.unit.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.unit&&s(this.unit),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.unit&&(s.unit=this.unit.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]}}class $w{constructor(s){this.type=Tr,this.input=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=l.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Ai(f.type)} instead.`):new $w(f):null}evaluate(s){const l=this.input.evaluate(s);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Si(`Expected value to be of type string or array, but found ${Ai(Bi(l))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}serialize(){const s=["length"];return this.eachChild(l=>{s.push(l.serialize())}),s}}function wT(u){return function(){u=1831565813+(u|=0)|0;let s=Math.imul(u^u>>>15,1|u);return s=s+Math.imul(s^s>>>7,61|s)^s,((s^s>>>14)>>>0)/4294967296}}const Xp={"==":xT,"!=":vT,">":WA,"<":HA,">=":ux,"<=":ZA,array:wr,at:zw,"at-interpolated":Bw,boolean:wr,case:Zp,coalesce:Jg,collator:Fp,format:Ef,image:en,in:Vw,"index-of":e_,interpolate:sc,"interpolate-hcl":sc,"interpolate-lab":sc,length:$w,let:Qg,literal:Rl,match:ox,number:wr,"number-format":Uw,object:wr,slice:lx,step:Xg,string:wr,"to-boolean":Gu,"to-color":Gu,"to-number":Gu,"to-string":Gu,var:ex,within:jf,distance:Nf,config:Hp,split:cx};function qw(u,[s,l,f,m]){s=s.evaluate(u),l=l.evaluate(u),f=f.evaluate(u);const y=m?m.evaluate(u):1,x=Va(s,l,f,y);if(x)throw new Si(x);return new os(s/255,l/255,f/255,y)}function bT(u,[s,l,f,m]){s=s.evaluate(u),l=l.evaluate(u),f=f.evaluate(u);const y=m?m.evaluate(u):1,x=function(N,k,M,D){return typeof N=="number"&&N>=0&&N<=360?typeof k=="number"&&k>=0&&k<=100&&typeof M=="number"&&M>=0&&M<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[N,k,M,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[N,k,M,D]:[N,k,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[N,k,M,D]:[N,k,M]).join(", ")}]: 'h' must be between 0 and 360.`}(s,l,f,y);if(x)throw new Si(x);const b=`hsla(${s}, ${l}%, ${f}%, ${y})`,j=os.parse(b);if(!j)throw new Si(`Failed to parse HSLA color: ${b}`);return j}function ST(u,s){return u in s}function dx(u,s){const l=s[u];return l===void 0?null:l}function bd(u){return{type:u}}function t_(u){if(u instanceof Hp)return new Set([u.key]);let s=new Set;return u.eachChild(l=>{s=new Set([...s,...t_(l)])}),s}function hx(u){if(u instanceof Go&&u.name==="is-active-floor")return!0;let s=!1;return u.eachChild(l=>{!s&&hx(l)&&(s=!0)}),s}function Af(u){return{result:"success",value:u}}function Th(u){return{result:"error",value:u}}function Gw(u,s){return!!u&&!!u.parameters&&u.parameters.indexOf(s)>-1}function fx(u){return u["property-type"]==="data-driven"}function Hw(u){return Gw(u.expression,"measure-light")}function Ww(u){return Gw(u.expression,"zoom")}function px(u){return!!u.expression&&u.expression.interpolated}function mx(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Zw(u){return u}function gx(u,s){const l=s.type==="color",f=u.stops&&typeof u.stops[0][0]=="object",m=f||!(f||u.property!==void 0),y=u.type||(px(s)?"exponential":"interval");if(l&&((u=Object.assign({},u)).stops&&(u.stops=u.stops.map(N=>[N[0],os.parse(N[1])])),u.default=os.parse(u.default?u.default:s.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!ax[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let x,b,j;if(y==="exponential")x=ET;else if(y==="interval")x=jh;else if(y==="categorical"){x=KA,b=Object.create(null);for(const N of u.stops)b[N[0]]=N[1];j=typeof u.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);x=XA}if(f){const N={},k=[];for(let q=0;q<u.stops.length;q++){const G=u.stops[q],ee=G[0].zoom;N[ee]===void 0&&(N[ee]={zoom:ee,type:u.type,property:u.property,default:u.default,stops:[]},k.push(ee)),N[ee].stops.push([G[0].value,G[1]])}const M=[];for(const q of k)M.push([N[q].zoom,gx(N[q],s)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:sc.interpolationFactor.bind(void 0,D),zoomStops:M.map(q=>q[0]),evaluate:({zoom:q},G)=>ET({stops:M,base:u.base},s,q).evaluate(q,G)}}if(m){const N=y==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:sc.interpolationFactor.bind(void 0,N),zoomStops:u.stops.map(k=>k[0]),evaluate:({zoom:k})=>x(u,s,k,b,j)}}return{kind:"source",evaluate(N,k){const M=k&&k.properties?k.properties[u.property]:void 0;return M===void 0?Yp(u.default,s.default):x(u,s,M,b,j)}}}function Yp(u,s,l){return u!==void 0?u:s!==void 0?s:l!==void 0?l:void 0}function KA(u,s,l,f,m){return Yp(typeof l===m?f[l]:void 0,u.default,s.default)}function jh(u,s,l){if(!$g(l))return Yp(u.default,s.default);const f=u.stops.length;if(f===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[f-1][0])return u.stops[f-1][1];const m=rx(u.stops.map(y=>y[0]),l);return u.stops[m][1]}function ET(u,s,l){const f=u.base!==void 0?u.base:1;if(!$g(l))return Yp(u.default,s.default);const m=u.stops.length;if(m===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[m-1][0])return u.stops[m-1][1];const y=rx(u.stops.map(k=>k[0]),l),x=function(k,M,D,q){const G=q-D,ee=k-D;return G===0?0:M===1?ee/G:(Math.pow(M,ee)-1)/(Math.pow(M,G)-1)}(l,f,u.stops[y][0],u.stops[y+1][0]),b=u.stops[y][1],j=u.stops[y+1][1];let N=rc[s.type]||Zw;if(u.colorSpace&&u.colorSpace!=="rgb"){const k=ax[u.colorSpace];N=(M,D)=>k.reverse(k.interpolate(k.forward(M),k.forward(D),x))}return typeof b.evaluate=="function"?{evaluate(...k){const M=b.evaluate.apply(void 0,k),D=j.evaluate.apply(void 0,k);if(M!==void 0&&D!==void 0)return N(M,D,x)}}:N(b,j,x)}function XA(u,s,l){return s.type==="color"?l=os.parse(l):s.type==="formatted"?l=es.fromString(l.toString()):s.type==="resolvedImage"?l=cs.build(l.toString()):Lp(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),Yp(l,u.default,s.default)}Go.register(Xp,{error:[{kind:"error"},[Mn],(u,[s])=>{throw new Si(s.evaluate(u))}],typeof:[Mn,[ls],(u,[s])=>Ai(Bi(s.evaluate(u)))],"to-rgba":[Ea(Tr,4),[qo],(u,[s])=>s.evaluate(u).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ea(Tr,4),[qo],(u,[s])=>s.evaluate(u).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[qo,[Tr,Tr,Tr],qw],rgba:[qo,[Tr,Tr,Tr,Tr],qw],hsl:[qo,[Tr,Tr,Tr],bT],hsla:[qo,[Tr,Tr,Tr,Tr],bT],has:{type:Yn,overloads:[[[Mn],(u,[s])=>ST(s.evaluate(u),u.properties())],[[Mn,vd],(u,[s,l])=>ST(s.evaluate(u),l.evaluate(u))]]},get:{type:ls,overloads:[[[Mn],(u,[s])=>dx(s.evaluate(u),u.properties())],[[Mn,vd],(u,[s,l])=>dx(s.evaluate(u),l.evaluate(u))]]},"feature-state":[ls,[Mn],(u,[s])=>dx(s.evaluate(u),u.featureState||{})],properties:[vd,[],u=>u.properties()],"geometry-type":[Mn,[],u=>u.geometryType()],worldview:[Mn,[],u=>u.globals.worldview||""],"is-active-floor":[Yn,bd(Mn),(u,s)=>{if(!(u.globals.activeFloors&&u.globals.activeFloors.size>0))return!1;const l=u.globals.activeFloors;return s.some(f=>{const m=f.evaluate(u);return l.has(m)})}],id:[ls,[],u=>u.id()],zoom:[Tr,[],u=>u.globals.zoom],pitch:[Tr,[],u=>u.globals.pitch||0],"distance-from-center":[Tr,[],u=>u.distanceFromCenter()],"measure-light":[Tr,[Mn],(u,[s])=>u.measureLight(s.evaluate(u))],"heatmap-density":[Tr,[],u=>u.globals.heatmapDensity||0],"line-progress":[Tr,[],u=>u.globals.lineProgress||0],"raster-value":[Tr,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[Tr,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[Tr,[],u=>u.globals.skyRadialProgress||0],accumulated:[ls,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Tr,bd(Tr),(u,s)=>{let l=0;for(const f of s)l+=f.evaluate(u);return l}],"*":[Tr,bd(Tr),(u,s)=>{let l=1;for(const f of s)l*=f.evaluate(u);return l}],"-":{type:Tr,overloads:[[[Tr,Tr],(u,[s,l])=>s.evaluate(u)-l.evaluate(u)],[[Tr],(u,[s])=>-s.evaluate(u)]]},"/":[Tr,[Tr,Tr],(u,[s,l])=>s.evaluate(u)/l.evaluate(u)],"%":[Tr,[Tr,Tr],(u,[s,l])=>s.evaluate(u)%l.evaluate(u)],ln2:[Tr,[],()=>Math.LN2],pi:[Tr,[],()=>Math.PI],e:[Tr,[],()=>Math.E],"^":[Tr,[Tr,Tr],(u,[s,l])=>Math.pow(s.evaluate(u),l.evaluate(u))],sqrt:[Tr,[Tr],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[Tr,[Tr],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[Tr,[Tr],(u,[s])=>Math.log(s.evaluate(u))],log2:[Tr,[Tr],(u,[s])=>Math.log2(s.evaluate(u))],sin:[Tr,[Tr],(u,[s])=>Math.sin(s.evaluate(u))],cos:[Tr,[Tr],(u,[s])=>Math.cos(s.evaluate(u))],tan:[Tr,[Tr],(u,[s])=>Math.tan(s.evaluate(u))],asin:[Tr,[Tr],(u,[s])=>Math.asin(s.evaluate(u))],acos:[Tr,[Tr],(u,[s])=>Math.acos(s.evaluate(u))],atan:[Tr,[Tr],(u,[s])=>Math.atan(s.evaluate(u))],min:[Tr,bd(Tr),(u,s)=>Math.min(...s.map(l=>l.evaluate(u)))],max:[Tr,bd(Tr),(u,s)=>Math.max(...s.map(l=>l.evaluate(u)))],abs:[Tr,[Tr],(u,[s])=>Math.abs(s.evaluate(u))],round:[Tr,[Tr],(u,[s])=>{const l=s.evaluate(u);return l<0?-Math.round(-l):Math.round(l)}],floor:[Tr,[Tr],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[Tr,[Tr],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[Yn,[Mn,ls],(u,[s,l])=>u.properties()[s.value]===l.value],"filter-id-==":[Yn,[ls],(u,[s])=>u.id()===s.value],"filter-type-==":[Yn,[Mn],(u,[s])=>u.geometryType()===s.value],"filter-<":[Yn,[Mn,ls],(u,[s,l])=>{const f=u.properties()[s.value],m=l.value;return typeof f==typeof m&&f<m}],"filter-id-<":[Yn,[ls],(u,[s])=>{const l=u.id(),f=s.value;return typeof l==typeof f&&l<f}],"filter->":[Yn,[Mn,ls],(u,[s,l])=>{const f=u.properties()[s.value],m=l.value;return typeof f==typeof m&&f>m}],"filter-id->":[Yn,[ls],(u,[s])=>{const l=u.id(),f=s.value;return typeof l==typeof f&&l>f}],"filter-<=":[Yn,[Mn,ls],(u,[s,l])=>{const f=u.properties()[s.value],m=l.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[Yn,[ls],(u,[s])=>{const l=u.id(),f=s.value;return typeof l==typeof f&&l<=f}],"filter->=":[Yn,[Mn,ls],(u,[s,l])=>{const f=u.properties()[s.value],m=l.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[Yn,[ls],(u,[s])=>{const l=u.id(),f=s.value;return typeof l==typeof f&&l>=f}],"filter-has":[Yn,[ls],(u,[s])=>s.value in u.properties()],"filter-has-id":[Yn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Yn,[Ea(Mn)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[Yn,[Ea(ls)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[Yn,[Mn,Ea(ls)],(u,[s,l])=>l.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[Yn,[Mn,Ea(ls)],(u,[s,l])=>function(f,m,y,x){for(;y<=x;){const b=y+x>>1;if(m[b]===f)return!0;m[b]>f?x=b-1:y=b+1}return!1}(u.properties()[s.value],l.value,0,l.value.length-1)],all:{type:Yn,overloads:[[[Yn,Yn],(u,[s,l])=>s.evaluate(u)&&l.evaluate(u)],[bd(Yn),(u,s)=>{for(const l of s)if(!l.evaluate(u))return!1;return!0}]]},any:{type:Yn,overloads:[[[Yn,Yn],(u,[s,l])=>s.evaluate(u)||l.evaluate(u)],[bd(Yn),(u,s)=>{for(const l of s)if(l.evaluate(u))return!0;return!1}]]},"!":[Yn,[Yn],(u,[s])=>!s.evaluate(u)],"is-supported-script":[Yn,[Mn],(u,[s])=>{const l=u.globals&&u.globals.isSupportedScript;return!l||l(s.evaluate(u))}],upcase:[Mn,[Mn],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[Mn,[Mn],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[Mn,bd(ls),(u,s)=>s.map(l=>Da(l.evaluate(u))).join("")],"resolved-locale":[Mn,[qu],(u,[s])=>s.evaluate(u).resolvedLocale()],random:[Tr,[Tr,Tr,ls],(u,s)=>{const[l,f,m]=s.map(x=>x.evaluate(u));if(l>f||l===f)return l;let y;if(typeof m=="string")y=function(x){let b=0;if(x.length===0)return b;for(let j=0;j<x.length;j++)b=(b<<5)-b+x.charCodeAt(j),b|=0;return b}(m);else{if(typeof m!="number")throw new Si(`Invalid seed input: ${m}`);y=m}return l+wT(y)()*(f-l)}]});class _x{constructor(s,l,f,m,y){this.expression=s,this._warningHistory={},this._scope=f,this._options=m,this._iconImageUseTheme=y,this._evaluator=new oo(f,m,y),this._defaultValue=l?function(x){return x.type==="color"&&(mx(x.default)||Array.isArray(x.default))?new os(0,0,0,0):x.type==="color"?os.parse(x.default)||null:x.default===void 0?null:x.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this.configDependencies=t_(s),this.isIndoorDependent=hx(s)}evaluateWithoutErrorHandling(s,l,f,m,y,x,b,j){return this._evaluator.globals=s,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=j||null,this.expression.evaluate(this._evaluator)}evaluate(s,l,f,m,y,x,b,j,N){this._evaluator||(this._evaluator=new oo(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=s,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=j||null,this._evaluator.iconImageUseTheme=N||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Si(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function yx(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Xp}function Wu(u,s,l,f,m){const y=new tx(Xp,[],s?function(b){const j={color:qo,string:Mn,number:Tr,enum:Mn,boolean:Yn,formatted:Ba,resolvedImage:wh};return b.type==="array"?Ea(j[b.value]||ls,b.length):j[b.type]}(s):void 0,void 0,void 0,l,f,m),x=y.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?Af(new _x(x,s,l,f,m)):Th(y.errors)}class r_{constructor(s,l,f,m){this.kind=s,this._styleExpression=l,this.isLightConstant=f,this.isLineProgressConstant=m,this.isStateDependent=s!=="constant"&&!Kg(l.expression),this.configDependencies=t_(l.expression),this.isIndoorDependent=hx(l.expression)}evaluateWithoutErrorHandling(s,l,f,m,y,x){return this._styleExpression.evaluateWithoutErrorHandling(s,l,f,m,y,x)}evaluate(s,l,f,m,y,x,b){return this._styleExpression.evaluate(s,l,f,m,y,x,void 0,void 0,b)}}class Nh{constructor(s,l,f,m,y,x){this.kind=s,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=s!=="camera"&&!Kg(l.expression),this.isIndoorDependent=hx(l.expression),this.isLightConstant=y,this.isLineProgressConstant=x,this.configDependencies=t_(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(s,l,f,m,y,x){return this._styleExpression.evaluateWithoutErrorHandling(s,l,f,m,y,x)}evaluate(s,l,f,m,y,x){return this._styleExpression.evaluate(s,l,f,m,y,x)}interpolationFactor(s,l,f){return this.interpolationType?sc.interpolationFactor(this.interpolationType,s,l,f):0}}function Kw(u,s,l,f,m){if((u=Wu(u,s,l,f,m)).result==="error")return u;const y=u.value.expression,x=qp(y);if(!x&&!fx(s))return Th([new _l("","data expressions not supported")]);const b=Gp(y,["zoom","pitch","distance-from-center"]);if(!b&&!Ww(s))return Th([new _l("","zoom expressions not supported")]);const j=Gp(y,["measure-light"]);if(!j&&!Hw(s))return Th([new _l("","measure-light expression not supported")]);const N=Gp(y,["line-progress"]);if(!N&&!function(D){return Gw(D.expression,"line-progress")}(s))return Th([new _l("","line-progress expression not supported")]);const k=s.expression&&s.expression.relaxZoomRestriction,M=vx(y);return M||b||k?M instanceof _l?Th([M]):M instanceof sc&&!px(s)?Th([new _l("",'"interpolate" expressions cannot be used with this property')]):Af(M?new Nh(x&&N?"camera":"composite",u.value,M.labels,M instanceof sc?M.interpolation:void 0,j,N):new r_(x&&N?"constant":"source",u.value,j,N)):Th([new _l("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class xx{constructor(s,l){this._parameters=s,this._specification=l,Object.assign(this,gx(this._parameters,this._specification))}static deserialize(s){return new xx(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function vx(u){let s=null;if(u instanceof Qg)s=vx(u.result);else if(u instanceof Jg){for(const l of u.args)if(s=vx(l),s)break}else(u instanceof Xg||u instanceof sc)&&u.input instanceof Go&&u.input.name==="zoom"&&(s=u);return s instanceof _l||u.eachChild(l=>{const f=vx(l);f instanceof _l?s=f:s&&f&&s!==f&&(s=new _l("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}var n_,wx,TT=function(){if(wx)return n_;wx=1,n_=s;var u=3;function s(l,f,m){var y=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var x=new Int32Array(this.arrayBuffer);l=x[0],this.d=(f=x[1])+2*(m=x[2]);for(var b=0;b<this.d*this.d;b++){var j=x[u+b],N=x[u+b+1];y.push(j===N?null:x.subarray(j,N))}var k=x[u+y.length+1];this.keys=x.subarray(x[u+y.length],k),this.bboxes=x.subarray(k),this.insert=this._insertReadonly}else{this.d=f+2*m;for(var M=0;M<this.d*this.d;M++)y.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=l,this.padding=m,this.scale=f/l,this.uid=0;var D=m/f*l;this.min=-D,this.max=l+D}return s.prototype.insert=function(l,f,m,y,x){this._forEachCell(f,m,y,x,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(x)},s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},s.prototype._insertCell=function(l,f,m,y,x,b){this.cells[x].push(b)},s.prototype.query=function(l,f,m,y,x){var b=this.min,j=this.max;if(l<=b&&f<=b&&j<=m&&j<=y&&!x)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(l,f,m,y,this._queryCell,N,{},x),N},s.prototype._queryCell=function(l,f,m,y,x,b,j,N){var k=this.cells[x];if(k!==null)for(var M=this.keys,D=this.bboxes,q=0;q<k.length;q++){var G=k[q];if(j[G]===void 0){var ee=4*G;(N?N(D[ee+0],D[ee+1],D[ee+2],D[ee+3]):l<=D[ee+2]&&f<=D[ee+3]&&m>=D[ee+0]&&y>=D[ee+1])?(j[G]=!0,b.push(M[G])):j[G]=!1}}},s.prototype._forEachCell=function(l,f,m,y,x,b,j,N){for(var k=this._convertToCellCoord(l),M=this._convertToCellCoord(f),D=this._convertToCellCoord(m),q=this._convertToCellCoord(y),G=k;G<=D;G++)for(var ee=M;ee<=q;ee++){var ne=this.d*ee+G;if((!N||N(this._convertFromCellCoord(G),this._convertFromCellCoord(ee),this._convertFromCellCoord(G+1),this._convertFromCellCoord(ee+1)))&&x.call(this,l,f,m,y,ne,b,j,N))return}},s.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},s.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,f=u+this.cells.length+1+1,m=0,y=0;y<this.cells.length;y++)m+=this.cells[y].length;var x=new Int32Array(f+m+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var b=f,j=0;j<l.length;j++){var N=l[j];x[u+j]=b,x.set(N,b),b+=N.length}return x[u+l.length]=b,x.set(this.keys,b),x[u+l.length+1]=b+=this.keys.length,x.set(this.bboxes,b),b+=this.bboxes.length,x.buffer},n_}(),Pf=Bu(TT);const Jp={};function hr(u,s,l={}){Object.defineProperty(u,"_classRegistryKey",{value:s,writable:!1}),Jp[s]={klass:u,omit:l.omit||[]}}hr(Object,"Object"),Pf.serialize=function(u,s){const l=u.toArrayBuffer();return s&&s.add(l),{buffer:l}},Pf.deserialize=function(u){return new Pf(u.buffer)},Object.defineProperty(Pf,"name",{value:"Grid"}),hr(Pf,"Grid"),delete Rt.prototype.constructor,typeof DOMMatrix<"u"&&hr(DOMMatrix,"DOMMatrix"),hr(os,"Color"),hr(Error,"Error"),hr(es,"Formatted"),hr(zr,"FormattedSection"),hr(gd,"AJAXError"),hr(cs,"ResolvedImage"),hr(xx,"StylePropertyFunction"),hr(_x,"StyleExpression",{omit:["_evaluator"]}),hr(Yi,"ImageId"),hr(Ji,"ImageVariant"),hr(Nh,"ZoomDependentExpression"),hr(r_,"ZoomConstantExpression"),hr(Go,"CompoundExpression",{omit:["_evaluate"]});for(const u in Xp)Jp[Xp[u]._classRegistryKey]||hr(Xp[u],`Expression${u}`);function Xw(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Sd(u){return self.ImageBitmap&&u instanceof ImageBitmap}function Ih(u,s){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(Xw(u)||Sd(u))return s&&s.add(u),u;if(ArrayBuffer.isView(u))return s&&s.add(u.buffer),u;if(u instanceof ImageData)return s&&s.add(u.data.buffer),u;if(Array.isArray(u)){const l=[];for(const f of u)l.push(Ih(f,s));return l}if(u instanceof Map){const l={$name:"Map",entries:[]};for(const[f,m]of u.entries())l.entries.push(Ih(f),Ih(m,s));return l}if(u instanceof Set){const l={$name:"Set"};let f=0;for(const m of u.values())l[++f]=Ih(m);return l}if(u instanceof DOMMatrix){const l={$name:"DOMMatrix"},f=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const m of f)l[m]=u[m];return l}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const l=u.constructor,f=l._classRegistryKey;if(!f)throw new Error(`Can't serialize object of unregistered class "${l.name}".`);const m=l.serialize?l.serialize(u,s):{};if(!l.serialize){for(const y in u)u.hasOwnProperty(y)&&(Jp[f].omit.indexOf(y)>=0||(m[y]=Ih(u[y],s)));u instanceof Error&&(m.message=u.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(m.$name=f),m}throw new Error("can't serialize object of type "+typeof u)}function Ch(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||Xw(u)||Sd(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Ch);if(typeof u=="object"){const s=u.$name||"Object";if(s==="Map"){const m=u.entries||[],y=new Map;for(let x=0;x<m.length;x+=2)y.set(Ch(m[x]),Ch(m[x+1]));return y}if(s==="Set"){const m=new Set;for(const y of Object.keys(u))y!=="$name"&&m.add(Ch(u[y]));return m}if(s==="DOMMatrix"){let m;return m=u.is2D?[u.a,u.b,u.c,u.d,u.e,u.f]:[u.m11,u.m12,u.m13,u.m14,u.m21,u.m22,u.m23,u.m24,u.m31,u.m32,u.m33,u.m34,u.m41,u.m42,u.m43,u.m44],new DOMMatrix(m)}if(s==="BigInt")return BigInt(u.value);const{klass:l}=Jp[s];if(!l)throw new Error(`Can't deserialize unregistered class "${s}".`);if(l.deserialize)return l.deserialize(u);const f=Object.create(l.prototype);for(const m of Object.keys(u))m!=="$name"&&(f[m]=Ch(u[m]));return f}throw new Error("can't deserialize object of type "+typeof u)}const Or={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,Osage:u=>u>=66736&&u<=66815,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function Yw(u){for(const s of u)if(Sx(s.charCodeAt(0)))return!0;return!1}function jT(u){for(const s of u)if(!bx(s.charCodeAt(0)))return!1;return!0}function bx(u){return!(Or.Arabic(u)||Or["Arabic Supplement"](u)||Or["Arabic Extended-A"](u)||Or["Arabic Presentation Forms-A"](u)||Or["Arabic Presentation Forms-B"](u))}function Sx(u){return!(u!==746&&u!==747&&(u<4352||!(Or["Bopomofo Extended"](u)||Or.Bopomofo(u)||Or["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Or["CJK Compatibility Ideographs"](u)||Or["CJK Compatibility"](u)||Or["CJK Radicals Supplement"](u)||Or["CJK Strokes"](u)||!(!Or["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Or["CJK Unified Ideographs Extension A"](u)||Or["CJK Unified Ideographs"](u)||Or["Enclosed CJK Letters and Months"](u)||Or["Hangul Compatibility Jamo"](u)||Or["Hangul Jamo Extended-A"](u)||Or["Hangul Jamo Extended-B"](u)||Or["Hangul Jamo"](u)||Or["Hangul Syllables"](u)||Or.Hiragana(u)||Or["Ideographic Description Characters"](u)||Or.Kanbun(u)||Or["Kangxi Radicals"](u)||Or["Katakana Phonetic Extensions"](u)||Or.Katakana(u)&&u!==12540||!(!Or["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Or["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Or["Unified Canadian Aboriginal Syllabics"](u)||Or["Unified Canadian Aboriginal Syllabics Extended"](u)||Or["Vertical Forms"](u)||Or["Yijing Hexagram Symbols"](u)||Or["Yi Syllables"](u)||Or["Yi Radicals"](u))))}function Jw(u){return!(Sx(u)||function(s){return!!(Or["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Or["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Or["Letterlike Symbols"](s)||Or["Number Forms"](s)||Or["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Or["Control Pictures"](s)&&s!==9251||Or["Optical Character Recognition"](s)||Or["Enclosed Alphanumerics"](s)||Or["Geometric Shapes"](s)||Or["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Or["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Or["CJK Symbols and Punctuation"](s)||Or.Katakana(s)||Or["Private Use Area"](s)||Or["CJK Compatibility Forms"](s)||Or["Small Form Variants"](s)||Or["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(u))}function Qw(u){return Or.Arabic(u)||Or["Arabic Supplement"](u)||Or["Arabic Extended-A"](u)||Or["Arabic Presentation Forms-A"](u)||Or["Arabic Presentation Forms-B"](u)}function NT(u){return u>=1424&&u<=2303||Or["Arabic Presentation Forms-A"](u)||Or["Arabic Presentation Forms-B"](u)}function YA(u,s){return!(!s&&NT(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Or.Khmer(u))}function JA(u){for(const s of u)if(NT(s.charCodeAt(0)))return!0;return!1}const Ml={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let eb=null,rl=Ml.unavailable,Ah=null;const IT=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(rl=Ml.error),eb&&eb(u)};function tb(){rb.fire(new Sa("pluginStateChange",{pluginStatus:rl,pluginURL:Ah}))}const rb=new Oc,nb=function(){return rl},sb=function(){if(rl!==Ml.deferred||!Ah)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");rl=Ml.loading,tb(),Ah&&mu({url:Ah},u=>{u?IT(u):(rl=Ml.loaded,tb())})},Dl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>rl===Ml.loaded||Dl.applyArabicShaping!=null,isLoading:()=>rl===Ml.loading,setState(u){rl=u.pluginStatus,Ah=u.pluginURL},isParsing:()=>rl===Ml.parsing,isParsed:()=>rl===Ml.parsed,getPluginURL:()=>Ah};class Xs{constructor(s,l){this.zoom=s,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness,this.worldview=l.worldview,this.activeFloors=l.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(s){return function(l,f){for(const m of l)if(!YA(m.charCodeAt(0),f))return!1;return!0}(s,Dl.isLoaded())}}class s_{constructor(s,l,f,m,y){this.property=s,this.value=l,this.expression=function(x,b,j,N,k){if(mx(x))return new xx(x,b);if(yx(x)||Array.isArray(x)&&x.length>0){const M=Kw(x,b,j,N,k);if(M.result==="error")throw new Error(M.value.map(D=>`${D.key}: ${D.message}`).join(", "));return M.value}{let M=x;return typeof x=="string"&&b.type==="color"&&(M=os.parse(x)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>M}}}(l===void 0?s.specification.default:l,s.specification,f,m,y)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,l,f,m){return this.property.possiblyEvaluate(this,s,l,f,m)}}class Qp{constructor(s,l,f,m){this.property=s,this.value=new s_(s,void 0,l,f,m)}transitioned(s,l){return new AT(this.property,this.value,l,Object.assign({},s.transition,this.transition),s.now)}untransitioned(){return new AT(this.property,this.value,null,{},0)}}class CT{constructor(s,l,f,m){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._scope=l,this._options=f,this._iconImageUseTheme=m,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(s){return br(this._values[s].value.value)}setValue(s,l){this._values.hasOwnProperty(s)||(this._values[s]=new Qp(this._values[s].property,this._scope,this._options,this._iconImageUseTheme)),this._values[s].value=new s_(this._values[s].property,l===null?void 0:br(l),this._scope,this._options,this._iconImageUseTheme),this._values[s].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[s].value.isIndoorDependent())}setTransitionOrValue(s,l){l&&(this._options=l);const f=this._properties.properties;if(s)for(const m in s){const y=s[m];if(m.endsWith("-transition")){const x=m.slice(0,-11);f[x]&&this.setTransition(x,y)}else f.hasOwnProperty(m)&&this.setValue(m,y)}}getTransition(s){return br(this._values[s].transition)}setTransition(s,l){this._values.hasOwnProperty(s)||(this._values[s]=new Qp(this._values[s].property)),this._values[s].transition=br(l)||void 0}serialize(){const s={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(s[l]=f);const m=this.getTransition(l);m!==void 0&&(s[`${l}-transition`]=m)}return s}transitioned(s,l){const f=new Ed(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(s,l._values[m]);return f}untransitioned(){const s=new Ed(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].untransitioned();return s}isIndoorDependent(){return this._isIndoorDependent}}class AT{constructor(s,l,f,m,y){const x=m.delay||0,b=m.duration||0;y=y||0,this.property=s,this.value=l,this.begin=y+x,this.end=this.begin+b,s.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(s,l,f){const m=s.now||0,y=this.value.possiblyEvaluate(s,l,f),x=this.prior;if(x){if(m>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(m<this.begin)return x.possiblyEvaluate(s,l,f);{const b=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(s,l,f),y,Dc(b))}}return y}}class Ed{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,l,f){const m=new kf(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(s,l,f);return m}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class ib{constructor(s,l,f,m){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._scope=l,this._options=f,this._iconImageUseTheme=m,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(s){return br(this._values[s].value)}setValue(s,l){this._values[s]=new s_(this._values[s].property,l===null?void 0:br(l),this._scope,this._options,this._iconImageUseTheme),this._values[s].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[s].isIndoorDependent())}serialize(){const s={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(s[l]=f)}return s}possiblyEvaluate(s,l,f,m){const y=new kf(this._properties);for(const x of Object.keys(this._values))y._values[x]=this._values[x].possiblyEvaluate(s,l,f,m);return y}isIndoorDependent(){return this._isIndoorDependent}}class Bc{constructor(s,l,f,m){this.property=s,this.value=l,this.parameters=f,this.iconImageUseTheme=m}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,l,f,m){return this.property.evaluate(this.value,this.parameters,s,l,f,m,this.iconImageUseTheme)}}class kf{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class Vt{constructor(s){this.specification=s}possiblyEvaluate(s,l){return s.expression.evaluate(l)}interpolate(s,l,f){const m=rc[this.specification.type];return m?m(s,l,f):s}}class nr{constructor(s,l){this.specification=s,this.overrides=l}possiblyEvaluate(s,l,f,m,y){return s.expression.kind==="constant"||s.expression.kind==="camera"?new Bc(this,{kind:"constant",value:s.expression.evaluate(l,null,{},f,m,void 0,y)},l):new Bc(this,s.expression,l,y)}interpolate(s,l,f){if(s.value.kind!=="constant"||l.value.kind!=="constant")return s;if(s.value.value===void 0||l.value.value===void 0)return new Bc(this,{kind:"constant",value:void 0},s.parameters);const m=rc[this.specification.type];return m?new Bc(this,{kind:"constant",value:m(s.value.value,l.value.value,f)},s.parameters):s}evaluate(s,l,f,m,y,x,b){return s.kind==="constant"?s.value:s.evaluate(l,f,m,y,x,void 0,b)}}class em{constructor(s){this.specification=s}possiblyEvaluate(s,l,f,m){return!!s.expression.evaluate(l,null,{},f,m)}interpolate(){return!1}}class Pi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new Xs(0,{});for(const f in s){const m=s[f];m.specification.overridable&&this.overridableProperties.push(f);const y=this.defaultPropertyValues[f]=new s_(m,void 0),x=this.defaultTransitionablePropertyValues[f]=new Qp(m);this.defaultTransitioningPropertyValues[f]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=y.possiblyEvaluate(l)}}}hr(nr,"DataDrivenProperty"),hr(Vt,"DataConstantProperty"),hr(em,"ColorRampProperty");var tt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function ab(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function tm(u){if(Array.isArray(u))return u.map(tm);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const l in u)s[l]=tm(u[l]);return s}return ab(u)}function rm(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!rm(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}function Ex(u,s="",l=null,f="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};rm(u)||(u=ic(u));const m=u;let y=!0;try{y=function(k){if(!sm(k))return k;let M=tm(k);return nm(M),M=Tx(M),M}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let x=null,b=null;if(f!=="background"&&f!=="sky"&&f!=="slot"){b=tt[`filter_${f}`];const k=Wu(y,b,s,l);if(k.result==="error")throw new Error(k.value.map(M=>`${M.key}: ${M.message}`).join(", "));x=(M,D,q)=>k.value.evaluate(M,D,{},q)}let j=null,N=null;if(y!==m){const k=Wu(m,b,s,l);if(k.result==="error")throw new Error(k.value.map(M=>`${M.key}: ${M.message}`).join(", "));j=(M,D,q,G,ee)=>k.value.evaluate(M,D,{},q,void 0,void 0,G,ee),N=!qp(k.value.expression)}return{filter:x,dynamicFilter:j||void 0,needGeometry:kT(y),needFeature:!!N}}function Tx(u){if(!Array.isArray(u))return u;const s=function(l){if(QA.has(l[0])){for(let f=1;f<l.length;f++)if(sm(l[f]))return!0}return l}(u);return s===!0?s:s.map(l=>Tx(l))}function nm(u){let s=!1;const l=[];if(u[0]==="case"){for(let f=1;f<u.length-1;f+=2)s=s||sm(u[f]),l.push(u[f+1]);l.push(u[u.length-1])}else if(u[0]==="match"){s=s||sm(u[1]);for(let f=2;f<u.length-1;f+=2)l.push(u[f+1]);l.push(u[u.length-1])}else if(u[0]==="step"){s=s||sm(u[1]);for(let f=1;f<u.length-1;f+=2)l.push(u[f+1])}s&&(u.length=0,u.push("any",...l));for(let f=1;f<u.length;f++)nm(u[f])}function sm(u){if(!Array.isArray(u))return!1;if((s=u[0])==="pitch"||s==="distance-from-center")return!0;var s;for(let l=1;l<u.length;l++)if(sm(u[l]))return!0;return!1}const QA=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function PT(u,s){return u<s?-1:u>s?1:0}function kT(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let s=1;s<u.length;s++)if(kT(u[s]))return!0;return!1}function ic(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?ob(u[1],u[2],"=="):s==="!="?jx(ob(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?ob(u[1],u[2],s):s==="any"?(l=u.slice(1),["any"].concat(l.map(ic))):s==="all"?["all"].concat(u.slice(1).map(ic)):s==="none"?["all"].concat(u.slice(1).map(ic).map(jx)):s==="in"?lb(u[1],u.slice(2)):s==="!in"?jx(lb(u[1],u.slice(2))):s==="has"?RT(u[1]):s!=="!has"||jx(RT(u[1]));var l}function ob(u,s,l){switch(u){case"$type":return[`filter-type-${l}`,s];case"$id":return[`filter-id-${l}`,s];default:return[`filter-${l}`,u,s]}}function lb(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(l=>typeof l!=typeof s[0])?["filter-in-large",u,["literal",s.sort(PT)]]:["filter-in-small",u,["literal",s]]}}function RT(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function jx(u){return["!",u]}const i_="";function Rf(u,s){return s?`${u}${i_}${s}`:u}let MT;const DT=()=>MT||(MT=new Pi({"icon-size":new nr(tt.layout_symbol["icon-size"]),"icon-image":new nr(tt.layout_symbol["icon-image"]),"icon-rotate":new nr(tt.layout_symbol["icon-rotate"]),"icon-offset":new nr(tt.layout_symbol["icon-offset"])}));class eP{constructor(s,l,f,m,y,x){this.cachedIconPrimary=null;const b=Wu(s,tt.appearance.condition);if(b.result==="success"&&(this.condition=b.value),this.name=l,f){this.properties=new kf(DT()),this.unevaluatedLayout=new ib(DT(),m,y,x);for(const j in f)this.unevaluatedLayout.setValue(j,f[j])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(s){this.cachedIconPrimary=s}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(s){return!(this.condition||!s.isHidden||this.name!=="hidden")||this.condition.evaluate(s.globals,s.feature,s.featureState,s.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(s){return this.properties.get(s)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(s,l,f){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(s,void 0,l,f))}serialize(){const s={};return s.condition=this.condition.expression.serialize(),this.name&&(s.name=this.name),this.unevaluatedLayout&&(s.properties=this.unevaluatedLayout.serialize()),s}}const OT="-transition",tP=new Set(["fill","line","background","hillshade","raster"]);class Ho extends Oc{constructor(s,l,f,m,y,x){if(super(),this.id=s.id,this.fqid=Rf(this.id,f),this.type=s.type,this.scope=f,this.lut=m,this.options=y,this.iconImageUseTheme=x,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},s.type!=="custom"){if(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type&&s.type!=="background"&&s.type!=="sky"&&s.type!=="slot"){this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter;const b=Wu(this.filter,tt[`filter_${s.type}`]);b.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...b.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||b.value.isIndoorDependent)}if(s.slot&&(this.slot=s.slot),s.appearances&&this.setAppearances(s.appearances),l.layout&&(this._unevaluatedLayout=new ib(l.layout,this.scope,y,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),l.paint){this._transitionablePaint=new CT(l.paint,this.scope,y);for(const b in s.paint)this.setPaintProperty(b,s.paint[b]);for(const b in s.layout)this.setLayoutProperty(b,s.layout[b]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new kf(l.paint)}}}onAdd(s){}onRemove(s){}isDraped(s){return!this.is3D(!0)&&tP.has(this.type)}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,l){if(this.type==="custom"&&s==="visibility")return void(this.visibility=l);const f=this._unevaluatedLayout;f._properties.properties[s]&&(f.setValue(s,l),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...f.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||f.isIndoorDependent(),s==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(s){this.appearances=[],s.forEach(l=>{this.appearances.push(new eP(l.condition,l.name,l.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(s){return s.endsWith(OT)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}isPaintProperty(s){return!!this._transitionablePaint._properties.properties[s]}setPaintProperty(s,l){const f=this._transitionablePaint,m=f._properties.properties;if(s.endsWith(OT)){const M=s.slice(0,-11);return m[M]&&f.setTransition(M,l||void 0),!1}if(!m[s])return!1;const y=f._values[s],x=y.value.isDataDriven(),b=y.value;f.setValue(s,l),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...f.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||f.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(s);const j=f._values[s].value,N=j.isDataDriven(),k=s.endsWith("pattern")||s==="line-dasharray";return N||x||k||this._handleOverridablePaintPropertyUpdate(s,b,j)}_handleSpecialPaintPropertyUpdate(s){}getProgramIds(){return null}getDefaultProgramParams(s,l,f){return null}_handleOverridablePaintPropertyUpdate(s,l,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,l,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,l)}serialize(){const s={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(s.appearances=this.appearances.map(l=>l.serialize())),At(s,(l,f)=>!(l===void 0||f==="layout"&&!Object.keys(l).length||f==="paint"&&!Object.keys(l).length))}is3D(s){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const s in this.paint._values){const l=this.paint.get(s);if(l instanceof Bc&&fx(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}for(const s of this.appearances)if(!Kg(s.condition.expression))return!0;return!1}compileFilter(s){this._filterCompiled||(this._featureFilter=Ex(this.filter,this.scope,s),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(s){this._stats&&(s.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(s,l,f){return{}}queryRadius(s){}queryIntersectsFeature(s,l,f,m,y,x,b,j,N){}}const rP={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class a_{constructor(s,l){this._structArray=s,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ti{constructor(){this.capacity=-1,this.resize(0)}static serialize(s,l){return s._trim(),l&&l.add(s.arrayBuffer),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const l=Object.create(this.prototype);return l.arrayBuffer=s.arrayBuffer,l.length=s.length,l.capacity=s.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...s){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...s){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function In(u,s=1){let l=0,f=0;return{members:u.map(m=>{const y=rP[m.type].BYTES_PER_ELEMENT,x=l=cb(l,Math.max(s,y)),b=m.components||1;return f=Math.max(f,y),l+=y*b,{name:m.name,type:m.type,components:b,offset:x}}),size:cb(l,Math.max(f,s)),alignment:s}}function cb(u,s){return Math.ceil(u/s)*s}class yl extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const m=2*s;return this.int16[m+0]=l,this.int16[m+1]=f,s}}yl.prototype.bytesPerElement=4,hr(yl,"StructArrayLayout2i4");class Mf extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,l,f)}emplace(s,l,f,m){const y=3*s;return this.int16[y+0]=l,this.int16[y+1]=f,this.int16[y+2]=m,s}}Mf.prototype.bytesPerElement=6,hr(Mf,"StructArrayLayout3i6");class im extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,s,l,f,m)}emplace(s,l,f,m,y){const x=4*s;return this.int16[x+0]=l,this.int16[x+1]=f,this.int16[x+2]=m,this.int16[x+3]=y,s}}im.prototype.bytesPerElement=8,hr(im,"StructArrayLayout4i8");class Td extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.float32[1*s+0]=l,s}}Td.prototype.bytesPerElement=4,hr(Td,"StructArrayLayout1f4");class ub extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,l,f)}emplace(s,l,f,m){const y=4*s,x=2*s;return this.int16[y+0]=l,this.int16[y+1]=f,this.float32[x+1]=m,s}}ub.prototype.bytesPerElement=8,hr(ub,"StructArrayLayout2i1f8");class db extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,l,f)}emplace(s,l,f,m){const y=4*s;return this.int16[y+0]=l,this.int16[y+1]=f,this.int16[y+2]=m,s}}db.prototype.bytesPerElement=8,hr(db,"StructArrayLayout3i8");class Nx extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,f,m,y)}emplace(s,l,f,m,y,x){const b=5*s;return this.int16[b+0]=l,this.int16[b+1]=f,this.int16[b+2]=m,this.int16[b+3]=y,this.int16[b+4]=x,s}}Nx.prototype.bytesPerElement=10,hr(Nx,"StructArrayLayout5i10");class Ix extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b){const j=this.length;return this.resize(j+1),this.emplace(j,s,l,f,m,y,x,b)}emplace(s,l,f,m,y,x,b,j){const N=6*s,k=12*s,M=3*s;return this.int16[N+0]=l,this.int16[N+1]=f,this.uint8[k+4]=m,this.uint8[k+5]=y,this.uint8[k+6]=x,this.uint8[k+7]=b,this.float32[M+2]=j,s}}Ix.prototype.bytesPerElement=12,hr(Ix,"StructArrayLayout2i4ub1f12");class ac extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,l,f)}emplace(s,l,f,m){const y=3*s;return this.float32[y+0]=l,this.float32[y+1]=f,this.float32[y+2]=m,s}}ac.prototype.bytesPerElement=12,hr(ac,"StructArrayLayout3f12");class Ph extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,f,m,y)}emplace(s,l,f,m,y,x){const b=6*s,j=3*s;return this.uint16[b+0]=l,this.uint16[b+1]=f,this.uint16[b+2]=m,this.uint16[b+3]=y,this.float32[j+2]=x,s}}Ph.prototype.bytesPerElement=12,hr(Ph,"StructArrayLayout4ui1f12");class Df extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,s,l,f,m)}emplace(s,l,f,m,y){const x=4*s;return this.uint16[x+0]=l,this.uint16[x+1]=f,this.uint16[x+2]=m,this.uint16[x+3]=y,s}}Df.prototype.bytesPerElement=8,hr(Df,"StructArrayLayout4ui8");class Cx extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,f,m,y,x)}emplace(s,l,f,m,y,x,b){const j=6*s;return this.int16[j+0]=l,this.int16[j+1]=f,this.int16[j+2]=m,this.int16[j+3]=y,this.int16[j+4]=x,this.int16[j+5]=b,s}}Cx.prototype.bytesPerElement=12,hr(Cx,"StructArrayLayout6i12");class Ax extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b,j,N,k,M,D){const q=this.length;return this.resize(q+1),this.emplace(q,s,l,f,m,y,x,b,j,N,k,M,D)}emplace(s,l,f,m,y,x,b,j,N,k,M,D,q){const G=12*s;return this.int16[G+0]=l,this.int16[G+1]=f,this.int16[G+2]=m,this.int16[G+3]=y,this.uint16[G+4]=x,this.uint16[G+5]=b,this.uint16[G+6]=j,this.uint16[G+7]=N,this.int16[G+8]=k,this.int16[G+9]=M,this.int16[G+10]=D,this.int16[G+11]=q,s}}Ax.prototype.bytesPerElement=24,hr(Ax,"StructArrayLayout4i4ui4i24");class am extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,f,m,y,x)}emplace(s,l,f,m,y,x,b){const j=10*s,N=5*s;return this.int16[j+0]=l,this.int16[j+1]=f,this.int16[j+2]=m,this.float32[N+2]=y,this.float32[N+3]=x,this.float32[N+4]=b,s}}am.prototype.bytesPerElement=20,hr(am,"StructArrayLayout3i3f20");class kh extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,s,l,f,m)}emplace(s,l,f,m,y){const x=4*s;return this.float32[x+0]=l,this.float32[x+1]=f,this.float32[x+2]=m,this.float32[x+3]=y,s}}kh.prototype.bytesPerElement=16,hr(kh,"StructArrayLayout4f16");class hb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint32[1*s+0]=l,s}}hb.prototype.bytesPerElement=4,hr(hb,"StructArrayLayout1ul4");class Vc extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const m=2*s;return this.uint16[m+0]=l,this.uint16[m+1]=f,s}}Vc.prototype.bytesPerElement=4,hr(Vc,"StructArrayLayout2ui4");class fb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b,j,N,k,M,D,q){const G=this.length;return this.resize(G+1),this.emplace(G,s,l,f,m,y,x,b,j,N,k,M,D,q)}emplace(s,l,f,m,y,x,b,j,N,k,M,D,q,G){const ee=20*s,ne=10*s;return this.int16[ee+0]=l,this.int16[ee+1]=f,this.int16[ee+2]=m,this.int16[ee+3]=y,this.int16[ee+4]=x,this.float32[ne+3]=b,this.float32[ne+4]=j,this.float32[ne+5]=N,this.float32[ne+6]=k,this.int16[ee+14]=M,this.uint32[ne+8]=D,this.uint16[ee+18]=q,this.uint16[ee+19]=G,s}}fb.prototype.bytesPerElement=40,hr(fb,"StructArrayLayout5i4f1i1ul2ui40");class Px extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b){const j=this.length;return this.resize(j+1),this.emplace(j,s,l,f,m,y,x,b)}emplace(s,l,f,m,y,x,b,j){const N=8*s;return this.int16[N+0]=l,this.int16[N+1]=f,this.int16[N+2]=m,this.int16[N+4]=y,this.int16[N+5]=x,this.int16[N+6]=b,this.int16[N+7]=j,s}}Px.prototype.bytesPerElement=16,hr(Px,"StructArrayLayout3i2i2i16");class om extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,f,m,y)}emplace(s,l,f,m,y,x){const b=4*s,j=8*s;return this.float32[b+0]=l,this.float32[b+1]=f,this.float32[b+2]=m,this.int16[j+6]=y,this.int16[j+7]=x,s}}om.prototype.bytesPerElement=16,hr(om,"StructArrayLayout2f1f2i16");class lm extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,f,m,y,x)}emplace(s,l,f,m,y,x,b){const j=20*s,N=5*s;return this.uint8[j+0]=l,this.uint8[j+1]=f,this.float32[N+1]=m,this.float32[N+2]=y,this.float32[N+3]=x,this.float32[N+4]=b,s}}lm.prototype.bytesPerElement=20,hr(lm,"StructArrayLayout2ub4f20");class ui extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,l,f)}emplace(s,l,f,m){const y=3*s;return this.uint16[y+0]=l,this.uint16[y+1]=f,this.uint16[y+2]=m,s}}ui.prototype.bytesPerElement=6,hr(ui,"StructArrayLayout3ui6");class cm extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me,ye,be,Me){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me,ye,be,Me)}emplace(s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me,ye,be,Me,Ce){const Le=30*s,Ve=15*s,He=60*s;return this.int16[Le+0]=l,this.int16[Le+1]=f,this.int16[Le+2]=m,this.float32[Ve+2]=y,this.float32[Ve+3]=x,this.uint16[Le+8]=b,this.uint16[Le+9]=j,this.uint32[Ve+5]=N,this.uint32[Ve+6]=k,this.uint32[Ve+7]=M,this.uint16[Le+16]=D,this.uint16[Le+17]=q,this.uint16[Le+18]=G,this.float32[Ve+10]=ee,this.float32[Ve+11]=ne,this.uint8[He+48]=ie,this.uint8[He+49]=me,this.uint8[He+50]=ye,this.uint32[Ve+13]=be,this.int16[Le+28]=Me,this.uint8[He+58]=Ce,s}}cm.prototype.bytesPerElement=60,hr(cm,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class pb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me,ye,be,Me,Ce,Le,Ve,He,mt,rt,gt,bt,Ct,Gt,Ot,Et){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me,ye,be,Me,Ce,Le,Ve,He,mt,rt,gt,bt,Ct,Gt,Ot,Et)}emplace(s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me,ye,be,Me,Ce,Le,Ve,He,mt,rt,gt,bt,Ct,Gt,Ot,Et,Dt){const ht=20*s,ut=40*s,kt=80*s;return this.float32[ht+0]=l,this.float32[ht+1]=f,this.int16[ut+4]=m,this.int16[ut+5]=y,this.int16[ut+6]=x,this.int16[ut+7]=b,this.int16[ut+8]=j,this.int16[ut+9]=N,this.int16[ut+10]=k,this.int16[ut+11]=M,this.int16[ut+12]=D,this.uint16[ut+13]=q,this.uint16[ut+14]=G,this.uint16[ut+15]=ee,this.uint16[ut+16]=ne,this.uint16[ut+17]=ie,this.uint16[ut+18]=me,this.uint16[ut+19]=ye,this.uint16[ut+20]=be,this.uint16[ut+21]=Me,this.uint16[ut+22]=Ce,this.uint16[ut+23]=Le,this.uint16[ut+24]=Ve,this.uint16[ut+25]=He,this.uint16[ut+26]=mt,this.uint16[ut+27]=rt,this.uint32[ht+14]=gt,this.float32[ht+15]=bt,this.float32[ht+16]=Ct,this.float32[ht+17]=Gt,this.float32[ht+18]=Ot,this.uint8[kt+76]=Et,this.uint16[ut+39]=Dt,s}}pb.prototype.bytesPerElement=80,hr(pb,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class mb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,f,m,y,x)}emplace(s,l,f,m,y,x,b){const j=6*s;return this.float32[j+0]=l,this.float32[j+1]=f,this.float32[j+2]=m,this.float32[j+3]=y,this.float32[j+4]=x,this.float32[j+5]=b,s}}mb.prototype.bytesPerElement=24,hr(mb,"StructArrayLayout6f24");class Of extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,f,m,y)}emplace(s,l,f,m,y,x){const b=5*s;return this.float32[b+0]=l,this.float32[b+1]=f,this.float32[b+2]=m,this.float32[b+3]=y,this.float32[b+4]=x,s}}Of.prototype.bytesPerElement=20,hr(Of,"StructArrayLayout5f20");class gb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b){const j=this.length;return this.resize(j+1),this.emplace(j,s,l,f,m,y,x,b)}emplace(s,l,f,m,y,x,b,j){const N=7*s;return this.float32[N+0]=l,this.float32[N+1]=f,this.float32[N+2]=m,this.float32[N+3]=y,this.float32[N+4]=x,this.float32[N+5]=b,this.float32[N+6]=j,s}}gb.prototype.bytesPerElement=28,hr(gb,"StructArrayLayout7f28");class o_ extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b,j,N,k,M){const D=this.length;return this.resize(D+1),this.emplace(D,s,l,f,m,y,x,b,j,N,k,M)}emplace(s,l,f,m,y,x,b,j,N,k,M,D){const q=11*s;return this.float32[q+0]=l,this.float32[q+1]=f,this.float32[q+2]=m,this.float32[q+3]=y,this.float32[q+4]=x,this.float32[q+5]=b,this.float32[q+6]=j,this.float32[q+7]=N,this.float32[q+8]=k,this.float32[q+9]=M,this.float32[q+10]=D,s}}o_.prototype.bytesPerElement=44,hr(o_,"StructArrayLayout11f44");class _b extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b,j,N){const k=this.length;return this.resize(k+1),this.emplace(k,s,l,f,m,y,x,b,j,N)}emplace(s,l,f,m,y,x,b,j,N,k){const M=9*s;return this.float32[M+0]=l,this.float32[M+1]=f,this.float32[M+2]=m,this.float32[M+3]=y,this.float32[M+4]=x,this.float32[M+5]=b,this.float32[M+6]=j,this.float32[M+7]=N,this.float32[M+8]=k,s}}_b.prototype.bytesPerElement=36,hr(_b,"StructArrayLayout9f36");class Rh extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const m=2*s;return this.float32[m+0]=l,this.float32[m+1]=f,s}}Rh.prototype.bytesPerElement=8,hr(Rh,"StructArrayLayout2f8");class yb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,s,l,f,m)}emplace(s,l,f,m,y){const x=6*s;return this.uint32[3*s+0]=l,this.uint16[x+2]=f,this.uint16[x+3]=m,this.uint16[x+4]=y,s}}yb.prototype.bytesPerElement=12,hr(yb,"StructArrayLayout1ul3ui12");class kx extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint16[1*s+0]=l,s}}kx.prototype.bytesPerElement=2,hr(kx,"StructArrayLayout1ui2");class Rx extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne){const ie=this.length;return this.resize(ie+1),this.emplace(ie,s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne)}emplace(s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie){const me=16*s;return this.float32[me+0]=l,this.float32[me+1]=f,this.float32[me+2]=m,this.float32[me+3]=y,this.float32[me+4]=x,this.float32[me+5]=b,this.float32[me+6]=j,this.float32[me+7]=N,this.float32[me+8]=k,this.float32[me+9]=M,this.float32[me+10]=D,this.float32[me+11]=q,this.float32[me+12]=G,this.float32[me+13]=ee,this.float32[me+14]=ne,this.float32[me+15]=ie,s}}Rx.prototype.bytesPerElement=64,hr(Rx,"StructArrayLayout16f64");class um extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,m,y,x,b){const j=this.length;return this.resize(j+1),this.emplace(j,s,l,f,m,y,x,b)}emplace(s,l,f,m,y,x,b,j){const N=10*s,k=5*s;return this.uint16[N+0]=l,this.uint16[N+1]=f,this.uint16[N+2]=m,this.uint16[N+3]=y,this.float32[k+2]=x,this.float32[k+3]=b,this.float32[k+4]=j,s}}um.prototype.bytesPerElement=20,hr(um,"StructArrayLayout4ui3f20");class xb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.int16[1*s+0]=l,s}}xb.prototype.bytesPerElement=2,hr(xb,"StructArrayLayout1i2");class Mx extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint8[1*s+0]=l,s}}Mx.prototype.bytesPerElement=1,hr(Mx,"StructArrayLayout1ub1");class vb extends a_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}vb.prototype.size=40;class LT extends fb{get(s){return new vb(this,s)}}hr(LT,"CollisionBoxArray");class Dx extends a_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(s){this._structArray.uint8[this._pos1+49]=s}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(s){this._structArray.uint8[this._pos1+50]=s}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(s){this._structArray.uint32[this._pos4+13]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(s){this._structArray.uint8[this._pos1+58]=s}}Dx.prototype.size=60;class l_ extends cm{get(s){return new Dx(this,s)}}hr(l_,"PlacedSymbolArray");class wb extends a_{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(s){this._structArray.uint32[this._pos4+14]=s}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(s){this._structArray.float32[this._pos4+18]=s}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}wb.prototype.size=80;class FT extends pb{get(s){return new wb(this,s)}}hr(FT,"SymbolInstanceArray");class bb extends Td{getoffsetX(s){return this.float32[1*s+0]}}hr(bb,"GlyphOffsetArray");class zT extends yl{getx(s){return this.int16[2*s+0]}gety(s){return this.int16[2*s+1]}}hr(zT,"SymbolLineVertexArray");class Ox extends a_{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ox.prototype.size=12;class BT extends yb{get(s){return new Ox(this,s)}}hr(BT,"FeatureIndexArray");class VT extends Vc{geta_centroid_pos0(s){return this.uint16[2*s+0]}geta_centroid_pos1(s){return this.uint16[2*s+1]}}hr(VT,"FillExtrusionCentroidArray");class UT extends a_{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}UT.prototype.size=6;class $T extends Mf{get(s){return new UT(this,s)}}hr($T,"FillExtrusionWallArray");const qT=In([{name:"a_pos",components:2,type:"Int16"}],4),nP=In([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),sP=In([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xi{constructor(s=[]){this.segments=s}_prepareSegment(s,l,f,m){let y=this.segments[this.segments.length-1];return s>xi.MAX_VERTEX_ARRAY_LENGTH&&Ar(`Max vertices per segment is ${xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!y||y.vertexLength+s>xi.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==m)&&(y={vertexOffset:l,primitiveOffset:f,vertexLength:0,primitiveLength:0},m!==void 0&&(y.sortKey=m),this.segments.push(y)),y}prepareSegment(s,l,f,m){return this._prepareSegment(s,l.length,f.length,m)}get(){return this.segments}destroy(){for(const s of this.segments)for(const l in s.vaos)s.vaos[l].destroy()}static simpleSegment(s,l,f,m){return new xi([{vertexOffset:s,primitiveOffset:l,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}function GT(u,s){return 256*(u=he(Math.floor(u),0,255))+he(Math.floor(s),0,255)}xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hr(xi,"SegmentVector");const iP=In([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),aP=In([{name:"a_pattern_b",components:4,type:"Uint16"}]),oP=In([{name:"a_dash",components:4,type:"Uint16"}]);class c_{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(s,l,f,m){this.ids.push(u_(s)),this.positions.push(l,f,m)}eachPosition(s,l){const f=u_(s);let m=0,y=this.ids.length-1;for(;m<y;){const x=m+y>>1;this.ids[x]>=f?y=x:m=x+1}for(;this.ids[m]===f;)l(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(s,l){const f=new Float64Array(s.ids),m=new Uint32Array(s.positions);return Sb(f,m,0,f.length-1),l&&(l.add(f.buffer),l.add(m.buffer)),{ids:f,positions:m}}static deserialize(s){const l=new c_;let f;l.ids=s.ids,l.positions=s.positions;for(const m of l.ids)m!==f&&l.uniqueIds.push(m),f=m;return l.indexed=!0,l}}function u_(u){const s=+u;return Number.isSafeInteger(s)?s:mh(String(u))}function Sb(u,s,l,f){for(;l<f;){const m=u[l+f>>1];let y=l-1,x=f+1;for(;;){do y++;while(u[y]<m);do x--;while(u[x]>m);if(y>=x)break;Lx(u,y,x),Lx(s,3*y,3*x),Lx(s,3*y+1,3*x+1),Lx(s,3*y+2,3*x+2)}x-l<f-x?(Sb(u,s,l,x),l=x+1):(Sb(u,s,x+1,f),f=x)}}function Lx(u,s,l){const f=u[s];u[s]=u[l],u[l]=f}hr(c_,"FeaturePositionMap");class Uc{constructor(s){this.gl=s.gl,this.initialized=!1}fetchUniformLocation(s,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(s,l),this.initialized=!0),!!this.location}set(s,l,f){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Fx extends Uc{constructor(s){super(s),this.current=0}set(s,l,f){this.fetchUniformLocation(s,l)&&this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}}class Qi extends Uc{constructor(s){super(s),this.current=0}set(s,l,f){this.fetchUniformLocation(s,l)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class Zu extends Uc{constructor(s){super(s),this.current=[0,0]}set(s,l,f){this.fetchUniformLocation(s,l)&&(f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1])))}}class dm extends Uc{constructor(s){super(s),this.current=[0,0,0]}set(s,l,f){this.fetchUniformLocation(s,l)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2])))}}class d_ extends Uc{constructor(s){super(s),this.current=[0,0,0,0]}set(s,l,f){this.fetchUniformLocation(s,l)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class Eb extends Uc{constructor(s){super(s),this.current=os.transparent.toPremultipliedRenderColor(null)}set(s,l,f){this.fetchUniformLocation(s,l)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const HT=new Float32Array(16);class h_ extends Uc{constructor(s){super(s),this.current=HT}set(s,l,f){if(this.fetchUniformLocation(s,l)){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let m=1;m<16;m++)if(f[m]!==this.current[m]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}}}const lP=new Float32Array(9),WT=new Float32Array(4);class Tb extends Uc{constructor(s){super(s),this.current=WT}set(s,l,f){if(this.fetchUniformLocation(s,l)){for(let m=0;m<4;m++)if(f[m]!==this.current[m]){this.current=f,this.gl.uniformMatrix2fv(this.location,!1,f);break}}}}function jb(u){return[GT(255*u.r,255*u.g),GT(255*u.b,255*u.a)]}function zx(u,s,l,f,m,y,x,b){return!!u&&(u.kind==="composite"||u.kind==="source"?u.evaluate(new Xs(0,{brightness:y,worldview:b}),s,l,m,f,x)==="none":u.value==="none")}class Bx{constructor(s,l,f,m){this.value=s,this.uniformNames=l.map(y=>`u_${y}`),this.type=f,this.context=m}setUniform(s,l,f,m,y){const x=m.constantOr(this.value);l.set(s,y,x instanceof os?x.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):x)}getBinding(s,l){return this.type==="color"?new Eb(s):new Qi(s)}}class f_{constructor(s,l){this.uniformNames=l.map(f=>`u_${f}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(s,l){this.pixelRatio=s.pixelRatio||1,this.pattern=s.tl.concat(s.br),this.patternTransition=l?l.tl.concat(l.br):this.pattern}setUniform(s,l,f,m,y){let x=null;y!=="u_pattern"&&y!=="u_dash"||(x=this.pattern),y==="u_pattern_b"&&(x=this.patternTransition),y==="u_pixel_ratio"&&(x=this.pixelRatio),x&&l.set(s,y,x)}getBinding(s,l){return l==="u_pattern"||l==="u_pattern_b"||l==="u_dash"?new d_(s):new Qi(s)}}class jd{constructor(s,l,f,m){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(y=>({name:`a_${y}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(s,l,f,m,y,x,b,j){const N=this.paintVertexArray.length,k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Xs(0,{brightness:x,worldview:j}),l,{},y,m,b):this.expression.kind==="constant"&&this.expression.value,M=zx(this.lutExpression,l,{},m,y,x,b,j);this.paintVertexArray.resize(s),this._setPaintValue(N,s,k,M?null:this.context.lut)}updatePaintArray(s,l,f,m,y,x,b,j){const N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:j},f,m,void 0,y):this.expression.kind==="constant"&&this.expression.value,k=zx(this.lutExpression,f,m,y,void 0,b,void 0,j);this._setPaintValue(s,l,N,k?null:this.context.lut)}_setPaintValue(s,l,f,m){if(this.type==="color"){const y=jb(f.toPremultipliedRenderColor(m));for(let x=s;x<l;x++)this.paintVertexArray.emplace(x,y[0],y[1])}else{for(let y=s;y<l;y++)this.paintVertexArray.emplace(y,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yu{constructor(s,l,f,m,y,x){this.expression=s,this.uniformNames=l.map(b=>`u_${b}_t`),this.type=f,this.useIntegerZoom=m,this.context=y,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(s,l,f,m,y,x,b,j){const N=this.expression.evaluate(new Xs(this.context.zoom,{brightness:x,worldview:j}),l,{},y,m,b),k=this.expression.evaluate(new Xs(this.context.zoom+1,{brightness:x,worldview:j}),l,{},y,m,b),M=zx(this.lutExpression,l,{},m,y,x,b,j),D=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(D,s,N,k,M?null:this.context.lut)}updatePaintArray(s,l,f,m,y,x,b,j){const N=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:j},f,m,void 0,y),k=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:j},f,m,void 0,y),M=zx(this.lutExpression,f,m,y,void 0,b,void 0,j);this._setPaintValue(s,l,N,k,M?null:this.context.lut)}_setPaintValue(s,l,f,m,y){if(this.type==="color"){const x=jb(f.toPremultipliedRenderColor(y)),b=jb(f.toPremultipliedRenderColor(y));for(let j=s;j<l;j++)this.paintVertexArray.emplace(j,x[0],x[1],b[0],b[1])}else{for(let x=s;x<l;x++)this.paintVertexArray.emplace(x,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,l,f,m,y){const x=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,b=he(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);l.set(s,y,b)}getBinding(s,l){return new Qi(s)}}class jo{constructor(s,l,f,m,y){this.expression=s,this.layerId=y,this.paintVertexAttributes=(f==="array"?oP:iP).members;for(let x=0;x<l.length;++x);this.paintVertexArray=new m,this.paintTransitionVertexArray=new Df}populatePaintArray(s,l,f,m){const y=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValues(y,s,l.patterns&&l.patterns[this.layerId],f)}updatePaintArray(s,l,f,m,y,x,b){this._setPaintValues(s,l,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(s,l,f,m){if(!m||!f)return;const y=m[f[0]],x=m[f[1]];if(y){if(y){const{tl:b,br:j,pixelRatio:N}=y;for(let k=s;k<l;k++)this.paintVertexArray.emplace(k,b[0],b[1],j[0],j[1],N)}if(x){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:j}=x;for(let N=s;N<l;N++)this.paintTransitionVertexArray.emplace(N,b[0],b[1],j[0],j[1])}}}upload(s){const l=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,l)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=s.createVertexBuffer(this.paintTransitionVertexArray,aP.members,l))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Nd{constructor(s,l,f=()=>!0){this.binders={},this._buffers=[],this.context=l;const m=[];for(const y in s.paint._values){const x=s.paint.get(y);if(y.endsWith("-use-theme")||!f(y)||!(x instanceof Bc&&fx(x.property.specification)))continue;const b=uP(y,s.type),j=x.value,N=x.property.specification.type,k=!!x.property.useIntegerZoom,M=y==="line-dasharray"||y.endsWith("pattern"),D=s.paint.get(`${y}-use-theme`),q=y==="line-dasharray"&&s.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(j.kind!=="constant"||q)if(j.kind==="source"||q||M){const G=Nb(y,N,"source");this.binders[y]=M?new jo(j,b,N,G,s.id):new jd(j,b,N,G),m.push(`/a_${y}`)}else{const G=Nb(y,N,"composite");this.binders[y]=new yu(j,b,N,k,l,G),m.push(`/z_${y}`)}else this.binders[y]=M?new f_(j.value,b):new Bx(j.value,b,N,l),m.push(`/u_${y}`);D&&(this.binders[y].lutExpression=D.value)}this.cacheKey=m.sort().join("")}getMaxValue(s){const l=this.binders[s];return l instanceof jd||l instanceof yu?l.maxValue:0}populatePaintArrays(s,l,f,m,y,x,b,j){for(const N in this.binders){const k=this.binders[N];k.context=this.context,(k instanceof jd||k instanceof yu||k instanceof jo)&&k.populatePaintArray(s,l,f,m,y,x,b,j)}}setConstantPatternPositions(s,l){for(const f in this.binders){const m=this.binders[f];m instanceof f_&&m.setConstantPatternPositions(s,l)}}getPatternTransitionVertexBuffer(s){const l=this.binders[s];return l instanceof jo?l.paintTransitionVertexBuffer:null}updatePaintArrays(s,l,f,m,y,x,b,j,N,k){let M=!1;const D=Object.keys(s),q=D.length!==0&&!j,G=q?D:l.uniqueIds;this.context.lut=y.lut;for(const ee in this.binders){const ne=this.binders[ee];if(ne.context=this.context,(ne instanceof jd||ne instanceof yu||ne instanceof jo)&&ne.expression&&ne.expression.kind&&ne.expression.kind!=="constant"&&(ne.expression.isStateDependent===!0||ne.expression.isLightConstant===!1)){const ie=y.paint.get(ee);ne.expression=ie.value;for(const me of G){const ye=s[me.toString()];l.eachPosition(me,(be,Me,Ce)=>{const Le=m.feature(be);ne.updatePaintArray(Me,Ce,Le,ye,x,b,N,k)})}if(!q)for(const me of f.uniqueIds){const ye=s[me.toString()];f.eachPosition(me,(be,Me,Ce)=>{const Le=m.feature(be);ne.updatePaintArray(Me,Ce,Le,ye,x,b,N,k)})}M=!0}}return M}defines(){const s=[];for(const l in this.binders){const f=this.binders[l];(f instanceof Bx||f instanceof f_)&&s.push(...f.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s){const l=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Bx||m instanceof f_||m instanceof yu)for(const y of m.uniformNames)l.push({name:y,property:f,binding:m.getBinding(s,y)})}return l}setUniforms(s,l,f,m,y){for(const{name:x,property:b,binding:j}of f)this.binders[b].setUniform(s,j,y,m.get(b),x)}updatePaintBuffers(){this._buffers=[];for(const s in this.binders){const l=this.binders[s];(l instanceof jd||l instanceof yu||l instanceof jo)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer),l instanceof jo&&l.paintTransitionVertexBuffer&&this._buffers.push(l.paintTransitionVertexBuffer)}}upload(s){for(const l in this.binders){const f=this.binders[l];(f instanceof jd||f instanceof yu||f instanceof jo)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const l=this.binders[s];(l instanceof jd||l instanceof yu||l instanceof jo)&&l.destroy()}}}class xu{constructor(s,l,f=()=>!0){this.programConfigurations={};for(const m of s)this.programConfigurations[m.id]=new Nd(m,l,f);this.needsUpload=!1,this._featureMap=new c_,this._featureMapWithoutIds=new c_,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(s,l,f,m,y,x,b,j,N){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(s,l,m,y,x,b,j,N);l.id!==void 0?this._featureMap.add(l.id,f,this._bufferOffset,s):(this._featureMapWithoutIds.add(this._idlessCounter,f,this._bufferOffset,s),this._idlessCounter+=1),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,l,f,m,y,x,b,j){for(const N of f)this.needsUpload=this.programConfigurations[N.id].updatePaintArrays(s,this._featureMap,this._featureMapWithoutIds,l,N,m,y,x,b||0,j)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}const cP={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function uP(u,s){return cP[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}const dP={"line-pattern":{source:Ph,composite:Ph},"fill-pattern":{source:Ph,composite:Ph},"fill-extrusion-pattern":{source:Ph,composite:Ph},"line-dasharray":{source:Df,composite:Df}},hP={color:{source:Rh,composite:kh},number:{source:Td,composite:Rh}};function Nb(u,s,l){const f=dP[u];return f&&f[l]||hP[s][l]}hr(Bx,"ConstantBinder"),hr(f_,"PatternConstantBinder"),hr(jd,"SourceExpressionBinder"),hr(jo,"PatternCompositeBinder"),hr(yu,"CompositeExpressionBinder"),hr(Nd,"ProgramConfiguration",{omit:["_buffers"]}),hr(xu,"ProgramConfigurationSet");const xl=Zt/Math.PI/2,g=5,o=6,h=16383,_=64,v=[_,32,16],S=-xl,T=xl;function I(u,s,l,f=xl){return l=Nn(l),[u*Math.sin(l)*f,-s*f,u*Math.cos(l)*f]}function A(u,s,l){return I(Math.cos(Nn(u)),Math.sin(Nn(u)),s,l)}const L=63710088e-1,F=2*Math.PI*L;class H{constructor(s,l){if(isNaN(s)||isNaN(l))throw new Error(`Invalid LngLat object: (${s}, ${l})`);if(this.lng=+s,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new H(ze(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const l=Math.PI/180,f=this.lat*l,m=s.lat*l,y=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((s.lng-this.lng)*l);return L*Math.acos(Math.min(y,1))}toBounds(s=0){const l=360*s/40075017,f=l/Math.cos(Math.PI/180*this.lat);return new U({lng:this.lng-f,lat:this.lat-l},{lng:this.lng+f,lat:this.lat+l})}toEcef(s){return A(this.lat,this.lng,xl+s*xl/L)}static convert(s){if(s instanceof H)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new H(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new H(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class U{constructor(s,l){s&&(l?this.setSouthWest(s).setNorthEast(l):Array.isArray(s)&&s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))}setNorthEast(s){return this._ne=s instanceof H?new H(s.lng,s.lat):H.convert(s),this}setSouthWest(s){return this._sw=s instanceof H?new H(s.lng,s.lat):H.convert(s),this}extend(s){const l=this._sw,f=this._ne;let m,y;if(s instanceof H)m=s,y=s;else{if(!(s instanceof U))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(U.convert(s)):this.extend(H.convert(s)):typeof s=="object"&&s!==null&&s.hasOwnProperty("lat")&&(s.hasOwnProperty("lon")||s.hasOwnProperty("lng"))?this.extend(H.convert(s)):this;if(m=s._sw,y=s._ne,!m||!y)return this}return l||f?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new H(m.lng,m.lat),this._ne=new H(y.lng,y.lat)),this}getCenter(){return new H((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new H(this.getWest(),this.getNorth())}getSouthEast(){return new H(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:l,lat:f}=H.convert(s);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(s){if(s)return s instanceof U?s:new U(s)}}const Y=0,te=25.5;function se(u){return F*Math.cos(u*Math.PI/180)}function fe(u){return(180+u)/360}function de(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function _e(u,s){return u/se(s)}function Ee(u){return 360*u-180}function xe(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Re(u,s){return u*se(xe(s))}const Te=85.051129;function De(u){return Math.cos(Nn(he(u,-Te,Te)))}function Pe(u,s){const l=he(s,Y,te),f=Math.pow(2,l);return De(u)*F/(512*f)}function Ie(u){return 1/Math.cos(u*Math.PI/180)}function Oe(u,s=0){const l=Math.exp(Math.PI*(1-(u.y+s/Zt)/(1<<u.z)*2));return 80150034*l/(l*l+1)/Zt/(1<<u.z)}class et{constructor(s,l,f=0){this.x=+s,this.y=+l,this.z=+f}static fromLngLat(s,l=0){const f=H.convert(s);return new et(fe(f.lng),de(f.lat),_e(l,f.lat))}toLngLat(){return new H(Ee(this.x),xe(this.y))}toAltitude(){return Re(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/F*Ie(xe(this.y))}}function Ke(u,s,l,f,m,y,x,b,j){const N=(s+f)/2,k=(l+m)/2,M=new Rt(N,k);b(M),function(D,q,G,ee,ne,ie){const me=G-ne,ye=ee-ie;return Math.abs((ee-q)*me-(G-D)*ye)/Math.hypot(me,ye)}(M.x,M.y,y.x,y.y,x.x,x.y)>=j?(Ke(u,s,l,N,k,y,M,b,j),Ke(u,N,k,f,m,M,x,b,j)):u.push(x)}function pt(u,s,l){let f=u[0],m=f.x,y=f.y;s(f);const x=[f];for(let b=1;b<u.length;b++){const j=u[b],{x:N,y:k}=j;s(j),Ke(x,m,y,N,k,f,j,s,l),m=N,y=k,f=j}return x}function ot(u,s,l,f){if(f(s,l)){const m=s.add(l)._mult(.5);ot(u,s,m,f),ot(u,m,l,f)}else u.push(l)}function vt(u,s){let l=u[0];const f=[l];for(let m=1;m<u.length;m++){const y=u[m];ot(f,l,y,s),l=y}return f}const qt=Math.pow(2,14)-1,nt=-qt-1;function Ue(u,s){const l=Math.round(u.x*s),f=Math.round(u.y*s);return u.x=he(l,nt,qt),u.y=he(f,nt,qt),(l<u.x||l>u.x+1||f<u.y||f>u.y+1)&&Ar("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function wt(u,s,l){const f=u.loadGeometry(),m=u.extent,y=Zt/m;if(s&&l&&l.projection.isReprojectedInTileSpace){const x=1<<s.z,{scale:b,x:j,y:N,projection:k}=l,M=D=>{const q=Ee((s.x+D.x/m)/x),G=xe((s.y+D.y/m)/x),ee=k.project(q,G);D.x=(ee.x*b-j)*m,D.y=(ee.y*b-N)*m};for(let D=0;D<f.length;D++)if(u.type!==1)f[D]=pt(f[D],M,1);else{const q=[];for(const G of f[D])G.x<0||G.x>=m||G.y<0||G.y>=m||(M(G),q.push(G));f[D]=q}}for(const x of f)for(const b of x)Ue(b,y);return f}function lt(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?wt(u):[]}}class Pt{constructor(s,l,f,m,y){this.properties={},this.extent=f,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=m,this._values=y,s.readFields(Kt,this,l)}loadGeometry(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos,f=[];let m,y=1,x=0,b=0,j=0;for(;s.pos<l;){if(x<=0){const N=s.readVarint();y=7&N,x=N>>3}if(x--,y===1||y===2)b+=s.readSVarint(),j+=s.readSVarint(),y===1&&(m&&f.push(m),m=[]),m&&m.push(new Rt(b,j));else{if(y!==7)throw new Error(`unknown command ${y}`);m&&m.push(m[0].clone())}}return m&&f.push(m),f}bbox(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos;let f=1,m=0,y=0,x=0,b=1/0,j=-1/0,N=1/0,k=-1/0;for(;s.pos<l;){if(m<=0){const M=s.readVarint();f=7&M,m=M>>3}if(m--,f===1||f===2)y+=s.readSVarint(),x+=s.readSVarint(),y<b&&(b=y),y>j&&(j=y),x<N&&(N=x),x>k&&(k=x);else if(f!==7)throw new Error(`unknown command ${f}`)}return[b,N,j,k]}toGeoJSON(s,l,f){const m=this.extent*Math.pow(2,f),y=this.extent*s,x=this.extent*l,b=this.loadGeometry();function j(D){return[360*(D.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+x)/m)*Math.PI))-90]}function N(D){return D.map(j)}let k;if(this.type===1){const D=[];for(const G of b)D.push(G[0]);const q=N(D);k=D.length===1?{type:"Point",coordinates:q[0]}:{type:"MultiPoint",coordinates:q}}else if(this.type===2){const D=b.map(N);k=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=function(G){const ee=G.length;if(ee<=1)return[G];const ne=[];let ie,me;for(let ye=0;ye<ee;ye++){const be=gr(G[ye]);be!==0&&(me===void 0&&(me=be<0),me===be<0?(ie&&ne.push(ie),ie=[G[ye]]):ie&&ie.push(G[ye]))}return ie&&ne.push(ie),ne}(b),q=[];for(const G of D)q.push(G.map(N));k=q.length===1?{type:"Polygon",coordinates:q[0]}:{type:"MultiPolygon",coordinates:q}}}const M={type:"Feature",geometry:k,properties:this.properties};return this.id!=null&&(M.id=this.id),M}}function Kt(u,s,l){u===1?s.id=l.readVarint():u===2?function(f,m){const y=f.readVarint()+f.pos;for(;f.pos<y;){const x=m._keys[f.readVarint()],b=m._values[f.readVarint()];m.properties[x]=b}}(l,s):u===3?s.type=l.readVarint():u===4&&(s._geometry=l.pos)}function gr(u){let s=0;for(let l,f,m=0,y=u.length,x=y-1;m<y;x=m++)l=u[m],f=u[x],s+=(f.x-l.x)*(l.y+f.y);return s}Pt.types=["Unknown","Point","LineString","Polygon"];class Ut{constructor(s,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Ht,this,l),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];const l=this._pbf.readVarint()+this._pbf.pos;return new Pt(this._pbf,l,this.extent,this._keys,this._values)}}function Ht(u,s,l){u===15?s.version=l.readVarint():u===1?s.name=l.readString():u===5?s.extent=l.readVarint():u===2?s._features.push(l.pos):u===3?s._keys.push(l.readString()):u===4&&s._values.push(function(f){let m=null;const y=f.readVarint()+f.pos;for(;f.pos<y;){const x=f.readVarint()>>3;m=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}if(m==null)throw new Error("unknown feature value");return m}(l))}class yr{constructor(s,l){this.layers=s.readFields(lr,{},l)}}function lr(u,s,l){if(u===3){const f=new Ut(l,l.readVarint()+l.pos);f.length&&(s[f.name]=f)}}const sr="3d_elevation_id",cr="level";class Lr{constructor(){this._valid=!1}reset(s){return this.feature=s,this._valid=!0,this._geometry=s.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(s,l){return this._valid&&s(l(this._geometry)),this}require(s,l,f){return this.get(s,!0,l,f)}optional(s,l,f){return this.get(s,!1,l,f)}success(){return this._valid}get(s,l,f,m){const y=this.feature.properties.hasOwnProperty(s)?+this.feature.properties[s]:void 0;return this._valid&&y!==void 0&&!Number.isNaN(y)?f(m?m(y):y):l&&(this._valid=!1),this}}class Cn{constructor(s,l){this.featureFunc=s,this.vertexFunc=l}parseFeature(s,l,f){return this.featureFunc(s,l,f)}parseVertex(s,l,f){return this.vertexFunc(s,l,f)}}const Un=new Cn((u,s,l)=>u.reset(s).require(sr,f=>{l.id=f}).optional("fixed_height_relative",f=>{l.constantHeight=f},Yr.decodeRelativeHeight).geometry(f=>{l.bounds=f},Gg).success(),(u,s,l)=>u.reset(s).require(sr,f=>{l.id=f}).require("elevation_idx",f=>{l.idx=f}).require("extent",f=>{l.extent=f}).require("height_relative",f=>{l.height=f},Yr.decodeRelativeHeight).geometry(f=>{l.position=f},Yr.getPoint).success()),Is=new Cn((u,s,l)=>u.reset(s).require(sr,f=>{l.id=f}).optional("fixed_height",f=>{l.constantHeight=f},Yr.decodeMetricHeight).geometry(f=>{l.bounds=f},Gg).success(),(u,s,l)=>u.reset(s).require(sr,f=>{l.id=f}).require("elevation_idx",f=>{l.idx=f}).require("extent",f=>{l.extent=f}).require("height",f=>{l.height=f},Yr.decodeMetricHeight).geometry(f=>{l.position=f},Yr.getPoint).success());class Yr{static getPoint(s){return Pl(s[0][0].x,s[0][0].y)}static decodeRelativeHeight(s){return 1e-4*s*5}static decodeMetricHeight(s){return 1e-4*s}static getVersionSchema(s){return s?s==="1.0.1"?Is:void 0:Un}static parse(s){const l=[],f=[],m=s.length,y=new Lr;for(let x=0;x<m;x++){const b=s.feature(x),j=b.properties.version,N=Yr.getVersionSchema(j);if(N===void 0){Ar(`Unknown elevation feature version number ${j||"(unknown)"}`);continue}const k=b.properties.type;if(!k)continue;const M=Pt.types[b.type];if(M==="Point"&&k==="curve_point"){const D={};N.parseVertex(y,b,D)&&l.push(D)}else if(M==="Polygon"&&k==="curve_meta"){const D={};N.parseFeature(y,b,D)&&f.push(D)}}return{vertices:l,features:f}}}class Bn{constructor(s,l){this.pos=s,this.dir=l}intersectsPlane(s,l,f){const m=cu(l,this.dir);if(Math.abs(m)<1e-6)return!1;const y=((s[0]-this.pos[0])*l[0]+(s[1]-this.pos[1])*l[1])/m;return f[0]=this.pos[0]+this.dir[0]*y,f[1]=this.pos[1]+this.dir[1]*y,!0}}class pn{constructor(s,l){this.pos=s,this.dir=l}intersectsPlane(s,l,f){const m=Br(l,this.dir);if(Math.abs(m)<1e-6)return!1;const y=((s[0]-this.pos[0])*l[0]+(s[1]-this.pos[1])*l[1]+(s[2]-this.pos[2])*l[2])/m;return f[0]=this.pos[0]+this.dir[0]*y,f[1]=this.pos[1]+this.dir[1]*y,f[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(s,l,f){if(function(q,G){var ee=q[0],ne=q[1],ie=q[2],me=G[0],ye=G[1],be=G[2];return Math.abs(ee-me)<=w*Math.max(1,Math.abs(ee),Math.abs(me))&&Math.abs(ne-ye)<=w*Math.max(1,Math.abs(ne),Math.abs(ye))&&Math.abs(ie-be)<=w*Math.max(1,Math.abs(ie),Math.abs(be))}(this.pos,s)||l===0)return f[0]=f[1]=f[2]=0,!1;const[m,y,x]=this.dir,b=this.pos[0]-s[0],j=this.pos[1]-s[1],N=this.pos[2]-s[2],k=m*m+y*y+x*x,M=2*(b*m+j*y+N*x),D=M*M-4*k*(b*b+j*j+N*N-l*l);if(D<0){const q=Math.max(-M/2,0),G=b+m*q,ee=j+y*q,ne=N+x*q,ie=Math.hypot(G,ee,ne);return f[0]=G*l/ie,f[1]=ee*l/ie,f[2]=ne*l/ie,!1}{const q=(-M-Math.sqrt(D))/(2*k);if(q<0){const G=Math.hypot(b,j,N);return f[0]=b*l/G,f[1]=j*l/G,f[2]=N*l/G,!1}return f[0]=b+m*q,f[1]=j+y*q,f[2]=N+x*q,!0}}}class Ss{constructor(s,l,f,m,y){this.TL=s,this.TR=l,this.BR=f,this.BL=m,this.horizon=y}static fromInvProjectionMatrix(s,l,f){const m=[-1,1,1],y=[1,1,1],x=[1,-1,1],b=[-1,-1,1],j=ln(m,m,s),N=ln(y,y,s),k=ln(x,x,s),M=ln(b,b,s);return new Ss(j,N,k,M,l/f)}}function $n(u,s,l){let f=1/0,m=-1/0;const y=[];for(const x of u){Je(y,x,s);const b=Br(y,l);f=Math.min(f,b),m=Math.max(m,b)}return[f,m]}function Vs(u,s){let l=!0;for(let f=0;f<u.planes.length;f++){const m=u.planes[f];let y=0;for(let x=0;x<s.length;x++)y+=+(Br(m,s[x])+m[3]>=0);if(y===0)return 0;y!==s.length&&(l=!1)}return l?2:1}function Jn(u,s){for(const l of u.projections){const f=$n(s,u.points[0],l.axis);if(l.projection[1]<f[0]||l.projection[0]>f[1])return 0}return 1}function gn(u,s){let l=0;const f=[0,0,0,0];for(let x=0;x<u.length;x++)f[0]=u[x][0],f[1]=u[x][1],f[2]=u[x][2],f[3]=1,(m=f)[0]*(y=s)[0]+m[1]*y[1]+m[2]*y[2]+m[3]*y[3]>=0&&l++;var m,y;return l}class us{constructor(s,l){this.points=s||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=wn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Je([],this.points[2],this.points[3]),Je([],this.points[0],this.points[3]),Je([],this.points[4],this.points[0]),Je([],this.points[5],this.points[1]),Je([],this.points[6],this.points[2]),Je([],this.points[7],this.points[3])];for(const f of this.frustumEdges){const m=[0,-f[2],f[1]],y=[f[2],0,-f[0]];this.projections.push({axis:m,projection:$n(this.points,this.points[0],m)}),this.projections.push({axis:y,projection:$n(this.points,this.points[0],y)})}}static fromInvProjectionMatrix(s,l,f,m){const y=Math.pow(2,f),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>{const k=sn([],N,s),M=1/k[3]/l*y;return(D=k)[0]=(q=k)[0]*(G=[M,M,m?1/k[3]:M,M])[0],D[1]=q[1]*G[1],D[2]=q[2]*G[2],D[3]=q[3]*G[3],D;var D,q,G}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(N=>{const k=jr([],on([],Je([],x[N[0]],x[N[1]]),Je([],x[N[2]],x[N[1]]))),M=-Br(k,x[N[1]]);return k.concat(M)}),j=[];for(let N=0;N<x.length;N++)j.push([x[N][0],x[N][1],x[N][2]]);return new us(j,b)}intersectsPrecise(s,l,f){for(let m=0;m<l.length;m++)if(!gn(s,l[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!gn(s,this.planes[m]))return 0;for(const m of f)for(const y of this.frustumEdges){const x=on([],m,y),b=Ze(x);if(b===0)continue;St(x,x,1/b);const j=$n(this.points,this.points[0],x),N=$n(s,this.points[0],x);if(j[0]>N[1]||N[0]>j[1])return 0}return 1}containsPoint(s){for(const l of this.planes){const f=l[3];if(Br([l[0],l[1],l[2]],s)+f<0)return!1}return!0}}class wn{static fromPoints(s){const l=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const m of s)Mt(l,l,m),ar(f,f,m);return new wn(l,f)}static fromTileIdAndHeight(s,l,f){const m=1<<s.canonical.z,y=s.canonical.x,x=s.canonical.y;return new wn([y/m,x/m,l],[(y+1)/m,(x+1)/m,f])}static applyTransform(s,l){const f=s.getCorners();for(let m=0;m<f.length;++m)ln(f[m],f[m],l);return wn.fromPoints(f)}static applyTransformFast(s,l){const f=[l[12],l[13],l[14]],m=[...f];for(let y=0;y<3;y++)for(let x=0;x<3;x++){const b=l[4*x+y],j=b*s.min[x],N=b*s.max[x];f[y]+=Math.min(j,N),m[y]+=Math.max(j,N)}return new wn(f,m)}static projectAabbCorners(s,l){const f=s.getCorners();for(let m=0;m<f.length;++m)ln(f[m],f[m],l);return f}constructor(s,l){this.min=s,this.max=l,this.center=St([],$e([],this.min,this.max),.5)}quadrant(s){const l=[s%2==0,s<2],f=ke(this.min),m=ke(this.max);for(let y=0;y<l.length;y++)f[y]=l[y]?this.min[y]:this.center[y],m[y]=l[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new wn(f,m)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}getCorners(){const s=this.min,l=this.max;return[[s[0],s[1],s[2]],[l[0],s[1],s[2]],[l[0],l[1],s[2]],[s[0],l[1],s[2]],[s[0],s[1],l[2]],[l[0],s[1],l[2]],[l[0],l[1],l[2]],[s[0],l[1],l[2]]]}intersects(s){return this.intersectsAabb(s.bounds)?Vs(s,this.getCorners()):0}intersectsFlat(s){return this.intersectsAabb(s.bounds)?Vs(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(s,l){return l||this.intersects(s)?Jn(s,this.getCorners()):0}intersectsPreciseFlat(s,l){return l||this.intersectsFlat(s)?Jn(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(s){for(let l=0;l<3;++l)if(this.min[l]>s.max[l]||s.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(s){return!(this.min[0]>s.max[0]||s.min[0]>this.max[0]||this.min[1]>s.max[1]||s.min[1]>this.max[1])}encapsulate(s){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],s.min[l]),this.max[l]=Math.max(this.max[l],s.max[l])}encapsulatePoint(s){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],s[l]),this.max[l]=Math.max(this.max[l],s[l])}closestPoint(s){return[Math.max(Math.min(this.max[0],s[0]),this.min[0]),Math.max(Math.min(this.max[1],s[1]),this.min[1]),Math.max(Math.min(this.max[2],s[2]),this.min[2])]}}hr(wn,"Aabb");class ei{constructor(s,l){this.feature=s,this.metersToTile=l,this.index=0}get(){const s=this.feature.vertices[this.index],l=this.feature.vertexProps[this.index].dir,f=l[1],m=-l[0],y=(s.extent+1)*this.metersToTile;return[new Rt(Math.trunc(s.position[0]+f*y),Math.trunc(s.position[1]+m*y)),new Rt(Math.trunc(s.position[0]-f*y),Math.trunc(s.position[1]-m*y))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class ps{constructor(s,l,f,m,y,x){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[zi(),zi(),zi(),zi(),zi(),zi(),zi()],this.id=s,this.heightRange={min:f,max:f},this.safeArea=l,this.constantHeight=f,this.constantHeight==null&&(this.constantHeight!=null||m.length!==0)){this.vertices=m,this.edges=y,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((j=this.vertices[b.a].position)[0]===(N=this.vertices[b.b].position)[0]&&j[1]===N[1]);var j,N}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:Pl(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const j=this.vertices[b.a].position,N=this.vertices[b.b].position,k=fl(zi(),N,j),M=oi(k),D=pl(zi(),k,1/M);this.edgeProps.push({vec:k,dir:D,len:M});const q=this.vertexProps[b.a].dir,G=this.vertexProps[b.b].dir;lu(q,q,D),lu(G,G,D)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||pa(b.dir,b.dir);this.tessellate(x)}}pointElevation(s){if(this.constantHeight!=null)return this.constantHeight;const l=this.getClosestEdge(s);if(l==null)return 0;const[f,m]=l;return Ur(this.vertices[this.edges[f].a].height,this.vertices[this.edges[f].b].height,m)}computeSlopeNormal(s,l){const f=this.getClosestEdge(s);if(!f)return Xe(0,0,1);const m=f[0],y=this.edges[m],x=this.edgeProps[m].vec,b=Xe(x[0],x[1],(this.vertices[y.b].height-this.vertices[y.a].height)*l),j=Xe(b[1],-b[0],0);on(j,j,b);const N=Ze(j);return N>0?St(j,j,1/N):qe(j,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(s){if(this.edges.length===0)return;let l=0,f=Number.POSITIVE_INFINITY,m=0;const[y,x,b,j,N,k,M]=this._tmpVec2;hh(M,s.x,s.y);const D=new Bn(M,null);for(let q=0;q<this.edges.length;q++){const G=this.edges[q],ee=this.edgeProps[q].dir;D.dir=ee;const ne=this.vertices[G.a].position,ie=this.vertices[G.b].position,me=D.intersectsPlane(ne,this.vertexProps[G.a].dir,y),ye=D.intersectsPlane(ie,this.vertexProps[G.b].dir,x);if(!me||!ye)continue;fl(b,x,y),fl(j,M,y);const be=cu(b,b),Me=be>0?cu(j,b)/be:0,Ce=he(Me,0,1),Le=Math.abs((Me-Ce)*this.edgeProps[q].len);fl(N,M,ne),hh(k,ee[1],-ee[0]);const Ve=Le+Math.abs(cu(N,k));Ve<f&&(l=q,f=Ve,m=Ce)}return[l,m]}tessellate(s){const l=J(),f=J(),m=J(),y=J();for(let x=this.edges.length-1;x>=0;--x){const b=this.edges[x].a,j=this.edges[x].b,{position:N,height:k,extent:M}=this.vertices[b],{position:D,height:q,extent:G}=this.vertices[j],ee=this.vertexProps[b].dir,ne=this.vertexProps[j].dir;if(qe(l,N[0]/s,N[1]/s,k),qe(f,D[0]/s,D[1]/s,q),qe(m,ee[1],-ee[0],0),St(m,m,M),qe(y,ne[1],-ne[0],0),St(y,y,G),this.distSqLines(Xe(l[0]+.5*m[0],l[1]+.5*m[1],l[2]+.5*m[2]),Xe(f[0]-.5*y[0],f[1]-.5*y[1],f[2]-.5*y[2]),Xe(l[0]-.5*m[0],l[1]-.5*m[1],l[2]-.5*m[2]),Xe(f[0]+.5*y[0],f[1]+.5*y[1],f[2]+.5*y[2]))<=.0025000000000000005)continue;const ie=this.vertices.length,me=lu(zi(),N,D);this.vertices.push({position:pl(me,me,.5),height:.5*(k+q),extent:.5*(M+G)});const ye=lu(zi(),ee,ne);this.vertexProps.push({dir:pa(ye,ye)}),this.edges.splice(x,1),this.edgeProps.splice(x,1),this.edges.push({a:b,b:ie}),this.edges.push({a:ie,b:j});const be=fl(zi(),this.vertices[ie].position,N),Me=oi(be),Ce={vec:be,dir:pl(zi(),be,1/Me),len:Me};this.edgeProps.push(Ce),this.edgeProps.push(Ce)}}distSqLines(s,l,f,m){const y=st(J(),l,s),x=st(J(),m,f),b=st(J(),s,f),j=Br(y,y),N=Br(y,x),k=Br(y,b),M=Br(x,x),D=Br(x,b),q=j*M-N*N;if(q===0)return ft(Zn(y,f,m,Br(b,x)/Br(x,x)),s);const G=(j*D-N*k)/q;return ft(Zn(y,s,l,(N*D-k*M)/q),Zn(x,f,m,G))}}class Jr{static parseFrom(s,l){const f=Yr.parse(s);if(!f)return[];let{vertices:m,features:y}=f;const x=1/Oe(l);y.sort((k,M)=>k.id-M.id),m.sort((k,M)=>k.id-M.id||k.idx-M.idx),m=m.filter((k,M,D)=>M===D.findIndex(q=>q.id===k.id&&q.idx===k.idx));const b=new Array;let j=0;const N=m.length;for(const k of y){if(k.constantHeight){b.push(new ps(k.id,k.bounds,k.constantHeight));continue}for(;j!==N&&m[j].id<k.id;)j++;if(j===N||m[j].id!==k.id)continue;const M=new Array,D=new Array,q=j;for(;j!==N&&m[j].id===k.id;){const G=m[j];if(M.push({position:G.position,height:G.height,extent:G.extent}),j!==q&&m[j-1].idx===G.idx-1){const ee=j-q;D.push({a:ee-1,b:ee})}j++}b.push(new ps(k.id,k.bounds,void 0,M,D,x))}return b}static getElevationFeature(s,l){if(!l)return;const f=+s.properties[sr];return Number.isNaN(f)?void 0:l.find(m=>m.id===f)}}class Gn{constructor(s,l){this.zScale=1,this.xOffset=0,this.yOffset=0,s.equals(l)||(this.zScale=Math.pow(2,l.z-s.z),this.xOffset=(s.x*this.zScale-l.x)*Zt,this.yOffset=(s.y*this.zScale-l.y)*Zt)}constantElevation(s,l){if(s.constantHeight!=null)return this.computeBiasedHeight(s.constantHeight,l)}pointElevation(s,l,f){const m=this.constantElevation(l,f);return m??(s.x=s.x*this.zScale+this.xOffset,s.y=s.y*this.zScale+this.yOffset,this.computeBiasedHeight(l.pointElevation(s),f))}computeBiasedHeight(s,l){return l<=0?s:s+l*Ne(0,l,s>=0?s:Math.abs(.5*s))}}hr(ps,"ElevationFeature");class pi{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.projection=s.projection,this.layoutVertexArray=new yl,this.indexArray=new ui,this.segments=new xi,this.programConfigurations=new xu(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Td),this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,l){}updateAppearances(s,l,f,m){}populate(s,l,f,m){const y=this.layers[0],x=[];let b=null;y.type==="circle"&&(b=y.layout.get("circle-sort-key"));for(const{feature:N,id:k,index:M,sourceLayerIndex:D}of s){const q=this.layers[0]._featureFilter.needGeometry,G=lt(N,q);if(!this.layers[0]._featureFilter.filter(new Xs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),G,f))continue;const ee=b?b.evaluate(G,{},f):void 0,ne={id:k,properties:N.properties,type:N.type,sourceLayerIndex:D,index:M,geometry:q?G.geometry:wt(N,f,m),patterns:{},sortKey:ee};x.push(ne)}b&&x.sort((N,k)=>N.sortKey-k.sortKey);let j=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new Cx,j=m.projection);for(const N of x){const{geometry:k,index:M,sourceLayerIndex:D}=N,q=s[M].feature;this.addFeature(N,k,M,l.availableImages,f,j,l.brightness,l.elevationFeatures),l.featureIndex.insert(q,k,M,D,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(s,l,f,m,y,x,b){this.programConfigurations.updatePaintArrays(s,l,y,f,m,x,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,qT.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,sP.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,nP.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(s,l,f,m,y,x,b,j){let N;this.elevationMode!=="none"&&(N=Jr.getElevationFeature(s,j));for(const k of l)for(const M of k){const D=M.x,q=M.y;if(D<0||D>=Zt||q<0||q>=Zt)continue;if(x){const ne=x.projectTilePoint(D,q,y),ie=x.upVector(y,D,q);this.addGlobeExtVertex(ne,ie),this.addGlobeExtVertex(ne,ie),this.addGlobeExtVertex(ne,ie),this.addGlobeExtVertex(ne,ie)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),ee=G.vertexLength;if(this.addCircleVertex(D,q,-1,-1),this.addCircleVertex(D,q,1,-1),this.addCircleVertex(D,q,1,1),this.addCircleVertex(D,q,-1,1),this.elevationMode!=="none"){const ne=N?N.pointElevation(new Rt(D,q)):0;this.hasElevation=this.hasElevation||ne!==0;for(let ie=0;ie<4;ie++)this.elevatedLayoutVertexArray.emplaceBack(ne)}this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+2,ee+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},m,y,b,void 0,this.worldview)}addCircleVertex(s,l,f,m){this.layoutVertexArray.emplaceBack(2*s+(f+1)/2,2*l+(m+1)/2)}addGlobeExtVertex(s,l){this.globeExtVertexArray.emplaceBack(s.x,s.y,s.z,l[0]*16384,l[1]*16384,l[2]*16384)}}function Vi(u,s){for(let l=0;l<u.length;l++)if(Ua(s,u[l]))return!0;for(let l=0;l<s.length;l++)if(Ua(u,s[l]))return!0;return!!nl(u,s)}function vi(u,s,l){return!!Ua(u,s)||!!xo(s,u,l)}function ki(u,s){if(u.length===1)return $c(s,u[0]);for(let l=0;l<s.length;l++){const f=s[l];for(let m=0;m<f.length;m++)if(Ua(u,f[m]))return!0}for(let l=0;l<u.length;l++)if($c(s,u[l]))return!0;for(let l=0;l<s.length;l++)if(nl(u,s[l]))return!0;return!1}function vl(u,s,l){if(u.length>1){if(nl(u,s))return!0;for(let f=0;f<s.length;f++)if(xo(s[f],u,l))return!0}for(let f=0;f<u.length;f++)if(xo(u[f],s,l))return!0;return!1}function nl(u,s){if(u.length===0||s.length===0)return!1;for(let l=0;l<u.length-1;l++){const f=u[l],m=u[l+1];for(let y=0;y<s.length-1;y++)if(yo(f,m,s[y],s[y+1]))return!0}return!1}function yo(u,s,l,f){return mn(u,l,f)!==mn(s,l,f)&&mn(u,s,l)!==mn(u,s,f)}function No(u,s,l){return(u.x-l.x)*(s.y-l.y)-(u.y-l.y)*(s.x-l.x)}function oc(u,s,l,f){const m=No(u,s,f),y=No(u,s,l);if(Math.sign(m)===Math.sign(y))return;const x=No(l,f,u),b=x+y-m;return Math.sign(x)!==Math.sign(b)?[x/(x-b),y/(y-m)]:void 0}function xo(u,s,l){const f=l*l;if(s.length===1)return u.distSqr(s[0])<f;for(let m=1;m<s.length;m++)if(lc(u,s[m-1],s[m])<f)return!0;return!1}function lc(u,s,l){const f=s.distSqr(l);if(f===0)return u.distSqr(s);const m=((u.x-s.x)*(l.x-s.x)+(u.y-s.y)*(l.y-s.y))/f;return u.distSqr(m<0?s:m>1?l:l.sub(s)._mult(m)._add(s))}function $c(u,s){let l,f,m,y=!1;for(let x=0;x<u.length;x++){l=u[x];for(let b=0,j=l.length-1;b<l.length;j=b++)f=l[b],m=l[j],f.y>s.y!=m.y>s.y&&s.x<(m.x-f.x)*(s.y-f.y)/(m.y-f.y)+f.x&&(y=!y)}return y}function Ua(u,s){let l=!1;for(let f=0,m=u.length-1;f<u.length;m=f++){const y=u[f],x=u[m];y.y>s.y!=x.y>s.y&&s.x<(x.x-y.x)*(s.y-y.y)/(x.y-y.y)+y.x&&(l=!l)}return l}function Ei(u,s,l,f,m){for(const x of u)if(s<=x.x&&l<=x.y&&f>=x.x&&m>=x.y)return!0;const y=[new Rt(s,l),new Rt(s,m),new Rt(f,m),new Rt(f,l)];if(u.length>2){for(const x of y)if(Ua(u,x))return!0}for(let x=0;x<u.length-1;x++)if(Ui(u[x],u[x+1],y))return!0;return!1}function Ui(u,s,l){const f=l[0],m=l[2];if(u.x<f.x&&s.x<f.x||u.x>m.x&&s.x>m.x||u.y<f.y&&s.y<f.y||u.y>m.y&&s.y>m.y)return!1;const y=mn(u,s,l[0]);return y!==mn(u,s,l[1])||y!==mn(u,s,l[2])||y!==mn(u,s,l[3])}function Os(u,s,l,f,m,y){let x=s.y-u.y,b=u.x-s.x;if(y=y||0){const j=x*x+b*b;if(j===0)return!0;const N=Math.sqrt(j);x/=N,b/=N}return!((l.x-u.x)*x+(l.y-u.y)*b-y<0||(f.x-u.x)*x+(f.y-u.y)*b-y<0||(m.x-u.x)*x+(m.y-u.y)*b-y<0)}function Gi(u,s,l,f,m,y,x){return!(Os(u,s,f,m,y,x)||Os(s,l,f,m,y,x)||Os(l,u,f,m,y,x)||Os(f,m,u,s,l,x)||Os(m,y,u,s,l,x)||Os(y,f,u,s,l,x))}function $a(u,s,l){const f=s.paint.get(u).value;return f.kind==="constant"?f.value:l.programConfigurations.get(s.id).getMaxValue(u)}function Ti(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function cc(u,s,l,f,m){if(!s[0]&&!s[1])return u;const y=Rt.convert(s)._mult(m);l==="viewport"&&y._rotate(-f);const x=[];for(let b=0;b<u.length;b++)x.push(u[b].sub(y));return x}function hm(u,s,l,f){const m=Rt.convert(u)._mult(f);return s==="viewport"&&m._rotate(-l),m}let Id,fm;function pm(u,s,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[u*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}hr(pi,"CircleBucket",{omit:["layers"]});class uc{constructor(s,l,f){this.z=s,this.x=l,this.y=f,this.key=dc(0,s,s,l,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}isChildOf(s){const l=this.z-s.z;return s.z===0||s.z<this.z&&s.x===this.x>>l&&s.y===this.y>>l}url(s,l){const f=function(y,x,b){var j=pm(256*y,256*(x=Math.pow(2,b)-x-1),b),N=pm(256*(y+1),256*(x+1),b);return j[0]+","+j[1]+","+N[0]+","+N[1]}(this.x,this.y,this.z),m=function(y,x,b){let j,N="";for(let k=y;k>0;k--)j=1<<k-1,N+=(x&j?1:0)+(b&j?2:0);return N}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ku{constructor(s,l){this.wrap=s,this.canonical=l,this.key=dc(s,l.z,l.z,l.x,l.y)}}class Oa{constructor(s,l,f,m,y){this.overscaledZ=s,this.wrap=l,this.canonical=new uc(f,+m,+y),this.key=l===0&&s===f?this.canonical.key:dc(l,s,f,m,y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){const l=this.canonical.z-s;return s>this.canonical.z?new Oa(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oa(s,this.wrap,s,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(s,l=!0){if(this.overscaledZ===s&&l)return this.key;if(s>this.canonical.z)return dc(this.wrap*+l,s,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-s;return dc(this.wrap*+l,s,s,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(s){if(s.wrap!==this.wrap)return!1;const l=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.z<this.canonical.z&&s.canonical.x===this.canonical.x>>l&&s.canonical.y===this.canonical.y>>l}children(s){if(this.overscaledZ>=s)return[new Oa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new Oa(l,this.wrap,l,f,m),new Oa(l,this.wrap,l,f+1,m),new Oa(l,this.wrap,l,f,m+1),new Oa(l,this.wrap,l,f+1,m+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Oa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Oa(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ku(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function dc(u,s,l,f,m){const y=1<<Math.min(l,22);let x=y*(m%y)+f%y;return u&&l<22&&(x+=y*y*((u<0?-2*u-1:2*u)%(1<<2*(22-l)))),16*(32*x+l)+(s-l)}const Lf=[u=>{let s=u.canonical.x-1,l=u.wrap;return s<0&&(s=(1<<u.canonical.z)-1,l--),new Oa(u.overscaledZ,l,u.canonical.z,s,u.canonical.y)},u=>{let s=u.canonical.x+1,l=u.wrap;return s===1<<u.canonical.z&&(s=0,l++),new Oa(u.overscaledZ,l,u.canonical.z,s,u.canonical.y)},u=>new Oa(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new Oa(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];hr(uc,"CanonicalTileID"),hr(Oa,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ZT=In([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vx}=ZT,Tte=In([{name:"a_pos_3",components:3,type:"Int16"}]);var pF=In([{name:"a_pos",type:"Int16",components:2}]);function KT(u){return u*xl/L}const jte=[new wn([S,S,S],[T,T,T]),new wn([S,S,S],[0,0,T]),new wn([0,S,S],[T,0,T]),new wn([S,0,S],[0,T,T]),new wn([0,0,S],[T,T,T])];function mF(u,s,l,f=!0){const m=St([],u._camera.position,u.worldSize),y=[s,l,1,1];sn(y,y,u.pixelMatrixInverse),xr(y,y,1/y[3]);const x=jr([],Je([],y,m)),b=u.globeMatrix,j=[b[12],b[13],b[14]],N=Je([],j,m),k=Ze(N),M=jr([],N),D=u.worldSize/(2*Math.PI),q=Br(M,x),G=Math.asin(D/k);if(G<Math.acos(q)){if(!f)return null;const mt=[],rt=[];St(mt,x,k/q),jr(rt,Je(rt,mt,N)),jr(x,$e(x,N,St(x,rt,Math.tan(G)*k)))}const ee=[];new pn(m,x).closestPointOnSphere(j,D,ee);const ne=jr([],bi(b,0)),ie=jr([],bi(b,1)),me=jr([],bi(b,2)),ye=Br(ne,ee),be=Br(ie,ee),Me=Br(me,ee),Ce=_o(Math.asin(-be/D));let Le=_o(Math.atan2(ye,Me));Le=u.center.lng+function(mt,rt){const gt=(rt-mt+180)%360-180;return gt<-180?gt+360:gt}(u.center.lng,Le);const Ve=fe(Le),He=he(de(Ce),0,1);return new et(Ve,He)}class Nte{constructor(s,l,f){this.a=Je([],s,f),this.b=Je([],l,f),this.center=f;const m=jr([],this.a),y=jr([],this.b);this.angle=Math.acos(Br(m,y))}}function fP(u,s){if(u.angle===0)return null;let l;return l=u.a[s]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[s]/u.a[s]/Math.sin(u.angle)-1/Math.tan(u.angle)),l<0||l>1?null:function(f,m,y,x){const b=Math.sin(y);return f*(Math.sin((1-x)*y)/b)+m*(Math.sin(x*y)/b)}(u.a[s],u.b[s],u.angle,he(l,0,1))+u.center[s]}function Mh(u){if(u.z<=1)return jte[u.z+2*u.y+u.x];const s=pP(XT(u));return wn.fromPoints(s)}function Ff(u,s,l){return St(u,u,1-l),Xt(u,u,s,l)}function gF(u,s,l){for(const f of u)ln(f,f,s),St(f,f,l)}function _F(u,s,l,f){const m=s/u.worldSize,y=u.globeMatrix;if(l.z<=1){const He=Mh(l).getCorners();return gF(He,y,m),wn.fromPoints(He)}const x=XT(l,f),b=pP(x,xl+KT(u._tileCoverLift));gF(b,y,m);const j=Number.MAX_VALUE,N=[-j,-j,-j],k=[j,j,j];if(x.contains(u.center)){for(const rt of b)Mt(k,k,rt),ar(N,N,rt);N[2]=0;const He=u.point,mt=[He.x*m,He.y*m,0];return Mt(k,k,mt),ar(N,N,mt),new wn(k,N)}if(u._tileCoverLift>0){for(const He of b)Mt(k,k,He),ar(N,N,He);return new wn(k,N)}const M=[y[12]*m,y[13]*m,y[14]*m],D=x.getCenter(),q=he(u.center.lat,-Te,Te),G=he(D.lat,-Te,Te),ee=fe(u.center.lng),ne=de(q);let ie=ee-fe(D.lng);const me=ne-de(G);ie>.5?ie-=1:ie<-.5&&(ie+=1);let ye=0;Math.abs(ie)>Math.abs(me)?ye=ie>=0?1:3:(ye=me>=0?0:2,Xt(M,M,[y[4]*m,y[5]*m,y[6]*m],-Math.sin(Nn(me>=0?x.getSouth():x.getNorth()))*xl));const be=b[ye],Me=b[(ye+1)%4],Ce=new Nte(be,Me,M),Le=[fP(Ce,0)||be[0],fP(Ce,1)||be[1],fP(Ce,2)||be[2]],Ve=mm(u.zoom);if(Ve>0){const He=function({x:rt,y:gt,z:bt},Ct,Gt,Ot,Et){const Dt=1/(1<<bt);let ht=rt*Dt,ut=ht+Dt,kt=gt*Dt,$t=kt+Dt,It=0;const ur=(ht+ut)/2-Ot;return ur>.5?It=-1:ur<-.5&&(It=1),ht=((ht+It)*Ct-(Ot*=Ct))*Gt+Ot,ut=((ut+It)*Ct-Ot)*Gt+Ot,kt=(kt*Ct-(Et*=Ct))*Gt+Et,$t=($t*Ct-Et)*Gt+Et,[[ht,$t,0],[ut,$t,0],[ut,kt,0],[ht,kt,0]]}(l,s,u._pixelsPerMercatorPixel,ee,ne);for(let rt=0;rt<b.length;rt++)Ff(b[rt],He[rt],Ve);const mt=$e([],He[ye],He[(ye+1)%4]);St(mt,mt,.5),Ff(Le,mt,Ve)}for(const He of b)Mt(k,k,He),ar(N,N,He);return k[2]=Math.min(be[2],Me[2]),Mt(k,k,Le),ar(N,N,Le),new wn(k,N)}function XT({x:u,y:s,z:l},f=!1){const m=1/(1<<l),y=new H(Ee(u*m),s===(1<<l)-1&&f?-90:xe((s+1)*m)),x=new H(Ee((u+1)*m),s===0&&f?90:xe(s*m));return new U(y,x)}function pP(u,s=xl){const l=Nn(u.getNorth()),f=Nn(u.getSouth()),m=Math.cos(l),y=Math.cos(f),x=Math.sin(l),b=Math.sin(f),j=u.getWest(),N=u.getEast();return[I(y,b,j,s),I(y,b,N,s),I(m,x,N,s),I(m,x,j,s)]}function Ib(u,s,l,f){const m=1<<l.z,y=(u/Zt+l.x)/m;return A(xe((s/Zt+l.y)/m),Ee(y),f)}function YT({min:u,max:s}){return h/Math.max(s[0]-u[0],s[1]-u[1],s[2]-u[2])}const yF=new Float64Array(16);function JT(u){const s=YT(u),l=ue(yF,[s,s,s]);return X(l,l,Wr([],u.min))}function mP(u){const s=(f=u.min,(l=yF)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=f[0],l[13]=f[1],l[14]=f[2],l[15]=1,l);var l,f;const m=1/YT(u);return Q(s,s,[m,m,m])}function gP(u){const s=Zt/(2*Math.PI);return u/(2*Math.PI)/s}function xF(u,s){return Zt/(512*Math.pow(2,u))*YT(Mh(s))}function vF(u,s,l,f,m){const y=gP(l),x=[u,s,-l/(2*Math.PI)],b=K(new Float64Array(16));return X(b,b,x),Q(b,b,[y,y,y]),re(b,b,Nn(-m)),ve(b,b,Nn(-f)),b}function mm(u){return Ne(g,o,u)}function wF(u,s){const l=A(s.lat,s.lng),f=function(G){const ee=A(G._center.lat,G._center.lng);let ne=on([],Xe(0,1,0),ee);const ie=ge([],-G.angle,ee);ne=ln(ne,ne,ie),ge(ie,-G._pitch,ne);const me=jr([],ee);return St(me,me,KT(G.cameraToCenterDistance/G.pixelsPerMeter)),ln(me,me,ie),$e([],ee,me)}(u);return x=(m=st([],f,l))[0],b=m[1],j=m[2],N=(y=l)[0],k=y[1],M=y[2],q=(D=Math.sqrt((x*x+b*b+j*j)*(N*N+k*k+M*M)))&&Br(m,y)/D,Math.acos(Math.min(Math.max(q,-1),1));var m,y,x,b,j,N,k,M,D,q}function _P(u,s){return wF(u,s)>Math.PI/2*1.01}const bF=Nn(85),Ite=Math.cos(bF),Cte=Math.sin(bF),Ate=V(),SF=u=>{const s=[];return u.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s};function EF(u,s,l,f,m,y,x,b,j){if(y&&u.queryGeometry.isAboveHorizon)return!1;y&&(j*=u.pixelToTileUnitsFactor);const N=u.tileID.canonical,k=l.projection.upVectorScale(N,l.center.lat,l.worldSize).metersToTile;for(const M of s)for(const D of M){const q=D.add(b),G=m&&l.elevation?l.elevation.exaggeration()*m.getElevationAt(q.x,q.y,!0):0,ee=l.projection.projectTilePoint(q.x,q.y,N);if(G>0){const ye=l.projection.upVector(N,q.x,q.y);ee.x+=ye[0]*k*G,ee.y+=ye[1]*k*G,ee.z+=ye[2]*k*G}const ne=y?q:Pte(ee.x,ee.y,ee.z,f),ie=y?u.tilespaceRays.map(ye=>Rte(ye,G)):u.queryGeometry.screenGeometry,me=sn([],[ee.x,ee.y,ee.z,1],f);if(!x&&y?j*=me[3]/l.cameraToCenterDistance:x&&!y&&(j*=l.cameraToCenterDistance/me[3]),y){const ye=xe((D.y/Zt+N.y)/(1<<N.z));j/=l.projection.pixelsPerMeter(ye,1)/_e(1,ye)}if(vi(ie,ne,j))return!0}return!1}function Pte(u,s,l,f){const m=sn([],[u,s,l,1],f);return new Rt(m[0]/m[3],m[1]/m[3])}const TF=Xe(0,0,0),kte=Xe(0,0,1);function Rte(u,s){const l=J();return TF[2]=s,u.intersectsPlane(TF,kte,l),new Rt(l[0],l[1])}class jF extends pi{}let NF,IF,CF,AF;function PF(u,{width:s,height:l},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==s*l*f)throw new RangeError("mismatched image size")}else m=new Uint8Array(s*l*f);return u.width=s,u.height=l,u.data=m,u}function kF(u,s,l){const{width:f,height:m}=s;f===u.width&&m===u.height||(yP(u,s,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,f),height:Math.min(u.height,m)},l,null),u.width=f,u.height=m,u.data=s.data)}function yP(u,s,l,f,m,y,x,b){if(m.width===0||m.height===0)return s;if(m.width>u.width||m.height>u.height||l.x>u.width-m.width||l.y>u.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>s.width||m.height>s.height||f.x>s.width-m.width||f.y>s.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const j=u.data,N=s.data,k=y===4&&b;for(let M=0;M<m.height;M++){const D=((l.y+M)*u.width+l.x)*y,q=((f.y+M)*s.width+f.x)*y;if(k)for(let G=0;G<m.width;G++){const ee=D+G*y+3,ne=q+G*y;N[ne+0]=255,N[ne+1]=255,N[ne+2]=255,N[ne+3]=j[ee]}else if(x)for(let G=0;G<m.width;G++){const ee=D+G*y,ne=q+G*y,ie=new os(j[ee+0]/255,j[ee+1]/255,j[ee+2]/255,j[ee+3]).toNonPremultipliedRenderColor(x).toArray();N[ne+0]=ie[0],N[ne+1]=ie[1],N[ne+2]=ie[2],N[ne+3]=ie[3]}else for(let G=0;G<m.width*y;G++)N[q+G]=j[D+G]}return s}hr(jF,"HeatmapBucket",{omit:["layers"]});class gm{constructor(s,l){PF(this,s,1,l)}resize(s){kF(this,new gm(s),1)}clone(){return new gm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,f,m,y){yP(s,l,f,m,y,1,null)}}class Io{constructor(s,l){PF(this,s,4,l)}resize(s){kF(this,new Io(s),4)}replace(s,l){l?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Io({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,f,m,y,x,b){yP(s,l,f,m,y,4,x,b)}}class RF{constructor(s,l){this.width=s.width,this.height=s.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function Cb(u){const s={},l=u.resolution||256,f=u.clips?u.clips.length:1,m=u.image||new Io({width:l,height:f}),y=(x,b,j)=>{s[u.evaluationKey]=j;const N=u.expression.evaluate(s),k=N?N.toNonPremultipliedRenderColor(null):null;k&&(m.data[x+b+0]=Math.floor(255*k.r),m.data[x+b+1]=Math.floor(255*k.g),m.data[x+b+2]=Math.floor(255*k.b),m.data[x+b+3]=Math.floor(255*k.a))};if(u.clips)for(let x=0,b=0;x<f;++x,b+=4*l)for(let j=0,N=0;j<l;j++,N+=4){const k=j/(l-1),{start:M,end:D}=u.clips[x];y(b,N,M*(1-k)+D*k)}else for(let x=0,b=0;x<l;x++,b+=4)y(0,b,x/(l-1));return m}hr(gm,"AlphaImage"),hr(Io,"RGBAImage");const Mte=In([{name:"a_pos",components:2,type:"Int16"}],4),Dte=In([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Ote=In([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Lte=In([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ux(u,s,l=2){const f=s&&s.length,m=f?s[0]*l:u.length;let y=MF(u,0,m,l,!0);const x=[];if(!y||y.next===y.prev)return x;let b,j,N;if(f&&(y=function(k,M,D,q){const G=[];for(let ee=0,ne=M.length;ee<ne;ee++){const ie=MF(k,M[ee]*q,ee<ne-1?M[ee+1]*q:k.length,q,!1);ie===ie.next&&(ie.steiner=!0),G.push(Gte(ie))}G.sort(Ute);for(let ee=0;ee<G.length;ee++)D=$te(G[ee],D);return D}(u,s,y,l)),u.length>80*l){b=u[0],j=u[1];let k=b,M=j;for(let D=l;D<m;D+=l){const q=u[D],G=u[D+1];q<b&&(b=q),G<j&&(j=G),q>k&&(k=q),G>M&&(M=G)}N=Math.max(k-b,M-j),N=N!==0?32767/N:0}return Ab(y,x,l,b,j,N,0),x}function MF(u,s,l,f,m){let y;if(m===function(x,b,j,N){let k=0;for(let M=b,D=j-N;M<j;M+=N)k+=(x[D]-x[M])*(x[M+1]+x[D+1]),D=M;return k}(u,s,l,f)>0)for(let x=s;x<l;x+=f)y=FF(x/f|0,u[x],u[x+1],y);else for(let x=l-f;x>=s;x-=f)y=FF(x/f|0,u[x],u[x+1],y);return y&&$x(y,y.next)&&(Rb(y),y=y.next),y}function p_(u,s){if(!u)return u;s||(s=u);let l,f=u;do if(l=!1,f.steiner||!$x(f,f.next)&&qa(f.prev,f,f.next)!==0)f=f.next;else{if(Rb(f),f=s=f.prev,f===f.next)break;l=!0}while(l||f!==s);return s}function Ab(u,s,l,f,m,y,x){if(!u)return;!x&&y&&function(j,N,k,M){let D=j;do D.z===0&&(D.z=xP(D.x,D.y,N,k,M)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==j);D.prevZ.nextZ=null,D.prevZ=null,function(q){let G,ee=1;do{let ne,ie=q;q=null;let me=null;for(G=0;ie;){G++;let ye=ie,be=0;for(let Ce=0;Ce<ee&&(be++,ye=ye.nextZ,ye);Ce++);let Me=ee;for(;be>0||Me>0&&ye;)be!==0&&(Me===0||!ye||ie.z<=ye.z)?(ne=ie,ie=ie.nextZ,be--):(ne=ye,ye=ye.nextZ,Me--),me?me.nextZ=ne:q=ne,ne.prevZ=me,me=ne;ie=ye}me.nextZ=null,ee*=2}while(G>1)}(D)}(u,f,m,y);let b=u;for(;u.prev!==u.next;){const j=u.prev,N=u.next;if(y?zte(u,f,m,y):Fte(u))s.push(j.i,u.i,N.i),Rb(u),u=N.next,b=N.next;else if((u=N)===b){x?x===1?Ab(u=Bte(p_(u),s),s,l,f,m,y,2):x===2&&Vte(u,s,l,f,m,y):Ab(p_(u),s,l,f,m,y,1);break}}}function Fte(u){const s=u.prev,l=u,f=u.next;if(qa(s,l,f)>=0)return!1;const m=s.x,y=l.x,x=f.x,b=s.y,j=l.y,N=f.y,k=Math.min(m,y,x),M=Math.min(b,j,N),D=Math.max(m,y,x),q=Math.max(b,j,N);let G=f.next;for(;G!==s;){if(G.x>=k&&G.x<=D&&G.y>=M&&G.y<=q&&Pb(m,b,y,j,x,N,G.x,G.y)&&qa(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function zte(u,s,l,f){const m=u.prev,y=u,x=u.next;if(qa(m,y,x)>=0)return!1;const b=m.x,j=y.x,N=x.x,k=m.y,M=y.y,D=x.y,q=Math.min(b,j,N),G=Math.min(k,M,D),ee=Math.max(b,j,N),ne=Math.max(k,M,D),ie=xP(q,G,s,l,f),me=xP(ee,ne,s,l,f);let ye=u.prevZ,be=u.nextZ;for(;ye&&ye.z>=ie&&be&&be.z<=me;){if(ye.x>=q&&ye.x<=ee&&ye.y>=G&&ye.y<=ne&&ye!==m&&ye!==x&&Pb(b,k,j,M,N,D,ye.x,ye.y)&&qa(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,be.x>=q&&be.x<=ee&&be.y>=G&&be.y<=ne&&be!==m&&be!==x&&Pb(b,k,j,M,N,D,be.x,be.y)&&qa(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;ye&&ye.z>=ie;){if(ye.x>=q&&ye.x<=ee&&ye.y>=G&&ye.y<=ne&&ye!==m&&ye!==x&&Pb(b,k,j,M,N,D,ye.x,ye.y)&&qa(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;be&&be.z<=me;){if(be.x>=q&&be.x<=ee&&be.y>=G&&be.y<=ne&&be!==m&&be!==x&&Pb(b,k,j,M,N,D,be.x,be.y)&&qa(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function Bte(u,s){let l=u;do{const f=l.prev,m=l.next.next;!$x(f,m)&&OF(f,l,l.next,m)&&kb(f,m)&&kb(m,f)&&(s.push(f.i,l.i,m.i),Rb(l),Rb(l.next),l=u=m),l=l.next}while(l!==u);return p_(l)}function Vte(u,s,l,f,m,y){let x=u;do{let b=x.next.next;for(;b!==x.prev;){if(x.i!==b.i&&Hte(x,b)){let j=LF(x,b);return x=p_(x,x.next),j=p_(j,j.next),Ab(x,s,l,f,m,y,0),void Ab(j,s,l,f,m,y,0)}b=b.next}x=x.next}while(x!==u)}function Ute(u,s){let l=u.x-s.x;return l===0&&(l=u.y-s.y,l===0)&&(l=(u.next.y-u.y)/(u.next.x-u.x)-(s.next.y-s.y)/(s.next.x-s.x)),l}function $te(u,s){const l=function(m,y){let x=y;const b=m.x,j=m.y;let N,k=-1/0;if($x(m,x))return x;do{if($x(m,x.next))return x.next;if(j<=x.y&&j>=x.next.y&&x.next.y!==x.y){const ee=x.x+(j-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(ee<=b&&ee>k&&(k=ee,N=x.x<x.next.x?x:x.next,ee===b))return N}x=x.next}while(x!==y);if(!N)return null;const M=N,D=N.x,q=N.y;let G=1/0;x=N;do{if(b>=x.x&&x.x>=D&&b!==x.x&&DF(j<q?b:k,j,D,q,j<q?k:b,j,x.x,x.y)){const ee=Math.abs(j-x.y)/(b-x.x);kb(x,m)&&(ee<G||ee===G&&(x.x>N.x||x.x===N.x&&qte(N,x)))&&(N=x,G=ee)}x=x.next}while(x!==M);return N}(u,s);if(!l)return s;const f=LF(l,u);return p_(f,f.next),p_(l,l.next)}function qte(u,s){return qa(u.prev,u,s.prev)<0&&qa(s.next,u,u.next)<0}function xP(u,s,l,f,m){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-l)*m|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Gte(u){let s=u,l=u;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==u);return l}function DF(u,s,l,f,m,y,x,b){return(m-x)*(s-b)>=(u-x)*(y-b)&&(u-x)*(f-b)>=(l-x)*(s-b)&&(l-x)*(y-b)>=(m-x)*(f-b)}function Pb(u,s,l,f,m,y,x,b){return!(u===x&&s===b)&&DF(u,s,l,f,m,y,x,b)}function Hte(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!function(l,f){let m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==f.i&&m.next.i!==f.i&&OF(m,m.next,l,f))return!0;m=m.next}while(m!==l);return!1}(u,s)&&(kb(u,s)&&kb(s,u)&&function(l,f){let m=l,y=!1;const x=(l.x+f.x)/2,b=(l.y+f.y)/2;do m.y>b!=m.next.y>b&&m.next.y!==m.y&&x<(m.next.x-m.x)*(b-m.y)/(m.next.y-m.y)+m.x&&(y=!y),m=m.next;while(m!==l);return y}(u,s)&&(qa(u.prev,u,s.prev)||qa(u,s.prev,s))||$x(u,s)&&qa(u.prev,u,u.next)>0&&qa(s.prev,s,s.next)>0)}function qa(u,s,l){return(s.y-u.y)*(l.x-s.x)-(s.x-u.x)*(l.y-s.y)}function $x(u,s){return u.x===s.x&&u.y===s.y}function OF(u,s,l,f){const m=e2(qa(u,s,l)),y=e2(qa(u,s,f)),x=e2(qa(l,f,u)),b=e2(qa(l,f,s));return m!==y&&x!==b||!(m!==0||!QT(u,l,s))||!(y!==0||!QT(u,f,s))||!(x!==0||!QT(l,u,f))||!(b!==0||!QT(l,s,f))}function QT(u,s,l){return s.x<=Math.max(u.x,l.x)&&s.x>=Math.min(u.x,l.x)&&s.y<=Math.max(u.y,l.y)&&s.y>=Math.min(u.y,l.y)}function e2(u){return u>0?1:u<0?-1:0}function kb(u,s){return qa(u.prev,u,u.next)<0?qa(u,s,u.next)>=0&&qa(u,u.prev,s)>=0:qa(u,s,u.prev)<0||qa(u,u.next,s)<0}function LF(u,s){const l=vP(u.i,u.x,u.y),f=vP(s.i,s.x,s.y),m=u.next,y=s.prev;return u.next=s,s.prev=u,l.next=m,m.prev=l,f.next=l,l.prev=f,y.next=f,f.prev=y,f}function FF(u,s,l,f){const m=vP(u,s,l);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function Rb(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function vP(u,s,l){return{i:u,x:s,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Mb(u,s){const l=u.length;if(l<=1)return[u];const f=[];let m,y;for(let x=0;x<l;x++){const b=yn(u[x]);b!==0&&(u[x].area=Math.abs(b),y===void 0&&(y=b<0),y===b<0?(m&&f.push(m),m=[u[x]]):m.push(u[x]))}if(m&&f.push(m),s>1)for(let x=0;x<f.length;x++)f[x].length<=s||(wd(f[x],s,1,f[x].length-1,Wte),f[x]=f[x].slice(0,s));return f}function Wte(u,s){return s.area-u.area}function zF(u,s,l=1){if(!u)return null;const f=typeof u=="string"?cs.from(u).getPrimary():u.getPrimary(),m=typeof u=="string"?null:u.getSecondary();for(const y of[f,m]){if(!y)continue;const x=y.id.toString();s.has(x)||s.set(x,[]),y.scaleSelf(l),s.get(x).push(y)}return{primary:f.toString(),secondary:m?m.toString():null}}function wP(u,s,l,f){const m=f.patternDependencies;let y=!1;for(const x of s){const b=x.paint.get(`${u}-pattern`);b.isConstant()||(y=!0),zF(b.constantOr(null),m,l)&&(y=!0)}return y}function bP(u,s,l,f,m,y){const x=y.patternDependencies;for(const b of s){const j=b.paint.get(`${u}-pattern`).value;if(j.kind!=="constant"){let N=j.evaluate({zoom:f},l,{},y.availableImages);N=N&&N.name?N.name:N;const k=zF(N,x,m);if(!k)continue;const{primary:M,secondary:D}=k;M&&(l.patterns[b.id]=[M,D].filter(Boolean))}}return l}class BF{constructor(){this.polygons=new Map}add(s,...l){const f=this.polygons.get(s);f?f.push(...l):this.polygons.set(s,l)}merge(s){for(const[l,f]of s.polygons)this.add(l,...f)}}class zf{constructor(){this.portals=[]}static isOnBorder(s,l){return s<=0&&l<=0||s>=Zt&&l>=Zt}static evaluate(s){if(s.length===0)return new zf;let l=[];for(const j of s)l.push(...j.portals);if(l.length===0)return new zf;for(const j of l){const N=j.va,k=j.vb;(zf.isOnBorder(N.x,k.x)||zf.isOnBorder(N.y,k.y))&&(j.type="border")}const f=l.filter(j=>j.type!=="unevaluated"),m=l.filter(j=>j.type==="unevaluated");if(m.length===0)return new zf;m.sort((j,N)=>j.hash===N.hash?j.isTunnel===N.isTunnel?0:j.isTunnel?-1:1:j.hash<N.hash?1:-1),l=f.concat(m);let y=f.length,x=y,b=y;do if(x++,x===l.length||l[y].hash!==l[x].hash){if(x-y==2){b<y&&(l[b]=l[y],l[y]=null);const j=l[b],N=l[x-1];j.type=j.isTunnel!==N.isTunnel?"tunnel":"polygon",j.connection={a:j.connection.a,b:N.connection.a},b++}y=x}while(y!==l.length);return l.splice(b),l.sort((j,N)=>j.hash<N.hash?1:-1),{portals:l}}}hr(zf,"ElevationPortalGraph"),hr(BF,"ElevationPolygons");class Zte{constructor(s,l,f){this.outPositions=s,this.outNormals=l,this.outIndices=f,this.vertexLookup=new Map}addVertex(s,l,f){let m=s[2];f!=null&&(m*=f);const y=`${s[0]},${s[1]},${s[2]},${l[0]},${l[1]},${l[2]}`,x=this.vertexLookup.get(y);if(x!=null)return x;const b=this.outPositions.length;this.vertexLookup.set(y,b);const j=Math.trunc(16384*l[0]),N=Math.trunc(16384*l[1]),k=Math.trunc(16384*l[2]);return this.outPositions.emplaceBack(s[0],s[1],m),this.outNormals.emplaceBack(j,N,k),b}addTriangle(s,l,f){this.outIndices.emplaceBack(s,l,f)}addTriangles(s,l,f){if(s.length===0)return;const m=f.length===1,y=J(),x=J();for(let b=0;b<s.length;b+=3){const j=l[s[b+0]],N=l[s[b+1]],k=l[s[b+2]],M=m?f[0]:f[s[b+1]],D=m?f[0]:f[s[b+2]];qe(y,j.x,j.y,m?f[0]:f[s[b+0]]);const q=this.addVertex(y,x);qe(y,N.x,N.y,M);const G=this.addVertex(y,x);qe(y,k.x,k.y,D);const ee=this.addVertex(y,x);this.outIndices.emplaceBack(q,G,ee)}}addQuad(s,l,f,m,y,x){const b=this.addVertex(s,y,x),j=this.addVertex(l,y,x),N=this.addVertex(f,y,x),k=this.addVertex(m,y,x);this.addTriangle(b,j,N),this.addTriangle(N,k,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class hc{constructor(s,l,f,m){this.unevaluatedPortals=new zf,this.portalPolygons=new BF,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new ub,this.vertexNormals=new db,this.indexArray=new ui,this.tileToMeters=Oe(s),this.bridgeProgramConfigurations=new xu(l,{zoom:f,lut:m},y=>y!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new xu(l,{zoom:f,lut:m},y=>y!=="fill-bridge-guard-rail-color")}addVertices(s,l){const f=this.unevalVertices.length;for(let m=0;m<s.length;m++)this.unevalVertices.push(s[m]),this.unevalHeights.push(l[m]);return f}addTriangles(s,l,f){const m=f?this.unevalTunnelTriangles:this.unevalTriangles;for(const y of s)m.push(y+l)}addRenderableRing(s,l,f,m,y,x){const b=[new Rt(y.min.x,y.min.y),new Rt(y.max.x,y.min.y),new Rt(y.max.x,y.max.y),new Rt(y.min.x,y.max.y)];for(let j=0;j<f-1;j++){const N=l+j,k=N+1,M=this.unevalVertices[N],D=this.unevalVertices[k];if(!(M.x>=y.min.x&&M.x<=y.max.x&&M.y>=y.min.y&&M.y<=y.max.y||D.x>=y.min.x&&D.x<=y.max.x&&D.y>=y.min.y&&D.y<=y.max.y||Ui(M,D,b))||this.isOnBorder(M.x,D.x)||this.isOnBorder(M.y,D.y))continue;const q=hc.computeEdgeHash(this.unevalVertices[N],this.unevalVertices[k]);let G,ee=this.vertexHashLookup.get(hc.computePosHash(M));ee!=null?G=ee.next:(ee=this.vertexHashLookup.get(hc.computePosHash(D)),G=ee!=null?ee.prev:q),this.unevalEdges.push({polygonIdx:s,a:N,b:k,hash:q,portalHash:G,isTunnel:m,type:"unevaluated",featureInfo:x})}}addPortalCandidates(s,l,f,m,y){if(l.length===0)return;this.portalPolygons.add(s,{geometry:l,zLevel:y});const x=l[0];this.vertexHashLookup.clear();let b=hc.computeEdgeHash(x[x.length-2],x[x.length-1]);for(let j=0;j<x.length-1;j++){const N=x[j+0],k=x[j+1],M=Pl(k.x-N.x,k.y-N.y),D=oi(M);if(D===0)continue;let q="unevaluated";const G=m.pointElevation(N),ee=m.pointElevation(k);Math.abs(G)<.01&&Math.abs(ee)<.01?q="entrance":(this.isOnBorder(N.x,k.x)||this.isOnBorder(N.y,k.y))&&(q="border");const ne=hc.computeEdgeHash(N,k);this.unevaluatedPortals.portals.push({connection:{a:s,b:void 0},va:N,vb:k,vab:M,length:D,hash:ne,isTunnel:f,type:q});const ie=hc.computePosHash(N);this.vertexHashLookup.set(ie,{prev:b,next:ne}),b=ne}}construct(s){if(this.unevalVertices.length===0)return;const l=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),f=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},m=new Zte(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(s.portals,this.unevalEdges);const y=l(),x=l(),b=l(),j=(D,q)=>{D.sort((ee,ne)=>ee.type===q&&ne.type!==q?-1:ee.type!==q&&ne.type===q?1:0);const G=D.findIndex(ee=>ee.type!==q);return G>=0?G:D.length};let N=0;this.unevalEdges.length>0&&(N=j(this.unevalEdges,"none"),this.constructBridgeStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},this.tileToMeters)),f(b);const k=l(),M=l();if(this.unevalEdges.length>0){const D=this.unevalEdges.splice(N),q=j(D,"tunnel")+N;this.unevalEdges.push(...D),this.constructTunnelStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},{min:N,max:q})}f(k),m.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),f(M),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),f(x),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),f(y),this.maskSegments=xi.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.depthSegments=xi.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableBridgeSegments=xi.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=xi.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.shadowCasterSegments=xi.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength)}update(s,l,f,m,y,x,b,j){this.bridgeProgramConfigurations.updatePaintArrays(s,l,y,f,m,x,b,j),this.tunnelProgramConfigurations.updatePaintArrays(s,l,y,f,m,x,b,j)}upload(s){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=s.createVertexBuffer(this.vertexPositions,Ote.members),this.vertexBufferNormal=s.createVertexBuffer(this.vertexNormals,Lte.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(s),this.tunnelProgramConfigurations.upload(s))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(s,l,f,m,y){const x=(b,j)=>{for(let N=0;N<j.length-1;N++){const k=j[N].featureIndex,M=j[N+1].vertexStart,D=s.feature(k);b.populatePaintArrays(M,D,k,{},f,l,m,void 0,y)}};x(this.bridgeProgramConfigurations,this.bridgeFeatureSections),x(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(s,l,f,m,y){const x=new Map;for(let b=m;b<y;b++){const j=f[b],N=j.a,k=j.b,M=hc.computePosHash(s[N]),D=hc.computePosHash(s[k]);let q=x.get(M);q||(q={},x.set(M,q));let G=x.get(D);G||(G={},x.set(D,G)),l[N]<=0&&l[k]<=0||(q.to=k,G.from=N)}return x}isTerminalVertex(s,l){const f=hc.computePosHash(this.unevalVertices[s]),m=l.get(f);return!m||!m.from||!m.to}constructBridgeStructures(s,l,f,m,y,x){s.clearVertexLookup();const b=this.computeVertexConnections(l,f,m,y.min,y.max),j=1/x,N=.5*j,k=(Gt,Ot)=>qe(Gt,l[Ot].x,l[Ot].y,f[Ot]*j),M=J(),D=J(),q=J(),G=J(),ee=J(),ne=(Gt,Ot)=>{const Et=b.get(hc.computePosHash(l[Ot])),Dt=Et.from,ht=Et.to;if(!Dt||!ht)return;k(M,Dt),k(D,Ot),k(q,ht),nn(G),Ln(M,D)||(Je(ee,D,M),jr(G,ee)),Ln(q,D)||(Je(ee,q,D),$e(G,G,jr(ee,ee)));const ut=Ft(G);return ut>0?St(Gt,G,1/ut):void 0};let ie=Number.POSITIVE_INFINITY;this.sortSubarray(m,y.min,y.max,(Gt,Ot)=>Gt.featureInfo.featureIndex-Ot.featureInfo.featureIndex);const me=J(),ye=J(),be=J(),Me=J(),Ce=J(),Le=J(),Ve=J(),He=J(),mt=J(),rt=[J(),J(),J(),J()],gt=[J(),J(),J(),J()],bt=[{coord:new Rt(0,0),height:0},{coord:new Rt(0,0),height:0}],Ct=(Gt,Ot)=>Gt>Ot;for(let Gt=y.min;Gt<y.max;Gt++){const Ot=m[Gt];if(!Ot.featureInfo.guardRailEnabled||!this.prepareEdgePoints(bt,l,f,Ot,Ct))continue;const[Et,Dt]=bt;if(qe(me,Et.coord.x,Et.coord.y,j*Et.height),qe(ye,Dt.coord.x,Dt.coord.y,j*Dt.height),Ln(me,ye))continue;Je(be,ye,me),jr(be,be);const ht=ne(He,Ot.a)||be,ut=ne(mt,Ot.b)||be;qe(Me,ht[1],-ht[0],0),jr(Me,Me),qe(Ce,ut[1],-ut[0],0),jr(Ce,Ce),on(He,Me,ht),jr(Le,He),on(He,Ce,ut),jr(Ve,He),$e(rt[0],me,St(He,Je(He,Me,Le),N)),$e(rt[1],me,St(He,$e(He,Me,Le),N)),$e(rt[2],me,St(He,Le,N)),rt[3]=me,$e(gt[0],ye,St(He,Je(He,Ce,Ve),N)),$e(gt[1],ye,St(He,$e(He,Ce,Ve),N)),$e(gt[2],ye,St(He,Ve,N)),gt[3]=ye,ie=this.addFeatureSection(Ot.featureInfo.featureIndex,ie,this.bridgeFeatureSections,s);const kt=s.addVertex(rt[0],Me,x),$t=s.addVertex(rt[1],Me,x),It=s.addVertex(gt[0],Ce,x),ur=s.addVertex(gt[1],Ce,x);s.addTriangle(kt,$t,It),s.addTriangle($t,ur,It);const _r=s.addVertex(rt[1],Le,x),ir=s.addVertex(rt[2],Le,x),Jt=s.addVertex(gt[1],Ve,x),Qr=s.addVertex(gt[2],Ve,x);s.addTriangle(_r,ir,Jt),s.addTriangle(ir,Qr,Jt),Wr(Me,Me),Wr(Ce,Ce);const tr=s.addVertex(rt[2],Me,x),Pr=s.addVertex(rt[3],Me,x),an=s.addVertex(gt[2],Ce,x),Sn=s.addVertex(gt[3],Ce,x);s.addTriangle(tr,Pr,an),s.addTriangle(Pr,Sn,an);const Hn=this.isTerminalVertex(Ot.a,b),cn=this.isTerminalVertex(Ot.b,b);Et.height<.01&&Hn&&s.addQuad(rt[3],rt[2],rt[1],rt[0],Wr(ht,ht),x),Dt.height<.01&&cn&&s.addQuad(gt[0],gt[1],gt[2],gt[3],ut,x)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}constructTunnelStructures(s,l,f,m,y,x){s.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const j=(ie,me)=>ie.featureInfo.featureIndex-me.featureInfo.featureIndex;this.sortSubarray(m,y.min,y.max,j),this.sortSubarray(m,x.min,x.max,j);const N=ie=>jr(ie,ie),k=[{coord:new Rt(0,0),height:0},{coord:new Rt(0,0),height:0}],M=(ie,me)=>ie<me,D=J(),q=J(),G=J(),ee=J(),ne=J();for(let ie=y.min;ie<y.max;ie++){if(!this.prepareEdgePoints(k,l,f,m[ie],M))continue;const[me,ye]=k,be=N(qe(ne,-(ye.coord.y-me.coord.y),ye.coord.x-me.coord.x,0));b=this.addFeatureSection(m[ie].featureInfo.featureIndex,b,this.tunnelFeatureSections,s),s.addQuad(qe(D,me.coord.x,me.coord.y,me.height),qe(q,ye.coord.x,ye.coord.y,ye.height),qe(G,ye.coord.x,ye.coord.y,m[ie].isTunnel?-.1:0),qe(ee,me.coord.x,me.coord.y,m[ie].isTunnel?-.1:0),be)}for(let ie=x.min;ie<x.max;ie++){const me=m[ie];me.isTunnel&&([me.a,me.b]=[me.b,me.a]);const ye=l[me.a],be=l[me.b],Me=N(qe(ne,-(be.y-ye.y),be.x-ye.x,0));b=this.addFeatureSection(me.featureInfo.featureIndex,b,this.tunnelFeatureSections,s),s.addQuad(qe(D,be.x,be.y,0),qe(q,ye.x,ye.y,0),qe(G,ye.x,ye.y,f[me.a]+4),qe(ee,be.x,be.y,f[me.b]+4),Me),s.addQuad(qe(D,ye.x,ye.y,0),qe(q,be.x,be.y,0),qe(G,be.x,be.y,f[me.b]+4),qe(ee,ye.x,ye.y,f[me.a]+4),Me)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}setElevatedPoint(s,l,f,m){s.coord.x=l,s.coord.y=f,s.height=m}prepareEdgePoints(s,l,f,m,y){let x=l[m.a].x,b=l[m.a].y,j=l[m.b].x,N=l[m.b].y,k=f[m.a],M=f[m.b];const D=y(k,0),q=y(M,0);if(D&&q)return this.setElevatedPoint(s[0],x,b,k),this.setElevatedPoint(s[1],j,N,M),!0;if(!D&&!q)return!1;if(D){if(!q){const G=M/(M-k);j=Ur(j,x,G),N=Ur(N,b,G),M=Ur(M,k,G)}}else{const G=k/(k-M);x=Ur(x,j,G),b=Ur(b,N,G),k=Ur(k,M,G)}return this.setElevatedPoint(s[0],x,b,k),this.setElevatedPoint(s[1],j,N,M),!0}prepareEdges(s,l){if(l.length===0)return;l.sort((b,j)=>b.hash===j.hash?j.polygonIdx-b.polygonIdx:j.hash>b.hash?1:-1);let f=0,m=0,y=0,x=l[f].polygonIdx;do m++,(m===l.length||l[f].hash!==l[m].hash)&&((m-f==1||l[m-1].polygonIdx!==x)&&(y<f&&(l[y]=l[f],l[f]=null),l[y].type="none",y++),f=m,f!==l.length&&(x=l[f].polygonIdx));while(f!==l.length);if(l.splice(y),l.length!==0&&s.length!==0){l.sort((N,k)=>N.portalHash<k.portalHash?1:-1);let b=0,j=0;for(;b!==l.length&&j!==s.length;){const N=l[b],k=s[j];N.portalHash>k.hash?b++:k.hash>N.portalHash?j++:(N.type=k.type,b++)}}}isOnBorder(s,l){return s<=0&&l<=0||s>=Zt&&l>=Zt}addFeatureSection(s,l,f,m){return s!==l&&(l=s,f.push({featureIndex:s,vertexStart:m.getVertexCount()}),m.clearVertexLookup()),l}sortSubarray(s,l,f,m){const y=s.slice(l,f);y.sort(m),s.splice(l,y.length,...y)}static computeEdgeHash(s,l){return(s.y===l.y&&s.x>l.x||s.y>l.y)&&([s,l]=[l,s]),BigInt(hc.computePosHash(s))<<32n|BigInt(hc.computePosHash(l))}static computePosHash(s){return((65535&s.x)<<16|65535&s.y)>>>0}}var VF,UF={exports:{}},$F=(VF||(VF=1,function(u,s){(function(l){function f(Ae,je){return Ae>je?1:Ae<je?-1:0}var m=function(Ae,je){Ae===void 0&&(Ae=f),je===void 0&&(je=!1),this._compare=Ae,this._root=null,this._size=0,this._noDuplicates=!!je},y={size:{configurable:!0}};function x(Ae,je,_t,Yt,yt){var er=yt-Yt;if(er>0){var Er=Yt+Math.floor(er/2),Sr={key:je[Er],data:_t[Er],parent:Ae};return Sr.left=x(Sr,je,_t,Yt,Er),Sr.right=x(Sr,je,_t,Er+1,yt),Sr}return null}function b(Ae,je,_t,Yt,yt){if(!(_t>=Yt)){for(var er=Ae[_t+Yt>>1],Er=_t-1,Sr=Yt+1;;){do Er++;while(yt(Ae[Er],er)<0);do Sr--;while(yt(Ae[Sr],er)>0);if(Er>=Sr)break;var un=Ae[Er];Ae[Er]=Ae[Sr],Ae[Sr]=un,un=je[Er],je[Er]=je[Sr],je[Sr]=un}b(Ae,je,_t,Sr,yt),b(Ae,je,Sr+1,Yt,yt)}}m.prototype.rotateLeft=function(Ae){var je=Ae.right;je&&(Ae.right=je.left,je.left&&(je.left.parent=Ae),je.parent=Ae.parent),Ae.parent?Ae===Ae.parent.left?Ae.parent.left=je:Ae.parent.right=je:this._root=je,je&&(je.left=Ae),Ae.parent=je},m.prototype.rotateRight=function(Ae){var je=Ae.left;je&&(Ae.left=je.right,je.right&&(je.right.parent=Ae),je.parent=Ae.parent),Ae.parent?Ae===Ae.parent.left?Ae.parent.left=je:Ae.parent.right=je:this._root=je,je&&(je.right=Ae),Ae.parent=je},m.prototype._splay=function(Ae){for(;Ae.parent;){var je=Ae.parent;je.parent?je.left===Ae&&je.parent.left===je?(this.rotateRight(je.parent),this.rotateRight(je)):je.right===Ae&&je.parent.right===je?(this.rotateLeft(je.parent),this.rotateLeft(je)):je.left===Ae&&je.parent.right===je?(this.rotateRight(je),this.rotateLeft(je)):(this.rotateLeft(je),this.rotateRight(je)):je.left===Ae?this.rotateRight(je):this.rotateLeft(je)}},m.prototype.splay=function(Ae){for(var je,_t,Yt,yt,er;Ae.parent;)(_t=(je=Ae.parent).parent)&&_t.parent?((Yt=_t.parent).left===_t?Yt.left=Ae:Yt.right=Ae,Ae.parent=Yt):(Ae.parent=null,this._root=Ae),yt=Ae.left,er=Ae.right,Ae===je.left?(_t&&(_t.left===je?(je.right?(_t.left=je.right,_t.left.parent=_t):_t.left=null,je.right=_t,_t.parent=je):(yt?(_t.right=yt,yt.parent=_t):_t.right=null,Ae.left=_t,_t.parent=Ae)),er?(je.left=er,er.parent=je):je.left=null,Ae.right=je,je.parent=Ae):(_t&&(_t.right===je?(je.left?(_t.right=je.left,_t.right.parent=_t):_t.right=null,je.left=_t,_t.parent=je):(er?(_t.left=er,er.parent=_t):_t.left=null,Ae.right=_t,_t.parent=Ae)),yt?(je.right=yt,yt.parent=je):je.right=null,Ae.left=je,je.parent=Ae)},m.prototype.replace=function(Ae,je){Ae.parent?Ae===Ae.parent.left?Ae.parent.left=je:Ae.parent.right=je:this._root=je,je&&(je.parent=Ae.parent)},m.prototype.minNode=function(Ae){if(Ae===void 0&&(Ae=this._root),Ae)for(;Ae.left;)Ae=Ae.left;return Ae},m.prototype.maxNode=function(Ae){if(Ae===void 0&&(Ae=this._root),Ae)for(;Ae.right;)Ae=Ae.right;return Ae},m.prototype.insert=function(Ae,je){var _t=this._root,Yt=null,yt=this._compare;if(this._noDuplicates)for(;_t;){if(Yt=_t,yt(_t.key,Ae)===0)return;_t=yt(_t.key,Ae)<0?_t.right:_t.left}else for(;_t;)Yt=_t,_t=yt(_t.key,Ae)<0?_t.right:_t.left;return _t={key:Ae,data:je,left:null,right:null,parent:Yt},Yt?yt(Yt.key,_t.key)<0?Yt.right=_t:Yt.left=_t:this._root=_t,this.splay(_t),this._size++,_t},m.prototype.find=function(Ae){for(var je=this._root,_t=this._compare;je;){var Yt=_t(je.key,Ae);if(Yt<0)je=je.right;else{if(!(Yt>0))return je;je=je.left}}return null},m.prototype.contains=function(Ae){for(var je=this._root,_t=this._compare;je;){var Yt=_t(Ae,je.key);if(Yt===0)return!0;je=Yt<0?je.left:je.right}return!1},m.prototype.remove=function(Ae){var je=this.find(Ae);if(!je)return!1;if(this.splay(je),je.left)if(je.right){var _t=this.minNode(je.right);_t.parent!==je&&(this.replace(_t,_t.right),_t.right=je.right,_t.right.parent=_t),this.replace(je,_t),_t.left=je.left,_t.left.parent=_t}else this.replace(je,je.left);else this.replace(je,je.right);return this._size--,!0},m.prototype.removeNode=function(Ae){if(!Ae)return!1;if(this.splay(Ae),Ae.left)if(Ae.right){var je=this.minNode(Ae.right);je.parent!==Ae&&(this.replace(je,je.right),je.right=Ae.right,je.right.parent=je),this.replace(Ae,je),je.left=Ae.left,je.left.parent=je}else this.replace(Ae,Ae.left);else this.replace(Ae,Ae.right);return this._size--,!0},m.prototype.erase=function(Ae){var je=this.find(Ae);if(je){this.splay(je);var _t=je.left,Yt=je.right,yt=null;_t&&(_t.parent=null,yt=this.maxNode(_t),this.splay(yt),this._root=yt),Yt&&(_t?yt.right=Yt:this._root=Yt,Yt.parent=yt),this._size--}},m.prototype.pop=function(){var Ae=this._root,je=null;if(Ae){for(;Ae.left;)Ae=Ae.left;je={key:Ae.key,data:Ae.data},this.remove(Ae.key)}return je},m.prototype.next=function(Ae){var je=Ae;if(je)if(je.right)for(je=je.right;je&&je.left;)je=je.left;else for(je=Ae.parent;je&&je.right===Ae;)Ae=je,je=je.parent;return je},m.prototype.prev=function(Ae){var je=Ae;if(je)if(je.left)for(je=je.left;je&&je.right;)je=je.right;else for(je=Ae.parent;je&&je.left===Ae;)Ae=je,je=je.parent;return je},m.prototype.forEach=function(Ae){for(var je=this._root,_t=[],Yt=!1,yt=0;!Yt;)je?(_t.push(je),je=je.left):_t.length>0?(Ae(je=_t.pop(),yt++),je=je.right):Yt=!0;return this},m.prototype.range=function(Ae,je,_t,Yt){for(var yt=[],er=this._compare,Er=this._root;yt.length!==0||Er;)if(Er)yt.push(Er),Er=Er.left;else{if(er((Er=yt.pop()).key,je)>0)break;if(er(Er.key,Ae)>=0&&_t.call(Yt,Er))return this;Er=Er.right}return this},m.prototype.keys=function(){for(var Ae=this._root,je=[],_t=[],Yt=!1;!Yt;)Ae?(je.push(Ae),Ae=Ae.left):je.length>0?(Ae=je.pop(),_t.push(Ae.key),Ae=Ae.right):Yt=!0;return _t},m.prototype.values=function(){for(var Ae=this._root,je=[],_t=[],Yt=!1;!Yt;)Ae?(je.push(Ae),Ae=Ae.left):je.length>0?(Ae=je.pop(),_t.push(Ae.data),Ae=Ae.right):Yt=!0;return _t},m.prototype.at=function(Ae){for(var je=this._root,_t=[],Yt=!1,yt=0;!Yt;)if(je)_t.push(je),je=je.left;else if(_t.length>0){if(je=_t.pop(),yt===Ae)return je;yt++,je=je.right}else Yt=!0;return null},m.prototype.load=function(Ae,je,_t){if(Ae===void 0&&(Ae=[]),je===void 0&&(je=[]),_t===void 0&&(_t=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Yt=Ae.length;return _t&&b(Ae,je,0,Yt-1,this._compare),this._root=x(null,Ae,je,0,Yt),this._size=Yt,this},m.prototype.min=function(){var Ae=this.minNode(this._root);return Ae?Ae.key:null},m.prototype.max=function(){var Ae=this.maxNode(this._root);return Ae?Ae.key:null},m.prototype.isEmpty=function(){return this._root===null},y.size.get=function(){return this._size},m.createTree=function(Ae,je,_t,Yt,yt){return new m(_t,yt).load(Ae,je,Yt)},Object.defineProperties(m.prototype,y);var j=0,N=1,k=2,M=3,D=0,q=1,G=2,ee=3;function ne(Ae,je,_t){je===null?(Ae.inOut=!1,Ae.otherInOut=!0):(Ae.isSubject===je.isSubject?(Ae.inOut=!je.inOut,Ae.otherInOut=je.otherInOut):(Ae.inOut=!je.otherInOut,Ae.otherInOut=je.isVertical()?!je.inOut:je.inOut),je&&(Ae.prevInResult=!ie(je,_t)||je.isVertical()?je.prevInResult:je));var Yt=ie(Ae,_t);Ae.resultTransition=Yt?function(yt,er){var Er,Sr=!yt.inOut,un=!yt.otherInOut;switch(er){case D:Er=Sr&&un;break;case q:Er=Sr||un;break;case ee:Er=Sr^un;break;case G:Er=yt.isSubject?Sr&&!un:un&&!Sr}return Er?1:-1}(Ae,_t):0}function ie(Ae,je){switch(Ae.type){case j:switch(je){case D:return!Ae.otherInOut;case q:return Ae.otherInOut;case G:return Ae.isSubject&&Ae.otherInOut||!Ae.isSubject&&!Ae.otherInOut;case ee:return!0}break;case k:return je===D||je===q;case M:return je===G;case N:return!1}return!1}var me=function(Ae,je,_t,Yt,yt){this.left=je,this.point=Ae,this.otherEvent=_t,this.isSubject=Yt,this.type=yt||j,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ye={inResult:{configurable:!0}};function be(Ae,je){return Ae[0]===je[0]&&Ae[1]===je[1]}me.prototype.isBelow=function(Ae){var je=this.point,_t=this.otherEvent.point;return this.left?(je[0]-Ae[0])*(_t[1]-Ae[1])-(_t[0]-Ae[0])*(je[1]-Ae[1])>0:(_t[0]-Ae[0])*(je[1]-Ae[1])-(je[0]-Ae[0])*(_t[1]-Ae[1])>0},me.prototype.isAbove=function(Ae){return!this.isBelow(Ae)},me.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ye.inResult.get=function(){return this.resultTransition!==0},me.prototype.clone=function(){var Ae=new me(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ae.contourId=this.contourId,Ae.resultTransition=this.resultTransition,Ae.prevInResult=this.prevInResult,Ae.isExteriorRing=this.isExteriorRing,Ae.inOut=this.inOut,Ae.otherInOut=this.otherInOut,Ae},Object.defineProperties(me.prototype,ye);var Me=11102230246251565e-32,Ce=134217729,Le=(3+8*Me)*Me;function Ve(Ae,je,_t,Yt,yt){var er,Er,Sr,un,$r=je[0],vr=Yt[0],Qn=0,As=0;vr>$r==vr>-$r?(er=$r,$r=je[++Qn]):(er=vr,vr=Yt[++As]);var Hr=0;if(Qn<Ae&&As<_t)for(vr>$r==vr>-$r?(Sr=er-((Er=$r+er)-$r),$r=je[++Qn]):(Sr=er-((Er=vr+er)-vr),vr=Yt[++As]),er=Er,Sr!==0&&(yt[Hr++]=Sr);Qn<Ae&&As<_t;)vr>$r==vr>-$r?(Sr=er-((Er=er+$r)-(un=Er-er))+($r-un),$r=je[++Qn]):(Sr=er-((Er=er+vr)-(un=Er-er))+(vr-un),vr=Yt[++As]),er=Er,Sr!==0&&(yt[Hr++]=Sr);for(;Qn<Ae;)Sr=er-((Er=er+$r)-(un=Er-er))+($r-un),$r=je[++Qn],er=Er,Sr!==0&&(yt[Hr++]=Sr);for(;As<_t;)Sr=er-((Er=er+vr)-(un=Er-er))+(vr-un),vr=Yt[++As],er=Er,Sr!==0&&(yt[Hr++]=Sr);return er===0&&Hr!==0||(yt[Hr++]=er),Hr}function He(Ae){return new Float64Array(Ae)}var mt=33306690738754716e-32,rt=22204460492503146e-32,gt=11093356479670487e-47,bt=He(4),Ct=He(8),Gt=He(12),Ot=He(16),Et=He(4);function Dt(Ae,je,_t){var Yt=function(yt,er,Er,Sr,un,$r){var vr=(er-$r)*(Er-un),Qn=(yt-un)*(Sr-$r),As=vr-Qn;if(vr===0||Qn===0||vr>0!=Qn>0)return As;var Hr=Math.abs(vr+Qn);return Math.abs(As)>=mt*Hr?As:-function(qn,Ps,xs,ji,ri,Hs,Ts){var ns,dn,ss,Ws,qr,Wn,ni,Di,Hi,ma,si,ha,Ol,fa,pc,Co,wu,Ll,mc=qn-ri,Ao=xs-ri,gc=Ps-Hs,bu=ji-Hs;bt[0]=(pc=(Di=mc-(ni=(Wn=Ce*mc)-(Wn-mc)))*(ma=bu-(Hi=(Wn=Ce*bu)-(Wn-bu)))-((fa=mc*bu)-ni*Hi-Di*Hi-ni*ma))-((si=pc-(wu=(Di=gc-(ni=(Wn=Ce*gc)-(Wn-gc)))*(ma=Ao-(Hi=(Wn=Ce*Ao)-(Wn-Ao)))-((Co=gc*Ao)-ni*Hi-Di*Hi-ni*ma)))+(qr=pc-si))+(qr-wu),bt[1]=(Ol=fa-((ha=fa+si)-(qr=ha-fa))+(si-qr))-((si=Ol-Co)+(qr=Ol-si))+(qr-Co),bt[2]=ha-((Ll=ha+si)-(qr=Ll-ha))+(si-qr),bt[3]=Ll;var uo=function(bm,Fh){for(var $2=Fh[0],lv=1;lv<4;lv++)$2+=Fh[lv];return $2}(0,bt),sl=rt*Ts;if(uo>=sl||-uo>=sl||(ns=qn-(mc+(qr=qn-mc))+(qr-ri),ss=xs-(Ao+(qr=xs-Ao))+(qr-ri),dn=Ps-(gc+(qr=Ps-gc))+(qr-Hs),Ws=ji-(bu+(qr=ji-bu))+(qr-Hs),ns===0&&dn===0&&ss===0&&Ws===0)||(sl=gt*Ts+Le*Math.abs(uo),(uo+=mc*Ws+bu*ns-(gc*ss+Ao*dn))>=sl||-uo>=sl))return uo;Et[0]=(pc=(Di=ns-(ni=(Wn=Ce*ns)-(Wn-ns)))*(ma=bu-(Hi=(Wn=Ce*bu)-(Wn-bu)))-((fa=ns*bu)-ni*Hi-Di*Hi-ni*ma))-((si=pc-(wu=(Di=dn-(ni=(Wn=Ce*dn)-(Wn-dn)))*(ma=Ao-(Hi=(Wn=Ce*Ao)-(Wn-Ao)))-((Co=dn*Ao)-ni*Hi-Di*Hi-ni*ma)))+(qr=pc-si))+(qr-wu),Et[1]=(Ol=fa-((ha=fa+si)-(qr=ha-fa))+(si-qr))-((si=Ol-Co)+(qr=Ol-si))+(qr-Co),Et[2]=ha-((Ll=ha+si)-(qr=Ll-ha))+(si-qr),Et[3]=Ll;var Lh=Ve(4,bt,4,Et,Ct);Et[0]=(pc=(Di=mc-(ni=(Wn=Ce*mc)-(Wn-mc)))*(ma=Ws-(Hi=(Wn=Ce*Ws)-(Wn-Ws)))-((fa=mc*Ws)-ni*Hi-Di*Hi-ni*ma))-((si=pc-(wu=(Di=gc-(ni=(Wn=Ce*gc)-(Wn-gc)))*(ma=ss-(Hi=(Wn=Ce*ss)-(Wn-ss)))-((Co=gc*ss)-ni*Hi-Di*Hi-ni*ma)))+(qr=pc-si))+(qr-wu),Et[1]=(Ol=fa-((ha=fa+si)-(qr=ha-fa))+(si-qr))-((si=Ol-Co)+(qr=Ol-si))+(qr-Co),Et[2]=ha-((Ll=ha+si)-(qr=Ll-ha))+(si-qr),Et[3]=Ll;var wm=Ve(Lh,Ct,4,Et,Gt);Et[0]=(pc=(Di=ns-(ni=(Wn=Ce*ns)-(Wn-ns)))*(ma=Ws-(Hi=(Wn=Ce*Ws)-(Wn-Ws)))-((fa=ns*Ws)-ni*Hi-Di*Hi-ni*ma))-((si=pc-(wu=(Di=dn-(ni=(Wn=Ce*dn)-(Wn-dn)))*(ma=ss-(Hi=(Wn=Ce*ss)-(Wn-ss)))-((Co=dn*ss)-ni*Hi-Di*Hi-ni*ma)))+(qr=pc-si))+(qr-wu),Et[1]=(Ol=fa-((ha=fa+si)-(qr=ha-fa))+(si-qr))-((si=Ol-Co)+(qr=Ol-si))+(qr-Co),Et[2]=ha-((Ll=ha+si)-(qr=Ll-ha))+(si-qr),Et[3]=Ll;var ov=Ve(wm,Gt,4,Et,Ot);return Ot[ov-1]}(yt,er,Er,Sr,un,$r,Hr)}(Ae[0],Ae[1],je[0],je[1],_t[0],_t[1]);return Yt>0?-1:Yt<0?1:0}function ht(Ae,je){var _t=Ae.point,Yt=je.point;return _t[0]>Yt[0]?1:_t[0]<Yt[0]?-1:_t[1]!==Yt[1]?_t[1]>Yt[1]?1:-1:function(yt,er,Er,Sr){return yt.left!==er.left?yt.left?1:-1:Dt(Er,yt.otherEvent.point,er.otherEvent.point)!==0?yt.isBelow(er.otherEvent.point)?-1:1:!yt.isSubject&&er.isSubject?1:-1}(Ae,je,_t)}function ut(Ae,je,_t){var Yt=new me(je,!1,Ae,Ae.isSubject),yt=new me(je,!0,Ae.otherEvent,Ae.isSubject);return be(Ae.point,Ae.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ae),Yt.contourId=yt.contourId=Ae.contourId,ht(yt,Ae.otherEvent)>0&&(Ae.otherEvent.left=!0,yt.left=!1),Ae.otherEvent.otherEvent=yt,Ae.otherEvent=Yt,_t.push(yt),_t.push(Yt),_t}function kt(Ae,je){return Ae[0]*je[1]-Ae[1]*je[0]}function $t(Ae,je){return Ae[0]*je[0]+Ae[1]*je[1]}function It(Ae,je,_t){var Yt=function(un,$r,vr,Qn,As){var Hr=[$r[0]-un[0],$r[1]-un[1]],qn=[Qn[0]-vr[0],Qn[1]-vr[1]];function Ps(Wn,ni,Di){return[Wn[0]+ni*Di[0],Wn[1]+ni*Di[1]]}var xs=[vr[0]-un[0],vr[1]-un[1]],ji=kt(Hr,qn),ri=ji*ji,Hs=$t(Hr,Hr);if(ri>0){var Ts=kt(xs,qn)/ji;if(Ts<0||Ts>1)return null;var ns=kt(xs,Hr)/ji;return ns<0||ns>1?null:Ts===0||Ts===1?[Ps(un,Ts,Hr)]:ns===0||ns===1?[Ps(vr,ns,qn)]:[Ps(un,Ts,Hr)]}if((ri=(ji=kt(xs,Hr))*ji)>0)return null;var dn=$t(Hr,xs)/Hs,ss=dn+$t(Hr,qn)/Hs,Ws=Math.min(dn,ss),qr=Math.max(dn,ss);return Ws<=1&&qr>=0?Ws===1?[Ps(un,Ws>0?Ws:0,Hr)]:qr===0?[Ps(un,qr<1?qr:1,Hr)]:[Ps(un,Ws>0?Ws:0,Hr),Ps(un,qr<1?qr:1,Hr)]:null}(Ae.point,Ae.otherEvent.point,je.point,je.otherEvent.point),yt=Yt?Yt.length:0;if(yt===0||yt===1&&(be(Ae.point,je.point)||be(Ae.otherEvent.point,je.otherEvent.point))||yt===2&&Ae.isSubject===je.isSubject)return 0;if(yt===1)return be(Ae.point,Yt[0])||be(Ae.otherEvent.point,Yt[0])||ut(Ae,Yt[0],_t),be(je.point,Yt[0])||be(je.otherEvent.point,Yt[0])||ut(je,Yt[0],_t),1;var er=[],Er=!1,Sr=!1;return be(Ae.point,je.point)?Er=!0:ht(Ae,je)===1?er.push(je,Ae):er.push(Ae,je),be(Ae.otherEvent.point,je.otherEvent.point)?Sr=!0:ht(Ae.otherEvent,je.otherEvent)===1?er.push(je.otherEvent,Ae.otherEvent):er.push(Ae.otherEvent,je.otherEvent),Er&&Sr||Er?(je.type=N,Ae.type=je.inOut===Ae.inOut?k:M,Er&&!Sr&&ut(er[1].otherEvent,er[0].point,_t),2):Sr?(ut(er[0],er[1].point,_t),3):er[0]!==er[3].otherEvent?(ut(er[0],er[1].point,_t),ut(er[1],er[2].point,_t),3):(ut(er[0],er[1].point,_t),ut(er[3].otherEvent,er[2].point,_t),3)}function ur(Ae,je){if(Ae===je)return 0;if(Dt(Ae.point,Ae.otherEvent.point,je.point)!==0||Dt(Ae.point,Ae.otherEvent.point,je.otherEvent.point)!==0)return be(Ae.point,je.point)?Ae.isBelow(je.otherEvent.point)?-1:1:Ae.point[0]===je.point[0]?Ae.point[1]<je.point[1]?-1:1:ht(Ae,je)===1?je.isAbove(Ae.point)?-1:1:Ae.isBelow(je.point)?-1:1;if(Ae.isSubject!==je.isSubject)return Ae.isSubject?-1:1;var _t=Ae.point,Yt=je.point;return _t[0]===Yt[0]&&_t[1]===Yt[1]?(_t=Ae.otherEvent.point)[0]===(Yt=je.otherEvent.point)[0]&&_t[1]===Yt[1]?0:Ae.contourId>je.contourId?1:-1:ht(Ae,je)===1?1:-1}var _r=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ir(Ae,je,_t,Yt){var yt,er=Ae+1,Er=je[Ae].point,Sr=je.length;for(er<Sr&&(yt=je[er].point);er<Sr&&yt[0]===Er[0]&&yt[1]===Er[1];){if(!_t[er])return er;++er<Sr&&(yt=je[er].point)}for(er=Ae-1;_t[er]&&er>Yt;)er--;return er}_r.prototype.isExterior=function(){return this.holeOf==null};var Jt=tr,Qr=tr;function tr(Ae,je){if(!(this instanceof tr))return new tr(Ae,je);if(this.data=Ae||[],this.length=this.data.length,this.compare=je||Pr,this.length>0)for(var _t=(this.length>>1)-1;_t>=0;_t--)this._down(_t)}function Pr(Ae,je){return Ae<je?-1:Ae>je?1:0}tr.prototype={push:function(Ae){this.data.push(Ae),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ae=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ae}},peek:function(){return this.data[0]},_up:function(Ae){for(var je=this.data,_t=this.compare,Yt=je[Ae];Ae>0;){var yt=Ae-1>>1,er=je[yt];if(_t(Yt,er)>=0)break;je[Ae]=er,Ae=yt}je[Ae]=Yt},_down:function(Ae){for(var je=this.data,_t=this.compare,Yt=this.length>>1,yt=je[Ae];Ae<Yt;){var er=1+(Ae<<1),Er=er+1,Sr=je[er];if(Er<this.length&&_t(je[Er],Sr)<0&&(er=Er,Sr=je[Er]),_t(Sr,yt)>=0)break;je[Ae]=Sr,Ae=er}je[Ae]=yt}},Jt.default=Qr;var an=Math.max,Sn=Math.min,Hn=0;function cn(Ae,je,_t,Yt,yt,er){var Er,Sr,un,$r,vr,Qn;for(Er=0,Sr=Ae.length-1;Er<Sr;Er++)if($r=Ae[Er+1],vr=new me(un=Ae[Er],!1,void 0,je),Qn=new me($r,!1,vr,je),vr.otherEvent=Qn,un[0]!==$r[0]||un[1]!==$r[1]){vr.contourId=Qn.contourId=_t,er||(vr.isExteriorRing=!1,Qn.isExteriorRing=!1),ht(vr,Qn)>0?Qn.left=!0:vr.left=!0;var As=un[0],Hr=un[1];yt[0]=Sn(yt[0],As),yt[1]=Sn(yt[1],Hr),yt[2]=an(yt[2],As),yt[3]=an(yt[3],Hr),Yt.push(vr),Yt.push(Qn)}}var ts=[];function rs(Ae,je,_t){typeof Ae[0][0][0]=="number"&&(Ae=[Ae]),typeof je[0][0][0]=="number"&&(je=[je]);var Yt=function(Hr,qn,Ps){var xs=null;return Hr.length*qn.length==0&&(Ps===D?xs=ts:Ps===G?xs=Hr:Ps!==q&&Ps!==ee||(xs=Hr.length===0?qn:Hr)),xs}(Ae,je,_t);if(Yt)return Yt===ts?null:Yt;var yt=[1/0,1/0,-1/0,-1/0],er=[1/0,1/0,-1/0,-1/0],Er=function(Hr,qn,Ps,xs,ji){var ri,Hs,Ts,ns,dn,ss,Ws=new Jt(null,ht);for(Ts=0,ns=Hr.length;Ts<ns;Ts++)for(dn=0,ss=(ri=Hr[Ts]).length;dn<ss;dn++)(Hs=dn===0)&&Hn++,cn(ri[dn],!0,Hn,Ws,Ps,Hs);for(Ts=0,ns=qn.length;Ts<ns;Ts++)for(dn=0,ss=(ri=qn[Ts]).length;dn<ss;dn++)Hs=dn===0,ji===G&&(Hs=!1),Hs&&Hn++,cn(ri[dn],!1,Hn,Ws,xs,Hs);return Ws}(Ae,je,yt,er,_t);if(Yt=function(Hr,qn,Ps,xs,ji){var ri=null;return(Ps[0]>xs[2]||xs[0]>Ps[2]||Ps[1]>xs[3]||xs[1]>Ps[3])&&(ji===D?ri=ts:ji===G?ri=Hr:ji!==q&&ji!==ee||(ri=Hr.concat(qn))),ri}(Ae,je,yt,er,_t))return Yt===ts?null:Yt;for(var Sr=function(Hr){var qn,Ps,xs=function(Ts){var ns,dn,ss,Ws,qr=[];for(dn=0,ss=Ts.length;dn<ss;dn++)((ns=Ts[dn]).left&&ns.inResult||!ns.left&&ns.otherEvent.inResult)&&qr.push(ns);for(var Wn=!1;!Wn;)for(Wn=!0,dn=0,ss=qr.length;dn<ss;dn++)dn+1<ss&&ht(qr[dn],qr[dn+1])===1&&(Ws=qr[dn],qr[dn]=qr[dn+1],qr[dn+1]=Ws,Wn=!1);for(dn=0,ss=qr.length;dn<ss;dn++)(ns=qr[dn]).otherPos=dn;for(dn=0,ss=qr.length;dn<ss;dn++)(ns=qr[dn]).left||(Ws=ns.otherPos,ns.otherPos=ns.otherEvent.otherPos,ns.otherEvent.otherPos=Ws);return qr}(Hr),ji={},ri=[],Hs=function(){if(!ji[qn]){var Ts=ri.length,ns=function(qr,Wn,ni){var Di=new _r;if(qr.prevInResult!=null){var Hi=qr.prevInResult,ma=Hi.outputContourId;if(Hi.resultTransition>0){var si=Wn[ma];if(si.holeOf!=null){var ha=si.holeOf;Wn[ha].holeIds.push(ni),Di.holeOf=ha,Di.depth=Wn[ma].depth}else Wn[ma].holeIds.push(ni),Di.holeOf=ma,Di.depth=Wn[ma].depth+1}else Di.holeOf=null,Di.depth=Wn[ma].depth}else Di.holeOf=null,Di.depth=0;return Di}(xs[qn],ri,Ts),dn=function(qr){ji[qr]=!0,qr<xs.length&&xs[qr]&&(xs[qr].outputContourId=Ts)},ss=qn,Ws=qn;for(ns.points.push(xs[qn].point);dn(ss),dn(ss=xs[ss].otherPos),ns.points.push(xs[ss].point),!((ss=ir(ss,xs,ji,Ws))==Ws||ss>=xs.length)&&xs[ss];);ri.push(ns)}};for(qn=0,Ps=xs.length;qn<Ps;qn++)Hs();return ri}(function(Hr,qn,Ps,xs,ji,ri){for(var Hs,Ts,ns,dn=new m(ur),ss=[],Ws=Math.min(xs[2],ji[2]);Hr.length!==0;){var qr=Hr.pop();if(ss.push(qr),ri===D&&qr.point[0]>Ws||ri===G&&qr.point[0]>xs[2])break;if(qr.left){Ts=Hs=dn.insert(qr),Hs=Hs!==(ns=dn.minNode())?dn.prev(Hs):null,Ts=dn.next(Ts);var Wn=Hs?Hs.key:null;if(ne(qr,Wn,ri),Ts&&It(qr,Ts.key,Hr)===2&&(ne(qr,Wn,ri),ne(Ts.key,qr,ri)),Hs&&It(Hs.key,qr,Hr)===2){var ni=Hs;ne(Wn,(ni=ni!==ns?dn.prev(ni):null)?ni.key:null,ri),ne(qr,Wn,ri)}}else Ts=Hs=dn.find(qr=qr.otherEvent),Hs&&Ts&&(Hs=Hs!==ns?dn.prev(Hs):null,Ts=dn.next(Ts),dn.remove(qr),Ts&&Hs&&It(Hs.key,Ts.key,Hr))}return ss}(Er,0,0,yt,er,_t)),un=[],$r=0;$r<Sr.length;$r++){var vr=Sr[$r];if(vr.isExterior()){for(var Qn=[vr.points],As=0;As<vr.holeIds.length;As++)Qn.push(Sr[vr.holeIds[As]].points);un.push(Qn)}}return un}var mi={UNION:q,DIFFERENCE:G,INTERSECTION:D,XOR:ee};l.diff=function(Ae,je){return rs(Ae,je,G)},l.intersection=function(Ae,je){return rs(Ae,je,D)},l.operations=mi,l.union=function(Ae,je){return rs(Ae,je,q)},l.xor=function(Ae,je){return rs(Ae,je,ee)},Object.defineProperty(l,"__esModule",{value:!0})})(s)}(0,UF.exports)),UF.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function t2(u,s,l,f){const m=[],y=f===0?(x,b,j,N,k,M)=>{x.push(new Rt(M,j+(M-b)/(N-b)*(k-j)))}:(x,b,j,N,k,M)=>{x.push(new Rt(b+(M-j)/(k-j)*(N-b),M))};for(const x of u){const b=[];for(const j of x){if(j.length<=2)continue;const N=[];for(let D=0;D<j.length-1;D++){const q=j[D].x,G=j[D].y,ee=j[D+1].x,ne=j[D+1].y,ie=f===0?q:G,me=f===0?ee:ne;ie<s?me>s&&y(N,q,G,ee,ne,s):ie>l?me<l&&y(N,q,G,ee,ne,l):N.push(j[D]),me<s&&ie>=s&&y(N,q,G,ee,ne,s),me>l&&ie<=l&&y(N,q,G,ee,ne,l)}let k=j[j.length-1];const M=f===0?k.x:k.y;M>=s&&M<=l&&N.push(k),N.length&&(k=N[N.length-1],N[0].x===k.x&&N[0].y===k.y||N.push(N[0]),b.push(N))}b.length&&m.push(b)}return m}function Kte(u,s){const l=SP(u),f=SP([s]),m=$F.intersection(l,f);return m==null?[]:qF(m)}function Xte(u,s){let f=SP(u,65536);const m=[];for(;s.valid();s.next()){const[y,x]=s.get(),b=y.x*65536,j=y.y*65536,N=x.x*65536,k=x.y*65536,M=N-b,D=k-j,q=Math.hypot(M,D);if(q===0)continue;const G=Math.trunc(D/q*3),ee=-Math.trunc(M/q*3);m.push([[[b,j],[N,k],[N+G,k+ee],[b+G,j+ee],[b,j]]])}return m.length>0&&(f=$F.diff(f,m)),qF(f,1/65536)}function SP(u,s=1){return[u.map(l=>l.map(f=>[f.x*s,f.y*s]))]}function qF(u,s=1){return u.map(l=>l.map((f,m)=>{const y=f.map(x=>new Rt(x[0]*s,x[1]*s).round());return m>0&&y.reverse(),y}))}class EP{constructor(s,l){this.layoutVertexArray=new yl,this.indexArray=new ui,this.lineIndexArray=new Vc,this.triangleSegments=new xi,this.lineSegments=new xi,this.programConfigurations=new xu(s.layers,{zoom:s.zoom,lut:s.lut}),this.uploaded=!1,l&&(this.elevatedLayoutVertexArray=new Td)}update(s,l,f,m,y,x,b,j){this.programConfigurations.updatePaintArrays(s,l,y,f,m,x,b,j)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Mte.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.lineIndexBuffer=s.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,Dte.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(s,l,f,m,y,x,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,l,f,m,y,x,void 0,b)}}class TP{constructor(s){this.zoom=s.zoom,this.pixelRatio=s.pixelRatio,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=s.lut,this.bufferData=new EP(s,!1),this.elevationBufferData=new EP(s,!0),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=s.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=s.sourceLayerIndex,this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,l){}updateAppearances(s,l,f,m){}populate(s,l,f,m){this.hasPattern=wP("fill",this.layers,this.pixelRatio,l);const y=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:b,id:j,index:N,sourceLayerIndex:k}of s){const M=this.layers[0]._featureFilter.needGeometry,D=lt(b,M);if(!this.layers[0]._featureFilter.filter(new Xs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),D,f))continue;const q=y?y.evaluate(D,{},f,l.availableImages):void 0,G={id:j,properties:b.properties,type:b.type,sourceLayerIndex:k,index:N,geometry:M?D.geometry:wt(b,f,m),patterns:{},sortKey:q};x.push(G)}y&&x.sort((b,j)=>b.sortKey-j.sortKey);for(const b of x){const{geometry:j,index:N,sourceLayerIndex:k}=b;if(this.hasPattern){const M=bP("fill",this.layers,b,this.zoom,this.pixelRatio,l);this.patternFeatures.push(M)}else this.addFeature(b,j,N,f,{},l.availableImages,l.brightness,l.elevationFeatures);l.featureIndex.insert(s[N].feature,j,N,k,this.index)}}update(s,l,f,m,y,x,b){this.bufferData.update(s,l,f,m,y,x,b,this.worldview),this.elevationBufferData.update(s,l,f,m,y,x,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(s,l,f,m,y,x,b,this.worldview)}addFeatures(s,l,f,m,y,x){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,f,m,x,s.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(s){this.bufferData.upload(s),this.elevationBufferData.upload(s),this.elevatedStructures&&this.elevatedStructures.upload(s)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(s,l,f,m,y,x=[],b,j){const N=Mb(l,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(s,N,m,f,j):this.addGeometry(N,this.bufferData),this.bufferData.populatePaintArrays(s,f,y,x,m,b,this.worldview),this.elevationBufferData.populatePaintArrays(s,f,y,x,m,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(s,l,f,m,y){this.elevatedStructures&&(this.elevatedStructures.construct(s),this.elevatedStructures.populatePaintArrays(l,f,m,y,this.worldview))}addElevatedRoadFeature(s,l,f,m,y){const x=new Array,b=Jr.getElevationFeature(s,y);if(!b)return void this.addGeometry(l,this.bufferData);{const N=this.clipPolygonsToTile(l,1);N.length>0&&x.push({polygons:N,elevationFeature:b,elevationTileID:f})}const j={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(s,{},f),featureIndex:m};for(const N of x)if(N.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new hc(N.elevationTileID,this.layers,this.zoom,this.lut));const M=N.elevationFeature.isTunnel();let D=0;s.properties.hasOwnProperty(cr)&&(D=+s.properties[cr]);for(const q of N.polygons)this.elevatedStructures.addPortalCandidates(N.elevationFeature.id,q,M,N.elevationFeature,D)}N.elevationFeature.constantHeight==null&&(N.polygons=this.prepareElevatedPolygons(N.polygons,N.elevationFeature,N.elevationTileID));const k=new Gn(f,N.elevationTileID);this.addElevatedGeometry(N.polygons,k,N.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,m,j)}}addElevatedGeometry(s,l,f,m,y,x){const b={elevation:f,elevationSampler:l,bias:m,index:y,featureInfo:x},[j,N]=this.addGeometry(s,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:j,max:N}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,j),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,N))}addGeometry(s,l,f){let m=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,x=null;f&&(x=f.elevationSampler.constantElevation(f.elevation,f.bias),x!=null&&(m=x,y=x));const b=(j,N,k)=>{if(f!=null)if(N.push(j),x!=null)l.elevatedLayoutVertexArray.emplaceBack(x),k.push(x);else{const M=f.elevationSampler.pointElevation(j,f.elevation,f.bias);l.elevatedLayoutVertexArray.emplaceBack(M),k.push(M),m=Math.min(m,M),y=Math.max(y,M)}};for(const j of s){let N=0;for(const ye of j)N+=ye.length;const k=l.triangleSegments.prepareSegment(N,l.layoutVertexArray,l.indexArray),M=k.vertexLength,D=[],q=[],G=[],ee=[],ne=[],ie=l.layoutVertexArray.length;for(const ye of j){if(ye.length===0)continue;ye!==j[0]&&q.push(D.length/2);const be=l.lineSegments.prepareSegment(ye.length,l.layoutVertexArray,l.lineIndexArray),Me=be.vertexLength;f&&ne.push(l.layoutVertexArray.length-ie),b(ye[0],G,ee),l.layoutVertexArray.emplaceBack(ye[0].x,ye[0].y),l.lineIndexArray.emplaceBack(Me+ye.length-1,Me),D.push(ye[0].x),D.push(ye[0].y);for(let Ce=1;Ce<ye.length;Ce++)b(ye[Ce],G,ee),l.layoutVertexArray.emplaceBack(ye[Ce].x,ye[Ce].y),l.lineIndexArray.emplaceBack(Me+Ce-1,Me+Ce),D.push(ye[Ce].x),D.push(ye[Ce].y);be.vertexLength+=ye.length,be.primitiveLength+=ye.length}const me=Ux(D,q);for(let ye=0;ye<me.length;ye+=3)l.indexArray.emplaceBack(M+me[ye],M+me[ye+1],M+me[ye+2]);if(me.length>0&&f&&this.elevationMode==="hd-road-base"){const ye=f.elevation.isTunnel(),be=f.elevation.safeArea,Me=this.elevatedStructures.addVertices(G,ee);this.elevatedStructures.addTriangles(me,Me,ye);const Ce=ne.length;if(Ce>0){for(let Le=0;Le<Ce-1;Le++)this.elevatedStructures.addRenderableRing(f.index,ne[Le]+Me,ne[Le+1]-ne[Le],ye,be,f.featureInfo);this.elevatedStructures.addRenderableRing(f.index,ne[Ce-1]+Me,G.length-ne[Ce-1],ye,be,f.featureInfo)}}k.vertexLength+=N,k.primitiveLength+=me.length/3}return[m,y]}prepareElevatedPolygons(s,l,f){const m=1/Oe(f),y=[];for(const x of s){const b=Xte(x,new ei(l,m));y.push(...b)}return y}clipPolygonsToTile(s,l){const f=-l,m=-l,y=Zt+l,x=Zt+l;let b=0;const j=[],N=[];for(;b<s.length;b++){const D=s[b],q=Gg(D);(q.min.x>=f&&q.max.x<=y&&q.min.y>=m&&q.max.y<=x?j:N).push(D)}if(j.length===s.length)return s;const k=[new Rt(f,m),new Rt(y,m),new Rt(y,x),new Rt(f,x),new Rt(f,m)],M=j;for(const D of N)M.push(...Kte(D,k));return M}}let GF,HF,WF,ZF;hr(TP,"FillBucket",{omit:["layers","patternFeatures"]}),hr(EP,"FillBufferData"),hr(hc,"ElevatedStructures");class r2{constructor(s,l,f,m){if(this.triangleCount=l.length/3,this.min=new Rt(0,0),this.max=new Rt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||s.length===0)return;const[y,x]=[s[0].clone(),s[0].clone()];for(let M=1;M<s.length;++M){const D=s[M];y.x=Math.min(y.x,D.x),y.y=Math.min(y.y,D.y),x.x=Math.max(x.x,D.x),x.y=Math.max(x.y,D.y)}if(m){const M=Math.ceil(Math.max(x.x-y.x,x.y-y.y)/m);f=Math.max(f,M)}if(f===0)return;this.min=y,this.max=x;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const j=Math.max(b.x,b.y)/f;this.cellsX=Math.max(1,Math.ceil(b.x/j)),this.cellsY=Math.max(1,Math.ceil(b.y/j)),this.xScale=1/j,this.yScale=1/j;const N=[];for(let M=0;M<this.triangleCount;M++){const D=s[l[3*M+0]].sub(this.min),q=s[l[3*M+1]].sub(this.min),G=s[l[3*M+2]].sub(this.min),ee=Dh(Math.floor(Math.min(D.x,q.x,G.x)),this.xScale,this.cellsX),ne=Dh(Math.floor(Math.max(D.x,q.x,G.x)),this.xScale,this.cellsX),ie=Dh(Math.floor(Math.min(D.y,q.y,G.y)),this.yScale,this.cellsY),me=Dh(Math.floor(Math.max(D.y,q.y,G.y)),this.yScale,this.cellsY),ye=new Rt(0,0),be=new Rt(0,0),Me=new Rt(0,0),Ce=new Rt(0,0);for(let Le=ie;Le<=me;++Le){ye.y=be.y=Le*j,Me.y=Ce.y=(Le+1)*j;for(let Ve=ee;Ve<=ne;++Ve)ye.x=Me.x=Ve*j,be.x=Ce.x=(Ve+1)*j,(Gi(D,q,G,ye,be,Ce)||Gi(D,q,G,ye,Ce,Me))&&N.push({cellIdx:Le*this.cellsX+Ve,triIdx:M})}}if(N.length===0)return;N.sort((M,D)=>M.cellIdx-D.cellIdx||M.triIdx-D.triIdx);let k=0;for(;k<N.length;){const M=N[k].cellIdx,D={start:this.payload.length,len:0};for(;k<N.length&&N[k].cellIdx===M;)++D.len,this.payload.push(N[k++].triIdx);this.cells[M]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(s,l){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>s.x||s.y>this.max.y||this.min.y>s.y)return;const f=Dh(s.x-this.min.x,this.xScale,this.cellsX),m=Dh(s.y-this.min.y,this.yScale,this.cellsY),y=this.cells[m*this.cellsX+f];if(y){this._lazyInitLookup();for(let x=0;x<y.len;x++){const b=this.payload[y.start+x],j=Math.floor(b/8),N=1<<b%8;if(!(this.lookup[j]&N)&&(this.lookup[j]|=N,l.push(b),l.length===this.triangleCount))return}}}query(s,l,f){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>l.x||s.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const m=Dh(s.x-this.min.x,this.xScale,this.cellsX),y=Dh(l.x-this.min.x,this.xScale,this.cellsX),x=Dh(s.y-this.min.y,this.yScale,this.cellsY),b=Dh(l.y-this.min.y,this.yScale,this.cellsY);for(let j=x;j<=b;j++)for(let N=m;N<=y;N++){const k=this.cells[j*this.cellsX+N];if(k)for(let M=0;M<k.len;M++){const D=this.payload[k.start+M],q=Math.floor(D/8),G=1<<D%8;if(!(this.lookup[q]&G)&&(this.lookup[q]|=G,f.push(D),f.length===this.triangleCount))return}}}}function Dh(u,s,l){return Math.max(0,Math.min(l-1,Math.floor(u*s)))}hr(r2,"TriangleGridIndex");class KF{constructor(s){this.zoom=s.zoom,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[],this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,l){for(const f of this.footprints)l.push({footprint:f,id:s})}updateAppearances(s,l,f,m){}populate(s,l,f,m){const y=[];for(const{feature:x,id:b,index:j,sourceLayerIndex:N}of s){const k=this.layers[0]._featureFilter.needGeometry,M=lt(x,k);if(!this.layers[0]._featureFilter.filter(new Xs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),M,f))continue;const D={id:b,properties:x.properties,type:x.type,sourceLayerIndex:N,index:j,geometry:k?M.geometry:wt(x,f,m),patterns:{}};y.push(D)}for(const x of y){const{geometry:b,index:j,sourceLayerIndex:N}=x;this.addFeature(x,b,j,f,{},l.availableImages,l.brightness),l.featureIndex.insert(s[j].feature,b,j,N,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(s){}update(s,l,f,m,y,x,b){}destroy(){}addFeature(s,l,f,m,y,x=[],b){for(const j of Mb(l,2)){const N=[],k=[],M=[],D=new Rt(1/0,1/0),q=new Rt(-1/0,-1/0);for(const ne of j)if(ne.length!==0){ne!==j[0]&&M.push(k.length/2);for(let ie=0;ie<ne.length;ie++)k.push(ne[ie].x),k.push(ne[ie].y),N.push(ne[ie]),D.x=Math.min(D.x,ne[ie].x),D.y=Math.min(D.y,ne[ie].y),q.x=Math.max(q.x,ne[ie].x),q.y=Math.max(q.y,ne[ie].y)}const G=Ux(k,M),ee=new r2(N,G,8,256);this.footprints.push({vertices:N,indices:G,grid:ee,min:D,max:q})}}}hr(KF,"ClipBucket",{omit:["layers"]});const Yte=In([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Jte=In([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Qte=In([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),ere=In([{name:"a_centroid_pos",components:2,type:"Uint16"}]),tre=In([{name:"a_join_normal_inside",components:3,type:"Int16"}]),rre=In([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),nre=In([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:sre}=Yte,Db=Number.MAX_SAFE_INTEGER,XF=Db-1;function YF(u,s,l,f){return u.order<s||u.order===Db||!(u.clipMask&l)||function(m,y){return y.length!==0&&y.find(x=>x===m)===void 0}(f,u.clipScope)}function n2(u,s){return u.x-s.x||u.y-s.y}function JF(u,s){return n2(u.min,s.min)===0&&n2(u.max,s.max)===0}function jP(u,s){return!(u.min.x>s.max.x||u.max.x<s.min.x||u.min.y>s.max.y||u.max.y<s.min.y)}function s2(u,s){if(u.length!==s.length)return!1;for(let l=0;l<u.length;l++)if(u[l].sourceId!==s[l].sourceId||!JF(u[l],s[l])||u[l].order!==s[l].order||u[l].clipMask!==s[l].clipMask||!ua(u[l].clipScope,s[l].clipScope))return!1;return!0}function QF(u,s,l){const f=1/Zt,m=1/(1<<l.canonical.z),y=(s.x*f+l.canonical.x)*m+l.wrap,x=(s.y*f+l.canonical.y)*m;return{min:new Rt((u.x*f+l.canonical.x)*m+l.wrap,(u.y*f+l.canonical.y)*m),max:new Rt(y,x)}}function ire(u,s,l){const f=1<<l.canonical.z,m=((s.x-l.wrap)*f-l.canonical.x)*Zt,y=(s.y*f-l.canonical.y)*Zt;return{min:new Rt(((u.x-l.wrap)*f-l.canonical.x)*Zt,(u.y*f-l.canonical.y)*Zt),max:new Rt(m,y)}}function NP(u,s,l,f,m,y,x){const b=u.indices,j=u.vertices,N=[];for(let k=f;k<f+m;k+=3){const M=s[l[k+0]+y],D=s[l[k+1]+y],q=s[l[k+2]+y],G=Math.min(M.x,D.x,q.x),ee=Math.max(M.x,D.x,q.x),ne=Math.min(M.y,D.y,q.y),ie=Math.max(M.y,D.y,q.y);N.length=0,u.grid.query(new Rt(G,ne),new Rt(ee,ie),N);for(let me=0;me<N.length;me++){const ye=N[me];if(Gi(j[b[3*ye+0]],j[b[3*ye+1]],j[b[3*ye+2]],M,D,q,x))return!0}}return!1}function ez(u,s,l,f){if(!u||!l)return!1;let m=u.vertices;if(!s.canonical.equals(f.canonical)||s.wrap!==f.wrap){if(l.vertices.length<u.vertices.length)return ez(l,f,u,s);const y=s.canonical,x=f.canonical,b=Math.pow(2,x.z-y.z);m=u.vertices.map(j=>new Rt((j.x+y.x*Zt)*b-x.x*Zt,(j.y+y.y*Zt)*b-x.y*Zt))}return NP(l,m,u.indices,0,u.indices.length,0,0)}function tz(u,s,l,f){const m=Math.pow(2,f.z-l.z);return new Rt((u+l.x*Zt)*m-f.x*Zt,(s+l.y*Zt)*m-f.y*Zt)}function IP(u,s){const l=[];s.grid.queryPoint(u,l);const f=s.indices,m=s.vertices;for(let y=0;y<l.length;y++){const x=l[y];if(Ua([m[f[3*x+0]],m[f[3*x+1]],m[f[3*x+2]]],u))return!0}return!1}const CP=[new Rt(0,0),new Rt(Zt,0),new Rt(Zt,Zt),new Rt(0,Zt)];function rz(u,s){const l=[];let f=[];if(!s||u.length<2)return[u];if(u.length===2)return Ui(u[0],u[1],CP)?[u]:[];for(let m=0;m<u.length+2;m++){const y=u[m%u.length],x=u[(m+1)%u.length],b=Ui(m===0?u[u.length-1]:u[(m-1)%u.length],y,CP),j=Ui(y,x,CP),N=b||j;N&&f.push(y),N&&j||f.length>0&&(f.length>1&&l.push(f),f=[])}return f.length>1&&l.push(f),l}const AP=Pt.types,are=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],ore=["fill-extrusion-flood-light-ground-radius"],lre=Math.pow(2,13),cre=Math.pow(2,15)-1,nz=new Rt(0,1),_m=2147483648,sz=7,iz=450;function Ob(u,s,l,f,m,y,x,b){u.emplaceBack((s<<1)+x,(l<<1)+y,(Math.floor(f*lre)<<1)+m,Math.round(b))}function Lb(u,s,l){u.emplaceBack(s.x*Zt,s.y*Zt,l?1:0)}function i2(u,s,l,f,m,y){u.emplaceBack(s.x,s.y,(l.x<<1)+f,(l.y<<1)+m,y)}function Fb(u,s,l){u.emplaceBack(s.x,s.y,s.z,l[0]*16384,l[1]*16384,l[2]*16384)}class az{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class oz{constructor(){this.centroidXY=new Rt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Rt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Rt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Rt(this.max.x-this.min.x,this.max.y-this.min.y)}}class lz{constructor(){this.acc=new Rt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(s,l){s.min.x===Number.MAX_VALUE&&(s.min.x=s.max.x=l.x,s.min.y=s.max.y=l.y)}appendEdge(s,l,f){this.accCount++,this.acc._add(l);let m=!!this.borders;l.x<s.min.x?(s.min.x=l.x,m=!0):l.x>s.max.x&&(s.max.x=l.x,m=!0),l.y<s.min.y?(s.min.y=l.y,m=!0):l.y>s.max.y&&(s.max.y=l.y,m=!0),((l.x===0||l.x===Zt)&&l.x===f.x)!=((l.y===0||l.y===Zt)&&l.y===f.y)&&this.processBorderOverlap(l,f),m&&this.checkBorderIntersection(l,f)}checkBorderIntersection(s,l){l.x<0!=s.x<0&&this.addBorderIntersection(0,Ur(l.y,s.y,(0-l.x)/(s.x-l.x))),l.x>Zt!=s.x>Zt&&this.addBorderIntersection(1,Ur(l.y,s.y,(Zt-l.x)/(s.x-l.x))),l.y<0!=s.y<0&&this.addBorderIntersection(2,Ur(l.x,s.x,(0-l.y)/(s.y-l.y))),l.y>Zt!=s.y>Zt&&this.addBorderIntersection(3,Ur(l.x,s.x,(Zt-l.y)/(s.y-l.y)))}addBorderIntersection(s,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[s];l<f[0]&&(f[0]=l),l>f[1]&&(f[1]=l)}processBorderOverlap(s,l){if(s.x===l.x){if(s.y===l.y)return;const f=s.x===0?0:1;this.addBorderIntersection(f,l.y),this.addBorderIntersection(f,s.y)}else{const f=s.y===0?2:3;this.addBorderIntersection(f,l.x),this.addBorderIntersection(f,s.x)}}centroid(){return this.accCount===0?new Rt(0,0):new Rt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((s,l)=>s+ +(l[0]!==Number.MAX_VALUE),0):0}}function cz(u,s){const l=u.add(s)._unit(),f=he(u.x*l.x+u.y*l.y,-1,1);var m,y,x;return m=Math.acos(f),Math.min(4,Math.max(-4,Math.tan(m)))/4*cre*((y=u).x*(x=s).y-y.y*x.x<0?-1:1)}const ure=[u=>u.x<0,u=>u.x>Zt,u=>u.y<0,u=>u.y>Zt];function dre(u,s,l,f){const m=[4];if(f===0)return m;l._mult(f);const y=u.sub(l),x=s.sub(l),b=[u,s,y,x];for(let j=0;j<4;j++)for(const N of b)if(ure[j](N)){m.push(j);break}return m}class PP{constructor(s){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Nx,this.indexArray=new ui,this.programConfigurations=new xu(s.layers,{zoom:s.zoom,lut:s.lut},l=>ore.includes(l)),this._segments=new xi,this.hiddenByLandmarkVertexArray=new Mx,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new xi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(s,l,f,m=!1){const y=s.length;if(y>2){let x=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*y,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let j;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const N=s[0],k=s[1];j=cz(N.sub(s[y-1])._perp()._unit(),k.sub(N)._perp()._unit())}for(let N=0;N<y;N++){const k=N===y-1?0:N+1,M=s[N],D=s[k],q=s[k===y-1?0:k+1],G=D.sub(M)._perp()._unit(),ee=cz(G,q.sub(D)._perp()._unit()),ne=j,ie=ee;if(kP(M,D,l)||m&&hz(M,l)&&hz(D,l)){j=ee;continue}const me=b.vertexLength;i2(this.vertexArray,M,D,1,1,ne),i2(this.vertexArray,M,D,1,0,ne),i2(this.vertexArray,M,D,0,1,ie),i2(this.vertexArray,M,D,0,0,ie),b.vertexLength+=4;const ye=dre(M,D,G,f);for(const be of ye)this._segmentToGroundQuads[x].push({id:me,region:be}),this._segmentToRegionTriCounts[x][be]+=2,b.primitiveLength+=2;j=ee}}}prepareBorderSegments(){if(!this.hasData())return;const s=this._segments.get(),l=s.length;for(let f=0;f<l;f++)this._segmentToGroundQuads[f].sort((m,y)=>m.region-y.region);for(let f=0;f<l;f++){const m=this._segmentToGroundQuads[f],y=s[f],x=this._segmentToRegionTriCounts[f];x.reduce((j,N)=>j+N,0);let b=0;for(let j=0;j<=4;j++){const N=x[j];if(N!==0){let k=this.regionSegments[j];k||(k=this.regionSegments[j]=new xi);const M={vertexOffset:y.vertexOffset,primitiveOffset:y.primitiveOffset+b,vertexLength:y.vertexLength,primitiveLength:N};k.get().push(M)}b+=N}for(let j=0;j<m.length;j++){const N=m[j].id;this.indexArray.emplaceBack(N,N+1,N+3),this.indexArray.emplaceBack(N,N+3,N+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(s,l,f,m,y,x,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,s,l,f,m,y,x,void 0,b)}upload(s){this.hasData()&&(this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Jte.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=s.createVertexBuffer(this.groundRadiusArray,Qte.members)))}uploadPaintProperties(s){this.hasData()&&this.programConfigurations.upload(s)}update(s,l,f,m,y,x,b,j){this.hasData()&&this.programConfigurations.updatePaintArrays(s,l,f,m,y,x,b,j)}updateHiddenByLandmark(s){this.updateHiddenByLandmarkRange(s.groundVertexArrayOffset,s.groundVertexCount,!!(s.flags&_m))}updateHiddenByLandmarkRange(s,l,f){if(!this.hasData())return;const m=l+s;if(l!==0){for(let y=s;y<m;++y)this.hiddenByLandmarkVertexArray.emplace(y,f?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(s){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=s.createVertexBuffer(this.hiddenByLandmarkVertexArray,rre.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let s=0;s<=4;s++){const l=this.regionSegments[s];l&&l.destroy()}}}}class a2{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaling=s.overscaling,this.layers=s.layers,this.pixelRatio=s.pixelRatio,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=s.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ui,this.footprintVertices=new yl,this.footprintSegments=[],this.layoutVertexArray=new im,this.centroidVertexArray=new VT,this.wallVertexArray=new $T,this.indexArray=new ui,this.programConfigurations=new xu(s.layers,{zoom:s.zoom,lut:s.lut},l=>are.includes(l)),this.segments=new xi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new PP(s),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,l){}updateAppearances(s,l,f,m){}populate(s,l,f,m){this.features=[],this.hasPattern=wP("fill-extrusion",this.layers,this.pixelRatio,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Oe(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:y,id:x,index:b,sourceLayerIndex:j}of s){const N=this.layers[0]._featureFilter.needGeometry,k=lt(y,N);if(!this.layers[0]._featureFilter.filter(new Xs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),k,f))continue;const M={id:x,sourceLayerIndex:j,index:b,geometry:N?k.geometry:wt(y,f,m),properties:y.properties,type:y.type,patterns:{}},D=this.layoutVertexArray.length,q=AP[M.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:y.id,feature:bP("fill-extrusion",this.layers,M,this.zoom,this.pixelRatio,l)});else if(this.wallMode)for(const G of M.geometry)for(const ee of rz(G,q))this.addFeature(y.id,M,[ee],b,f,{},l.availableImages,m,l.brightness);else this.addFeature(y.id,M,M.geometry,b,f,{},l.availableImages,m,l.brightness);l.featureIndex.insert(y,M.geometry,b,j,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(s,l,f,m,y,x){for(const{featureId:b,feature:j}of this.features){const N=AP[j.type]==="Polygon",{geometry:k}=j;if(this.wallMode)for(const M of k)for(const D of rz(M,N))this.addFeature(b,j,[D],j.index,l,f,m,y,x);else this.addFeature(b,j,k,j.index,l,f,m,y,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(s,l,f,m,y,x,b){this.programConfigurations.updatePaintArrays(s,l,y,f,m,x,b,this.worldview),this.groundEffect.update(s,l,y,f,m,x,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,sre),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.wallVertexBuffer=s.createVertexBuffer(this.wallVertexArray,tre.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=s.createVertexBuffer(this.layoutVertexExtArray,nre.members,!0)),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}uploadCentroid(s){this.groundEffect.uploadHiddenByLandmark(s),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,ere.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,l,f,m,y,x,b,j,N){const k=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(l,{})/this.tileToMeter,M=[new Rt(0,0),new Rt(Zt,Zt)],D=j.projection,q=D.name==="globe",G=this.wallMode||AP[l.type]==="Polygon",ee=new lz;ee.centroidDataIndex=this.centroidData.length;const ne=new oz;ne.buildingId=s,l.properties&&l.properties.hasOwnProperty("building_id")&&(ne.buildingId=l.properties.building_id);const ie=this.layers[0].paint.get("fill-extrusion-base").evaluate(l,{},y)<=0,me=this.layers[0].paint.get("fill-extrusion-height").evaluate(l,{},y);let ye;if(ne.height=me,ne.vertexArrayOffset=this.layoutVertexArray.length,ne.groundVertexArrayOffset=this.groundEffect.vertexArray.length,q&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Cx),this.wallMode){if(q)return void Ar("Non zero fill-extrusion-line-width is not yet supported on globe.");if(f.length!==1)return;ye=function(rt){const gt=rt[0].x===rt[rt.length-1].x&&rt[0].y===rt[rt.length-1].y;(function(ir){let Jt=0;const Qr=ir.length;for(let tr=0;tr<Qr;tr++)Jt+=(ir[(tr+1)%Qr].x-ir[tr].x)*(ir[(tr+1)%Qr].y+ir[tr].y);return Jt>=0})(rt)||(rt=rt.reverse());const Ct={geometry:[],joinNormals:[],indices:[]},Gt=[],Ot=[],Et=[];let Dt=rt.length;for(;Dt>=2&&rt[Dt-1].equals(rt[Dt-2]);)Dt--;if(Dt<(gt?3:2))return Ct;let ht,ut,kt,$t,It,ur=0;for(;ur<Dt-1&&rt[ur].equals(rt[ur+1]);)ur++;gt&&(ht=rt[Dt-2],It=rt[ur].sub(ht)._unit()._perp());for(let ir=ur;ir<Dt;ir++){if(kt=ir===Dt-1?gt?rt[ur+1]:void 0:rt[ir+1],kt&&rt[ir].equals(kt))continue;It&&($t=It),ht&&(ut=ht),ht=rt[ir],It=kt?kt.sub(ht)._unit()._perp():$t,$t=$t||It;let Jt=$t.add(It);Jt.x===0&&Jt.y===0||Jt._unit();const Qr=Jt.x*It.x+Jt.y*It.y,tr=Qr!==0?1/Qr:1/0,Pr=$t.x*It.y-$t.y*It.x>0;let an="miter";const Sn=2;an==="miter"&&tr>Sn&&(an="bevel"),an==="bevel"&&(tr>100&&(an="flipbevel"),tr<Sn&&(an="miter"));const Hn=(cn,ts,rs,mi)=>{const Ae=new Rt(cn.x,cn.y),je=new Rt(cn.x,cn.y);Ae.x+=ts.x*mi,Ae.y+=ts.y*mi,je.x-=ts.x*Math.max(rs,1),je.y-=ts.y*Math.max(rs,1),Et.push(ts),Gt.push(Ae),Ot.push(je)};if(an==="miter")Jt._mult(tr),Hn(ht,Jt,0,0);else if(an==="flipbevel")Jt=It.mult(-1),Hn(ht,Jt,0,0),Hn(ht,Jt.mult(-1),0,0);else{const cn=-Math.sqrt(tr*tr-1),ts=Pr?cn:0,rs=Pr?0:cn;ut&&Hn(ht,$t,ts,rs),kt&&Hn(ht,It,ts,rs)}}Ct.geometry=[...Gt,...Ot.reverse(),Gt[0]],Ct.joinNormals=[...Et,...Et.reverse(),Et[Et.length-1]];const _r=Ct.geometry.length-1;for(let ir=0;ir<_r/2;ir++)if(ir+1<_r/2){let Jt=ir,Qr=ir+1,tr=_r-1-ir,Pr=_r-2-ir;Jt=Jt===0?_r-1:Jt-1,Qr=Qr===0?_r-1:Qr-1,tr=tr===0?_r-1:tr-1,Pr=Pr===0?_r-1:Pr-1,Ct.indices.push(tr),Ct.indices.push(Qr),Ct.indices.push(Jt),Ct.indices.push(tr),Ct.indices.push(Pr),Ct.indices.push(Qr)}return Ct}(f[0]),f=[ye.geometry]}const be=(rt,gt)=>rt<(gt.length-1)/2||rt===gt.length-1,Me=this.wallMode?[f]:Mb(f,500);for(let rt=Me.length-1;rt>=0;rt--){const gt=Me[rt];(gt.length===0||(Ce=gt[0]).every(bt=>bt.x<=0)||Ce.every(bt=>bt.x>=Zt)||Ce.every(bt=>bt.y<=0)||Ce.every(bt=>bt.y>=Zt))&&Me.splice(rt,1)}var Ce;let Le;if(q)Le=gz(Me,M,y);else{Le=[];for(const rt of Me)Le.push({polygon:rt,bounds:M})}const Ve=G?this.edgeRadius:0,He=Ve>0&&this.zoom<17,mt=(rt,gt)=>{if(rt.length===0)return!1;const bt=rt[rt.length-1];return gt.x===bt.x&&gt.y===bt.y};for(const{polygon:rt,bounds:gt}of Le){let bt=0,Ct=0;for(const Dt of rt)G&&!Dt[0].equals(Dt[Dt.length-1])&&Dt.push(Dt[0]),Ct+=G?Dt.length-1:Dt.length;const Gt=this.segments.prepareSegment((G?5:4)*Ct,this.layoutVertexArray,this.indexArray);ne.footprintSegIdx<0&&(ne.footprintSegIdx=this.footprintSegments.length),ne.polygonSegIdx<0&&(ne.polygonSegIdx=this.polygonSegments.length);const Ot={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Et=new az;if(Et.vertexOffset=this.footprintVertices.length,Et.indexOffset=3*this.footprintIndices.length,Et.ringIndices=[],G){const Dt=[],ht=[];bt=Gt.vertexLength;for(let kt=0;kt<rt.length;kt++){const $t=rt[kt];$t.length&&kt!==0&&ht.push(Dt.length/2);const It=[];let ur,_r;ur=$t[1].sub($t[0])._perp()._unit(),Et.ringIndices.push($t.length-1);for(let ir=1;ir<$t.length;ir++){const Jt=$t[ir],Qr=$t[ir===$t.length-1?1:ir+1],tr=Jt.clone();if(Ve){_r=Qr.sub(Jt)._perp()._unit();const Pr=ur.add(_r)._unit(),an=Ve*Math.min(4,1/(ur.x*Pr.x+ur.y*Pr.y));tr.x+=an*Pr.x,tr.y+=an*Pr.y,tr.x=Math.round(tr.x),tr.y=Math.round(tr.y),ur=_r}if(!ie||Ve!==0&&!He||mt(It,tr)||It.push(tr),Ob(this.layoutVertexArray,tr.x,tr.y,0,0,1,1,0),this.wallMode){const Pr=be(ir,$t);Lb(this.wallVertexArray,ye.joinNormals[ir],!Pr)}Gt.vertexLength++,this.footprintVertices.emplaceBack(Jt.x,Jt.y),Dt.push(Jt.x,Jt.y),q&&Fb(this.layoutVertexExtArray,D.projectTilePoint(tr.x,tr.y,y),D.upVector(y,tr.x,tr.y))}ie&&(Ve===0||He)&&(It.length!==0&&mt(It,It[0])&&It.pop(),this.groundEffect.addData(It,gt,k))}const ut=this.wallMode?ye.indices:Ux(Dt,ht);for(let kt=0;kt<ut.length;kt+=3)this.footprintIndices.emplaceBack(Et.vertexOffset+ut[kt+0],Et.vertexOffset+ut[kt+1],Et.vertexOffset+ut[kt+2]),this.indexArray.emplaceBack(bt+ut[kt],bt+ut[kt+2],bt+ut[kt+1]),Gt.primitiveLength++;Et.indexCount+=ut.length,Et.vertexCount+=this.footprintVertices.length-Et.vertexOffset}for(let Dt=0;Dt<rt.length;Dt++){const ht=rt[Dt];ee.startRing(ne,ht[0]);let ut=ht.length>4&&fz(ht[ht.length-2],ht[0],ht[1]),kt=Ve?hre(ht[ht.length-2],ht[0],ht[1],Ve):0;const $t=[];let It,ur,_r;ur=ht[1].sub(ht[0])._perp()._unit();let ir=!0;for(let Jt=1,Qr=0;Jt<ht.length;Jt++){let tr=ht[Jt-1],Pr=ht[Jt];const an=ht[Jt===ht.length-1?1:Jt+1];if(ee.appendEdge(ne,Pr,tr),kP(Pr,tr,gt)){Ve&&(ur=an.sub(Pr)._perp()._unit(),ir=!ir);continue}const Sn=Pr.sub(tr)._perp(),Hn=Sn.x/(Math.abs(Sn.x)+Math.abs(Sn.y)),cn=Sn.y>0?1:0,ts=tr.dist(Pr);if(Qr+ts>32768&&(Qr=0),Ve){_r=an.sub(Pr)._perp()._unit();let je=dz(tr,Pr,an,uz(ur,_r),Ve);isNaN(je)&&(je=0);const _t=Pr.sub(tr)._unit();tr=tr.add(_t.mult(kt))._round(),Pr=Pr.add(_t.mult(-je))._round(),kt=je,ur=_r,ie&&this.zoom>=17&&(mt($t,tr)||$t.push(tr),mt($t,Pr)||$t.push(Pr))}const rs=Gt.vertexLength,mi=ht.length>4&&fz(tr,Pr,an);let Ae=pz(Qr,ut,ir);if(Ob(this.layoutVertexArray,tr.x,tr.y,Hn,cn,0,0,Ae),Ob(this.layoutVertexArray,tr.x,tr.y,Hn,cn,0,1,Ae),this.wallMode){const je=be(Jt-1,ht),_t=ye.joinNormals[Jt-1];Lb(this.wallVertexArray,_t,je),Lb(this.wallVertexArray,_t,je)}if(Qr+=ts,Ae=pz(Qr,mi,!ir),ut=mi,Ob(this.layoutVertexArray,Pr.x,Pr.y,Hn,cn,0,0,Ae),Ob(this.layoutVertexArray,Pr.x,Pr.y,Hn,cn,0,1,Ae),this.wallMode){const je=be(Jt,ht),_t=ye.joinNormals[Jt];Lb(this.wallVertexArray,_t,je),Lb(this.wallVertexArray,_t,je)}if(Gt.vertexLength+=4,this.indexArray.emplaceBack(rs+0,rs+1,rs+2),this.indexArray.emplaceBack(rs+1,rs+3,rs+2),Gt.primitiveLength+=2,Ve){const je=bt+(Jt===1?ht.length-2:Jt-2),_t=Jt===1?bt:je+1;if(this.indexArray.emplaceBack(rs+1,je,rs+3),this.indexArray.emplaceBack(je,_t,rs+3),Gt.primitiveLength+=2,It===void 0&&(It=rs),!kP(an,ht[Jt],gt)){const Yt=Jt===ht.length-1?It:Gt.vertexLength;this.indexArray.emplaceBack(rs+2,rs+3,Yt),this.indexArray.emplaceBack(rs+3,Yt+1,Yt),this.indexArray.emplaceBack(rs+3,_t,Yt+1),Gt.primitiveLength+=3}ir=!ir}if(q){const je=this.layoutVertexExtArray,_t=D.projectTilePoint(tr.x,tr.y,y),Yt=D.projectTilePoint(Pr.x,Pr.y,y),yt=D.upVector(y,tr.x,tr.y),er=D.upVector(y,Pr.x,Pr.y);Fb(je,_t,yt),Fb(je,_t,yt),Fb(je,Yt,er),Fb(je,Yt,er)}}G&&(bt+=ht.length-1),ie&&Ve&&this.zoom>=17&&($t.length!==0&&mt($t,$t[0])&&$t.pop(),this.groundEffect.addData($t,gt,k,Ve>0))}this.footprintSegments.push(Et),Ot.triangleCount=this.indexArray.length-Ot.triangleArrayOffset,this.polygonSegments.push(Ot),++ne.footprintSegLen,++ne.polygonSegLen}if(ne.vertexCount=this.layoutVertexArray.length-ne.vertexArrayOffset,ne.groundVertexCount=this.groundEffect.vertexArray.length-ne.groundVertexArrayOffset,ne.vertexCount!==0){if(ne.centroidXY=ee.borders?nz:this.encodeCentroid(ee,ne),this.centroidData.push(ne),ee.borders){this.featuresOnBorder.push(ee);const rt=this.featuresOnBorder.length-1;for(let gt=0;gt<ee.borders.length;gt++)ee.borders[gt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[gt].push(rt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,x,b,y,N,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(l,m,x,b,y,N,this.worldview),this.maxHeight=Math.max(this.maxHeight,me)}}sortBorders(){for(let s=0;s<this.borderFeatureIndices.length;s++)this.borderFeatureIndices[s].sort((l,f)=>this.featuresOnBorder[l].borders[s][0]-this.featuresOnBorder[f].borders[s][0])}splitToSubtiles(){const s=[];for(let b=0;b<this.centroidData.length;b++){const j=this.centroidData[b],N=+(j.min.y+j.max.y>Zt),k=2*N+(+(j.min.x+j.max.x>Zt)^N);for(let M=0;M<j.polygonSegLen;M++){const D=j.polygonSegIdx+M;s.push({centroidIdx:b,subtile:k,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}const l=new ui;s.sort((b,j)=>b.triangleSegmentIdx===j.triangleSegmentIdx?b.subtile-j.subtile:b.triangleSegmentIdx-j.triangleSegmentIdx);let f=0,m=0,y=0;for(const b of s){if(b.triangleSegmentIdx!==f)break;y++}const x=s.length;for(;m!==s.length;){f=s[m].triangleSegmentIdx;let b=0,j=m,N=m;for(let k=j;k<y&&s[k].subtile===b;k++)N++;for(;j!==y;){const k=s[j];b=k.subtile;const M=this.centroidData[k.centroidIdx].min.clone(),D=this.centroidData[k.centroidIdx].max.clone(),q={vertexOffset:this.segments.segments[f].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[f].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let G=j;G<N;G++){const ee=s[G],ne=this.polygonSegments[ee.polygonSegmentIdx],ie=this.centroidData[ee.centroidIdx].min,me=this.centroidData[ee.centroidIdx].max,ye=this.indexArray.uint16;for(let be=ne.triangleArrayOffset;be<ne.triangleArrayOffset+ne.triangleCount;be++)l.emplaceBack(ye[3*be],ye[3*be+1],ye[3*be+2]);q.primitiveLength+=ne.triangleCount,M.x=Math.min(M.x,ie.x),M.y=Math.min(M.y,ie.y),D.x=Math.max(D.x,me.x),D.y=Math.max(D.y,me.y)}q.primitiveLength>0&&this.triangleSubSegments.push({segment:q,min:M,max:D}),j=N;for(let G=j;G<y&&s[G].subtile===s[j].subtile;G++)N++}m=y;for(let k=m;k<x&&s[k].triangleSegmentIdx===s[m].triangleSegmentIdx;k++)y++}l._trim(),this.indexArray=l}getVisibleSegments(s,l,f){const m=new xi;if(this.wallMode){for(const ee of this.triangleSubSegments)m.segments.push(ee.segment);return m}let y=0,x=0;const b=1<<s.canonical.z;if(l){const ee=l.getMinMaxForTile(s);ee&&(y=ee.min,x=ee.max)}x+=this.maxHeight;const j=s.toUnwrapped();let N;const k=[j.canonical.x/b+j.wrap,j.canonical.y/b],M=[(j.canonical.x+1)/b+j.wrap,(j.canonical.y+1)/b],D=(ee,ne,ie)=>[ee[0]*(1-ie[0])+ne[0]*ie[0],ee[1]*(1-ie[1])+ne[1]*ie[1]],q=[],G=[];for(const ee of this.triangleSubSegments){q[0]=ee.min.x/Zt,q[1]=ee.min.y/Zt,G[0]=ee.max.x/Zt,G[1]=ee.max.y/Zt;const ne=D(k,M,q),ie=D(k,M,G);if(new wn([ne[0],ne[1],y],[ie[0],ie[1],x]).intersectsPrecise(f)===0){N&&(m.segments.push(N),N=void 0);continue}const me=ee.segment;N&&N.vertexOffset!==me.vertexOffset&&(m.segments.push(N),N=void 0),N?(N.vertexLength+=me.vertexLength,N.primitiveLength+=me.primitiveLength):N={vertexOffset:me.vertexOffset,primitiveLength:me.primitiveLength,vertexLength:me.vertexLength,primitiveOffset:me.primitiveOffset,sortKey:void 0,vaos:{}}}return N&&m.segments.push(N),m}encodeCentroid(s,l){const f=s.centroid(),m=l.span(),y=Math.min(7,Math.round(m.x*this.tileToMeter/10)),x=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new Rt(he(f.x,1,Zt-1)<<3|y,he(f.y,1,Zt-1)<<3|x)}encodeBorderCentroid(s){if(!s.borders)return new Rt(0,0);const l=s.borders,f=Number.MAX_VALUE;if(l[0][0]!==f||l[1][0]!==f){const m=l[0][0]!==f?0:1;return new Rt(6|(l[0][0]!==f?0:65528),(l[m][0]+l[m][1])/2<<3|6)}{const m=l[2][0]!==f?2:3;return new Rt((l[m][0]+l[m][1])/2<<3|6,6|(l[2][0]!==f?0:65528))}}showCentroid(s){const l=this.centroidData[s.centroidDataIndex];l.flags&=2147483647,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(s){this.groundEffect.updateHiddenByLandmark(s);const l=s.vertexArrayOffset,f=s.vertexCount+s.vertexArrayOffset,m=s.flags&_m?nz:s.centroidXY,y=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==m.y||y!==m.x){for(let x=l;x<f;++x)this.centroidVertexArray.emplace(x,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.centroidData)this.writeCentroidToBuffer(s)}updateReplacement(s,l,f){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const m=l.getReplacementRegionsForTile(s.toUnwrapped());if(s2(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const y=[];for(const x of this.activeReplacements){if(x.order<f)continue;const b=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-s.canonical.z));if(x.footprint.buildingId){const j=x.footprint.buildingId;for(const N of this.centroidData)N.buildingId===j&&(N.flags|=_m)}else for(const j of this.centroidData)if(!(j.flags&_m||x.min.x>j.max.x||j.min.x>x.max.x||x.min.y>j.max.y||j.min.y>x.max.y))for(let N=0;N<j.footprintSegLen;N++){const k=this.footprintSegments[j.footprintSegIdx+N];if(y.length=0,fre(this.footprintVertices,k.vertexOffset,k.vertexCount,x.footprintTileId.canonical,s.canonical,y),NP(x.footprint,y,this.footprintIndices.uint16,k.indexOffset,k.indexCount,-k.vertexOffset,-b)){j.flags|=_m;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(s,l,f){let m=!1;for(let y=0;y<f.footprintSegLen;y++){const x=this.footprintSegments[f.footprintSegIdx+y];let b=0;for(const j of x.ringIndices){for(let N=b,k=j+b-1;N<j+b;k=N++){const M=this.footprintVertices.int16[2*(N+x.vertexOffset)+0],D=this.footprintVertices.int16[2*(N+x.vertexOffset)+1],q=this.footprintVertices.int16[2*(k+x.vertexOffset)+1];D>l!=q>l&&s<(this.footprintVertices.int16[2*(k+x.vertexOffset)+0]-M)*(l-D)/(q-D)+M&&(m=!m)}b=j}}return m}getHeightAtTileCoord(s,l){let f=Number.NEGATIVE_INFINITY,m=!0;const y=4*(s+Zt)*Zt+(l+Zt);if(this.partLookup.hasOwnProperty(y)){const x=this.partLookup[y];return x?{height:x.height,hidden:!!(x.flags&_m)}:void 0}for(const x of this.centroidData)s>x.max.x||x.min.x>s||l>x.max.y||x.min.y>l||x.height<=f||this.footprintContainsPoint(s,l,x)&&(f=x.height,this.partLookup[y]=x,m=!!(x.flags&_m));if(f!==Number.NEGATIVE_INFINITY)return{height:f,hidden:m};this.partLookup[y]=void 0}}function uz(u,s){const l=u.add(s)._unit();return u.x*l.x+u.y*l.y}function hre(u,s,l,f){const m=s.sub(u)._perp()._unit(),y=l.sub(s)._perp()._unit();return dz(u,s,l,uz(m,y),f)}function dz(u,s,l,f,m){const y=Math.sqrt(1-f*f);return Math.min(u.dist(s)/3,s.dist(l)/3,m*y/f)}function kP(u,s,l){return u.x<l[0].x&&s.x<l[0].x||u.x>l[1].x&&s.x>l[1].x||u.y<l[0].y&&s.y<l[0].y||u.y>l[1].y&&s.y>l[1].y}function hz(u,s){return u.x<s[0].x||u.x>s[1].x||u.y<s[0].y||u.y>s[1].y}function fz(u,s,l){if(u.x<0||u.x>=Zt||s.x<0||s.x>=Zt||l.x<0||l.x>=Zt)return!1;const f=l.sub(s),m=f.perp(),y=u.sub(s);return(f.x*y.x+f.y*y.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(y.x*y.x+y.y*y.y))>-.866&&m.x*y.x+m.y*y.y<0}function pz(u,s,l){const f=s?2|u:-3&u;return l?1|f:-2&f}function mz(){const u=Math.PI/32,s=Math.tan(u),l=L;return l*Math.sqrt(1+2*s*s)-l}function gz(u,s,l){const f=1<<l.z,m=Ee(l.x/f),y=Ee((l.x+1)/f),x=xe(l.y/f),b=xe((l.y+1)/f);return function(j,N,k,M,D=0,q){const G=[];if(!j.length||!k||!M)return G;const ee=(Ce,Le)=>{for(const Ve of Ce)G.push({polygon:Ve,bounds:Le})},ne=Math.ceil(Math.log2(k)),ie=Math.ceil(Math.log2(M)),me=ne-ie,ye=[];for(let Ce=0;Ce<Math.abs(me);Ce++)ye.push(me>0?0:1);for(let Ce=0;Ce<Math.min(ne,ie);Ce++)ye.push(0),ye.push(1);let be=j;if(be=t2(be,N[0].y-D,N[1].y+D,1),be=t2(be,N[0].x-D,N[1].x+D,0),!be.length)return G;const Me=[];for(ye.length?Me.push({polygons:be,bounds:N,depth:0}):ee(be,N);Me.length;){const Ce=Me.pop(),Le=Ce.depth,Ve=ye[Le],He=Ce.bounds[0],mt=Ce.bounds[1],rt=Ve===0?He.x:He.y,gt=Ve===0?mt.x:mt.y,bt=q?q(Ve,rt,gt):.5*(rt+gt),Ct=t2(Ce.polygons,rt-D,bt+D,Ve),Gt=t2(Ce.polygons,bt-D,gt+D,Ve);if(Ct.length){const Ot=[He,new Rt(Ve===0?bt:mt.x,Ve===1?bt:mt.y)];ye.length>Le+1?Me.push({polygons:Ct,bounds:Ot,depth:Le+1}):ee(Ct,Ot)}if(Gt.length){const Ot=[new Rt(Ve===0?bt:He.x,Ve===1?bt:He.y),mt];ye.length>Le+1?Me.push({polygons:Gt,bounds:Ot,depth:Le+1}):ee(Gt,Ot)}}return G}(u,s,Math.ceil((y-m)/11.25),Math.ceil((x-b)/11.25),1,(j,N,k)=>{if(j===0)return .5*(N+k);{const M=xe((l.y+N/Zt)/f);return(de(.5*(xe((l.y+k/Zt)/f)+M))*f-l.y)*Zt}})}function fre(u,s,l,f,m,y){const x=Math.pow(2,f.z-m.z);for(let b=0;b<l;b++){let j=u.int16[2*(b+s)+0],N=u.int16[2*(b+s)+1];j=(j+m.x*Zt)*x-f.x*Zt,N=(N+m.y*Zt)*x-f.y*Zt,y.push(new Rt(j,N))}}let _z,yz;hr(a2,"FillExtrusionBucket",{omit:["layers","features"]}),hr(oz,"PartData"),hr(az,"FootprintSegment"),hr(lz,"BorderCentroidData"),hr(PP,"GroundEffect");class m_ extends Rt{constructor(s,l,f){super(s,l),this.z=f}}class xz extends m_{constructor(s,l,f,m){super(s,l,f),this.w=m}}function vz(u,s,l,f){const m=l==="x"?"y":"x",y=(f-u[l])/(s[l]-u[l]);u[m]=Math.round(u[m]+(s[m]-u[m])*y),u[l]=f,u.hasOwnProperty("z")&&(u.z=Ur(u.z,s.z,y)),u.hasOwnProperty("w")&&(u.w=Ur(u.w,s.w,y))}function wz(u,s,l,f){const m=l,y=f;for(const x of["x","y"]){let b=u,j=s;b[x]>=j[x]&&(b=s,j=u),b[x]<m&&j[x]>m&&vz(b,j,x,m),b[x]<y&&j[x]>y&&vz(j,b,x,y)}}function o2(u,s,l,f,m,y){const x=[];for(let b=0;b<u.length;b++){const j=u[b];let N;const k=x.length;let M=0;for(let D=0;D<j.length-1;D++){let q=j[D],G=j[D+1],ee=0;const ne=M;let ie,me;y&&(ee=Math.hypot(G.x-q.x,G.y-q.y),M+=ee,ie=q,me=G),q.x<s&&G.x<s||(q.x<s?q=new Rt(s,q.y+(s-q.x)/(G.x-q.x)*(G.y-q.y))._round():G.x<s&&(G=new Rt(s,q.y+(s-q.x)/(G.x-q.x)*(G.y-q.y))._round()),q.y<l&&G.y<l||(q.y<l?q=new Rt(q.x+(l-q.y)/(G.y-q.y)*(G.x-q.x),l)._round():G.y<l&&(G=new Rt(q.x+(l-q.y)/(G.y-q.y)*(G.x-q.x),l)._round()),q.x>=f&&G.x>=f||(q.x>=f?q=new Rt(f,q.y+(f-q.x)/(G.x-q.x)*(G.y-q.y))._round():G.x>=f&&(G=new Rt(f,q.y+(f-q.x)/(G.x-q.x)*(G.y-q.y))._round()),q.y>=m&&G.y>=m||(q.y>=m?q=new Rt(q.x+(m-q.y)/(G.y-q.y)*(G.x-q.x),m)._round():G.y>=m&&(G=new Rt(q.x+(m-q.y)/(G.y-q.y)*(G.x-q.x),m)._round()),N&&q.equals(N[N.length-1])||(N=[q],x.push(N),y&&y.push({progress:{min:ne+bz(ie,me,q)*ee,max:1},parentIndex:b,prevPoint:ie,nextPoint:me})),N.push(G),y&&(y[y.length-1].progress.max=ne+bz(ie,me,G)*ee,y[y.length-1].nextPoint=me)))))}if(y&&M>0)for(let D=k;D<x.length;D++)y[D].progress.min/=M,y[D].progress.max/=M}return x}function pre(u,s,l,f,m){if(u.length<2)return void f.push(u);const y=[];for(;s.valid();){const[N,k]=s.get();for(let M=0;M<u.length-1;M++){const D=u[M],q=u[M+1],G=oc(D,q,N,k);if(G){const[ee]=G,ne=new Rt(Ur(D.x,q.x,ee),Ur(D.y,q.y,ee));y.push({t:M+ee,distance:0,point:ne})}}s.next()}if(y.length===0)return void f.push(u);y.sort((N,k)=>N.t-k.t);let x=0,b=0,j=[];for(f.push(j);x!==u.length;){if(b===y.length){for(;x!==u.length;)j.length!==0&&j[j.length-1].equals(u[x])||j.push(u[x]),x++;break}y[b].t<=x?(j.length!==0&&j[j.length-1].equals(y[b].point)||j.push(y[b].point),Math.trunc(y[b].t),b++):(j.length!==0&&j[j.length-1].equals(u[x])||j.push(u[x]),x++)}}function bz(u,s,l){return u.x!==s.x?(l.x-u.x)/(s.x-u.x):u.y!==s.y?(l.y-u.y)/(s.y-u.y):0}function zb(u,s){return u.x*s.x+u.y*s.y}function Sz(u,s){if(u.length===1){let l=0;const f=s[l++];let m;for(;!m||f.equals(m);)if(m=s[l++],!m)return 1/0;for(;l<s.length;l++){const y=s[l],x=u[0],b=m.sub(f),j=y.sub(f),N=x.sub(f),k=zb(b,b),M=zb(b,j),D=zb(j,j),q=zb(N,b),G=zb(N,j),ee=k*D-M*M,ne=(D*q-M*G)/ee,ie=(k*G-M*q)/ee,me=f.z*(1-ne-ie)+m.z*ne+y.z*ie;if(isFinite(me))return me}return 1/0}{let l=1/0;for(const f of s)l=Math.min(l,f.z);return l}}function Ez(u,s,l){let f=1/0;ki(l,s)&&(f=Sz(l,s[0]));for(let m=0;m<s.length;m++){const y=s[m],x=u[m];for(let b=0;b<y.length-1;b++){const j=y[b],N=[j,y[b+1],x[b+1],x[b],j];Vi(l,N)&&(f=Math.min(f,Sz(l,N)))}}return f!==1/0&&f}function Tz(u,s,l,f,m,y,x,b,j,N,k){return u.projection.name==="globe"?function(M,D,q,G,ee,ne,ie,me,ye,be,Me){const Ce=[],Le=[],Ve=M.projection.upVectorScale(Me,M.center.lat,M.worldSize).metersToTile,He=[0,0,0,1],mt=[0,0,0,1],rt=(bt,Ct,Gt,Ot)=>{bt[0]=Ct,bt[1]=Gt,bt[2]=Ot,bt[3]=1},gt=mz();q>0&&(q+=gt),G+=gt;for(const bt of D){const Ct=[],Gt=[];for(const Ot of bt){const Et=Ot.x+ee.x,Dt=Ot.y+ee.y,ht=M.projection.projectTilePoint(Et,Dt,Me),ut=M.projection.upVector(Me,Ot.x,Ot.y);let kt=q,$t=G;if(ie){const It=jz(Et,Dt,q,G,ie,me,ye,be);kt+=It.base,$t+=It.top}q!==0?rt(He,ht.x+ut[0]*Ve*kt,ht.y+ut[1]*Ve*kt,ht.z+ut[2]*Ve*kt):rt(He,ht.x,ht.y,ht.z),rt(mt,ht.x+ut[0]*Ve*$t,ht.y+ut[1]*Ve*$t,ht.z+ut[2]*Ve*$t),ln(He,He,ne),ln(mt,mt,ne),Ct.push(new m_(He[0],He[1],He[2])),Gt.push(new m_(mt[0],mt[1],mt[2]))}Ce.push(Ct),Le.push(Gt)}return[Ce,Le]}(u,s,l,f,m,y,x,b,j,N,k):x?function(M,D,q,G,ee,ne,ie,me,ye){const be=[],Me=[],Ce=[0,0,0,1];for(const Le of M){const Ve=[],He=[];for(const mt of Le){const rt=mt.x+G.x,gt=mt.y+G.y,bt=jz(rt,gt,D,q,ne,ie,me,ye);Ce[0]=rt,Ce[1]=gt,Ce[2]=bt.base,Ce[3]=1,sn(Ce,Ce,ee),Ce[3]=Math.max(Ce[3],1e-5);const Ct=new m_(Ce[0]/Ce[3],Ce[1]/Ce[3],Ce[2]/Ce[3]);Ce[0]=rt,Ce[1]=gt,Ce[2]=bt.top,Ce[3]=1,sn(Ce,Ce,ee),Ce[3]=Math.max(Ce[3],1e-5);const Gt=new m_(Ce[0]/Ce[3],Ce[1]/Ce[3],Ce[2]/Ce[3]);Ve.push(Ct),He.push(Gt)}be.push(Ve),Me.push(He)}return[be,Me]}(s,l,f,m,y,x,b,j,N):function(M,D,q,G,ee){const ne=[],ie=[],me=ee[8]*D,ye=ee[9]*D,be=ee[10]*D,Me=ee[11]*D,Ce=ee[8]*q,Le=ee[9]*q,Ve=ee[10]*q,He=ee[11]*q;for(const mt of M){const rt=[],gt=[];for(const bt of mt){const Ct=bt.x+G.x,Gt=bt.y+G.y,Ot=ee[0]*Ct+ee[4]*Gt+ee[12],Et=ee[1]*Ct+ee[5]*Gt+ee[13],Dt=ee[2]*Ct+ee[6]*Gt+ee[14],ht=ee[3]*Ct+ee[7]*Gt+ee[15],ut=Ot+me,kt=Et+ye,$t=Dt+be,It=Math.max(ht+Me,1e-5),ur=Ot+Ce,_r=Et+Le,ir=Dt+Ve,Jt=Math.max(ht+He,1e-5);rt.push(new m_(ut/It,kt/It,$t/It)),gt.push(new m_(ur/Jt,_r/Jt,ir/Jt))}ne.push(rt),ie.push(gt)}return[ne,ie]}(s,l,f,m,y)}function jz(u,s,l,f,m,y,x,b){const j=x*m.getElevationAt(u,s,!0,!0),N=y[0]!==0,k=N?y[1]===0?x*(y[0]/sz-iz):x*function(M,D,q){const G=Math.floor(D[0]/8),ee=Math.floor(D[1]/8),ne=10*(D[0]-8*G),ie=10*(D[1]-8*ee),me=M.getElevationAt(G,ee,!0,!0),ye=M.getMeterToDEM(q),be=Math.floor(.5*(ne*ye-1)),Me=Math.floor(.5*(ie*ye-1)),Ce=M.tileCoordToPixel(G,ee),Le=2*be+1,Ve=2*Me+1,He=function(Gt,Ot,Et,Dt,ht){return[Gt.getElevationAtPixel(Ot,Et,!0),Gt.getElevationAtPixel(Ot+ht,Et,!0),Gt.getElevationAtPixel(Ot,Et+ht,!0),Gt.getElevationAtPixel(Ot+Dt,Et+ht,!0)]}(M,Ce.x-be,Ce.y-Me,Le,Ve),mt=Math.abs(He[0]-He[1]),rt=Math.abs(He[2]-He[3]),gt=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),bt=Math.min(.25,.5*ye*(mt+rt)/Le),Ct=Math.min(.25,.5*ye*gt/Ve);return me+Math.max(bt*ne,Ct*ie)}(m,y,b):j;return{base:j+(l===0?-1:l),top:N?Math.max(k+f,j+l+2):j+f}}class mre{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class gre{constructor(){this.tasks={},this.taskQueue=[],at(["process"],this),this.invoker=new mre(this.process),this.nextId=0}add(s,l){const f=this.nextId++,m=function({type:y,isSymbolTile:x,zoom:b}){return b=b||0,y==="message"?0:y!=="maybePrepare"||x?y!=="parseTile"||x?y==="parseTile"&&x?300-b:y==="maybePrepare"&&x?400-b:500:200-b:100-b}(l);if(m===0){try{s()}finally{}return null}return this.tasks[f]={fn:s,metadata:l,priority:m,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const s=this.pick();if(s===null)return;const l=this.tasks[s];if(delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let s=null,l=1/0;for(let m=0;m<this.taskQueue.length;m++){const y=this.tasks[this.taskQueue[m]];y.priority<l&&(l=y.priority,s=m)}if(s===null)return null;const f=this.taskQueue[s];return this.taskQueue.splice(s,1),f}remove(){this.invoker.remove()}}class Nz{constructor(s,l,f){this.target=s,this.parent=l,this.mapId=f,this.callbacks={},this.cancelCallbacks={},at(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new gre}send(s,l,f,m,y=!1,x){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(f.metadata=x,this.callbacks[b]=f);const j=new Set;return this.target.postMessage({id:b,type:s,hasCallback:!!f,targetMapId:m,mustQueue:y,sourceMapId:this.mapId,data:Ih(l,j)},j),{cancel:()=>{f&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(s){const l=s.data;if(!l)return;const f=l.id;if(f&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const m=this.cancelCallbacks[f];delete this.cancelCallbacks[f],m&&m.cancel()}else if(l.mustQueue||li(self)){const m=this.callbacks[f],y=this.scheduler.add(()=>this.processTask(f,l),m&&m.metadata||{type:"message"});y&&(this.cancelCallbacks[f]=y)}else this.processTask(f,l)}processTask(s,l){if(delete this.cancelCallbacks[s],l.type==="<response>"){const f=this.callbacks[s];delete this.callbacks[s],f&&(l.error?f(Ch(l.error)):f(null,Ch(l.data)))}else{const f=new Set,m=l.hasCallback?(x,b)=>{this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:x?Ih(x):null,data:Ih(b,f)},f)}:()=>{},y=Ch(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,y,m);else if(this.parent.getWorkerSource){const x=l.type.split("."),{source:b,scope:j}=y;this.parent.getWorkerSource(l.sourceMapId,x[0],b,j)[x[1]](y,m)}else m(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Bb={workerUrl:"",workerClass:null,workerParams:void 0};const RP="mapboxgl_preloaded_worker_pool";class g_{constructor(){this.active={}}acquire(s,l=g_.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<l;)this.workers.push(Bb.workerClass!=null?new Bb.workerClass:new self.Worker(Bb.workerUrl,Bb.workerParams));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[RP]}numActive(){return Object.keys(this.active).length}}g_.workerCount=2;class qx{constructor(s,l,f="Worker",m=g_.workerCount){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=ct();const y=this.workerPool.acquire(this.id,m);for(let x=0;x<y.length;x++){const b=new qx.Actor(y[x],l,this.id);b.name=`${f} ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,l,f){Fe(this.actors,(m,y)=>{m.send(s,l,y)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Vb,MP;function l2(){return Vb||(Vb=new g_),Vb}qx.Actor=Nz;class _re{constructor(s){this.module=s}createIntArray(s){const l=new Int32Array(s),f=this.module.malloc(l.length*l.BYTES_PER_ELEMENT);return this.module.heap32.set(l,f/l.BYTES_PER_ELEMENT),f}createFloatArray(s){const l=new Float32Array(s),f=this.module.malloc(l.length*l.BYTES_PER_ELEMENT);return this.module.heapF32.set(l,f/l.BYTES_PER_ELEMENT),f}createStringBuffer(s){const l=this.module.malloc(s.length+1);for(let f=0;f<s.length;++f)this.module.heapU8[l+f]=s.charCodeAt(f);return this.module.heapU8[l+s.length]=0,l}readStringBuffer(s){let l="";for(;this.module.heapU8[s]!==0;)l+=String.fromCharCode(this.module.heapU8[s]),++s;return l}setStyle(s){const l=s.entranceColorRgb,f=s.facadeGlazingColorRgb,m=s.roofColorRgb,y=s.wallColorRgb,x=s.normalScale;this.module.setStyle(l[0],l[1],l[2],f[0],f[1],f[2],m[0],m[1],m[2],y[0],y[1],y[2],x[0],x[1],x[2],s.tileToMeters)}setAOOptions(s,l){this.module.setAOOptions(s?1:0,l)}setMetricOptions(s,l){this.module.setMetricOptions(s?1:0,l)}setStructuralOptions(s){this.module.setStructuralOptions(s?1:0)}setFacadeOptions(s,l){this.module.setFacadeOptions(s,l?1:0)}setFauxFacadeOptions(s,l,f){this.module.setFauxFacadeOptions(s?1:0,l?1:0,f)}setFacadeClassifierOptions(s){this.module.setFacadeClassifierOptions(s)}generateMesh(s,l){for(const b of s){const j=this.createStringBuffer(b.roofType),N=[0],k=[];for(const q of b.coordinates)if(Array.isArray(q)){for(const G of q)k.push(G.x),k.push(G.y);N.push(k.length)}const M=this.createIntArray(N),D=this.createFloatArray(k);this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,j,b.roofType.length,D,M,N.length-1),this.module.free(j),this.module.free(M),this.module.free(D)}for(const b of l){let j;j=b.entrances?JSON.parse(b.entrances):[];const N=this.createFloatArray(j),k=[];for(const D of b.coordinates)k.push(D.x),k.push(D.y);const M=this.createFloatArray(k);this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,N,j.length,M,k.length),this.module.free(N),this.module.free(M)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const f=this.module.getMeshCount(),m=new Array(f);for(let b=0;b<f;b++){const j=this.module.getPositionsPtr(b),N=this.module.getPositionsLength(b),k=new Float32Array(this.module.heapF32.buffer,j,N),M=this.module.getNormalsPtr(b),D=this.module.getNormalsLength(b),q=new Float32Array(this.module.heapF32.buffer,M,D),G=this.module.getColorsPtr(b),ee=this.module.getColorsLength(b),ne=new Uint8Array(this.module.heapU8.buffer,G,ee),ie=this.module.getAOPtr(b),me=this.module.getAOLength(b),ye=new Float32Array(this.module.heapF32.buffer,ie,me),be=this.module.getUVPtr(b),Me=this.module.getUVLength(b),Ce=new Float32Array(this.module.heapF32.buffer,be,Me),Le=this.module.getFauxFacadePtr(b),Ve=this.module.getFauxFacadeLength(b),He=new Uint8Array(this.module.heapU8.buffer,Le,Ve),mt=this.module.getIndicesPtr(b),rt=this.module.getIndicesLength(b),gt=new Int32Array(this.module.heap32.buffer,mt,rt),bt=this.module.getBuildingPart(b),Ct=this.readStringBuffer(bt);m[b]={positions:k,normals:q,colors:ne,ao:ye,uv:Ce,isFauxFacade:He,indices:gt,buildingPart:Ct}}const y=this.module.getRingCount(),x=[];for(let b=0;b<y;b++){const j=this.module.getRingPtr(b),N=this.module.getRingLength(b),k=new Float32Array(this.module.heapF32.buffer,j,N);x.push(k)}return{meshes:m,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:x}}}let Ub,DP,Cd,Gx,OP,Hx=null,Wx=null,Iz=null,c2=null;function Cz(){return li(self)&&self.worker.dracoUrl?self.worker.dracoUrl:DP||Ks.DRACO_URL}function Az(){if(li(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Gx)return Gx;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Gx=WebAssembly.validate(u)?Ks.MESHOPT_SIMD_URL:Ks.MESHOPT_URL,Gx}function yre(){return c2}const u2={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xre={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},$b={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Pz(u,s,l){const f=l.json.bufferViews.length,m=l.buffers.length;s.bufferView=f,l.json.bufferViews[f]={buffer:m,byteLength:u.byteLength},l.buffers[m]=u}const LP="KHR_draco_mesh_compression";function vre(u,s){const l=u.extensions&&u.extensions[LP];if(!l)return;const f=new Cd.Decoder,m=Dz(s,l.bufferView),y=new Cd.Mesh;if(!f.DecodeArrayToMesh(m,m.byteLength,y))throw new Error("Failed to decode Draco mesh");const x=s.json.accessors[u.indices],b=u2[x.componentType],j=x.count*b.BYTES_PER_ELEMENT,N=Cd._malloc(j);b===Uint16Array?f.GetTrianglesUInt16Array(y,j,N):f.GetTrianglesUInt32Array(y,j,N),Pz(Cd.memory.buffer.slice(N,N+j),x,s),Cd._free(N);for(const k of Object.keys(l.attributes)){const M=f.GetAttributeByUniqueId(y,l.attributes[k]),D=s.json.accessors[u.attributes[k]],q=xre[D.componentType],G=D.count*$b[D.type]*u2[D.componentType].BYTES_PER_ELEMENT,ee=Cd._malloc(G);f.GetAttributeDataArrayForAllPoints(y,M,Cd[q],G,ee),Pz(Cd.memory.buffer.slice(ee,ee+G),D,s),Cd._free(ee)}f.destroy(),y.destroy(),delete u.extensions[LP]}const d2="EXT_meshopt_compression";function wre(u,s){if(!u.extensions||!u.extensions[d2])return;const l=u.extensions[d2],f=new Uint8Array(s.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),m=new Uint8Array(l.count*l.byteStride);OP.decodeGltfBuffer(m,l.count,l.byteStride,f,l.mode,l.filter),u.buffer=s.buffers.length,u.byteOffset=0,s.buffers[u.buffer]=m.buffer,delete u.extensions[d2]}const kz=1179937895,Rz=new TextDecoder("utf8");function Mz(u,s){return new URL(u,s).href}function bre(u,s,l,f){return fetch(Mz(u.uri,f)).then(m=>m.arrayBuffer()).then(m=>{s.buffers[l]=m})}function Dz(u,s){const l=u.json.bufferViews[s];return new Uint8Array(u.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function Sre(u,s,l,f){if(u.uri){const m=Mz(u.uri,f);return fetch(m).then(y=>y.blob()).then(y=>createImageBitmap(y)).then(y=>{s.images[l]=y})}if(u.bufferView!==void 0){const m=Dz(s,u.bufferView),y=new Blob([m],{type:u.mimeType});return createImageBitmap(y).then(x=>{s.images[l]=x})}}function Oz(u,s=0,l){const f={json:null,images:[],buffers:[]};if(new Uint32Array(u,s,1)[0]===kz){const k=new Uint32Array(u,s);let M=2;const D=(k[M++]>>2)-3,q=k[M++]>>2;if(M++,f.json=JSON.parse(Rz.decode(k.subarray(M,M+q))),M+=q,M<D){const G=k[M++];M++;const ee=s+(M<<2);f.buffers[0]=u.slice(ee,ee+G)}}else f.json=JSON.parse(Rz.decode(new Uint8Array(u,s)));const{buffers:m,images:y,meshes:x,extensionsUsed:b,bufferViews:j}=f.json;let N=Promise.resolve();if(m){const k=[];for(let M=0;M<m.length;M++){const D=m[M];D.uri?k.push(bre(D,f,M,l)):f.buffers[M]||(f.buffers[M]=null)}N=Promise.all(k)}return N.then(()=>{const k=[],M=b&&b.includes(LP),D=b&&b.includes(d2);if(M&&k.push(function(){if(!Cd)return Ub??(Ub=function(q){let G,ee=null;function ne(){G=new Uint8Array(ee.buffer)}function ie(){throw new Error("Unexpected Draco error.")}const me={a:{a:ie,d:function(ye,be,Me){return G.copyWithin(ye,be,be+Me)},c:function(ye){const be=G.length,Me=Math.max(ye>>>0,Math.ceil(1.2*be)),Ce=Math.ceil((Me-be)/65536);try{return ee.grow(Ce),ne(),!0}catch{return!1}},b:ie}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(q,me):q.then(ye=>ye.arrayBuffer()).then(ye=>WebAssembly.instantiate(ye,me))).then(ye=>{const{Rb:be,Qb:Me,P:Ce,T:Le,X:Ve,Ja:He,La:mt,Qa:rt,Va:gt,Wa:bt,eb:Ct,jb:Gt,f:Ot,e:Et,yb:Dt,zb:ht,Ab:ut,Bb:kt,Db:$t,Gb:It}=ye.instance.exports;ee=Et;const ur=(()=>{let _r=0,ir=0,Jt=0,Qr=0;return tr=>{Jt&&(be(Qr),be(_r),ir+=Jt,Jt=_r=0),_r||(ir+=128,_r=Me(ir));const Pr=tr.length+7&-8;let an=_r;Pr>=ir&&(Jt=Pr,an=Qr=Me(Pr));for(let Sn=0;Sn<tr.length;Sn++)G[an+Sn]=tr[Sn];return an}})();return ne(),Ot(),{memory:Et,_free:be,_malloc:Me,Mesh:class{constructor(){this.ptr=Ce()}destroy(){Le(this.ptr)}},Decoder:class{constructor(){this.ptr=He()}destroy(){Gt(this.ptr)}DecodeArrayToMesh(_r,ir,Jt){const Qr=ur(_r),tr=mt(this.ptr,Qr,ir,Jt.ptr);return!!Ve(tr)}GetAttributeByUniqueId(_r,ir){return{ptr:rt(this.ptr,_r.ptr,ir)}}GetTrianglesUInt16Array(_r,ir,Jt){gt(this.ptr,_r.ptr,ir,Jt)}GetTrianglesUInt32Array(_r,ir,Jt){bt(this.ptr,_r.ptr,ir,Jt)}GetAttributeDataArrayForAllPoints(_r,ir,Jt,Qr,tr){Ct(this.ptr,_r.ptr,ir.ptr,Jt,Qr,tr)}},DT_INT8:Dt(),DT_UINT8:ht(),DT_INT16:ut(),DT_UINT16:kt(),DT_UINT32:$t(),DT_FLOAT32:It()}})}(fetch(Cz())),Ub.then(q=>{Cd=q,Ub=void 0}))}()),D&&k.push(function(){if(OP)return;const q=function(G){let ee;const ne=WebAssembly.instantiateStreaming(G,{}).then(ye=>{ee=ye.instance,ee.exports.__wasm_call_ctors()}),ie={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},me={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ne,supported:!0,decodeGltfBuffer(ye,be,Me,Ce,Le,Ve){(function(He,mt,rt,gt,bt,Ct,Gt){const Ot=He.exports.sbrk,Et=gt+3&-4,Dt=Ot(Et*bt),ht=Ot(Ct.length),ut=new Uint8Array(He.exports.memory.buffer);ut.set(Ct,ht);const kt=mt(Dt,gt,bt,ht,Ct.length);if(kt===0&&Gt&&Gt(Dt,Et,bt),rt.set(ut.subarray(Dt,Dt+gt*bt)),Ot(Dt-Ot(0)),kt!==0)throw new Error(`Malformed buffer data: ${kt}`)})(ee,ee.exports[me[Le]],ye,be,Me,Ce,ee.exports[ie[Ve]])}}}(fetch(Az()));return q.ready.then(()=>{OP=q})}()),y)for(let q=0;q<y.length;q++)k.push(Sre(y[q],f,q,l));return(k.length?Promise.all(k):Promise.resolve()).then(()=>{if(M&&x)for(const{primitives:q}of x)for(const G of q)vre(G,f);if(D&&x&&j)for(const q of j)wre(q,f);return f})})}function Lz(u){return fetch(u).then(s=>s.arrayBuffer()).then(s=>Oz(s,0,u))}function FP(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function zP(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class BP{constructor(s,l,f,m){this.context=s,this.format=f,this.useMipmap=m&&m.useMipmap,this.texture=s.gl.createTexture(),this.update(l,{premultiply:m&&m.premultiply})}update(s,l){const f=s&&s instanceof HTMLVideoElement&&s.width===0?s.videoWidth:s.width,m=s&&s instanceof HTMLVideoElement&&s.height===0?s.videoHeight:s.height,{context:y}=this,{gl:x}=y,{x:b,y:j}=l&&l.position?l.position:{x:0,y:0},N=b+f,k=j+m;!this.size||this.size[0]===N&&this.size[1]===k||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!l||l.premultiply!==!1));const M=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap;if(!this.size&&N>0&&k>0){const D=this.useMipmap?Math.floor(Math.log2(Math.max(N,k)))+1:1;x.texStorage2D(x.TEXTURE_2D,D,this.format,N,k),this.size=[N,k]}this.size&&(M?x.texSubImage2D(x.TEXTURE_2D,0,b,j,FP(this.format),zP(this.format),s):"data"in s&&s.data&&x.texSubImage2D(x.TEXTURE_2D,0,b,j,f,m,FP(this.format),zP(this.format),s.data)),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(s,l,f=!1){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),s!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap&&!f?s===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),l!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,l),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(s,l,f,m,y){const{context:x}=this,{gl:b}=x;b.bindTexture(b.TEXTURE_2D,this.texture),l!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,l),this.magFilter=l),s!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?s===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),f!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f),this.wrapS=f),m!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,m),this.wrapT=m),y!==this.compareMode&&(y?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,y)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=y)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class qb{constructor(s,l){this.context=s,this.texture=l}bind(s,l){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,s),this.minFilter=s),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}}const Ere=In([{name:"a_pos_3f",components:3,type:"Float32"}]),Tre=In([{name:"a_color_3f",components:3,type:"Float32"}]),jre=In([{name:"a_color_4f",components:4,type:"Float32"}]),Nre=In([{name:"a_uv_2f",components:2,type:"Float32"}]),Ire=In([{name:"a_normal_3f",components:3,type:"Float32"}]),Cre=In([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Are=In([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function Fz(u,s){const l=h2(u.projection,u.zoom,u.width,u.height),f=function(y,x,b,j,N){const k=new H(b.lng-180*ym,b.lat),M=new H(b.lng+180*ym,b.lat),D=y.project(k.lng,k.lat),q=y.project(M.lng,M.lat),G=-Math.atan2(q.y-D.y,q.x-D.x),ee=et.fromLngLat(b);ee.y=he(ee.y,-1+ym,1-ym);const ne=ee.toLngLat(),ie=y.project(ne.lng,ne.lat),me=et.fromLngLat(ne);me.x+=ym;const ye=me.toLngLat(),be=y.project(ye.lng,ye.lat),Me=Bz(be.x-ie.x,be.y-ie.y,G),Ce=et.fromLngLat(ne);Ce.y+=ym;const Le=Ce.toLngLat(),Ve=y.project(Le.lng,Le.lat),He=Bz(Ve.x-ie.x,Ve.y-ie.y,G),mt=Math.abs(Me.x)/Math.abs(He.y),rt=K([]);pe(rt,rt,-G*(1-(N?0:j)));const gt=K([]);return Q(gt,gt,[1,1-(1-mt)*j,1]),gt[4]=-He.x/He.y*j,pe(gt,gt,G),$(gt,rt,gt),gt}(u.projection,0,u.center,l,s),m=zz(u);return Q(f,f,[m,m,1]),f}function zz(u){const s=u.projection,l=h2(u.projection,u.zoom,u.width,u.height),f=VP(s,u.center),m=VP(s,H.convert(s.center));return Math.pow(2,f*l+(1-l)*m)}function h2(u,s,l,f,m=1/0){const y=u.range;if(!y)return 0;const x=Math.min(m,Math.max(l,f)),b=Math.log2(x/1024);return Ne(y[0]+b,y[1]+b,s)}const ym=1/4e4;function VP(u,s){const l=he(s.lat,-Te,Te),f=new H(s.lng-180*ym,l),m=new H(s.lng+180*ym,l),y=u.project(f.lng,l),x=u.project(m.lng,l),b=et.fromLngLat(f),j=et.fromLngLat(m),N=x.x-y.x,k=x.y-y.y,M=j.x-b.x,D=j.y-b.y,q=Math.sqrt((M*M+D*D)/(N*N+k*k));return Math.log2(q)}function Bz(u,s,l){const f=Math.cos(l),m=Math.sin(l);return{x:u*f-s*m,y:u*m+s*f}}function Vz(u,s,l){K(u),pe(u,u,Nn(s[2])),re(u,u,Nn(s[0])),ve(u,u,Nn(s[1])),Q(u,u,l),$(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function f2(u,s,l,f,m,y,x,b){const j=[l[0]-s[0],l[1]-s[1],0],N=[f[0]-s[0],f[1]-s[1],0];if(Ze(j)<1e-12||Ze(N)<1e-12)return ys(u);const k=on([],j,N);jr(k,k),st(N,f,s),j[2]=(y-m)*b,N[2]=(x-m)*b;const M=j;return on(M,j,N),jr(M,M),kc(u,k,M)}function p2(u,s,l=!1){const f=mm(s.zoom),m=function(y,x,b){const j=x.worldSize,N=[y[12],y[13],y[14]],k=xe(N[1]/j),M=Ee(N[0]/j),D=K([]),q=_e(1,k)*j,G=_e(1,0)*j*Pe(k,x.zoom),ee=1/gP(j);let ne=G*ee;if(b){const be=h2(x.projection,x.zoom,x.width,x.height,1024);ne=ee*x.projection.pixelSpaceConversion(x.center.lat,j,be)}const ie=A(k,M);$e(ie,ie,St([],jr([],ie),q*ne*N[2]));const me=function(be){const Me=[be[0],be[1],be[2]];let Ce=[0,1,0];const Le=on([],Ce,Me);return on(Ce,Me,Le),Wt(Ce)===0&&(Ce=[0,1,0],on(Le,Me,Ce)),jr(Le,Le),jr(Ce,Ce),jr(Me,Me),[Le[0],Le[1],Le[2],0,Ce[0],Ce[1],Ce[2],0,Me[0],Me[1],Me[2],0,be[0],be[1],be[2],1]}(ie);Q(D,D,[ne,ne,ne*q]),X(D,D,[-N[0],-N[1],-N[2]]);const ye=$([],x.globeMatrix,me);return $(ye,ye,D),$(ye,ye,y),ye}(u,s,l);if(f>0){const y=function(x,b){const j=b.worldSize,N=_e(1,0)*j*Pe(b.center.lat,b.zoom)/gP(j),k=_e(1,b.center.lat)*j,M=K([]);ve(M,M,Nn(b.center.lng)),re(M,M,Nn(b.center.lat)),X(M,M,[0,0,xl]),Q(M,M,[N,N,N*k]);const D=b.point;return X(M,M,[-D.x,-D.y,0]),$(M,M,x),$(M,b.globeMatrix,M)}(u,s);return function(x,b,j){const N=(G,ee,ne)=>{const ie=Ze(G),me=Ze(ee),ye=Ff(G,ee,ne);return St(ye,ye,1/Ze(ye)*Ur(ie,me,ne))},k=N([x[0],x[1],x[2]],[b[0],b[1],b[2]],j),M=N([x[4],x[5],x[6]],[b[4],b[5],b[6]],j),D=N([x[8],x[9],x[10]],[b[8],b[9],b[10]],j),q=Ff([x[12],x[13],x[14]],[b[12],b[13],b[14]],j);return[k[0],k[1],k[2],0,M[0],M[1],M[2],0,D[0],D[1],D[2],0,q[0],q[1],q[2],1]}(m,y,f)}return m}function UP(u,s,l,f){const m=wn.projectAabbCorners(f,l);let y=Number.MAX_VALUE;for(let b=0;b<m.length;++b){const j=m[b];j[0]=(.5*j[0]+.5)*s.width,j[1]=(.5-.5*j[1])*s.height,j[2]<y&&(y=j[2])}const x=function(b){const j=[];let N=0;for(let q=1;q<b.length;q++)(b[q][0]<b[N][0]||b[q][0]===b[N][0]&&b[q][1]<b[N][1])&&(N=q);let k,M=N;const D=new Uint8Array(b.length);do{if(D[M])break;j.push(new Rt(b[M][0],b[M][1])),D[M]=1,k=(M+1)%b.length;for(let q=0;q<b.length;q++){if(b[q][0]===b[k][0]&&b[q][1]===b[k][1]||b[q][0]===b[M][0]&&b[q][1]===b[M][1])continue;const G=[b[q][0]-b[M][0],b[q][1]-b[M][1]],ee=[b[k][0]-b[M][0],b[k][1]-b[M][1]],ne=G[0]*ee[1]-G[1]*ee[0];(ne>0||ne===0&&G[0]*ee[0]+G[1]*ee[1]>=0&&G[0]*G[0]+G[1]*G[1]>ee[0]*ee[0]+ee[1]*ee[1])&&(k=q)}M=k}while(M!==N);return j.length>0&&j.push(j[0]),j}(m);if(Vi(u,x))return y}const __=64,Zx={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function m2(u,s,l,f,m,y,x,b,j,N=!1){const k=l.zoom,M=l.project(f),D=Pe(f.lat,k),q=1/D;K(u),X(u,u,[M.x+x[0]*q,M.y+x[1]*q,x[2]]);let G=1,ee=1;const ne=l.worldSize;if(N){if(l.projection.name==="mercator"){let be=0;l.elevation&&(be=l.elevation.getAtPointOrZero(new et(M.x/ne,M.y/ne),0));const Me=sn([],[M.x,M.y,be,1],l.projMatrix)[3]/l.cameraToCenterDistance;G=Me,ee=Me*Pe(l.center.lat,k)}else if(l.projection.name==="globe"){const be=p2(u,l),Me=[0,0,0,1];sn(Me,Me,$([],l.projMatrix,be));const Ce=Me[3]/l.cameraToCenterDistance,Le=mm(k),Ve=l.projection.pixelsPerMeter(f.lat,ne)*Pe(f.lat,k),He=l.projection.pixelsPerMeter(l.center.lat,ne)*Pe(l.center.lat,k);G=Ce/Ur(Ve,De(l.center.lat),Le),ee=Ce*D/Ve,G*=He,ee*=He}}else G=q;Q(u,u,[G,G,ee]);const ie=[...u],me=s.orientation,ye=[];if(Vz(ye,[me[0]+(m?m[0]:0),me[1]+(m?m[1]:0),me[2]+(m?m[2]:0)],y),$(u,ie,ye),b&&l.elevation){let be=0;const Me=[];if(j&&l.elevation){be=function(Le,Ve,He,mt,rt){const gt=Ve.elevation;if(!gt)return 0;const bt=wn.projectAabbCorners(He,mt),Ct=_e(1,rt.lat)*Ve.worldSize,Gt=function(ir,Jt){const Qr=[0,0,1],tr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Pr of tr){const an=ir[Pr.corners[0]],Sn=ir[Pr.corners[1]],Hn=ir[Pr.corners[2]],cn=[Sn[0]-an[0],Sn[1]-an[1],Jt*(Sn[2]-an[2])],ts=on(cn,cn,[Hn[0]-an[0],Hn[1]-an[1],Jt*(Hn[2]-an[2])]);jr(ts,ts),Pr.dotProductWithUp=Br(ts,Qr)}return tr.sort((Pr,an)=>Pr.dotProductWithUp-an.dotProductWithUp),tr[0].corners}(bt,Ct),Ot=bt[Gt[0]],Et=bt[Gt[1]],Dt=bt[Gt[2]],ht=bt[Gt[3]],ut=gt.getAtPointOrZero(new et(Ot[0]/Ve.worldSize,Ot[1]/Ve.worldSize),0),kt=gt.getAtPointOrZero(new et(Et[0]/Ve.worldSize,Et[1]/Ve.worldSize),0),$t=gt.getAtPointOrZero(new et(Dt[0]/Ve.worldSize,Dt[1]/Ve.worldSize),0),It=gt.getAtPointOrZero(new et(ht[0]/Ve.worldSize,ht[1]/Ve.worldSize),0),ur=(ut+It)/2,_r=(kt+$t)/2;return ur>_r?kt<$t?f2(Le,Et,ht,Ot,kt,It,ut,Ct):f2(Le,Dt,Ot,ht,$t,ut,It,Ct):ut<It?f2(Le,Ot,Et,Dt,ut,kt,$t,Ct):f2(Le,ht,Dt,Et,It,$t,kt,Ct),Math.max(ur,_r)}(Me,l,s.aabb,u,f);const Ce=$([],Se([],Me),ye);$(u,ie,Ce)}else be=l.elevation.getAtPointOrZero(new et(M.x/ne,M.y/ne),0);be!==0&&(u[14]+=be)}}class Uz{constructor(s,l,f,m,y){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=s,this.uri=l,this.position=f!=null?new H(f[0],f[1]):new H(0,0),this.orientation=m??[0,0,0],this.nodes=y,this.uploaded=!1,this.aabb=new wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,l){$(s.globalMatrix,l,s.localMatrix);const f=this.nodeOverrides.get(s.name);if(f!==void 0){const x=[];y=f.orientation,K(m=x),ve(m,m,Nn(y[1])),pe(m,m,Nn(y[2])),re(m,m,Nn(y[0])),$(s.globalMatrix,s.globalMatrix,x)}var m,y;if(s.meshes)for(const x of s.meshes){const b=wn.applyTransformFast(x.aabb,s.globalMatrix);this.aabb.encapsulate(b)}if(s.children)for(const x of s.children)this._applyTransformations(x,s.globalMatrix)}computeBoundsAndApplyParent(){const s=K([]);this.aabb=new wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.nodes)this._applyTransformations(l,s)}computeModelMatrix(s,l,f,m,y,x,b=!1){m2(this.matrix,this,s.transform,this.position,l,f,m,y,x,b)}upload(s){if(!this.uploaded){for(const l of this.nodes)$P(l,s);for(const l of this.nodes)g2(l);this.uploaded=!0}}destroy(){for(const s of this.nodes)qP(s)}}function Gb(u,s,l=!1){u.uploaded||(u.gfxTexture=new BP(s,u.image,l?s.gl.R8:s.gl.RGBA8,{useMipmap:u.sampler.minFilter>=s.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function Pre(u,s,l){u.indexBuffer=s.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=s.createVertexBuffer(u.vertexArray,Ere.members,!1,!0),u.normalArray&&(u.normalBuffer=s.createVertexBuffer(u.normalArray,Ire.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=s.createVertexBuffer(u.texcoordArray,Nre.members,!1,!0)),u.colorArray&&(u.colorBuffer=s.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?Tre:jre).members,!1,!0)),u.featureArray&&(u.pbrBuffer=s.createVertexBuffer(u.featureArray,Are.members,!0)),u.segments=xi.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const f=u.material;f.pbrMetallicRoughness.baseColorTexture&&Gb(f.pbrMetallicRoughness.baseColorTexture,s),f.pbrMetallicRoughness.metallicRoughnessTexture&&Gb(f.pbrMetallicRoughness.metallicRoughnessTexture,s),f.normalTexture&&Gb(f.normalTexture,s),f.occlusionTexture&&Gb(f.occlusionTexture,s,l),f.emissionTexture&&Gb(f.emissionTexture,s)}function $P(u,s,l){if(u.meshes)for(const f of u.meshes)Pre(f,s,l);if(u.children)for(const f of u.children)$P(f,s,l)}function g2(u){if(u.meshes)for(const s of u.meshes)s.indexArray.destroy(),s.vertexArray.destroy(),s.colorArray&&s.colorArray.destroy(),s.normalArray&&s.normalArray.destroy(),s.texcoordArray&&s.texcoordArray.destroy(),s.featureArray&&s.featureArray.destroy();if(u.children)for(const s of u.children)g2(s)}function qP(u){if(u.meshes)for(const l of u.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((s=l.material).pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()));var s;if(u.children)for(const l of u.children)qP(l)}function y_(u,s){const l=u.json.bufferViews[s.bufferView],f=u2[s.componentType];return new f(u.buffers[l.buffer],(s.byteOffset||0)+(l.byteOffset||0),s.count*(l.byteStride&&l.byteStride!==$b[s.type]*f.BYTES_PER_ELEMENT?l.byteStride/f.BYTES_PER_ELEMENT:$b[s.type]))}function GP(u,s,l,f){const m=u2[s.componentType],y=function(k){switch(k){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),x=u.json.bufferViews[s.bufferView],b=x.byteStride?x.byteStride/m.BYTES_PER_ELEMENT:$b[s.type],j=l.float32,N=j.length/l.capacity;for(let k=0,M=0;k<s.count*b;k+=b,M+=N)for(let D=0;D<N;D++)j[M+D]=f[k+D]*y;l._trim()}function kre(u,s,l){const f=u.indices,m=u.attributes,y={};y.indexArray=new ui;const x=s.json.accessors[f],b=x.count/3;y.indexArray.reserve(b);const j=y_(s,x);for(let D=0;D<b;D++)y.indexArray.emplaceBack(j[3*D],j[3*D+1],j[3*D+2]);y.indexArray._trim(),y.vertexArray=new ac;const N=s.json.accessors[m.POSITION];y.vertexArray.reserve(N.count);const k=y_(s,N);for(let D=0;D<N.count;D++)y.vertexArray.emplaceBack(k[3*D],k[3*D+1],k[3*D+2]);if(y.vertexArray._trim(),y.aabb=new wn(N.min,N.max),y.centroid=function(D,q){const G=[0,0,0],ee=D.length;if(ee>0){for(let ne=0;ne<ee;ne++){const ie=3*D[ne];G[0]+=q[ie],G[1]+=q[ie+1],G[2]+=q[ie+2]}G[0]/=ee,G[1]/=ee,G[2]/=ee}return G}(j,k),m.COLOR_0!==void 0){const D=s.json.accessors[m.COLOR_0],q=$b[D.type],G=y_(s,D);y.colorArray=q===3?new ac:new kh,y.colorArray.resize(D.count),GP(s,D,y.colorArray,G)}if(m.NORMAL!==void 0){y.normalArray=new ac;const D=s.json.accessors[m.NORMAL];y.normalArray.resize(D.count);const q=y_(s,D);GP(s,D,y.normalArray,q)}if(m.TEXCOORD_0!==void 0&&l.length>0){y.texcoordArray=new Rh;const D=s.json.accessors[m.TEXCOORD_0];y.texcoordArray.resize(D.count);const q=y_(s,D);GP(s,D,y.texcoordArray,q)}if(m._FEATURE_ID_RGBA4444!==void 0){const D=s.json.accessors[m._FEATURE_ID_RGBA4444];s.json.extensionsUsed&&s.json.extensionsUsed.includes("EXT_meshopt_compression")&&(y.featureData=y_(s,D))}m._FEATURE_RGBA4444!==void 0&&(y.featureData=new Uint32Array(y_(s,s.json.accessors[m._FEATURE_RGBA4444]).buffer));const M=u.material;return y.material=function(D,q){const{emissiveFactor:G=[0,0,0],alphaMode:ee="OPAQUE",alphaCutoff:ne=.5,normalTexture:ie,occlusionTexture:me,emissiveTexture:ye,doubleSided:be,name:Me}=D,{baseColorFactor:Ce=[1,1,1,1],metallicFactor:Le=1,roughnessFactor:Ve=1,baseColorTexture:He,metallicRoughnessTexture:mt}=D.pbrMetallicRoughness||{},rt=me?q[me.index]:void 0;if(me&&me.extensions&&me.extensions.KHR_texture_transform&&rt){const gt=me.extensions.KHR_texture_transform;rt.offsetScale=[gt.offset[0],gt.offset[1],gt.scale[0],gt.scale[1]]}return{name:Me,pbrMetallicRoughness:{baseColorFactor:new os(...Ce),metallicFactor:Le,roughnessFactor:Ve,baseColorTexture:He?q[He.index]:void 0,metallicRoughnessTexture:mt?q[mt.index]:void 0},doubleSided:be,emissiveFactor:new os(...G),alphaMode:ee,alphaCutoff:ne,normalTexture:ie?q[ie.index]:void 0,occlusionTexture:rt,emissionTexture:ye?q[ye.index]:void 0,defined:D.defined===void 0}}(M!==void 0?s.json.materials[M]:{defined:!1},l),y}function $z(u,s,l){const{matrix:f,rotation:m,translation:y,scale:x,mesh:b,extras:j,children:N,name:k}=u,M={};if(M.name=k,M.localMatrix=f||function(D,q,G,ee){var ne=q[0],ie=q[1],me=q[2],ye=q[3],be=ne+ne,Me=ie+ie,Ce=me+me,Le=ne*be,Ve=ne*Me,He=ne*Ce,mt=ie*Me,rt=ie*Ce,gt=me*Ce,bt=ye*be,Ct=ye*Me,Gt=ye*Ce,Ot=ee[0],Et=ee[1],Dt=ee[2];return D[0]=(1-(mt+gt))*Ot,D[1]=(Ve+Gt)*Ot,D[2]=(He-Ct)*Ot,D[3]=0,D[4]=(Ve-Gt)*Et,D[5]=(1-(Le+gt))*Et,D[6]=(rt+bt)*Et,D[7]=0,D[8]=(He+Ct)*Dt,D[9]=(rt-bt)*Dt,D[10]=(1-(Le+mt))*Dt,D[11]=0,D[12]=G[0],D[13]=G[1],D[14]=G[2],D[15]=1,D}([],m||[0,0,0,1],y||[0,0,0],x||[1,1,1]),M.globalMatrix=W(M.localMatrix),b!==void 0){M.meshes=l[b];const D=M.anchor=[0,0];for(const q of M.meshes){const{min:G,max:ee}=q.aabb;D[0]+=G[0]+ee[0],D[1]+=G[1]+ee[1]}D[0]=Math.floor(D[0]/M.meshes.length/2),D[1]=Math.floor(D[1]/M.meshes.length/2)}if(j&&(j.id&&(M.id=j.id),j.lights&&(M.lights=function(D){if(!D.length)return[];const q=function(me){const ye=atob(me),be=new Uint8Array(ye.length);for(let Me=0;Me<ye.length;Me++)be[Me]=ye.codePointAt(Me);return be}(D),G=[],ee=q.length/24,ne=new Uint16Array(q.buffer),ie=new Float32Array(q.buffer);for(let me=0;me<ee;me++){const ye=ne[2*me*6]/30,be=ne[2*me*6+1]/30,Me=ne[2*me*6+10]/100,Ce=ie[6*me+1],Le=ie[6*me+2],Ve=ie[6*me+3],He=ie[6*me+4],mt=Ve-Ce,rt=He-Le,gt=Math.hypot(mt,rt);G.push({pos:[Ce+.5*mt,Le+.5*rt,be],normal:[rt/gt,-mt/gt,0],width:gt,height:ye,depth:Me,points:[Ce,Le,Ve,He]})}return G}(j.lights)),j.MAPBOX_geometry_bloom&&(M.isGeometryBloom=j.MAPBOX_geometry_bloom)),N){const D=[];for(const q of N)D.push($z(s.json.nodes[q],s,l));M.children=D}return M}function Rre(u){if(u.vertices.length===0||u.indices.length===0)return null;const s=new r2(u.vertices,u.indices,8,256),[l,f]=[s.min.clone(),s.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:s,min:l,max:f}}function Mre(u){if(!u.extras||!u.extras.ground)return null;const s=u.extras.ground;if(!s||!Array.isArray(s)||s.length===0)return null;const l=s[0];if(!l||!Array.isArray(l)||l.length===0)return null;const f=[];for(const x of l){if(!Array.isArray(x)||x.length!==2)continue;const b=x[0],j=x[1];typeof b=="number"&&typeof j=="number"&&f.push(new Rt(b,j))}if(f.length<3)return null;f.length>1&&f[f.length-1].equals(f[0])&&f.pop();let m=0;for(let x=0;x<f.length;x++){const b=f[x],j=f[(x+1)%f.length],N=f[(x+2)%f.length];m+=(b.x-j.x)*(N.y-j.y)-(N.x-j.x)*(b.y-j.y)}m>0&&f.reverse();const y=Ux(f.flatMap(x=>[x.x,x.y]),[]);return y.length===0?null:{vertices:f,indices:y}}function Dre(u,s){const l=[],f=[];let m=0;const y=[];for(const x of u){m=l.length;const b=x.vertexArray.float32,j=x.indexArray.uint16;for(let N=0;N<x.vertexArray.length;N++)y[0]=b[3*N+0],y[1]=b[3*N+1],y[2]=b[3*N+2],ln(y,y,s),l.push(new Rt(y[0],y[1]));for(let N=0;N<3*x.indexArray.length;N++)f.push(j[N]+m)}if(f.length%3!=0)return null;for(let x=0;x<f.length;x+=3){const b=l[f[x+0]],j=l[f[x+1]],N=l[f[x+2]];(b.x-j.x)*(N.y-j.y)-(N.x-j.x)*(b.y-j.y)>0&&([f[x+1],f[x+2]]=[f[x+2],f[x+1]])}return{vertices:l,indices:f}}function HP(u){const s=function(j,N){const k=[],M=WebGL2RenderingContext;if(j.json.textures)for(const D of j.json.textures){const q={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};D.sampler!==void 0&&Object.assign(q,j.json.samplers[D.sampler]),k.push({image:N[D.source],sampler:q,uploaded:!1})}return k}(u,u.images),l=function(j,N){const k=[];for(const M of j.json.meshes){const D=[];for(const q of M.primitives)D.push(kre(q,j,N));k.push(D)}return k}(u,s),{scenes:f,scene:m,nodes:y}=u.json,x=f?f[m||0].nodes:[...y.keys()],b=[];for(const j of x)b.push($z(y[j],u,l));return function(j,N,k){const M={},D=new Set;for(let q=0;q<j.length;q++){const G=k[N[q]];if(!G.extras)continue;const ee=G.extras["mapbox:footprint:version"],ne=G.extras["mapbox:footprint:id"];(ee||ne)&&D.add(q),ee==="1.0.0"&&ne&&(M[ne]=q)}for(let q=0;q<j.length;q++){if(D.has(q))continue;const G=j[q],ee=k[N[q]];if(!ee.extras)continue;let ne=null;G.id in M&&(ne=Dre(j[M[G.id]].meshes,G.localMatrix)),ne||(ne=Mre(ee)),ne&&(G.footprint=Rre(ne))}if(D.size>0){const q=Array.from(D.values()).sort((G,ee)=>G-ee);for(let G=q.length-1;G>=0;G--)j.splice(q[G],1)}}(b,x,u.json.nodes),b}function Ore(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const s=u.vertexArray.float32,l=u.aabb.min[0]-1,f=u.aabb.min[1]-1,m=__/(u.aabb.max[0]-l+2),y=__/(u.aabb.max[1]-f+2);for(let x=0;x<s.length;x+=3){const b=s[x+2],j=(s[x+0]-l)*m|0,N=(s[x+1]-f)*y|0;b>u.heightmap[N*__+j]&&(u.heightmap[N*__+j]=b)}}function qz(u,s,l,f,m){l.reserve(l.length+4*u.length),f.reserve(f.length+10*u.length),m.reserve(m.length+10*u.length);let y=f.length;for(const x of u){const b=Math.min(10,Math.max(4,1.3*x.height))*s,j=[-x.normal[1],x.normal[0],0],N=Math.min(.29,.1*x.width/x.depth),k=x.width-2*x.depth*s*(N+.01),M=Xt([],x.pos,j,k/2),D=Xt([],x.pos,j,-k/2),q=[M[0],M[1],M[2]+x.height],G=[D[0],D[1],D[2]+x.height],ee=Xt([],x.normal,j,N);St(ee,ee,b);const ne=Xt([],x.normal,j,-N);St(ne,ne,b),$e(ee,M,ee),$e(ne,D,ne),M[2]+=.1,D[2]+=.1,f.emplaceBack(ee[0],ee[1],ee[2]),f.emplaceBack(ne[0],ne[1],ne[2]),f.emplaceBack(M[0],M[1],M[2]),f.emplaceBack(D[0],D[1],D[2]),f.emplaceBack(q[0],q[1],q[2]),f.emplaceBack(G[0],G[1],G[2]),f.emplaceBack(M[0],M[1],M[2]),f.emplaceBack(D[0],D[1],D[2]),f.emplaceBack(ee[0],ee[1],ee[2]),f.emplaceBack(ne[0],ne[1],ne[2]);const ie=k/b/2;m.emplaceBack(-ie-N,-1,ie,.8),m.emplaceBack(ie+N,-1,ie,.8),m.emplaceBack(-ie,0,ie,1.3),m.emplaceBack(ie,0,ie,1.3),m.emplaceBack(ie+N,-.8,ie,.7),m.emplaceBack(ie+N,-.8,ie,.7),m.emplaceBack(0,0,ie,1.3),m.emplaceBack(0,0,ie,1.3),m.emplaceBack(ie+N,-1.2,ie,.8),m.emplaceBack(ie+N,-1.2,ie,.8),l.emplaceBack(6+y,4+y,8+y),l.emplaceBack(7+y,9+y,5+y),l.emplaceBack(0+y,1+y,2+y),l.emplaceBack(1+y,3+y,2+y),y+=10}}function Lre(u,s){const l={};l.indexArray=new ui,l.vertexArray=new ac,l.colorArray=new kh,qz(u,s,l.indexArray,l.vertexArray,l.colorArray);const f={defined:!0};f.emissiveFactor=os.black;const m={};return m.baseColorFactor=os.white,f.pbrMetallicRoughness=m,l.material=f,l.aabb=new wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}const Gz=In([{name:"a_pos_3f",components:3,type:"Float32"}]),Fre=In([{name:"a_normal_3",components:3,type:"Int16"}]),zre=In([{name:"a_centroid_3",components:3,type:"Int16"}]),Hz=In([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Bre=In([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Vre=In([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Ure=In([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),$re=In([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),qre=In([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Wz=Pt.types,_2=32767;function Gre(u,s){const l=Zt+s;for(const f of u)for(const m of f)if(m.x<-s||m.x>l||m.y<-s||m.y>l)return!1;return!0}class Zz{constructor(){this.layoutVertexArray=new ac,this.layoutAttenuationArray=new kh,this.layoutColorArray=new Vc,this.indexArray=new ui,this.indexArrayForConflation=new ui,this.segmentsBucket=new xi}}class WP{constructor(){this.layoutVertexArray=new ac,this.layoutNormalArray=new Mf,this.layoutCentroidArray=new Mf,this.layoutColorArray=new Vc,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new kx,this.layoutAOArray=new Td,this.indexArray=new ui,this.indexArrayForConflation=new ui,this.segmentsBucket=new xi,this.entranceBloom=new Zz}}class Kz{constructor(s){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new WP,this.buildingWithFacade=new WP,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.hasPattern=!1,this.worldview=s.worldview,this.lut=s.lut,this.buildingWithFacade.layoutFacadePaintArray=new Vc,this.buildingWithFacade.layoutFacadeDataArray=new Df,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Vc,this.programConfigurations=new xu(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=s.projection,this.groundEffect=new PP(s),this.groundEffect.groundRadiusArray=new Td,this.hasAppearances=null}updateFootprints(s,l){for(const f of this.footprints)l.push({footprint:f,id:s})}updateAppearances(s,l,f,m){}prepare(){return function(){if(c2!=null||Iz!=null)return null;if(Wx!=null)return Wx;const s=fetch(Ks.BUILDING_GEN_URL);return Wx=function(l){let f,m,y,x;function b(){f=new Uint8Array(x.buffer),m=new Int32Array(x.buffer),y=new Float32Array(x.buffer)}function j(){throw new Error("Unexpected BuildingGen error.")}const N=()=>{},k={a:{a:j,f:function(M){const D=f.length,q=Math.max(M>>>0,Math.ceil(1.2*D)),G=Math.ceil((q-D)/65536);try{return x.grow(G),b(),!0}catch{return!1}},g:j,b:N,c:N,d:N,e:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(l,k):l.then(M=>M.arrayBuffer()).then(M=>WebAssembly.instantiate(M,k))).then(M=>{const D=M.instance.exports;return(0,D.g)(),x=D.f,b(),new _re({setStyle:D.h,setAOOptions:D.i,setMetricOptions:D.j,setStructuralOptions:D.k,setFacadeOptions:D.l,setFauxFacadeOptions:D.m,setFacadeClassifierOptions:D.n,addFeature:D.o,addFacade:D.p,generateMesh:D.q,getLastError:D.r,getOuterRingLength:D.s,getMeshCount:D.t,getPositionsPtr:D.u,getPositionsLength:D.v,getNormalsPtr:D.w,getNormalsLength:D.x,getColorsPtr:D.y,getColorsLength:D.z,getAOPtr:D.A,getAOLength:D.B,getUVPtr:D.C,getUVLength:D.D,getFauxFacadePtr:D.E,getFauxFacadeLength:D.F,getIndicesPtr:D.G,getIndicesLength:D.H,getBuildingPart:D.I,getRingCount:D.J,getRingPtr:D.K,getRingLength:D.L,free:D.M,malloc:D.N,heapU8:f,heap32:m,heapF32:y})})}(s).then(l=>(Wx=null,c2=l,c2)).catch(l=>{Ar("Could not load building-gen"),Wx=null,Iz=l}),Wx}()}populate(s,l,f,m){const y=yre();if(!y)return;const x=Oe(f);this.tileToMeter=x,this.brightness=l.brightness,y.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,x],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:x,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),y.setAOOptions(!1,.3),y.setMetricOptions(!1,16),y.setStructuralOptions(!0),y.setFacadeClassifierOptions(3);const b=new Map,j=new Map;for(const{feature:N}of s){if(Wz[N.type]!=="LineString"){b.set(N.id,N.properties.source_id);continue}const k=this.layers[0]._featureFilter.needGeometry,M=lt(N,k);if(!this.layers[0]._featureFilter.filter(new Xs(this.zoom),M,f))continue;const D=k?M.geometry:wt(N,f,m),q=[];for(const ie of D)for(const me of ie)q.push({x:me.x,y:me.y});const G={coordinates:q,crossPerc:N.properties.cross_perc,distanceToRoad:N.properties.distance_to_road,entrances:N.properties.entrances,sourceId:0},ee=N.properties.source_id;let ne=j.get(ee);ne||(ne=[],j.set(ee,ne)),ne.push(G)}this.maxHeight=0;for(const{feature:N,id:k,index:M,sourceLayerIndex:D}of s){if(Wz[N.type]==="LineString")continue;const q=this.layers[0]._featureFilter.needGeometry,G=lt(N,q);if(!this.layers[0]._featureFilter.filter(new Xs(this.zoom),G,f))continue;const ee=q?G.geometry:wt(N,f,m),ne=Mb(ee,500);if(!Gre(ee,163))continue;const ie=this.layers[0],me=ie.layout.get("building-roof-shape").evaluate(N,{},f);if(me==="flat")continue;const ye=ie.layout.get("building-base").evaluate(N,{},f),be=ie.layout.get("building-height").evaluate(N,{},f),Me=ie.layout.get("building-flood-light-ground-radius").evaluate(N,{},f),Ce=ie.paint.get("building-ambient-occlusion-intensity"),Le=Me/this.tileToMeter;let Ve=ie.layout.get("building-flood-light-wall-radius").evaluate(N,{},f);Ve=he(Ve,0,2048);const He=Ve/2048*_2,mt=b.get(k);let rt;rt=j.has(mt)?j.get(mt):[];const gt=rt.length!==0&&ie.layout.get("building-facade").evaluate(N,{},f);y.setFacadeOptions(4,!0),y.setFauxFacadeOptions(gt,!1,1);let bt=0,Ct=0,Gt=0,Ot=0,Et=0,Dt=0;if(gt){let yt=Math.round(ie.layout.get("building-facade-floors").evaluate(N,{},f));if(ye===0){yt=Math.max(1,yt-(rt.length>0?1:0));let Er=4;if(be>100){const Sr=[10,13,15];Er=Sr[N.id?N.id%Sr.length:0],y.setFacadeOptions(Er,!0)}Et=1.6803*Er/x}else Et=ye/x;Dt=be/x,Et=Math.min(Et,Dt),Gt=ie.layout.get("building-facade-unit-width").evaluate(N,{},f)/x,Ot=(Dt-Et)/yt,y.setFauxFacadeOptions(!0,!0,Gt);const er=ie.layout.get("building-facade-window").evaluate(N,{},f);bt=er[0],Ct=er[1]}const ht=[],ut=new Rt(1/0,1/0),kt=new Rt(-1/0,-1/0),$t=new Rt(0,0);let It=0;for(const yt of ne)if(yt.length>0){const er=[];for(const Er of yt){const Sr=[];for(let un=Er.length-1;un>=0;un--){const $r=Er[un];Sr.push({x:$r.x,y:$r.y}),ut.x=Math.min(ut.x,$r.x),ut.y=Math.min(ut.y,$r.y),kt.x=Math.max(kt.x,$r.x),kt.y=Math.max(kt.y,$r.y),$t.x+=$r.x,$t.y+=$r.y,It++}er.push(Sr)}ht.push({id:N.id?N.id:0,height:be,minHeight:ye,sourceId:0,roofType:me,coordinates:er})}$t.x/=It||1,$t.y/=It||1;const ur=y.generateMesh(ht,rt);if(typeof ur=="string"){Ar(`Unable to generate building ${N.id}: ${ur}`);continue}if(ur.meshes.length===0||ur.modifiedPolygonRings.length===0)continue;let _r=0;for(const yt of ur.meshes)_r+=yt.positions.length/3;const ir=gt?this.buildingWithFacade:this.buildingWithoutFacade,Jt=ir.segmentsBucket.prepareSegment(_r,ir.layoutVertexArray,ir.indexArray),Qr=[];let tr=null,Pr=0,an=-1;const Sn=ir.layoutVertexArray.length,Hn=ir.indexArray.length;let cn=0;for(const yt of ur.meshes){const er=ir.layoutVertexArray.length;if(yt.buildingPart==="entrance"){const vr=new Array;for(let qn=0;qn<yt.positions.length;qn+=12){const Ps=yt.positions[qn+0],xs=yt.positions[qn+1],ji=yt.positions[qn+3],ri=yt.positions[qn+4],Hs=yt.positions[qn+2],Ts=yt.positions[qn+8]-Hs,ns=1,dn=ji-Ps,ss=ri-xs,Ws=Math.hypot(dn,ss);vr.push({pos:[Ps+.5*dn,xs+.5*ss,Hs],normal:[ss/Ws,-dn/Ws,0],width:Ws,height:Ts,depth:ns,points:[Ps,xs,ji,ri]})}const Qn=ir.entranceBloom.segmentsBucket.prepareSegment(10*vr.length,ir.entranceBloom.layoutVertexArray,ir.entranceBloom.indexArray),As=ir.entranceBloom.layoutVertexArray.length;Pr=ir.entranceBloom.indexArray.length,qz(vr,.5/this.tileToMeter,ir.entranceBloom.indexArray,ir.entranceBloom.layoutVertexArray,ir.entranceBloom.layoutAttenuationArray);const Hr=ir.entranceBloom.layoutVertexArray.length-As;an=ir.entranceBloom.indexArray.length-Pr;for(let qn=0;qn<Hr;qn++)ir.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Qn.vertexLength+=Hr,Qn.primitiveLength+=an,tr={part:yt.buildingPart,vertexOffset:As,vertexLength:Hr}}for(let vr=0;vr<yt.positions.length;vr+=3)cn=Math.max(cn,yt.positions[vr+2]),ir.layoutVertexArray.emplaceBack(yt.positions[vr],yt.positions[vr+1],yt.positions[vr+2]);const Er=Math.floor($t.x),Sr=Math.floor($t.y),un=Math.floor(cn);for(let vr=0;vr<yt.positions.length;vr+=3)ir.layoutCentroidArray.emplaceBack(Er,Sr,un),ir.layoutFloodLightDataArray.emplaceBack(yt.buildingPart==="wall"?He:0);for(let vr=0;vr<yt.normals.length;vr+=3)ir.layoutNormalArray.emplaceBack(yt.normals[vr+0]*_2,yt.normals[vr+1]*_2,yt.normals[vr+2]*_2);for(let vr=0;vr<yt.ao.length;vr++)ir.layoutAOArray.emplaceBack(yt.ao[vr]);for(let vr=0;vr<yt.colors.length;vr+=3){const Qn=1+(yt.ao[vr/3]-1)*Ce;ir.layoutColorArray.emplaceBack(yt.colors[vr]*Qn<<8|yt.colors[vr+1]*Qn,yt.colors[vr+2]*Qn<<8)}if(gt){for(let vr=0;vr<yt.positions.length;vr+=3)ir.layoutFacadePaintArray.emplaceBack(65535,255);for(let vr=0;vr<yt.isFauxFacade.length;vr++)if(yt.isFauxFacade[vr]){const Qn=1|Math.min(65535,Math.floor(yt.uv[2*vr]*ur.outerRingLength)),As=Math.floor(255*bt)<<8|Math.floor(255*Ct),Hr=Math.floor(65535*Math.min(1,Gt/Zt)),qn=Math.floor(65535*Math.min(1,Ot/Zt));ir.layoutFacadeDataArray.emplaceBack(Qn,As,Hr,qn);const Ps=Math.floor(65535*Math.min(1,Et/Zt)),xs=Math.floor(65535*Math.min(1,Dt/Zt));ir.layoutFacadeVerticalRangeArray.emplaceBack(Ps,xs)}else ir.layoutFacadeDataArray.emplaceBack(0,0,0,0),ir.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const $r=Jt.vertexLength;for(let vr=0;vr<yt.indices.length;vr+=3)ir.indexArray.emplaceBack($r+yt.indices[vr],$r+yt.indices[vr+1],$r+yt.indices[vr+2]);Jt.vertexLength+=yt.positions.length/3,Jt.primitiveLength+=yt.indices.length/3,(yt.buildingPart==="roof"||yt.buildingPart==="wall"||yt.buildingPart==="facade_glazing"||yt.buildingPart==="entrance")&&Qr.push({part:yt.buildingPart,vertexOffset:er,vertexLength:yt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,cn),this.buildingFeatures.push({promoteId:k,feature:G,hasFauxFacade:gt,segment:Jt,parts:Qr,buildingBloom:tr});const ts=ir.indexArray.length-Hn,rs=[],mi=[],Ae=new Rt(1/0,1/0),je=new Rt(-1/0,-1/0),_t=this.groundEffect.vertexArray.length;for(const yt of ur.modifiedPolygonRings){const er=[],Er=new Rt(1/0,1/0),Sr=new Rt(-1/0,-1/0);for(let un=0;un<yt.length;un+=2){const $r=yt.length-un-2;Er.x=Math.min(Er.x,yt[$r]),Er.y=Math.min(Er.y,yt[$r+1]),Sr.x=Math.max(Sr.x,yt[$r]),Sr.y=Math.max(Sr.y,yt[$r+1]);const vr=new Rt(yt[$r],yt[$r+1]);er.push(vr),rs.push(vr.x,vr.y),mi.push(vr.clone())}Ae.x=Math.min(Ae.x,Er.x),Ae.y=Math.min(Ae.y,Er.y),je.x=Math.max(je.x,Sr.x),je.y=Math.max(je.y,Sr.y),this.groundEffect.addData(er,[Er,Sr],Le)}const Yt=this.groundEffect.vertexArray.length-_t;for(let yt=0;yt<Yt;yt++)this.groundEffect.groundRadiusArray.emplaceBack(Me);(ut.x<0||kt.x>Zt||ut.y<0||kt.y>Zt)&&this.featuresOnBorder.push({featureId:N.id,footprintIndex:this.footprints.length});{const yt=Ux(rs,null,2),er=new r2(mi,yt,8,256);let Er=N.id;N.properties&&N.properties.hasOwnProperty("building_id")&&(Er=N.properties.building_id);const Sr={vertices:mi,indices:yt,grid:er,min:Ae,max:je,buildingId:Er,hiddenFlags:0,indicesOffset:Hn,indicesLength:ts,bloomIndicesOffset:Pr,bloomIndicesLength:an,groundEffectVertexOffset:_t,groundEffectVertexLength:Yt,hasFauxFacade:gt,segment:Jt,height:cn};N.id!==void 0&&this.featureFootprintLookup.set(N.id,this.footprints.length),this.footprints.push(Sr)}this.programConfigurations.populatePaintArrays(ir.layoutVertexArray.length,N,M,{},l.availableImages,f,l.brightness),this.groundEffect.addPaintPropertiesData(N,M,{},l.availableImages,f,l.brightness),l.featureIndex.insert(N,ee,M,D,this.index,Sn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(s,l,f,m,y,x,b){this.programConfigurations.updatePaintArrays(s,l,y,f,m,x,b),this.groundEffect.update(s,l,y,f,m,x,b),this.evaluate(this.layers[0],s),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){const l=f=>{f.layoutVertexBuffer=s.createVertexBuffer(f.layoutVertexArray,Gz.members),f.layoutNormalBuffer=s.createVertexBuffer(f.layoutNormalArray,Fre.members),f.layoutCentroidBuffer=s.createVertexBuffer(f.layoutCentroidArray,zre.members),f.layoutFloodLightDataBuffer=s.createVertexBuffer(f.layoutFloodLightDataArray,qre.members),f.layoutFacadeDataArray&&f.layoutFacadeDataArray.length&&(f.layoutFacadeDataBuffer=s.createVertexBuffer(f.layoutFacadeDataArray,Vre.members)),f.layoutFacadeVerticalRangeArray&&f.layoutFacadeVerticalRangeArray.length&&(f.layoutFacadeVerticalRangeBuffer=s.createVertexBuffer(f.layoutFacadeVerticalRangeArray,Ure.members)),f.entranceBloom.layoutVertexArray.length&&(f.entranceBloom.layoutVertexBuffer=s.createVertexBuffer(f.entranceBloom.layoutVertexArray,Gz.members),f.entranceBloom.layoutAttenuationBuffer=s.createVertexBuffer(f.entranceBloom.layoutAttenuationArray,$re.members)),this.uploadUpdatedColorBuffer(s),this.uploadUpdatedIndexBuffer(s)};this.uploaded||(l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){const s=l=>{l.layoutVertexBuffer&&(l.layoutVertexBuffer.destroy(),l.layoutNormalBuffer.destroy(),l.layoutColorBuffer.destroy(),l.segmentsBucket.destroy(),l.indexBuffer&&l.indexBuffer.destroy(),l.entranceBloom.layoutVertexBuffer&&(l.entranceBloom.layoutVertexBuffer.destroy(),l.entranceBloom.layoutColorBuffer.destroy(),l.entranceBloom.layoutAttenuationBuffer.destroy(),l.entranceBloom.indexBuffer.destroy(),l.entranceBloom.segmentsBucket.destroy()))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(s,l,f=!0){let m=!1;const y=f?l:0,x=0|(f?-1:~l);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of s){const j=this.footprints[b],N=j.hiddenFlags&x|y;j.hiddenFlags!==N&&(j.hiddenFlags=N,m=!0,this.groundEffect.updateHiddenByLandmarkRange(j.groundEffectVertexOffset,j.groundEffectVertexLength,j.hiddenFlags!==0))}return m&&(this.indexArrayForConflationUploaded=!1),m}uploadUpdatedIndexBuffer(s){if(this.groundEffect.uploadHiddenByLandmark(s),this.indexArrayForConflationUploaded)return;const l=m=>{m.indexArray.length!==0&&(m.indexArrayForConflation.resize(m.indexArray.length),m.indexArrayForConflation.uint16.set(m.indexArray.uint16),m.entranceBloom.indexArrayForConflation.resize(m.entranceBloom.indexArray.length),m.entranceBloom.indexArrayForConflation.uint16.set(m.entranceBloom.indexArray.uint16))};l(this.buildingWithoutFacade),l(this.buildingWithFacade);for(const m of this.footprints){const y=m.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,x=m.indicesOffset+m.indicesLength;if(m.hiddenFlags!==0){for(let j=m.indicesOffset;j<x;j++)y.indexArrayForConflation.uint16[3*j+0]=0,y.indexArrayForConflation.uint16[3*j+1]=0,y.indexArrayForConflation.uint16[3*j+2]=0;const b=m.bloomIndicesOffset+m.bloomIndicesLength;for(let j=m.bloomIndicesOffset;j<b;j++)y.entranceBloom.indexArrayForConflation.uint16[3*j+0]=0,y.entranceBloom.indexArrayForConflation.uint16[3*j+1]=0,y.entranceBloom.indexArrayForConflation.uint16[3*j+2]=0}}const f=m=>{m.indexArray.length!==0&&(m.indexBuffer?m.indexBuffer.updateData(m.indexArrayForConflation):m.indexBuffer=s.createIndexBuffer(m.indexArrayForConflation,!0),m.entranceBloom.indexBuffer?m.entranceBloom.indexBuffer.updateData(m.entranceBloom.indexArrayForConflation):m.entranceBloom.indexBuffer=s.createIndexBuffer(m.entranceBloom.indexArrayForConflation,!0))};f(this.buildingWithoutFacade),f(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(s){const l=f=>{f.layoutColorBuffer?f.layoutColorBuffer.updateData(f.layoutColorArray):f.layoutColorBuffer=s.createVertexBuffer(f.layoutColorArray,Hz.members,!0),f.layoutFacadePaintArray&&(f.layoutFacadePaintBuffer?f.layoutFacadePaintBuffer.updateData(f.layoutFacadePaintArray):f.layoutFacadePaintBuffer=s.createVertexBuffer(f.layoutFacadePaintArray,Bre.members,!0)),f.entranceBloom.layoutColorBuffer?f.entranceBloom.layoutColorBuffer.updateData(f.entranceBloom.layoutColorArray):f.entranceBloom.layoutColorBuffer=s.createVertexBuffer(f.entranceBloom.layoutColorArray,Hz.members,!0)};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(s,l){const f=s.paint.get("building-ambient-occlusion-intensity");for(const m of this.buildingFeatures){const y=l[m.promoteId],x=m.feature;x.properties["building-part"]="roof";const b=s.paint.get("building-color").evaluate(x,y,this.canonical).toPremultipliedRenderColor(this.lut),j=s.paint.get("building-emissive-strength").evaluate(x,y,this.canonical);x.properties["building-part"]="wall";const N=s.paint.get("building-color").evaluate(x,y,this.canonical).toPremultipliedRenderColor(this.lut),k=s.paint.get("building-emissive-strength").evaluate(x,y,this.canonical);x.properties["building-part"]="window";const M=s.paint.get("building-color").evaluate(x,y,this.canonical).toPremultipliedRenderColor(this.lut),D=s.paint.get("building-emissive-strength").evaluate(x,y,this.canonical);x.properties["building-part"]="door";const q=s.paint.get("building-color").evaluate(x,y,this.canonical).toPremultipliedRenderColor(this.lut),G=s.paint.get("building-emissive-strength").evaluate(x,y,this.canonical),ee=m.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ie of m.parts){let me,ye=b;ie.part==="roof"?(ye=b,me=j):ie.part==="wall"?(ye=N,me=k):ie.part==="facade_glazing"?(ye=M,me=D):ie.part==="entrance"&&(ye=q,me=G),me=he(me,0,1);for(let be=0;be<ie.vertexLength;be++){const Me=ie.vertexOffset+be,Ce=1+(ee.layoutAOArray.float32[Me]-1)*f;ee.layoutColorArray.emplace(Me,ye.r*Ce*255<<8|ye.g*Ce*255,ye.b*Ce*255<<8|255*me),m.hasFauxFacade&&ee.layoutFacadePaintArray.emplace(Me,255*M.r<<8|255*M.g,255*M.b<<8|255*D)}}const ne=m.buildingBloom;if(ne)for(let ie=0;ie<ne.vertexLength;ie++)ee.entranceBloom.layoutColorArray.emplace(ne.vertexOffset+ie,255*q.r<<8|255*q.g,255*q.b<<8|51*G)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(s,l,f){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const m=l.getReplacementRegionsForTile(s.toUnwrapped());if(s2(this.activeReplacements,m))return;this.activeReplacements=m;for(const x of this.footprints)x.hiddenFlags&=-2;const y=[];for(const x of this.activeReplacements){if(x.order<=XF)continue;const b=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-s.canonical.z));for(const j of this.footprints)j.min.x>x.max.x||j.max.x<x.min.x||j.min.y>x.max.y||j.max.y<x.min.y||(y.length=0,Hre(j.vertices,0,j.vertices.length,x.footprintTileId.canonical,s.canonical,y),NP(x.footprint,y,j.indices,0,j.indices.length,0,-b)&&(j.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(x.groundEffectVertexOffset,x.groundEffectVertexLength,x.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(s){if(s.id!==void 0){const l=this.featureFootprintLookup.get(s.id);return this.footprints[l]}return null}getHeightAtTileCoord(s,l){let f=Number.NEGATIVE_INFINITY,m=!0;const y=4*(s+Zt)*Zt+(l+Zt);if(this.footprintLookup.hasOwnProperty(y)){const b=this.footprintLookup[y];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const x=new Rt(s,l);for(const b of this.footprints)s>b.max.x||b.min.x>s||l>b.max.y||b.min.y>l||b.height<=f||IP(x,b)&&(f=b.height,this.footprintLookup[y]=b,m=b.hiddenFlags!==0);if(f!==Number.NEGATIVE_INFINITY)return{height:f,hidden:m};this.footprintLookup[y]=void 0}}function Hre(u,s,l,f,m,y){const x=Math.pow(2,f.z-m.z);for(let b=0;b<l;b++){let j=u[b+s].x,N=u[b+s].y;j=(j+m.x*Zt)*x-f.x*Zt,N=(N+m.y*Zt)*x-f.y*Zt,y.push(new Rt(j,N))}}let Xz,Yz;hr(Kz,"BuildingBucket",{omit:["layers"]}),hr(WP,"BuildingGeometry"),hr(Zz,"BuildingBloomGeometry");const Wre=In([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Zre=In([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Kre}=Wre,Xre=In([{name:"a_packed",components:3,type:"Float32"}]),{members:Yre}=Xre,Jre=In([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Qre}=Jre;class Jz{constructor(s,l){this.width=s,this.height=l,this.nextRow=0,this.image=new gm({width:s,height:l}),this.positions={},this.uploaded=!1}getDash(s,l){const f=this.getKey(s,l);return this.positions[f]}trim(){const s=this.width,l=this.height=Ye(this.nextRow);this.image.resize({width:s,height:l})}getKey(s,l){return s.join(",")+l}getDashRanges(s,l,f){const m=[];let y=s.length%2==1?-s[s.length-1]*f:0,x=s[0]*f,b=!0;m.push({left:y,right:x,isDash:b,zeroLength:s[0]===0});let j=s[0];for(let N=1;N<s.length;N++){b=!b;const k=s[N];y=j*f,j+=k,x=j*f,m.push({left:y,right:x,isDash:b,zeroLength:k===0})}return m}addRoundDash(s,l,f){const m=l/2;for(let y=-f;y<=f;y++){const x=this.width*(this.nextRow+f+y);let b=0,j=s[b];for(let N=0;N<this.width;N++){N/j.right>1&&(j=s[++b]);const k=Math.abs(N-j.left),M=Math.abs(N-j.right),D=Math.min(k,M);let q;const G=y/f*(m+1);if(j.isDash){const ee=m-Math.abs(G);q=Math.sqrt(D*D+ee*ee)}else q=m-Math.sqrt(D*D+G*G);this.image.data[x+N]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(s,l){for(let j=s.length-1;j>=0;--j){const N=s[j],k=s[j+1];N.zeroLength?s.splice(j,1):k&&k.isDash===N.isDash&&(k.left=N.left,s.splice(j,1))}const f=s[0],m=s[s.length-1];f.isDash===m.isDash&&(f.left=m.left-this.width,m.right=f.right+this.width);const y=this.width*this.nextRow;let x=0,b=s[x];for(let j=0;j<this.width;j++){j/b.right>1&&(b=s[++x]);const N=Math.abs(j-b.left),k=Math.abs(j-b.right),M=Math.min(N,k);this.image.data[y+j]=Math.max(0,Math.min(255,(b.isDash?M:-M)+l+128))}}addDash(s,l){const f=this.getKey(s,l);if(this.positions[f])return this.positions[f];const m=l==="round",y=m?7:0,x=2*y+1;if(this.nextRow+x>this.height)return Ar("LineAtlas out of space"),null;s.length===0&&s.push(1);let b=0;for(let k=0;k<s.length;k++)s[k]<0&&(Ar("Negative value is found in line dasharray, replacing values with 0"),s[k]=0),b+=s[k];if(b!==0){const k=this.width/b,M=this.getDashRanges(s,this.width,k);m?this.addRoundDash(M,k,y):this.addRegularDash(M,l==="square"?.5*k:0)}const j=this.nextRow+y;this.nextRow+=x;const N={tl:[j,y],br:[b,0]};return this.positions[f]=N,N}}hr(Jz,"LineAtlas");const ene=Pt.types,tne=Math.cos(Math.PI/180*37.5),rne=Math.cos(Math.PI/180*5);class ZP{constructor(s){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=s.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=s.overscaling,this.pixelRatio=s.pixelRatio,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=s.index,this.projection=s.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Ix,this.layoutVertexArray2=new ac,this.patternVertexArray=new ac,this.indexArray=new ui,this.programConfigurations=new xu(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new xi,this.maxLineLength=0,this.zOffsetVertexArray=new ac,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=s.tessellationStep?s.tessellationStep:Zt/64,this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,l){}updateAppearances(s,l,f,m){}populate(s,l,f,m){this.hasPattern=wP("line",this.layers,this.pixelRatio,l);const y=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Oe(f);const x=this.layers[0].layout.get("line-elevation-reference");if(x==="hd-road-markup")this.elevationType="road";else{const D=this.layers[0].layout.get("line-z-offset"),q=D.isConstant()&&!D.constantOr(0);this.elevationType=x!=="sea"&&x!=="ground"&&q?"none":"offset",this.elevationType==="offset"&&x==="none"&&Ar(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const j=[];for(const{feature:D,id:q,index:G,sourceLayerIndex:ee}of s){const ne=this.layers[0]._featureFilter.needGeometry,ie=lt(D,ne);if(!this.layers[0]._featureFilter.filter(new Xs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),ie,f))continue;const me=y?y.evaluate(ie,{},f):void 0,ye={id:q,properties:D.properties,type:D.type,sourceLayerIndex:ee,index:G,geometry:ne?ie.geometry:wt(D,f,m),patterns:{},sortKey:me};j.push(ye)}y&&j.sort((D,q)=>D.sortKey-q.sortKey);const{lineAtlas:N,featureIndex:k}=l,M=this.addConstantDashes(N);for(const D of j){const{geometry:q,index:G,sourceLayerIndex:ee}=D;if(M&&this.addFeatureDashes(D,N),this.hasPattern){const ne=bP("line",this.layers,D,this.zoom,this.pixelRatio,l);this.patternFeatures.push(ne)}else this.addFeature(D,q,G,f,N.positions,l.availableImages,l.brightness,l.elevationFeatures);k.insert(s[G].feature,q,G,ee,this.index)}}addConstantDashes(s){let l=!1;for(const f of this.layers){const m=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if(m.kind!=="constant"||y.kind!=="constant")l=!0;else{const x=y.value,b=m.value;if(!b)continue;s.addDash(b,x)}}return l}addFeatureDashes(s,l){const f=this.zoom;for(const m of this.layers){const y=m.paint.get("line-dasharray").value,x=m.layout.get("line-cap").value;if(y.kind==="constant"&&x.kind==="constant")continue;let b,j;if(y.kind==="constant"){if(b=y.value,!b)continue}else b=y.evaluate({zoom:f},s);j=x.kind==="constant"?x.value:x.evaluate({zoom:f},s),l.addDash(b,j),s.patterns[m.id]=[l.getKey(b,j)]}}update(s,l,f,m,y,x,b,j){this.programConfigurations.updatePaintArrays(s,l,y,f,m,x,b,j)}addFeatures(s,l,f,m,y,x){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,f,m,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Yre)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=s.createVertexBuffer(this.patternVertexArray,Qre)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,Zre.members,!0)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Kre),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s,l){let f,m;if(l&&l>0?(f=`mapbox_clip_start_${l}`,m=`mapbox_clip_end_${l}`):(f="mapbox_clip_start",m="mapbox_clip_end"),s.properties&&s.properties.hasOwnProperty(f)&&s.properties.hasOwnProperty(m))return{start:+s.properties[f],end:+s.properties[m]}}addFeature(s,l,f,m,y,x,b,j){const N=this.layers[0].layout,k=N.get("line-join").evaluate(s,{}),M=N.get("line-cap").evaluate(s,{}),D=N.get("line-miter-limit"),q=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(s),this.lineFeature=s;const G=!(!s.properties||!s.properties.hasOwnProperty("mapbox_line_metrics"))&&s.properties.mapbox_line_metrics;this.zOffsetValue=N.get("line-z-offset").value;const ee=this.layers[0].paint.get("line-width").value;if(ee.kind!=="constant"&&ee.isLineProgressConstant===!1&&(this.variableWidthValue=ee),this.elevationType==="road"){const ne=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(s,l,m,j,k,M,D,q)){const[ie,me]=this.clipRuntimeLinesToTile(l,1);for(let ye=0;ye<ie.length;ye++){const be=ie[ye],Me=me[ye],Ce={progress:{min:Me.progress.min,max:Me.progress.max},nextDir:this.computeSegNextDir(Me,be),prevDir:this.computeSegPrevDir(Me,be)};this.addLine(be,s,m,k,M,D,q,Ce,G&&Me.parentIndex>0?Me.parentIndex:null)}this.fillNonElevatedRoadSegment(ne)}}else for(let ne=0;ne<l.length;ne++)this.addLine(l[ne],s,m,k,M,D,q,void 0,G&&ne>0?ne:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,y,x,m,b,void 0,this.worldview)}computeSegNextDir(s,l){return s.nextPoint.sub(l.at(-2)).unit()}computeSegPrevDir(s,l){return l[1].sub(s.prevPoint).unit()}clipLinesToTile(s,l){return o2(s,-l,-l,Zt+l,Zt+l)}clipRuntimeLinesToTile(s,l){const f=[];return[o2(s,-l,-l,Zt+l,Zt+l,f),f]}addElevatedRoadFeature(s,l,f,m,y,x,b,j){const N=[],k=Jr.getElevationFeature(s,m);if(k){const M=this.clipLinesToTile(l,1),D=this.prepareElevatedLines(M,k,f);for(const q of D)N.push({geometry:q,elevation:k,elevationTileID:f,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(N.length===0)return!1;for(const M of N){const D=this.layoutVertexArray.length;this.addLine(M.geometry,s,f,y,x,b,j);const q=new Gn(f,M.elevationTileID);if(M.elevation)for(let G=D;G<this.layoutVertexArray.length;G++){const ee=new Rt(this.layoutVertexArray.int16[6*G]>>1,this.layoutVertexArray.int16[6*G+1]>>1),ne=q.pointElevation(ee,M.elevation,.05);this.updateHeightRange(ne),this.zOffsetVertexArray.emplaceBack(ne,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(s,l,f){if(l.constantHeight!=null)return s;const m=[],y=1/Oe(f);for(const x of s)pre(x,new ei(l,y),0,m);return m}fillNonElevatedRoadSegment(s){for(let l=s;l<this.layoutVertexArray.length;l++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(s){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,s),this.heightRange.max=Math.max(this.heightRange.max,s)):this.heightRange={min:s,max:s}}addLine(s,l,f,m,y,x,b,j,N){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=N?this.lineFeatureClips(l,N):this.lineClips;const k=m==="none";this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=j&&j.progress.min>0,D=j&&j.progress.max<1;if(this.lineClips){let He={min:this.lineClips.start,max:this.lineClips.end},mt=1;if(j){const bt=this.lineClips.end-this.lineClips.start;He=function(Ct,Gt,Ot){return{min:bs(Ct.min,Gt,Ot),max:bs(Ct.max,Gt,Ot)}}(j.progress,{min:0,max:1},He),bt>0&&(mt=(He.max-He.min)/bt)}const rt=+l.properties.mapbox_clip_feature_len,gt=+l.properties.mapbox_clip_seg_len;if(Number.isNaN(rt)||Number.isNaN(gt)){for(let Ct=0;Ct<s.length-1;Ct++)this.totalDistance+=s[Ct].dist(s[Ct+1]);const bt=this.totalDistance/(He.max-He.min);this.totalFeatureLength=Number.isFinite(bt)?bt:0,this.lineClips.start=He.min,this.lineClips.end=He.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=rt,this.distance=gt*mt,this.lineClips.start=He.min,this.lineClips.end=He.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const q=ene[l.type]==="Polygon";let G=s.length;for(;G>=2&&s[G-1].equals(s[G-2]);)G--;let ee=0;for(;ee<G-1&&s[ee].equals(s[ee+1]);)ee++;if(G<(q?3:2))return;m==="bevel"&&(x=1.05);const ne=this.segments.prepareSegment(10*G,this.layoutVertexArray,this.indexArray);let ie,me,ye,be,Me,Ce,Le,Ve;j&&j.prevDir&&(Ce=j.prevDir.perp()),j&&j.nextDir&&(Le=j.nextDir.perp()),this.e1=this.e2=-1,q&&(ie=s[G-2],Me=s[ee].sub(ie)._unit()._perp());for(let He=ee;He<G;He++){if(ye=He===G-1?q?s[ee+1]:void 0:s[He+1],ye&&s[He].equals(ye))continue;Me&&(be=Me),ie&&(me=ie),ie=s[He],Ve=this.evaluateLineProgressFeatures(me?me.dist(ie):0),Me=ye?ye.sub(ie)._unit()._perp():be,be=be||Me;const mt=me&&ye;let rt=mt?m:q||k?"butt":y;const gt=be.x*Me.x+be.y*Me.y;if(k){const ut=function(kt){if(kt.patternJoinNone){const $t=kt.segmentPoints.length/2,It=kt.lineSoFar-kt.segmentStart;for(let ur=0;ur<$t;++ur){const _r=kt.segmentPoints[2*ur+1],ir=Math.round(kt.segmentPoints[2*ur])+.5+.25*_r;kt.patternVertexArray.emplaceBack(ir,It,kt.segmentStart),kt.patternVertexArray.emplaceBack(ir,It,kt.segmentStart)}kt.segmentPoints.length=0}kt.e1=kt.e2=-1};if(mt&&gt<rne){this.updateDistance(me,ie),this.addCurrentVertex(ie,be,1,1,ne,Ve),ut(this),this.addCurrentVertex(ie,Me,-1,-1,ne,Ve);continue}if(me){if(!ye){this.updateDistance(me,ie),this.addCurrentVertex(ie,be,1,1,ne,Ve),ut(this);continue}rt="miter"}}let bt=be.add(Me);bt.x===0&&bt.y===0||bt._unit();const Ct=bt.x*Me.x+bt.y*Me.y,Gt=Ct!==0?1/Ct:1/0,Ot=2*Math.sqrt(2-2*Ct),Et=Ct<tne&&me&&ye,Dt=be.x*Me.y-be.y*Me.x>0,ht=this.overscaling<=16?15*Zt/(512*this.overscaling):0;if(mt&&rt==="round"){if(Gt<b)rt="miter";else if(Gt<=2){const ut=KP(ie,-10,Zt+10);rt=this.elevationType==="offset"&&(ut||this.hasCrossSlope)?"miter":"fakeround"}}if(rt==="miter"&&Gt>x&&(rt="bevel"),rt==="bevel"&&(Gt>2&&(rt="flipbevel"),Gt<x&&(rt="miter")),me&&!(rt==="miter"&&Et)&&this.updateDistance(me,ie),rt==="miter")if(Et){const ut=ie.dist(me);if(ut>2*ht){const $t=ie.sub(ie.sub(me)._mult(ht/ut)._round());this.updateDistance(me,$t),this.addCurrentVertex($t,be,0,0,ne,Ve),me=$t}this.updateDistance(me,ie),bt._mult(Gt),this.addCurrentVertex(ie,bt,0,0,ne,Ve);const kt=ie.dist(ye);if(kt>2*ht){const $t=ie.add(ye.sub(ie)._mult(ht/kt)._round());this.updateDistance(ie,$t),this.addCurrentVertex($t,Me,0,0,ne,Ve),ie=$t}}else bt._mult(Gt),this.addCurrentVertex(ie,bt,0,0,ne,Ve);else if(rt==="flipbevel"){if(Gt>100)bt=Me.mult(-1);else{const ut=Gt*be.add(Me).mag()/be.sub(Me).mag();bt._perp()._mult(ut*(Dt?-1:1))}this.addCurrentVertex(ie,bt,0,0,ne,Ve),this.addCurrentVertex(ie,bt.mult(-1),0,0,ne,Ve)}else if(rt==="bevel"||rt==="fakeround"){Ve!=null&&me&&this.addCurrentVertex(ie,Le||be,-1,-1,ne,Ve);const ut=ie.dist(me)<=2*ht&&rt!=="bevel",kt=bt.mult(Dt?1:-1);kt._mult(Gt);const $t=Me.mult(Dt?-1:1),It=be.mult(Dt?-1:1),ur=this.evaluateLineProgressFeatures(this.distance);if(Ve==null&&(this.addHalfVertex(ie,kt.x,kt.y,!1,!Dt,0,ne,ur),ut||this.addHalfVertex(ie,kt.x+2*It.x,kt.y+2*It.y,!1,Dt,0,ne,ur)),rt==="fakeround"){const _r=Math.round(180*Ot/Math.PI/20);this.addHalfVertex(ie,It.x,It.y,!1,Dt,0,ne,ur);for(let ir=0;ir<_r;ir++){let Jt=ir/_r;if(Jt!==.5){const tr=Jt-.5;Jt+=Jt*tr*(Jt-1)*((1.0904+gt*(gt*(3.55645-1.43519*gt)-3.2452))*tr*tr+(.848013+gt*(.215638*gt-1.06021)))}const Qr=$t.sub(It)._mult(Jt)._add(It)._unit();this.addHalfVertex(ie,Qr.x,Qr.y,!1,Dt,0,ne,ur)}this.addHalfVertex(ie,$t.x,$t.y,!1,Dt,0,ne,ur)}ut||Ve!=null||this.addHalfVertex(ie,kt.x+2*$t.x,kt.y+2*$t.y,!1,Dt,0,ne,ur),Ve!=null&&ye&&this.addCurrentVertex(ie,Ce||Me,1,1,ne,Ve)}else if(rt==="butt")this.addCurrentVertex(ie,bt,0,0,ne,Ve);else if(rt==="square"){if(!me){const ut=M?0:-1;this.addCurrentVertex(ie,bt,ut,ut,ne,Ve)}if(this.addCurrentVertex(ie,bt,0,0,ne,Ve),me){const ut=D?0:1;this.addCurrentVertex(ie,bt,ut,ut,ne,Ve)}}else if(rt==="round"){if(me){const ut=!mt&&Le?Le:be;this.addCurrentVertex(ie,ut,0,0,ne,Ve),!mt&&D||this.addCurrentVertex(ie,ut,1,1,ne,Ve,!0)}if(ye){const ut=!mt&&Ce?Ce:Me;!mt&&M||this.addCurrentVertex(ie,ut,-1,-1,ne,Ve,!0),this.addCurrentVertex(ie,ut,0,0,ne,Ve)}}}}addVerticesTo(s,l,f,m,y,x,b,j,N,k){const M=(l.w-s.w)/this.tessellationStep|0;let D=0;const q=this.scaledDistance;if(M>1){this.lineSoFar=s.w;const ee=(l.x-s.x)/M,ne=(l.y-s.y)/M,ie=(l.z-s.z)/M,me=(l.w-s.w)/M;for(let ye=1;ye<M;++ye){s.x+=ee,s.y+=ne,s.z+=ie,this.lineSoFar+=me,D+=me;const be=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(s,f,m,k,!1,b,N,be),this.addHalfVertex(s,y,x,k,!0,-j,N,be)}}this.lineSoFar=l.w,this.scaledDistance=q;const G=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(l,f,m,k,!1,b,N,G),this.addHalfVertex(l,y,x,k,!0,-j,N,G)}evaluateLineProgressFeatures(s){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+s)/this.totalFeatureLength):Ar(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let l=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(l=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:l}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:l}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:l}}addCurrentVertex(s,l,f,m,y,x,b=!1){const j=l.x+l.y*f,N=l.y-l.x*f,k=l.y*m-l.x,M=-l.y-l.x*m;if(x!=null){const D=this.elevationType==="offset",q=-10,G=Zt+10,ee=x.zOffset,ne=new xz(s.x,s.y,ee,this.lineSoFar),ie=!!D&&KP(s,q,G),me=this.lineSoFar,ye=this.distance;if(this.currentVertex)if(ie){const be=this.currentVertexIsOutside,Me=this.currentVertex,Ce=new xz(s.x,s.y,ee,this.lineSoFar);if(wz(Me,Ce,q,G),!KP(Ce,q,G)){if(be){this.e1=this.e2=-1,this.distance-=Me.dist(ne),this.lineSoFar=Me.w;const Le=this.evaluateLineProgressFeatures(Me.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Me,j,N,b,!1,f,y,Le),this.addHalfVertex(Me,k,M,b,!0,-m,y,Le),this.prevDistance=this.distance}this.distance=this.prevDistance+Me.dist(Ce),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Me,Ce,j,N,k,M,f,m,y,b),this.distance=ye,this.scaledDistance=this.distance/this.totalDistance}}else{const be=this.currentVertex;if(this.currentVertexIsOutside){wz(be,ne,q,G),this.e1=this.e2=-1,this.distance-=be.dist(ne),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=be.w;const Me=this.evaluateLineProgressFeatures(be.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(be,j,N,b,!1,f,y,Me),this.addHalfVertex(be,k,M,b,!0,-m,y,Me),this.prevDistance=this.distance,this.distance=ye,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(be,ne,j,N,k,M,f,m,y,b)}else ie||(this.addHalfVertex(s,j,N,b,!1,f,y,x),this.addHalfVertex(s,k,M,b,!0,-m,y,x));this.currentVertex=ne,this.currentVertexIsOutside=ie,this.lineSoFar=me}else this.addHalfVertex(s,j,N,b,!1,f,y,x),this.addHalfVertex(s,k,M,b,!0,-m,y,x)}addHalfVertex({x:s,y:l},f,m,y,x,b,j,N){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((s<<1)+(y?1:0),(l<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const M=Ur(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,M)}const k=j.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),j.primitiveLength++),x?this.e2=k:this.e1=k,N!=null&&this.zOffsetVertexArray.emplaceBack(N.zOffset,N.variableWidth,N.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(s,l){this.prevDistance=this.distance,this.distance+=s.dist(l),this.updateScaledDistance()}}function KP(u,s,l){return u.x<s||u.x>l||u.y<s||u.y>l}let Qz,e5;function t5(u,s,l){return s*(Zt/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}hr(ZP,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const r5=(u,s,l)=>(1-l)*u+l*s;function n5(u,s){return 1/t5(u,1,s.tileZoom)}function s5(u,s,l,f){return u.translatePosMatrix(f||s.tileID.projMatrix,s,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const i5=u=>{const s=[];a5(u)&&s.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT");const l=u.paint.get("line-trim-offset");l[0]===0&&l[1]===0||s.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&s.push("RENDER_LINE_BORDER");const f=u.layout.get("line-join").constantOr("miter")==="none",m=!!u.paint.get("line-pattern").constantOr(1);return f&&m&&s.push("LINE_JOIN_NONE"),s};function a5(u){const s=u.paint.get("line-dasharray").value;return s.kind!=="constant"||s.value}let XP;const o5=()=>XP||(XP={layout:Qz||(Qz=new Pi({"line-cap":new nr(tt.layout_line["line-cap"]),"line-join":new nr(tt.layout_line["line-join"]),"line-miter-limit":new Vt(tt.layout_line["line-miter-limit"]),"line-round-limit":new Vt(tt.layout_line["line-round-limit"]),"line-sort-key":new nr(tt.layout_line["line-sort-key"]),"line-z-offset":new nr(tt.layout_line["line-z-offset"]),"line-elevation-reference":new Vt(tt.layout_line["line-elevation-reference"]),"line-cross-slope":new Vt(tt.layout_line["line-cross-slope"]),visibility:new Vt(tt.layout_line.visibility),"line-width-unit":new Vt(tt.layout_line["line-width-unit"])})),paint:e5||(e5=new Pi({"line-opacity":new nr(tt.paint_line["line-opacity"]),"line-color":new nr(tt.paint_line["line-color"]),"line-translate":new Vt(tt.paint_line["line-translate"]),"line-translate-anchor":new Vt(tt.paint_line["line-translate-anchor"]),"line-width":new nr(tt.paint_line["line-width"]),"line-gap-width":new nr(tt.paint_line["line-gap-width"]),"line-offset":new nr(tt.paint_line["line-offset"]),"line-blur":new nr(tt.paint_line["line-blur"]),"line-dasharray":new nr(tt.paint_line["line-dasharray"]),"line-pattern":new nr(tt.paint_line["line-pattern"]),"line-pattern-cross-fade":new Vt(tt.paint_line["line-pattern-cross-fade"]),"line-gradient":new em(tt.paint_line["line-gradient"]),"line-trim-offset":new Vt(tt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Vt(tt.paint_line["line-trim-fade-range"]),"line-trim-color":new Vt(tt.paint_line["line-trim-color"]),"line-emissive-strength":new Vt(tt.paint_line["line-emissive-strength"]),"line-border-width":new nr(tt.paint_line["line-border-width"]),"line-border-color":new nr(tt.paint_line["line-border-color"]),"line-occlusion-opacity":new Vt(tt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},XP);class nne extends nr{possiblyEvaluate(s,l){return l=new Xs(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition,worldview:l.worldview}),super.possiblyEvaluate(s,l)}evaluate(s,l,f,m){return l=Object.assign({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(s,l,f,m)}}let Hb;function l5(u,s){return s>0?s+2*u:u}const sne=In([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ine=In([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ane=In([{name:"a_projected_pos",components:4,type:"Float32"}],4);In([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const one=In([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),lne=In([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),cne=In([{name:"a_texb",components:2,type:"Uint16"}]),une=In([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),dne=In([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const c5=In([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hne=In([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);In([{name:"triangle",components:3,type:"Uint16"}]),In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),In([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),In([{type:"Float32",name:"offsetX"}]),In([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var co=24;function fne(u,s,l){return u.sections.forEach(f=>{f.text=function(m,y,x){const b=y.layout.get("text-transform").evaluate(x,{});return b==="uppercase"?m=m.toLocaleUpperCase():b==="lowercase"&&(m=m.toLocaleLowerCase()),Dl.applyArabicShaping&&(m=Dl.applyArabicShaping(m)),m}(f.text,s,l)}),u}const Wb={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function pne(u){return u==="︶"||u==="﹈"||u==="︸"||u==="﹄"||u==="﹂"||u==="︾"||u==="︼"||u==="︺"||u==="︘"||u==="﹀"||u==="︐"||u==="︓"||u==="︔"||u==="｀"||u==="￣"||u==="︑"||u==="︒"}function mne(u){return u==="︵"||u==="﹇"||u==="︷"||u==="﹃"||u==="﹁"||u==="︽"||u==="︻"||u==="︹"||u==="︗"||u==="︿"}const YP=4294967296,u5=1/YP,d5=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let y2=class{constructor(u=new Uint8Array(16)){this.buf=ArrayBuffer.isView(u)?u:new Uint8Array(u),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(u,s,l=this.length){for(;this.pos<l;){const f=this.readVarint(),m=f>>3,y=this.pos;this.type=7&f,u(m,s,this),this.pos===y&&this.skip(f)}return s}readMessage(u,s){return this.readFields(u,s,this.readVarint()+this.pos)}readFixed32(){const u=this.dataView.getUint32(this.pos,!0);return this.pos+=4,u}readSFixed32(){const u=this.dataView.getInt32(this.pos,!0);return this.pos+=4,u}readFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*YP;return this.pos+=8,u}readSFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*YP;return this.pos+=8,u}readFloat(){const u=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,u}readDouble(){const u=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,u}readVarint(u){const s=this.buf;let l,f;return f=s[this.pos++],l=127&f,f<128?l:(f=s[this.pos++],l|=(127&f)<<7,f<128?l:(f=s[this.pos++],l|=(127&f)<<14,f<128?l:(f=s[this.pos++],l|=(127&f)<<21,f<128?l:(f=s[this.pos],l|=(15&f)<<28,function(m,y,x){const b=x.buf;let j,N;if(N=b[x.pos++],j=(112&N)>>4,N<128||(N=b[x.pos++],j|=(127&N)<<3,N<128)||(N=b[x.pos++],j|=(127&N)<<10,N<128)||(N=b[x.pos++],j|=(127&N)<<17,N<128)||(N=b[x.pos++],j|=(127&N)<<24,N<128)||(N=b[x.pos++],j|=(1&N)<<31,N<128))return Kx(m,j,y);throw new Error("Expected varint not more than 10 bytes")}(l,u,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const u=this.readVarint();return u%2==1?(u+1)/-2:u/2}readBoolean(){return!!this.readVarint()}readString(){const u=this.readVarint()+this.pos,s=this.pos;return this.pos=u,u-s>=12&&d5?d5.decode(this.buf.subarray(s,u)):function(l,f,m){let y="",x=f;for(;x<m;){const b=l[x];let j,N,k,M=null,D=b>239?4:b>223?3:b>191?2:1;if(x+D>m)break;D===1?b<128&&(M=b):D===2?(j=l[x+1],(192&j)==128&&(M=(31&b)<<6|63&j,M<=127&&(M=null))):D===3?(j=l[x+1],N=l[x+2],(192&j)==128&&(192&N)==128&&(M=(15&b)<<12|(63&j)<<6|63&N,(M<=2047||M>=55296&&M<=57343)&&(M=null))):D===4&&(j=l[x+1],N=l[x+2],k=l[x+3],(192&j)==128&&(192&N)==128&&(192&k)==128&&(M=(15&b)<<18|(63&j)<<12|(63&N)<<6|63&k,(M<=65535||M>=1114112)&&(M=null))),M===null?(M=65533,D=1):M>65535&&(M-=65536,y+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),y+=String.fromCharCode(M),x+=D}return y}(this.buf,s,u)}readBytes(){const u=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,u);return this.pos=u,s}readPackedVarint(u=[],s){const l=this.readPackedEnd();for(;this.pos<l;)u.push(this.readVarint(s));return u}readPackedSVarint(u=[]){const s=this.readPackedEnd();for(;this.pos<s;)u.push(this.readSVarint());return u}readPackedBoolean(u=[]){const s=this.readPackedEnd();for(;this.pos<s;)u.push(this.readBoolean());return u}readPackedFloat(u=[]){const s=this.readPackedEnd();for(;this.pos<s;)u.push(this.readFloat());return u}readPackedDouble(u=[]){const s=this.readPackedEnd();for(;this.pos<s;)u.push(this.readDouble());return u}readPackedFixed32(u=[]){const s=this.readPackedEnd();for(;this.pos<s;)u.push(this.readFixed32());return u}readPackedSFixed32(u=[]){const s=this.readPackedEnd();for(;this.pos<s;)u.push(this.readSFixed32());return u}readPackedFixed64(u=[]){const s=this.readPackedEnd();for(;this.pos<s;)u.push(this.readFixed64());return u}readPackedSFixed64(u=[]){const s=this.readPackedEnd();for(;this.pos<s;)u.push(this.readSFixed64());return u}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(u){const s=7&u;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(u,s){this.writeVarint(u<<3|s)}realloc(u){let s=this.length||16;for(;s<this.pos+u;)s*=2;if(s!==this.length){const l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeSFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*u5),!0),this.pos+=8}writeSFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*u5),!0),this.pos+=8}writeVarint(u){(u=+u||0)>268435455||u<0?function(s,l){let f,m;if(s>=0?(f=s%4294967296|0,m=s/4294967296|0):(f=~(-s%4294967296),m=~(-s/4294967296),4294967295^f?f=f+1|0:(f=0,m=m+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(y,x,b){b.buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,b.buf[b.pos]=127&(y>>>=7)}(f,0,l),function(y,x){const b=(7&y)<<4;x.buf[x.pos++]|=b|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(m,l)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))}writeSVarint(u){this.writeVarint(u<0?2*-u-1:2*u)}writeBoolean(u){this.writeVarint(+u)}writeString(u){u=String(u),this.realloc(4*u.length),this.pos++;const s=this.pos;this.pos=function(f,m,y){for(let x,b,j=0;j<m.length;j++){if(x=m.charCodeAt(j),x>55295&&x<57344){if(!b){x>56319||j+1===m.length?(f[y++]=239,f[y++]=191,f[y++]=189):b=x;continue}if(x<56320){f[y++]=239,f[y++]=191,f[y++]=189,b=x;continue}x=b-55296<<10|x-56320|65536,b=null}else b&&(f[y++]=239,f[y++]=191,f[y++]=189,b=null);x<128?f[y++]=x:(x<2048?f[y++]=x>>6|192:(x<65536?f[y++]=x>>12|224:(f[y++]=x>>18|240,f[y++]=x>>12&63|128),f[y++]=x>>6&63|128),f[y++]=63&x|128)}return y}(this.buf,u,this.pos);const l=this.pos-s;l>=128&&h5(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l}writeFloat(u){this.realloc(4),this.dataView.setFloat32(this.pos,u,!0),this.pos+=4}writeDouble(u){this.realloc(8),this.dataView.setFloat64(this.pos,u,!0),this.pos+=8}writeBytes(u){const s=u.length;this.writeVarint(s),this.realloc(s);for(let l=0;l<s;l++)this.buf[this.pos++]=u[l]}writeRawMessage(u,s){this.pos++;const l=this.pos;u(s,this);const f=this.pos-l;f>=128&&h5(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f}writeMessage(u,s,l){this.writeTag(u,2),this.writeRawMessage(s,l)}writePackedVarint(u,s){s.length&&this.writeMessage(u,gne,s)}writePackedSVarint(u,s){s.length&&this.writeMessage(u,_ne,s)}writePackedBoolean(u,s){s.length&&this.writeMessage(u,vne,s)}writePackedFloat(u,s){s.length&&this.writeMessage(u,yne,s)}writePackedDouble(u,s){s.length&&this.writeMessage(u,xne,s)}writePackedFixed32(u,s){s.length&&this.writeMessage(u,wne,s)}writePackedSFixed32(u,s){s.length&&this.writeMessage(u,bne,s)}writePackedFixed64(u,s){s.length&&this.writeMessage(u,Sne,s)}writePackedSFixed64(u,s){s.length&&this.writeMessage(u,Ene,s)}writeBytesField(u,s){this.writeTag(u,2),this.writeBytes(s)}writeFixed32Field(u,s){this.writeTag(u,5),this.writeFixed32(s)}writeSFixed32Field(u,s){this.writeTag(u,5),this.writeSFixed32(s)}writeFixed64Field(u,s){this.writeTag(u,1),this.writeFixed64(s)}writeSFixed64Field(u,s){this.writeTag(u,1),this.writeSFixed64(s)}writeVarintField(u,s){this.writeTag(u,0),this.writeVarint(s)}writeSVarintField(u,s){this.writeTag(u,0),this.writeSVarint(s)}writeStringField(u,s){this.writeTag(u,2),this.writeString(s)}writeFloatField(u,s){this.writeTag(u,5),this.writeFloat(s)}writeDoubleField(u,s){this.writeTag(u,1),this.writeDouble(s)}writeBooleanField(u,s){this.writeVarintField(u,+s)}};function Kx(u,s,l){return l?4294967296*s+(u>>>0):4294967296*(s>>>0)+(u>>>0)}function h5(u,s,l){const f=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(f);for(let m=l.pos-1;m>=u;m--)l.buf[m+f]=l.buf[m]}function gne(u,s){for(let l=0;l<u.length;l++)s.writeVarint(u[l])}function _ne(u,s){for(let l=0;l<u.length;l++)s.writeSVarint(u[l])}function yne(u,s){for(let l=0;l<u.length;l++)s.writeFloat(u[l])}function xne(u,s){for(let l=0;l<u.length;l++)s.writeDouble(u[l])}function vne(u,s){for(let l=0;l<u.length;l++)s.writeBoolean(u[l])}function wne(u,s){for(let l=0;l<u.length;l++)s.writeFixed32(u[l])}function bne(u,s){for(let l=0;l<u.length;l++)s.writeSFixed32(u[l])}function Sne(u,s){for(let l=0;l<u.length;l++)s.writeFixed64(u[l])}function Ene(u,s){for(let l=0;l<u.length;l++)s.writeSFixed64(u[l])}const JP=3;function Tne(u,s,l){s.glyphs=[],u===1&&l.readMessage(jne,s)}function jne(u,s,l){if(u===3){const{id:f,bitmap:m,width:y,height:x,left:b,top:j,advance:N}=l.readMessage(Nne,{});s.glyphs.push({id:f,bitmap:new gm({width:y+2*JP,height:x+2*JP},m),metrics:{width:y,height:x,left:b,top:j,advance:N}})}else u===4?s.ascender=l.readSVarint():u===5&&(s.descender=l.readSVarint())}function Nne(u,s,l){u===1?s.id=l.readVarint():u===2?s.bitmap=l.readBytes():u===3?s.width=l.readVarint():u===4?s.height=l.readVarint():u===5?s.left=l.readSVarint():u===6?s.top=l.readSVarint():u===7&&(s.advance=l.readVarint())}const f5=JP,fc={horizontal:1,vertical:2,horizontalOnly:3};class Zb{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(s,l){const f=new Zb;return f.scale=s||1,f.fontStack=l,f}static forImage(s){const l=new Zb;return l.image=s,l}}class Xx{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,l,f){const m=new Xx;for(let y=0;y<s.sections.length;y++){const x=s.sections[y];x.image?m.addImageSection(x,f):m.addTextSection(x,l)}return m}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSections(){return this.sections}getSectionIndex(s){return this.sectionIndex[s]}getCodePoint(s){return this.text.codePointAt(s)}verticalizePunctuation(s){this.text=function(l,f){let m="";for(let y=0;y<l.length;y++){const x=l.charCodeAt(y+1)||null,b=l.charCodeAt(y-1)||null;m+=!f&&(x&&Jw(x)&&!Wb[l[y+1]]||b&&Jw(b)&&!Wb[l[y-1]])||!Wb[l[y]]?l[y]:Wb[l[y]]}return m}(this.text,s)}trim(){let s=0;for(let f=0;f<this.text.length&&x2[this.text.charCodeAt(f)];f++)s++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&x2[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(s,l),this.sectionIndex=this.sectionIndex.slice(s,l)}substring(s,l){const f=new Xx;return f.text=this.text.substring(s,l),f.sectionIndex=this.sectionIndex.slice(s,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,l)=>Math.max(s,this.sections[l].scale),0)}addTextSection(s,l){this.text+=s.text,this.sections.push(Zb.forText(s.scale,s.fontStack||l));const f=this.sections.length-1;for(let m=0;m<s.text.length;++m)this.sectionIndex.push(f)}addImageSection(s,l){const f=s.image?s.image.getPrimary():null;if(!f)return void Ar("Can't add FormattedSection with an empty image.");f.scaleSelf(l);const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCodePoint(m),this.sections.push(Zb.forImage(f)),this.sectionIndex.push(this.sections.length-1)):Ar("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function QP(u,s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee=1){const ne=Xx.fromFeature(u,m,ee);M===fc.vertical&&ne.verticalizePunctuation(D);let ie=[];const me=function(Le,Ve,He,mt,rt,gt){if(!Le)return[];const bt=[],Ct=function(Dt,ht,ut,kt,$t,It){let ur=0;for(let _r=0;_r<Dt.length();_r++){const ir=Dt.getSection(_r);ur+=p5(Dt.getCodePoint(_r),ir,kt,$t,ht,It)}return ur/Math.max(1,Math.ceil(ur/ut))}(Le,Ve,He,mt,rt,gt),Gt=Le.text.indexOf("​")>=0;let Ot=0;for(let Dt=0;Dt<Le.length();Dt++){const ht=Le.getSection(Dt),ut=Le.getCodePoint(Dt);if(x2[ut]||(Ot+=p5(ut,ht,mt,rt,Ve,gt)),Dt<Le.length()-1){const kt=!((Et=ut)<11904||!(Or["Bopomofo Extended"](Et)||Or.Bopomofo(Et)||Or["CJK Compatibility Forms"](Et)||Or["CJK Compatibility Ideographs"](Et)||Or["CJK Compatibility"](Et)||Or["CJK Radicals Supplement"](Et)||Or["CJK Strokes"](Et)||Or["CJK Symbols and Punctuation"](Et)||Or["CJK Unified Ideographs Extension A"](Et)||Or["CJK Unified Ideographs"](Et)||Or["Enclosed CJK Letters and Months"](Et)||Or["Halfwidth and Fullwidth Forms"](Et)||Or.Hiragana(Et)||Or["Ideographic Description Characters"](Et)||Or["Kangxi Radicals"](Et)||Or["Katakana Phonetic Extensions"](Et)||Or.Katakana(Et)||Or["Vertical Forms"](Et)||Or["Yi Radicals"](Et)||Or["Yi Syllables"](Et)));(Ine[ut]||kt||ht.image)&&bt.push(g5(Dt+1,Ot,Ct,bt,Cne(ut,Le.getCodePoint(Dt+1),kt&&Gt),!1))}}var Et;return _5(g5(Le.length(),Ot,Ct,bt,0,!0))}(ne,N,y,s,f,q),{processBidirectionalText:ye,processStyledBidirectionalText:be}=Dl;if(ye&&ne.sections.length===1){const Le=ye(ne.toString(),me);for(const Ve of Le){const He=new Xx;He.text=Ve,He.sections=ne.sections;for(let mt=0;mt<Ve.length;mt++)He.sectionIndex.push(0);ie.push(He)}}else if(be){const Le=be(ne.text,ne.sectionIndex,me);for(const Ve of Le){const He=new Xx;He.text=Ve[0],He.sectionIndex=Ve[1],He.sections=ne.sections,ie.push(He)}}else ie=function(Le,Ve){const He=[],mt=Le.text;let rt=0;for(const gt of Ve)He.push(Le.substring(rt,gt)),rt=gt;return rt<mt.length&&He.push(Le.substring(rt,mt.length)),He}(ne,me);const Me=[],Ce={positionedLines:Me,text:ne.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Le,Ve,He,mt,rt,gt,bt,Ct,Gt,Ot,Et,Dt){let ht=0,ut=0,kt=0;const $t=Ct==="right"?1:Ct==="left"?0:.5;let It=!1;for(const tr of rt){const Pr=tr.getSections();for(const an of Pr){if(an.image)continue;const Sn=Ve[an.fontStack];if(Sn&&(It=Sn.ascender!==void 0&&Sn.descender!==void 0,!It))break}if(!It)break}let ur=0;for(const tr of rt){tr.trim();const Pr=tr.getMaxScale(),an=(Pr-1)*co,Sn={positionedGlyphs:[],lineOffset:0};Le.positionedLines[ur]=Sn;const Hn=Sn.positionedGlyphs;let cn=0;if(!tr.length()){ut+=gt,++ur;continue}let ts=0,rs=0;for(let Ae=0;Ae<tr.length();Ae++){const je=tr.getSection(Ae),_t=tr.getSectionIndex(Ae),Yt=tr.getCodePoint(Ae);let yt=je.scale,er=null,Er=null,Sr=null,un=co,$r=0,vr=Gt;vr===fc.vertical&&((_r=Yt)===12312||_r===12313||_r===12316||_r===12540||_r===12448)&&(vr=fc.horizontal);const Qn=!(vr===fc.horizontal||!Et&&!Sx(Yt)||Et&&(x2[Yt]||Qw(Yt)));if(je.image){const As=mt.get(je.image.toString());if(!As)continue;Sr=je.image,Le.iconsInText=Le.iconsInText||!0,Er=As.paddedRect;const Hr=As.displaySize;yt=yt*co/Dt,er={width:Hr[0],height:Hr[1],left:0,top:-f5,advance:Qn?Hr[1]:Hr[0],localGlyph:!1},$r=It?-er.height*yt:Pr*co-17-Hr[1]*yt,un=er.advance;const qn=(Qn?Hr[0]:Hr[1])*yt-co*Pr;qn>0&&qn>cn&&(cn=qn)}else{const As=He[je.fontStack];if(!As)continue;As[Yt]&&(Er=As[Yt]);const Hr=Ve[je.fontStack];if(!Hr)continue;const qn=Hr.glyphs[Yt];if(!qn)continue;if(er=qn.metrics,un=Yt!==8203?co:0,It){const Ps=Hr.ascender!==void 0?Math.abs(Hr.ascender):0,xs=Hr.descender!==void 0?Math.abs(Hr.descender):0,ji=(Ps+xs)*yt;ts<ji&&(ts=ji,rs=(Ps-xs)/2*yt),$r=-Ps*yt}else $r=(Pr-yt)*co-17}Qn?(Le.verticalizable=!0,Hn.push({glyph:Yt,image:Sr,x:ht,y:ut+$r,vertical:Qn,scale:yt,localGlyph:er.localGlyph,fontStack:je.fontStack,sectionIndex:_t,metrics:er,rect:Er}),ht+=un*yt+Ot):(Hn.push({glyph:Yt,image:Sr,x:ht,y:ut+$r,vertical:Qn,scale:yt,localGlyph:er.localGlyph,fontStack:je.fontStack,sectionIndex:_t,metrics:er,rect:Er}),ht+=er.advance*yt+Ot)}Hn.length!==0&&(kt=Math.max(ht-Ot,kt),It?y5(Hn,$t,cn,rs,gt*Pr/2):y5(Hn,$t,cn,0,gt/2)),ht=0;const mi=gt*Pr+cn;Sn.lineOffset=Math.max(cn,an),ut+=mi,++ur}var _r;const ir=ut,{horizontalAlign:Jt,verticalAlign:Qr}=ek(bt);(function(tr,Pr,an,Sn,Hn,cn){const ts=(Pr-an)*Hn,rs=-cn*Sn;for(const mi of tr)for(const Ae of mi.positionedGlyphs)Ae.x+=ts,Ae.y+=rs})(Le.positionedLines,$t,Jt,Qr,kt,ir),Le.top+=-Qr*ir,Le.bottom=Le.top+ir,Le.left+=-Jt*kt,Le.right=Le.left+kt,Le.hasBaseline=It}(Ce,s,l,f,ie,x,b,j,M,N,D,G),!function(Le){for(const Ve of Le)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(Me))return Ce}const x2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ine={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function p5(u,s,l,f,m,y){if(s.image){const x=f.get(s.image.toString());return x?x.displaySize[0]*s.scale*co/y+m:0}{const x=l[s.fontStack],b=x&&x.glyphs[u];return b?b.metrics.advance*s.scale+m:0}}function m5(u,s,l,f){const m=Math.pow(u-s,2);return f?u<s?m/2:2*m:m+Math.abs(l)*l}function Cne(u,s,l){let f=0;return u===10&&(f-=1e4),l&&(f+=150),u!==40&&u!==65288||(f+=50),s!==41&&s!==65289||(f+=50),f}function g5(u,s,l,f,m,y){let x=null,b=m5(s,l,m,y);for(const j of f){const N=m5(s-j.x,l,m,y)+j.badness;N<=b&&(x=j,b=N)}return{index:u,x:s,priorBreak:x,badness:b}}function _5(u){return u?_5(u.priorBreak).concat(u.index):[]}function ek(u){let s=.5,l=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function y5(u,s,l,f,m){if(!(s||l||f||m))return;const y=u.length-1,x=u[y],b=(x.x+x.metrics.advance*x.scale)*s;for(let j=0;j<=y;j++)u[j].x-=b,u[j].y+=l+f+m}function x5(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function v2(u,s,l,f){const{horizontalAlign:m,verticalAlign:y}=ek(f),x=l[0]-u.displaySize[0]*m,b=l[1]-u.displaySize[1]*y;return{imagePrimary:u,imageSecondary:s,top:b,bottom:b+u.displaySize[1],left:x,right:x+u.displaySize[0]}}function tk(u,s,l,f,m,y){const x=u.imagePrimary;let b;if(x.content){const ne=x.content,ie=x.pixelRatio||1;b=[ne[0]/ie,ne[1]/ie,x.displaySize[0]-ne[2]/ie,x.displaySize[1]-ne[3]/ie]}const j=s.left*y,N=s.right*y;let k,M,D,q;l==="width"||l==="both"?(q=m[0]+j-f[3],M=m[0]+N+f[1]):(q=m[0]+(j+N-x.displaySize[0])/2,M=q+x.displaySize[0]);const G=s.top*y,ee=s.bottom*y;return l==="height"||l==="both"?(k=m[1]+G-f[0],D=m[1]+ee+f[2]):(k=m[1]+(G+ee-x.displaySize[1])/2,D=k+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:k,right:M,bottom:D,left:q,collisionPadding:b}}function v5(u){return!u.imagePrimary.stretchX}function w5(u){return!u.imagePrimary.stretchY}function b5(u){return{width:u.right-u.left,height:u.bottom-u.top}}const Ad=128;function Yx(u,s,l){const{expression:f}=s;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Xs(u+1,{worldview:l}))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:y}=f;let x=0;for(;x<m.length&&m[x]<=u;)x++;x=Math.max(0,x-1);let b=x;for(;b<m.length&&m[b]<u+1;)b++;b=Math.min(m.length-1,b);const j=m[x],N=m[b];return f.kind==="composite"?{kind:"composite",minZoom:j,maxZoom:N,interpolationType:y}:{kind:"camera",minZoom:j,maxZoom:N,minSize:f.evaluate(new Xs(j,{worldview:l})),maxSize:f.evaluate(new Xs(N,{worldview:l})),interpolationType:y}}}function rk(u,{uSize:s,uSizeT:l},{lowerSize:f,upperSize:m}){return u.kind==="source"?f/Ad:u.kind==="composite"?Ur(f/Ad,m/Ad,l):s}function Jx(u,s,l=1){let f=0,m=0;if(u.kind==="constant")m=u.layoutSize*l;else if(u.kind!=="source"){const{interpolationType:y,minZoom:x,maxZoom:b}=u,j=y?he(sc.interpolationFactor(y,s,x,b),0,1):0;u.kind==="camera"?m=Ur(u.minSize,u.maxSize,j)*l:f=j*l}return{uSizeT:f,uSize:m}}class Bf extends Rt{constructor(s,l,f,m,y){super(s,l),this.angle=m,this.z=f,y!==void 0&&(this.segment=y)}clone(){return new Bf(this.x,this.y,this.z,this.angle,this.segment)}}function S5(u,s,l,f,m){if(s.segment===void 0)return!0;let y=s,x=s.segment+1,b=0;for(;b>-l/2;){if(x--,x<0)return!1;b-=u[x].dist(y),y=u[x]}b+=u[x].dist(u[x+1]),x++;const j=[];let N=0;for(;b<l/2;){const k=u[x],M=u[x+1];if(!M)return!1;let D=u[x-1].angleTo(k)-k.angleTo(M);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),j.push({distance:b,angleDelta:D}),N+=D;b-j[0].distance>f;)N-=j.shift().angleDelta;if(N>m)return!1;x++,b+=k.dist(M)}return!0}function E5(u){let s=0;for(let l=0;l<u.length-1;l++)s+=u[l].dist(u[l+1]);return s}function T5(u,s,l){return u?.6*s*l:0}function j5(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function Ane(u,s,l,f,m,y){const x=T5(l,m,y),b=j5(l,f)*y;let j=0;const N=E5(u)/2;for(let k=0;k<u.length-1;k++){const M=u[k],D=u[k+1],q=M.dist(D);if(j+q>N){const G=(N-j)/q,ee=Ur(M.x,D.x,G),ne=Ur(M.y,D.y,G),ie=new Bf(ee,ne,0,D.angleTo(M),k);return!x||S5(u,ie,b,x,s)?ie:void 0}j+=q}}function Pne(u,s,l,f,m,y,x,b,j){const N=T5(f,y,x),k=j5(f,m),M=k*x,D=u[0].x===0||u[0].x===j||u[0].y===0||u[0].y===j;return s-M<s/4&&(s=M+s/4),N5(u,D?s/2*b%s:(k/2+2*y)*x*b%s,s,N,l,M,D,!1,j)}function N5(u,s,l,f,m,y,x,b,j){const N=y/2,k=E5(u);let M=0,D=s-l,q=[];for(let G=0;G<u.length-1;G++){const ee=u[G],ne=u[G+1],ie=ee.dist(ne),me=ne.angleTo(ee);for(;D+l<M+ie;){D+=l;const ye=(D-M)/ie,be=Ur(ee.x,ne.x,ye),Me=Ur(ee.y,ne.y,ye);if(be>=0&&be<j&&Me>=0&&Me<j&&D-N>=0&&D+N<=k){const Ce=new Bf(be,Me,0,me,G);f&&!S5(u,Ce,y,f,m)||q.push(Ce)}}M+=ie}return b||q.length||x||(q=N5(u,M/2,l,f,m,y,x,!0,j)),q}function I5(u){let s=0,l=0;for(const x of u)s+=x.w*x.h,l=Math.max(l,x.w);u.sort((x,b)=>b.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}];let m=0,y=0;for(const x of u)for(let b=f.length-1;b>=0;b--){const j=f[b];if(!(x.w>j.w||x.h>j.h)){if(x.x=j.x,x.y=j.y,y=Math.max(y,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===j.w&&x.h===j.h){const N=f.pop();N&&b<f.length&&(f[b]=N)}else x.h===j.h?(j.x+=x.w,j.w-=x.w):x.w===j.w?(j.y+=x.h,j.h-=x.h):(f.push({x:j.x+x.w,y:j.y,w:j.w-x.w,h:x.h}),j.y+=x.h,j.h-=x.h);break}}return{w:m,h:y,fill:s/(m*y)||0}}hr(Bf,"Anchor");const x_=1;class Kb{static getImagePositionScale(s,l,f){if(l&&s&&s.options&&s.options.transform){const m=s.options.transform;return{x:m.a,y:m.d}}return{x:f,y:f}}constructor(s,l,f,m){this.paddedRect=s;const{pixelRatio:y,version:x,stretchX:b,stretchY:j,content:N,sdf:k,usvg:M}=l;this.pixelRatio=y,this.stretchX=b,this.stretchY=j,this.content=N,this.version=x,this.padding=f,this.sdf=k,this.usvg=M,this.scale=Kb.getImagePositionScale(m,M,y)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function nk(u,s,l){const f=Ji.parse(u),m=function(y,x,b=[1,1]){return{x:0,y:0,w:(y.data?y.data.width:y.width*b[0])+2*x,h:(y.data?y.data.height:y.height*b[1])+2*x}}(s,l,[f.options.transform.a,f.options.transform.d]);return{bin:m,imagePosition:new Kb(m,s,l,f),imageVariant:f}}class C5{constructor(s,l,f){const m=new Map,y=new Map;this.haveRenderCallbacks=[];const x=[];this.addImages(s,m,x_,x),this.addImages(l,y,2,x);const{w:b,h:j}=I5(x),N=new Io({width:b||1,height:j||1});for(const[k,M]of s.entries()){const D=m.get(k).paddedRect;Io.copy(M.data,N,{x:0,y:0},{x:D.x+x_,y:D.y+x_},M.data,null,M.sdf)}for(const[k,M]of l.entries()){const D=y.get(k),q=D.paddedRect;let G=D.padding;const ee=q.x+G,ne=q.y+G,ie=M.data.width,me=M.data.height;G=G>1?G-1:G,Io.copy(M.data,N,{x:0,y:0},{x:ee,y:ne},M.data,f),Io.copy(M.data,N,{x:0,y:me-G},{x:ee,y:ne-G},{width:ie,height:G},f),Io.copy(M.data,N,{x:0,y:0},{x:ee,y:ne+me},{width:ie,height:G},f),Io.copy(M.data,N,{x:ie-G,y:0},{x:ee-G,y:ne},{width:G,height:me},f),Io.copy(M.data,N,{x:0,y:0},{x:ee+ie,y:ne},{width:G,height:me},f),Io.copy(M.data,N,{x:ie-G,y:me-G},{x:ee-G,y:ne-G},{width:G,height:G},f),Io.copy(M.data,N,{x:0,y:me-G},{x:ee+ie,y:ne-G},{width:G,height:G},f),Io.copy(M.data,N,{x:0,y:0},{x:ee+ie,y:ne+me},{width:G,height:G},f),Io.copy(M.data,N,{x:ie-G,y:0},{x:ee-G,y:ne+me},{width:G,height:G},f)}this.lut=f,this.image=N,this.iconPositions=m,this.patternPositions=y}addImages(s,l,f,m){for(const[y,x]of s.entries()){const{bin:b,imagePosition:j,imageVariant:N}=nk(y,x,f);l.set(y,j),m.push(b),x.hasRenderCallback&&this.haveRenderCallbacks.push(N.id)}}patchUpdatedImages(s,l,f){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>s.hasImage(m,f)),s.dispatchRenderCallbacks(this.haveRenderCallbacks,f);for(const m of s.getUpdatedImages(f)){for(const y of this.iconPositions.keys()){const x=Ji.parse(y);if(Yi.isEqual(x.id,m)){const b=s.getImage(m,f);this.patchUpdatedImage(this.iconPositions.get(y),b,l,null)}}for(const y of this.patternPositions.keys()){const x=Ji.parse(y);if(Yi.isEqual(x.id,m)){const b=s.getImage(m,f);this.patchUpdatedImage(this.patternPositions.get(y),b,l,this.lut)}}}}patchUpdatedImage(s,l,f,m=null){if(!s||!l||s.version===l.version)return;s.version=l.version;const[y,x]=s.tl,b=s.sdf;if(this.lut||b){const j={width:l.data.width,height:l.data.height},N=new Io(j);Io.copy(l.data,N,{x:0,y:0},{x:0,y:0},j,m,b),f.update(N,{position:{x:y,y:x}})}else f.update(l.data,{position:{x:y,y:x}})}}hr(Kb,"ImagePosition"),hr(C5,"ImageAtlas");const Xb=1e20;function A5(u,s,l,f,m,y,x,b,j){for(let N=s;N<s+f;N++)P5(u,l*y+N,y,m,x,b,j);for(let N=l;N<l+m;N++)P5(u,N*y+s,1,f,x,b,j)}function P5(u,s,l,f,m,y,x){y[0]=0,x[0]=-Xb,x[1]=Xb,m[0]=u[s];for(let b=1,j=0,N=0;b<f;b++){m[b]=u[s+b*l];const k=b*b;do{const M=y[j];N=(m[b]-m[M]+k-M*M)/(b-M)/2}while(N<=x[j]&&--j>-1);j++,y[j]=b,x[j]=N,x[j+1]=Xb}for(let b=0,j=0;b<f;b++){for(;x[j+1]<b;)j++;const N=y[j],k=b-N;u[s+b*l]=m[N]+k*k}}const Pd=2,sk={none:0,ideographs:1,all:2};class Qx{constructor(s,l,f){this.requestManager=s,this.localGlyphMode=l,this.localFontFamily=f,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(s){this.url=s}getGlyphs(s,l){const f=[],m=this.url||Ks.GLYPHS_URL;for(const y in s)for(const x of s[y])f.push({stack:y,id:x});Fe(f,({stack:y,id:x},b)=>{let j=this.entries[y];j||(j=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=j.glyphs[x];if(N!==void 0)return void b(null,{stack:y,id:x,glyph:N});if(N=this._tinySDF(j,y,x),N)return j.glyphs[x]=N,void b(null,{stack:y,id:x,glyph:N});const k=Math.floor(x/256);if(256*k>65535)return Ar("glyphs > 65535 not supported"),void b(null,{stack:y,id:x,glyph:N});if(j.ranges[k])return void b(null,{stack:y,id:x,glyph:N});let M=j.requests[k];M||(M=j.requests[k]=[],Qx.loadGlyphRange(y,k,m,this.requestManager,(D,q)=>{if(q){j.ascender=q.ascender,j.descender=q.descender;for(const G in q.glyphs)this._doesCharSupportLocalGlyph(+G)||(j.glyphs[+G]=q.glyphs[+G]);j.ranges[k]=!0}for(const G of M)G(D,q);delete j.requests[k]})),M.push((D,q)=>{D?b(D):q&&b(null,{stack:y,id:x,glyph:q.glyphs[x]||null})})},(y,x)=>{if(y)l(y);else if(x){const b={};for(const{stack:j,id:N,glyph:k}of x)b[j]===void 0&&(b[j]={}),b[j].glyphs===void 0&&(b[j].glyphs={}),b[j].glyphs[N]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},b[j].ascender=this.entries[j].ascender,b[j].descender=this.entries[j].descender;l(null,b)}})}_doesCharSupportLocalGlyph(s){return this.localGlyphMode!==sk.none&&(this.localGlyphMode===sk.all?!!this.localFontFamily:!!this.localFontFamily&&(Or["CJK Unified Ideographs"](s)||Or["Hangul Syllables"](s)||Or.Hiragana(s)||Or.Katakana(s)||Or["CJK Symbols and Punctuation"](s)||Or["CJK Unified Ideographs Extension A"](s)||Or["CJK Unified Ideographs Extension B"](s)||Or.Osage(s)))}_tinySDF(s,l,f){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let y=s.tinySDF;if(!y){let ee="400";/bold/i.test(l)?ee="900":/medium/i.test(l)?ee="500":/light/i.test(l)&&(ee="200"),y=s.tinySDF=new Qx.TinySDF({fontFamily:m,fontWeight:ee,fontSize:24*Pd,buffer:3*Pd,radius:8*Pd}),y.fontWeight=ee}if(this.localGlyphs[y.fontWeight][f])return this.localGlyphs[y.fontWeight][f];const x=String.fromCodePoint(f),{data:b,width:j,height:N,glyphWidth:k,glyphHeight:M,glyphLeft:D,glyphTop:q,glyphAdvance:G}=y.draw(x);return this.localGlyphs[y.fontWeight][f]={id:f,bitmap:new gm({width:j,height:N},b),metrics:{width:k/Pd,height:M/Pd,left:D/Pd,top:q/Pd-27,advance:G/Pd,localGlyph:!0}}}}Qx.loadGlyphRange=function(u,s,l,f,m){const y=256*s,x=y+255,b=f.transformRequest(f.normalizeGlyphsURL(l).replace("{fontstack}",u).replace("{range}",`${y}-${x}`),tl.Glyphs);mu(b,(j,N)=>{if(j)m(j);else if(N){const k={},M=function(D){return new y2(D).readFields(Tne,{})}(N);for(const D of M.glyphs)k[D.id]=D;m(null,{glyphs:k,ascender:M.ascender,descender:M.descender})}})},Qx.TinySDF=class{constructor({fontSize:u=24,buffer:s=3,radius:l=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:x="normal",lang:b=null}={}){this.buffer=s,this.cutoff=f,this.radius=l,this.lang=b;const j=this.size=u+4*s,N=this._createCanvas(j),k=this.ctx=N.getContext("2d",{willReadFrequently:!0});k.font=`${x} ${y} ${u}px ${m}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(j*j),this.gridInner=new Float64Array(j*j),this.f=new Float64Array(j),this.z=new Float64Array(j+1),this.v=new Uint16Array(j)}_createCanvas(u){const s=document.createElement("canvas");return s.width=s.height=u,s}draw(u){const{width:s,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(u),x=Math.ceil(l),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),j=Math.min(this.size-this.buffer,x+Math.ceil(f)),N=b+2*this.buffer,k=j+2*this.buffer,M=Math.max(N*k,0),D=new Uint8ClampedArray(M),q={data:D,width:N,height:k,glyphWidth:b,glyphHeight:j,glyphTop:x,glyphLeft:0,glyphAdvance:s};if(b===0||j===0)return q;const{ctx:G,buffer:ee,gridInner:ne,gridOuter:ie}=this;this.lang&&(G.lang=this.lang),G.clearRect(ee,ee,b,j),G.fillText(u,ee,ee+x);const me=G.getImageData(ee,ee,b,j);ie.fill(Xb,0,M),ne.fill(0,0,M);for(let ye=0;ye<j;ye++)for(let be=0;be<b;be++){const Me=me.data[4*(ye*b+be)+3]/255;if(Me===0)continue;const Ce=(ye+ee)*N+be+ee;if(Me===1)ie[Ce]=0,ne[Ce]=Xb;else{const Le=.5-Me;ie[Ce]=Le>0?Le*Le:0,ne[Ce]=Le<0?Le*Le:0}}A5(ie,0,0,N,k,N,this.f,this.v,this.z),A5(ne,ee,ee,b,j,N,this.f,this.v,this.z);for(let ye=0;ye<M;ye++){const be=Math.sqrt(ie[ye])-Math.sqrt(ne[ye]);D[ye]=Math.round(255-255*(be/this.radius+this.cutoff))}return q}};const Oh=x_;function k5(u,s){return u+s[1]-s[0]}function ik(u,s,l,f,m=1){const y=[],x=u.imagePrimary,b=x.pixelRatio,j=x.paddedRect.w-2*Oh,N=x.paddedRect.h-2*Oh,k=(u.right-u.left)*m,M=(u.bottom-u.top)*m,D=x.stretchX||[[0,j]],q=x.stretchY||[[0,N]],G=D.reduce(k5,0),ee=q.reduce(k5,0),ne=j-G,ie=N-ee;let me=0,ye=G,be=0,Me=ee,Ce=0,Le=ne,Ve=0,He=ie;if(x.content&&f){const rt=x.content;me=w2(D,0,rt[0]),be=w2(q,0,rt[1]),ye=w2(D,rt[0],rt[2]),Me=w2(q,rt[1],rt[3]),Ce=rt[0]-me,Ve=rt[1]-be,Le=rt[2]-rt[0]-ye,He=rt[3]-rt[1]-Me}const mt=(rt,gt,bt,Ct)=>{const Gt=b2(rt.stretch-me,ye,k,u.left*m),Ot=S2(rt.fixed-Ce,Le,rt.stretch,G),Et=b2(gt.stretch-be,Me,M,u.top*m),Dt=S2(gt.fixed-Ve,He,gt.stretch,ee),ht=b2(bt.stretch-me,ye,k,u.left*m),ut=S2(bt.fixed-Ce,Le,bt.stretch,G),kt=b2(Ct.stretch-be,Me,M,u.top*m),$t=S2(Ct.fixed-Ve,He,Ct.stretch,ee),It=new Rt(Gt,Et),ur=new Rt(ht,Et),_r=new Rt(ht,kt),ir=new Rt(Gt,kt),Jt=new Rt(Ot/b,Dt/b),Qr=new Rt(ut/b,$t/b),tr=s*Math.PI/180;if(tr){const ts=Math.sin(tr),rs=Math.cos(tr),mi=[rs,-ts,ts,rs];It._matMult(mi),ur._matMult(mi),ir._matMult(mi),_r._matMult(mi)}const Pr=rt.stretch+rt.fixed,an=bt.stretch+bt.fixed,Sn=gt.stretch+gt.fixed,Hn=Ct.stretch+Ct.fixed,cn=u.imageSecondary;return{tl:It,tr:ur,bl:ir,br:_r,texPrimary:{x:x.paddedRect.x+Oh+Pr,y:x.paddedRect.y+Oh+Sn,w:an-Pr,h:Hn-Sn},texSecondary:cn?{x:cn.paddedRect.x+Oh+Pr,y:cn.paddedRect.y+Oh+Sn,w:an-Pr,h:Hn-Sn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jt,pixelOffsetBR:Qr,minFontScaleX:Le/b/k,minFontScaleY:He/b/M,isSDF:l}};if(f&&(x.stretchX||x.stretchY)){const rt=R5(D,ne,G),gt=R5(q,ie,ee);for(let bt=0;bt<rt.length-1;bt++){const Ct=rt[bt],Gt=rt[bt+1];for(let Ot=0;Ot<gt.length-1;Ot++)y.push(mt(Ct,gt[Ot],Gt,gt[Ot+1]))}}else y.push(mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:j+1},{fixed:0,stretch:N+1}));return y}function kne(u,s){const l=u.stretchY||[[0,u.paddedRect.h-2*Oh]];return s&&(u.stretchX||u.stretchY)?M5(u.stretchX||[[0,u.paddedRect.w-2*Oh]])*M5(l):1}function w2(u,s,l){let f=0;for(const m of u)f+=Math.max(s,Math.min(l,m[1]))-Math.max(s,Math.min(l,m[0]));return f}function R5(u,s,l){const f=[{fixed:-Oh,stretch:0}];for(const[m,y]of u){const x=f[f.length-1];f.push({fixed:m-x.stretch,stretch:x.stretch}),f.push({fixed:m-x.stretch,stretch:x.stretch+(y-m)})}return f.push({fixed:s+Oh,stretch:l}),f}function M5(u){return 2*u.length+1}function b2(u,s,l,f){return u/s*l+f}function S2(u,s,l,f){return u-s*l/f}function Rne(u,s,l,f){const m=s+u.positionedLines[f].lineOffset;return f===0?l+m/2:l+(m+(s+u.positionedLines[f-1].lineOffset))/2}function Mne(u,s=1,l=!1){let f=1/0,m=1/0,y=-1/0,x=-1/0;const b=u[0];for(let q=0;q<b.length;q++){const G=b[q];(!q||G.x<f)&&(f=G.x),(!q||G.y<m)&&(m=G.y),(!q||G.x>y)&&(y=G.x),(!q||G.y>x)&&(x=G.y)}const j=Math.min(y-f,x-m);let N=j/2;const k=new Ky([],Dne);if(j===0)return new Rt(f,m);for(let q=f;q<y;q+=j)for(let G=m;G<x;G+=j)k.push(new ev(q+N,G+N,N,u));let M=function(q){let G=0,ee=0,ne=0;const ie=q[0];for(let me=0,ye=ie.length,be=ye-1;me<ye;be=me++){const Me=ie[me],Ce=ie[be],Le=Me.x*Ce.y-Ce.x*Me.y;ee+=(Me.x+Ce.x)*Le,ne+=(Me.y+Ce.y)*Le,G+=3*Le}return new ev(ee/G,ne/G,0,q)}(u),D=k.length;for(;k.length;){const q=k.pop();(q.d>M.d||!M.d)&&(M=q,l&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,D)),q.max-M.d<=s||(N=q.h/2,k.push(new ev(q.p.x-N,q.p.y-N,N,u)),k.push(new ev(q.p.x+N,q.p.y-N,N,u)),k.push(new ev(q.p.x-N,q.p.y+N,N,u)),k.push(new ev(q.p.x+N,q.p.y+N,N,u)),D+=4)}return l&&(console.log(`num probes: ${D}`),console.log(`best distance: ${M.d}`)),M.p}function Dne(u,s){return s.max-u.max}class ev{constructor(s,l,f,m){this.p=new Rt(s,l),this.h=f,this.d=function(y,x){let b=!1,j=1/0;for(let N=0;N<x.length;N++){const k=x[N];for(let M=0,D=k.length,q=D-1;M<D;q=M++){const G=k[M],ee=k[q];G.y>y.y!=ee.y>y.y&&y.x<(ee.x-G.x)*(y.y-G.y)/(ee.y-G.y)+G.x&&(b=!b),j=Math.min(j,lc(y,G,ee))}}return(b?1:-1)*Math.sqrt(j)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const One=Object.keys,ak=Number.POSITIVE_INFINITY,Lne=Math.sqrt(2);function E2(u,s,l,f){const m=u.collisionPadding||[0,0,0,0],y={top:u.top-m[1],bottom:u.bottom+m[3],left:u.left-m[0],right:u.right+m[2],scaled:!1};return f!==void 0&&function(x,b){x.top*=b,x.bottom*=b,x.left*=b,x.right*=b,x.scaled=!0}(y,f),l&&function(x,b){if(!b)return;const j=Nn(b),N=new Rt(x.left,x.top),k=new Rt(x.right,x.top),M=new Rt(x.left,x.bottom),D=new Rt(x.right,x.bottom);N._rotateAround(j,new Rt(0,0)),k._rotateAround(j,new Rt(0,0)),M._rotateAround(j,new Rt(0,0)),D._rotateAround(j,new Rt(0,0)),x.left=Math.min(N.x,k.x,M.x,D.x),x.right=Math.max(N.x,k.x,M.x,D.x),x.top=Math.min(N.y,k.y,M.y,D.y),x.bottom=Math.max(N.y,k.y,M.y,D.y)}(y,l),s?{top:Math.min(s.top,y.top),bottom:Math.max(s.bottom,y.bottom),left:Math.min(s.left,y.left),right:Math.max(s.right,y.right),scaled:s.scaled||y.scaled}:y}function D5(u,[s,l]){let f=0,m=0;if(l===ak){s<0&&(s=0);const y=s/Lne;switch(u){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-s;break;case"top":m=s-7}switch(u){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=s;break;case"right":f=-s}}else{switch(s=Math.abs(s),l=Math.abs(l),u){case"top-right":case"top-left":case"top":m=l-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-l}switch(u){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}}return[f,m]}function Fne(u,s,l,f,m,y,x,b,j,N,k){const M=u.layers[0],D=M.appearances;if(D.length===0)return{iconBBox:null,iconVerticalBBox:null};let q=null,G=null;const ee=f.get("icon-rotate").evaluate(m,{},y);s&&(q=E2(s,q,ee,x),l)&&(G=E2(l,G,ee+90,x));const[ne,ie]=f.get("icon-size-scale-range"),me=he(1,ne,ie);for(const ye of D){const be=ye.getUnevaluatedProperties(),Me=be._values["icon-image"].value!==void 0,Ce=be._values["icon-size"].value!==void 0,Le=be._values["icon-offset"].value!==void 0,Ve=be._values["icon-rotate"].value!==void 0;if(Me||Ce||Le||Ve){const He=Le?M.getAppearanceValueAndResolveTokens(ye,"icon-offset",m,y,[]):null,mt=He&&Array.isArray(He)?He:b,rt=Ve?M.getAppearanceValueAndResolveTokens(ye,"icon-rotate",m,y,[]):null,gt=typeof rt=="number"?rt:ee,bt=Ce?M.getAppearanceValueAndResolveTokens(ye,"icon-size",m,y,[]):null,Ct=typeof bt=="number"?bt*j.iconScaleFactor:x;let Gt=null,Ot=null,Et=null;if(Me){const Dt=M.getAppearanceValueAndResolveTokens(ye,"icon-image",m,y,[]);if(Dt){const ht=u.getResolvedImageFromTokens(Dt),ut=be._values["icon-size"],kt=Yb(ht,Yx(u.zoom,ut,u.worldview),ut,y,u.zoom,m,u.pixelRatio,me,u.worldview);Et=N.get(kt.iconPrimary.toString())}}else s&&(Et=s.imagePrimary);Et&&(Gt=v2(Et,null,mt,k),u.allowVerticalPlacement&&(Ot=v2(Et,null,mt,k))),Gt&&(q=E2(Gt,q,gt,Ct)),Ot&&(G=E2(Ot,G,gt+90,Ct))}}return{iconBBox:q,iconVerticalBBox:G}}function T2(u,s,l,f,m,y,x,b,j){if(!s||!s.usvg)return;const N=b5(f),k=b5(m),M=y!=="both"&&y!=="width"||!v5(f)?1:k.width/N.width,D=y!=="both"&&y!=="height"||!w5(f)?1:k.height/N.height;l.scaleSelf(M,D);const q=l.toString();x.set(q,l),b.set(q,s);const{imagePosition:G}=nk(q,s,x_);j.set(q,G)}function O5(u,s,l,f,m,y,x,b,j){if(!u)return;const N=function(k,M,D,q,G,ee){if(k.kind==="camera")return k.maxSize;if(k.kind==="composite"){const ne=M.possiblyEvaluate(new Xs(k.maxZoom,{worldview:ee}),D).evaluate(G,{},D),ie=M.possiblyEvaluate(new Xs(k.minZoom,{worldview:ee}),D).evaluate(G,{},D);return Math.max(ne,ie)}return M.possiblyEvaluate(new Xs(q,{worldview:ee})).evaluate(G,{},D)}(s,l,f,m,y,j);return u.scaleSelf(N*b*x)}function Yb(u,s,l,f,m,y,x,b,j){return{iconPrimary:O5(u.getPrimary(),s,l,f,m,y,x,b,j),iconSecondary:O5(u.getSecondary(),s,l,f,m,y,x,b,j)}}function zne(u,s,l){if(!s)return;const f=l.get(u.toString()),m=l.get(s.toString());f&&m&&(f.paddedRect.w===m.paddedRect.w&&f.paddedRect.h===m.paddedRect.h||Ar(`Mismatch in icon variant sizes: ${u.toString()} and ${s.toString()}`),f.usvg!==m.usvg&&Ar(`Mismatch in icon variant image types: ${u.id} and ${s.id}`))}function L5(u,s,l,f){if(!u)return;const m=s.get(l.toString());if(u.imagePrimary=m,f){const y=s.get(f.toString());u.imageSecondary=y}}function Bne(u,s){for(const l in u.horizontal)F5(u.horizontal[l],s);F5(u.vertical,s)}function F5(u,s){if(u){for(const l of u.positionedLines)for(const f of l.positionedGlyphs)if(f.image!==null){const m=f.image.toString();f.rect=s.get(m).paddedRect}}}function ok(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Vne(u,s,l,f,m,y,x,b,j){const N=lk(y.horizontal)||y.vertical,k=l.get("icon-text-fit-padding").evaluate(f,{},m);let M,D=s;return s&&j!=="none"&&(u.allowVerticalPlacement&&y.vertical&&(M=tk(s,y.vertical,j,k,b,x)),N&&(D=tk(s,N,j,k,b,x))),{defaultShapedIcon:D,verticallyShapedIcon:M}}function Une(u,s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me,ye,be,Me){let Ce=x.textMaxSize.evaluate(s,{},D);Ce===void 0?Ce=b*x.textScaleFactor:Ce*=x.textScaleFactor;const Le=u.layers[0].layout,Ve=co,He=b*x.textScaleFactor/Ve,mt=lk(l.horizontal)||l.vertical;if(ne!=="none"&&u.appearanceFeatureData&&s.index<u.appearanceFeatureData.length){const It=u.appearanceFeatureData[s.index];It&&(It.textShaping=mt,It.iconTextFitPadding=Le.get("icon-text-fit-padding").evaluate(s,{},D),It.fontScale=He)}const rt=q.name==="globe",gt=u.tilePixelRatio*Ce/Ve,bt=(ht=u.overscaling,u.zoom>18&&ht>2&&(ht>>=1),Math.max(Zt/(512*ht),1)*Le.get("symbol-spacing")),Ct=Le.get("text-padding")*u.tilePixelRatio,Gt=Le.get("icon-padding")*u.tilePixelRatio,Ot=Nn(Le.get("text-max-angle")),Et=Le.get("icon-rotation-alignment")==="map"&&ye!=="point",Dt=bt/2;var ht;u.hasAnyIconTextFit===!1&&ne!=="none"&&(u.hasAnyIconTextFit=!0);const ut=s.properties?+s.properties[sr]:null,kt=ut&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(ut):65535,$t=(It,ur,_r)=>{if(ur.x<0||ur.x>=Zt||ur.y<0||ur.y>=Zt)return;let ir=null;if(rt){const{x:Jt,y:Qr,z:tr}=q.projectTilePoint(ur.x,ur.y,_r);ir={anchor:new Bf(Jt,Qr,tr,0,void 0),up:q.upVector(_r,ur.x,ur.y)}}(function(Jt,Qr,tr,Pr,an,Sn,Hn,cn,ts,rs,mi,Ae,je,_t,Yt,yt,er,Er,Sr,un,$r,vr,Qn,As,Hr,qn,Ps,xs,ji,ri,Hs){const Ts=Jt.addToLineVertexArray(Qr,Pr);let ns,dn,ss,Ws,qr,Wn,ni,Di=0,Hi=0,ma=0,si=0,ha=-1,Ol=-1;const fa={};let pc=mh("");const Co=tr?tr.anchor:Qr,wu=xs!=="none";let Ll=0,mc=0;if(ts._unevaluatedLayout.getValue("text-radial-offset")===void 0){const uo=ts.layout.get("text-offset").evaluate($r,{},Hr);Ll=uo[0]*co,mc=uo[1]*co}else Ll=ts.layout.get("text-radial-offset").evaluate($r,{},Hr)*co,mc=ak;if(Jt.allowVerticalPlacement&&an.vertical){const uo=an.vertical;if(Yt)Wn=ck(uo),cn&&(ni=ck(cn));else{const sl=ts.layout.get("text-rotate").evaluate($r,{},Hr)+90;ss=j2(rs,Co,Qr,mi,Ae,je,uo,_t,sl,yt),cn&&(Ws=j2(rs,Co,Qr,mi,Ae,je,cn,Er,sl,null,Hs))}}if(Sn){const uo=Jt.iconSizeData,sl=ts.layout.get("icon-rotate").evaluate($r,{},Hr),Lh=ik(Sn,sl,Qn,wu,vr.iconScaleFactor),wm=cn?ik(cn,sl,Qn,wu,vr.iconScaleFactor):void 0;dn=j2(rs,Co,Qr,mi,Ae,je,Sn,Er,sl,null,ri);const ov=function(Fh,$2,lv,tie,nV,sV,rie,nie){const iV=Fh.layers[0],aV=iV.appearances;let cv=$2.length;if(lv&&(cv=Math.max(cv,lv.length)),aV.length===0)return cv;const[sie,iie]=tie.get("icon-size-scale-range"),aie=he(1,sie,iie);for(const oV of aV){const lV=oV.getUnevaluatedProperties();if(lV._values["icon-image"].value!==void 0){const cV=iV.getAppearanceValueAndResolveTokens(oV,"icon-image",nV,sV,[]);if(cV){const uV=Fh.getResolvedImageFromTokens(cV);if(uV){const dV=lV._values["icon-size"],oie=Yb(uV,Yx(Fh.zoom,dV,Fh.worldview),dV,sV,Fh.zoom,nV,Fh.pixelRatio,aie,Fh.worldview),lie=rie.get(oie.iconPrimary.toString());cv=Math.max(cv,kne(lie,nie))}}}}return cv}(Jt,Lh,wm,ts.layout,$r,Hr,Jt.iconAtlasPositions,wu);Di=4*ov;let bm=null;uo.kind==="source"?(bm=[Ad*ts.layout.get("icon-size").evaluate($r,{},Hr)*vr.iconScaleFactor],bm[0]>Vf&&Ar(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${Jb}. Reduce your "icon-size".`)):uo.kind==="composite"&&(bm=[Ad*vr.compositeIconSizes[0].evaluate($r,{},Hr)*vr.iconScaleFactor,Ad*vr.compositeIconSizes[1].evaluate($r,{},Hr)*vr.iconScaleFactor],(bm[0]>Vf||bm[1]>Vf)&&Ar(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${Jb}. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,Lh,bm,un,Sr,$r,void 0,tr,Qr,Ts.lineStartIndex,Ts.lineLength,-1,As,Hr,qn,Ps,Jt.symbolInstances.length,ov),ha=Jt.icon.placedSymbolArray.length-1,wm&&(Hi=4*ov,Jt.addSymbols(Jt.icon,wm,bm,un,Sr,$r,fc.vertical,tr,Qr,Ts.lineStartIndex,Ts.lineLength,-1,As,Hr,qn,Ps,Jt.symbolInstances.length,ov),Ol=Jt.icon.placedSymbolArray.length-1)}for(const uo in an.horizontal){const sl=uo,Lh=an.horizontal[sl];ns||(pc=mh(Lh.text),Yt?qr=ck(Lh):ns=j2(rs,Co,Qr,mi,Ae,je,Lh,_t,ts.layout.get("text-rotate").evaluate($r,{},Hr),yt));const wm=Lh.positionedLines.length===1;if(ma+=z5(Jt,tr,Qr,Lh,Hn,ts,Yt,$r,yt,Ts,an.vertical?fc.horizontal:fc.horizontalOnly,wm?One(an.horizontal):[sl],fa,ha,vr,As,Hr,Jt.symbolInstances.length,qn),wm)break}an.vertical&&(si+=z5(Jt,tr,Qr,an.vertical,Hn,ts,Yt,$r,yt,Ts,fc.vertical,["vertical"],fa,Ol,vr,As,Hr,Jt.symbolInstances.length,qn));let Ao=-1;const gc=(uo,sl)=>uo?Math.max(uo,sl):sl;Ao=gc(qr,Ao),Ao=gc(Wn,Ao),Ao=gc(ni,Ao);const bu=Ao>-1?1:0;Jt.glyphOffsetArray.length>=65535&&Ar("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$r.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,$r.sortKey),Jt.symbolInstances.emplaceBack(Qr.x,Qr.y,Co.x,Co.y,Co.z,fa.right>=0?fa.right:-1,fa.center>=0?fa.center:-1,fa.left>=0?fa.left:-1,fa.vertical>=0?fa.vertical:-1,ha,Ol,pc,ns!==void 0?ns:Jt.collisionBoxArray.length,ns!==void 0?ns+1:Jt.collisionBoxArray.length,ss!==void 0?ss:Jt.collisionBoxArray.length,ss!==void 0?ss+1:Jt.collisionBoxArray.length,dn!==void 0?dn:Jt.collisionBoxArray.length,dn!==void 0?dn+1:Jt.collisionBoxArray.length,Ws||Jt.collisionBoxArray.length,Ws?Ws+1:Jt.collisionBoxArray.length,mi,ma,si,Di,Hi,bu,0,Ll,mc,Ao,0,wu?1:0,ji)})(u,ur,ir,It,l,f,y,m,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,Ct,me,N,0,Gt,Et,ie,s,x,k,M,D,G,ee,ne,kt,be,Me)};if(ye==="line")for(const It of o2(s.geometry,0,0,Zt,Zt)){const ur=Pne(It,bt,Ot,l.vertical||mt,f,Ve,gt,u.overscaling,Zt);for(const _r of ur)mt&&$ne(u,mt.text,Dt,_r)||$t(It,_r,D)}else if(ye==="line-center"){for(const It of s.geometry)if(It.length>1){const ur=Ane(It,Ot,l.vertical||mt,f,Ve,gt);ur&&$t(It,ur,D)}}else if(s.type==="Polygon")for(const It of Mb(s.geometry,0)){const ur=Mne(It,16);$t(It[0],new Bf(ur.x,ur.y,0,0,void 0),D)}else if(s.type==="LineString")for(const It of s.geometry)$t(It,new Bf(It[0].x,It[0].y,0,0,void 0),D);else if(s.type==="Point")for(const It of s.geometry)for(const ur of It)$t([ur],new Bf(ur.x,ur.y,0,0,void 0),D)}const Jb=255,Vf=Jb*Ad;function z5(u,s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me){const ye=function(Ce,Le,Ve,He,mt,rt,gt,bt){const Ct=[];if(Le.positionedLines.length===0)return Ct;const Gt=He.layout.get("text-rotate").evaluate(rt,{})*Math.PI/180,Ot=function(kt){const $t=kt[0],It=kt[1],ur=$t*It;return ur>0?[$t,-It]:ur<0?[-$t,It]:$t===0?[It,$t]:[It,-$t]}(Ve);let Et=Math.abs(Le.top-Le.bottom);for(const kt of Le.positionedLines)Et-=kt.lineOffset;const Dt=Le.positionedLines.length,ht=Et/Dt;let ut=Le.top-Ve[1];for(let kt=0;kt<Dt;++kt){const $t=Le.positionedLines[kt];ut=Rne(Le,ht,ut,kt);for(const It of $t.positionedGlyphs){if(!It.rect)continue;const ur=It.rect||{};let _r=f5+1,ir=!0,Jt=1,Qr=0;if(It.image){const Sr=gt.get(It.image.toString());if(!Sr)continue;if(Sr.sdf){Ar("SDF images are not supported in formatted text and will be ignored.");continue}ir=!1,Jt=Sr.pixelRatio,_r=x_/Jt}const tr=(mt||bt)&&It.vertical,Pr=It.metrics.advance*It.scale/2,an=It.metrics,Sn=It.rect;if(Sn===null)continue;bt&&Le.verticalizable&&(Qr=It.image?Pr-It.metrics.width*It.scale/2:0);const Hn=mt?[It.x+Pr,It.y]:[0,0];let cn=[0,0],ts=[0,0],rs=!1;mt||(tr?(ts=[It.x+Pr+Ot[0],It.y+Ot[1]-Qr],rs=!0):cn=[It.x+Pr+Ve[0],It.y+Ve[1]-Qr]);const mi=Sn.w*It.scale/(Jt*(It.localGlyph?Pd:1)),Ae=Sn.h*It.scale/(Jt*(It.localGlyph?Pd:1));let je,_t,Yt,yt;if(tr){const Sr=It.y-ut,un=new Rt(-Pr,Pr-Sr),$r=-Math.PI/2,vr=new Rt(...ts);je=new Rt(-Pr+cn[0],cn[1]),je._rotateAround($r,un)._add(vr),je.x+=-Sr+Pr,je.y-=(an.left-_r)*It.scale;const Qn=It.image?an.advance*It.scale:co*It.scale,As=String.fromCodePoint(It.glyph);pne(As)?je.x+=(1-_r)*It.scale:mne(As)?je.x+=Qn-an.height*It.scale+(-_r-1)*It.scale:je.x+=It.image||an.width+2*_r===Sn.w&&an.height+2*_r===Sn.h?(Qn-Ae)/2:(Qn-(an.height+2*_r)*It.scale)/2,_t=new Rt(je.x,je.y-mi),Yt=new Rt(je.x+Ae,je.y),yt=new Rt(je.x+Ae,je.y-mi)}else{const Sr=(an.left-_r)*It.scale-Pr+cn[0],un=(-an.top-_r)*It.scale+cn[1],$r=Sr+mi,vr=un+Ae;je=new Rt(Sr,un),_t=new Rt($r,un),Yt=new Rt(Sr,vr),yt=new Rt($r,vr)}if(Gt){let Sr;Sr=mt?new Rt(0,0):rs?new Rt(Ot[0],Ot[1]):new Rt(Ve[0],Ve[1]),je._rotateAround(Gt,Sr),_t._rotateAround(Gt,Sr),Yt._rotateAround(Gt,Sr),yt._rotateAround(Gt,Sr)}const er=new Rt(0,0),Er=new Rt(0,0);Ct.push({tl:je,tr:_t,bl:Yt,br:yt,texPrimary:ur,texSecondary:void 0,writingMode:Le.writingMode,glyphOffset:Hn,sectionIndex:It.sectionIndex,isSDF:ir,pixelOffsetTL:er,pixelOffsetBR:Er,minFontScaleX:0,minFontScaleY:0})}}return Ct}(0,f,j,y,x,b,m,u.allowVerticalPlacement),be=u.textSizeData;let Me=null;be.kind==="source"?(Me=[Ad*y.layout.get("text-size").evaluate(b,{},ne)*G.textScaleFactor],Me[0]>Vf&&Ar(`${u.layerIds[0]}: Value for "text-size" is >= ${Jb}. Reduce your "text-size".`)):be.kind==="composite"&&(Me=[Ad*G.compositeTextSizes[0].evaluate(b,{},ne)*G.textScaleFactor,Ad*G.compositeTextSizes[1].evaluate(b,{},ne)*G.textScaleFactor],(Me[0]>Vf||Me[1]>Vf)&&Ar(`${u.layerIds[0]}: Value for "text-size" is >= ${Jb}. Reduce your "text-size".`)),u.addSymbols(u.text,ye,Me,j,x,b,k,s,l,N.lineStartIndex,N.lineLength,q,ee,ne,me,!1,ie,ye.length);for(const Ce of M)D[Ce]=u.text.placedSymbolArray.length-1;return 4*ye.length}function lk(u){for(const s in u)return u[s];return null}function j2(u,s,l,f,m,y,x,b,j,N,k){let M,D,q,G;if(M=k?k.top:x.top,D=k?k.bottom:x.bottom,q=k?k.left:x.left,G=k?k.right:x.right,x5(x)&&x.collisionPadding){const ee=x.collisionPadding;q-=ee[0],M-=ee[1],G+=ee[2],D+=ee[3]}if(j){const ee=new Rt(q,M),ne=new Rt(G,M),ie=new Rt(q,D),me=new Rt(G,D),ye=Nn(j);let be=new Rt(0,0);N&&(be=new Rt(N[0],N[1])),ee._rotateAround(ye,be),ne._rotateAround(ye,be),ie._rotateAround(ye,be),me._rotateAround(ye,be),q=Math.min(ee.x,ne.x,ie.x,me.x),G=Math.max(ee.x,ne.x,ie.x,me.x),M=Math.min(ee.y,ne.y,ie.y,me.y),D=Math.max(ee.y,ne.y,ie.y,me.y)}return u.emplaceBack(s.x,s.y,s.z,l.x,l.y,q,M,G,D,b,f,m,y),u.length-1}function ck(u){x5(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const s=u.bottom-u.top;return s>0?Math.max(10,s):null}function $ne(u,s,l,f){const m=u.compareText;if(s in m){const y=m[s];for(let x=y.length-1;x>=0;x--)if(f.dist(y[x])<l)return!0}else m[s]=[];return m[s].push(f),!1}function B5(u,s){const l=u.fovAboveCenter,f=u.elevation?u.elevation.getMinElevationBelowMSL()*s:0,m=(u._camera.position[2]*u.worldSize-f)/Math.cos(u._pitch),y=Math.sin(l)*m/Math.sin(Math.max(Math.PI/2-u._pitch-l,.01));let x=Math.sin(u._pitch)*y+m;const b=m*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let j=Math.max(u.zoom-17,0);u.isOrthographic&&(j/=10),x*=1+j}return Math.min(1.01*x,b)}function Qb(u,s){if(!s.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:s};const l=Math.pow(2,-u.z),f=u.x*l,m=(u.x+1)*l,y=u.y*l,x=(u.y+1)*l,b=Ee(f),j=Ee(m),N=xe(y),k=xe(x),M=s.project(b,N),D=s.project(j,N),q=s.project(j,k),G=s.project(b,k);let ee=Math.min(M.x,D.x,q.x,G.x),ne=Math.min(M.y,D.y,q.y,G.y),ie=Math.max(M.x,D.x,q.x,G.x),me=Math.max(M.y,D.y,q.y,G.y);const ye=l/16;function be(Ce,Le,Ve,He,mt,rt){const gt=(Ve+mt)/2,bt=(He+rt)/2,Ct=s.project(Ee(gt),xe(bt)),Gt=Math.max(0,ee-Ct.x,ne-Ct.y,Ct.x-ie,Ct.y-me);ee=Math.min(ee,Ct.x),ie=Math.max(ie,Ct.x),ne=Math.min(ne,Ct.y),me=Math.max(me,Ct.y),Gt>ye&&(be(Ce,Ct,Ve,He,gt,bt),be(Ct,Le,gt,bt,mt,rt))}be(M,D,f,y,m,y),be(D,q,m,y,m,x),be(q,G,m,x,f,x),be(G,M,f,x,f,y),ee-=ye,ne-=ye,ie+=ye,me+=ye;const Me=1/Math.max(ie-ee,me-ne);return{scale:Me,x:ee*Me,y:ne*Me,x2:ie*Me,y2:me*Me,projection:s}}function V5(u,{x:s,y:l},f=0){return new Rt(((s-f)*u.scale-u.x)*Zt,(l*u.scale-u.y)*Zt)}const qne=K(new Float32Array(16));class xm{constructor(s){this.spec=s,this.name=s.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(s,l){return{x:0,y:0,z:0}}unproject(s,l){return new H(0,0)}projectTilePoint(s,l,f){return{x:s,y:l,z:0}}locationPoint(s,l,f,m=!0){return s._coordinatePoint(s.locationCoordinate(l,f),m)}pixelsPerMeter(s,l){return _e(1,s)*l}pixelSpaceConversion(s,l,f){return 1}farthestPixelDistance(s){return B5(s,s.pixelsPerMeter)}pointCoordinate(s,l,f,m){const y=s.horizonLineFromTop(!1),x=new Rt(l,Math.max(y,f));return s.rayIntersectionCoordinate(s.pointRayIntersection(x,m))}pointCoordinate3D(s,l,f){const m=new Rt(l,f);if(s.elevation)return s.elevation.pointCoordinate(m);{const y=this.pointCoordinate(s,m.x,m.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(s,l){if(s.elevation&&s.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(s,l.x,l.y);const f=s.horizonLineFromTop();return l.y<f}createInversionMatrix(s,l){return qne}createTileMatrix(s,l,f){let m,y,x;const b=f.canonical,j=K(new Float64Array(16));if(this.isReprojectedInTileSpace){const N=Qb(b,this);m=1,y=N.x+f.wrap*N.scale,x=N.y,Q(j,j,[m/N.scale,m/N.scale,s.pixelsPerMeter/l])}else m=l/s.zoomScale(b.z),y=(b.x+Math.pow(2,b.z)*f.wrap)*m,x=b.y*m;return X(j,j,[y,x,0]),Q(j,j,[m/Zt,m/Zt,1]),j}upVector(s,l,f){return[0,0,1]}upVectorScale(s,l,f){return{metersToTile:1}}}class Gne extends xm{constructor(s){super(s),this.range=[4,7],this.center=s.center||[-96,37.5];const[l,f]=this.parallels=s.parallels||[29.5,45.5],m=Math.sin(Nn(l));this.n=(m+Math.sin(Nn(f)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(s,l){const{n:f,c:m,r0:y}=this,x=Nn(s-this.center[0]),b=Nn(l),j=Math.sqrt(m-2*f*Math.sin(b))/f;return{x:j*Math.sin(x*f),y:j*Math.cos(x*f)-y,z:0}}unproject(s,l){const{n:f,c:m,r0:y}=this,x=y+l;let b=Math.atan2(s,Math.abs(x))*Math.sign(x);x*f<0&&(b-=Math.PI*Math.sign(s)*Math.sign(x));const j=Nn(this.center[0])*f;b=ze(b,-Math.PI-j,Math.PI-j);const N=he(_o(b/f)+this.center[0],-180,180),k=Math.asin(he((m-(s*s+x*x)*f*f)/(2*f),-1,1)),M=he(_o(k),-Te,Te);return new H(N,M)}}const e1=1.340264,t1=-.081106,r1=893e-6,n1=.003796,N2=Math.sqrt(3)/2;class Hne extends xm{project(s,l){l=l/180*Math.PI,s=s/180*Math.PI;const f=Math.asin(N2*Math.sin(l)),m=f*f,y=m*m*m;return{x:.5*(s*Math.cos(f)/(N2*(e1+3*t1*m+y*(7*r1+9*n1*m)))/Math.PI+.5),y:1-.5*(f*(e1+t1*m+y*(r1+n1*m))/Math.PI+1),z:0}}unproject(s,l){s=(2*s-.5)*Math.PI;let f=l=(2*(1-l)-1)*Math.PI,m=f*f,y=m*m*m;for(let k,M,D,q=0;q<12&&(M=f*(e1+t1*m+y*(r1+n1*m))-l,D=e1+3*t1*m+y*(7*r1+9*n1*m),k=M/D,f=he(f-k,-Math.PI/3,Math.PI/3),m=f*f,y=m*m*m,!(Math.abs(k)<1e-12));++q);const x=N2*s*(e1+3*t1*m+y*(7*r1+9*n1*m))/Math.cos(f),b=Math.asin(Math.sin(f)/N2),j=he(180*x/Math.PI,-180,180),N=he(180*b/Math.PI,-Te,Te);return new H(j,N)}}class Wne extends xm{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0}project(s,l){return{x:.5+s/360,y:.5-l/360,z:0}}unproject(s,l){const f=360*(s-.5),m=he(360*(.5-l),-Te,Te);return new H(f,m)}}const tv=Math.PI/2;function I2(u){return Math.tan((tv+u)/2)}class Zne extends xm{constructor(s){super(s),this.center=s.center||[0,30];const[l,f]=this.parallels=s.parallels||[30,30];let m=Nn(l),y=Nn(f);this.southernCenter=m+y<0,this.southernCenter&&(m=-m,y=-y);const x=Math.cos(m),b=I2(m);this.n=m===y?Math.sin(m):Math.log(x/Math.cos(y))/Math.log(I2(y)/b),this.f=x*Math.pow(I2(m),this.n)/this.n}project(s,l){l=Nn(l),this.southernCenter&&(l=-l),s=Nn(s-this.center[0]);const f=1e-6,{n:m,f:y}=this;y>0?l<-tv+f&&(l=-tv+f):l>tv-f&&(l=tv-f);const x=y/Math.pow(I2(l),m);let b=x*Math.sin(m*s),j=y-x*Math.cos(m*s);return b=.5*(b/Math.PI+.5),j=.5*(j/Math.PI+.5),{x:b,y:this.southernCenter?j:1-j,z:0}}unproject(s,l){s=(2*s-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:f,f:m}=this,y=m-l,x=Math.sign(y),b=Math.sign(f)*Math.sqrt(s*s+y*y);let j=Math.atan2(s,Math.abs(y))*x;y*f<0&&(j-=Math.PI*Math.sign(s)*x);const N=he(_o(j/f)+this.center[0],-180,180),k=he(_o(2*Math.atan(Math.pow(m/b,1/f))-tv),-Te,Te);return new H(N,this.southernCenter?-k:k)}}class U5 extends xm{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(s,l){return{x:fe(s),y:de(l),z:0}}unproject(s,l){const f=Ee(s),m=xe(l);return new H(f,m)}}const $5=Nn(Te);class Kne extends xm{project(s,l){const f=(l=Nn(l))*l,m=f*f;return{x:.5*((s=Nn(s))*(.8707-.131979*f+m*(m*(.003971*f-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+f*(.015085+m*(.028874*f-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(s,l){s=(2*s-.5)*Math.PI;let f=l=(2*(1-l)-1)*Math.PI,m=25,y=0,x=f*f;do{x=f*f;const N=x*x;y=(f*(1.007226+x*(.015085+N*(.028874*x-.044475-.005916*N)))-l)/(1.007226+x*(.045255+N*(.259866*x-.311325-.005916*11*N))),f=he(f-y,-$5,$5)}while(Math.abs(y)>1e-6&&--m>0);x=f*f;const b=he(_o(s/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),j=_o(f);return new H(b,j)}}const q5=Nn(Te);class Xne extends xm{project(s,l){l=Nn(l),s=Nn(s);const f=Math.cos(l),m=2/Math.PI,y=Math.acos(f*Math.cos(s/2)),x=Math.sin(y)/y,b=.5*(s*m+2*f*Math.sin(s/2)/x)||0,j=.5*(l+Math.sin(l)/x)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(j/Math.PI+1),z:0}}unproject(s,l){let f=s=(2*s-.5)*Math.PI,m=l=(2*(1-l)-1)*Math.PI,y=25;const x=1e-6;let b=0,j=0;do{const N=Math.cos(m),k=Math.sin(m),M=2*k*N,D=k*k,q=N*N,G=Math.cos(f/2),ee=Math.sin(f/2),ne=2*G*ee,ie=ee*ee,me=1-q*G*G,ye=me?1/me:0,be=me?Math.acos(N*G)*Math.sqrt(1/me):0,Me=.5*(2*be*N*ee+2*f/Math.PI)-s,Ce=.5*(be*k+m)-l,Le=.5*ye*(q*ie+be*N*G*D)+1/Math.PI,Ve=ye*(ne*M/4-be*k*ee),He=.125*ye*(M*ee-be*k*q*ne),mt=.5*ye*(D*G+be*ie*N)+.5,rt=Ve*He-mt*Le;b=(Ce*Ve-Me*mt)/rt,j=(Me*He-Ce*Le)/rt,f=he(f-b,-Math.PI,Math.PI),m=he(m-j,-q5,q5)}while((Math.abs(b)>x||Math.abs(j)>x)&&--y>0);return new H(_o(f),_o(m))}}class G5 extends xm{constructor(s){super(s),this.center=s.center||[0,0],this.parallels=s.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Nn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(s,l){const{scale:f,cosPhi:m}=this;return{x:Nn(s)*m*f+.5,y:-Math.sin(Nn(l))/m*f+.5,z:0}}unproject(s,l){const{scale:f,cosPhi:m}=this,y=-(l-.5)/f,x=he(_o((s-.5)/f)/m,-180,180),b=Math.asin(he(y*m,-1,1)),j=he(_o(b),-Te,Te);return new H(x,j)}}class Yne extends U5{constructor(s){super(s),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(s,l,f){const m=Ib(s,l,f);return ln(m,m,JT(Mh(f))),{x:m[0],y:m[1],z:m[2]}}locationPoint(s,l,f){const m=A(l.lat,l.lng),y=jr([],m),x=f?s._centerAltitude+f:s.elevation?s.elevation.getAtPointOrZero(s.locationCoordinate(l),s._centerAltitude):s._centerAltitude;Xt(m,m,y,_e(1,0)*Zt*x);const b=K(new Float64Array(16));return $(b,s.pixelMatrix,s.globeMatrix),ln(m,m,b),new Rt(m[0],m[1])}pixelsPerMeter(s,l){return _e(1,0)*l}pixelSpaceConversion(s,l,f){const m=_e(1,s)*l,y=Ur(_e(1,45)*l,m,f);return this.pixelsPerMeter(s,l)/y}createTileMatrix(s,l,f){const m=mP(Mh(f.canonical));return $(new Float64Array(16),s.globeMatrix,m)}createInversionMatrix(s,l){const{center:f}=s,m=JT(Mh(l));return ve(m,m,Nn(f.lng)),re(m,m,Nn(f.lat)),Q(m,m,[s._pixelsPerMercatorPixel,s._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(s,l,f,m){return mF(s,l,f,!0)||new et(0,0)}pointCoordinate3D(s,l,f){const m=this.pointCoordinate(s,l,f,0);return[m.x,m.y,m.z]}isPointAboveHorizon(s,l){return!mF(s,l.x,l.y,!1)}farthestPixelDistance(s){const l=function(m,y){const x=m.cameraToCenterDistance,b=m._centerAltitude*y,j=m._camera,N=m._camera.forward(),k=$e([],St([],N,-x),[0,0,b]),M=m.worldSize/(2*Math.PI),D=[0,0,-M],q=m.width/m.height,G=Math.tan(m.fovAboveCenter),ee=St([],j.up(),G),ne=St([],j.right(),G*q),ie=jr([],$e([],$e([],N,ee),ne)),me=[];let ye;if(new pn(k,ie).closestPointOnSphere(D,M,me)){const be=$e([],me,D),Me=Je([],be,k);ye=Math.cos(m.fovAboveCenter)*Ze(Me)}else{const be=Je([],k,D),Me=Je([],D,k);jr(Me,Me);const Ce=Ze(be)-M;ye=Math.sqrt(Ce*(Ce+2*M));const Le=Math.acos(ye/(M+Ce))-Math.acos(Br(N,Me));ye*=Math.cos(Le)}return 1.01*ye}(s,this.pixelsPerMeter(s.center.lat,s.worldSize)),f=mm(s.zoom);if(f>0){const m=B5(s,_e(1,s.center.lat)*s.worldSize),y=s.worldSize/(2*Math.PI),x=Math.max(s.width,s.height)/s.worldSize*Math.PI;return Ur(l,m+y*(1-Math.cos(x)),Math.pow(f,10))}return l}upVector(s,l,f){return Ib(l,f,s,1)}upVectorScale(s){return{metersToTile:KT(YT(Mh(s)))}}}function H5(u){const s=u.parallels,l=!!s&&Math.abs(s[0]+s[1])<.01;switch(u.name){case"mercator":return new U5(u);case"equirectangular":return new Wne(u);case"naturalEarth":return new Kne(u);case"equalEarth":return new Hne(u);case"winkelTripel":return new Xne(u);case"albers":return l?new G5(u):new Gne(u);case"lambertConformalConic":return l?new G5(u):new Zne(u);case"globe":return new Yne(u)}throw new Error(`Invalid projection name: ${u.name}`)}const Jne=Pt.types,Qne=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function s1(u,s,l,f,m,y,x,b,j,N,k,M,D){const q=b?Math.min(Vf,Math.round(b[0])):0,G=b?Math.min(Vf,Math.round(b[1])):0;u.emplaceBack(s,l,Math.round(32*f),Math.round(32*m),y,x,(q<<1)+(j?1:0),0+(G<<1),16*N,16*k,256*M,256*D)}function i1(u,s,l){u.emplaceBack(s,l)}function a1(u,s,l,f,m,y,x){u.emplaceBack(s,l,f,m,y,x)}const C2=(u,s,l,f)=>{for(let m=0;m<s;m++)u.emplaceBack(l[0],l[1],l[2],f[0],f[1],f[2])};function rv(u,s,l,f,m){u.emplaceBack(s,l,f,m),u.emplaceBack(s,l,f,m),u.emplaceBack(s,l,f,m),u.emplaceBack(s,l,f,m)}function ese(u){for(const s of u.sections)if(JA(s.text))return!0;return!1}class uk{constructor(s){this.layoutVertexArray=new Ax,this.indexArray=new ui,this.programConfigurations=s,this.segments=new xi,this.dynamicLayoutVertexArray=new kh,this.opacityVertexArray=new hb,this.placedSymbolArray=new l_,this.iconTransitioningVertexArray=new Vc,this.globeExtVertexArray=new am,this.zOffsetVertexArray=new Td,this.orientationVertexArray=new mb,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(s,l){const f=[],m=this.layoutVertexArray.uint16;for(let y=0;y<l;++y){const x=12*(s+y);f.push(...m.slice(x,x+12))}return f}updateIconVertexData(s,l,f,m,y,x,b,j,N,k,M,D,q){const G=this.layoutVertexArray.uint16,ee=12*s;G[ee]=l,G[ee+1]=f,G[ee+2]=m,G[ee+3]=y,G[ee+4]=x,G[ee+5]=b,G[ee+6]=j,G[ee+7]=N,G[ee+8]=k,G[ee+9]=M,G[ee+10]=D,G[ee+11]=q}upload(s,l,f,m,y,x){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,sne.members,!!x),this.indexBuffer=s.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,ane.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,Qne,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=s.createVertexBuffer(this.iconTransitioningVertexArray,cne.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,ine.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||y)&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,one.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=s.createVertexBuffer(this.orientationVertexArray,lne.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}hr(uk,"SymbolBuffers");class dk{constructor(s,l,f){this.layoutVertexArray=new s,this.layoutAttributes=l,this.indexArray=new f,this.segments=new xi,this.collisionVertexArray=new lm,this.collisionVertexArrayExt=new kh}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,une.members,!0),this.collisionVertexBufferExt=s.createVertexBuffer(this.collisionVertexArrayExt,dne.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}hr(dk,"CollisionBuffers");class A2{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(x=>x.fqid),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=K([]),this.placementViewportMatrix=K([]);const l=this.layers[0]._unevaluatedLayout._values;this.worldview=s.worldview,this.textSizeData=Yx(this.zoom,l["text-size"],this.worldview),this.iconSizeData=Yx(this.zoom,l["icon-size"],this.worldview);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),y=f.get("symbol-z-order");this.lut=s.lut,this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(x=>fc[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=s.sourceID,this.projection=s.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(s){const l=this.layers[0].getAppearances();return!(!l||l.length===0)&&l.some(f=>f.getProperty(s)!=null)}createArrays(){this.text=new uk(new xu(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("text")||s.startsWith("symbol"))),this.icon=new uk(new xu(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("icon")||s.startsWith("symbol"))),this.glyphOffsetArray=new bb,this.lineVertexArray=new zT,this.symbolInstances=new FT}calculateGlyphDependencies(s,l,f,m,y){for(const x of s){const b=x.codePointAt(0);if(b===void 0)break;if(l[b]=!0,m&&y&&b<=65535){const j=Wb[x];j&&(l[j.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(s,l,f,m,y,x){let b=1;const j=s.getUnevaluatedProperties()._values["icon-size"],N=Yx(this.zoom,j,this.worldview),k=Jx(N,l);if(N.kind!=="constant"&&N.kind!=="camera"||(b=k.uSize),N.kind==="composite"){const{minZoom:M,maxZoom:D}=N,q=j.possiblyEvaluate(new Xs(M,{worldview:this.worldview}),m),G=j.possiblyEvaluate(new Xs(D,{worldview:this.worldview}),m),ee=q.evaluate(f,{},m,y);b=ee+(G.evaluate(f,{},m,y)-ee)*k.uSizeT}return N.kind==="source"&&(b=j.possiblyEvaluate(new Xs(this.zoom,{worldview:this.worldview}),m).evaluate(f,{},m,y)),b*x}updateFootprints(s,l){}updateReplacement(s,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const f=l.getReplacementRegionsForTile(s.toUnwrapped(),!0);return!s2(this.activeReplacements,f)&&(this.activeReplacements=f,!0)}getResolvedImageFromTokens(s){return typeof s=="string"?cs.build(s):s}populate(s,l,f,m){const y=this.layers[0],x=y.layout,b=this.projection.name==="globe",j=x.get("text-font"),N=x.get("text-field"),k=x.get("icon-image"),[M,D]=x.get("icon-size-scale-range"),q=he(l.scaleFactor||1,M,D),G=(N.value.kind!=="constant"||N.value.value instanceof es&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(j.value.kind!=="constant"||j.value.value.length>0),ee=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,ne=this.hasAnyAppearanceProperty("icon-image"),ie=x.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!G&&!ee&&!ne)return;const me=l.iconDependencies,ye=l.glyphDependencies,be=l.availableImages,Me=new Xs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),Ce=Le=>{const Ve=Le.id.toString();me.has(Ve)?me.get(Ve).push(Le):me.set(Ve,[Le])};for(const Le of s){const{feature:Ve,id:He,index:mt,sourceLayerIndex:rt}=Le,gt=y._featureFilter.needGeometry,bt=lt(Ve,gt);if(!y._featureFilter.filter(Me,bt,f))continue;if(gt||(bt.geometry=wt(Ve,f,m)),b&&Ve.type!==1&&f.z<=5){const kt=bt.geometry,$t=.98078528056,It=(ur,_r)=>Br(Ib(ur.x,ur.y,f,1),Ib(_r.x,_r.y,f,1))<$t;for(let ur=0;ur<kt.length;ur++)kt[ur]=vt(kt[ur],It)}let Ct,Gt;if(G){const kt=y.getValueAndResolveTokens("text-field",bt,f,be),$t=es.factory(kt);ese($t)&&(this.hasRTLText=!0),(!this.hasRTLText||nb()==="unavailable"||this.hasRTLText&&Dl.isParsed())&&(Ct=fne($t,y,bt))}if(ee){const kt=y.getValueAndResolveTokens("icon-image",bt,f,be);Gt=this.getResolvedImageFromTokens(kt)}const Ot=this.layers[0];let Et=!1;if(!Gt&&ne){const kt=Ot.getAppearances();for(const $t of kt)if($t.getProperty("icon-image")){const It=Ot.getAppearanceValueAndResolveTokens($t,"icon-image",bt,f,be);if(It){Gt=this.getResolvedImageFromTokens(It),Et=!0;break}}}if(!Ct&&!Gt)continue;const Dt=this.sortFeaturesByKey?ie.evaluate(bt,{},f):void 0,ht={id:He,text:Ct,icon:Gt,index:mt,sourceLayerIndex:rt,geometry:bt.geometry,properties:Ve.properties,type:Jne[Ve.type],sortKey:Dt};if(this.features.push(ht),this.appearanceFeatureData.push({id:He,properties:Ve.properties,usesAppearanceIconAsPlaceholder:Et,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Gt){const kt=Ot._unevaluatedLayout._values,{iconPrimary:$t,iconSecondary:It}=Yb(Gt,this.iconSizeData,kt["icon-size"],f,this.zoom,ht,this.pixelRatio,q,this.worldview);Ce($t),It&&(this.hasAnySecondaryIcon=!0,Ce(It))}const ut=Ot.getAppearances();if(ut.length!==0&&ut.forEach(kt=>{if(!kt.getProperty("icon-image"))return;const $t=this.getCombinedIconPrimary(kt,Ot,bt,f,be,ht,q);$t&&Ce($t)}),Ct){const kt=j.evaluate(bt,{},f).join(","),$t=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fc.vertical)>=0;for(const It of Ct.sections)if(It.image){const ur=It.image.getPrimary().scaleSelf(this.pixelRatio),_r=ur.id.toString(),ir=me.get(_r)||[];ir.push(ur),me.set(_r,ir)}else{const ur=Yw(Ct.toString()),_r=It.fontStack||kt,ir=ye[_r]=ye[_r]||{};this.calculateGlyphDependencies(It.text,ir,$t,this.allowVerticalPlacement,ur)}}}if(x.get("symbol-placement")==="line"&&(this.features=function(Le){const Ve={},He={},mt=[];let rt=0;function gt(Ot){mt.push(Le[Ot]),rt++}function bt(Ot,Et,Dt){const ht=He[Ot];return delete He[Ot],He[Et]=ht,mt[ht].geometry[0].pop(),mt[ht].geometry[0]=mt[ht].geometry[0].concat(Dt[0]),ht}function Ct(Ot,Et,Dt){const ht=Ve[Et];return delete Ve[Et],Ve[Ot]=ht,mt[ht].geometry[0].shift(),mt[ht].geometry[0]=Dt[0].concat(mt[ht].geometry[0]),ht}function Gt(Ot,Et,Dt){const ht=Dt?Et[0][Et[0].length-1]:Et[0][0];return`${Ot}:${ht.x}:${ht.y}`}for(let Ot=0;Ot<Le.length;Ot++){const Et=Le[Ot],Dt=Et.geometry,ht=Et.text?Et.text.toString():null;if(!ht){gt(Ot);continue}const ut=Gt(ht,Dt),kt=Gt(ht,Dt,!0);if(ut in He&&kt in Ve&&He[ut]!==Ve[kt]){const $t=Ct(ut,kt,Dt),It=bt(ut,kt,mt[$t].geometry);delete Ve[ut],delete He[kt],He[Gt(ht,mt[It].geometry,!0)]=It,mt[$t].geometry=null}else ut in He?bt(ut,kt,Dt):kt in Ve?Ct(ut,kt,Dt):(gt(Ot),Ve[ut]=rt-1,He[kt]=rt-1)}return mt.filter(Ot=>Ot.geometry)}(this.features)),x.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",l.elevationFeatures){!this.elevationFeatures&&l.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Le of l.elevationFeatures)this.elevationFeatureIdToIndex.set(Le.id,this.elevationFeatures.length),this.elevationFeatures.push(Le)}}else x.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Le,Ve)=>Le.sortKey-Ve.sortKey)}getCombinedIconPrimary(s,l,f,m,y,x,b){let j,N;const k=s.getUnevaluatedProperties();if(k._values["icon-image"].value!==void 0){const M=l.getAppearanceValueAndResolveTokens(s,"icon-image",f,m,y);j=this.getResolvedImageFromTokens(M)}else{const M=l.getValueAndResolveTokens("icon-image",f,m,y);j=this.getResolvedImageFromTokens(M)}if(j){const M=k._values["icon-size"]||l._unevaluatedLayout._values["icon-size"];N=Yb(j,Yx(this.zoom,M,this.worldview),M,m,this.zoom,x,this.pixelRatio,b,this.worldview).iconPrimary}return N}updateAppearanceBasedIconTextures(s,l,f,m){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const y=this.layers[0];let x=!1,b=0;const j=y.layout,[N,k]=j.get("icon-size-scale-range"),M=he(1,N,k);for(let D=0;D<this.symbolInstances.length;D++){const q=this.symbolInstances.get(D),G=this.appearanceFeatureData[q.featureIndex];if(G&&q.placedIconSymbolIndex>=0){const ee=G.id,ne=l&&ee!==void 0?l[String(ee)]:void 0,ie={type:"Point",id:G.id,properties:G.properties,geometry:[]},me=this.layers[0].appearances&&this.layers[0].appearances.find(ye=>ye.isActive({globals:m,feature:ie,canonical:s,featureState:ne}));if(G.activeAppearance===me)continue;if(me){G.activeAppearance=me;const ye={sortKey:void 0,text:void 0,icon:null,index:q.featureIndex,sourceLayerIndex:q.featureIndex,geometry:[],properties:G.properties,type:"Point",id:G.id};if(!me.hasCachedIconPrimary()){const Le=this.getCombinedIconPrimary(me,y,ie,s,f,ye,M);me.setCachedIconPrimary(Le)}const be=me.getCachedIconPrimary();if(!be)continue;const Me=be.toString(),Ce=this.iconAtlasPositions&&this.iconAtlasPositions.get(Me);if(Ce){const Le=y.getAppearanceValueAndResolveTokens(me,"icon-offset",ie,s,f),Ve=Le&&Array.isArray(Le)?Le:[0,0];let He=v2(Ce,void 0,Ve,y.layout.get("icon-anchor").evaluate(ie,{},s));const mt=y.getAppearanceValueAndResolveTokens(me,"icon-rotate",ie,s,f),rt=typeof mt=="number"?mt:0,gt=Ce.sdf,bt=y.layout.get("icon-text-fit").constantOr("none");bt!=="none"&&G.textShaping&&G.iconTextFitPadding&&G.fontScale&&(He=tk(He,G.textShaping,bt,G.iconTextFitPadding,Ve,G.fontScale));const Ct=this.calculateEffectiveAppearanceIconSize(me,m.zoom,ie,s,f,M),Gt=0,Ot=1+(Math.min(Vf,Math.round(Ct*Ad))<<1),Et=ik(He,rt,gt,bt!=="none",M);G.isUsingAppearanceVertexData||(G.isUsingAppearanceVertexData=!0,G.layoutBasedVertexData=this.icon.getIconVertexData(b,q.numIconVertices));for(let ht=0;ht<Et.length;++ht){const ut=Et[ht],kt=G.layoutBasedVertexData[0]||q.tileAnchorX,$t=G.layoutBasedVertexData[1]||q.tileAnchorY,It=16*ut.pixelOffsetTL.x,ur=16*ut.pixelOffsetTL.y,_r=16*ut.pixelOffsetBR.x,ir=16*ut.pixelOffsetBR.y,Jt=16*ut.minFontScaleX,Qr=16*ut.minFontScaleY;this.icon.updateIconVertexData(b,kt,$t,Math.round(32*ut.tl.x),Math.round(32*ut.tl.y),ut.texPrimary.x,ut.texPrimary.y,Gt,Ot,It,ur,Jt,Qr),this.icon.updateIconVertexData(b+1,kt,$t,Math.round(32*ut.tr.x),Math.round(32*ut.tr.y),ut.texPrimary.x+ut.texPrimary.w,ut.texPrimary.y,Gt,Ot,_r,ur,Jt,Qr),this.icon.updateIconVertexData(b+2,kt,$t,Math.round(32*ut.bl.x),Math.round(32*ut.bl.y),ut.texPrimary.x,ut.texPrimary.y+ut.texPrimary.h,Gt,Ot,It,ir,Jt,Qr),this.icon.updateIconVertexData(b+3,kt,$t,Math.round(32*ut.br.x),Math.round(32*ut.br.y),ut.texPrimary.x+ut.texPrimary.w,ut.texPrimary.y+ut.texPrimary.h,Gt,Ot,_r,ir,Jt,Qr),b+=4}const Dt=q.numIconVertices-4*Et.length;for(let ht=0;ht<Dt;++ht)this.icon.updateIconVertexData(b+ht,0,0,0,0,0,0,0,0,0,0,0,0);x=!0}else b+=q.numIconVertices}else if(G.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(b,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+3,0,0,0,0,0,0,0,0,0,0,0,0),x=!0),b+=q.numIconVertices,G.activeAppearance=null;else if(G.isUsingAppearanceVertexData){const be=G.layoutBasedVertexData.length/12;for(let Me=0;Me<be;++Me){const Ce=Me*12;this.icon.updateIconVertexData(b+Me,G.layoutBasedVertexData[Ce+0],G.layoutBasedVertexData[Ce+1],G.layoutBasedVertexData[Ce+2],G.layoutBasedVertexData[Ce+3],G.layoutBasedVertexData[Ce+4],G.layoutBasedVertexData[Ce+5],G.layoutBasedVertexData[Ce+6],G.layoutBasedVertexData[Ce+7],G.layoutBasedVertexData[Ce+8],G.layoutBasedVertexData[Ce+9],G.layoutBasedVertexData[Ce+10],G.layoutBasedVertexData[Ce+11])}b+=be,G.isUsingAppearanceVertexData=!1,G.activeAppearance=null,x=!0}else b+=q.numIconVertices,G.activeAppearance=null}}return x}update(s,l,f,m,y,x,b){this.text.programConfigurations.updatePaintArrays(s,l,y,f,m,x,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(s,l,y,f,m,x,b,this.worldview)}updateRoadElevation(s){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let l=!1;const f=Oe(s),m=1/f;let y=!1,x=!1;for(let b=0;b<this.symbolInstances.length;b++){const j=this.symbolInstances.get(b),N=Xe(1,0,0),k=Xe(0,1,0),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:D,numIconVertices:q,numVerticalIconVertices:G}=j,ee=M>0||D>0,ne=q>0,ie=this.elevationFeatures[j.elevationFeatureIndex];if(ie){const me=new Rt(j.tileAnchorX,j.tileAnchorY),ye=.075+ie.pointElevation(me);j.zOffset!==ye&&(l=!0,j.zOffset=ye),ye!==0&&(this.hasAnyZOffset=!0);const be=ie.computeSlopeNormal(me,m),Me=kc(Cs(),Xe(0,0,1),be);Vr(N,N,Me),Vr(k,k,Me),N[2]*=f,k[2]*=f,N[0]===1&&N[1]===0&&N[2]===0&&k[0]===0&&k[1]===1&&k[2]===0||(y=y||ee,x=x||ne)}if(ee&&(C2(this.text.orientationVertexArray,M,N,k),C2(this.text.orientationVertexArray,D,N,k)),ne){const{placedIconSymbolIndex:me,verticalPlacedIconSymbolIndex:ye}=j;me>=0&&C2(this.icon.orientationVertexArray,q,N,k),ye>=0&&C2(this.icon.orientationVertexArray,G,N,k)}}y||(this.text.orientationVertexArray=void 0),x||(this.icon.orientationVertexArray=void 0),l&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const s=(y,x,b)=>{f+=x,f>y.length&&y.resize(f);for(let j=-x;j<0;j++)y.emplace(j+f,b)},l=(y,x,b)=>{m+=x,m>y.length&&y.resize(m);for(let j=-x;j<0;j++)y.emplace(j+m,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let f=0,m=0;for(let y=0;y<this.symbolInstances.length;y++){const x=this.symbolInstances.get(y),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:j,numIconVertices:N}=x,k=x.zOffset,M=N>0;if((b>0||j>0)&&(s(this.text.zOffsetVertexArray,b,k),s(this.text.zOffsetVertexArray,j,k)),M){const{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:q}=x;D>=0&&l(this.icon.zOffsetVertexArray,N,k),q>=0&&l(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,k)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s,l,f,m,y){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(x=>x.appearances&&x.appearances.length>0)),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(s,l,f,m){return!!(s&&l&&f)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(s,l,f,m)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=H5(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,l){const f=this.lineVertexArray.length;if(s.segment!==void 0)for(const{x:m,y}of l)this.lineVertexArray.emplaceBack(m,y);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee,ne,ie,me){const ye=s.indexArray,be=s.layoutVertexArray,Me=s.globeExtVertexArray,Ce=s.segments.prepareSegment(4*me,be,ye,this.canOverlap?x.sortKey:void 0),Le=this.glyphOffsetArray.length,Ve=Ce.vertexLength,He=this.allowVerticalPlacement&&b===fc.vertical?Math.PI/2:0,mt=x.text&&x.text.sections;for(let bt=0;bt<l.length;bt++){const{tl:Ct,tr:Gt,bl:Ot,br:Et,texPrimary:Dt,texSecondary:ht,pixelOffsetTL:ut,pixelOffsetBR:kt,minFontScaleX:$t,minFontScaleY:It,glyphOffset:ur,isSDF:_r,sectionIndex:ir}=l[bt],Jt=Ce.vertexLength,Qr=ur[1];if(s1(be,N.x,N.y,Ct.x,Qr+Ct.y,Dt.x,Dt.y,f,_r,ut.x,ut.y,$t,It),s1(be,N.x,N.y,Gt.x,Qr+Gt.y,Dt.x+Dt.w,Dt.y,f,_r,kt.x,ut.y,$t,It),s1(be,N.x,N.y,Ot.x,Qr+Ot.y,Dt.x,Dt.y+Dt.h,f,_r,ut.x,kt.y,$t,It),s1(be,N.x,N.y,Et.x,Qr+Et.y,Dt.x+Dt.w,Dt.y+Dt.h,f,_r,kt.x,kt.y,$t,It),j){const{x:tr,y:Pr,z:an}=j.anchor,[Sn,Hn,cn]=j.up;a1(Me,tr,Pr,an,Sn,Hn,cn),a1(Me,tr,Pr,an,Sn,Hn,cn),a1(Me,tr,Pr,an,Sn,Hn,cn),a1(Me,tr,Pr,an,Sn,Hn,cn),rv(s.dynamicLayoutVertexArray,tr,Pr,an,He)}else rv(s.dynamicLayoutVertexArray,N.x,N.y,N.z,He);if(ne){const tr=ht||Dt;i1(s.iconTransitioningVertexArray,tr.x,tr.y),i1(s.iconTransitioningVertexArray,tr.x+tr.w,tr.y),i1(s.iconTransitioningVertexArray,tr.x,tr.y+tr.h),i1(s.iconTransitioningVertexArray,tr.x+tr.w,tr.y+tr.h)}ye.emplaceBack(Jt,Jt+1,Jt+2),ye.emplaceBack(Jt+1,Jt+2,Jt+3),Ce.vertexLength+=4,Ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ur[0]),bt!==l.length-1&&ir===l[bt+1].sectionIndex||s.programConfigurations.populatePaintArrays(be.length,x,x.index,{},q,G,ee,mt&&mt[ir],this.worldview)}const rt=me-l.length;rt!==0&&this._addNullVertices(rt,be,f,j,Me,s,ne,Ce,ye);const gt=j?j.anchor:N;s.placedSymbolArray.emplaceBack(gt.x,gt.y,gt.z,N.x,N.y,Le,this.glyphOffsetArray.length-Le,Ve,k,M,N.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],b,0,0,0,D,0),s.symbolInstanceIndices.push(ie)}_addNullVertices(s,l,f,m,y,x,b,j,N){for(let k=0;k<s;k++){for(let D=0;D<4;D++)s1(l,0,0,0,0,0,0,f,!1,0,0,0,0),m&&a1(y,0,0,0,0,0,0),rv(x.dynamicLayoutVertexArray,0,0,0,0),b&&i1(x.iconTransitioningVertexArray,0,0);const M=j.vertexLength;N.emplaceBack(M,M+1,M+2),N.emplaceBack(M+1,M+2,M+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(s,l,f,m,y,x,b){s.emplaceBack(l,f,m,y,x,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(s,l,f,m,y,x,b){const j=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),N=j.vertexLength,k=b.tileAnchorX,M=b.tileAnchorY;for(let q=0;q<4;q++)f.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(f.collisionVertexArrayExt,l,s.padding,b.zOffset),this._commitLayoutVertex(f.layoutVertexArray,m,y,x,k,M,new Rt(s.x1,s.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,y,x,k,M,new Rt(s.x2,s.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,y,x,k,M,new Rt(s.x2,s.y2)),this._commitLayoutVertex(f.layoutVertexArray,m,y,x,k,M,new Rt(s.x1,s.y2)),j.vertexLength+=4;const D=f.indexArray;D.emplaceBack(N,N+1),D.emplaceBack(N+1,N+2),D.emplaceBack(N+2,N+3),D.emplaceBack(N+3,N),j.primitiveLength+=4}_addTextDebugCollisionBoxes(s,l,f,m,y,x){for(let b=m;b<y;b++){const j=f.get(b),N=this.getSymbolInstanceTextSize(s,x,l,b);this._addCollisionDebugVertices(j,N,this.textCollisionBox,j.projectedAnchorX,j.projectedAnchorY,j.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(s,l,f,m,y,x){for(let b=m;b<y;b++){const j=f.get(b),N=this.getSymbolInstanceIconSize(s,l,x.placedIconSymbolIndex);this._addCollisionDebugVertices(j,N,this.iconCollisionBox,j.projectedAnchorX,j.projectedAnchorY,j.projectedAnchorZ,x)}}generateCollisionDebugBuffers(s,l,f){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dk(Px,c5.members,Vc),this.iconCollisionBox=new dk(Px,c5.members,Vc);const m=Jx(this.iconSizeData,s),y=Jx(this.textSizeData,s,f);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(y,s,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(y,s,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(m,s,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(m,s,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(s,l,f,m){const y=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:m),x=rk(this.textSizeData,s,y)/co;return this.tilePixelRatio*x}getSymbolInstanceIconSize(s,l,f){const m=this.icon.placedSymbolArray.get(f),y=rk(this.iconSizeData,s,m);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(s,l,f,m){s.emplaceBack(l,-f,-f,m),s.emplaceBack(l,f,-f,m),s.emplaceBack(l,f,f,m),s.emplaceBack(l,-f,f,m)}_updateTextDebugCollisionBoxes(s,l,f,m,y,x,b){for(let j=m;j<y;j++){const N=f.get(j),k=this.getSymbolInstanceTextSize(s,x,l,j);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,N.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(s,l,f,m,y,x,b){for(let j=m;j<y;j++){const N=f.get(j),k=this.getSymbolInstanceIconSize(s,l,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,N.padding,x.zOffset)}}updateCollisionDebugBuffers(s,l,f,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=Jx(this.iconSizeData,s,m),x=Jx(this.textSizeData,s,f);for(let b=0;b<this.symbolInstances.length;b++){const j=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(x,s,l,j.textBoxStartIndex,j.textBoxEndIndex,j,f),this._updateTextDebugCollisionBoxes(x,s,l,j.verticalTextBoxStartIndex,j.verticalTextBoxEndIndex,j,f),this._updateIconDebugCollisionBoxes(y,s,l,j.iconBoxStartIndex,j.iconBoxEndIndex,j,m),this._updateIconDebugCollisionBoxes(y,s,l,j.verticalIconBoxStartIndex,j.verticalIconBoxEndIndex,j,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(s,l,f,m,y,x,b,j,N){const k={};if(l<f){const{x1:M,y1:D,x2:q,y2:G,padding:ee,projectedAnchorX:ne,projectedAnchorY:ie,projectedAnchorZ:me,tileAnchorX:ye,tileAnchorY:be,featureIndex:Me}=s.get(l);k.textBox={x1:M,y1:D,x2:q,y2:G,padding:ee,projectedAnchorX:ne,projectedAnchorY:ie,projectedAnchorZ:me,tileAnchorX:ye,tileAnchorY:be},k.textFeatureIndex=Me}if(m<y){const{x1:M,y1:D,x2:q,y2:G,padding:ee,projectedAnchorX:ne,projectedAnchorY:ie,projectedAnchorZ:me,tileAnchorX:ye,tileAnchorY:be,featureIndex:Me}=s.get(m);k.verticalTextBox={x1:M,y1:D,x2:q,y2:G,padding:ee,projectedAnchorX:ne,projectedAnchorY:ie,projectedAnchorZ:me,tileAnchorX:ye,tileAnchorY:be},k.verticalTextFeatureIndex=Me}if(x<b){const{x1:M,y1:D,x2:q,y2:G,padding:ee,projectedAnchorX:ne,projectedAnchorY:ie,projectedAnchorZ:me,tileAnchorX:ye,tileAnchorY:be,featureIndex:Me}=s.get(x);k.iconBox={x1:M,y1:D,x2:q,y2:G,padding:ee,projectedAnchorX:ne,projectedAnchorY:ie,projectedAnchorZ:me,tileAnchorX:ye,tileAnchorY:be},k.iconFeatureIndex=Me}if(j<N){const{x1:M,y1:D,x2:q,y2:G,padding:ee,projectedAnchorX:ne,projectedAnchorY:ie,projectedAnchorZ:me,tileAnchorX:ye,tileAnchorY:be,featureIndex:Me}=s.get(j);k.verticalIconBox={x1:M,y1:D,x2:q,y2:G,padding:ee,projectedAnchorX:ne,projectedAnchorY:ie,projectedAnchorZ:me,tileAnchorX:ye,tileAnchorY:be},k.verticalIconFeatureIndex=Me}return k}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(s,l){const f=s.placedSymbolArray.get(l),m=f.vertexStartIndex+4*f.numGlyphs;for(let y=f.vertexStartIndex;y<m;y+=4)s.indexArray.emplaceBack(y,y+1,y+2),s.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(s),f=Math.cos(s),m=[],y=[],x=[];for(let b=0;b<this.symbolInstances.length;++b){x.push(b);const j=this.symbolInstances.get(b);m.push(0|Math.round(l*j.tileAnchorX+f*j.tileAnchorY)),y.push(j.featureIndex)}return x.sort((b,j)=>m[b]-m[j]||y[j]-y[b]),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let s=0;s<this.symbolInstances.length;++s)this.symbolInstanceIndexesSortedZOffset.push(s)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((s,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(s).zOffset)}addToSortKeyRanges(s,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:j,verticalPlacedIconSymbolIndex:N}=f;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&x!==y&&x!==m&&this.addIndicesForPlacedSymbol(this.text,x),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),j>=0&&this.addIndicesForPlacedSymbol(this.icon,j),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(s){const l=this.symbolInstances.get(this.text.symbolInstanceIndices[s]).elevationFeatureIndex;let f;return this.elevationFeatures&&l<this.elevationFeatures.length&&(f=this.elevationFeatures[l]),f}}function W5(u,s){return s.replace(/{([^{}]+)}/g,(l,f)=>f in u?String(u[f]):"")}let Z5,K5,hk;hr(A2,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),A2.addDynamicAttributes=rv;class X5{constructor(s){this.type=s.property.overrides?s.property.overrides.runtimeType:xd,this.defaultValue=s}evaluate(s){if(s.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(s.formattedSection))return l.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hr(X5,"FormatSectionOverride",{omit:["defaultValue"]});const fk=()=>hk||(hk={layout:Z5||(Z5=new Pi({"symbol-placement":new Vt(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new nr(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(tt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Vt(tt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Vt(tt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Vt(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Vt(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new nr(tt.layout_symbol["icon-size"]),"icon-size-scale-range":new Vt(tt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new nr(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nr(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new nr(tt.layout_symbol["icon-image"]),"icon-image-use-theme":new Vt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new nr(tt.layout_symbol["icon-rotate"]),"icon-padding":new Vt(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new nr(tt.layout_symbol["icon-offset"]),"icon-anchor":new nr(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(tt.layout_symbol["text-rotation-alignment"]),"text-field":new nr(tt.layout_symbol["text-field"]),"text-font":new nr(tt.layout_symbol["text-font"]),"text-size":new nr(tt.layout_symbol["text-size"]),"text-size-scale-range":new Vt(tt.layout_symbol["text-size-scale-range"]),"text-max-width":new nr(tt.layout_symbol["text-max-width"]),"text-line-height":new nr(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new nr(tt.layout_symbol["text-letter-spacing"]),"text-justify":new nr(tt.layout_symbol["text-justify"]),"text-radial-offset":new nr(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new nr(tt.layout_symbol["text-anchor"]),"text-max-angle":new Vt(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(tt.layout_symbol["text-writing-mode"]),"text-rotate":new nr(tt.layout_symbol["text-rotate"]),"text-padding":new Vt(tt.layout_symbol["text-padding"]),"text-keep-upright":new Vt(tt.layout_symbol["text-keep-upright"]),"text-transform":new nr(tt.layout_symbol["text-transform"]),"text-offset":new nr(tt.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Vt(tt.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(tt.layout_symbol["text-optional"]),visibility:new Vt(tt.layout_symbol.visibility)})),paint:K5||(K5=new Pi({"icon-opacity":new nr(tt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new nr(tt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new nr(tt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new nr(tt.paint_symbol["text-emissive-strength"]),"icon-color":new nr(tt.paint_symbol["icon-color"]),"icon-halo-color":new nr(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new nr(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new nr(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(tt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Vt(tt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new nr(tt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new nr(tt.paint_symbol["text-occlusion-opacity"]),"text-color":new nr(tt.paint_symbol["text-color"],{runtimeType:qo,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new nr(tt.paint_symbol["text-halo-color"]),"text-halo-width":new nr(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new nr(tt.paint_symbol["text-halo-blur"]),"text-translate":new Vt(tt.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(tt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Vt(tt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Vt(tt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Vt(tt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Vt(tt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new nr(tt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},hk);class P2 extends Ho{constructor(s,l,f,m){super(s,fk(),l,f,m,s.layout?s.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=K([]),this.hasOcclusionOpacityProperties=s.paint!==void 0&&("icon-occlusion-opacity"in s.paint||"text-occlusion-opacity"in s.paint)}_handleSpecialPaintPropertyUpdate(s){s!=="icon-occlusion-opacity"&&s!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(s,l){super.recalculate(s,l),this.appearances&&this.appearances.forEach(m=>{m.recalculate(s,l,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const y of f)m.indexOf(y)<0&&m.push(y);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(s,l,f,m){return this._saturation===s&&this._contrast===l&&this._brightnessMin===f&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(y,x,b,j){y=ci(y),x=zs(x);const N=V(),k=y/3,M=1-2*k,D=[M,k,k,0,k,M,k,0,k,k,M,0,0,0,0,1],q=.5-.5*x,G=j-b;return $(N,[G,0,0,0,0,G,0,0,0,0,G,0,b,b,b,1],[x,0,0,0,0,x,0,0,0,0,x,0,q,q,q,1]),$(N,N,D),N}(s,l,f,m),this._saturation=s,this._contrast=l,this._brightnessMin=f,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(s,l,f,m){const y=this.layout.get(s).evaluate(l,{},f,m),x=this._unevaluatedLayout._values[s];return x.isDataDriven()||yx(x.value)||!y?y:W5(l.properties,y)}getAppearanceValueAndResolveTokens(s,l,f,m,y){const x=s.getProperty(l);if(!x)return;const b=x.evaluate(f,{},m,y),j=s.getUnevaluatedProperties()._values[l];return j.isDataDriven()||yx(j.value)||!b||typeof b!="string"?b:W5(f.properties,b)}createBucket(s){return new A2(s)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const s of fk().paint.overridableProperties){if(!P2.hasPaintOverride(this.layout,s))continue;const l=this.paint.get(s),f=new X5(l),m=new _x(f,l.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let y=null;y=l.value.kind==="constant"||l.value.kind==="source"?new r_("source",m):new Nh("composite",m,l.value.zoomStops,l.value.interpolationType),this.paint._values[s]=new Bc(l.property,y,l.parameters)}}_handleOverridablePaintPropertyUpdate(s,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&P2.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,l){const f=s.get("text-field"),m=fk().paint.properties[l];let y=!1;const x=b=>{for(const j of b)if(m.overrides&&m.overrides.hasOverride(j))return void(y=!0)};if(f.value.kind==="constant"&&f.value.value instanceof es)x(f.value.value.sections);else if(f.value.kind==="source"){const b=N=>{y||(N instanceof Rl&&Bi(N.value)===Ba?x(N.value.sections):N instanceof Ef?x(N.sections):N.eachChild(b))},j=f.value;j._styleExpression&&b(j._styleExpression.expression)}return y}getProgramIds(){return["symbol"]}getDefaultProgramParams(s,l,f){return{config:new Nd(this,{zoom:l,lut:f}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Y5,J5,Q5,eB;var pk=In([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function k2(u,s,l,f,m,y,x,b){const j=[u,s,1,l,f,1,m,y,1],N=[x,b,1],k=R([],j),[M,D,q]=dr(N,N,k);return B(j,j,[M,0,0,0,D,0,0,0,q])}function tB(u,s,l,f,m,y,x,b){const j=function(N,k,M,D,q,G,ee,ne){const ie=k2(0,0,1,0,1,1,0,1),me=k2(N,k,M,D,q,G,ee,ne);return B(me,me,R([],ie))}(u,s,l,f,m,y,x,b);return[j[2]/j[8]/Zt,j[5]/j[8]/Zt]}function R2(u){return[u[0],Math.min(Math.max(u[1],-Te),Te)]}class rB extends Oc{constructor(s,l,f,m){super(),this.id=s,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=l,this._dirty=!1}load(s,l){if(this._loaded=l||!1,this.fire(new Sa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return s&&(this.coordinates=s),this._loaded=!0,void this._finishLoading();this._imageRequest=vf(this.map._requestManager.transformRequest(this.url,tl.Image),(f,m)=>{this._imageRequest=null,this._loaded=!0,f?this.fire(new gh(f)):m&&(this.image=m instanceof HTMLImageElement?Bs.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}setTexture(s){if(!(s.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new qb(this.map.painter.context,s.handle),this.width=s.dimensions[0],this.height=s.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Sa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(s){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof qb||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(s){if(this.coordinates=s,this._boundsArray=void 0,this._unsupportedCoords=!1,!s.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=s[0][1],f=s[0][1];for(const y of s)y[1]>f&&(f=y[1]),y[1]<l&&(l=y[1]);const m=(f+l)/2;if(m>Te?this.onNorthPole=!0:m<-Te&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const y=s.map(et.fromLngLat);this.tileID=function(x){let b=1/0,j=1/0,N=-1/0,k=-1/0;for(const ee of x)b=Math.min(b,ee.x),j=Math.min(j,ee.y),N=Math.max(N,ee.x),k=Math.max(k,ee.y);const M=Math.max(N-b,k-j),D=Math.max(0,Math.floor(-Math.log2(M))),q=Math.pow(2,D);let G=Math.floor((b+N)/2*q);return G>1&&(G-=1),new uc(D,G,Math.floor((j+k)/2*q))}(y),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Sa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof qb||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(s){for(const ie in this.tiles){const me=this.tiles[ie];me.state!=="loaded"&&(me.state="loaded",me.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=Qb(new uc(0,0,0),this.map.transform.projection),f=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ie){const me=ie[1].x-ie[0].x,ye=ie[1].y-ie[0].y,be=ie[2].x-ie[1].x,Me=ie[2].y-ie[1].y,Ce=ie[3].x-ie[2].x,Le=ie[3].y-ie[2].y,Ve=ie[0].x-ie[3].x,He=ie[0].y-ie[3].y,mt=me*Me-be*ye,rt=be*Le-Ce*Me,gt=Ce*He-Ve*Le,bt=Ve*ye-me*He;return mt>0&&rt>0&&gt>0&&bt>0||mt<0&&rt<0&&gt<0&&bt<0}(f))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=Qb(this.tileID,this.map.transform.projection),[y,x,b,j]=this.coordinates.map(ie=>{const me=m.projection.project(ie[0],ie[1]);return V5(m,me)._round()});this.perspectiveTransform=tB(y.x,y.y,x.x,x.y,b.x,b.y,j.x,j.y);const N=this._boundsArray=new im;N.emplaceBack(y.x,y.y,0,0),N.emplaceBack(x.x,x.y,Zt,0),N.emplaceBack(j.x,j.y,0,Zt),N.emplaceBack(b.x,b.y,Zt,Zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=s.createVertexBuffer(N,pk.members),this.boundsSegments=xi.simpleSegment(0,0,4,2);const k=[],M=[R2((D=this.coordinates)[0]),R2(D[1]),R2(D[2]),R2(D[3])];var D;const[q,G,ee,ne]=function(ie){let me=ie[0][0],ye=me,be=ie[0][1],Me=be;for(let Ce=1;Ce<ie.length;Ce++)ie[Ce][0]<me?me=ie[Ce][0]:ie[Ce][0]>ye&&(ye=ie[Ce][0]),ie[Ce][1]<be?be=ie[Ce][1]:ie[Ce][1]>Me&&(Me=ie[Ce][1]);return[me,be,ye-me,Me-be]}(M);{const ie=new im,[me,ye,be,Me]=function(Et){let Dt=Et[0].x,ht=Dt,ut=Et[0].y,kt=ut;for(let $t=1;$t<Et.length;$t++)Et[$t].x<Dt?Dt=Et[$t].x:Et[$t].x>ht&&(ht=Et[$t].x),Et[$t].y<ut?ut=Et[$t].y:Et[$t].y>kt&&(kt=Et[$t].y);return[Dt,ut,ht-Dt,kt-ut]}(f),Ce=Et=>[(Et.x-me)/be,(Et.y-ye)/Me],[Le,Ve,He,mt]=f.map(Ce),rt=function(Et,Dt,ht,ut,kt,$t,It,ur){const _r=k2(0,0,1,0,1,1,0,1);return B(_r,_r,R([],k2(Et,Dt,ht,ut,kt,$t,It,ur)))}(Le[0],Le[1],Ve[0],Ve[1],He[0],He[1],mt[0],mt[1]);this.elevatedGlobePerspectiveTransform=tB(Le[0],Le[1],Ve[0],Ve[1],He[0],He[1],mt[0],mt[1]);const gt=(Et,Dt)=>{k.push(Et.lng);const ht=Math.round((Et.lng-q)/ee*Zt),ut=Math.round((Et.lat-G)/ne*Zt),kt=Ce(Dt),$t=dr([],[kt[0],kt[1],1],rt),It=Math.round($t[0]/$t[2]*Zt),ur=Math.round($t[1]/$t[2]*Zt);ie.emplaceBack(ht,ut,It,ur)},bt=f[3].x-f[0].x,Ct=f[3].y-f[0].y,Gt=f[2].x-f[1].x,Ot=f[2].y-f[1].y;for(let Et=0;Et<65;Et++){const Dt=Et/64,ht=[f[0].x+Dt*bt,f[0].y+Dt*Ct],ut=[f[1].x+Dt*Gt,f[1].y+Dt*Ot],kt=ut[0]-ht[0],$t=ut[1]-ht[1];for(let It=0;It<65;It++){const ur=It/64,_r={x:ht[0]+kt*ur,y:ht[1]+$t*ur};gt(l.projection.unproject(_r.x,_r.y),_r)}}this.elevatedGlobeVertexBuffer=s.createVertexBuffer(ie,pk.members)}{this.maxLongitudeTriangleSize=0;let ie=[],me=new ui;const ye=(be,Me,Ce)=>{me.emplaceBack(be,Me,Ce);const Le=k[be],Ve=k[Me],He=k[Ce],mt=Math.min(Math.min(Le,Ve),He),rt=Math.max(Math.max(Le,Ve),He)-mt;rt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=rt),ie.push(mt+rt/2)};for(let be=0;be<64;be++)for(let Me=0;Me<64;Me++){const Ce=65*be+Me,Le=Ce+1,Ve=Ce+65,He=Ve+1;ye(Ce,Ve,Le),ye(Le,Ve,He)}[ie,me]=function(be,Me){const Ce=Array.from({length:be.length},(He,mt)=>mt);Ce.sort((He,mt)=>be[He]-be[mt]);const Le=[],Ve=new ui;for(let He=0;He<Ce.length;He++){const mt=Ce[He];Le.push(be[mt]);const rt=3*mt,gt=rt+1;Ve.emplaceBack(Me.uint16[rt],Me.uint16[gt],Me.uint16[gt+1])}return[Le,Ve]}(ie,me),this.elevatedGlobeTrianglesCenterLongitudes=ie,this.elevatedGlobeIndexBuffer=s.createIndexBuffer(me)}this.elevatedGlobeSegments=xi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ee/Zt,0,ne/Zt,0,0,G,q,0])}prepare(){const s=Object.keys(this.tiles).length!==0;if(this.tileID&&!s)return;const l=this.map.painter.context,f=l.gl;!this._dirty||this.texture instanceof qb||(this.texture?this.texture.update(this.image):(this.texture=new BP(l,this.image,f.RGBA8),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),s&&this._prepareData(l)}loadTile(s,l){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},l(null)):(s.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(s){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const f=this.elevatedGlobeTrianglesCenterLongitudes;let m=(y=s+180)+360*Math.round((f[0]-y)/360);var y;const x=new xi,b=(M,D)=>{x.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:l.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},j=.51*this.maxLongitudeTriangleSize;if(Math.abs(f[0]-m)<=j){const M=Rn(f,0,f.length,m+j);return M===f.length||b(M,fs(f,M+1,f.length,m+360-j)-M),x}m<f[0]&&(m+=360);const N=fs(f,0,f.length,m-j);if(N===f.length)return b(0,f.length),x;b(0,N-0);const k=Rn(f,N+1,f.length,m+j);return k!==f.length&&b(k,f.length-k),x}}const tse=(Math.pow(256,2)-1)/16907520;class nB extends Ho{constructor(s,l,f,m){super(s,{layout:Q5||(Q5=new Pi({visibility:new Vt(tt.layout_raster.visibility)})),paint:eB||(eB=new Pi({"raster-opacity":new Vt(tt.paint_raster["raster-opacity"]),"raster-color":new em(tt.paint_raster["raster-color"]),"raster-color-mix":new Vt(tt.paint_raster["raster-color-mix"]),"raster-color-range":new Vt(tt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Vt(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(tt.paint_raster["raster-saturation"]),"raster-contrast":new Vt(tt.paint_raster["raster-contrast"]),"raster-resampling":new Vt(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(tt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Vt(tt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Vt(tt.paint_raster["raster-array-band"]),"raster-elevation":new Vt(tt.paint_raster["raster-elevation"]),"raster-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},l,f,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(s){return!(s&&s._source instanceof rB&&(s._source.onNorthPole||s._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(s){s!=="raster-color"&&s!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(s){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[f,m]=s||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(f)&&isNaN(m)||f===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=Cb({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:f,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[f,m])}}let sB,iB,aB,oB,lB;class cB extends Ho{constructor(s,l,f,m){super(s,{layout:sB||(sB=new Pi({visibility:new Vt(tt["layout_raster-particle"].visibility)})),paint:iB||(iB=new Pi({"raster-particle-array-band":new Vt(tt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Vt(tt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new em(tt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Vt(tt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Vt(tt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Vt(tt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Vt(tt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Vt(tt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},l,f,m),this._updateColorRamp(),this.lastInvalidatedAt=Bs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(s){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(s){return!1}_handleSpecialPaintPropertyUpdate(s){s!=="raster-particle-color"&&s!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),s==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const s=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Cb({expression:s,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Bs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class rse extends Ho{constructor(s,l){super(s,{},l,null),this.implementation=s,s.slot&&(this.slot=s.slot)}is3D(s){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(s){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)}onRemove(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)}}function mk(u,s,l){const f=[0,0,1],m=ys([]);return so(m,m,l?-Nn(u)+Math.PI:Nn(u)),Es(m,m,-Nn(s)),Vr(f,f,m),jr(f,f)}const uB={None:0,Model:1,Symbol:2,FillExtrusion:4};class M2{constructor(s,l,f,m){this.message=(s?`${s}: `:"")+f,m&&(this.identifier=m),l!=null&&l.__line__&&(this.line=l.__line__)}}function gk(u,s){const l=u.indexOf("://")===-1;try{return new URL(u,l&&s?"http://example.com":void 0),!0}catch{return!1}}class dB{constructor(s,l){this.feature=s,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class hB{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Rx,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(s){const l=16*s,f=this.instancedDataArray.float32;let m=Math.floor(f[l+2]);const y=1.05*(f[l+2]-m);return m/=100,[f[l]%1*1.05,f[l+1]%1*1.05,y,m]}tileCoordinatesForInstance(s){const l=16*s,f=this.instancedDataArray.float32;let m=f[l+0];return m=m>Zt?m-Zt:m,new Rt(Math.trunc(m),Math.trunc(f[l+1]))}translationForInstance(s){const l=16*s,f=this.instancedDataArray.float32;return[f[l+4],f[l+5],f[l+6]]}rotationScaleForInstance(s){const l=16*s,f=this.instancedDataArray.float32;return[f[l+7],f[l+8],f[l+9],f[l+10],f[l+11],f[l+12],f[l+13],f[l+14],f[l+15]]}transformForInstance(s){const l=16*s,f=this.instancedDataArray.float32;return[f[l+7],f[l+8],f[l+9],f[l+4],f[l+10],f[l+11],f[l+12],f[l+5],f[l+13],f[l+14],f[l+15],f[l+6],0,0,0,1]}}class _k{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaledZ=this.canonical.z+Math.log2(s.overscaling),this.layers=s.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=s.projection,this.index=s.index,this.worldview=s.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=s.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(s,l){}updateAppearances(s,l,f,m){}populate(s,l,f,m){this.tileToMeter=Oe(f);const y=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:b,index:j,sourceLayerIndex:N}of s){const k=b??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),M=lt(x,y);if(!this.layers[0]._featureFilter.filter(new Xs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),M,f))continue;const D={id:k,sourceLayerIndex:N,index:j,geometry:y?M.geometry:wt(x,f,m),properties:x.properties,type:x.type,patterns:{}},q=this.addFeature(D,D.geometry,M);q&&l.featureIndex.insert(x,D.geometry,j,N,this.index,this.instancesPerModel[q].instancedDataArray.length,Zt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const s=this.layers[0].modelManager,l=this.layers[0].scope;let f=0;for(const m of this.modelUris){const y=s.getModel(m,l);if(!y)continue;const x=this.instancesPerModel[m];if(x){const b=.5*dt(y.aabb.max,y.aabb.min)*x.maxScale+x.maxXYTranslationDistance,j=Math.min(Zt,Math.max(b/this.tileToMeter,Zt/32));f=Math.max(j,f)}}return f}update(s,l,f,m){for(const y in this.instancesPerModel){const x=this.instancesPerModel[y];for(const b in s)x.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(x.features[x.idToFeaturesIndex[b]],s[b],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let s=!1;for(const l in this.instancesPerModel){const f=this.instancesPerModel[l];for(const m of f.features){const y=this.layers[0],x=m.feature,b=this.canonical,j=y.paint.get("model-rotation").evaluate(x,{},b),N=y.paint.get("model-scale").evaluate(x,{},b),k=y.paint.get("model-translation").evaluate(x,{},b);Ln(m.rotation,j)&&Ln(m.scale,N)&&Ln(m.translation,k)||(this.evaluate(m,m.featureStates,f,!0),s=!0)}}return s}updateReplacement(s,l,f,m){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const y=l.getReplacementRegionsForTile(s.toUnwrapped(),!0);if(s2(this.activeReplacements,y))return!1;this.activeReplacements=y;let x=!1;for(const b in this.instancesPerModel){const j=this.instancesPerModel[b],N=j.instancedDataArray;for(const k of j.features){const M=k.instancedDataOffset,D=k.instancedDataCount;for(let q=0;q<D;q++){const G=16*(q+M);let ee=N.float32[G+0];const ne=ee>Zt;ee=ne?ee-Zt:ee;const ie=Math.floor(ee),me=Math.floor(N.float32[G+1]);let ye=!1;for(const be of this.activeReplacements)if(!YF(be,f,uB.Model,m)&&!(be.min.x>ie||ie>be.max.x||be.min.y>me||me>be.max.y)&&(ye=IP(tz(ie,me,s.canonical,be.footprintTileId.canonical),be.footprint),ye))break;N.float32[G]=ye?ee+Zt:ee,x=x||ye!==ne}}}return x}isEmpty(){for(const s in this.instancesPerModel)if(this.instancesPerModel[s].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(s){if(!this.uploaded)for(const l in this.instancesPerModel){const f=this.instancesPerModel[l];f.instancedDataArray.length<0||f.instancedDataArray.length===0||(f.instancedDataBuffer?f.instancedDataBuffer.updateData(f.instancedDataArray):f.instancedDataBuffer=s.createVertexBuffer(f.instancedDataArray,Cre.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const l in this.instancesPerModel){const f=this.instancesPerModel[l];f.instancedDataArray.length!==0&&f.instancedDataBuffer&&f.instancedDataBuffer.destroy()}const s=this.layers[0].modelManager;if(s&&this.modelUris&&this.modelsRequested)for(const l of this.modelUris)s.removeModel(l,"",!0)}addFeature(s,l,f){const m=this.layers[0],y=m.layout.get("model-id").evaluate(f,{},this.canonical);if(!y)return Ar(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),y;(gk(y,!1)||this.styleDefinedModelURLs[y]!==void 0)&&(this.modelUris.includes(y)||this.modelUris.push(y)),this.instancesPerModel[y]||(this.instancesPerModel[y]=new hB);const x=this.instancesPerModel[y],b=x.instancedDataArray,j=new dB(f,b.length);for(const N of l)for(const k of N){if(k.x<0||k.x>=Zt||k.y<0||k.y>=Zt)continue;if(this.lookupDim!==0){const D=(this.lookupDim-1)/Zt,q=this.lookupDim*(k.y*D|0)+k.x*D|0;if(this.lookup){if(this.lookup[q]!==0)continue;this.lookup[q]=1}}this.instanceCount++;const M=b.length;b.resize(M+1),x.instancesEvaluatedElevation.push(0),b.float32[16*M]=k.x,b.float32[16*M+1]=k.y}return j.instancedDataCount=x.instancedDataArray.length-j.instancedDataOffset,j.instancedDataCount>0&&(s.id&&(x.idToFeaturesIndex[s.id]=x.features.length),x.features.push(j),this.evaluate(j,{},x,!1)),y}getModelUris(){return this.modelUris}evaluate(s,l,f,m){const y=this.layers[0],x=s.feature,b=this.canonical,j=s.rotation=y.paint.get("model-rotation").evaluate(x,l,b),N=s.scale=y.paint.get("model-scale").evaluate(x,l,b),k=s.translation=y.paint.get("model-translation").evaluate(x,l,b),M=Object.assign({},y.paint.get("model-color").evaluate(x,l,b));M.a=y.paint.get("model-color-mix-intensity").evaluate(x,l,b);const D=[];this.maxVerticalOffset<k[2]&&(this.maxVerticalOffset=k[2]);const q=k[0]*k[0]+k[1]*k[1],G=q>0?Math.sqrt(q):0;f.maxScale=Math.max(Math.max(f.maxScale,N[0]),Math.max(N[1],N[2])),f.maxXYTranslationDistance=Math.max(f.maxXYTranslationDistance,G),this.maxScale=Math.max(Math.max(this.maxScale,N[0]),Math.max(N[1],N[2])),Vz(D,j,N);const ee=Math.round(100*M.a)+M.b/1.05;for(let ne=0;ne<s.instancedDataCount;++ne){const ie=s.instancedDataOffset+ne,me=16*ie,ye=f.instancedDataArray.float32;let be=0;m&&(be=ye[me+6]-f.instancesEvaluatedElevation[ie]);const Me=0|ye[me+1];ye[me]=(0|ye[me])+M.r/1.05,ye[me+1]=Me+M.g/1.05,ye[me+2]=ee,ye[me+3]=1/(b.z>10?this.tileToMeter:Oe(b,Me)),ye[me+4]=k[0],ye[me+5]=k[1],ye[me+6]=k[2]+be,ye[me+7]=D[0],ye[me+8]=D[1],ye[me+9]=D[2],ye[me+10]=D[4],ye[me+11]=D[5],ye[me+12]=D[6],ye[me+13]=D[8],ye[me+14]=D[9],ye[me+15]=D[10],f.instancesEvaluatedElevation[ie]=k[2]}}}let fB,pB;hr(_k,"ModelBucket",{omit:["layers"]}),hr(hB,"PerModelAttributes"),hr(dB,"ModelFeature");class nv{constructor(s,l,f){this._demTile=s,this._dem=this._demTile.dem,this._scale=l,this._offset=f}static create(s,l,f){const m=f||s.findDEMTileFor(l);if(!m||!m.dem)return;const y=m.dem,x=m.tileID,b=1<<l.canonical.z-x.canonical.z;return new nv(m,y.dim/Zt/b,[(l.canonical.x/b-x.canonical.x)*y.dim,(l.canonical.y/b-x.canonical.y)*y.dim])}tileCoordToPixel(s,l){const f=l*this._scale+this._offset[1];return new Rt(Math.floor(s*this._scale+this._offset[0]),Math.floor(f))}getElevationAt(s,l,f,m){const y=s*this._scale+this._offset[0],x=l*this._scale+this._offset[1],b=Math.floor(y),j=Math.floor(x),N=this._dem;return m=!!m,f?Ur(Ur(N.get(b,j,m),N.get(b,j+1,m),x-j),Ur(N.get(b+1,j,m),N.get(b+1,j+1,m),x-j),y-b):N.get(b,j,m)}getElevationAtPixel(s,l,f){return this._dem.get(s,l,!!f)}getMeterToDEM(s){return(1<<this._demTile.tileID.canonical.z)*_e(1,s)*this._dem.stride}}const yk=new Float32Array(262144),v_=new Uint8Array(262144);function mB(u){let s=0;if(u.meshes)for(const l of u.meshes)s=Math.max(s,l.aabb.max[2]);if(u.children)for(const l of u.children)s=Math.max(s,mB(l));return s}function gB(u,s,l){if(u.meshes)for(const f of u.meshes){if(f.aabb.min[0]===1/0)continue;const m=wn.applyTransform(f.aabb,u.globalMatrix);l.insert(s,m.min[0],m.min[1],m.max[0],m.max[1])}if(u.children)for(const f of u.children)gB(f,s,l)}const _B=["","wall","door","roof","window","lamp","logo"];class yB{constructor(s){this.node=s,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:s.id,geometry:[],properties:{height:mB(s)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let s=0;const l=new wn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const f of this.node.meshes)this.node.lightMeshIndex!==s&&(f.transformedAabb=wn.applyTransformFast(f.aabb,this.node.globalMatrix),l.encapsulate(f.transformedAabb)),s++;this.aabb=l}return this.aabb}}class D2{constructor(s,l,f,m,y,x,b,j){this.id=f,this.layers=s,this.layerIds=this.layers.map(N=>N.fqid),this.stateDependentLayerIds=this.layers.filter(N=>N.isStateDependent()).map(N=>N.id),this.modelTraits|=Zx.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=Zx.HasMapboxMeshFeatures),y&&(this.modelTraits|=Zx.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.worldview=j,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const N of l)this.nodesInfo.push(new yB(N)),gB(N,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(s,l){for(const f of this.getNodesInfo()){const m=f.node;m.footprint&&l.push({footprint:m.footprint,id:s})}}updateAppearances(s,l,f,m){}update(s){const l=Object.keys(s).length!==0;if(l&&!this.stateDependentLayers.length)return;const f=l?this.stateDependentLayers:this.layers;if(!ua(s,this.states))for(const m of f)this.evaluate(m,s);this.states=structuredClone(s)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(s){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const f of l){const m=f.node;this.uploaded?this.updatePbrBuffer(m):$P(m,s,!0)}for(const f of l)g2(f.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(s){let l=!1;if(!s.meshes)return l;for(const f of s.meshes)f.pbrBuffer&&(f.pbrBuffer.updateData(f.featureArray),l=!0);return l}needsReEvaluation(s,l,f){const m=s.transform.projectionOptions,y=s.style.getBrightness(),x=this.brightness!==y;if(!this.uploaded||this.dirty||m.name!==this.projection.name||o1(f.paint.get("model-color").value,x)||o1(f.paint.get("model-color-mix-intensity").value,x)||o1(f.paint.get("model-roughness").value,x)||o1(f.paint.get("model-emissive-strength").value,x)||o1(f.paint.get("model-height-based-emissive-strength-multiplier").value,x)){this.projection=m,this.brightness=y;const b=this.getNodesInfo();for(const j of b)j.state=null;return!0}return!1}evaluateTransform(s,l){if(s.transform.zoom===this.zoom)return;this.zoom=s.transform.zoom;const f=this.getNodesInfo(),m=this.id.canonical;for(const y of f){const x=y.feature;y.evaluatedTranslation=l.paint.get("model-translation").evaluate(x,{},m),y.evaluatedScale=l.paint.get("model-scale").evaluate(x,{},m)}}evaluate(s,l){const f=this.getNodesInfo();for(const m of f){if(!m.node.meshes)continue;const y=m.feature,x=l&&l[y.id];if(ua(x,m.state))continue;m.state=structuredClone(x);const b=m.node.meshes&&m.node.meshes[0].featureData,j=m.evaluatedColor[2],N=m.evaluatedRMEA[2],k=this.id.canonical;if(m.hasTranslucentParts=!1,b){for(let M=0;M<_B.length;M++){const D=_B[M];D.length&&(y.properties.part=D);const q=s.paint.get("model-color").evaluate(y,x,k).toPremultipliedRenderColor(null),G=s.paint.get("model-color-mix-intensity").evaluate(y,x,k);m.evaluatedColor[M]=[q.r,q.g,q.b,G],m.evaluatedRMEA[M][0]=s.paint.get("model-roughness").evaluate(y,x,k),m.evaluatedRMEA[M][2]=s.paint.get("model-emissive-strength").evaluate(y,x,k),m.evaluatedRMEA[M][3]=q.a,m.emissionHeightBasedParams[M]=s.paint.get("model-height-based-emissive-strength-multiplier").evaluate(y,x,k),!m.hasTranslucentParts&&q.a<1&&(m.hasTranslucentParts=!0)}delete y.properties.part,sse(m,j!==m.evaluatedColor[2]||N!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=s.paint.get("model-emissive-strength").evaluate(y,x,k);m.evaluatedTranslation=s.paint.get("model-translation").evaluate(y,x,k),m.evaluatedScale=s.paint.get("model-scale").evaluate(y,x,k),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(s,l,f,m){const y=s.findDEMTileFor(f);if(y&&(y.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(y.dem&&y.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=y.tileID.overscaledZ;const x=nv.create(s,f,y);if(!x)return;this.modelTraits&Zx.HasMapboxMeshFeatures&&this.updateDEM(s,x,f,m);for(const b of this.getNodesInfo()){const j=b.node;if(!j.footprint||!j.footprint.vertices||!j.footprint.vertices.length)continue;const N=j.footprint.vertices;let k=x.getElevationAt(N[0].x,N[0].y,!0,!0);for(let M=1;M<N.length;M++)k=Math.min(k,x.getElevationAt(N[M].x,N[M].y,!0,!0));j.elevation=k}}this.terrainTile=y.tileID.canonical,this.terrainExaggeration=l}}updateDEM(s,l,f,m){let y=l._dem._modifiedForSources[m];if(y===void 0&&(l._dem._modifiedForSources[m]=[],y=l._dem._modifiedForSources[m]),y.includes(f.canonical))return;const x=l._dem.dim;y.push(f.canonical);let b=!1;for(const j of this.getNodesInfo()){const N=j.node;if(!N.footprint||!N.footprint.grid)continue;const k=N.footprint.grid,M=l.tileCoordToPixel(k.min.x,k.min.y),D=l.tileCoordToPixel(k.max.x,k.max.y),q=Math.min(Math.min(x-D.y,M.x),Math.min(M.y,x-D.x));if(q<0)continue;const G=he(q,2,5);let ee=Math.max(0,M.x-G),ne=Math.max(0,M.y-G),ie=Math.min(D.x+G,x-1),me=Math.min(D.y+G,x-1);for(let Ce=ne;Ce<=me;++Ce)for(let Le=ee;Le<=ie;++Le)v_[Ce*x+Le]=255;let ye=0,be=0;for(let Ce=0;Ce<k.cellsY;++Ce)for(let Le=0;Le<k.cellsX;++Le){if(!k.cells[Ce*k.cellsX+Le])continue;const Ve=l.tileCoordToPixel(k.min.x+Le/k.xScale,k.min.y+Ce/k.yScale),He=l.tileCoordToPixel(k.min.x+(Le+1)/k.xScale,k.min.y+(Ce+1)/k.yScale);for(let mt=Ve.y;mt<=Math.min(He.y+1,x-1);++mt)for(let rt=Ve.x;rt<=Math.min(He.x+1,x-1);++rt)v_[mt*x+rt]===255&&(v_[mt*x+rt]=0,ye+=l.getElevationAtPixel(rt,mt),be++)}const Me=ye/be;ee=Math.max(1,M.x-G),ne=Math.max(1,M.y-G),ie=Math.min(D.x+G,x-2),me=Math.min(D.y+G,x-2),b=!0;for(let Ce=ne;Ce<=me;++Ce)for(let Le=ee;Le<=ie;++Le)v_[Ce*x+Le]===0&&(yk[Ce*x+Le]=l._dem.set(Le,Ce,Me));for(let Ce=1;Ce<G;++Ce){ee=Math.max(1,M.x-Ce),ne=Math.max(1,M.y-Ce),ie=Math.min(D.x+Ce,x-2),me=Math.min(D.y+Ce,x-2);for(let Le=ne;Le<=me;++Le)for(let Ve=ee;Ve<=ie;++Ve){const He=Le*x+Ve;if(v_[He]===255){let mt=0,rt=0,gt=-1,bt=-1;for(let Ct=-1;Ct<=1;++Ct)for(let Gt=-1;Gt<=1;++Gt){const Ot=(Le+Ct)*x+Ve+Gt;if(v_[Ot]>=Ce)continue;const Et=yk[Ot],Dt=Math.abs(Et);Dt>rt&&(mt=Et,rt=Dt,gt=Gt,bt=Ct)}if(rt>.1){const Ct=1-(Ce+.5*Math.abs(gt*bt))/G;let Gt=l._dem.get(Ve,Le)+mt*Ct;const Ot=l._dem.get(Ve+gt,Le+bt),Et=l._dem.get(Ve-gt,Le-bt,!0);(Gt-Ot)*(Gt-Et)>0&&(Gt=(Ot+Et)/2),yk[He]=l._dem.set(Ve,Le,Gt),v_[He]=Ce}}}}}b&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=Bs.now())}setFilter(s){this.filter=s?Ex(s):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(s=>this.filter.filter(new Xs(this.id.overscaledZ,{worldview:this.worldview}),s.feature,this.id.canonical)):this.nodesInfo}destroy(){const s=this.getNodesInfo();for(const l of s)g2(l.node),qP(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(s,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const f=l.getReplacementRegionsForTile(s.toUnwrapped());for(const m of this.getNodesInfo()){const y=m.node.footprint;m.hiddenByReplacement=!!y&&!f.find(x=>x.footprint===y)}}getHeightAtTileCoord(s,l){const f=[],m=[0,0,0],y=K([]);for(const x of this.getNodesInfo()){const b=x.node.meshes[0],j=b.transformedAabb;if(s<j.min[0]||l<j.min[1]||s>j.max[0]||l>j.max[1])continue;if(x.node.hidden===!0)return{height:1/0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};Z(y,x.node.globalMatrix),m[0]=s,m[1]=l,ln(m,m,y);const N=(m[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*__|0,k=Math.min(63,(m[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*__|0)*__+Math.min(63,N),M=b.heightmap[k];if(!(M<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:M,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new Rt(s,l),new Rt(s,l),f),f.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function o1(u,s){return u instanceof r_&&!u.isLightConstant&&s}function nse(u,s,l,f,m,y,x,b){let j=(61440&s|(61440&s)>>4)>>8,N=(3840&s|(3840&s)>>4)>>4,k=240&s|(240&s)>>4;l[3]>0&&(j=Ur(j,255*l[0],l[3]),N=Ur(N,255*l[1],l[3]),k=Ur(k,255*l[2],l[3]));const M=j<<8|N,D=k<<8|Math.floor(255*f[3]),q=function(Ce){const Le=he(Ce,0,2);return Math.min(Math.round(.5*Le*255),255)}(f[2])<<8|15*f[0]<<4|15*f[1],G=he(m[0],0,1),ee=he(m[1],0,1),ne=he(m[2],0,1),ie=he(m[3],0,1);let me,ye,be,Me;if(G!==ee&&x!==y&&ee!==G){const Ce=x-y;ye=1/(Ce*(ee-G)),be=-(y+Ce*G)/(Ce*(ee-G));const Le=he(m[4],-1,1);Me=Math.pow(10,Le),me=255*ne<<8|255*ie}else me=65535,ye=0,be=1,Me=1;if(u.emplaceBack(M,D,q,me,ye,be,Me),b){const Ce=b.length;b.clear();for(let Le=0;Le<Ce;Le++)b.emplaceBack(M,D,q,me,ye,be,Me)}}function sse(u,s,l){const f=u.node;let m=0;const y=l&Zx.HasMeshoptCompression;for(const x of f.meshes){if(f.lights&&f.lightMeshIndex===m||!x.featureData)continue;x.featureArray=new um,x.featureArray.reserve(x.featureData.length);let b=s;for(const j of x.featureData){const N=y?65535&j:j>>16&65535,k=y?j>>16&65535:65535&j,M=(15&k)<8?15&k:0,D=u.evaluatedRMEA[M],q=u.evaluatedColor[M],G=u.emissionHeightBasedParams[M];let ee;if(b&&M===2&&f.lights&&(ee=new um,ee.resize(10*f.lights.length)),nse(x.featureArray,N,q,D,G,x.aabb.min[2],x.aabb.max[2],ee),ee&&b){b=!1;const ne=f.meshes[f.lightMeshIndex];ne.featureArray=ee,ne.featureArray._trim()}}x.featureArray._trim(),m++}}hr(D2,"Tiled3dModelBucket",{omit:["layers"]}),hr(yB,"Tiled3dModelFeature");const ise=["id","tile","layer","source","sourceLayer","state"];class w_{constructor(s,l,f,m,y){this.type="Feature",this._vectorTileFeature=s,this._z=l,this._x=f,this._y=m,this.properties=s?s.properties:{},this.id=y}clone(){const s=new w_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(s.state=Object.assign({},this.state)),this.layer&&(s.layer=Object.assign({},this.layer)),this.source&&(s.source=this.source),this.sourceLayer&&(s.sourceLayer=this.sourceLayer),s}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of ise)this[l]!==void 0&&(s[l]=this[l]);return s}}class b_ extends Oc{constructor(s,l,f,m){super(),this.id=s,this.type="model",this.models=[],this._loaded=!1,this._options=l,this._modelsInfo=new Map}load(){const s=[];for(const l in this._options.models){const f=this._options.models[l],m=this._modelsInfo.get(l);if(m){const y=m.model;y.position=f.position!=null?new H(f.position[0],f.position[1]):new H(0,0),y.orientation=f.orientation!=null?f.orientation:[0,0,0],m.modelSpec=f,b_.applyModelSpecification(y,f),y.computeBoundsAndApplyParent(),this.models.push(y)}else{const y=Lz(this.map._requestManager.transformRequest(f.uri,tl.Model).url).then(x=>{if(!x)return;const b=HP(x),j=new Uz(l,f.uri,f.position,f.orientation,b);b_.applyModelSpecification(j,f),j.computeBoundsAndApplyParent(),this.models.push(j),this._modelsInfo.set(l,{modelSpec:f,model:j})}).catch(x=>{this.fire(new gh(new Error(`Could not load model ${l} from ${f.uri}: ${x.message}`)))});s.push(y)}}Promise.allSettled(s).then(()=>{this._loaded=!0,this.fire(new Sa("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this._loaded=!0,this.fire(new gh(new Error(`Could not load models: ${l.message}`)))})}static applyModelSpecification(s,l){l.nodeOverrides&&b_.convertNodeOverrides(s,l.nodeOverrides),l.materialOverrides&&b_.convertMaterialOverrides(s,l.materialOverrides),l.nodeOverrideNames&&(s.nodeOverrideNames=[...l.nodeOverrideNames]),l.materialOverrideNames&&(s.materialOverrideNames=[...l.materialOverrideNames]),l.featureProperties&&(s.featureProperties=l.featureProperties)}static convertNodeOverrides(s,l){if(Array.isArray(l)&&l.every(f=>typeof f=="string")){s.nodeOverrideNames=[];for(const f of l)s.nodeOverrideNames.push(f)}else Object.entries(l).forEach(([f,m])=>{const y={orientation:[0,0,0]};if(m.hasOwnProperty("orientation")){const x=m.orientation;x&&(y.orientation=x)}s.nodeOverrides.set(f,y)})}static convertMaterialOverrides(s,l){if(Array.isArray(l)&&l.every(f=>typeof f=="string")){s.materialOverrideNames=[];for(const f of l)s.materialOverrideNames.push(f)}else Object.entries(l).forEach(([f,m])=>{const y={color:new os(1,1,1),colorMix:0,emissionStrength:0,opacity:1},x=m["model-color"];x!==void 0&&(y.color.r=x[0],y.color.g=x[1],y.color.b=x[2]);const b=m["model-color-mix-intensity"];b!==void 0&&(y.colorMix=b);const j=m["model-emissive-strength"];j!==void 0&&(y.emissionStrength=j);const N=m["model-opacity"];N!==void 0&&(y.opacity=N),s.materialOverrides.set(f,y)})}onAdd(s){this.map=s,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(s,l){}serialize(){return this._options}setProperty(s,l){return!1}reload(){const s=Rf(this.id,this.scope);this.map.style.clearSource(s),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(s){this.models=[];const l=new Map;for(const f in s){const m=s[f];if(this._modelsInfo.has(f)){const y=this._modelsInfo.get(f);y&&y.modelSpec.uri===m.uri&&l.set(f,y)}}this._modelsInfo=l,this._options.models=s,this._loaded=!1,this.load()}}function xk(u,s,l,f){const m=1<<u.z;s.lat=xe((f/Zt+u.y)/m),s.lng=Ee((l/Zt+u.x)/m)}function ase(u,s,l,f){const m=u.getNodesInfo()[s];if(!m||m.hiddenByReplacement||!m.node.meshes)return;let y=Number.MAX_VALUE;const x=m.node,b=l.tile,j=f.calculatePosMatrix(b.tileID.toUnwrapped(),f.worldSize),N=m.evaluatedScale;let k=0;f.elevation&&x.elevation&&(k=x.elevation*f.elevation.exaggeration()),X(j,j,[(x.anchor?x.anchor[0]:0)*(N[0]-1),(x.anchor?x.anchor[1]:0)*(N[1]-1),k]),Q(j,j,N);const M=l.queryGeometry,D=M.isPointQuery()?M.screenBounds:M.screenGeometry,q=function(ee){const ne=$([],j,ee.globalMatrix);$(ne,f.expandedFarZProjMatrix,ne);for(let ie=0;ie<ee.meshes.length;++ie){const me=ee.meshes[ie];if(ie===ee.lightMeshIndex)continue;const ye=UP(D,f,ne,me.aabb);ye!=null&&(y=Math.min(ye,y))}if(ee.children)for(const ie of ee.children)q(ie)};if(q(x),y===Number.MAX_VALUE)return;const G=new H(0,0);return xk(b.tileID.canonical,G,m.node.anchor[0],m.node.anchor[1]),{intersectionZ:y,position:G,feature:m.feature}}const ose={circle:class extends Ho{constructor(u,s,l,f){super(u,{layout:Id||(Id=new Pi({"circle-sort-key":new nr(tt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Vt(tt.layout_circle["circle-elevation-reference"]),visibility:new Vt(tt.layout_circle.visibility)})),paint:fm||(fm=new Pi({"circle-radius":new nr(tt.paint_circle["circle-radius"]),"circle-color":new nr(tt.paint_circle["circle-color"]),"circle-blur":new nr(tt.paint_circle["circle-blur"]),"circle-opacity":new nr(tt.paint_circle["circle-opacity"]),"circle-translate":new Vt(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new nr(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new nr(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new nr(tt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Vt(tt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f)}createBucket(u){return new pi(u)}queryRadius(u){const s=u;return $a("circle-radius",this,s)+$a("circle-stroke-width",this,s)+Ti(this.paint.get("circle-translate"))}queryIntersectsFeature(u,s,l,f,m,y,x,b){const j=hm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,u.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(s,l)+this.paint.get("circle-stroke-width").evaluate(s,l);return EF(u,f,y,x,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",j,N)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,s,l){const f=SF(this);return{config:new Nd(this,{zoom:s,lut:l}),defines:f,overrideFog:!1}}is3D(u){return!u&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ho{createBucket(u){return new jF(u)}constructor(u,s,l,f){super(u,{layout:NF||(NF=new Pi({visibility:new Vt(tt.layout_heatmap.visibility)})),paint:IF||(IF=new Pi({"heatmap-radius":new nr(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new nr(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new em(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(tt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(u){return $a("heatmap-radius",this,u)}queryIntersectsFeature(u,s,l,f,m,y,x,b){const j=this.paint.get("heatmap-radius").evaluate(s,l);return EF(u,f,y,x,b,!0,!0,new Rt(0,0),j)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,s,l){return u==="heatmap"?{config:new Nd(this,{zoom:s,lut:l}),overrideFog:!1}:{}}},hillshade:class extends Ho{constructor(u,s,l,f){super(u,{layout:CF||(CF=new Pi({visibility:new Vt(tt.layout_hillshade.visibility)})),paint:AF||(AF=new Pi({"hillshade-illumination-direction":new Vt(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(tt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Vt(tt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,s,l){return{overrideFog:!1}}},fill:class extends Ho{constructor(u,s,l,f){super(u,{layout:GF||(GF=new Pi({"fill-sort-key":new nr(tt.layout_fill["fill-sort-key"]),visibility:new Vt(tt.layout_fill.visibility),"fill-elevation-reference":new Vt(tt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new nr(tt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:HF||(HF=new Pi({"fill-antialias":new Vt(tt.paint_fill["fill-antialias"]),"fill-opacity":new nr(tt.paint_fill["fill-opacity"]),"fill-color":new nr(tt.paint_fill["fill-color"]),"fill-outline-color":new nr(tt.paint_fill["fill-outline-color"]),"fill-translate":new Vt(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new nr(tt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Vt(tt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Vt(tt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new nr(tt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new nr(tt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new nr(tt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f)}getProgramIds(){const u=this.paint.get("fill-pattern"),s=u&&u.constantOr(1),l=[s?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(s&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(u,s,l){return{config:new Nd(this,{zoom:s,lut:l}),overrideFog:!1}}recalculate(u,s){super.recalculate(u,s);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new TP(u)}queryRadius(){return Ti(this.paint.get("fill-translate"))}queryIntersectsFeature(u,s,l,f,m,y){return!u.queryGeometry.isAboveHorizon&&ki(cc(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,u.pixelToTileUnitsFactor),f)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const s=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?s&&!u:s}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ho{constructor(u,s,l,f){super(u,{layout:_z||(_z=new Pi({visibility:new Vt(tt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Vt(tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:yz||(yz=new Pi({"fill-extrusion-opacity":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new nr(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nr(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new nr(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new nr(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new nr(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new nr(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new nr(tt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new nr(tt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Vt(tt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new a2(u)}queryRadius(){return Ti(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,s,l,f,m,y,x,b,j){const N=hm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,u.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(s,l),M=this.paint.get("fill-extrusion-base").evaluate(s,l),D=[0,0],q=b&&y.elevation,G=y.elevation?y.elevation.exaggeration():1,ee=u.tile.getBucket(this);if(q&&ee instanceof a2){const be=ee.centroidVertexArray,Me=j+1;Me<be.length&&(D[0]=be.geta_centroid_pos0(Me),D[1]=be.geta_centroid_pos1(Me))}if(D[0]===0&&D[1]===1)return!1;y.projection.name==="globe"&&(f=gz([f],[new Rt(0,0),new Rt(Zt,Zt)],u.tileID.canonical).map(be=>be.polygon).flat());const ne=q?b:null,[ie,me]=Tz(y,f,M,k,N,x,ne,D,G,y.center.lat,u.tileID.canonical),ye=u.queryGeometry;return Ez(ie,me,ye.isPointQuery()?ye.screenBounds:ye.screenGeometry)}},building:class extends Ho{constructor(u,s,l,f){super(u,{layout:Xz||(Xz=new Pi({visibility:new Vt(tt.layout_building.visibility),"building-facade":new nr(tt.layout_building["building-facade"]),"building-facade-floors":new nr(tt.layout_building["building-facade-floors"]),"building-facade-unit-width":new nr(tt.layout_building["building-facade-unit-width"]),"building-facade-window":new nr(tt.layout_building["building-facade-window"]),"building-roof-shape":new nr(tt.layout_building["building-roof-shape"]),"building-height":new nr(tt.layout_building["building-height"]),"building-base":new nr(tt.layout_building["building-base"]),"building-flood-light-wall-radius":new nr(tt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new nr(tt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new nr(tt.layout_building["building-flip-roof-orientation"])})),paint:Yz||(Yz=new Pi({"building-opacity":new Vt(tt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Vt(tt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Vt(tt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Vt(tt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Vt(tt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Vt(tt.paint_building["building-vertical-scale"]),"building-cast-shadows":new Vt(tt.paint_building["building-cast-shadows"]),"building-color":new nr(tt.paint_building["building-color"]),"building-emissive-strength":new nr(tt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Vt(tt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Vt(tt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Vt(tt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Vt(tt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Vt(tt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new Kz(u)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(u){return!0}queryRadius(u){return 0}queryIntersectsFeature(u,s,l,f,m,y,x,b,j){let N=this.layout.get("building-height").evaluate(s,l);const k=this.layout.get("building-base").evaluate(s,l),M=u.tile.getBucket(this).getFootprint(s);if(M){if(M.hiddenFlags!==0)return!1;N=M.height}const[D,q]=Tz(y,f,k,N,new Rt(0,0),x,null,[0,0],1,y.center.lat,u.tileID.canonical),G=u.queryGeometry;return Ez(D,q,G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends Ho{constructor(u,s,l,f){const m=o5();super(u,m,s,l,f),m.layout&&(this.layout=new kf(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const s=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=s._styleExpression&&s._styleExpression.expression instanceof Xg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,s){super.recalculate(u,s),this.paint._values["line-floorwidth"]=(()=>{if(Hb)return Hb;const l=o5();return Hb=new nne(l.paint.properties["line-width"].specification),Hb.useIntegerZoom=!0,Hb})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new ZP(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,s,l){const f=i5(this);return{config:new Nd(this,{zoom:s,lut:l}),defines:f,overrideFog:!1}}queryRadius(u){const s=u,l=l5($a("line-width",this,s),$a("line-gap-width",this,s)),f=$a("line-offset",this,s);return l/2+Math.abs(f)+Ti(this.paint.get("line-translate"))}queryIntersectsFeature(u,s,l,f,m,y){if(u.queryGeometry.isAboveHorizon)return!1;const x=cc(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,u.pixelToTileUnitsFactor),b=u.pixelToTileUnitsFactor/2*l5(this.paint.get("line-width").evaluate(s,l),this.paint.get("line-gap-width").evaluate(s,l)),j=this.paint.get("line-offset").evaluate(s,l);return j&&(f=function(N,k){const M=[],D=new Rt(0,0);for(let q=0;q<N.length;q++){const G=N[q],ee=[];for(let ne=0;ne<G.length;ne++){const ie=G[ne],me=G[ne+1],ye=ne===0?D:ie.sub(G[ne-1])._unit()._perp(),be=ne===G.length-1?D:me.sub(ie)._unit()._perp(),Me=ye._add(be)._unit();Me._mult(1/(Me.x*be.x+Me.y*be.y)),ee.push(Me._mult(k)._add(ie))}M.push(ee)}return M}(f,j*u.pixelToTileUnitsFactor)),function(N,k,M){for(let D=0;D<k.length;D++){const q=k[D];if(N.length>=3){for(let G=0;G<q.length;G++)if(Ua(N,q[G]))return!0}if(vl(N,q,M))return!0}return!1}(x,f,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:P2,background:class extends Ho{constructor(u,s,l,f){super(u,{layout:Y5||(Y5=new Pi({visibility:new Vt(tt.layout_background.visibility)})),paint:J5||(J5=new Pi({"background-pitch-alignment":new Vt(tt.paint_background["background-pitch-alignment"]),"background-color":new Vt(tt.paint_background["background-color"]),"background-pattern":new Vt(tt.paint_background["background-pattern"]),"background-opacity":new Vt(tt.paint_background["background-opacity"]),"background-emissive-strength":new Vt(tt.paint_background["background-emissive-strength"]),"background-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,s,l){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:nB,"raster-particle":cB,sky:class extends Ho{constructor(u,s,l,f){super(u,{layout:aB||(aB=new Pi({visibility:new Vt(tt.layout_sky.visibility)})),paint:oB||(oB=new Pi({"sky-type":new Vt(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Vt(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Vt(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Vt(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Vt(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new em(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Vt(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Vt(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Vt(tt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Cb({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const s=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==s.azimuthal||this._lightPosition.polar!==s.polar}return!1}getCenter(u,s){if(this.paint.get("sky-type")==="atmosphere"){const f=this.paint.get("sky-atmosphere-sun"),m=!f,y=u.style.light,x=y.properties.get("position");return m&&y.properties.get("anchor")==="viewport"&&Ar("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?mk(x.azimuthal,90-x.polar,s):mk(f[0],90-f[1],s)}const l=this.paint.get("sky-gradient-center");return mk(l[0],90-l[1],s)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends Ho{constructor(u,s,l,f){super(u,{paint:lB||(lB=new Pi({}))},s,null)}},model:class extends Ho{constructor(u,s,l,f){super(u,{layout:fB||(fB=new Pi({visibility:new Vt(tt.layout_model.visibility),"model-id":new nr(tt.layout_model["model-id"])})),paint:pB||(pB=new Pi({"model-opacity":new nr(tt.paint_model["model-opacity"]),"model-rotation":new nr(tt.paint_model["model-rotation"]),"model-scale":new nr(tt.paint_model["model-scale"]),"model-translation":new nr(tt.paint_model["model-translation"]),"model-color":new nr(tt.paint_model["model-color"]),"model-color-mix-intensity":new nr(tt.paint_model["model-color-mix-intensity"]),"model-type":new Vt(tt.paint_model["model-type"]),"model-cast-shadows":new Vt(tt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Vt(tt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Vt(tt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new nr(tt.paint_model["model-emissive-strength"]),"model-roughness":new nr(tt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new nr(tt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Vt(tt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Vt(tt.paint_model["model-front-cutoff"]),"model-elevation-reference":new Vt(tt.paint_model["model-elevation-reference"]),"model-color-use-theme":new nr({type:"string",default:"default","property-type":"data-driven"})}))},s,l,f),this.layer=u,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new _k(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof D2?Zt-1:0}queryRenderedFeatures(u,s,l){const f=s.getSource();if(!(f&&f instanceof b_))return{};const m=f,y={};y[this.id]=[];const x=y[this.id];let b=0;for(const j of m.models){const N=s.getFeatureState(this.sourceLayer,j.id),k={type:"Unknown",id:j.id,properties:j.featureProperties},M=this.paint.get("model-rotation").evaluate(k,N),D=this.paint.get("model-scale").evaluate(k,N),q=this.paint.get("model-translation").evaluate(k,N),G=this.paint.get("model-elevation-reference");let ee=[];m2(ee,j,l,j.position,M,D,q,G==="ground",G==="ground",!1),l.projection.name==="globe"&&(ee=p2(ee,l));const ne=$([],l.projMatrix,ee),ie=UP(u.isPointQuery()?u.screenBounds:u.screenGeometry,l,ne,j.aabb);if(ie!=null){const me=new w_(void 0,0,0,0,j.id);me.layer=this.layer,me.properties=structuredClone(j.featureProperties),me.properties.layer=this.id,me.properties.uri=j.uri,me.properties.orientation=j.orientation,me.sourceLayer=this.sourceLayer,me.geometry={type:"Point",coordinates:[j.position.lng,j.position.lat]},me.state=N,me.source=this.source,x.push({featureIndex:b,feature:me,intersectionZ:ie})}++b}return y}queryIntersectsFeature(u,s,l,f,m,y){if(!this.modelManager)return!1;const x=this.modelManager,b=u.tile.getBucket(this);if(!(b&&b instanceof _k))return!1;for(const j in b.instancesPerModel){const N=b.instancesPerModel[j],k=s.id!==void 0?s.id:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0;if(N.idToFeaturesIndex.hasOwnProperty(k)){const M=N.features[N.idToFeaturesIndex[k]],D=x.getModel(j,this.scope);if(!D)return!1;let q=[];const G=new H(0,0),ee=b.canonical;let ne=Number.MAX_VALUE;for(let ie=0;ie<M.instancedDataCount;++ie){const me=16*(M.instancedDataOffset+ie),ye=N.instancedDataArray.float32,be=[ye[me+4],ye[me+5],ye[me+6]];xk(ee,G,Math.floor(ye[me]),Math.floor(ye[me+1])),m2(q,D,y,G,M.rotation,M.scale,be,!1,!1,!1),y.projection.name==="globe"&&(q=p2(q,y));const Me=$([],y.projMatrix,q),Ce=u.queryGeometry,Le=UP(Ce.isPointQuery()?Ce.screenBounds:Ce.screenGeometry,y,Me,D.aabb);Le!=null&&(ne=Math.min(Le,ne))}return ne!==Number.MAX_VALUE&&ne}}return!1}_handleOverridablePaintPropertyUpdate(u,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const s=this._transitionablePaint._values[u];return s!=null&&s.value!=null&&s.value.expression!=null&&s.value.expression instanceof Nh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ho{constructor(u,s,l,f){super(u,{layout:WF||(WF=new Pi({"clip-layer-types":new Vt(tt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Vt(tt.layout_clip["clip-layer-scope"])})),paint:ZF||(ZF=new Pi({}))},s,l,f)}recalculate(u,s){super.recalculate(u,s)}createBucket(u){return new KF(u)}is3D(u){return!0}}},vk=new os(0,0,0),wk={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},bk={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},O2={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},lse={PAINT_ORDER_FILL_AND_STROKE:1},l1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},xB={MASK_TYPE_LUMINANCE:1};function cse(u,s,l){u===1&&s.icons.push(function(f,m){return function(y){if(y.usvg_tree.height||(y.usvg_tree.height=y.usvg_tree.width),!y.metadata)return y;const{metadata:x}=y;if(x.content_area){const{content_area:b}=x;b.left==null&&(b.left=0),b.top==null&&(b.top=b.left),b.width==null&&(b.width=y.usvg_tree.width),b.height==null&&(b.height=b.width)}if(x.text_placeholder){const{text_placeholder:b}=x;b.top==null&&(b.top=b.left),b.height==null&&(b.height=b.width)}return x.stretch_x&&x.stretch_x.length&&vB(x,"x"),x.stretch_y&&x.stretch_y.length&&vB(x,"y"),y}(f.readFields(use,{name:void 0},m))}(l,l.readVarint()+l.pos))}function vB(u,s){const l=[],f=u[`stretch_${s}`];let m=null;for(let y=0;y<f.length;y++)m===null?m=l.length===0?f[0]:l[l.length-1][1]+f[y]:(l.push([m,m+f[y]]),m=null);u[`stretch_${s}_areas`]=l}function use(u,s,l){u===1?s.name=l.readString():u===2?s.metadata=function(f,m){return f.readFields(dse,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(l,l.readVarint()+l.pos):u===3&&(s.usvg_tree=function(f,m){return f.readFields(pse,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(l,l.readVarint()+l.pos),s.data="usvg_tree")}function dse(u,s,l){u===1?s.stretch_x=l.readPackedVarint():u===2?s.stretch_y=l.readPackedVarint():u===3?s.content_area=wB(l,l.readVarint()+l.pos):u===4?s.variables.push(function(f,m){return f.readFields(fse,{name:void 0},m)}(l,l.readVarint()+l.pos)):u===5&&(s.text_placeholder=wB(l,l.readVarint()+l.pos))}function wB(u,s){return u.readFields(hse,{},s)}function hse(u,s,l){u===1?s.left=l.readVarint():u===2?s.width=l.readVarint():u===3?s.top=l.readVarint():u===4&&(s.height=l.readVarint())}function fse(u,s,l){u===1?s.name=l.readString():u===2&&(s.rgb_color=z2(l.readVarint()),s.value="rgb_color")}function pse(u,s,l){u===1?s.width=s.height=l.readVarint():u===2?s.height=l.readVarint():u===3?s.children.push(L2(l,l.readVarint()+l.pos)):u===4?s.linear_gradients.push(function(f,m){return f.readFields(wse,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(l,l.readVarint()+l.pos)):u===5?s.radial_gradients.push(function(f,m){return f.readFields(Sse,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(l,l.readVarint()+l.pos)):u===7?s.clip_paths.push(function(f,m){return f.readFields(Ese,{children:[]},m)}(l,l.readVarint()+l.pos)):u===8&&s.masks.push(function(f,m){const y=f.readFields(Tse,{left:0,width:20,mask_type:xB.MASK_TYPE_LUMINANCE,children:[]},m);return y.height==null&&(y.height=y.width),y.top==null&&(y.top=y.left),y}(l,l.readVarint()+l.pos))}function L2(u,s){return u.readFields(mse,{},s)}function mse(u,s,l){u===1?(s.group=function(f,m){return f.readFields(gse,{opacity:255,children:[]},m)}(l,l.readVarint()+l.pos),s.node="group"):u===2&&(s.path=function(f,m){return f.readFields(yse,{paint_order:1,commands:[],step:1,diffs:[],rule:wk.PATH_RULE_NON_ZERO},m)}(l,l.readVarint()+l.pos),s.node="path")}function gse(u,s,l){u===1?s.transform=F2(l,l.readVarint()+l.pos):u===2?s.opacity=l.readVarint():u===5?s.clip_path_idx=l.readVarint():u===6?s.mask_idx=l.readVarint():u===7&&s.children.push(L2(l,l.readVarint()+l.pos))}function F2(u,s){return u.readFields(_se,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},s)}function _se(u,s,l){u===1?s.sx=l.readFloat():u===2?s.ky=l.readFloat():u===3?s.kx=l.readFloat():u===4?s.sy=l.readFloat():u===5?s.tx=l.readFloat():u===6&&(s.ty=l.readFloat())}function yse(u,s,l){u===1?s.fill=function(f,m){return f.readFields(xse,{rgb_color:vk,paint:"rgb_color",opacity:255},m)}(l,l.readVarint()+l.pos):u===2?s.stroke=function(f,m){return f.readFields(vse,{rgb_color:vk,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(l,l.readVarint()+l.pos):u===3?s.paint_order=l.readVarint():u===5?l.readPackedVarint(s.commands):u===6?s.step=l.readFloat():u===7?l.readPackedSVarint(s.diffs):u===8&&(s.rule=l.readVarint())}function xse(u,s,l){u===1?(s.rgb_color=z2(l.readVarint()),s.paint="rgb_color"):u===2?(s.linear_gradient_idx=l.readVarint(),s.paint="linear_gradient_idx"):u===3?(s.radial_gradient_idx=l.readVarint(),s.paint="radial_gradient_idx"):u===5&&(s.opacity=l.readVarint())}function z2(u){return new os((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function vse(u,s,l){u===1?(s.rgb_color=z2(l.readVarint()),s.paint="rgb_color"):u===2?(s.linear_gradient_idx=l.readVarint(),s.paint="linear_gradient_idx"):u===3?(s.radial_gradient_idx=l.readVarint(),s.paint="radial_gradient_idx"):u===5?l.readPackedFloat(s.dasharray):u===6?s.dashoffset=l.readFloat():u===7?s.miterlimit=l.readFloat():u===8?s.opacity=l.readVarint():u===9?s.width=l.readFloat():u===10?s.linecap=l.readVarint():u===11&&(s.linejoin=l.readVarint())}function wse(u,s,l){u===1?s.transform=F2(l,l.readVarint()+l.pos):u===2?s.spread_method=l.readVarint():u===3?s.stops.push(bB(l,l.readVarint()+l.pos)):u===4?s.x1=l.readFloat():u===5?s.y1=l.readFloat():u===6?s.x2=l.readFloat():u===7&&(s.y2=l.readFloat())}function bB(u,s){return u.readFields(bse,{offset:0,opacity:255,rgb_color:vk},s)}function bse(u,s,l){u===1?s.offset=l.readFloat():u===2?s.opacity=l.readVarint():u===3&&(s.rgb_color=z2(l.readVarint()))}function Sse(u,s,l){u===1?s.transform=F2(l,l.readVarint()+l.pos):u===2?s.spread_method=l.readVarint():u===3?s.stops.push(bB(l,l.readVarint()+l.pos)):u===4?s.cx=l.readFloat():u===5?s.cy=l.readFloat():u===6?s.r=l.readFloat():u===7?s.fx=l.readFloat():u===8?s.fy=l.readFloat():u===9&&(s.fr=l.readFloat())}function Ese(u,s,l){u===1?s.transform=F2(l,l.readVarint()+l.pos):u===2?s.clip_path_idx=l.readVarint():u===3&&s.children.push(L2(l,l.readVarint()+l.pos))}function Tse(u,s,l){u===1?s.left=s.top=l.readFloat():u===2?s.width=s.height=l.readFloat():u===3?s.top=l.readFloat():u===4?s.height=l.readFloat():u===5?s.mask_type=l.readVarint():u===6?s.mask_idx=l.readVarint():u===7&&s.children.push(L2(l,l.readVarint()+l.pos))}class jse{static calculate(s={},l=[]){const f=new Map,m=new Map;if(Object.keys(s).length===0)return f;l.forEach(y=>{m.set(y.name,y.rgb_color||new os(0,0,0))});for(const[y,x]of Object.entries(s))m.has(y)?f.set(m.get(y).toString(),x):console.warn(`Ignoring unknown image variable "${y}"`);return f}}function sv(u,s=255,l){const f=s/255,m=u.toString(),y=l.has(m)?l.get(m).clone():u.clone();return y.a*=f,y.toString()}function c1(u,s){if(!Uo()){const l=document.createElement("canvas");return l.width=u,l.height=s,l}return new OffscreenCanvas(u,s)}function Nse(u,s){const l=jse.calculate(s.params,u.metadata?u.metadata.variables:[]),f=u.usvg_tree,m=f.width,y=f.height,x=s.transform?s.transform:new DOMMatrix,b=Math.max(1,Math.round(m*x.a)),j=Math.max(1,Math.round(y*x.d)),N=new DOMMatrix([b/m,0,0,j/y,0,0]),k=c1(b,j).getContext("2d");return Sk(k,N,f,f,l),k.getImageData(0,0,b,j)}function Sk(u,s,l,f,m){for(const y of f.children)SB(u,s,l,y,m)}function SB(u,s,l,f,m){f.group?(u.save(),function(y,x,b,j,N){const k=j.mask_idx!=null?b.masks[j.mask_idx]:null,M=j.clip_path_idx!=null?b.clip_paths[j.clip_path_idx]:null;if(j.transform&&(x=iv(j.transform).preMultiplySelf(x)),!function(G,ee,ne){return G.opacity!==255||ee||ne}(j,M!=null,k!=null))return void Sk(y,x,b,j,N);const D=c1(y.canvas.width,y.canvas.height),q=D.getContext("2d");Sk(q,x,b,j,N),M&&AB(q,x,b,M),k&&PB(q,x,b,k,N),y.globalAlpha=j.opacity/255,y.drawImage(D,0,0)}(u,s,l,f.group,m),u.restore()):f.path&&(u.save(),function(y,x,b,j,N){y.setTransform(x),j.paint_order===lse.PAINT_ORDER_FILL_AND_STROKE?(EB(y,b,j,N),jB(y,b,j,N)):(jB(y,b,j,N),EB(y,b,j,N))}(u,s,l,f.path,m),u.restore())}function EB(u,s,l,f){const m=l.fill;if(!m)return;const y=m.opacity/255;switch(u.save(),u.beginPath(),kB(l,u),m.paint){case"rgb_color":u.fillStyle=sv(m.rgb_color,m.opacity,f);break;case"linear_gradient_idx":{const x=s.linear_gradients[m.linear_gradient_idx];x.transform&&u.setTransform(iv(x.transform).preMultiplySelf(u.getTransform())),u.fillStyle=NB(u,x,y,f);break}case"radial_gradient_idx":{const x=s.radial_gradients[m.radial_gradient_idx];x.transform&&u.setTransform(iv(x.transform).preMultiplySelf(u.getTransform())),u.fillStyle=IB(u,x,y,f)}}u.fill(TB(l)),u.restore()}function TB(u){return u.rule===wk.PATH_RULE_NON_ZERO?"nonzero":u.rule===wk.PATH_RULE_EVEN_ODD?"evenodd":void 0}function jB(u,s,l,f){const m=l.stroke;if(!m)return;const y=RB(l);u.lineWidth=m.width,u.miterLimit=m.miterlimit,u.setLineDash(m.dasharray),u.lineDashOffset=m.dashoffset;const x=m.opacity/255;switch(m.paint){case"rgb_color":u.strokeStyle=sv(m.rgb_color,m.opacity,f);break;case"linear_gradient_idx":u.strokeStyle=NB(u,s.linear_gradients[m.linear_gradient_idx],x,f,!0);break;case"radial_gradient_idx":u.strokeStyle=IB(u,s.radial_gradients[m.radial_gradient_idx],x,f,!0)}switch(m.linejoin){case O2.LINE_JOIN_MITER_CLIP:case O2.LINE_JOIN_MITER:u.lineJoin="miter";break;case O2.LINE_JOIN_ROUND:u.lineJoin="round";break;case O2.LINE_JOIN_BEVEL:u.lineJoin="bevel"}switch(m.linecap){case bk.LINE_CAP_BUTT:u.lineCap="butt";break;case bk.LINE_CAP_ROUND:u.lineCap="round";break;case bk.LINE_CAP_SQUARE:u.lineCap="square"}u.stroke(y)}function NB(u,s,l,f,m=!1){if(s.stops.length===1){const D=s.stops[0];return sv(D.rgb_color,D.opacity*l,f)}const{x1:y,y1:x,x2:b,y2:j}=s;let N=new DOMPoint(y,x),k=new DOMPoint(b,j);if(m){const D=iv(s.transform);N=D.transformPoint(N),k=D.transformPoint(k)}const M=u.createLinearGradient(N.x,N.y,k.x,k.y);for(const D of s.stops)M.addColorStop(D.offset,sv(D.rgb_color,D.opacity*l,f));return M}function IB(u,s,l,f,m=!1){if(s.stops.length===1){const ie=s.stops[0];return sv(ie.rgb_color,ie.opacity*l,f)}const y=iv(s.transform),{fx:x,fy:b,fr:j,cx:N,cy:k,r:M}=s;let D=new DOMPoint(x,b),q=new DOMPoint(N,k),G=j,ee=M;if(m){D=y.transformPoint(D),q=y.transformPoint(q);const ie=(y.a+y.d)/2;G=j*ie,ee=s.r*ie}const ne=u.createRadialGradient(D.x,D.y,G,q.x,q.y,ee);for(const ie of s.stops)ne.addColorStop(ie.offset,sv(ie.rgb_color,ie.opacity*l,f));return ne}function CB(u,s,l,f){const m=f.transform?iv(f.transform).preMultiplySelf(s):s,y=c1(u.canvas.width,u.canvas.height),x=y.getContext("2d");for(const j of f.children)if(j.group)CB(x,m,l,j.group);else if(j.path){const N=j.path,k=new Path2D;k.addPath(RB(N),m),x.fill(k,TB(N))}const b=f.clip_path_idx!=null?l.clip_paths[f.clip_path_idx]:null;b&&AB(x,m,l,b),u.globalCompositeOperation="source-over",u.drawImage(y,0,0)}function AB(u,s,l,f){const m=c1(u.canvas.width,u.canvas.height);CB(m.getContext("2d"),s,l,f),u.globalCompositeOperation="destination-in",u.drawImage(m,0,0)}function PB(u,s,l,f,m){if(f.children.length===0)return;const y=f.mask_idx!=null?l.masks[f.mask_idx]:null;y&&PB(u,s,l,y,m);const x=u.canvas.width,b=u.canvas.height,j=c1(x,b),N=j.getContext("2d"),k=f.width,M=f.height,D=f.left,q=f.top,G=new Path2D,ee=new Path2D;ee.rect(D,q,k,M),G.addPath(ee,s),N.clip(G);for(const me of f.children)SB(N,s,l,me,m);const ne=N.getImageData(0,0,x,b),ie=ne.data;if(f.mask_type===xB.MASK_TYPE_LUMINANCE)for(let me=0;me<ie.length;me+=4)ie[me+3]=ie[me+3]/255*(.2126*ie[me]+.7152*ie[me+1]+.0722*ie[me+2]);N.putImageData(ne,0,0),u.globalCompositeOperation="destination-in",u.drawImage(j,0,0)}function iv(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function kB(u,s){const l=u.step;let f=u.diffs[0]*l,m=u.diffs[1]*l;s.moveTo(f,m);for(let y=0,x=2;y<u.commands.length;y++)switch(u.commands[y]){case l1.PATH_COMMAND_MOVE:f+=u.diffs[x++]*l,m+=u.diffs[x++]*l,s.moveTo(f,m);break;case l1.PATH_COMMAND_LINE:f+=u.diffs[x++]*l,m+=u.diffs[x++]*l,s.lineTo(f,m);break;case l1.PATH_COMMAND_QUAD:{const b=f+u.diffs[x++]*l,j=m+u.diffs[x++]*l;f=b+u.diffs[x++]*l,m=j+u.diffs[x++]*l,s.quadraticCurveTo(b,j,f,m);break}case l1.PATH_COMMAND_CUBIC:{const b=f+u.diffs[x++]*l,j=m+u.diffs[x++]*l,N=b+u.diffs[x++]*l,k=j+u.diffs[x++]*l;f=N+u.diffs[x++]*l,m=k+u.diffs[x++]*l,s.bezierCurveTo(b,j,N,k,f,m);break}case l1.PATH_COMMAND_CLOSE:s.closePath()}return s}function RB(u){return kB(u,new Path2D)}class B2{constructor(s){this.capacity=s,this.cache=new Map}get(s){if(!this.cache.has(s))return;const l=this.cache.get(s);return this.cache.delete(s),this.cache.set(s,l),l}put(s,l){this.cache.has(s)?this.cache.delete(s):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(s,l)}delete(s){this.cache.delete(s)}}hr(B2,"LRUCache");class Ek{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(s){return new Io(s,s.data)}getFromCache(s,l,f){return this.cacheMap.has(f)||this.cacheMap.set(f,new B2(150)),this.cacheMap.get(f).get(Rf(s.toString(),l))}setInCache(s,l,f,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new B2(150));const y=this.cacheDependenciesMap.get(m),x=Rf(s.id.toString(),f);y.get(x)||y.set(x,new Set);const b=this.cacheMap.get(m),j=s.toString();y.get(x).add(j),b.put(Rf(s.toString(),f),l)}removeImagesFromCacheByIds(s,l,f=0){if(!this.cacheMap.has(f)||!this.cacheDependenciesMap.has(f))return;const m=this.cacheMap.get(f),y=this.cacheDependenciesMap.get(f);for(const x of s){const b=Rf(x.toString(),l);if(y.has(b)){for(const j of y.get(b))m.delete(j);y.delete(b)}}}rasterize(s,l,f,m,y=Nse){const x=this.getFromCache(s,f,m);if(x)return x.clone();const b=y(l.icon,s.options),j=Ek._getImage(b);return this.setInCache(s,j,f,m),j.clone()}}class MB{constructor(s){this.size=s,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(s,l){const f=this.toIdx(s,l);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(s,l){return this.leaves[this.toIdx(s,l)]}toIdx(s,l){return l*this.size+s}}function DB(u,s,l,f){let m=0,y=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(f[x])<1e-15){if(l[x]<u[x]||l[x]>s[x])return null}else{const b=1/f[x];let j=(u[x]-l[x])*b,N=(s[x]-l[x])*b;if(j>N){const k=j;j=N,N=k}if(j>m&&(m=j),N<y&&(y=N),m>y)return null}return m}function OB(u,s,l,f,m,y,x,b,j,N,k){const M=f-u,D=m-s,q=y-l,G=x-u,ee=b-s,ne=j-l,ie=k[1]*ne-k[2]*ee,me=k[2]*G-k[0]*ne,ye=k[0]*ee-k[1]*G,be=M*ie+D*me+q*ye;if(Math.abs(be)<1e-15)return null;const Me=1/be,Ce=N[0]-u,Le=N[1]-s,Ve=N[2]-l,He=(Ce*ie+Le*me+Ve*ye)*Me;if(He<0||He>1)return null;const mt=Le*q-Ve*D,rt=Ve*M-Ce*q,gt=Ce*D-Le*M,bt=(k[0]*mt+k[1]*rt+k[2]*gt)*Me;return bt<0||He+bt>1?null:(G*mt+ee*rt+ne*gt)*Me}function LB(u,s,l){return(u-s)/(l-s)}function FB(u,s,l,f,m,y,x,b,j){const N=1<<l,k=y-f,M=x-m,D=(u+1)/N*k+f,q=(s+0)/N*M+m,G=(s+1)/N*M+m;b[0]=(u+0)/N*k+f,b[1]=q,j[0]=D,j[1]=G}class zB{constructor(s){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=s,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(y){const x=Math.ceil(Math.log2(y.dim/8)),b=[];let j=Math.ceil(Math.pow(2,x));const N=1/j,k=(q,G,ee,ne,ie)=>{const me=ne?1:0,ye=(q+1)*ee-me,be=G*ee,Me=(G+1)*ee-me;ie[0]=q*ee,ie[1]=be,ie[2]=ye,ie[3]=Me};let M=new MB(j);const D=[];for(let q=0;q<j*j;q++){k(q%j,Math.floor(q/j),N,!1,D);const G=vm(D[0],D[1],y),ee=vm(D[2],D[1],y),ne=vm(D[2],D[3],y),ie=vm(D[0],D[3],y);M.minimums.push(Math.min(G,ee,ne,ie)),M.maximums.push(Math.max(G,ee,ne,ie)),M.leaves.push(1)}for(b.push(M),j/=2;j>=1;j/=2){const q=b[b.length-1];M=new MB(j);for(let G=0;G<j*j;G++){k(G%j,Math.floor(G/j),2,!0,D);const ee=q.getElevation(D[0],D[1]),ne=q.getElevation(D[2],D[1]),ie=q.getElevation(D[2],D[3]),me=q.getElevation(D[0],D[3]),ye=q.isLeaf(D[0],D[1]),be=q.isLeaf(D[2],D[1]),Me=q.isLeaf(D[2],D[3]),Ce=q.isLeaf(D[0],D[3]),Le=Math.min(ee.min,ne.min,ie.min,me.min),Ve=Math.max(ee.max,ne.max,ie.max,me.max),He=ye&&be&&Me&&Ce;M.maximums.push(Ve),M.minimums.push(Le),M.leaves.push(Ve-Le<=5&&He?1:0)}b.push(M)}return b}(this.dem),f=l.length-1,m=l[f];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(l,0,0,f,0)}raycastRoot(s,l,f,m,y,x,b=1){return DB([s,l,-100],[f,m,this.maximums[0]*b],y,x)}raycast(s,l,f,m,y,x,b=1){if(!this.nodeCount)return null;const j=this.raycastRoot(s,l,f,m,y,x,b);if(j==null)return null;const N=[],k=[],M=[],D=[],q=[{idx:0,t:j,nodex:0,nodey:0,depth:0}];for(;q.length>0;){const{idx:G,t:ee,nodex:ne,nodey:ie,depth:me}=q.pop();if(this.leaves[G]){FB(ne,ie,me,s,l,f,m,M,D);const be=1<<me,Me=(ne+0)/be,Ce=(ne+1)/be,Le=(ie+0)/be,Ve=(ie+1)/be,He=vm(Me,Le,this.dem)*b,mt=vm(Ce,Le,this.dem)*b,rt=vm(Ce,Ve,this.dem)*b,gt=vm(Me,Ve,this.dem)*b,bt=OB(M[0],M[1],He,D[0],M[1],mt,D[0],D[1],rt,y,x),Ct=OB(D[0],D[1],rt,M[0],D[1],gt,M[0],M[1],He,y,x),Gt=Math.min(bt!==null?bt:Number.MAX_VALUE,Ct!==null?Ct:Number.MAX_VALUE);if(Gt!==Number.MAX_VALUE)return Gt;{const Ot=Xt([],y,x,ee);if(BB(He,mt,gt,rt,LB(Ot[0],M[0],D[0]),LB(Ot[1],M[1],D[1]))>=Ot[2])return ee}continue}let ye=0;for(let be=0;be<this._siblingOffset.length;be++){FB((ne<<1)+this._siblingOffset[be][0],(ie<<1)+this._siblingOffset[be][1],me+1,s,l,f,m,M,D),M[2]=-100,D[2]=this.maximums[this.childOffsets[G]+be]*b;const Me=DB(M,D,y,x);if(Me!=null){const Ce=Me;N[be]=Ce;let Le=!1;for(let Ve=0;Ve<ye&&!Le;Ve++)Ce>=N[k[Ve]]&&(k.splice(Ve,0,be),Le=!0);Le||(k[ye]=be),ye++}}for(let be=0;be<ye;be++){const Me=k[be];q.push({idx:this.childOffsets[G]+Me,t:N[Me],nodex:(ne<<1)+this._siblingOffset[Me][0],nodey:(ie<<1)+this._siblingOffset[Me][1],depth:me+1})}}return null}_addNode(s,l,f){return this.minimums.push(s),this.maximums.push(l),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(s,l,f,m,y){if(s[m].isLeaf(l,f)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const x=m-1,b=s[x];let j=0,N=0;for(let k=0;k<this._siblingOffset.length;k++){const M=2*l+this._siblingOffset[k][0],D=2*f+this._siblingOffset[k][1],q=b.getElevation(M,D),G=b.isLeaf(M,D),ee=this._addNode(q.min,q.max,G);G&&(j|=1<<k),N||(N=ee)}for(let k=0;k<this._siblingOffset.length;k++)j&1<<k||this._construct(s,2*l+this._siblingOffset[k][0],2*f+this._siblingOffset[k][1],x,N+k)}}function BB(u,s,l,f,m,y){return Ur(Ur(u,l,y),Ur(s,f,y),m)}function vm(u,s,l){const f=l.dim,m=he(u*f-.5,0,f-1),y=he(s*f-.5,0,f-1),x=Math.floor(m),b=Math.floor(y),j=Math.min(x+1,f-1),N=Math.min(b+1,f-1);return BB(l.get(x,b),l.get(j,b),l.get(x,N),l.get(j,N),m-x,y-b)}const Ise={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Cse(u,s,l){return(256*u*256+256*s+l)/10-1e4}function Ase(u,s,l){return 256*u+s+l/256-32768}class V2{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(s,l,f,m=!1){if(this.uid=s,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void Ar(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const y=this.dim=l.height-2,x=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let j=0;j<y;j++)x[this._idx(-1,j)]=x[this._idx(0,j)],x[this._idx(y,j)]=x[this._idx(y-1,j)],x[this._idx(j,-1)]=x[this._idx(j,0)],x[this._idx(j,y)]=x[this._idx(j,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)]}const b=f==="terrarium"?Ase:Cse;for(let j=0;j<x.length;++j){const N=4*j;this.floatView[j]=b(this.pixels[N],this.pixels[N+1],this.pixels[N+2])}this._timestamp=Bs.now()}_buildQuadTree(){this._tree=new zB(this)}get(s,l,f=!1){f&&(s=he(s,-1,this.dim),l=he(l,-1,this.dim));const m=this._idx(s,l);return this.floatView[m]}set(s,l,f){const m=this._idx(s,l),y=this.floatView[m];return this.floatView[m]=f,f-y}static getUnpackVector(s){return Ise[s]}_idx(s,l){if(s<-1||s>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(s+1)}static pack(s,l){const f=[0,0,0,0],m=V2.getUnpackVector(l);let y=Math.floor((s+m[3])/m[2]);return f[2]=y%256,y=Math.floor(y/256),f[1]=y%256,y=Math.floor(y/256),f[0]=y,f}getPixels(){return new RF({width:this.stride,height:this.stride},this.pixels)}backfillBorder(s,l,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,y=l*this.dim+this.dim,x=f*this.dim,b=f*this.dim+this.dim;switch(l){case-1:m=y-1;break;case 1:y=m+1}switch(f){case-1:x=b-1;break;case 1:b=x+1}const j=-l*this.dim,N=-f*this.dim;for(let k=x;k<b;k++)for(let M=m;M<y;M++){const D=4*this._idx(M,k),q=4*this._idx(M+j,k+N);this.pixels[D+0]=s.pixels[q+0],this.pixels[D+1]=s.pixels[q+1],this.pixels[D+2]=s.pixels[q+2],this.pixels[D+3]=s.pixels[q+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Pse(u,s,l){u===1?s.headerLength=l.readFixed32():u===2?s.x=l.readVarint():u===3?s.y=l.readVarint():u===4?s.z=l.readVarint():u===5&&s.layers.push(function(f,m){return f.readFields(Ose,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(l,l.readVarint()+l.pos))}function kse(u,s,l){u===1?(s.delta_filter=function(f,m){return f.readFields(Rse,{blockSize:0},m)}(l,l.readVarint()+l.pos),s.filter="delta_filter"):u===2?(l.readVarint(),s.filter="zigzag_filter"):u===3?(l.readVarint(),s.filter="bitshuffle_filter"):u===4&&(l.readVarint(),s.filter="byteshuffle_filter")}function Rse(u,s,l){u===1&&(s.blockSize=l.readVarint())}function Mse(u,s,l){u===1?(l.readVarint(),s.codec="gzip_data"):u===2?(l.readVarint(),s.codec="jpeg_image"):u===3?(l.readVarint(),s.codec="webp_image"):u===4&&(l.readVarint(),s.codec="png_image")}function Dse(u,s,l){let f=0,m=0;u===1?s.firstByte=l.readFixed64():u===2?s.lastByte=l.readFixed64():u===3?s.filters.push(function(y,x){return y.readFields(kse,{},x)}(l,l.readVarint()+l.pos)):u===4?s.codec=function(y,x){return y.readFields(Mse,{},x)}(l,l.readVarint()+l.pos):u===5?m=l.readFloat():u===6?f=l.readFloat():u===7?s.bands.push(l.readString()):u===8?s.offset=l.readDouble():u===9&&(s.scale=l.readDouble()),s.offset===0&&(s.offset=m),s.scale===0&&(s.scale=f)}function Ose(u,s,l){u===1?s.version=l.readVarint():u===2?s.name=l.readString():u===3?s.units=l.readString():u===4?s.tileSize=l.readVarint():u===5?s.buffer=l.readVarint():u===6?s.pixelFormat=l.readVarint():u===7&&s.dataIndex.push(function(f,m){return f.readFields(Dse,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(l,l.readVarint()+l.pos))}function Lse(u,s,l){if(u===2)(function(f,m,y){f.readFields(Fse,y,m)})(l,l.readVarint()+l.pos,s);else if(u===3)throw new Error("Not implemented")}function Fse(u,s,l){if(u===1){let f=0;const m=l.readVarint()+l.pos;for(;l.pos<m;)s[f++]=l.readVarint()}}function zse(u,s){if(s.length!==4)throw new Error(`Expected data of dimension 4 but got ${s.length}.`);let l=s[3];for(let f=2;f>=1;f--){const m=f===1?1:0,y=f===2?1:0;for(let x=0;x<s[0];x++){const b=s[1]*x;for(let j=m;j<s[1];j++){const N=s[2]*(j+b);for(let k=y;k<s[2];k++){const M=s[3]*(k+N);for(let D=0;D<s[3];D++){const q=M+D;u[q]+=u[q-l]}}}}l*=s[f]}return u}function Bse(u){for(let s=0,l=u.length;s<l;s++)u[s]=u[s]>>>1^-(1&u[s]);return u}function Vse(u,s){switch(s){case"uint32":return u;case"uint16":for(let l=0;l<u.length;l+=2){const f=u[l],m=u[l+1];u[l]=(240&f)>>4|(61440&f)>>8|(240&m)<<4|61440&m,u[l+1]=15&f|(3840&f)>>4|(15&m)<<8|(3840&m)<<4}return u;case"uint8":for(let l=0;l<u.length;l+=4){const f=u[l],m=u[l+1],y=u[l+2],x=u[l+3];u[l+0]=(192&f)>>6|(192&m)>>4|(192&y)>>2|192&x,u[l+1]=(48&f)>>4|(48&m)>>2|48&y|(48&x)<<2,u[l+2]=(12&f)>>2|12&m|(12&y)<<2|(12&x)<<4,u[l+3]=3&f|(3&m)<<2|(3&y)<<4|(3&x)<<6}return u;default:throw new Error(`Invalid pixel format, "${s}"`)}}hr(V2,"DEMData"),hr(zB,"DemMinMaxQuadTree",{omit:["dem"]});var vu=Uint8Array,u1=Uint16Array,Use=Int32Array,VB=new vu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),UB=new vu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$se=new vu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$B=function(u,s){for(var l=new u1(31),f=0;f<31;++f)l[f]=s+=1<<u[f-1];var m=new Use(l[30]);for(f=1;f<30;++f)for(var y=l[f];y<l[f+1];++y)m[y]=y-l[f]<<5|f;return{b:l,r:m}},qB=$B(VB,2),GB=qB.b,qse=qB.r;GB[28]=258,qse[258]=28;for(var Gse=$B(UB,0).b,HB=new u1(32768),ja=0;ja<32768;++ja){var av=(43690&ja)>>1|(21845&ja)<<1;HB[ja]=((65280&(av=(61680&(av=(52428&av)>>2|(13107&av)<<2))>>4|(3855&av)<<4))>>8|(255&av)<<8)>>1}var d1=function(u,s,l){for(var f=u.length,m=0,y=new u1(s);m<f;++m)u[m]&&++y[u[m]-1];var x,b=new u1(s);for(m=1;m<s;++m)b[m]=b[m-1]+y[m-1]<<1;x=new u1(1<<s);var j=15-s;for(m=0;m<f;++m)if(u[m])for(var N=m<<4|u[m],k=s-u[m],M=b[u[m]-1]++<<k,D=M|(1<<k)-1;M<=D;++M)x[HB[M]>>j]=N;return x},h1=new vu(288);for(ja=0;ja<144;++ja)h1[ja]=8;for(ja=144;ja<256;++ja)h1[ja]=9;for(ja=256;ja<280;++ja)h1[ja]=7;for(ja=280;ja<288;++ja)h1[ja]=8;var WB=new vu(32);for(ja=0;ja<32;++ja)WB[ja]=5;var Hse=d1(h1,9),Wse=d1(WB,5),Tk=function(u){for(var s=u[0],l=1;l<u.length;++l)u[l]>s&&(s=u[l]);return s},kd=function(u,s,l){var f=s/8|0;return(u[f]|u[f+1]<<8)>>(7&s)&l},jk=function(u,s){var l=s/8|0;return(u[l]|u[l+1]<<8|u[l+2]<<16)>>(7&s)},Zse=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Rd=function(u,s,l){var f=new Error(s||Zse[u]);if(f.code=u,Error.captureStackTrace&&Error.captureStackTrace(f,Rd),!l)throw f;return f},Kse=new vu(0),Xse=typeof TextDecoder<"u"&&new TextDecoder;try{Xse.decode(Kse,{stream:!0})}catch{}const Yse={gzip_data:"gzip"};class Xu extends Error{constructor(s){super(s),this.name="MRTError"}}const Jse={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ZB={uint32:1,uint16:2,uint8:4},Qse={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Nk;class U2{constructor(s=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=s}getLayer(s){const l=this.layers[s];if(!l)throw new Xu(`Layer '${s}' not found`);return l}getHeaderLength(s){const l=new Uint8Array(s),f=new DataView(s);if(l[0]!==13)throw new Xu("File is not a valid MRT.");return f.getUint32(1,!0)}parseHeader(s){const l=new Uint8Array(s),f=this.getHeaderLength(s);if(l.length<f)throw new Xu(`Expected header with length >= ${f} but got buffer of length ${l.length}`);const m=new Nk(l.subarray(0,f)).readFields(Pse,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Xu(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const y of m.layers)this.layers[y.name]=new KB(y,{cacheSize:this._cacheSize});return this}createDecodingTask(s){const l=[],f=this.getLayer(s.layerName);for(let m of s.blockIndices){const y=f.dataIndex[m],x=y.firstByte-s.firstByte,b=y.lastByte-s.firstByte;if(f._blocksInProgress.has(m))continue;const j={layerName:f.name,firstByte:x,lastByte:b,pixelFormat:f.pixelFormat,blockIndex:m,blockShape:[y.bands.length].concat(f.bandShape),buffer:f.buffer,codec:y.codec.codec,filters:y.filters.map(N=>N.filter)};f._blocksInProgress.add(m),l.push(j)}return new XB(l,()=>{l.forEach(m=>f._blocksInProgress.delete(m.blockIndex))},(m,y)=>{if(l.forEach(x=>f._blocksInProgress.delete(x.blockIndex)),m)throw m;y.forEach(x=>{this.getLayer(x.layerName).processDecodedData(x)})})}}class KB{constructor({version:s,name:l,units:f,tileSize:m,pixelFormat:y,buffer:x,dataIndex:b},j){if(this.version=s,this.version!==1)throw new Xu(`Cannot parse raster layer encoded with MRT version ${s}`);this.name=l,this.units=f,this.tileSize=m,this.buffer=x,this.pixelFormat=Jse[y],this.dataIndex=b,this.bandShape=[m+2*x,m+2*x,ZB[this.pixelFormat]],this._decodedBlocks=new B2(j?j.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return ZB[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:s})=>s).flat()}processDecodedData(s){const l=s.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,s.data)}getBlockForBand(s){let l=0;switch(typeof s){case"string":for(const[f,m]of this.dataIndex.entries()){for(const[y,x]of m.bands.entries())if(x===s)return{bandIndex:l+y,blockIndex:f,blockBandIndex:y};l+=m.bands.length}break;case"number":for(const[f,m]of this.dataIndex.entries()){if(s>=l&&s<l+m.bands.length)return{bandIndex:s,blockIndex:f,blockBandIndex:s-l};l+=m.bands.length}break;default:throw new Xu(`Invalid band \`${JSON.stringify(s)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(s){let l=1/0,f=-1/0;const m=[],y=new Set;for(const x of s){const{blockIndex:b}=this.getBlockForBand(x);if(b<0)throw new Xu(`Invalid band: ${JSON.stringify(x)}`);const j=this.dataIndex[b];m.includes(b)||m.push(b),y.add(b),l=Math.min(l,j.firstByte),f=Math.max(f,j.lastByte)}if(y.size>this.cacheSize)throw new Xu(`Number of blocks to decode (${y.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:f,blockIndices:m}}hasBand(s){const{blockIndex:l}=this.getBlockForBand(s);return l>=0}hasDataForBand(s){const{blockIndex:l}=this.getBlockForBand(s);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(s){const{blockIndex:l,blockBandIndex:f}=this.getBlockForBand(s);if(l<0)throw new Xu(`Band not found: ${JSON.stringify(s)}`);const m=this._decodedBlocks.get(l.toString());if(!m)throw new Xu(`Data for band ${JSON.stringify(s)} of layer "${this.name}" not decoded.`);const y=this.dataIndex[l],x=this.bandShape.reduce((N,k)=>N*k,1),b=f*x,j=m.subarray(b,b+x);return{data:j,bytes:new Uint8Array(j.buffer).subarray(j.byteOffset,j.byteOffset+j.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:y.offset,scale:y.scale}}}U2.setPbf=function(u){Nk=u};class XB{constructor(s,l,f){this.tasks=s,this._onCancel=l,this._onComplete=f,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(s,l){this._finalized||(this._onComplete(s,l),this._finalized=!0)}}U2.performDecoding=function(u,s){const l=new Uint8Array(u);return Promise.all(s.tasks.map(f=>{const{layerName:m,firstByte:y,lastByte:x,pixelFormat:b,blockShape:j,blockIndex:N,filters:k,codec:M}=f,D=l.subarray(y,x+1),q=new Uint32Array(j[0]*j[1]*j[2]);let G;if(M!=="gzip_data")throw new Xu(`Unhandled codec: ${M}`);return G=function(ee,ne){if(!globalThis.DecompressionStream&&ne==="gzip_data")return Promise.resolve(((be=function(Le){Le[0]==31&&Le[1]==139&&Le[2]==8||Rd(6,"invalid gzip data");var Ve=Le[3],He=10;4&Ve&&(He+=2+(Le[10]|Le[11]<<8));for(var mt=(Ve>>3&1)+(Ve>>4&1);mt>0;mt-=!Le[He++]);return He+(2&Ve)}(ye=ee))+8>ye.length&&Rd(6,"invalid gzip data"),function(Le,Ve,He,mt){var rt=Le.length;if(!rt||Ve.f&&!Ve.l)return He||new vu(0);var gt=!He,bt=gt||Ve.i!=2,Ct=Ve.i;gt&&(He=new vu(3*rt));var Gt,Ot,Et=function(ji){var ri=He.length;if(ji>ri){var Hs=new vu(Math.max(2*ri,ji));Hs.set(He),He=Hs}},Dt=Ve.f||0,ht=Ve.p||0,ut=Ve.b||0,kt=Ve.l,$t=Ve.d,It=Ve.m,ur=Ve.n,_r=8*rt;do{if(!kt){Dt=kd(Le,ht,1);var ir=kd(Le,ht+1,3);if(ht+=3,!ir){var Jt=Le[(Ae=4+((ht+7)/8|0))-4]|Le[Ae-3]<<8,Qr=Ae+Jt;if(Qr>rt){Ct&&Rd(0);break}bt&&Et(ut+Jt),He.set(Le.subarray(Ae,Qr),ut),Ve.b=ut+=Jt,Ve.p=ht=8*Qr,Ve.f=Dt;continue}if(ir==1)kt=Hse,$t=Wse,It=9,ur=5;else if(ir==2){var tr=kd(Le,ht,31)+257,Pr=kd(Le,ht+10,15)+4,an=tr+kd(Le,ht+5,31)+1;ht+=14;for(var Sn=new vu(an),Hn=new vu(19),cn=0;cn<Pr;++cn)Hn[$se[cn]]=kd(Le,ht+3*cn,7);ht+=3*Pr;var ts=Tk(Hn),rs=(1<<ts)-1,mi=d1(Hn,ts);for(cn=0;cn<an;){var Ae,je=mi[kd(Le,ht,rs)];if(ht+=15&je,(Ae=je>>4)<16)Sn[cn++]=Ae;else{var _t=0,Yt=0;for(Ae==16?(Yt=3+kd(Le,ht,3),ht+=2,_t=Sn[cn-1]):Ae==17?(Yt=3+kd(Le,ht,7),ht+=3):Ae==18&&(Yt=11+kd(Le,ht,127),ht+=7);Yt--;)Sn[cn++]=_t}}var yt=Sn.subarray(0,tr),er=Sn.subarray(tr);It=Tk(yt),ur=Tk(er),kt=d1(yt,It),$t=d1(er,ur)}else Rd(1);if(ht>_r){Ct&&Rd(0);break}}bt&&Et(ut+131072);for(var Er=(1<<It)-1,Sr=(1<<ur)-1,un=ht;;un=ht){var $r=(_t=kt[jk(Le,ht)&Er])>>4;if((ht+=15&_t)>_r){Ct&&Rd(0);break}if(_t||Rd(2),$r<256)He[ut++]=$r;else{if($r==256){un=ht,kt=null;break}var vr=$r-254;$r>264&&(vr=kd(Le,ht,(1<<(Hr=VB[cn=$r-257]))-1)+GB[cn],ht+=Hr);var Qn=$t[jk(Le,ht)&Sr],As=Qn>>4;if(Qn||Rd(3),ht+=15&Qn,er=Gse[As],As>3){var Hr=UB[As];er+=jk(Le,ht)&(1<<Hr)-1,ht+=Hr}if(ht>_r){Ct&&Rd(0);break}bt&&Et(ut+131072);var qn=ut+vr;if(ut<er){var Ps=0-er,xs=Math.min(er,qn);for(Ps+ut<0&&Rd(3);ut<xs;++ut)He[ut]=(void 0)[Ps+ut]}for(;ut<qn;++ut)He[ut]=He[ut-er]}}Ve.l=kt,Ve.p=un,Ve.b=ut,Ve.f=Dt,kt&&(Dt=1,Ve.m=It,Ve.d=$t,Ve.n=ur)}while(!Dt);return ut!=He.length&&gt?(Gt=He,((Ot=ut)==null||Ot>Gt.length)&&(Ot=Gt.length),new vu(Gt.subarray(0,Ot))):He.subarray(0,ut)}(ye.subarray(be,-8),{i:2},new vu(((ie=ye)[(me=ie.length)-4]|ie[me-3]<<8|ie[me-2]<<16|ie[me-1]<<24)>>>0))));var ie,me,ye,be;const Me=Yse[ne];if(!Me)throw new Error(`Unhandled codec: ${ne}`);const Ce=new globalThis.DecompressionStream(Me);return new Response(new Blob([ee]).stream().pipeThrough(Ce)).arrayBuffer().then(Le=>new Uint8Array(Le))}(D,M).then(ee=>(function(ne,ie){ne.readFields(Lse,ie)}(new Nk(ee),q),new Qse[b](q.buffer))),G.then(ee=>{for(let ne=k.length-1;ne>=0;ne--)switch(k[ne]){case"delta_filter":zse(ee,j);break;case"zigzag_filter":Bse(ee);break;case"bitshuffle_filter":Vse(ee,b);break;default:throw new Xu(`Unhandled filter "${k[ne]}"`)}return{layerName:m,blockIndex:N,data:ee}}).catch(ee=>{throw ee})}))},hr(XB,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),hr(U2,"MapboxRasterTile"),hr(KB,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class YB{constructor(s){this._stringToNumber={},this._numberToString=[];for(let l=0;l<s.length;l++){const f=s[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(s){return this._stringToNumber[s]}decode(s){return this._numberToString[s]}}class JB{constructor(s,l){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Pf(Zt,16,0),this.featureIndexArray=new BT,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(s,l,f,m,y,x=0,b=0){const j=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,y,x);const N=this.grid;for(let k=0;k<l.length;k++){const M=l[k],D=[1/0,1/0,-1/0,-1/0];for(let q=0;q<M.length;q++){const G=M[q];D[0]=Math.min(D[0],G.x),D[1]=Math.min(D[1],G.y),D[2]=Math.max(D[2],G.x),D[3]=Math.max(D[3],G.y)}b!==0&&(D[0]-=b,D[1]-=b,D[2]+=b,D[3]+=b),D[0]<Zt&&D[1]<Zt&&D[2]>=0&&D[3]>=0&&N.insert(j,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new yr(new y2(this.rawTileData)).layers,this.sourceLayerCoder=new YB(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const s in this.vtLayers)this.vtFeatures[s]=[]}return this.vtLayers}query(s,l){const{tilespaceGeometry:f,transform:m,tileTransform:y,pixelPosMatrix:x,availableImages:b,worldview:j}=l;this.loadVTLayers(),this.serializedLayersCache.clear();const N=l.queryRadius?l.queryRadius:0,k=f.bufferedTilespaceBounds,M=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(ee,ne,ie,me)=>Ei(f.bufferedTilespaceGeometry,ee-N,ne-N,ie+N,me+N));M.sort(eie);let D=null;m.elevation&&M.length>0&&(D=nv.create(m.elevation,this.tileID));const q={};let G;for(let ee=0;ee<M.length;ee++){const ne=M[ee];if(ne===G)continue;G=ne;const ie=this.featureIndexArray.get(ne);let me=null;this.is3DTile?this.loadMatchingModelFeature(q,ie,s,f,m,j):this.loadMatchingFeature(q,ie,s,b,j,(ye,be,Me,Ce=0)=>(me||(me=wt(ye,this.tileID.canonical,y)),be.queryIntersectsFeature(f,ye,Me,me,this.z,m,x,D,Ce)))}return q}loadMatchingFeature(s,l,f,m,y,x){const{featureIndex:b,bucketIndex:j,sourceLayerIndex:N,layoutVertexArrayOffset:k}=l,M=this.bucketLayerIDs[j],D=f.layers,q=Object.keys(D);if(q.length&&!Kr(q,M))return;const G=f.sourceCache,ee=this.sourceLayerCoder.decode(N),ne=this.vtLayers[ee].feature(b),ie=this.getId(ne,ee);for(let me=0;me<M.length;me++){const ye=M[me];if(!D[ye])continue;const{styleLayer:be,targets:Me}=D[ye];let Ce={};ie!==void 0&&(Ce=G.getFeatureState(be.sourceLayer,ie));const Le=!x||x(ne,be,Ce,k);if(!Le)continue;const Ve=new w_(ne,this.z,this.x,this.y,ie);Ve.tile=this.tileID.canonical,Ve.state=Ce;let He=this.serializedLayersCache.get(ye);He||(He=be.serialize(),He.id=ye,this.serializedLayersCache.set(ye,He)),Ve.source=He.source,Ve.sourceLayer=He["source-layer"],Ve.layer=Object.assign({},He),Ve.layer.paint=QB(He.paint,be.paint,ne,Ce,m),Ve.layer.layout=QB(He.layout,be.layout,ne,Ce,m);let mt=!1;for(const rt of Me){this.updateFeatureProperties(Ve,rt);const{filter:gt}=rt;if(gt){if(ne.properties=Ve.properties,gt.needGeometry){const bt=lt(ne,!0);if(!gt.filter(new Xs(this.tileID.overscaledZ,{worldview:y}),bt,this.tileID.canonical))continue}else if(!gt.filter(new Xs(this.tileID.overscaledZ,{worldview:y}),ne))continue}mt=!0,rt.targetId&&this.addFeatureVariant(Ve,rt)}mt&&this.appendToResult(s,ye,b,Ve,Le)}}loadMatchingModelFeature(s,l,f,m,y,x){const{featureIndex:b,bucketIndex:j}=l,N=this.bucketLayerIDs[j],k=f.layers,M=Object.keys(k);if(!M.length||Kr(M,N))for(let D=0;D<N.length;D++){const q=N[D],{styleLayer:G,targets:ee}=k[q];if(G.type!=="model")continue;const ne=m.tile,ie=ne.getBucket(G);if(!(ie&&ie instanceof D2))continue;const me=ase(ie,b,m,y);if(!me)continue;const{z:ye,x:be,y:Me}=ne.tileID.canonical,{feature:Ce,intersectionZ:Le,position:Ve}=me;let He={};Ce.id!==void 0&&(He=f.sourceCache.getFeatureState(G.sourceLayer,Ce.id));const mt=new w_({},ye,be,Me,Ce.id);mt.tile=this.tileID.canonical,mt.state=He,mt.properties=Ce.properties,mt.geometry={type:"Point",coordinates:[Ve.lng,Ve.lat]};let rt=this.serializedLayersCache.get(q);rt||(rt=G.serialize(),rt.id=q,this.serializedLayersCache.set(q,rt)),mt.source=rt.source,mt.sourceLayer=rt["source-layer"],mt.layer=Object.assign({},rt);let gt=!1;for(const bt of ee){this.updateFeatureProperties(mt,bt);const{filter:Ct}=bt;if(Ct){if(Ce.properties=mt.properties,Ct.needGeometry){if(!Ct.filter(new Xs(this.tileID.overscaledZ,{worldview:x}),Ce,this.tileID.canonical))continue}else if(!Ct.filter(new Xs(this.tileID.overscaledZ,{worldview:x}),Ce))continue}gt=!0,bt.targetId&&this.addFeatureVariant(mt,bt)}gt&&this.appendToResult(s,q,b,mt,Le)}}updateFeatureProperties(s,l,f){if(l.properties){const m={};for(const y in l.properties){const x=l.properties[y].evaluate({zoom:this.z},s._vectorTileFeature,s.state,s.tile,f);x!=null&&(m[y]=x)}s.properties=m}}addFeatureVariant(s,l,f){const m={target:l.target,namespace:l.namespace,uniqueFeatureID:l.uniqueFeatureID};l.properties&&(m.properties=s.properties),s.variants=s.variants||{},s.variants[l.targetId]=s.variants[l.targetId]||[],s.variants[l.targetId].push(m)}appendToResult(s,l,f,m,y){let x=s[l];x===void 0&&(x=s[l]=[]),x.push({featureIndex:f,feature:m,intersectionZ:y})}lookupSymbolFeatures(s,l,f,m,y,x){const b={};this.loadVTLayers();for(const j of s)this.loadMatchingFeature(b,{bucketIndex:l,sourceLayerIndex:f,featureIndex:j,layoutVertexArrayOffset:0},m,y,x);return b}loadFeature(s){const{featureIndex:l,sourceLayerIndex:f}=s;this.loadVTLayers();const m=this.sourceLayerCoder.decode(f),y=this.vtFeatures[m];if(y[l])return y[l];const x=this.vtLayers[m].feature(l);return y[l]=x,x}hasLayer(s){for(const l of this.bucketLayerIDs)for(const f of l)if(s===f)return!0;return!1}getId(s,l){let f=s.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[l];if(m!=null)if(Array.isArray(m)){if(!this.promoteIdExpression){const y=Wu(m);if(y.result!=="success"){const x=y.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void Ar(`Failed to create expression for promoteId: ${x}`)}this.promoteIdExpression=y.value}f=this.promoteIdExpression.evaluate({zoom:0},s)}else f=s.properties[m];typeof f=="boolean"&&(f=Number(f))}return f}}function QB(u,s,l,f,m){return zt(u,(y,x)=>{const b=s instanceof kf?s.get(x):null;return b&&b.evaluate?b.evaluate(l,f,void 0,m):b})}function eie(u,s){return s-u}hr(JB,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const eV=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ik{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,f]=new Uint8Array(s,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=f>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const y=eV[15&f];if(!y)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(s,2,1),[b]=new Uint32Array(s,4,1);return new Ik(b,x,y,s)}constructor(s,l=64,f=Float64Array,m){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=f,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const y=eV.indexOf(this.ArrayType),x=2*s*this.ArrayType.BYTES_PER_ELEMENT,b=s*this.IndexArrayType.BYTES_PER_ELEMENT,j=(8-b%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${f}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+b+j,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+x+b+j),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+b+j,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=s)}add(s,l){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=s,this.coords[this._pos++]=l,f}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return Ck(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,l,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:x,nodeSize:b}=this,j=[0,y.length-1,0],N=[];for(;j.length;){const k=j.pop()||0,M=j.pop()||0,D=j.pop()||0;if(M-D<=b){for(let ne=D;ne<=M;ne++){const ie=x[2*ne],me=x[2*ne+1];ie>=s&&ie<=f&&me>=l&&me<=m&&N.push(y[ne])}continue}const q=D+M>>1,G=x[2*q],ee=x[2*q+1];G>=s&&G<=f&&ee>=l&&ee<=m&&N.push(y[q]),(k===0?s<=G:l<=ee)&&(j.push(D),j.push(q-1),j.push(1-k)),(k===0?f>=G:m>=ee)&&(j.push(q+1),j.push(M),j.push(1-k))}return N}within(s,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:x}=this,b=[0,m.length-1,0],j=[],N=f*f;for(;b.length;){const k=b.pop()||0,M=b.pop()||0,D=b.pop()||0;if(M-D<=x){for(let ne=D;ne<=M;ne++)rV(y[2*ne],y[2*ne+1],s,l)<=N&&j.push(m[ne]);continue}const q=D+M>>1,G=y[2*q],ee=y[2*q+1];rV(G,ee,s,l)<=N&&j.push(m[q]),(k===0?s-f<=G:l-f<=ee)&&(b.push(D),b.push(q-1),b.push(1-k)),(k===0?s+f>=G:l+f>=ee)&&(b.push(q+1),b.push(M),b.push(1-k))}return j}}function Ck(u,s,l,f,m,y){if(m-f<=l)return;const x=f+m>>1;tV(u,s,x,f,m,y),Ck(u,s,l,f,x-1,1-y),Ck(u,s,l,x+1,m,1-y)}function tV(u,s,l,f,m,y){for(;m>f;){if(m-f>600){const N=m-f+1,k=l-f+1,M=Math.log(N),D=.5*Math.exp(2*M/3),q=.5*Math.sqrt(M*D*(N-D)/N)*(k-N/2<0?-1:1);tV(u,s,l,Math.max(f,Math.floor(l-k*D/N+q)),Math.min(m,Math.floor(l+(N-k)*D/N+q)),y)}const x=s[2*l+y];let b=f,j=m;for(f1(u,s,f,l),s[2*m+y]>x&&f1(u,s,f,m);b<j;){for(f1(u,s,b,j),b++,j--;s[2*b+y]<x;)b++;for(;s[2*j+y]>x;)j--}s[2*f+y]===x?f1(u,s,f,j):(j++,f1(u,s,j,m)),j<=l&&(f=j+1),l<=j&&(m=j-1)}}function f1(u,s,l,f){Ak(u,l,f),Ak(s,2*l,2*f),Ak(s,2*l+1,2*f+1)}function Ak(u,s,l){const f=u[s];u[s]=u[l],u[l]=f}function rV(u,s,l,f){const m=u-l,y=s-f;return m*m+y*y}a.$=qy,a.A=Ji,a.B=Rf,a.C=2,a.D=qx,a.E=Oc,a.F=Kb,a.G=I5,a.H=$y,a.I=Yi,a.J=ab,a.K=Lp,a.L=$g,a.M=px,a.N=fx,a.O=Ww,a.P=Rt,a.Q=yx,a.R=tl,a.S=tm,a.T=BP,a.U=Wu,a.V=M2,a.W=Kw,a.X=Gp,a.Y=qp,a.Z=Kg,a._=Go,a.a=function(u){return Ks.API_CDN_URL_REGEX.test(u)},a.a$=im,a.a0=Xr,a.a1=xh,a.a2=rm,a.a3=class extends M2{},a.a4=mx,a.a5=Hw,a.a6=tt,a.a7=function(u){const s=u.value;return s?Xr(s)?gk(s,!0)?[]:[new M2(u.key,s,`invalid url "${s}"`)]:[new M2(u.key,s,`string expected, "${Lp(s)}" found`)]:[]},a.a8=CT,a.a9=Pi,a.aA=he,a.aB=$,a.aC=sn,a.aD=xl,a.aE=Ua,a.aF=fe,a.aG=pt,a.aH=function(u,s){const l={};for(let f=0;f<s.length;f++){const m=s[f];m in u&&(l[m]=u[m])}return l},a.aI=U,a.aJ=de,a.aK=class{constructor(u){this.entries={},this.scheduler=u}request(u,s,l,f){const m=this.entries[u]=this.entries[u]||{callbacks:[]};if(m.result){const[y,x]=m.result;return this.scheduler?this.scheduler.add(()=>{f(y,x)},s):f(y,x),()=>{}}return m.callbacks.push(f),m.cancel||(m.cancel=l((y,x)=>{m.result=[y,x];for(const b of m.callbacks)this.scheduler?this.scheduler.add(()=>{b(y,x)},s):b(y,x);setTimeout(()=>delete this.entries[u],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(y=>y!==f),m.callbacks.length||(m.cancel(),delete this.entries[u]))}}},a.aL=function(u,s,l){const f=JSON.stringify(u.request);return u.data&&(this.deduped.entries[f]={result:[null,u.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},m=>{const y=mu(u.request,(x,b,j)=>{x?m(x):b&&m(null,{vectorTile:l?void 0:new yr(new y2(b)),rawData:b,responseHeaders:new Map(j.entries())})});return()=>{y.cancel(),m()}},s)},a.aM=function(u){return u?{cacheControl:u.get("Cache-Control"),expires:u.get("Expires")}:{cacheControl:void 0,expires:void 0}},a.aN=function(u){ec++,ec>Eo&&(u.getActor().send("enforceCacheSizeLimit",yf),ec=0)},a.aO=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log2(u)))},a.aP=Oa,a.aQ=nB,a.aR=cB,a.aS=H,a.aT=rB,a.aU=function(u,s){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){s(null,l)};for(let f=0;f<u.length;f++){const m=document.createElement("source");Xn(u[f])||(l.crossOrigin="Anonymous"),m.src=u[f],l.appendChild(m)}return{cancel:()=>{}}},a.aV=qb,a.aW=b_,a.aX=at,a.aY=Qb,a.aZ=Ee,a.a_=xe,a.aa=Vt,a.ab=class{constructor(u){this.specification=u}possiblyEvaluate(u,s){return Kn(u.expression.evaluate(s))}interpolate(u,s,l){return{x:Ur(u.x,s.x,l),y:Ur(u.y,s.y,l),z:Ur(u.z,s.z,l),azimuthal:Ur(u.azimuthal,s.azimuthal,l),polar:Ur(u.polar,s.polar,l)}}},a.ac=Xs,a.ad=Nh,a.ae=et,a.af=ln,a.ag=Ze,a.ah=Ne,a.ai=kf,a.aj=mm,a.ak=Ur,a.al=Zt,a.am=yd,a.an=Nn,a.ao=os,a.ap=class{constructor(u){this.specification=u}possiblyEvaluate(u,s){return function([l,f]){const m=Kn([1,l,f]);return{x:m.x,y:m.y,z:m.z}}(u.expression.evaluate(s))}interpolate(u,s,l){return{x:Ur(u.x,s.x,l),y:Ur(u.y,s.y,l),z:Ur(u.z,s.z,l)}}},a.aq=function(u,s,l=0,f=!0){const m=new Rt(l,l),y=u.sub(m),x=s.add(m),b=[y,new Rt(x.x,y.y),x,new Rt(y.x,x.y)];return f&&b.push(y.clone()),b},a.ar=function(u,s){const l=[];for(let f=0;f<u.length;f++){const m=ze(f-1,-1,u.length-1),y=ze(f+1,-1,u.length-1),x=u[f],b=u[y],j=u[m].sub(x).unit(),N=b.sub(x).unit(),k=N.angleWithSep(j.x,j.y),M=j.add(N).unit().mult(-1*s/Math.sin(k/2));l.push(x.add(M))}return l},a.as=V5,a.at=Ei,a.au=function(u,s,l=0){return Xe(((s.x-l)*u.scale-u.x)*Zt,(s.y*u.scale-u.y)*Zt,Re(s.z,s.y))},a.av=Je,a.aw=jr,a.ax=pn,a.ay=t5,a.az=function(u){let s=1/0,l=1/0,f=-1/0,m=-1/0;for(const y of u)s=Math.min(s,y.x),l=Math.min(l,y.y),f=Math.max(f,y.x),m=Math.max(m,y.y);return{min:new Rt(s,l),max:new Rt(f,m)}},a.b=function(u){return Ks.API_FONTS_REGEX.test(u)},a.b$=IP,a.b0=ui,a.b1=ct,a.b2=LT,a.b3=A2,a.b4=function(){Dl.isLoading()||Dl.isLoaded()||nb()!=="deferred"||sb()},a.b5=Ex,a.b6=lt,a.b7=w_,a.b8=Xi,a.b9=ZP,a.bA=pe,a.bB=V,a.bC=function(u,s){const{x:l,y:f}=u.point,m=vF(l,f,u.worldSize/u._pixelsPerMercatorPixel,0,0);return $(m,m,mP(Mh(s)))},a.bD=C,a.bE=nn,a.bF=dt,a.bG=Xt,a.bH=on,a.bI=Br,a.bJ=Jx,a.bK=fc,a.bL=rk,a.bM=function(u,s,l,f,m){const y=5*s+2;u.float32[y+0]=l,u.float32[y+1]=f,u.float32[y+2]=m},a.bN=rv,a.bO=Pl,a.bP=pl,a.bQ=lu,a.bR=_f,a.bS=ze,a.bT=function(u,s,l,f){var m=new E(4);return m[0]=u,m[1]=s,m[2]=l,m[3]=f,m},a.bU=class{isDataAvailableAtPoint(u){const s=this._source();if(this.isUsingMockSource()||!s||u.y<0||u.y>1)return!1;const l=s.getSource().maxzoom,f=1<<l,m=Math.floor(u.x),y=Math.floor((u.x-m)*f),x=Math.floor(u.y*f),b=this.findDEMTileFor(new Oa(l,m,l,y,x));return!(!b||!b.dem)}getAtPointOrZero(u,s=0){return this.getAtPoint(u,s)||0}getAtPoint(u,s,l=!0){if(this.isUsingMockSource())return null;s==null&&(s=null);const f=this._source();if(!f||u.y<0||u.y>1)return s;const m=f.getSource().maxzoom,y=1<<m,x=Math.floor(u.x),b=u.x-x,j=new Oa(m,x,m,Math.floor(b*y),Math.floor(u.y*y)),N=this.findDEMTileFor(j);if(!N||!N.dem)return s;const k=N.dem,M=1<<N.tileID.canonical.z,D=(b*M-N.tileID.canonical.x)*k.dim,q=(u.y*M-N.tileID.canonical.y)*k.dim,G=Math.floor(D),ee=Math.floor(q);return(l?this.exaggeration():1)*Ur(Ur(k.get(G,ee),k.get(G,ee+1),q-ee),Ur(k.get(G+1,ee),k.get(G+1,ee+1),q-ee),D-G)}static getAtTileOffset(u,s,l,f){const m=1<<u.canonical.z;return f?f.pointElevation(s):l?l.getAtPointOrZero(new et(u.wrap+(u.canonical.x+s.x/Zt)/m,(u.canonical.y+s.y/Zt)/m)):0}static getAtTileOffsetFunc(u,s,l,f){return(m,y,x)=>{const b=this.getAtTileOffset(u,m,y,x),j=f.upVector(u.canonical,m.x,m.y);return St(j,j,b*f.upVectorScale(u.canonical,s,l).metersToTile),j}}getForTilePoints(u,s,l,f){if(this.isUsingMockSource())return!1;const m=nv.create(this,u,f);return!!m&&(s.forEach(y=>{y[2]=this.exaggeration()*m.getElevationAt(y[0],y[1],l)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const s=this.findDEMTileFor(u);if(!s||!s.dem)return null;const l=s.dem.tree,f=s.tileID,m=1<<u.canonical.z-f.canonical.z;let y=u.canonical.x/m-f.canonical.x,x=u.canonical.y/m-f.canonical.y,b=0;for(let j=0;j<u.canonical.z-f.canonical.z&&!l.leaves[b];j++){y*=2,x*=2;const N=2*Math.floor(x)+Math.floor(y);b=l.childOffsets[b]+N,y%=1,x%=1}return{min:this.exaggeration()*l.minimums[b],max:this.exaggeration()*l.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,s,l){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let s=!1,l=Number.MAX_VALUE,f=Number.MIN_VALUE;for(const m of u){const y=this.getMinMaxForTile(m.tileID);y&&(l=Math.min(l,y.min),f=Math.max(f,y.max),s=!0)}return s?{min:l,max:f}:null}},a.bV=o2,a.bW=Vi,a.bX=co,a.bY=YF,a.bZ=uB,a.b_=tz,a.ba=TP,a.bb=wt,a.bc=yl,a.bd=kx,a.be=pF,a.bf=xi,a.bg=Ux,a.bh=pk,a.bi=function(u,s){const l=mm(s.zoom);if(l===0)return Mh(u);const f=XT(u),m=pP(f),y=fe(f.getWest())*s.worldSize,x=fe(f.getEast())*s.worldSize,b=de(f.getNorth())*s.worldSize,j=de(f.getSouth())*s.worldSize,N=[y,b,0],k=[x,b,0],M=[y,j,0],D=[x,j,0],q=Z([],s.globeMatrix);return ln(N,N,q),ln(k,k,q),ln(M,M,q),ln(D,D,q),m[0]=Ff(m[0],M,l),m[1]=Ff(m[1],D,l),m[2]=Ff(m[2],k,l),m[3]=Ff(m[3],N,l),wn.fromPoints(m)},a.bj=JT,a.bk=Z,a.bl=Ib,a.bm=Ff,a.bn=Mf,a.bo=Tte,a.bp=ue,a.bq=X,a.br=U2,a.bs=y2,a.bt=mu,a.bu=function(u,s){const l=[];for(const f in u)f in s||l.push(f);return l},a.bv=Fe,a.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.bx=ua,a.by=W,a.bz=K,a.c=ao,a.c$=function(u){return u*u*u*u*u},a.c0=ek,a.c1=D5,a.c2=ok,a.c3=Ik,a.c4=St,a.c5=Ft,a.c6=ys,a.c7=function(u,s,l){l*=.5;var f=s[0],m=s[1],y=s[2],x=s[3],b=Math.sin(l),j=Math.cos(l);return u[0]=f*j+m*b,u[1]=m*j-f*b,u[2]=y*j+x*b,u[3]=x*j-y*b,u},a.c8=Es,a.c9=bi,a.cA=us,a.cB=zz,a.cC=uc,a.cD=_F,a.cE=function(u,s,l,f,m,y,x,b,j){if(j.name==="globe")return _F(u,s,new uc(l,f,m),!1);const N=Qb({z:l,x:f,y:m},j);return new wn([(y+N.x/N.scale)*s,s*(N.y/N.scale),x],[(y+N.x2/N.scale)*s,s*(N.y2/N.scale),b])},a.cF=function(u,s,l){return u[0]=Math.min(s[0],l[0]),u[1]=Math.min(s[1],l[1]),u[2]=Math.min(s[2],l[2]),u[3]=Math.min(s[3],l[3]),u},a.cG=function(u,s,l){return u[0]=Math.max(s[0],l[0]),u[1]=Math.max(s[1],l[1]),u[2]=Math.max(s[2],l[2]),u[3]=Math.max(s[3],l[3]),u},a.cH=function(u){const s=Math.round((u+45+360)%360/90)%4;return Fg[s]},a.cI=Te,a.cJ=xr,a.cK=o,a.cL=function(u){const s=K(new Float64Array(16));$(s,u.pixelMatrix,u.globeMatrix);const l=[0,S,0],f=[0,T,0];return ln(l,l,s),ln(f,f,s),[l[0]>0&&l[0]<=u.width&&l[1]>0&&l[1]<=u.height&&!_P(u,new H(u.center.lat,90)),f[0]>0&&f[0]<=u.width&&f[1]>0&&f[1]<=u.height&&!_P(u,new H(u.center.lat,-90))]},a.cM=function(u,s){const{scale:l}=u.tileTransform,f=l*Zt/(u.tileSize*Math.pow(2,s.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(m,y,x){var b=y[1],j=y[2],N=y[3],k=x[0],M=x[1];return m[0]=y[0]*k,m[1]=b*k,m[2]=j*M,m[3]=N*M,m}(new Float32Array(4),s.inverseAdjustmentMatrix,[f,f])},a.cN=h2,a.cO=le,a.cP=Fz,a.cQ=function(u){const s=Fz(u,!0);return C([],[s[0],s[1],s[4],s[5]])},a.cR=Q,a.cS=Ss,a.cT=re,a.cU=function(u){const{x:s,y:l}=u.point,{lng:f,lat:m}=u._center;return vF(s,l,u.worldSize,f,m)},a.cV=it,a.cW=_o,a.cX=dc,a.cY=Ui,a.cZ=g,a.c_=function(u,s,l){let f=0;for(let m=0;m<2;++m)u[m]>0&&(f+=(u[m]-0)*(u[m]-0)),s[m]<0&&(f+=(0-s[m])*(0-s[m]));return f},a.ca=function(u,s){return u[0]=-s[0],u[1]=-s[1],u[2]=-s[2],u[3]=s[3],u},a.cb=Se,a.cc=function(u,s,l,f,m){var y=1/Math.tan(s/2);if(u[0]=y/l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=y,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,m!=null&&m!==1/0){var x=1/(f-m);u[10]=(m+f)*x,u[14]=2*m*f*x}else u[10]=-1,u[14]=-2*f;return u},a.cd=function(u,s,l,f,m,y,x){var b=1/(s-l),j=1/(f-m),N=1/(y-x);return u[0]=-2*b,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*j,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*N,u[11]=0,u[12]=(s+l)*b,u[13]=(m+f)*j,u[14]=(x+y)*N,u[15]=1,u},a.ce=_e,a.cf=function(u,s,l){u[4*s+0]=l[0],u[4*s+1]=l[1],u[4*s+2]=l[2],u[4*s+3]=l[3]},a.cg=Fx,a.ch=dm,a.ci=Qi,a.cj=Zu,a.ck=h_,a.cl=H5,a.cm=function(){var u=new E(4);return E!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},a.cn=function(u,s,l){var f=s[0],m=s[1],y=s[2],x=s[3],b=Math.sin(l),j=Math.cos(l);return u[0]=f*j+y*b,u[1]=m*j+x*b,u[2]=f*-b+y*j,u[3]=m*-b+x*j,u},a.co=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]},a.cp=Ln,a.cq=function(u){var s=u[0],l=u[1],f=u[2],m=u[3];return Math.sqrt(s*s+l*l+f*f+m*m)},a.cr=Al,a.cs=Vr,a.ct=Ku,a.cu=3,a.cv=2,a.cw=7,a.cx=6,a.cy=Zn,a.cz=J,a.d=function(u){return Ks.API_TILEJSON_REGEX.test(u)},a.d$=SF,a.d0=se,a.d1=45,a.d2=d_,a.d3=function(u,s,l){const f=Math.sqrt(u*u+s*s+l*l),m=f>0?Math.acos(l/f)*uu:0;let y=u!==0||s!==0?Math.atan2(-s,-u)*uu+90:0;return y<0&&(y+=360),[f,y,m]},a.d4=Xe,a.d5=Kn,a.d6=Oe,a.d7=$e,a.d8=wn,a.d9=st,a.dA=Eb,a.dB=class extends Uc{constructor(u){super(u),this.current=lP}set(u,s,l){if(this.fetchUniformLocation(u,s)){for(let f=0;f<9;f++)if(l[f]!==this.current[f]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},a.dC=Dc,a.dD=function(u,s,l){const f=mm(l.zoom),m=u.style.map._antialias,y=u.terrain&&u.terrain.exaggeration()>0;return f===0&&!m&&!y},a.dE=function(u){const s=u.pixelsPerMeter,l=s/_e(1,u.center.lat),f=K(new Float64Array(16));return X(f,f,[u.point.x,u.point.y,0]),Q(f,f,[l,l,s]),Float32Array.from(f)},a.dF=XT,a.dG=function(u){const s=Te-5;u=he(u,-s,s)/s*90;const l=Math.pow(Math.abs(Math.sin(Nn(u))),3);return Math.round(l*(v.length-1))},a.dH=function(u,s,l,f){const m=s.getNorth(),y=s.getSouth(),x=s.getWest(),b=s.getEast(),j=1<<u.z,N=b-x,k=m-y,M=N/_,D=-k/v[l],q=[0,M,0,D,0,0,m,x,0];if(u.z>0){const G=180/f;B(q,q,[G/N+1,0,0,0,G/k+1,0,-.5*G/M,.5*G/D,1])}return q[2]=j,q[5]=u.x,q[8]=u.y,q},a.dI=Mh,a.dJ=function(u,s,l){const f=K(new Float64Array(16)),m=(s/(1<<u)-.5)*Math.PI*2;return ve(f,l.globeMatrix,m),Float32Array.from(f)},a.dK=RF,a.dL=KT,a.dM=function(u,s){return[Math.pow(u[0],2.2)*s,Math.pow(u[1],2.2)*s,Math.pow(u[2],2.2)*s]},a.dN=P,a.dO=function(u,s){var l=Math.sin(s),f=Math.cos(s);return u[0]=f,u[1]=l,u[2]=0,u[3]=-l,u[4]=f,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},a.dP=dr,a.dQ=xF,a.dR=zs,a.dS=ci,a.dT=256,a.dU=function(u,s){const l=[0,0,0];return ln(l,l,JT(Mh(s.canonical))),ln(l,l,u),l},a.dV=u=>({u_matrix:new h_(u),u_texsize:new Zu(u),u_pixels_to_tile_units:new Tb(u),u_device_pixel_ratio:new Qi(u),u_width_scale:new Qi(u),u_floor_width_scale:new Qi(u),u_image:new Fx(u),u_units_to_pixels:new Zu(u),u_tile_units_to_pixels:new Qi(u),u_alpha_discard_threshold:new Qi(u),u_trim_offset:new Zu(u),u_trim_fade_range:new Zu(u),u_trim_color:new d_(u),u_emissive_strength:new Qi(u),u_zbias_factor:new Qi(u),u_tile_to_meter:new Qi(u),u_ground_shadow_factor:new dm(u),u_pattern_transition:new Qi(u)}),a.dW=u=>({u_matrix:new h_(u),u_pixels_to_tile_units:new Tb(u),u_device_pixel_ratio:new Qi(u),u_width_scale:new Qi(u),u_floor_width_scale:new Qi(u),u_units_to_pixels:new Zu(u),u_dash_image:new Fx(u),u_gradient_image:new Fx(u),u_image_height:new Qi(u),u_texsize:new Zu(u),u_tile_units_to_pixels:new Qi(u),u_alpha_discard_threshold:new Qi(u),u_trim_offset:new Zu(u),u_trim_fade_range:new Zu(u),u_trim_color:new d_(u),u_emissive_strength:new Qi(u),u_zbias_factor:new Qi(u),u_tile_to_meter:new Qi(u),u_ground_shadow_factor:new dm(u)}),a.dX=u=>({u_camera_to_center_distance:new Qi(u),u_extrude_scale:new Tb(u),u_device_pixel_ratio:new Qi(u),u_matrix:new h_(u),u_inv_rot_matrix:new h_(u),u_merc_center:new Zu(u),u_tile_id:new dm(u),u_zoom_transition:new Qi(u),u_up_dir:new dm(u),u_emissive_strength:new Qi(u)}),a.dY=om,a.dZ=hne,a.d_=class{constructor(u,s,l,f){this.context=u,this.format=f,this.size=l,this.texture=u.gl.createTexture();const[m,y,x]=this.size,{gl:b}=u;b.bindTexture(b.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in s&&s.data&&b.texImage3D(b.TEXTURE_3D,0,this.format,m,y,x,0,FP(this.format),zP(this.format),s.data)}bind(u,s){const{context:l}=this,{gl:f}=l;f.bindTexture(f.TEXTURE_3D,this.texture),u!==this.minFilter&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MAG_FILTER,u),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MIN_FILTER,u),this.minFilter=u),s!==this.wrapS&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_T,s),this.wrapS=s)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},a.da=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},a.db=Lz,a.dc=HP,a.dd=Uz,a.de=gk,a.df=function(u,s){return u.readFields(cse,{icons:[]},s)},a.dg=l2,a.dh=Qx,a.di=sk,a.dj=Bg,a.dk=IT,a.dl=du,a.dm=mh,a.dn=br,a.dp=function(u){const s=u.indexOf(i_);return s>=0?u.slice(0,s):u},a.dq=function(u){return u.indexOf(i_)>=0},a.dr=function(u){const s=u.lastIndexOf(i_);return s>=0?u.slice(s+1):""},a.ds=function(u){const s=[],l=u.id;return l===void 0&&s.push({message:`layers.${l}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${l}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),s},a.dt=function(u,s,l,f){return u.type==="custom"?new rse(u,s):new ose[u.type](u,s,l,f)},a.du=At,a.dv=function(u){const s=u.indexOf(i_);return s>=0?u.slice(s+1):""},a.dw=class extends w_{constructor(u,s){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=s.target,this.namespace=s.namespace,s.properties&&(this.properties=s.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},a.dx=rb,a.dy=Uu,a.dz=function(u){return u({pluginStatus:rl,pluginURL:Ah}),rb.on("pluginStateChange",u),u},a.e=Ks,a.e$=function([u,s,l]){const f=Math.hypot(u,s,l),m=Math.atan2(u,l),y=.5*Math.PI-Math.acos(-s/f);return new H(_o(m),_o(y))},a.e0=(u,s,l,f,m,y)=>{const x=u.transform,b=x.projection.name==="globe";let j;if(y.paint.get("circle-pitch-alignment")==="map")if(b){const k=xF(x.zoom,s.canonical)*x._pixelsPerMercatorPixel;j=Float32Array.from([k,0,0,k])}else j=x.calculatePixelsToTileUnitsMatrix(l);else j=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(x.projection),u_matrix:u.translatePosMatrix(s.projMatrix,l,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Bs.devicePixelRatio,u_extrude_scale:j,u_inv_rot_matrix:Ate,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:y.paint.get("circle-emissive-strength")};if(b){N.u_inv_rot_matrix=f,N.u_merc_center=m,N.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],N.u_zoom_transition=mm(x.zoom);const k=m[0]*Zt,M=m[1]*Zt;N.u_up_dir=x.projection.upVector(new uc(0,0,0),k,M)}return N},a.e1=i5,a.e2=cs,a.e3=(u,s,l,f,m,y,x,b,j,N)=>{const k=u.transform,M=k.pitch<15?r5(.07,.7,he((14-k.zoom)/5,0,1)):.07,D=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:s5(u,s,l,f),u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:m,u_width_scale:y,u_floor_width_scale:x,u_image:0,u_tile_units_to_pixels:n5(s,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:Oe(s.tileID.canonical,0),u_ground_shadow_factor:j,u_pattern_transition:N}},a.e4=(u,s,l,f,m,y,x,b,j,N)=>{const k=u.transform,M=k.calculatePixelsToTileUnitsMatrix(s),D=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none",q=k.pitch<15?r5(.07,.7,he((14-k.zoom)/5,0,1)):.07;return{u_matrix:s5(u,s,l,f),u_pixels_to_tile_units:M,u_device_pixel_ratio:y,u_width_scale:x,u_floor_width_scale:b,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:a5(l)&&s.lineAtlasTexture?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:n5(s,u.transform),u_alpha_discard_threshold:0,u_trim_offset:j,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:q,u_tile_to_meter:Oe(s.tileID.canonical,0),u_ground_shadow_factor:N}},a.e5=Ye,a.e6=Cb,a.e7=Re,a.e8=Lf,a.e9=a2,a.eA=xk,a.eB=m2,a.eC=p2,a.eD=[1,1,1],a.eE=nv,a.eF=or,a.eG=function(u,s,l,f){var m=s[0],y=s[1],x=s[2],b=s[3];return u[0]=m+f*(l[0]-m),u[1]=y+f*(l[1]-y),u[2]=x+f*(l[2]-x),u[3]=b+f*(l[3]-b),u},a.eH=Zx,a.eI=Vc,a.eJ=Rh,a.eK=function(u,s,l,f,m,y,x,b,j,N,k,M,D,q,G,ee){var ne=new E(16);return ne[0]=u,ne[1]=s,ne[2]=l,ne[3]=f,ne[4]=m,ne[5]=y,ne[6]=x,ne[7]=b,ne[8]=j,ne[9]=N,ne[10]=k,ne[11]=M,ne[12]=D,ne[13]=q,ne[14]=G,ne[15]=ee,ne},a.eL=L,a.eM=_b,a.eN=o_,a.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Rt(1/0,1/0),max:new Rt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,s=!1){const l=QF(new Rt(0,0),new Rt(Zt,Zt),u),f=[];if(s&&!jP(l,this._globalClipBounds))return f;for(const m of this._activeRegions){if(m.hiddenByOverlap||!jP(l,m))continue;const y=ire(m.min,m.max,u);f.push({min:y.min,max:y.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return f}setSources(u){this._setSources(u.map(s=>({getSourceId:()=>s.cache.id,getFootprints:()=>{const l=[];for(const f of s.cache.getVisibleCoordinates()){const m=s.cache.getTile(f).buckets[s.layer];m&&m.updateFootprints(f.toUnwrapped(),l)}return l},getOrder:()=>s.order,getClipMask:()=>s.clipMask,getClipScope:()=>s.clipScope})))}_addSource(u){const s=u.getFootprints();if(s.length===0)return;const l=u.getOrder(),f=u.getClipMask(),m=u.getClipScope();for(const y of s){if(!y.footprint)continue;const x=QF(y.footprint.min,y.footprint.max,y.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:y.id,footprint:y.footprint,order:l,clipMask:f,clipScope:m})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((s,l)=>s.priority-l.priority||n2(s.min,l.min)||n2(s.max,l.max)||s.order-l.order||s.clipMask-l.clipMask||function(f,m){const y=(x,b)=>x+b;return f.length-m.length||f.reduce(y,"").localeCompare(m.reduce(y,""))}(s.clipScope,l.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let s=0;for(;!u&&s!==this._activeRegions.length;){const l=this._activeRegions[s],f=this._prevRegions[s];u=l.priority!==f.priority||!JF(l,f)||l.order!==f.order||l.clipMask!==f.clipMask||!ua(l.clipScope,f.clipScope),this._activeRegions[s].hiddenByOverlap=f.hiddenByOverlap,++s}}if(u){++this._updateTime;for(const l of this._activeRegions)l.order!==Db&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const s=l=>{const f=this._activeRegions;if(l>=f.length)return l;const m=f[l].priority;for(;l<f.length&&f[l].priority===m;)++l;return l};if(this._sourceIds.length>1){let l=0,f=s(l);for(;l!==f;){let m=l;const y=l;for(;m!==f;){const x=this._activeRegions[m];x.hiddenByOverlap=!1;for(let b=0;b<y;b++){const j=this._activeRegions[b];if(!j.hiddenByOverlap&&x.order===Db&&jP(x,j)&&(x.hiddenByOverlap=ez(x.footprint,x.tileId,j.footprint,j.tileId),x.hiddenByOverlap))break}++m}l=f,f=s(l)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let s=u.length-1;s>=0;s--)this._addSource(u[s]);this._computeReplacement()}},a.eP=Db,a.eQ=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,s){const l=new yl,f=new ui,m=[],y=u+1+2,x=s[0]+1,b=s[0]+1+(1+s.length),j=(N,k,M)=>{let D=N===y-1?N-2:N===0?N:N-1;return D+=M?24575:0,[D,k]};for(let N=0;N<y;++N)l.emplaceBack(...j(N,0,!0));for(let N=0;N<x;++N)for(let k=0;k<y;++k)l.emplaceBack(...j(k,N,(k===0||k===y-1)&&!0));for(let N=0;N<s.length;++N){const k=s[N];for(let M=0;M<y;++M)l.emplaceBack(...j(M,k,!0))}for(let N=0;N<s.length;++N){const k=f.length,M=s[N]+1+2,D=new ui;for(let ee=0;ee<M-1;ee++){const ne=ee===M-2,ie=ne?y*(b-s.length+N-ee):y;for(let me=0;me<y-1;me++){const ye=ee*y+me;ee===0||ne||me===0||me===y-2?(D.emplaceBack(ye+1,ye,ye+ie),D.emplaceBack(ye+ie,ye+ie+1,ye+1)):(f.emplaceBack(ye+1,ye,ye+ie),f.emplaceBack(ye+ie,ye+ie+1,ye+1))}}const q=xi.simpleSegment(0,k,l.length,f.length-k);for(let ee=0;ee<D.uint16.length;ee+=3)f.emplaceBack(D.uint16[ee],D.uint16[ee+1],D.uint16[ee+2]);const G=xi.simpleSegment(0,k,l.length,f.length-k);m.push({withoutSkirts:q,withSkirts:G})}return{vertices:l,indices:f,segments:m}}_createGrid(u){const s=this._fillGridMeshWithLods(_,v);this._gridSegments=s.segments,this._gridBuffer=u.createVertexBuffer(s.vertices,pF.members),this._gridIndexBuffer=u.createIndexBuffer(s.indices,!0)}_createPoles(u){const s=new ui;for(let x=0;x<=_;x++)s.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=u.createIndexBuffer(s,!0);const l=new Of,f=new Of,m=new Of,y=new Of;this._poleSegments=[];for(let x=0,b=0;x<g;x++){const j=360/(1<<x);l.emplaceBack(0,-xl,0,.5,0),f.emplaceBack(0,-xl,0,.5,1),m.emplaceBack(0,-xl,0,.5,.5),y.emplaceBack(0,-xl,0,.5,.5);for(let N=0;N<=_;N++){let k=N/_,M=0;const D=Ur(0,j,k),[q,G,ee]=I(Ite,Cte,D,xl);l.emplaceBack(q,G,ee,k,M),f.emplaceBack(q,G,ee,k,1-M);const ne=Nn(D);k=.5+.5*Math.sin(ne),M=.5+.5*Math.cos(ne),m.emplaceBack(q,G,ee,k,M),y.emplaceBack(q,G,ee,k,1-M)}this._poleSegments.push(xi.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(l,Vx,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(f,Vx,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(m,Vx,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(y,Vx,!1)}getGridBuffers(u,s){return[this._gridBuffer,this._gridIndexBuffer,s?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,s){return[s?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,s?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},a.eR=XF,a.eS=Qe,a.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.eU=oe,a.eV=Ie,a.eW=function(u,s,l){return u[0]=s[0]/l[0],u[1]=s[1]/l[1],u[2]=s[2]/l[2],u},a.eX=xt,a.eY=A,a.eZ=Wt,a.e_=qe,a.ea=mz,a.eb=_m,a.ec=iz,a.ed=sz,a.ee=Pe,a.ef=function(u,s){if(u===s){var l=s[1],f=s[2],m=s[3],y=s[6],x=s[7],b=s[11];u[1]=s[4],u[2]=s[8],u[3]=s[12],u[4]=l,u[6]=s[9],u[7]=s[13],u[8]=f,u[9]=y,u[11]=s[14],u[12]=m,u[13]=x,u[14]=b}else u[0]=s[0],u[1]=s[4],u[2]=s[8],u[3]=s[12],u[4]=s[1],u[5]=s[5],u[6]=s[9],u[7]=s[13],u[8]=s[2],u[9]=s[6],u[10]=s[10],u[11]=s[14],u[12]=s[3],u[13]=s[7],u[14]=s[11],u[15]=s[15];return u},a.eg=tse,a.eh=In,a.ei=xb,a.ej=256,a.ek=mP,a.el=ac,a.em=ve,a.en=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[4],u[4]=s[5],u[5]=s[6],u[6]=s[8],u[7]=s[9],u[8]=s[10],u},a.eo=Of,a.ep=gb,a.eq=wT,a.er=function(u,s,l,f,m){return he((u-s)/(l-s)*(m-f)+f,f,m)},a.es=so,a.et=function(u,s){var l=s[0],f=s[1],m=s[2],y=s[3],x=s[4],b=s[5],j=s[6],N=s[7],k=s[8],M=k*x-b*N,D=-k*y+b*j,q=N*y-x*j,G=l*M+f*D+m*q;return G?(u[0]=M*(G=1/G),u[1]=(-k*f+m*N)*G,u[2]=(b*f-m*x)*G,u[3]=D*G,u[4]=(k*l-m*j)*G,u[5]=(-b*l+m*y)*G,u[6]=q*G,u[7]=(-N*l+f*j)*G,u[8]=(x*l-f*y)*G,u):null},a.eu=2,a.ev=Wr,a.ew=Cs,a.ex=ce,a.ey=function(u,s){var l=new E(3);ce(l,s);var f=1/l[0],m=1/l[1],y=1/l[2],x=s[0]*f,b=s[1]*m,j=s[2]*y,N=s[4]*f,k=s[5]*m,M=s[6]*y,D=s[8]*f,q=s[9]*m,G=s[10]*y,ee=x+k+G,ne=0;return ee>0?(ne=2*Math.sqrt(ee+1),u[3]=.25*ne,u[0]=(M-q)/ne,u[1]=(D-j)/ne,u[2]=(b-N)/ne):x>k&&x>G?(ne=2*Math.sqrt(1+x-k-G),u[3]=(M-q)/ne,u[0]=.25*ne,u[1]=(b+N)/ne,u[2]=(D+j)/ne):k>G?(ne=2*Math.sqrt(1+k-x-G),u[3]=(D-j)/ne,u[0]=(b+N)/ne,u[1]=.25*ne,u[2]=(M+q)/ne):(ne=2*Math.sqrt(1+G-x-k),u[3]=(b-N)/ne,u[0]=(D+j)/ne,u[1]=(M+q)/ne,u[2]=.25*ne),u},a.ez=function(u,s){var l=2*Math.acos(s[3]),f=Math.sin(l/2);return f>w?(u[0]=s[0]/f,u[1]=s[1]/f,u[2]=s[2]/f):(u[0]=1,u[1]=0,u[2]=0),l},a.f=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(s,l)=>String.fromCharCode(+("0x"+l))))},a.f0=mr,a.f1=VP,a.f2=function(u){const s=u.navigator?u.navigator.userAgent:null;return!!function(l){if(Ci==null){const f=l.navigator?l.navigator.userAgent:null;Ci=!!l.safari||!(!f||!(/\b(iPad|iPhone|iPod)\b/.test(f)||f.match("Safari")&&!f.match("Chrome")))}return Ci}(u)&&!(!s||!(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},a.f3=function(u,s){yf=u,Eo=s},a.f4=_P,a.f5=wF,a.f6=function(u){const s=[0,0,0],l=K(new Float64Array(16));return $(l,u.pixelMatrix,u.globeMatrix),ln(s,s,l),new Rt(s[0],s[1])},a.f7=function(){const u=Vb;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(RP),Vb=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.f8=function(){l2().acquire(RP)},a.f9=nb,a.fA=Pt,a.fB=function(u){let s=0;if(new Uint32Array(u,0,1)[0]!==kz){const l=new Uint32Array(u,0,7),[,,f,m,y,x]=l;s=l.byteLength+m+y+x+y,(f!==u.byteLength||s>=u.byteLength)&&Ar("Invalid b3dm header information.")}return Oz(u,s)},a.fC=function(u,s){const l=HP(u);for(const f of l){for(const m of f.meshes)Ore(m);f.lights&&(f.lightMeshIndex=f.meshes.length,f.meshes.push(Lre(f.lights,s)))}return l},a.fD=D2,a.fE=li,a.fF=Nz,a.fG=Dl,a.fH=Ml,a.fI=function(u){Ql(),To!=null&&To.then(s=>{s.keys().then(l=>{for(let f=0;f<l.length-u;f++)s.delete(l[f]).catch(m=>Ar(m.message))}).catch(l=>Ar(l.message))}).catch(s=>Ar(s.message))},a.fa=function(u,s,l=!1){if(rl===Ml.deferred||rl===Ml.loading||rl===Ml.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ah=Bs.resolveURL(u),rl=Ml.deferred,eb=s,tb(),l||sb()},a.fb=function(u){Gx=Bs.resolveURL(u),Hx||(Hx=new qx(l2(),new Oc)),Hx.broadcast("setMeshoptUrl",Gx)},a.fc=Az,a.fd=function(u){DP=Bs.resolveURL(u),Hx||(Hx=new qx(l2(),new Oc)),Hx.broadcast("setDracoUrl",DP)},a.fe=Cz,a.ff=Bb,a.fg=function(u){const s=fu();if(!s)return;const l=s.delete(hu);u&&l.then(()=>u()).catch(u)},a.fh=g_,a.fi=hr,a.fj=gm,a.fk=Pd,a.fl=YB,a.fm=JB,a.fn=Jz,a.fo=sr,a.fp="hd_road_elevation",a.fq=Jr,a.fr=zt,a.fs=zf,a.ft=nk,a.fu=x_,a.fv=function(u,s,l,f,m,y,x,b=1,j,N,k){u.createArrays(),u.tilePixelRatio=Zt/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const M=u.layers[0].layout,D=u.layers[0]._unevaluatedLayout._values,q={};q.scaleFactor=b,q.textSizeScaleRange=M.get("text-size-scale-range"),q.iconSizeScaleRange=M.get("icon-size-scale-range");const[G,ee]=q.textSizeScaleRange,[ne,ie]=q.iconSizeScaleRange;q.textScaleFactor=he(q.scaleFactor,G,ee),q.iconScaleFactor=he(q.scaleFactor,ne,ie);const me=D["text-size"],ye=D["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:He,maxZoom:mt}=u.textSizeData;q.compositeTextSizes=[me.possiblyEvaluate(new Xs(He,{worldview:k}),y),me.possiblyEvaluate(new Xs(mt,{worldview:k}),y)]}if(u.iconSizeData.kind==="composite"){const{minZoom:He,maxZoom:mt}=u.iconSizeData;q.compositeIconSizes=[ye.possiblyEvaluate(new Xs(He,{worldview:k}),y),ye.possiblyEvaluate(new Xs(mt,{worldview:k}),y)]}q.layoutTextSize=me.possiblyEvaluate(new Xs(x+1,{worldview:k}),y),q.layoutIconSize=ye.possiblyEvaluate(new Xs(x+1,{worldview:k}),y),q.textMaxSize=me.possiblyEvaluate(new Xs(18,{worldview:k}),y);const be=M.get("symbol-placement"),Me=M.get("text-rotation-alignment")==="map"&&be!=="point",Ce=M.get("text-size");let Le=!1;const Ve=[];for(const He of u.features){const mt=M.get("text-font").evaluate(He,{},y).join(","),rt=Ce.evaluate(He,{},y)*q.textScaleFactor,gt=q.layoutTextSize.evaluate(He,{},y)*q.textScaleFactor,bt=q.layoutIconSize.evaluate(He,{},y)*q.iconScaleFactor,Ct={horizontal:{},vertical:void 0},Gt=He.text;let Ot,Et=[0,0];if(Gt){const Sn=Gt.toString(),Hn=M.get("text-letter-spacing").evaluate(He,{},y)*co,cn=M.get("text-line-height").evaluate(He,{},y)*co,ts=jT(Sn)?Hn:0,rs=M.get("text-anchor").evaluate(He,{},y),mi=M.get("text-variable-anchor");if(!mi){const yt=M.get("text-radial-offset").evaluate(He,{},y);if(yt)Et=D5(rs,[yt*co,ak]);else{const er=M.get("text-offset").evaluate(He,{},y);Et=[er[0]*co,er[1]*co]}}let Ae=Me?"center":M.get("text-justify").evaluate(He,{},y);const je=be==="point",_t=je?M.get("text-max-width").evaluate(He,{},y)*co:1/0,Yt=yt=>{u.allowVerticalPlacement&&Yw(Sn)&&(Ct.vertical=QP(Gt,s,l,m,mt,_t,cn,rs,yt,ts,Et,fc.vertical,!0,gt,rt,j))};if(!Me&&mi){const yt=Ae==="auto"?mi.map(Er=>ok(Er)):[Ae];let er=!1;for(let Er=0;Er<yt.length;Er++){const Sr=yt[Er];if(!Ct.horizontal[Sr])if(er)Ct.horizontal[Sr]=Ct.horizontal[0];else{const un=QP(Gt,s,l,m,mt,_t,cn,"center",Sr,ts,Et,fc.horizontal,!1,gt,rt,j);un&&(Ct.horizontal[Sr]=un,er=un.positionedLines.length===1)}}Yt("left")}else{if(Ae==="auto"&&(Ae=ok(rs)),je||M.get("text-writing-mode").indexOf("horizontal")>=0||!Yw(Sn)){const yt=QP(Gt,s,l,m,mt,_t,cn,rs,Ae,ts,Et,fc.horizontal,!1,gt,rt,j);yt&&(Ct.horizontal[Ae]=yt)}Yt(je?"left":Ae)}}let Dt,ht,ut,kt,$t,It,ur=!1;const _r=M.get("icon-text-fit").evaluate(He,{},y);if(He.icon&&He.icon.hasPrimary()){const Sn=Yb(He.icon,u.iconSizeData,D["icon-size"],y,u.zoom,He,j,q.iconScaleFactor,k);Dt=Sn.iconPrimary,ut=Sn.iconSecondary;const Hn=Dt.toString();if(ht=f.get(Hn),ht&&($t=M.get("icon-offset").evaluate(He,{},y),It=M.get("icon-anchor").evaluate(He,{},y),Ot=v2(m.get(Hn),ut?m.get(ut.toString()):void 0,$t,It),ur=ht.sdf,u.sdfIcons===void 0?u.sdfIcons=ht.sdf:u.sdfIcons!==ht.sdf&&Ar("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ht.pixelRatio!==u.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),ut){const cn=ut.toString();kt=f.get(cn)}}Le=Le||!(!He.icon||!He.icon.hasSecondary());const ir=lk(Ct.horizontal)||Ct.vertical;u.iconsInText||(u.iconsInText=!!ir&&ir.iconsInText);const Jt=gt*q.textScaleFactor/co,{defaultShapedIcon:Qr,verticallyShapedIcon:tr}=Vne(u,Ot,M,He,y,Ct,Jt,$t,_r);_r!=="none"&&Ot&&(v5(Ot)||w5(Ot))&&(T2(0,ht,Dt,Ot,Qr,_r,N,f,m),T2(0,kt,ut,Ot,Qr,_r,N,f,m),tr&&(T2(0,ht,Dt,Ot,tr,_r,N,f,m),T2(0,kt,ut,Ot,tr,_r,N,f,m))),Ot=Qr;const{iconBBox:Pr,iconVerticalBBox:an}=Fne(u,Ot,tr,M,He,y,bt,$t,q,m,It);Ve.push({feature:He,shapedTextOrientations:Ct,shapedText:ir,shapedIcon:Ot,iconPrimary:Dt,iconSecondary:ut,iconOffset:$t,iconAnchor:It,verticallyShapedIcon:tr,layoutTextSize:gt,layoutIconSize:bt,textOffset:Et,isSDFIcon:ur,iconTextFit:_r,iconCollisionBounds:Pr,iconVerticalCollisionBounds:an})}return{featureData:Ve,sizes:q,hasAnySecondaryIcon:Le,textAlongLine:Me,symbolPlacement:be}},a.fw=C5,a.fx=function(u,s,l,f,m,y,x,b,j,N){u.iconAtlasPositions=N.iconPositions;const{featureData:k,hasAnySecondaryIcon:M,sizes:D,textAlongLine:q,symbolPlacement:G}=s;for(const ee of k){const{shapedIcon:ne,verticallyShapedIcon:ie,feature:me,shapedTextOrientations:ye,shapedText:be,layoutTextSize:Me,textOffset:Ce,isSDFIcon:Le,iconPrimary:Ve,iconSecondary:He,iconTextFit:mt,iconOffset:rt,iconCollisionBounds:gt,iconVerticalCollisionBounds:bt}=ee;L5(ne,N.iconPositions,Ve,He),L5(ie,N.iconPositions,Ve,He),Bne(ye,N.iconPositions),zne(Ve,He,N.iconPositions),(be||ne)&&Une(u,me,ye,ne,ie,j,D,Me,0,Ce,Le,f,m,x,b,M,mt,rt,q,G,gt,bt)}l&&u.generateCollisionDebugBuffers(y,u.collisionBoxArray,D.textScaleFactor)},a.fy=yr,a.fz=V2,a.g=function(u,s){return Uu(Object.assign(u,{method:"GET"}),s)},a.h=function(u){return u.indexOf("mapbox:")===0},a.i=function(u){return Ks.API_STYLE_REGEX.test(u)&&!ao(u)},a.j=da,a.k=xf,a.l=function(u){return decodeURIComponent(atob(u).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.m=function(u,s){return Uu(Object.assign(u,{type:"json"}),s)},a.n=vf,a.o=Bs,a.p=function(u,s){return Uu(Object.assign(u,{method:"POST"}),s)},a.q=Io,a.r=Uo,a.s=function(u){try{const s=self[u];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=function(){return MP||(MP=new g_),MP},a.u=function(){return function u(s){return s?(s^Math.random()*(16>>s/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},a.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},a.w=Ar,a.x=Ek,a.y=gh,a.z=Sa}),d(["./shared"],function(a){function w(Qe){const oe=Qe?Qe.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function E(Qe){if(typeof Qe=="number"||typeof Qe=="boolean"||typeof Qe=="string"||Qe==null)return JSON.stringify(Qe);if(Array.isArray(Qe)){let he="[";for(const Ne of Qe)he+=`${E(Ne)},`;return`${he}]`}let oe="{";for(const he of Object.keys(Qe).sort())oe+=`${he}:${E(Qe[he])},`;return`${oe}}`}function C(Qe){let oe="";for(const he of a.bw)oe+=`/${E(Qe[he])}`;return oe}class P{constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,he){this._layerConfigs={},this._layers={},this.update(oe,[],he)}update(oe,he,Ne){this._options=Ne;for(const Fe of oe)this._layerConfigs[Fe.id]=Fe,(this._layers[Fe.id]=a.dt(Fe,this.scope,null,this._options)).compileFilter(Ne),this.keyCache[Fe.id]&&delete this.keyCache[Fe.id];for(const Fe of he)delete this.keyCache[Fe],delete this._layerConfigs[Fe],delete this._layers[Fe];this.familiesBySource={};const ze=function(Fe,We){const ct={};for(let at=0;at<Fe.length;at++){const zt=Fe[at];let At=We&&We[zt.id];At||(zt.type==="symbol"?At=zt.id:(At=C(zt),zt.type==="line"&&zt.paint&&function Kr(Fr){return typeof Fr=="string"&&Fr==="line-progress"||(Array.isArray(Fr)?Fr.some(Kr):!(!Fr||typeof Fr!="object")&&Object.values(Fr).some(Kr))}(zt.paint["line-width"])&&(At+=`/${E(zt.paint["line-width"])}`))),We&&(We[zt.id]=At);let br=ct[At];br||(br=ct[At]=[]),br.push(zt)}const Ye=[];for(const at in ct)Ye.push(ct[at]);return Ye}(Object.values(this._layerConfigs),this.keyCache);for(const Fe of ze){const We=Fe.map(br=>this._layers[br.id]),ct=We[0];if(ct.visibility==="none")continue;const Ye=ct.source||"";let at=this.familiesBySource[Ye];at||(at=this.familiesBySource[Ye]={});const zt=ct.sourceLayer||"_geojsonTileLayer";let At=at[zt];At||(At=at[zt]=[]),At.push(We)}}}const R=1*a.fk;class B{constructor(oe){const he={},Ne=[];for(const ct in oe){const Ye=oe[ct],at=he[ct]={};for(const zt in Ye.glyphs){const At=Ye.glyphs[+zt];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const br=At.metrics.localGlyph?R:1,Kr={x:0,y:0,w:At.bitmap.width+2*br,h:At.bitmap.height+2*br};Ne.push(Kr),at[zt]=Kr}}const{w:ze,h:Fe}=a.G(Ne),We=new a.fj({width:ze||1,height:Fe||1});for(const ct in oe){const Ye=oe[ct];for(const at in Ye.glyphs){const zt=Ye.glyphs[+at];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const At=he[ct][at],br=zt.metrics.localGlyph?R:1;a.fj.copy(zt.bitmap,We,{x:0,y:0},{x:At.x+br,y:At.y+br},zt.bitmap)}}this.image=We,this.positions=he}}function V(Qe,oe,he){Qe[oe]?he&&(Qe[oe].center=he):Qe[oe]={floorIds:new Set,center:he||[0,0],floors:{}}}function W(Qe,oe,he,Ne){for(const ze of oe)V(Qe,ze),Qe[ze].floors[he]=Ne,Qe[ze].floorIds.add(he)}function K(Qe){return{id:Qe.properties.id.toString(),center:Qe.properties.center.toString().split(";").map(Number)}}function Z(Qe){return{id:Qe.properties.id.toString(),isDefault:!!Qe.properties.is_default&&Qe.properties.is_default,connections:Qe.properties.connected_floor_ids?new Set(Qe.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Qe.properties.conflicted_floor_ids?new Set(Qe.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Qe.properties.building_ids?new Set(Qe.properties.building_ids.toString().split(";")):new Set,name:Qe.properties.name.toString(),zIndex:Qe.properties.z_index}}function $(Qe,oe){return oe.every(he=>Qe.properties&&Qe.properties[he]!=null)}function X(Qe){return $(Qe,["type","id","name"])&&Qe.properties.type==="building"}function Q(Qe){return $(Qe,["type","id","name","z_index"])&&Qe.properties.type==="floor"}a.fi(B,"GlyphAtlas");class re{constructor(oe){this.tileID=new a.aP(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=a.aY(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor,this.worldview=oe.worldview,this.indoor=oe.indoor}parse(oe,he,Ne,ze,Fe,We){this.status="parsing",this.data=oe,this.collisionBoxArray=new a.b2;const ct=new a.fl(Object.keys(oe.layers).sort()),Ye=new a.fm(this.tileID,this.promoteId);Ye.bucketLayerIDs=[];const at={},zt=new a.fn(256,256),At={featureIndex:Ye,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:zt,availableImages:Ne,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Ar=this.indoor.indoorState.activeFloorsVisible,mn=function(yn,Kn,li){const Xi=function(fs,Rn){if(!fs)return a.w("No source layers defined in indoor specification"),Rn;if(fs.size===0)return Rn;const zs=fs.difference(Rn);for(const ci of zs)a.w(`Missing source layer required in indoor specification: ${ci}`);return Rn.intersection(Rn)}(Kn.sourceLayers,new Set(Object.keys(yn.layers))),Ci=Kn.indoorState,bi=function(fs,Rn,zs,ci){const bs=new Set,Ks=new Set,da=new Set,ao=new Map,ml={},pd=Mi=>{const Ma=ao.get(Mi)||new Set;for(const za of bs)if((ao.get(za)||new Set).has(Mi)||Ma.has(za))return!0;return!1};for(const Mi of Rn){const Ma=fs.layers[Mi];if(Ma)for(let za=0;za<Ma.length;za++){const el=Ma.feature(za);if(X(el)){const{id:Uo,center:Bs}=K(el);V(ml,Uo,Bs),bs.add(Uo)}else if(Q(el)){const{id:Uo,isDefault:Bs,connections:md,conflicts:du,buildings:hu,name:yf,zIndex:Eo}=Z(el);W(ml,hu,Uo,{name:yf,zIndex:Eo}),ao.set(Uo,du),(Uo===ci||md.has(ci))&&bs.add(Uo),Ks.add(Uo),Bs&&da.add(Uo)}}else a.w(`indoor source layer not found: ${Mi}`)}if(zs)for(const Mi of zs)Ks.has(Mi)&&(pd(Mi)||bs.add(Mi));for(const Mi of da)bs.has(Mi)||pd(Mi)||bs.add(Mi);return{buildings:ml,activeFloors:bs}}(yn,Xi,Ci.lastActiveFloors,Ci.selectedFloorId);return li.send("setIndoorData",bi),bi}(oe,this.indoor,Fe);At.activeFloors=Ar?mn.activeFloors:void 0}const br=[],Kr=he.familiesBySource[this.source];for(const Ar in Kr){const mn=oe.layers[Ar];if(!mn)continue;let yn=!1,Kn=!1,li=!1;for(const fs of Kr[Ar])fs[0].type==="symbol"?yn=!0:Kn=!0,fs[0].is3D()&&fs[0].type!=="model"&&(li=!0);if(this.extraShadowCaster&&!li||this.isSymbolTile===!0&&!yn||this.isSymbolTile===!1&&!Kn)continue;mn.version===1&&a.w(`Vector tile source "${this.source}" layer "${Ar}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xi=ct.encode(Ar),Ci=[];let bi=!1;for(let fs=0,Rn=0;fs<mn.length;fs++){const zs=mn.feature(fs),ci=Ye.getId(zs,Ar);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ar)){const bs=zs.properties?zs.properties.worldview:null;if(this.worldview&&typeof bs=="string")if(bs==="all")zs.properties.$localized=!0;else{if(!bs.split(",").includes(this.worldview))continue;zs.properties.$localized=!0,zs.properties.worldview=this.worldview}}!bi&&zs.properties&&zs.properties.hasOwnProperty(a.fo)&&(bi=!0),Ci.push({feature:zs,id:ci,index:Rn,sourceLayerIndex:Xi}),Rn++}bi&&!At.elevationFeatures&&oe.layers.hasOwnProperty(a.fp)&&(At.elevationFeatures=a.fq.parseFrom(oe.layers[a.fp],this.canonical));for(const fs of Kr[Ar]){const Rn=fs[0];if(this.extraShadowCaster&&(!Rn.is3D()||Rn.type==="model")||this.isSymbolTile!==void 0&&Rn.type==="symbol"!==this.isSymbolTile||Rn.minzoom&&this.zoom<Math.floor(Rn.minzoom)||Rn.maxzoom&&this.zoom>=Rn.maxzoom||Rn.visibility==="none")continue;ve(fs,this.zoom,At.brightness,Ne,this.worldview);const zs=at[Rn.id]=Rn.createBucket({index:Ye.bucketLayerIDs.length,layers:fs,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ze,worldview:this.worldview});Ye.bucketLayerIDs.push(fs.map(bs=>a.B(bs.id,bs.scope)));let ci=zs.prepare?zs.prepare():null;ci!=null?(ci=ci.then(()=>zs.populate(Ci,At,this.tileID.canonical,this.tileTransform)),br.push(ci)):zs.populate(Ci,At,this.tileID.canonical,this.tileTransform)}}const Fr=()=>{let Ar,mn,yn,Kn,li,Xi;zt.trim();const Ci={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},bi=()=>{if(Ar)return this.status="done",We(Ar);if(this.extraShadowCaster)this.status="done",We(null,{buckets:Object.values(at).filter(Rn=>!Rn.isEmpty()),featureIndex:Ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:At.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(mn&&yn&&Kn){const Rn=new B(mn),zs=new Map;for(const[Ks,da]of yn.entries()){const{imagePosition:ao}=a.ft(Ks,da,a.fu);zs.set(Ks,ao)}const ci={};for(const Ks in at){const da=at[Ks];da instanceof a.b3&&(ve(da.layers,this.zoom,At.brightness,Ne,this.worldview),ci[Ks]=a.fv(da,mn,Rn.positions,yn,zs,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,li,this.worldview))}const bs={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Fe,yn,li,()=>{bs.iconsPending=!1,fs(ci,Rn,bs)}),this.rasterizeIfNeeded(Fe,Kn,Xi,()=>{bs.patternsPending=!1,fs(ci,Rn,bs)})}},fs=(Rn,zs,ci,bs)=>{if(ci.iconsPending||ci.patternsPending)return;const Ks=new a.fw(yn,Kn,this.lut);for(const da in at){const ao=at[da];if(da in Rn)a.fx(ao,Rn[da],this.showCollisionBoxes,Ne,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,yn,Ks);else if(ao.hasPattern&&(ao instanceof a.b9||ao instanceof a.ba||ao instanceof a.e9)){ve(ao.layers,this.zoom,At.brightness,Ne,this.worldview);const ml=Object.fromEntries(Ks.patternPositions);ao.addFeatures(At,this.tileID.canonical,ml,Ne,this.tileTransform,this.brightness)}}this.status="done",We(null,{buckets:Object.values(at).filter(da=>!da.isEmpty()),featureIndex:Ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zs.image,lineAtlas:zt,imageAtlas:Ks,brightness:At.brightness})};if(!this.extraShadowCaster){const Rn=a.fr(At.glyphDependencies,bs=>Object.keys(bs).map(Number));Object.keys(Rn).length?Fe.send("getGlyphs",{uid:this.uid,stacks:Rn},(bs,Ks)=>{Ar||(Ar=bs,mn=Ks,bi())},void 0,!1,Ci):mn={};const zs=Array.from(At.iconDependencies.keys()).map(bs=>a.I.parse(bs));zs.length?Fe.send("getImages",{images:zs,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(bs,Ks)=>{Ar||(Ar=bs,yn=new Map,li=this.updateImageMapAndGetImageTaskQueue(yn,Ks,At.iconDependencies),bi())},void 0,!1,Ci):(yn=new Map,li=new Map);const ci=Array.from(At.patternDependencies.keys()).map(bs=>a.I.parse(bs));ci.length?Fe.send("getImages",{images:ci,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(bs,Ks)=>{Ar||(Ar=bs,Kn=new Map,Xi=this.updateImageMapAndGetImageTaskQueue(Kn,Ks,At.patternDependencies),bi())},void 0,!1,Ci):(Kn=new Map,Xi=new Map)}if(At.elevationFeatures&&At.elevationFeatures.length>0){const Rn=[];for(const ci of Object.values(at))if(ci instanceof a.ba){const bs=ci.getUnevaluatedPortalGraph();bs&&Rn.push(bs)}const zs=a.fs.evaluate(Rn);for(const ci of Object.values(at))if(ci instanceof a.ba){const bs=oe.layers[ct.decode(ci.sourceLayerIndex)];ci.setEvaluatedPortalGraph(zs,bs,this.tileID.canonical,At.availableImages,At.brightness)}}bi()};br.length>0?Promise.allSettled(br).then(Fr).catch(We):Fr()}updateParameters(oe){this.scaleFactor=oe.scaleFactor,this.showCollisionBoxes=oe.showCollisionBoxes,this.projection=oe.projection,this.brightness=oe.brightness,this.tileTransform=a.aY(oe.tileID.canonical,oe.projection),this.extraShadowCaster=oe.extraShadowCaster,this.lut=oe.lut,this.worldview=oe.worldview,this.indoor=oe.indoor}rasterizeIfNeeded(oe,he,Ne,ze){Array.from(he.values()).some(Fe=>Fe.usvg)?this.rasterize(oe,he,Ne,ze):ze()}updateImageMapAndGetImageTaskQueue(oe,he,Ne){const ze=new Map;for(const Fe of he.keys()){const We=Ne.get(Fe)||[];for(const ct of We){const Ye=ct.toString(),at=he.get(ct.id.toString());at.usvg?ze.has(Ye)||(ze.set(Ye,ct),oe.set(Ye,Object.assign({},at))):oe.set(Ye,at)}}return ze}rasterize(oe,he,Ne,ze){this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,tasks:Ne},(Fe,We)=>{if(!Fe)for(const[ct,Ye]of We.entries()){const at=Object.assign(he.get(ct),{data:Ye});he.set(ct,at)}ze()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ve(Qe,oe,he,Ne,ze){const Fe=new a.ac(oe,{brightness:he,worldview:ze});for(const We of Qe)We.recalculate(Fe,Ne)}class pe extends a.E{constructor(oe,he,Ne,ze,Fe,We,ct){super(),this.actor=oe,this.layerIndex=he,this.availableImages=Ne,this.availableModels=ze,this.loadVectorData=We||a.aL,this.loading={},this.loaded={},this.deduped=new a.aK(oe.scheduler),this.isSpriteLoaded=Fe,this.scheduler=oe.scheduler,this.brightness=ct}loadTile(oe,he){const Ne=oe.uid,ze=oe&&oe.request,Fe=ze&&ze.collectResourceTiming,We=this.loading[Ne]=new re(oe);We.abort=this.loadVectorData(oe,(ct,Ye)=>{const at=!this.loading[Ne];if(delete this.loading[Ne],We.cancelRasterize(),at||ct||!Ye)return We.status="done",at||(this.loaded[Ne]=We),he(ct);const zt=Ye.rawData,At={},br=a.aM(Ye.responseHeaders);br&&br.expires&&(At.expires=br.expires),br&&br.cacheControl&&(At.cacheControl=br.cacheControl),We.vectorTile=Ye.vectorTile||new a.fy(new a.bs(zt));const Kr=()=>{We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Fr,Ar)=>{if(Fr||!Ar)return he(Fr);const mn={};if(Fe){const yn=w(ze);yn.length>0&&(mn.resourceTiming=JSON.parse(JSON.stringify(yn)))}he(null,Object.assign({rawTileData:zt.slice(0),responseHeaders:Ye.responseHeaders},Ar,At,mn))})};this.isSpriteLoaded?Kr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Kr,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):Kr()}),this.loaded=this.loaded||{},this.loaded[Ne]=We})}reloadTile(oe,he){const Ne=this.loaded,ze=oe.uid;if(Ne&&Ne[ze]){const Fe=Ne[ze];Fe.updateParameters(oe);const We=(ct,Ye)=>{const at=Fe.reloadCallback;at&&(delete Fe.reloadCallback,Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at)),he(ct,Ye)};Fe.status==="parsing"?Fe.reloadCallback=We:Fe.status==="done"&&(Fe.vectorTile?Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,We):We())}else he(null,void 0)}abortTile(oe,he){const Ne=oe.uid,ze=this.loading[Ne];ze&&(ze.abort&&ze.abort(),delete this.loading[Ne]),he()}removeTile(oe,he){const Ne=this.loaded,ze=oe.uid;Ne&&Ne[ze]&&delete Ne[ze],he()}}class ue{loadTile(oe,he){const{uid:Ne,encoding:ze,rawImageData:Fe,padding:We}=oe,ct=ImageBitmap&&Fe instanceof ImageBitmap?this.getImageData(Fe,We):Fe;he(null,new a.fz(Ne,ct,ze,We<1))}reloadTile(oe,he){he(null,null)}abortTile(oe,he){he()}removeTile(oe,he){he()}getImageData(oe,he){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const Ne=this.offscreenCanvasContext.getImageData(-he,-he,oe.width+2*he,oe.height+2*he);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ne}}a.br.setPbf(a.bs);class ge{constructor(oe){this._mrt=new a.br(oe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=oe.uid,this.tileID=oe.tileID,this.source=oe.source}parse(oe,he){const Ne=this._mrt;this.status="parsing",this._entireBuffer=oe;try{Ne.parseHeader(oe),this._isHeaderLoaded=!0;const ze=[];for(const Fe in Ne.layers){const We=Ne.getLayer(Fe),ct=We.getDataRange(We.getBandList()),Ye=Ne.createDecodingTask(ct),at=oe.slice(ct.firstByte,ct.lastByte+1),zt=a.br.performDecoding(at,Ye).then(At=>Ye.complete(null,At)).catch(At=>Ye.complete(At,null));ze.push(zt)}Promise.allSettled(ze).then(()=>he(null,Ne)).catch(Fe=>he(Fe))}catch(ze){he(ze)}}}class ce{constructor(oe){this.actor=oe,this.loading={},this.loaded={}}loadTile(oe,he){const Ne=oe.uid,ze=oe.request,Fe=this.loading[Ne]=new ge(oe),{cancel:We}=a.bt(ze,(ct,Ye,at)=>{const zt=!this.loading[Ne];if(delete this.loading[Ne],zt||ct||!Ye)return Fe.status="done",zt||(this.loaded[Ne]=Fe),he(ct);Fe.parse(Ye,(At,br)=>{if(At||!br)return he(At);he(null,br,at)}),this.loaded[Ne]=Fe});Fe.abort=We}reloadTile(oe,he){he(null,void 0)}abortTile(oe,he){const Ne=oe.uid,ze=this.loading[Ne];ze&&(ze.abort&&ze.abort(),delete this.loading[Ne]),he()}removeTile(oe,he){const Ne=oe.uid;this.loaded[Ne]&&delete this.loaded[Ne],he()}decodeRasterArray(oe,he){a.br.performDecoding(oe.buffer,oe.task).then(Ne=>he(null,Ne)).catch(Ne=>he(Ne))}}const Se=a.fA.prototype.toGeoJSON;class le{constructor(oe){this._feature=oe,this.extent=a.al,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const he of this._feature.geometry)oe.push([new a.P(he[0],he[1])]);return oe}{const oe=[];for(const he of this._feature.geometry){const Ne=[];for(const ze of he)Ne.push(new a.P(ze[0],ze[1]));oe.push(Ne)}return oe}}toGeoJSON(oe,he,Ne){return Se.call(this,oe,he,Ne)}}class J{constructor(oe,he){this.name=oe,this.extent=a.al,this.length=he.length,this._jsonFeatures=he}feature(oe){return new le(this._jsonFeatures[oe])}}class ke{constructor(oe){this.layers={},this.extent=a.al;for(const he of Object.keys(oe))this.layers[he]=new J(he,oe[he])}}const Ze=64/4096,Xe=128;class qe{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],he){for(const Ne of oe){const ze=Ne.id;if(ze==null)continue;let Fe=this.features.get(ze);Fe&&this.updateCache(Fe,he),Ne.geometry?(Fe=st(Ne),this.updateCache(Fe,he),this.features.set(ze,Fe)):this.features.delete(ze),this.updateCache(Fe,he)}}updateCache(oe,he){for(const{canonical:Ne,uid:ze}of Object.values(he)){const{z:Fe,x:We,y:ct}=Ne;$e(oe,Math.pow(2,Fe),We,ct)&&delete he[ze]}}getTile(oe,he,Ne){const ze=Math.pow(2,oe),Fe=[];for(const We of this.features.values())$e(We,ze,he,Ne)&&Fe.push(St(We,ze,he,Ne));return{features:Fe}}getFeatures(){return[...this.features.values()]}}function $e({minX:Qe,minY:oe,maxX:he,maxY:Ne},ze,Fe,We){return Qe<(Fe+1+Ze)/ze&&oe<(We+1+Ze)/ze&&he>(Fe-Ze)/ze&&Ne>(We-Ze)/ze}function st(Qe){const{id:oe,geometry:he,properties:Ne}=Qe;if(!he)return;if(he.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ze,coordinates:Fe}=he,We={id:oe,type:1,geometry:[],tags:Ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ct=We.geometry;if(ze==="Point")it(Fe,ct,We);else if(ze==="MultiPoint")for(const Ye of Fe)it(Ye,ct,We);else if(ze==="LineString")We.type=2,Mt(Fe,ct,We);else if(ze==="MultiLineString")We.type=2,ar(Fe,ct,We);else if(ze==="Polygon")We.type=3,ar(Fe,ct,We,!0);else{if(ze!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");We.type=3;for(const Ye of Fe)ar(Ye,ct,We,!0)}return We}function it([Qe,oe],he,Ne){const ze=a.aF(Qe);let Fe=a.aJ(oe);Fe=Fe<0?0:Fe>1?1:Fe,he.push(ze,Fe),Ne.minX=Math.min(Ne.minX,ze),Ne.minY=Math.min(Ne.minY,Fe),Ne.maxX=Math.max(Ne.maxX,ze),Ne.maxY=Math.max(Ne.maxY,Fe)}function Mt(Qe,oe,he,Ne=!1,ze=!1){const Fe=[];for(const We of Qe)it(We,Fe,he);oe.push(Fe),Ne&&function(We,ct){let Ye=0;for(let at=0,zt=We.length,At=zt-2;at<zt;At=at,at+=2)Ye+=(We[at]-We[At])*(We[at+1]+We[At+1]);if(Ye>0===ct)for(let at=0,zt=We.length;at<zt/2;at+=2){const At=We[at],br=We[at+1];We[at]=We[zt-2-at],We[at+1]=We[zt-1-at],We[zt-2-at]=At,We[zt-1-at]=br}}(Fe,ze)}function ar(Qe,oe,he,Ne=!1){for(let ze=0;ze<Qe.length;ze++)Mt(Qe[ze],oe,he,Ne,ze===0)}function St(Qe,oe,he,Ne){const{id:ze,type:Fe,geometry:We,tags:ct}=Qe,Ye=[];if(Fe===1)(function(at,zt,At,br,Kr){for(let Fr=0;Fr<at.length;Fr+=2){const Ar=Math.round(a.al*(at[Fr+0]*zt-At)),mn=Math.round(a.al*(at[Fr+1]*zt-br));Kr.push([Ar,mn])}})(We,oe,he,Ne,Ye);else for(const at of We)Xt(at,oe,he,Ne,Ye);return{id:ze,type:Fe,geometry:Ye,tags:ct}}function Xt(Qe,oe,he,Ne,ze){const Fe=-Xe,We=a.al+Xe;let ct;for(let Ye=0;Ye<Qe.length-2;Ye+=2){let at=Math.round(a.al*(Qe[Ye+0]*oe-he)),zt=Math.round(a.al*(Qe[Ye+1]*oe-Ne)),At=Math.round(a.al*(Qe[Ye+2]*oe-he)),br=Math.round(a.al*(Qe[Ye+3]*oe-Ne));const Kr=At-at,Fr=br-zt;at<Fe&&At<Fe||(at<Fe?(zt+=Math.round(Fr*((Fe-at)/Kr)),at=Fe):At<Fe&&(br=zt+Math.round(Fr*((Fe-at)/Kr)),At=Fe),zt<Fe&&br<Fe||(zt<Fe?(at+=Math.round(Kr*((Fe-zt)/Fr)),zt=Fe):br<Fe&&(At=at+Math.round(Kr*((Fe-zt)/Fr)),br=Fe),at>=We&&At>=We||(at>=We?(zt+=Math.round(Fr*((We-at)/Kr)),at=We):At>=We&&(br=zt+Math.round(Fr*((We-at)/Kr)),At=We),zt>=We&&br>=We||(zt>=We?(at+=Math.round(Kr*((We-zt)/Fr)),zt=We):br>=We&&(At=at+Math.round(Kr*((We-zt)/Fr)),br=We),ct&&at===ct[ct.length-1][0]&&zt===ct[ct.length-1][1]||(ct=[[at,zt]],ze.push(ct)),ct.push([At,br])))))}}function dt({name:Qe,features:oe},he){he.writeStringField(1,Qe),he.writeVarintField(5,a.al);const Ne=new Map,ze=new Map,Fe={keys:Ne,values:ze,feature:null};for(const We of oe)Fe.feature=We,he.writeMessage(2,ft,Fe);for(const We of Ne.keys())he.writeStringField(3,We);for(const We of ze.keys())he.writeMessage(4,on,We)}function ft(Qe,oe){const he=Qe.feature;he.id!==void 0&&Number.isSafeInteger(+he.id)&&oe.writeVarintField(1,+he.id),he.tags&&oe.writeMessage(2,Wt,Qe),oe.writeVarintField(3,he.type),oe.writeMessage(4,Br,he)}function Wt({keys:Qe,values:oe,feature:he},Ne){for(const ze of Object.keys(he.tags)){let Fe=he.tags[ze];if(Fe===null)continue;let We=Qe.get(ze);We===void 0&&(We=Qe.size,Qe.set(ze,We)),Ne.writeVarint(We);const ct=typeof Fe;ct!=="string"&&ct!=="boolean"&&ct!=="number"&&(Fe=JSON.stringify(Fe));let Ye=oe.get(Fe);Ye===void 0&&(Ye=oe.size,oe.set(Fe,Ye)),Ne.writeVarint(Ye)}}function Wr(Qe,oe){return(oe<<3)+(7&Qe)}function jr(Qe){return Qe<<1^Qe>>31}function Br(Qe,oe){const{geometry:he,type:Ne}=Qe;let ze=0,Fe=0;if(Ne===1){oe.writeVarint(Wr(1,he.length));for(const We of he){const ct=We[0]-ze,Ye=We[1]-Fe;oe.writeVarint(jr(ct)),oe.writeVarint(jr(Ye)),ze+=ct,Fe+=Ye}}else for(const We of he){oe.writeVarint(Wr(1,1));const ct=We.length-(Ne===3?1:0);for(let Ye=0;Ye<ct;Ye++){Ye===1&&oe.writeVarint(Wr(2,ct-1));const at=We[Ye][0]-ze,zt=We[Ye][1]-Fe;oe.writeVarint(jr(at)),oe.writeVarint(jr(zt)),ze+=at,Fe+=zt}Ne===3&&oe.writeVarint(Wr(7,1))}}function on(Qe,oe){const he=typeof Qe;he==="string"?oe.writeStringField(1,Qe):he==="boolean"?oe.writeBooleanField(7,Qe):he==="number"&&(Qe%1!=0?oe.writeDoubleField(3,Qe):Qe<0?oe.writeSVarintField(6,Qe):oe.writeVarintField(5,Qe))}const Zn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Qe=>Qe},ln=Math.fround||(dr=new Float32Array(1),Qe=>(dr[0]=+Qe,dr[0]));var dr;const Vr=3,nn=5,Ln=6;class Je{constructor(oe){this.options=Object.assign(Object.create(Zn),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:he,minZoom:Ne,maxZoom:ze}=this.options;he&&console.time("total time");const Fe=`prepare ${oe.length} points`;he&&console.time(Fe),this.points=oe;const We=[];for(let Ye=0;Ye<oe.length;Ye++){const at=oe[Ye];if(!at.geometry)continue;const[zt,At]=at.geometry.coordinates,br=ln(or(zt)),Kr=ln(xr(At));We.push(br,Kr,1/0,Ye,-1,1),this.options.reduce&&We.push(0)}let ct=this.trees[ze+1]=this._createTree(We);he&&console.timeEnd(Fe);for(let Ye=ze;Ye>=Ne;Ye--){const at=+Date.now();ct=this.trees[Ye]=this._createTree(this._cluster(ct,Ye)),he&&console.log("z%d: %d clusters in %dms",Ye,ct.numItems,+Date.now()-at)}return he&&console.timeEnd("total time"),this}getClusters(oe,he){let Ne=((oe[0]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,oe[1]));let Fe=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)Ne=-180,Fe=180;else if(Ne>Fe){const At=this.getClusters([Ne,ze,180,We],he),br=this.getClusters([-180,ze,Fe,We],he);return At.concat(br)}const ct=this.trees[this._limitZoom(he)],Ye=ct.range(or(Ne),xr(We),or(Fe),xr(ze)),at=ct.data,zt=[];for(const At of Ye){const br=this.stride*At;zt.push(at[br+nn]>1?xt(at,br,this.clusterProps):this.points[at[br+Vr]])}return zt}getChildren(oe){const he=this._getOriginId(oe),Ne=this._getOriginZoom(oe),ze="No cluster with the specified id.",Fe=this.trees[Ne];if(!Fe)throw new Error(ze);const We=Fe.data;if(he*this.stride>=We.length)throw new Error(ze);const ct=this.options.radius/(this.options.extent*Math.pow(2,Ne-1)),Ye=Fe.within(We[he*this.stride],We[he*this.stride+1],ct),at=[];for(const zt of Ye){const At=zt*this.stride;We[At+4]===oe&&at.push(We[At+nn]>1?xt(We,At,this.clusterProps):this.points[We[At+Vr]])}if(at.length===0)throw new Error(ze);return at}getLeaves(oe,he,Ne){const ze=[];return this._appendLeaves(ze,oe,he=he||10,Ne=Ne||0,0),ze}getTile(oe,he,Ne){const ze=this.trees[this._limitZoom(oe)],Fe=Math.pow(2,oe),{extent:We,radius:ct}=this.options,Ye=ct/We,at=(Ne-Ye)/Fe,zt=(Ne+1+Ye)/Fe,At={features:[]};return this._addTileFeatures(ze.range((he-Ye)/Fe,at,(he+1+Ye)/Fe,zt),ze.data,he,Ne,Fe,At),he===0&&this._addTileFeatures(ze.range(1-Ye/Fe,at,1,zt),ze.data,Fe,Ne,Fe,At),he===Fe-1&&this._addTileFeatures(ze.range(0,at,Ye/Fe,zt),ze.data,-1,Ne,Fe,At),At.features.length?At:null}getClusterExpansionZoom(oe){let he=this._getOriginZoom(oe)-1;for(;he<=this.options.maxZoom;){const Ne=this.getChildren(oe);if(he++,Ne.length!==1)break;oe=Ne[0].properties.cluster_id}return he}_appendLeaves(oe,he,Ne,ze,Fe){const We=this.getChildren(he);for(const ct of We){const Ye=ct.properties;if(Ye&&Ye.cluster?Fe+Ye.point_count<=ze?Fe+=Ye.point_count:Fe=this._appendLeaves(oe,Ye.cluster_id,Ne,ze,Fe):Fe<ze?Fe++:oe.push(ct),oe.length===Ne)break}return Fe}_createTree(oe){const he=new a.c3(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ne=0;Ne<oe.length;Ne+=this.stride)he.add(oe[Ne],oe[Ne+1]);return he.finish(),he.data=oe,he}_addTileFeatures(oe,he,Ne,ze,Fe,We){for(const ct of oe){const Ye=ct*this.stride,at=he[Ye+nn]>1;let zt,At,br;if(at)zt=Ft(he,Ye,this.clusterProps),At=he[Ye],br=he[Ye+1];else{const Ar=this.points[he[Ye+Vr]];zt=Ar.properties;const[mn,yn]=Ar.geometry.coordinates;At=or(mn),br=xr(yn)}const Kr={type:1,geometry:[[Math.round(this.options.extent*(At*Fe-Ne)),Math.round(this.options.extent*(br*Fe-ze))]],tags:zt};let Fr;Fr=at||this.options.generateId?he[Ye+Vr]:this.points[he[Ye+Vr]].id,Fr!==void 0&&(Kr.id=Fr),We.features.push(Kr)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,he){const{radius:Ne,extent:ze,reduce:Fe,minPoints:We}=this.options,ct=Ne/(ze*Math.pow(2,he)),Ye=oe.data,at=[],zt=this.stride;for(let At=0;At<Ye.length;At+=zt){if(Ye[At+2]<=he)continue;Ye[At+2]=he;const br=Ye[At],Kr=Ye[At+1],Fr=oe.within(Ye[At],Ye[At+1],ct),Ar=Ye[At+nn];let mn=Ar;for(const yn of Fr){const Kn=yn*zt;Ye[Kn+2]>he&&(mn+=Ye[Kn+nn])}if(mn>Ar&&mn>=We){let yn,Kn=br*Ar,li=Kr*Ar,Xi=-1;const Ci=(At/zt<<5)+(he+1)+this.points.length;for(const bi of Fr){const fs=bi*zt;if(Ye[fs+2]<=he)continue;Ye[fs+2]=he;const Rn=Ye[fs+nn];Kn+=Ye[fs]*Rn,li+=Ye[fs+1]*Rn,Ye[fs+4]=Ci,Fe&&(yn||(yn=this._map(Ye,At,!0),Xi=this.clusterProps.length,this.clusterProps.push(yn)),Fe(yn,this._map(Ye,fs)))}Ye[At+4]=Ci,at.push(Kn/mn,li/mn,1/0,Ci,-1,mn),Fe&&at.push(Xi)}else{for(let yn=0;yn<zt;yn++)at.push(Ye[At+yn]);if(mn>1)for(const yn of Fr){const Kn=yn*zt;if(!(Ye[Kn+2]<=he)){Ye[Kn+2]=he;for(let li=0;li<zt;li++)at.push(Ye[Kn+li])}}}}return at}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,he,Ne){if(oe[he+nn]>1){const We=this.clusterProps[oe[he+Ln]];return Ne?Object.assign({},We):We}const ze=this.points[oe[he+Vr]].properties,Fe=this.options.map(ze);return Ne&&Fe===ze?Object.assign({},Fe):Fe}}function xt(Qe,oe,he){return{type:"Feature",id:Qe[oe+Vr],properties:Ft(Qe,oe,he),geometry:{type:"Point",coordinates:[(Ne=Qe[oe],360*(Ne-.5)),mr(Qe[oe+1])]}};var Ne}function Ft(Qe,oe,he){const Ne=Qe[oe+nn],ze=Ne>=1e4?`${Math.round(Ne/1e3)}k`:Ne>=1e3?Math.round(Ne/100)/10+"k":Ne,Fe=Qe[oe+Ln],We=Fe===-1?{}:Object.assign({},he[Fe]);return Object.assign(We,{cluster:!0,cluster_id:Qe[oe+Vr],point_count:Ne,point_count_abbreviated:ze})}function or(Qe){return Qe/360+.5}function xr(Qe){const oe=Math.sin(Qe*Math.PI/180),he=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return he<0?0:he>1?1:he}function mr(Qe){const oe=(180-360*Qe)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function sn(Qe,oe,he,Ne){let ze=Ne;const Fe=oe+(he-oe>>1);let We,ct=he-oe;const Ye=Qe[oe],at=Qe[oe+1],zt=Qe[he],At=Qe[he+1];for(let br=oe+3;br<he;br+=3){const Kr=Cs(Qe[br],Qe[br+1],Ye,at,zt,At);if(Kr>ze)We=br,ze=Kr;else if(Kr===ze){const Fr=Math.abs(br-Fe);Fr<ct&&(We=br,ct=Fr)}}ze>Ne&&(We-oe>3&&sn(Qe,oe,We,Ne),Qe[We+2]=ze,he-We>3&&sn(Qe,We,he,Ne))}function Cs(Qe,oe,he,Ne,ze,Fe){let We=ze-he,ct=Fe-Ne;if(We!==0||ct!==0){const Ye=((Qe-he)*We+(oe-Ne)*ct)/(We*We+ct*ct);Ye>1?(he=ze,Ne=Fe):Ye>0&&(he+=We*Ye,Ne+=ct*Ye)}return We=Qe-he,ct=oe-Ne,We*We+ct*ct}function ys(Qe,oe,he,Ne){const ze={id:Qe??null,type:oe,geometry:he,tags:Ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Es(ze,he);else if(oe==="Polygon")Es(ze,he[0]);else if(oe==="MultiLineString")for(const Fe of he)Es(ze,Fe);else if(oe==="MultiPolygon")for(const Fe of he)Es(ze,Fe[0]);return ze}function Es(Qe,oe){for(let he=0;he<oe.length;he+=3)Qe.minX=Math.min(Qe.minX,oe[he]),Qe.minY=Math.min(Qe.minY,oe[he+1]),Qe.maxX=Math.max(Qe.maxX,oe[he]),Qe.maxY=Math.max(Qe.maxY,oe[he+1])}function so(Qe,oe,he,Ne){if(!oe.geometry)return;const ze=oe.geometry.coordinates;if(ze&&ze.length===0)return;const Fe=oe.geometry.type,We=Math.pow(he.tolerance/((1<<he.maxZoom)*he.extent),2);let ct=[],Ye=oe.id;if(he.promoteId?Ye=oe.properties[he.promoteId]:he.generateId&&(Ye=Ne||0),Fe==="Point")io(ze,ct);else if(Fe==="MultiPoint")for(const at of ze)io(at,ct);else if(Fe==="LineString")Cl(ze,ct,We,!1);else if(Fe==="MultiLineString"){if(he.lineMetrics){for(const at of ze)ct=[],Cl(at,ct,We,!1),Qe.push(ys(Ye,"LineString",ct,oe.properties));return}Qo(ze,ct,We,!1)}else if(Fe==="Polygon")Qo(ze,ct,We,!0);else{if(Fe!=="MultiPolygon"){if(Fe==="GeometryCollection"){for(const at of oe.geometry.geometries)so(Qe,{id:Ye,geometry:at,properties:oe.properties},he,Ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const at of ze){const zt=[];Qo(at,zt,We,!0),ct.push(zt)}}Qe.push(ys(Ye,Fe,ct,oe.properties))}function io(Qe,oe){oe.push(Al(Qe[0]),kc(Qe[1]),0)}function Cl(Qe,oe,he,Ne){let ze,Fe,We=0;for(let Ye=0;Ye<Qe.length;Ye++){const at=Al(Qe[Ye][0]),zt=kc(Qe[Ye][1]);oe.push(at,zt,0),Ye>0&&(We+=Ne?(ze*zt-at*Fe)/2:Math.sqrt(Math.pow(at-ze,2)+Math.pow(zt-Fe,2))),ze=at,Fe=zt}const ct=oe.length-3;oe[2]=1,sn(oe,0,ct,he),oe[ct+2]=1,oe.size=Math.abs(We),oe.start=0,oe.end=oe.size}function Qo(Qe,oe,he,Ne){for(let ze=0;ze<Qe.length;ze++){const Fe=[];Cl(Qe[ze],Fe,he,Ne),oe.push(Fe)}}function Al(Qe){return Qe/360+.5}function kc(Qe){const oe=Math.sin(Qe*Math.PI/180),he=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return he<0?0:he>1?1:he}function zi(Qe,oe,he,Ne,ze,Fe,We,ct){if(Ne/=oe,Fe>=(he/=oe)&&We<Ne)return Qe;if(We<he||Fe>=Ne)return null;const Ye=[];for(const at of Qe){const zt=at.geometry;let At=at.type;const br=ze===0?at.minX:at.minY,Kr=ze===0?at.maxX:at.maxY;if(br>=he&&Kr<Ne){Ye.push(at);continue}if(Kr<he||br>=Ne)continue;let Fr=[];if(At==="Point"||At==="MultiPoint")Pl(zt,Fr,he,Ne,ze);else if(At==="LineString")hh(zt,Fr,he,Ne,ze,!1,ct.lineMetrics);else if(At==="MultiLineString")fl(zt,Fr,he,Ne,ze,!1);else if(At==="Polygon")fl(zt,Fr,he,Ne,ze,!0);else if(At==="MultiPolygon")for(const Ar of zt){const mn=[];fl(Ar,mn,he,Ne,ze,!0),mn.length&&Fr.push(mn)}if(Fr.length){if(ct.lineMetrics&&At==="LineString"){for(const Ar of Fr)Ye.push(ys(at.id,At,Ar,at.tags));continue}At!=="LineString"&&At!=="MultiLineString"||(Fr.length===1?(At="LineString",Fr=Fr[0]):At="MultiLineString"),At!=="Point"&&At!=="MultiPoint"||(At=Fr.length===3?"Point":"MultiPoint"),Ye.push(ys(at.id,At,Fr,at.tags))}}return Ye.length?Ye:null}function Pl(Qe,oe,he,Ne,ze){for(let Fe=0;Fe<Qe.length;Fe+=3){const We=Qe[Fe+ze];We>=he&&We<=Ne&&pl(oe,Qe[Fe],Qe[Fe+1],Qe[Fe+2])}}function hh(Qe,oe,he,Ne,ze,Fe,We){let ct=lu(Qe);const Ye=ze===0?oi:pa;let at,zt,At=Qe.start;for(let mn=0;mn<Qe.length-3;mn+=3){const yn=Qe[mn],Kn=Qe[mn+1],li=Qe[mn+2],Xi=Qe[mn+3],Ci=Qe[mn+4],bi=ze===0?yn:Kn,fs=ze===0?Xi:Ci;let Rn=!1;We&&(at=Math.sqrt(Math.pow(yn-Xi,2)+Math.pow(Kn-Ci,2))),bi<he?fs>he&&(zt=Ye(ct,yn,Kn,Xi,Ci,he),We&&(ct.start=At+at*zt)):bi>Ne?fs<Ne&&(zt=Ye(ct,yn,Kn,Xi,Ci,Ne),We&&(ct.start=At+at*zt)):pl(ct,yn,Kn,li),fs<he&&bi>=he&&(zt=Ye(ct,yn,Kn,Xi,Ci,he),Rn=!0),fs>Ne&&bi<=Ne&&(zt=Ye(ct,yn,Kn,Xi,Ci,Ne),Rn=!0),!Fe&&Rn&&(We&&(ct.end=At+at*zt),oe.push(ct),ct=lu(Qe)),We&&(At+=at)}let br=Qe.length-3;const Kr=Qe[br],Fr=Qe[br+1],Ar=ze===0?Kr:Fr;Ar>=he&&Ar<=Ne&&pl(ct,Kr,Fr,Qe[br+2]),br=ct.length-3,Fe&&br>=3&&(ct[br]!==ct[0]||ct[br+1]!==ct[1])&&pl(ct,ct[0],ct[1],ct[2]),ct.length&&oe.push(ct)}function lu(Qe){const oe=[];return oe.size=Qe.size,oe.start=Qe.start,oe.end=Qe.end,oe}function fl(Qe,oe,he,Ne,ze,Fe){for(const We of Qe)hh(We,oe,he,Ne,ze,Fe,!1)}function pl(Qe,oe,he,Ne){Qe.push(oe,he,Ne)}function oi(Qe,oe,he,Ne,ze,Fe){const We=(Fe-oe)/(Ne-oe);return pl(Qe,Fe,he+(ze-he)*We,1),We}function pa(Qe,oe,he,Ne,ze,Fe){const We=(Fe-he)/(ze-he);return pl(Qe,oe+(Ne-oe)*We,Fe,1),We}function cu(Qe,oe){const he=[];for(let Ne=0;Ne<Qe.length;Ne++){const ze=Qe[Ne],Fe=ze.type;let We;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")We=Rc(ze.geometry,oe);else if(Fe==="MultiLineString"||Fe==="Polygon"){We=[];for(const ct of ze.geometry)We.push(Rc(ct,oe))}else if(Fe==="MultiPolygon"){We=[];for(const ct of ze.geometry){const Ye=[];for(const at of ct)Ye.push(Rc(at,oe));We.push(Ye)}}he.push(ys(ze.id,Fe,We,ze.tags))}return he}function Rc(Qe,oe){const he=[];he.size=Qe.size,Qe.start!==void 0&&(he.start=Qe.start,he.end=Qe.end);for(let Ne=0;Ne<Qe.length;Ne+=3)he.push(Qe[Ne]+oe,Qe[Ne+1],Qe[Ne+2]);return he}function Fa(Qe,oe){if(Qe.transformed)return Qe;const he=1<<Qe.z,Ne=Qe.x,ze=Qe.y;for(const Fe of Qe.features){const We=Fe.geometry,ct=Fe.type;if(Fe.geometry=[],ct===1)for(let Ye=0;Ye<We.length;Ye+=2)Fe.geometry.push(_f(We[Ye],We[Ye+1],oe,he,Ne,ze));else for(let Ye=0;Ye<We.length;Ye++){const at=[];for(let zt=0;zt<We[Ye].length;zt+=2)at.push(_f(We[Ye][zt],We[Ye][zt+1],oe,he,Ne,ze));Fe.geometry.push(at)}}return Qe.transformed=!0,Qe}function _f(Qe,oe,he,Ne,ze,Fe){return[Math.round(he*(Qe*Ne-ze)),Math.round(he*(oe*Ne-Fe))]}function Bu(Qe,oe,he,Ne,ze){const Fe=oe===ze.maxZoom?0:ze.tolerance/((1<<oe)*ze.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:Qe.length,source:null,x:he,y:Ne,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ct of Qe)Rp(We,ct,Fe,ze);return We}function Rp(Qe,oe,he,Ne){const ze=oe.geometry,Fe=oe.type,We=[];if(Qe.minX=Math.min(Qe.minX,oe.minX),Qe.minY=Math.min(Qe.minY,oe.minY),Qe.maxX=Math.max(Qe.maxX,oe.maxX),Qe.maxY=Math.max(Qe.maxY,oe.maxY),Fe==="Point"||Fe==="MultiPoint")for(let ct=0;ct<ze.length;ct+=3)We.push(ze[ct],ze[ct+1]),Qe.numPoints++,Qe.numSimplified++;else if(Fe==="LineString")Mc(We,ze,Qe,he,!1,!1);else if(Fe==="MultiLineString"||Fe==="Polygon")for(let ct=0;ct<ze.length;ct++)Mc(We,ze[ct],Qe,he,Fe==="Polygon",ct===0);else if(Fe==="MultiPolygon")for(let ct=0;ct<ze.length;ct++){const Ye=ze[ct];for(let at=0;at<Ye.length;at++)Mc(We,Ye[at],Qe,he,!0,at===0)}if(We.length){let ct=oe.tags||null;if(Fe==="LineString"&&Ne.lineMetrics){ct={};for(const at in oe.tags)ct[at]=oe.tags[at];ct.mapbox_clip_start=ze.start/ze.size,ct.mapbox_clip_end=ze.end/ze.size}const Ye={geometry:We,type:Fe==="Polygon"||Fe==="MultiPolygon"?3:Fe==="LineString"||Fe==="MultiLineString"?2:1,tags:ct};oe.id!==null&&(Ye.id=oe.id),Qe.features.push(Ye)}}function Mc(Qe,oe,he,Ne,ze,Fe){const We=Ne*Ne;if(Ne>0&&oe.size<(ze?We:Ne))return void(he.numPoints+=oe.length/3);const ct=[];for(let Ye=0;Ye<oe.length;Ye+=3)(Ne===0||oe[Ye+2]>We)&&(he.numSimplified++,ct.push(oe[Ye],oe[Ye+1])),he.numPoints++;ze&&function(Ye,at){let zt=0;for(let At=0,br=Ye.length,Kr=br-2;At<br;Kr=At,At+=2)zt+=(Ye[At]-Ye[Kr])*(Ye[At+1]+Ye[Kr+1]);if(zt>0===at)for(let At=0,br=Ye.length;At<br/2;At+=2){const Kr=Ye[At],Fr=Ye[At+1];Ye[At]=Ye[br-2-At],Ye[At+1]=Ye[br-1-At],Ye[br-2-At]=Kr,Ye[br-1-At]=Fr}}(ct,Fe),Qe.push(ct)}const Rt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ua{constructor(oe,he){const Ne=(he=this.options=function(Fe,We){for(const ct in We)Fe[ct]=We[ct];return Fe}(Object.create(Rt),he)).debug;if(Ne&&console.time("preprocess data"),he.maxZoom<0||he.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(he.promoteId&&he.generateId)throw new Error("promoteId and generateId cannot be used together.");let ze=function(Fe,We){const ct=[];if(Fe.type==="FeatureCollection")for(let Ye=0;Ye<Fe.features.length;Ye++)so(ct,Fe.features[Ye],We,Ye);else so(ct,Fe.type==="Feature"?Fe:{geometry:Fe},We);return ct}(oe,he);this.tiles={},this.tileCoords=[],Ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",he.indexMaxZoom,he.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ze=function(Fe,We){const ct=We.buffer/We.extent;let Ye=Fe;const at=zi(Fe,1,-1-ct,ct,0,-1,2,We),zt=zi(Fe,1,1-ct,2+ct,0,-1,2,We);return(at||zt)&&(Ye=zi(Fe,1,-ct,1+ct,0,-1,2,We)||[],at&&(Ye=cu(at,1).concat(Ye)),zt&&(Ye=Ye.concat(cu(zt,-1)))),Ye}(ze,he),ze.length&&this.splitTile(ze,0,0,0),Ne&&(ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,he,Ne,ze,Fe,We,ct){const Ye=[oe,he,Ne,ze],at=this.options,zt=at.debug;for(;Ye.length;){ze=Ye.pop(),Ne=Ye.pop(),he=Ye.pop(),oe=Ye.pop();const At=1<<he,br=fh(he,Ne,ze);let Kr=this.tiles[br];if(!Kr&&(zt>1&&console.time("creation"),Kr=this.tiles[br]=Bu(oe,he,Ne,ze,at),this.tileCoords.push({z:he,x:Ne,y:ze}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",he,Ne,ze,Kr.numFeatures,Kr.numPoints,Kr.numSimplified),console.timeEnd("creation"));const Rn=`z${he}`;this.stats[Rn]=(this.stats[Rn]||0)+1,this.total++}if(Kr.source=oe,Fe==null){if(he===at.indexMaxZoom||Kr.numPoints<=at.indexMaxPoints)continue}else{if(he===at.maxZoom||he===Fe)continue;if(Fe!=null){const Rn=Fe-he;if(Ne!==We>>Rn||ze!==ct>>Rn)continue}}if(Kr.source=null,oe.length===0)continue;zt>1&&console.time("clipping");const Fr=.5*at.buffer/at.extent,Ar=.5-Fr,mn=.5+Fr,yn=1+Fr;let Kn=null,li=null,Xi=null,Ci=null,bi=zi(oe,At,Ne-Fr,Ne+mn,0,Kr.minX,Kr.maxX,at),fs=zi(oe,At,Ne+Ar,Ne+yn,0,Kr.minX,Kr.maxX,at);oe=null,bi&&(Kn=zi(bi,At,ze-Fr,ze+mn,1,Kr.minY,Kr.maxY,at),li=zi(bi,At,ze+Ar,ze+yn,1,Kr.minY,Kr.maxY,at),bi=null),fs&&(Xi=zi(fs,At,ze-Fr,ze+mn,1,Kr.minY,Kr.maxY,at),Ci=zi(fs,At,ze+Ar,ze+yn,1,Kr.minY,Kr.maxY,at),fs=null),zt>1&&console.timeEnd("clipping"),Ye.push(Kn||[],he+1,2*Ne,2*ze),Ye.push(li||[],he+1,2*Ne,2*ze+1),Ye.push(Xi||[],he+1,2*Ne+1,2*ze),Ye.push(Ci||[],he+1,2*Ne+1,2*ze+1)}}getTile(oe,he,Ne){oe=+oe,he=+he,Ne=+Ne;const ze=this.options,{extent:Fe,debug:We}=ze;if(oe<0||oe>24)return null;const ct=1<<oe,Ye=fh(oe,he=he+ct&ct-1,Ne);if(this.tiles[Ye])return Fa(this.tiles[Ye],Fe);We>1&&console.log("drilling down to z%d-%d-%d",oe,he,Ne);let at,zt=oe,At=he,br=Ne;for(;!at&&zt>0;)zt--,At>>=1,br>>=1,at=this.tiles[fh(zt,At,br)];return at&&at.source?(We>1&&(console.log("found parent tile z%d-%d-%d",zt,At,br),console.time("drilling down")),this.splitTile(at.source,zt,At,br,oe,he,Ne),We>1&&console.timeEnd("drilling down"),this.tiles[Ye]?Fa(this.tiles[Ye],Fe):null):null}}function fh(Qe,oe,he){return 32*((1<<Qe)*he+oe)+Qe}function uu(Qe,oe){const he=Qe.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);const Ne=this._geoJSONIndex.getTile(he.z,he.x,he.y);if(!Ne)return void oe(null,null);const ze=at=>at.tags&&"3d_elevation_id"in at.tags&&"source"in at.tags&&at.tags.source==="elevation",Fe=Ne.features.filter(at=>ze(at));let We={_geojsonTileLayer:Ne.features};Fe.length>0&&(We={_geojsonTileLayer:Ne.features.filter(at=>!ze(at)),hd_road_elevation:Fe});const ct=new ke(We),Ye=function(at){const zt=new a.bs;for(const At of Object.keys(at))zt.writeMessage(3,dt,{name:At,features:at[At]});return zt.finish()}(We).buffer;oe(null,{vectorTile:ct,rawData:Ye})}class Nn extends pe{constructor(oe,he,Ne,ze,Fe,We,ct){super(oe,he,Ne,ze,Fe,uu,ct),We&&(this.loadGeoJSON=We),this._dynamicIndex=new qe}loadData(oe,he){const Ne=oe&&oe.request,ze=Ne&&Ne.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(oe,(Fe,We)=>{if(Fe||!We)return he(Fe);if(typeof We!="object")return he(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){const Ye=a.U(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ye.result==="error")throw new Error(Ye.value.map(at=>`${at.key}: ${at.message}`).join(", "));We.features=We.features.filter(at=>Ye.value.evaluate({zoom:0},at))}oe.dynamic?(We.type==="Feature"&&(We={type:"FeatureCollection",features:[We]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(We.features,this.loaded),oe.cluster&&(We.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new Je(function({superclusterOptions:Ye,clusterProperties:at}){if(!at||!Ye)return Ye;const zt={},At={},br={accumulated:null,zoom:0},Kr={properties:null},Fr=Object.keys(at);for(const Ar of Fr){const[mn,yn]=at[Ar],Kn=a.U(yn),li=a.U(typeof mn=="string"?[mn,["accumulated"],["get",Ar]]:mn);zt[Ar]=Kn.value,At[Ar]=li.value}return Ye.map=Ar=>{Kr.properties=Ar;const mn={};for(const yn of Fr)mn[yn]=zt[yn].evaluate(br,Kr);return mn},Ye.reduce=(Ar,mn)=>{Kr.properties=mn;for(const yn of Fr)br.accumulated=Ar[yn],Ar[yn]=At[yn].evaluate(br,Kr)},Ye}(oe)).load(We.features):oe.dynamic?this._dynamicIndex:function(Ye,at){return new ua(Ye,at)}(We,oe.geojsonVtOptions)}catch(Ye){return he(Ye)}const ct={};if(ze){const Ye=w(Ne);Ye&&(ct.resourceTiming={},ct.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Ye)))}he(null,ct)}})}reloadTile(oe,he){const Ne=this.loaded;return Ne&&Ne[oe.uid]?oe.partial?he(null,void 0):super.reloadTile(oe,he):this.loadTile(oe,he)}loadGeoJSON(oe,he){if(oe.request)a.m(oe.request,he);else{if(typeof oe.data!="string")return he(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return he(null,JSON.parse(oe.data))}catch{return he(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(oe,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Ne){he(Ne)}}getClusterChildren(oe,he){try{he(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Ne){he(Ne)}}getClusterLeaves(oe,he){try{he(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Ne){he(Ne)}}}class _o{constructor(oe,he,Ne){this.tileID=new a.aP(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=he,this.worldview=Ne}parse(oe,he,Ne,ze){this.status="parsing";const Fe=new a.aP(Ne.tileID.overscaledZ,Ne.tileID.wrap,Ne.tileID.canonical.z,Ne.tileID.canonical.x,Ne.tileID.canonical.y),We=[],ct=he.familiesBySource[Ne.source],Ye=new a.fm(Fe,Ne.promoteId);Ye.bucketLayerIDs=[],Ye.is3DTile=!0,a.fB(oe).then(at=>{if(!at)return ze(new Error("Could not parse tile"));const zt=at.json.extensionsUsed&&at.json.extensionsUsed.includes("MAPBOX_mesh_features")||at.json.asset.extras&&at.json.asset.extras.MAPBOX_mesh_features,At=at.json.extensionsUsed&&at.json.extensionsUsed.includes("EXT_meshopt_compression"),br=new a.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Kr in ct)for(const Fr of ct[Kr]){const Ar=Fr[0];Ye.bucketLayerIDs.push(Fr.map(Kn=>a.B(Kn.id,Kn.scope))),Ar.recalculate(br,[]);const mn=a.fC(at,1/a.d6(Ne.tileID.canonical)),yn=new a.fD(Fr,mn,Fe,zt,At,this.brightness,Ye,this.worldview);zt||(yn.needsUpload=!0),We.push(yn),yn.evaluate(Ar)}this.status="done",ze(null,{buckets:We,featureIndex:Ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(at=>ze(new Error(at.message)))}}class Fg{constructor(oe,he,Ne,ze,Fe,We,ct,Ye){this.actor=oe,this.layerIndex=he,this.availableImages=Ne,this.availableModels=ze,this.brightness=ct,this.loading={},this.loaded={},this.worldview=Ye}loadTile(oe,he){const Ne=oe.uid,ze=this.loading[Ne]=new _o(oe,this.brightness,this.worldview);a.bt(oe.request,(Fe,We)=>{const ct=!this.loading[Ne];return delete this.loading[Ne],ct||Fe?(ze.status="done",ct||(this.loaded[Ne]=ze),he(Fe)):We&&We.byteLength!==0?void ze.parse(We,this.layerIndex,oe,(Ye,at)=>{ze.status="done",this.loaded=this.loaded||{},this.loaded[Ne]=ze,Ye||!at?he(Ye):he(null,at)}):(ze.status="done",this.loaded[Ne]=ze,he())})}reloadTile(oe,he){const Ne=this.loaded,ze=oe.uid;if(Ne&&Ne[ze]){const Fe=Ne[ze];Fe.projection=oe.projection,Fe.brightness=oe.brightness;const We=(ct,Ye)=>{Fe.reloadCallback&&(delete Fe.reloadCallback,this.loadTile(oe,he)),he(ct,Ye)};Fe.status==="parsing"?Fe.reloadCallback=We:Fe.status==="done"&&this.loadTile(oe,he)}}abortTile(oe,he){const Ne=oe.uid;this.loading[Ne]&&delete this.loading[Ne],he()}removeTile(oe,he){const Ne=this.loaded,ze=oe.uid;Ne&&Ne[ze]&&delete Ne[ze],he()}}class Dc{constructor(oe){this.self=oe,this.actor=new a.fF(oe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new a.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=a.cl({name:"mercator"}),this.workerSourceTypes={vector:pe,geojson:Nn,"raster-dem":ue,"raster-array":ce,"batched-model":Fg},this.workerSources={},this.self.registerWorkerSource=(he,Ne)=>{if(this.workerSourceTypes[he])throw new Error(`Worker source with name "${he}" already registered.`);this.workerSourceTypes[he]=Ne},this.self.registerRTLTextPlugin=he=>{if(a.fG.isParsed())throw new Error("RTL text plugin already registered.");a.fG.setState({pluginStatus:a.fH.parsed,pluginURL:a.fG.getPluginURL()}),a.fG.applyArabicShaping=he.applyArabicShaping,a.fG.processBidirectionalText=he.processBidirectionalText,a.fG.processStyledBidirectionalText=he.processStyledBidirectionalText;for(const Ne of this.rtlPluginParsingListeners)Ne(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(oe,he,Ne){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.availableModels[oe],delete this.workerSources[oe],Ne()}checkIfReady(oe,he,Ne){Ne()}setReferrer(oe,he){this.referrer=he}spriteLoaded(oe,he){this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={});const{scope:Ne,isLoaded:ze}=he;if(this.isSpriteLoaded[oe][Ne]=ze,this.workerSources[oe]&&this.workerSources[oe][Ne])for(const Fe in this.workerSources[oe][Ne]){const We=this.workerSources[oe][Ne][Fe];for(const ct in We){const Ye=We[ct];Ye instanceof pe&&(Ye.isSpriteLoaded=ze,Ye.fire(new a.z("isSpriteLoaded")))}}}setImages(oe,he,Ne){this.availableImages[oe]||(this.availableImages[oe]={});const{scope:ze,images:Fe}=he;if(this.availableImages[oe][ze]=Fe,this.workerSources[oe]&&this.workerSources[oe][ze]){for(const We in this.workerSources[oe][ze]){const ct=this.workerSources[oe][ze][We];for(const Ye in ct)ct[Ye].availableImages=Fe}Ne()}else Ne()}setModels(oe,{scope:he,models:Ne},ze){if(this.availableModels[oe]||(this.availableModels[oe]={}),this.availableModels[oe][he]=Ne,this.workerSources[oe]&&this.workerSources[oe][he]){for(const Fe in this.workerSources[oe][he]){const We=this.workerSources[oe][he][Fe];for(const ct in We)We[ct].availableModels=Ne}ze()}else ze()}setProjection(oe,he){this.projections[oe]=a.cl(he)}setBrightness(oe,he,Ne){this.brightness=he,Ne()}setWorldview(oe,he,Ne){this.worldview=he,Ne()}setLayers(oe,he,Ne){this.getLayerIndex(oe,he.scope).replace(he.layers,he.options),Ne()}updateLayers(oe,he,Ne){this.getLayerIndex(oe,he.scope).update(he.layers,he.removedIds,he.options),Ne()}loadTile(oe,he,Ne){he.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,he.type,he.source,he.scope).loadTile(he,Ne)}decodeRasterArray(oe,he,Ne){this.getWorkerSource(oe,he.type,he.source,he.scope).decodeRasterArray(he,Ne)}reloadTile(oe,he,Ne){he.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,he.type,he.source,he.scope).reloadTile(he,Ne)}abortTile(oe,he,Ne){this.getWorkerSource(oe,he.type,he.source,he.scope).abortTile(he,Ne)}removeTile(oe,he,Ne){this.getWorkerSource(oe,he.type,he.source,he.scope).removeTile(he,Ne)}removeSource(oe,he,Ne){if(!(this.workerSources[oe]&&this.workerSources[oe][he.scope]&&this.workerSources[oe][he.scope][he.type]&&this.workerSources[oe][he.scope][he.type][he.source]))return;const ze=this.workerSources[oe][he.scope][he.type][he.source];delete this.workerSources[oe][he.scope][he.type][he.source],ze.removeSource!==void 0?ze.removeSource(he,Ne):Ne()}loadWorkerSource(oe,he,Ne){try{this.self.importScripts(he.url),Ne()}catch(ze){Ne(ze.toString())}}syncRTLPluginState(oe,he,Ne){if(a.fG.isParsed())Ne(null,!0);else if(a.fG.isParsing())this.rtlPluginParsingListeners.push(Ne);else try{a.fG.setState(he);const ze=a.fG.getPluginURL();!a.fG.isLoaded()||a.fG.isParsed()||a.fG.isParsing()||ze==null||(a.fG.setState({pluginStatus:a.fH.parsing,pluginURL:a.fG.getPluginURL()}),this.self.importScripts(ze),a.fG.isParsed()?Ne(null,!0):this.rtlPluginParsingListeners.push(Ne))}catch(ze){Ne(ze.toString())}}setDracoUrl(oe,he){this.dracoUrl=he}getAvailableImages(oe,he){this.availableImages[oe]||(this.availableImages[oe]={});let Ne=this.availableImages[oe][he];return Ne||(Ne=[]),Ne}getAvailableModels(oe,he){this.availableModels[oe]||(this.availableModels[oe]={});let Ne=this.availableModels[oe][he];return Ne||(Ne={}),Ne}getLayerIndex(oe,he){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let Ne=this.layerIndexes[oe][he];return Ne||(Ne=this.layerIndexes[oe][he]=new P,Ne.scope=he),Ne}getWorkerSource(oe,he,Ne,ze){const Fe=this.workerSources;return Fe[oe]||(Fe[oe]={}),Fe[oe][ze]||(Fe[oe][ze]={}),Fe[oe][ze][he]||(Fe[oe][ze][he]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),Fe[oe][ze][he][Ne]||(Fe[oe][ze][he][Ne]=new this.workerSourceTypes[he]({send:(We,ct,Ye,at,zt,At)=>this.actor.send(We,ct,Ye,oe,zt,At),scheduler:this.actor.scheduler},this.getLayerIndex(oe,ze),this.getAvailableImages(oe,ze),this.getAvailableModels(oe,ze),this.isSpriteLoaded[oe][ze],void 0,this.brightness,this.worldview)),Fe[oe][ze][he][Ne]}rasterizeImagesWorker(oe,he,Ne){const ze=new Map;for(const[Fe,{image:We,imageVariant:ct}]of he.tasks.entries()){const Ye=this.imageRasterizer.rasterize(ct,We,he.scope,oe);ze.set(Fe,Ye)}Ne(void 0,ze)}removeRasterizedImages(oe,he,Ne){this.imageRasterizer.removeImagesFromCacheByIds(he.imageIds,he.scope,oe),Ne()}enforceCacheSizeLimit(oe,he){a.fI(he)}getWorkerPerformanceMetrics(oe,he,Ne){Ne(void 0,void 0)}}return a.fE(self)&&(self.worker=new Dc(self)),Dc}),d(["./shared"],function(a){var w="3.16.0";const E={create:"create",load:"load",fullLoad:"fullLoad"},C={mark(g){performance.mark(g)},measure(g,o,h){performance.measure(g,o,h)}};function P(g){const o=g.name.split("?")[0];return a.a(o)&&o.includes("mapbox-gl.js")?"javascript":a.a(o)&&o.includes("mapbox-gl.css")?"css":a.b(o)?"fontRange":a.c(o)?"sprite":a.i(o)?"style":a.d(o)?"tilejson":"other"}var R,B={},V=function(){if(R)return B;function g(_){return!o(_)}function o(_){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,T,I=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(I);try{T=new Worker(A),S=!0}catch{S=!1}return T&&T.terminate(),URL.revokeObjectURL(A),S}()?function(){var S=document.createElement("canvas");S.width=S.height=1;var T=S.getContext("2d");if(!T)return!1;var I=T.getImageData(0,0,1,1);return I&&I.width===S.width}()?(h[v=_&&_.failIfMajorPerformanceCaveat]===void 0&&(h[v]=function(S){var T,I=function(A){var L=document.createElement("canvas"),F=Object.create(g.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=A,L.getContext("webgl2",F)}(S);if(!I)return!1;try{T=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!T||I.isContextLost())&&(I.shaderSource(T,"void main() {}"),I.compileShader(T),I.getShaderParameter(T,I.COMPILE_STATUS)===!0)}(v)),h[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}R=1,B.supported=g,B.notSupportedReason=o;var h={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},B}();function W(g,o,h){const _=document.createElement(g);return o!=null&&(_.className=o),h&&h.appendChild(_),_}function K(g,o,h){const _=document.createElementNS("http://www.w3.org/2000/svg",g);for(const v of Object.keys(o))_.setAttributeNS(null,v,String(o[v]));return h&&h.appendChild(_),_}const Z=typeof document<"u"?document.documentElement&&document.documentElement.style:null,$=Z&&Z.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function Q(){Z&&$&&(X=Z[$],Z[$]="none")}function re(){Z&&$&&(Z[$]=X)}function ve(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",ve,!0)}function pe(){window.addEventListener("click",ve,!0),window.setTimeout(()=>{window.removeEventListener("click",ve,!0)},0)}function ue(g,o){const h=g.getBoundingClientRect();return Se(g,h,o)}function ge(g,o){const h=g.getBoundingClientRect(),_=[];for(let v=0;v<o.length;v++)_.push(Se(g,h,o[v]));return _}function ce(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&g.button===2&&g.ctrlKey?0:g.button}function Se(g,o,h){const _=g.offsetWidth===o.width?1:g.offsetWidth/o.width;return new a.P((h.clientX-o.left)*_,(h.clientY-o.top)*_)}const le="01",J="NO_ACCESS_TOKEN";class ke{constructor(o,h,_){this._transformRequestFn=o,this._customAccessToken=h,this._silenceAuthErrors=!!_,this._createSkuToken()}_createSkuToken(){const o=function(){let h="";for(let _=0;_<10;_++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",le,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeStyleURL(o,h){if(!a.h(o))return o;const _=Xe(o);return _.params.push(`sdk=js-${w}`),_.path=`/styles/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeGlyphsURL(o,h){if(!a.h(o))return o;const _=Xe(o);return _.path=`/fonts/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeModelURL(o,h){if(!a.h(o))return o;const _=Xe(o);return _.path=`/models/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||h)}normalizeSourceURL(o,h,_,v){if(!a.h(o))return o;const S=Xe(o);return S.path=`/v4/${S.authority}.json`,S.params.push("secure"),_&&S.params.push(`language=${_}`),v&&S.params.push(`worldview=${v}`),this._makeAPIURL(S,this._customAccessToken||h)}normalizeIconsetURL(o,h){const _=Xe(o);return a.h(o)?(_.path=`/styles/v1${_.path}/iconset.pbf`,this._makeAPIURL(_,this._customAccessToken||h)):qe(_)}normalizeSpriteURL(o,h,_,v){const S=Xe(o);return a.h(o)?(S.path=`/styles/v1${S.path}/sprite${h}${_}`,this._makeAPIURL(S,this._customAccessToken||v)):(S.path+=`${h}${_}`,qe(S))}normalizeTileURL(o,h,_){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!a.h(o))return o;const v=Xe(o);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||_&&v.authority!=="raster"&&_===512?"@2x":""}${a.k.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${a.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${a.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${a.e.TILE_URL_VERSION}${v.path}`);const S=this._customAccessToken||function(T){for(const I of T){const A=I.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(v.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&S&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,S)}canonicalizeTileURL(o,h){const _=Xe(o);if(!_.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_.path.match(/\.[\w]+$/))return o;let v="mapbox://";_.path.match(/^\/raster\/v1\//)?v+=`raster/${_.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:_.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${_.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${_.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let S=_.params;return h&&(S=S.filter(T=>!T.match(/^access_token=/))),S.length&&(v+=`?${S.join("&")}`),v}canonicalizeTileset(o,h){const _=!!h&&a.h(h),v=[];for(const S of o.tiles||[])a.j(S)?v.push(this.canonicalizeTileURL(S,_)):v.push(S);return v}_makeAPIURL(o,h){const _="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=Xe(a.e.API_URL);if(o.protocol=v.protocol,o.authority=v.authority,o.protocol==="http"){const S=o.params.indexOf("secure");S>=0&&o.params.splice(S,1)}if(v.path!=="/"&&(o.path=`${v.path}${o.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return qe(o);if(h=h||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${_}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_}`)}return o.params=o.params.filter(S=>S.indexOf("access_token")===-1),o.params.push(`access_token=${h||""}`),qe(o)}}const Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Xe(g){const o=g.match(Ze);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function qe(g){const o=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${o}`}const $e="mapbox.eventData";function st(g){if(!g)return null;const o=g.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(a.l(o[1]))}catch{return null}}class it{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const h=st(a.e.ACCESS_TOKEN);let _="";return _=h&&h.u?a.f(h.u):a.e.ACCESS_TOKEN||"",o?`${$e}.${o}:${_}`:`${$e}:${_}`}fetchEventData(){const o=a.s("localStorage"),h=this.getStorageKey(),_=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp");if(o)try{const S=localStorage.getItem(h);S&&(this.eventData=JSON.parse(S));const T=localStorage.getItem(_);T&&(this.anonId=T);const I=localStorage.getItem(v);I&&(this.anonIdTimestamp=Number(I));const A=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<A)&&this.refreshUUID()}catch{a.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=a.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const o=a.s("localStorage"),h=this.getStorageKey(),_=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp"),S=this.anonId,T=this.anonIdTimestamp;if(o&&S)try{localStorage.setItem(_,S),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData)),T&&localStorage.setItem(v,T.toString())}catch{a.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,h,_,v){if(!a.e.EVENTS_URL)return;const S=Xe(a.e.EVENTS_URL);S.params.push(`access_token=${v||a.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(o).toISOString()},I=h?Object.assign(T,h):T,A={url:qe(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=a.p(A,L=>{this.pendingRequest=null,_(L),this.saveEventData(),this.processRequests(v)})}queueRequest(o,h){this.queue.push(o),this.processRequests(h)}}const Mt=new class extends it{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,o){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some(h=>a.h(h)||a.j(h))&&this.queueRequest(Date.now(),o)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=st(a.e.ACCESS_TOKEN),h=o?o.u:a.e.ACCESS_TOKEN;let _=h!==this.eventData.tokenU;a.v(this.anonId)||(this.refreshUUID(),_=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const S=new Date(this.eventData.lastSuccess),T=new Date(v),I=(v-this.eventData.lastSuccess)/864e5;_=_||I>=1||I<-1||S.getDate()!==T.getDate()}else _=!0;_?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:le,"enabled.telemetry":!1,userId:this.anonId},S=>{S||(this.eventData.lastSuccess=v,this.eventData.tokenU=h)},g):this.processRequests()}},ar=Mt.postTurnstileEvent.bind(Mt),St=new class extends it{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,o,h,_){this.skuToken=o,this.errorCb=_,a.e.EVENTS_URL&&(h||a.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(J)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:h}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),a.v(this.anonId)||this.refreshUUID(),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:le,skuToken:this.skuToken,userId:this.anonId},_=>{_?this.errorCb(_):o&&(this.success[o]=!0)},g))}remove(){this.errorCb=null}},Xt=St.postMapLoadEvent.bind(St),dt=new class extends it{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let o=this.mapInstanceIdMap.get(g);return o||(o=a.u(),this.mapInstanceIdMap.set(g,o)),o}getEventId(g){const o=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,o+1),o}postStyleLoadEvent(g,o){const{map:h,style:_,importedStyles:v}=o;if(!a.e.EVENTS_URL||!g&&!a.e.ACCESS_TOKEN)return;const S=this.getMapInstanceId(h),T={mapInstanceId:S,eventId:this.getEventId(S),style:_};v.length&&(T.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:T},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:h}=this.queue.shift();this.postEvent(o,h,()=>{},g)}},ft=dt.postStyleLoadEvent.bind(dt),Wt=new class extends it{constructor(g){super("metrics"),g&&(this.data=g)}postMetricsEvent(g){if(!a.e.EVENTS_URL||!g&&!a.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),a.v(this.anonId)||this.refreshUUID();const o=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:o},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:h}=this.queue.shift();this.postEvent(o,h,()=>{},g)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Wr=Wt.postMetricsEvent.bind(Wt),jr=new class extends it{constructor(){super("gljs.performance")}postPerformanceEvent(g,o){a.e.EVENTS_URL&&(g||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:h}=this.queue.shift(),_=function(v){const S=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),I=function(Y){const te={};if(Y){for(const se in Y)if(se!=="other")for(const fe of Y[se]){const de=`${se}ResolveRangeMin`,_e=`${se}ResolveRangeMax`,Ee=`${se}RequestCount`,xe=`${se}RequestCachedCount`;te[de]=Math.min(te[de]||1/0,fe.startTime),te[_e]=Math.max(te[_e]||-1/0,fe.responseEnd);const Re=Te=>{te[Te]===void 0&&(te[Te]=0),++te[Te]};fe.transferSize!==void 0&&fe.transferSize===0&&Re(xe),Re(Ee)}}return te}(function(Y,te){const se={};if(Y)for(const fe of Y){const de=te(fe);se[de]===void 0&&(se[de]=[]),se[de].push(fe)}return se}(S,P)),A=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=L?L.effectiveType:void 0,H={counters:[],metadata:[],attributes:[]},U=(Y,te,se)=>{se!=null&&Y.push({name:te,value:se.toString()})};for(const Y in I)U(H.counters,Y,I[Y]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(U(H.counters,"interactionRangeMin",v.interactionRange[0]),U(H.counters,"interactionRangeMax",v.interactionRange[1])),T)for(const Y of Object.values(E)){const te=T.find(se=>se.name===Y);te&&U(H.counters,Y,te.startTime)}return U(H.counters,"visibilityHidden",v.visibilityHidden),U(H.attributes,"style",function(Y){if(Y)for(const te of Y){const se=te.name.split("?")[0];if(a.i(se)){const fe=se.split("/").slice(-2);if(fe.length===2)return`mapbox://styles/${fe[0]}/${fe[1]}`}}}(S)),U(H.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),U(H.attributes,"fogEnabled",v.fogEnabled?"true":"false"),U(H.attributes,"projection",v.projection),U(H.attributes,"zoom",v.zoom),U(H.metadata,"devicePixelRatio",A),U(H.metadata,"connectionEffectiveType",F),U(H.metadata,"navigatorUserAgent",navigator.userAgent),U(H.metadata,"screenWidth",window.screen.width),U(H.metadata,"screenHeight",window.screen.height),U(H.metadata,"windowWidth",window.innerWidth),U(H.metadata,"windowHeight",window.innerHeight),U(H.metadata,"mapWidth",v.width/A),U(H.metadata,"mapHeight",v.height/A),U(H.metadata,"webglRenderer",v.renderer),U(H.metadata,"webglVendor",v.vendor),U(H.metadata,"sdkVersion",w),U(H.metadata,"sdkIdentifier","mapbox-gl-js"),H}(h);for(const v of _.metadata);for(const v of _.counters);for(const v of _.attributes);this.postEvent(o,_,()=>{},g)}},Br=jr.postPerformanceEvent.bind(jr),on=new class extends it{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,o,h,_){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const v=Xe(a.e.API_URL+a.e.SESSION_PATH);v.params.push(`sku=${o||""}`),v.params.push(`access_token=${_||a.e.ACCESS_TOKEN||""}`);const S={url:qe(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(S,T=>{this.pendingRequest=null,h(T),this.saveEventData(),this.processRequests(_)})}getSessionAPI(g,o,h,_){this.skuToken=o,this.errorCb=_,a.e.SESSION_PATH&&a.e.API_URL&&(h||a.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(J)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:h}=this.queue.shift();o&&this.success[o]||this.getSession(h,this.skuToken,_=>{_?this.errorCb(_):o&&(this.success[o]=!0)},g)}remove(){this.errorCb=null}},Zn=on.getSessionAPI.bind(on),ln=new Set;function dr(g,o){o?ln.add(g):ln.delete(g)}class Vr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,h){this._updatedSourceCaches[o]=h,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const h=o.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(o.id),this.setDirty()}removeLayer(o){const h=o.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][o.id]=o,this._updatedLayers[h].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const h in this._updatedLayers)o[h]=o[h]||{},o[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)o[h]=o[h]||{},o[h].removedIds=Object.keys(this._removedLayers[h]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(a.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function nn(g){const{userImage:o}=g;return!!(o&&o.render&&o.render())&&(g.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ln extends a.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&a.r()&&(this.imageRasterizerDispatcher=new a.D(a.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new a.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const h=this.atlasTexture.get(o);h&&(h.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(o.id,o)}removeImageProvider(o,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(o)}getPendingImageProviders(){const o=[];for(const h of this.imageProviders.values())for(const _ of h.values())_.hasPendingRequests()&&o.push(_);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new a.x),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,h){if(this.loaded.get(h)!==o&&(this.loaded.set(h,o),o)){for(const{ids:_,callback:v}of this.requestors)this._notify(_,h,v);this.requestors=[]}}hasImage(o,h){return!!this.getImage(o,h)}getImage(o,h){return this.images.get(h).get(o.toString())}addImage(o,h,_){this._validate(o,_)&&this.images.get(h).set(o.toString(),_)}_validate(o,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new a.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new a.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new a.y(new Error(`Image "${o.name}" has invalid "content" value`))),_=!1),_}_validateStretch(o,h){if(!o)return!0;let _=0;for(const v of o){if(v[0]<_||v[1]<v[0]||h<v[1])return!1;_=v[1]}return!0}_validateContent(o,h){return o?o.length!==4||!h.usvg&&(o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,h,_){const v=this.images.get(h).get(o.toString());_.version=v.version+1,this.images.get(h).set(o.toString(),_),this.updatedImages.get(h).add(o),this.removeFromImageRasterizerCache(o,h)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,h){this.spriteFormat!=="raster"&&(a.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:h}):this.imageRasterizer.removeImagesFromCacheByIds([o],h))}removeImage(o,h){const _=this.images.get(h),v=_.get(o.toString());_.delete(o.toString()),this.patterns.get(h).delete(o.toString()),this.removeFromImageRasterizerCache(o,h),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(h=>a.I.from(h))}getImages(o,h,_){const v=[],S=[],T=this.imageProviders.get(h);for(const F of o){if(!F.iconsetId){v.push(F);continue}const H=T.get(F.iconsetId);H&&(this.getImage(F,h)?S.push(F):H.addPendingRequest(F))}if(v.length===0)return void this._notify(S,h,_);let I=!0;const A=!!this.loaded.get(h),L=this.images.get(h);if(!A)for(const F of v)L.has(F.toString())||(I=!1);A||I?this._notify(v,h,_):this.requestors.push({ids:v,scope:h,callback:_})}rasterizeImages(o,h){const _=new Map,{tasks:v,scope:S}=o;for(const[T,I]of v.entries()){const A=this.getImage(I.id,S);A&&_.set(T,{image:A,imageVariant:I})}this._rasterizeImages(S,_,h)}_rasterizeImages(o,h,_){if(a.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:h,scope:o},_);else{const v=new Map;for(const[S,{image:T,imageVariant:I}]of h.entries())v.set(S,this.imageRasterizer.rasterize(I,T,o,0));_(void 0,v)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,h,_){const v=this.images.get(h),S=new Map;for(const T of o){if(!v.get(T.toString())){if(T.iconsetId)continue;this.fire(new a.z("styleimagemissing",{id:T.name}))}const I=v.get(T.toString());if(!I){a.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(A,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),S.set(a.I.toString(T),A)}_(null,S)}getPixelSize(o){const{width:h,height:_}=this.atlasImage.get(o);return{width:h,height:_}}getPattern(o,h,_){const v=o.toString(),S=this.patterns.get(h),T=S.get(v),I=this.getImage(o,h);if(!I)return null;if(T){if(T.position.version===I.version)return T.position;T.position.version=I.version}else{if(I.usvg&&!I.data){const A=this.getPatternInFlightId(v,h);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const L=new a.A(o).scaleSelf(a.o.devicePixelRatio),F=new Map([[L.toString(),{image:I,imageVariant:L}]]);return this._rasterizeImages(h,F,(H,U)=>this.storePatternImage(L,h,I,_,U)),null}this.storePattern(o,h,I)}return this._updatePatternAtlas(h,_),S.get(v).position}getPatternInFlightId(o,h){return a.B(o,h)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,h,_,v,S){const T=o.toString(),I=S?S.get(T):void 0;I&&(_.data=I,this.storePattern(o.id,h,_),this._updatePatternAtlas(h,v),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),h)))}storePattern(o,h,_){const v={w:_.data.width+2*a.C,h:_.data.height+2*a.C,x:0,y:0},S=new a.F(v,_,a.C);this.patterns.get(h).set(o.toString(),{bin:v,position:S})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,h){const _=o.gl;let v=this.atlasTexture.get(h);v?this.dirty&&(v.update(this.atlasImage.get(h)),this.dirty=!1):(v=new a.T(o,this.atlasImage.get(h),_.RGBA8),this.atlasTexture.set(h,v)),v.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(o,h){const _=this.patterns.get(o),v=Array.from(_.values()).map(({bin:L})=>L),{w:S,h:T}=a.G(v),I=this.atlasImage.get(o);I.resize({width:S||1,height:T||1});const A=this.images.get(o);for(const[L,{bin:F,position:H}]of _.entries()){let U=H.padding;const Y=F.x+U,te=F.y+U,se=A.get(L).data,fe=se.width,de=se.height;U=U>1?U-1:U,a.q.copy(se,I,{x:0,y:0},{x:Y,y:te},{width:fe,height:de},h),a.q.copy(se,I,{x:0,y:de-U},{x:Y,y:te-U},{width:fe,height:U},h),a.q.copy(se,I,{x:0,y:0},{x:Y,y:te+de},{width:fe,height:U},h),a.q.copy(se,I,{x:fe-U,y:0},{x:Y-U,y:te},{width:U,height:de},h),a.q.copy(se,I,{x:0,y:0},{x:Y+fe,y:te},{width:U,height:de},h),a.q.copy(se,I,{x:fe-U,y:de-U},{x:Y-U,y:te-U},{width:U,height:U},h),a.q.copy(se,I,{x:0,y:de-U},{x:Y+fe,y:te-U},{width:U,height:U},h),a.q.copy(se,I,{x:0,y:0},{x:Y+fe,y:te+de},{width:U,height:U},h),a.q.copy(se,I,{x:fe-U,y:0},{x:Y-U,y:te+de},{width:U,height:U},h)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,h){const _=this.images.get(h);for(const v of o){if(this.callbackDispatchedThisFrame.get(h).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(v.toString());const S=_.get(v.toString());nn(S)&&this.updateImage(v,h,S)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Je(g){const o=g.value,h=g.valueSpec,_=g.style,v=g.styleSpec,S=g.key,T=g.arrayElementValidator||oi;if(!Array.isArray(o))return[new a.V(S,o,`array expected, ${a.K(o)} found`)];if(h.length&&o.length!==h.length)return[new a.V(S,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new a.V(S,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let I={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(I.function=h.function),a.H(h.value)&&(I=h.value);let A=[];for(let L=0;L<o.length;L++)A=A.concat(T({array:o,arrayIndex:L,value:o[L],valueSpec:I,style:_,styleSpec:v,key:`${S}[${L}]`},!0));return A}function xt(g){const o=g.key,h=g.value,_=g.valueSpec;if(!a.L(h))return[new a.V(o,h,`number expected, ${a.K(h)} found`)];if(h!=h)return[new a.V(o,h,"number expected, NaN found")];if("minimum"in _){let v=_.minimum;if(Array.isArray(_.minimum)&&(v=_.minimum[g.arrayIndex]),h<v)return[new a.V(o,h,`${h} is less than the minimum value ${v}`)]}if("maximum"in _){let v=_.maximum;if(Array.isArray(_.maximum)&&(v=_.maximum[g.arrayIndex]),h>v)return[new a.V(o,h,`${h} is greater than the maximum value ${v}`)]}return[]}function Ft(g){const o=g.key,h=g.value;if(!a.H(h))return[new a.V(o,h,`object expected, ${a.K(h)} found`)];const _=g.valueSpec,v=a.J(h.type);let S,T,I,A={};const L=v!=="categorical"&&h.property===void 0,F=!L,H=function(se){const fe=se.stops;return Array.isArray(fe)&&Array.isArray(fe[0])&&a.H(fe[0][0])}(h),U=pa({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(se){if(v==="identity")return[new a.V(se.key,se.value,'identity function may not have a "stops" property')];let fe=[];const de=se.value;return fe=fe.concat(Je({key:se.key,value:de,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:Y})),Array.isArray(de)&&de.length===0&&fe.push(new a.V(se.key,de,"array must have at least one stop")),fe},default:function(se){return oi({key:se.key,value:se.value,valueSpec:_,style:se.style,styleSpec:se.styleSpec})}}});return v==="identity"&&L&&U.push(new a.V(g.key,g.value,'missing required property "property"')),v==="identity"||h.stops||U.push(new a.V(g.key,g.value,'missing required property "stops"')),v==="exponential"&&_.expression&&!a.M(_)&&U.push(new a.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(F&&!a.N(_)?U.push(new a.V(g.key,g.value,"property functions not supported")):L&&!a.O(_)&&U.push(new a.V(g.key,g.value,"zoom functions not supported"))),v!=="categorical"&&!H||h.property!==void 0||U.push(new a.V(g.key,g.value,'"property" property is required')),U;function Y(se){let fe=[];const de=se.value,_e=se.key;if(!Array.isArray(de))return[new a.V(_e,de,`array expected, ${a.K(de)} found`)];if(de.length!==2)return[new a.V(_e,de,`array length 2 expected, length ${de.length} found`)];if(H){if(!a.H(de[0]))return[new a.V(_e,de,`object expected, ${a.K(de[0])} found`)];const Ee=de[0];if(Ee.zoom===void 0)return[new a.V(_e,de,"object stop key must have zoom")];if(Ee.value===void 0)return[new a.V(_e,de,"object stop key must have value")];const xe=a.J(Ee.zoom);if(typeof xe!="number")return[new a.V(_e,Ee.zoom,"stop zoom values must be numbers")];if(I&&I>xe)return[new a.V(_e,Ee.zoom,"stop zoom values must appear in ascending order")];xe!==I&&(I=xe,T=void 0,A={}),fe=fe.concat(pa({key:`${_e}[0]`,value:de[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:xt,value:te}}))}else fe=fe.concat(te({key:`${_e}[0]`,value:de[0],style:se.style,styleSpec:se.styleSpec},de));return a.Q(a.S(de[1]))?fe.concat([new a.V(`${_e}[1]`,de[1],"expressions are not allowed in function stops.")]):fe.concat(oi({key:`${_e}[1]`,value:de[1],valueSpec:_,style:se.style,styleSpec:se.styleSpec}))}function te(se,fe){const de=a.K(se.value),_e=a.J(se.value),Ee=se.value!==null?se.value:fe;if(S){if(de!==S)return[new a.V(se.key,Ee,`${de} stop domain type must match previous stop domain type ${S}`)]}else S=de;if(de!=="number"&&de!=="string"&&de!=="boolean"&&typeof _e!="number"&&typeof _e!="string"&&typeof _e!="boolean")return[new a.V(se.key,Ee,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&v!=="categorical"){let xe=`number expected, ${de} found`;return a.N(_)&&v===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(se.key,Ee,xe)]}return v!=="categorical"||de!=="number"||typeof _e=="number"&&isFinite(_e)&&Math.floor(_e)===_e?v!=="categorical"&&de==="number"&&typeof _e=="number"&&typeof T=="number"&&T!==void 0&&_e<T?[new a.V(se.key,Ee,"stop domain values must appear in ascending order")]:(T=_e,v==="categorical"&&_e in A?[new a.V(se.key,Ee,"stop domain values must be unique")]:(A[_e]=!0,[])):[new a.V(se.key,Ee,`integer expected, found ${String(_e)}`)]}}function or(g){const o=(g.expressionContext==="property"?a.W:a.U)(a.S(g.value),g.valueSpec);if(o.result==="error")return o.value.map(_=>new a.V(`${g.key}${_.key}`,g.value,_.message));const h=o.value.expression||o.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!h.outputDefined())return[new a.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!a.Z(h))return[new a.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return xr(h,g);if(g.expressionContext==="appearance")return mr(h,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!a.X(h,["zoom","feature-state"]))return[new a.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!a.Y(h))return[new a.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xr(g,o){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const v of o.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];const _=[];return g instanceof a._&&h.has(g.name)?[new a.V(o.key,o.value,`["${g.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(g.eachChild(v=>{_.push(...xr(v,o))}),_)}function mr(g,o){const h=new Set;if(o.valueSpec&&o.valueSpec.expression)for(const v of o.valueSpec.expression.parameters)h.add(v);if(h.size===0)return[];const _=[];return g instanceof a._&&!h.has(g.name)?[new a.V(o.key,o.value,`["${g.name}"] is not an allowed parameter`)]:(g.eachChild(v=>{_.push(...mr(v,o))}),_)}function sn(g){const o=g.key,h=g.value,_=g.valueSpec,v=[];return Array.isArray(_.values)?_.values.indexOf(a.J(h))===-1&&v.push(new a.V(o,h,`expected one of [${_.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(_.values).indexOf(a.J(h))===-1&&v.push(new a.V(o,h,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function Cs(g){return a.a2(a.S(g.value))?or(Object.assign({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):ys(g)}function ys(g){const o=g.value,h=g.key;if(!Array.isArray(o))return[new a.V(h,o,`array expected, ${a.K(o)} found`)];if(o.length<1)return[new a.V(h,o,"filter array must have at least 1 element")];const _=g.styleSpec;let v=sn({key:`${h}[0]`,value:o[0],valueSpec:_.filter_operator});switch(a.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&a.J(o[1])==="$type"&&v.push(new a.V(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&v.push(new a.V(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(a.a0(o[1])||v.push(new a.V(`${h}[1]`,o[1],`string expected, ${a.K(o[1])} found`)));for(let S=2;S<o.length;S++)a.J(o[1])==="$type"?v=v.concat(sn({key:`${h}[${S}]`,value:o[S],valueSpec:_.geometry_type})):a.a0(o[S])||a.L(o[S])||a.$(o[S])||v.push(new a.V(`${h}[${S}]`,o[S],`string, number, or boolean expected, ${a.K(o[S])} found.`));break;case"any":case"all":case"none":for(let S=1;S<o.length;S++)v=v.concat(ys({key:`${h}[${S}]`,value:o[S],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":o.length!==2?v.push(new a.V(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):a.a0(o[1])||v.push(new a.V(`${h}[1]`,o[1],`string expected, ${a.K(o[1])} found`))}return v}function Es(g,o){const h=g.key,_=g.style,v=g.layer,S=g.styleSpec,T=g.value,I=g.objectKey,A=S[`${o}_${g.layerType}`];if(!A)return[];const L=I.match(/^(.*)-use-theme$/);if(L&&A[L[1]])return a.Q(a.S(T))?[].concat(oi({key:h,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_,styleSpec:S,expressionContext:"property",propertyType:o,propertyKey:I})):oi({key:h,value:T,valueSpec:{type:"string"},style:_,styleSpec:S});const F=I.match(/^(.*)-transition$/);if(o==="paint"&&F&&A[F[1]]&&A[F[1]].transition)return oi({key:h,value:T,valueSpec:S.transition,style:_,styleSpec:S});const H=g.valueSpec||A[I];if(!H)return[new a.a3(h,T,`unknown property "${I}"`)];let U;if(a.a0(T)&&a.N(H)&&!H.tokens&&(U=/^{([^}]+)}$/.exec(T))){const te=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new a.V(h,T,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${te}.`)]}const Y=[];if(g.layerType==="symbol")I!=="text-field"||!_||_.glyphs||_.imports||Y.push(new a.V(h,T,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&a.a4(a.S(T))&&a.J(T.type)==="identity"&&Y.push(new a.V(h,T,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&o==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&a.N(H)&&(a.a5(H)||a.O(H))){const te=a.W(a.S(T),H).value,se="expression"in te&&te.expression||"_styleExpression"in te&&te._styleExpression&&te._styleExpression.expression;se&&!a.X(se,["measure-light"])&&(I==="model-emissive-strength"&&a.Y(se)&&a.Z(se)||Y.push(new a.V(h,T,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Y.concat(oi({key:g.key,value:T,valueSpec:H,style:_,styleSpec:S,expressionContext:"property",propertyType:o,propertyKey:I}))}function so(g){return Es(g,"paint")}function io(g){return Es(g,"layout")}function Cl(g){let o=[];const h=g.value,_=g.key,v=g.style,S=g.styleSpec;if(!a.H(h))return[new a.V(_,h,"object expected")];h.type||h.ref||o.push(new a.V(_,h,'either "type" or "ref" is required'));let T=a.J(h.type);const I=a.J(h.ref);if(h.id){const A=a.J(h.id);for(let L=0;L<g.arrayIndex;L++){const F=v.layers[L];a.J(F.id)===A&&o.push(new a.V(_,h.id,`duplicate layer id "${A}", previously used at line ${F.id.__line__}`))}}if("ref"in h){let A;["type","source","source-layer","filter","layout"].forEach(L=>{L in h&&o.push(new a.V(_,h[L],`"${L}" is prohibited for ref layers`))}),v.layers.forEach(L=>{a.J(L.id)===I&&(A=L)}),A?A.ref?o.push(new a.V(_,h.ref,"ref cannot reference another ref layer")):T=a.J(A.type):typeof I=="string"&&o.push(new a.V(_,h.ref,`ref layer "${I}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(h.source)if(a.a0(h.source)){const A=v.sources&&v.sources[h.source],L=A&&a.J(A.type);A?L==="vector"&&T==="raster"?o.push(new a.V(_,h.source,`layer "${h.id}" requires a raster source`)):L==="raster"&&T!=="raster"?o.push(new a.V(_,h.source,`layer "${h.id}" requires a vector source`)):L!=="vector"||h["source-layer"]?L==="raster-dem"&&T!=="hillshade"?o.push(new a.V(_,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&h.paint&&(h.paint["line-gradient"]||h.paint["line-trim-offset"])&&L==="geojson"&&!A.lineMetrics?o.push(new a.V(_,h,`layer "${h.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&L!=="raster-array"&&o.push(new a.V(_,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):o.push(new a.V(_,h.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new a.V(_,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new a.V(_,h.source,`source "${h.source}" not found`))}else o.push(new a.V(`${_}.source`,h.source,'"source" must be a string'));else o.push(new a.V(_,h,'missing required property "source"'));return o=o.concat(pa({key:_,value:h,valueSpec:S.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>oi({key:`${_}.type`,value:h.type,valueSpec:S.layer.type,style:g.style,styleSpec:g.styleSpec,object:h,objectKey:"type"}),filter:A=>Cs(Object.assign({layerType:T},A)),layout:A=>pa({layer:h,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":L=>io(Object.assign({layerType:T},L))}}),paint:A=>pa({layer:h,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":L=>so(Object.assign({layerType:T,layer:h},L))}}),appearances(A){const L=Je({key:A.key,value:A.value,valueSpec:A.valueSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:U=>function(Y){const{key:te,layer:se,layerType:fe}=Y,de=a.J(Y.value),_e=a.J(de.name),Ee=a.J(de.condition),xe=pa({key:te,value:de,valueSpec:Y.styleSpec.appearance,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{condition:Re=>function(Te){const De=[];return De.push(...or({key:Te.key,value:Te.object.condition,valueSpec:a.a6.appearance.condition,expressionContext:"appearance"})),De}(Object.assign({layer:se,layerType:fe},Re)),properties:Re=>function(Te){const De=[],{styleSpec:Pe,layer:Ie,layerType:Oe}=Te,et=Pe[`paint_${Oe}`],Ke=Pe[`layout_${Oe}`],pt=Te.object[Te.objectKey];for(const ot in pt){const vt=ot in et?"paint":ot in Ke?"layout":void 0;if(!vt){De.push(new a.V(Te.key,ot,`unknown property "${ot}" for layer type "${Oe}"`));continue}const qt=Object.assign({},Te,{key:`${Te.key}.${ot}`,object:pt,objectKey:ot,layer:Ie,layerType:Oe,value:pt[ot],valueSpec:vt==="paint"?et[ot]:Ke[ot]});De.push(...Es(qt,vt))}return De}(Object.assign({layer:se,layerType:fe},Re))}});return _e!=="hidden"&&Ee===void 0&&xe.push(new a.V(Y.key,"name",'Appearance with name different than "hidden" must have a condition')),xe}(Object.assign({layerType:T,layer:h},U))}),F=Array.isArray(A.value)?A.value:[],H=new Set;return F.forEach((U,Y)=>{const te=a.J(U.name);if(te)if(H.has(te)){const se=a.J(h.id);L.push(new a.V(A.key,te,`Duplicated appearance name "${te}" for layer "${se}"`))}else H.add(te)}),L}}})),o}function Qo({key:g,value:o}){return a.a0(o)?[]:[new a.V(g,o,`string expected, ${a.K(o)} found`)]}const Al={promoteId:function g({key:o,value:h}){if(a.a0(h))return Qo({key:o,value:h});if(Array.isArray(h)){const v=[],S=a.S(h),T=a.U(S);return T.result==="error"&&T.value.forEach(I=>{v.push(new a.V(`${o}${I.key}`,null,`${I.message}`))}),a.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||v.push(new a.V(`${o}`,null,"promoteId expression should be only feature dependent")),v}if(!a.H(h))return[new a.V(o,h,`string, expression or object expected, "${a.K(h)}" found`)];const _=[];for(const v in h)_.push(...g({key:`${o}.${v}`,value:h[v]}));return _}};function kc(g){const o=g.value,h=g.key,_=g.styleSpec,v=g.style;if(!a.H(o))return[new a.V(h,o,`object expected, ${a.K(o)} found`)];if(!("type"in o))return[new a.V(h,o,'"type" is required')];const S=a.J(o.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(S)&&("url"in o||"tiles"in o||T.push(new a.a3(h,o,'Either "url" or "tiles" is required.'))),S){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(pa({key:h,value:o,valueSpec:_[`source_${S.replace("-","_")}`],style:g.style,styleSpec:_,objectElementValidators:Al})),T;case"geojson":if(T=pa({key:h,value:o,valueSpec:_.source_geojson,style:v,styleSpec:_,objectElementValidators:Al}),"cluster"in o&&"clusterProperties"in o){if(!a.H(o.clusterProperties))return[new a.V(`${h}.clusterProperties`,o,`object expected, ${a.K(o)} found`)];for(const I in o.clusterProperties){const A=o.clusterProperties[I];if(!Array.isArray(A))return[new a.V(`${h}.clusterProperties.${I}`,A,"array expected")];const[L,F]=A,H=typeof L=="string"?[L,["accumulated"],["get",I]]:L;T.push(...or({key:`${h}.${I}.map`,value:F,expressionContext:"cluster-map"})),T.push(...or({key:`${h}.${I}.reduce`,value:H,expressionContext:"cluster-reduce"}))}}return T;case"video":return pa({key:h,value:o,valueSpec:_.source_video,style:v,styleSpec:_});case"image":return pa({key:h,value:o,valueSpec:_.source_image,style:v,styleSpec:_});case"canvas":return[new a.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sn({key:`${h}.type`,value:o.type,valueSpec:{values:zi(_)}})}}function zi(g){return g.source.reduce((o,h)=>{const _=g[h];return _.type.type==="enum"&&(o=o.concat(Object.keys(_.type.values||{}))),o},[])}function Pl(g){const o=g.value,h=g.styleSpec,_=h.light,v=g.style;if(o===void 0)return[];if(!a.H(o))return[new a.V("light",o,`object expected, ${a.K(o)} found`)];let S=[];for(const T in o){const I=T.match(/^(.*)-transition$/),A=T.match(/^(.*)-use-theme$/);S=S.concat(A&&_[A[1]]?oi({key:T,value:o[T],valueSpec:{type:"string"},style:v,styleSpec:h}):I&&_[I[1]]&&_[I[1]].transition?oi({key:T,value:o[T],valueSpec:h.transition,style:v,styleSpec:h}):_[T]?oi({key:T,value:o[T],valueSpec:_[T],style:v,styleSpec:h}):[new a.V(T,o[T],`unknown property "${T}"`)])}return S}function hh(g){const o=g.value;if(!o)return[];const h=g.key;if(!a.H(o))return[new a.V(h,o,`object expected, ${a.K(o)} found`)];let _=[];const v=g.styleSpec,S=v["light-3d"],T=g.style,I=g.style.lights;for(const F of["type","id"])if(!(F in o))return _=_.concat([new a.V(h,o,`missing property "${F}"`)]),_;if(!a.a0(o.type))return _=_.concat([new a.V(`${h}.type`,o.type,"string expected")]),_;if(I)for(let F=0;F<g.arrayIndex;F++){const H=a.J(o.type),U=I[F];a.J(U.type)===H&&_.push(new a.V(h,o.id,`duplicate light type "${o.type}", previously defined at line ${U.id.__line__}`))}const A=`properties_light_${o.type}`;if(!(A in v))return _=_.concat([new a.V(`${h}.type`,o,`Invalid light type ${o.type}`)]),_;const L=v[A];for(const F in o)if(F==="properties"){const H=o[F];if(!a.H(H))return _=_.concat([new a.V("properties",H,`object expected, ${a.K(H)} found`)]),_;for(const U in H){const Y=U.match(/^(.*)-transition$/),te=U.match(/^(.*)-use-theme$/);_=_.concat(te&&L[te[1]]?oi({key:F,value:H[U],valueSpec:{type:"string"},style:T,styleSpec:v}):Y&&L[Y[1]]&&L[Y[1]].transition?oi({key:F,value:o[F],valueSpec:v.transition,style:T,styleSpec:v}):L[U]?oi({key:U,value:H[U],valueSpec:L[U],style:T,styleSpec:v}):[new a.a3(g.key,H[U],`unknown property "${U}"`)])}}else _=_.concat(S[F]?oi({key:F,value:o[F],valueSpec:S[F],style:T,styleSpec:v}):[new a.a3(F,o[F],`unknown property "${F}"`)]);return _}function lu(g){const o=g.value,h=g.key,_=g.style,v=g.styleSpec,S=v.terrain;if(o==null)return[];if(!a.H(o))return[new a.V("terrain",o,`object expected, ${a.K(o)} found`)];let T=[];for(const I in o){const A=I.match(/^(.*)-transition$/),L=I.match(/^(.*)-use-theme$/);T=T.concat(L&&S[L[1]]?oi({key:I,value:o[I],valueSpec:{type:"string"},style:_,styleSpec:v}):A&&S[A[1]]&&S[A[1]].transition?oi({key:I,value:o[I],valueSpec:v.transition,style:_,styleSpec:v}):S[I]?oi({key:I,value:o[I],valueSpec:S[I],style:_,styleSpec:v}):[new a.a3(I,o[I],`unknown property "${I}"`)])}if(o.source)if(a.a0(o.source)){const I=_.sources&&_.sources[o.source],A=I&&a.J(I.type);I?A!=="raster-dem"&&T.push(new a.V(`${h}.source`,o.source,`terrain cannot be used with a source of type ${A}, it only be used with a "raster-dem" source type`)):T.push(new a.V(`${h}.source`,o.source,`source "${o.source}" not found`))}else T.push(new a.V(`${h}.source`,o.source,"source must be a string"));else T.push(new a.V(h,o,'terrain is missing required property "source"'));return T}function fl(g){const o=g.value,h=g.style,_=g.styleSpec,v=_.fog;if(o===void 0)return[];if(!a.H(o))return[new a.V("fog",o,`object expected, ${a.K(o)} found`)];let S=[];for(const T in o){const I=T.match(/^(.*)-transition$/),A=T.match(/^(.*)-use-theme$/);S=S.concat(A&&v[A[1]]?oi({key:T,value:o[T],valueSpec:{type:"string"},style:h,styleSpec:_}):I&&v[I[1]]&&v[I[1]].transition?oi({key:T,value:o[T],valueSpec:_.transition,style:h,styleSpec:_}):v[T]?oi({key:T,value:o[T],valueSpec:v[T],style:h,styleSpec:_}):[new a.a3(T,o[T],`unknown property "${T}"`)])}return S}const pl={"*":()=>[],array:Je,boolean:function(g){const o=g.value,h=g.key;return a.$(o)?[]:[new a.V(h,o,`boolean expected, ${a.K(o)} found`)]},number:xt,color:function({key:g,value:o}){return a.a0(o)?a.a1.parseCSSColor(o)===null?[new a.V(g,o,`color expected, "${o}" found`)]:[]:[new a.V(g,o,`color expected, ${a.K(o)} found`)]},enum:sn,filter:Cs,function:Ft,layer:Cl,object:pa,source:kc,model:a.a7,light:Pl,"light-3d":hh,terrain:lu,fog:fl,string:Qo,formatted:function(g){return Qo(g).length===0?[]:or(g)},resolvedImage:function(g){return Qo(g).length===0?[]:or(g)},projection:function(g){const o=g.value,h=g.styleSpec,_=h.projection,v=g.style;if(a.H(o)){let S=[];for(const T in o)S=S.concat(oi({key:T,value:o[T],valueSpec:_[T],style:v,styleSpec:h}));return S}return a.a0(o)?[]:[new a.V("projection",o,`object or string expected, ${a.K(o)} found`)]},import:function(g){const o=g.key,{value:h,styleSpec:_}=g;if(!a.H(h))return[new a.V(o,h,"import must be an object")];const{data:v,...S}=h;Object.defineProperty(S,"__line__",{value:h.__line__,enumerable:!1});let T=pa(Object.assign({},g,{value:S,valueSpec:_.import}));return a.J(S.id)===""&&T.push(new a.V(`${g.key}.id`,S,"import id can't be an empty string")),v&&(T=T.concat(Rc(v,_,{key:`${g.key}.data`}))),T},iconset:function(g){const o=g.value,h=g.key,_=g.styleSpec,v=g.style;if(!a.H(o))return[new a.V(h,o,"object expected")];if(!o.type)return[new a.V(h,o,'"type" is required')];const S=a.J(o.type);let T=[];if(T=T.concat(pa({key:h,value:o,valueSpec:_[`iconset_${S}`],style:v,styleSpec:_})),function(I,A){return!(I!=="source"||!A.source)}(S,o)){const I=v.sources&&v.sources[o.source],A=I&&a.J(I.type);I?A!=="raster-array"&&T.push(new a.V(h,o.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):T.push(new a.V(h,o.source,`source "${o.source}" not found`))}return T}};function oi(g,o=!1){const h=g.value,_=g.valueSpec,v=g.styleSpec;if(_.expression){if(a.a4(a.J(h)))return Ft(g);if(a.Q(a.S(h)))return or(g)}if(_.type&&pl[_.type]){const S=pl[_.type](g);return o===!0&&S.length>0&&Array.isArray(g.value)?or(g):S}return pa(Object.assign({},g,{valueSpec:_.type?v[_.type]:_}))}function pa(g){const o=g.key,h=g.value,_=g.valueSpec||{},v=g.objectElementValidators||{},S=g.style,T=g.styleSpec;if(!a.H(h))return[new a.V(o,h,`object expected, ${a.K(h)} found`)];let I=[];for(const A in h){const L=A.split(".")[0];let F;v[L]?F=v[L]:_[L]?F=oi:v["*"]?F=v["*"]:_["*"]&&(F=oi),F?I=I.concat(F({key:(o&&`${o}.`)+A,value:h[A],valueSpec:_[L]||_["*"],style:S,styleSpec:T,object:h,objectKey:A},h)):I.push(new a.a3(o,h[A],`unknown property "${A}"`))}for(const A in _){if(v[A])continue;const L=_[A];L.required&&L.default===void 0&&h[A]===void 0&&I.push(new a.V(o,h,`missing required property "${A}"`))}return I}function cu({key:g,value:o}){const h=Qo({key:g,value:o});if(h.length)return h;const _=o;return _.indexOf("{fontstack}")===-1&&h.push(new a.V(g,o,'"glyphs" url must include a "{fontstack}" token')),_.indexOf("{range}")===-1&&h.push(new a.V(g,o,'"glyphs" url must include a "{range}" token')),h}function Rc(g,o=a.a6,h={}){return pa({key:h.key||"",value:g,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:g,objectElementValidators:{glyphs:cu}})}function Fa(g,o=a.a6){return Qe(Rc(g,o))}const _f=g=>Qe(kc(g)),Bu=g=>Qe(Pl(g)),Rp=g=>Qe(hh(g)),Mc=g=>Qe(lu(g)),Rt=g=>Qe(fl(g)),ua=g=>Qe(function(o){const h=o.value,_=o.style,v=o.styleSpec,S=v.snow;if(h===void 0)return[];if(!a.H(h))return[new a.V("snow",h,`object expected, ${a.K(h)} found`)];let T=[];for(const I in h){const A=I.match(/^(.*)-transition$/);T=T.concat(A&&S[A[1]]&&S[A[1]].transition?oi({key:I,value:h[I],valueSpec:v.transition,style:_,styleSpec:v}):S[I]?oi({key:I,value:h[I],valueSpec:S[I],style:_,styleSpec:v}):[new a.a3(I,h[I],`unknown property "${I}"`)])}return T}(g)),fh=g=>Qe(function(o){const h=o.value,_=o.style,v=o.styleSpec,S=v.rain;if(h===void 0)return[];if(!a.H(h))return[new a.V("rain",h,`object expected, ${a.K(h)} found`)];let T=[];for(const I in h){const A=I.match(/^(.*)-transition$/);T=T.concat(A&&S[A[1]]&&S[A[1]].transition?oi({key:I,value:h[I],valueSpec:v.transition,style:_,styleSpec:v}):S[I]?oi({key:I,value:h[I],valueSpec:S[I],style:_,styleSpec:v}):[new a.a3(I,h[I],`unknown property "${I}"`)])}return T}(g)),uu=g=>Qe(Cl(g)),Nn=g=>Qe(Cs(g)),_o=g=>Qe(so(g)),Fg=g=>Qe(io(g)),Dc=g=>Qe(a.a7(g));function Qe(g){return g.slice().sort((o,h)=>o.line&&h.line?o.line-h.line:0)}function oe(g,o){let h=!1;if(o&&o.length)for(const _ of o)_ instanceof a.a3?a.w(_.message):(g.fire(new a.y(new Error(_.message))),h=!0);return h}const he=a.a6.light;let Ne;class ze extends a.E{constructor(o,h="flat"){super(),this._transitionable=new a.a8(Ne||(Ne=new a.a9({anchor:new a.aa(he.anchor),position:new a.ab(he.position),color:new a.aa(he.color),intensity:new a.aa(he.intensity)}))),this.setLight(o,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h,_={}){this._validate(Bu,o,_)||(this._transitionable.setTransitionOrValue(o),this.id=h)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,_){return(!_||_.validate!==!1)&&oe(this,o.call(Fa,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}const Fe=a.a6.terrain;let We=class extends a.E{constructor(g,o,h,_,v){super(),this.scope=h,this._transitionable=new a.a8(new a.a9({source:new a.aa(Fe.source),exaggeration:new a.aa(Fe.exaggeration)}),h,_),this._transitionable.setTransitionOrValue(g,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=v}get(){return this._transitionable.serialize()}set(g,o){this._transitionable.setTransitionOrValue(g,o)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new a.ac(g,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const o=g.value.expression;if(!o)return null;let h=-1,_=-1,v=1;for(const S of o.zoomStops)v=o.evaluate(new a.ac(S,{worldview:this.worldview})),v>.01?(h=S,_=-1):_=S;return v<.01&&h>0&&_>h?[h,_]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof a.ad}};const ct=45,Ye=65,at=.05;function zt(g,o,h,_){const v=a.ah(ct,Ye,h),[S,T]=At(g,_);let I=1-Math.min(1,Math.exp((o-S)/(T-S)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*v*g.alpha}function At(g,o){const h=.5/Math.tan(.5*o);return[g.range[0]+h,g.range[1]+h]}function br(g,o,h,_,v){const S=a.af([],[o,h,_],v.mercatorFogMatrix);return zt(g,a.ag(S),v.pitch,v._fov)}function Kr(g,o,h,_,v,S,T){const I=[[h,_,0],[v,_,0],[v,S,0],[h,S,0]];let A=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const F of I){const H=a.af([],F,o),U=a.ag(H);A=Math.min(A,U),L=Math.max(L,U)}return[zt(g,A,T.pitch,T._fov),zt(g,L,T.pitch,T._fov)]}const Fr=a.a6.fog;class Ar extends a.E{constructor(o,h,_,v){super();const S=new a.a9({range:new a.aa(Fr.range),color:new a.aa(Fr.color),"color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new a.aa(Fr["high-color"]),"high-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new a.aa(Fr["space-color"]),"space-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new a.aa(Fr["horizon-blend"]),"star-intensity":new a.aa(Fr["star-intensity"]),"vertical-range":new a.aa(Fr["vertical-range"])});this._transitionable=new a.a8(S,_,new Map(v)),this.set(o,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new a.ai(S),this.scope=_}get state(){const o=this._transform,h=o.projection.name==="globe",_=a.aj(o.zoom),v=this.properties.get("range"),S=[.5,3];return{range:h?[a.ak(S[0],v[0],_),a.ak(S[1],v[1],_)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h,_={}){if(this._validate(Rt,o,_))return;const v=Object.assign({},o);for(const S of Object.keys(Fr))v[S]===void 0&&(v[S]=Fr[S].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.ah(ct,Ye,o))*h.a}getOpacityAtLatLng(o,h){return this._transform.projection.supportsFog?function(_,v,S){const T=a.ae.fromLngLat(v),I=S.elevation?S.elevation.getAtPointOrZero(T):0;return br(_,T.x,T.y,I,S)}(this.state,o,h):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Kr(this.state,h,0,0,a.al,a.al,this._transform)}getOpacityForBounds(o,h,_,v,S){return this._transform.projection.supportsFog?Kr(this.state,o,h,_,v,S,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?At(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const _ of h){const v=o.points[_];let S;if(v[2]>=0)S=v;else{const T=o.points[_-4];S=a.am(T,v,T[2]/(T[2]-v[2]))}if(br(this.state,S[0],S[1],0,this._transform)>=at)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,_){return(!_||_.validate!==!1)&&oe(this,o.call(Fa,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}let mn,yn,Kn,li,Xi=class extends a.E{constructor(g,o,h,_){super();const v=mn||(mn=new a.a9({density:new a.aa(a.a6.snow.density),intensity:new a.aa(a.a6.snow.intensity),color:new a.aa(a.a6.snow.color),opacity:new a.aa(a.a6.snow.opacity),vignette:new a.aa(a.a6.snow.vignette),"vignette-color":new a.aa(a.a6.snow["vignette-color"]),"center-thinning":new a.aa(a.a6.snow["center-thinning"]),direction:new a.aa(a.a6.snow.direction),"flake-size":new a.aa(a.a6.snow["flake-size"])}));this._transitionable=new a.a8(v,h,new Map(_)),this.set(g,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(v),this.scope=h}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),h=this.properties.get("direction"),_=a.an(h[0]),v=-Math.max(a.an(h[1]),.01),S=[Math.cos(_)*Math.cos(v),Math.sin(_)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(o.r,o.g,o.b,o.a*g),direction:S,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(g,o,h={}){if(this._validate(ua,g,h))return;const _=Object.assign({},g),v=a.a6.snow;for(const S of Object.keys(v))_[S]===void 0&&(_[S]=v[S].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,h){return(!h||h.validate!==!1)&&oe(this,g.call(Fa,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}},Ci=class extends a.E{constructor(g,o,h,_){super();const v=yn||(yn=new a.a9({density:new a.aa(a.a6.rain.density),intensity:new a.aa(a.a6.rain.intensity),color:new a.aa(a.a6.rain.color),opacity:new a.aa(a.a6.rain.opacity),vignette:new a.aa(a.a6.rain.vignette),"vignette-color":new a.aa(a.a6.rain["vignette-color"]),"center-thinning":new a.aa(a.a6.rain["center-thinning"]),direction:new a.aa(a.a6.rain.direction),"droplet-size":new a.aa(a.a6.rain["droplet-size"]),"distortion-strength":new a.aa(a.a6.rain["distortion-strength"])}));this._transitionable=new a.a8(v,h,new Map(_)),this.set(g,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(v),this.scope=h}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),h=this.properties.get("direction"),_=a.an(h[0]),v=-Math.max(a.an(h[1]),.01),S=[Math.cos(_)*Math.cos(v),Math.sin(_)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(o.r,o.g,o.b,o.a*g),direction:S,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(g,o,h={}){if(this._validate(fh,g,h))return;const _=Object.assign({},g),v=a.a6.rain;for(const S of Object.keys(v))_[S]===void 0&&(_[S]=v[S].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,h){return(!h||h.validate!==!1)&&oe(this,g.call(Fa,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}};class bi extends a.E{constructor(o,h,_,v){super(),this.scope=_,this._options=o,this.properties=new a.ai(h),this._transitionable=new a.a8(h,_,new Map(v)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,h){this._options=o,this._transitionable.setTransitionOrValue(o.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class fs{constructor(o,h,_){this.screenBounds=o,this.cameraPoint=_.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(o,h){let _,v;if(o instanceof a.P||typeof o[0]=="number"){const S=a.P.convert(o);_=[S],v=h.isPointAboveHorizon(S)}else{const S=a.P.convert(o[0]),T=a.P.convert(o[1]),I=S.add(T)._div(2);_=[S,T],v=a.aq(S,T).every(A=>h.isPointAboveHorizon(A))&&h.isPointAboveHorizon(I)}return new fs(_,v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return a.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const h=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],v=a.aq(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),a.ar(v,o)}bufferedCameraGeometryGlobe(o){const h=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],v=a.aq(h,_,o),S=this.cameraPoint.clone();switch(3*((S.y>h.y)+(S.y>_.y))+((S.x>h.x)+(S.x>_.x))){case 0:v[0]=S,v[4]=S.clone();break;case 1:v.splice(1,0,S);break;case 2:v[1]=S;break;case 3:v.splice(4,0,S);break;case 5:v.splice(2,0,S);break;case 6:v[3]=S;break;case 7:v.splice(3,0,S);break;case 8:v[2]=S}return v}containsTile(o,h,_,v=0){const S=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/h._pixelsPerMercatorPixel+1,T=_?this._bufferedCameraMercator(S,h):this._bufferedScreenMercator(S,h);let I=o.tileID.wrap+(T.unwrapped?v:0);const A=T.polygon.map(fe=>a.as(o.tileTransform,fe,I));if(!a.at(A,0,0,a.al,a.al))return;I=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const L=this.screenGeometryMercator.polygon.map(fe=>a.au(o.tileTransform,fe,I)),F=L.map(fe=>new a.P(fe[0],fe[1])),H=h.getFreeCameraOptions().position||new a.ae(0,0,0),U=a.au(o.tileTransform,H,I),Y=L.map(fe=>{const de=a.av(fe,fe,U);return a.aw(de,de),new a.ax(U,de)}),te=a.ay(o,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:Y,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(se=a.az(A),se.min.x=a.aA(se.min.x,0,a.al),se.min.y=a.aA(se.min.y,0,a.al),se.max.x=a.aA(se.max.x,0,a.al),se.max.y=a.aA(se.max.y,0,a.al),se),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:te};var se}_bufferedScreenMercator(o,h){const _=ci(o);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),h):{polygon:this.bufferedScreenGeometry(o).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[_]=v,v}}_bufferedCameraMercator(o,h){const _=ci(o);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),h):{polygon:this.bufferedCameraGeometry(o).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[_]=v,v}}_projectAndResample(o,h){const _=function(S,T){const I=a.aB([],T.pixelMatrix,T.globeMatrix),A=[0,-a.aD,0,1],L=[0,a.aD,0,1],F=[0,0,0,1];a.aC(A,A,I),a.aC(L,L,I),a.aC(F,F,I);const H=new a.P(A[0]/A[3],A[1]/A[3]),U=new a.P(L[0]/L[3],L[1]/L[3]),Y=a.aE(S,H)&&A[3]<F[3],te=a.aE(S,U)&&L[3]<F[3];if(!Y&&!te)return null;const se=function(De,Pe,Ie){for(let Oe=1;Oe<De.length;Oe++){const et=zs(Pe.pointCoordinate3D(De[Oe-1]).x),Ke=zs(Pe.pointCoordinate3D(De[Oe]).x);if(Ie<0){if(et<Ke)return{idx:Oe,t:-et/(Ke-1-et)}}else if(Ke<et)return{idx:Oe,t:(1-et)/(Ke+1-et)}}return null}(S,T,Y?-1:1);if(!se)return null;const{idx:fe,t:de}=se;let _e=fe>1?Rn(S.slice(0,fe),T):[],Ee=fe<S.length?Rn(S.slice(fe),T):[];_e=_e.map(De=>new a.P(zs(De.x),De.y)),Ee=Ee.map(De=>new a.P(zs(De.x),De.y));const xe=[..._e];xe.length===0&&xe.push(Ee[Ee.length-1]);const Re=a.ak(xe[xe.length-1].y,(Ee.length===0?_e[0]:Ee[0]).y,de);let Te;return Te=Y?[new a.P(0,Re),new a.P(0,0),new a.P(1,0),new a.P(1,Re)]:[new a.P(1,Re),new a.P(1,1),new a.P(0,1),new a.P(0,Re)],xe.push(...Te),Ee.length===0?xe.push(_e[0]):xe.push(...Ee),{polygon:xe.map(De=>new a.ae(De.x,De.y)),unwrapped:!1}}(o,h);if(_)return _;const v=function(S,T){let I=!1,A=-1/0,L=0;for(let H=0;H<S.length-1;H++)S[H].x>A&&(A=S[H].x,L=H);for(let H=0;H<S.length-1;H++){const U=(L+H)%(S.length-1),Y=S[U],te=S[U+1];Math.abs(Y.x-te.x)>.5&&(Y.x<te.x?(Y.x+=1,U===0&&(S[S.length-1].x+=1)):(te.x+=1,U+1===S.length-1&&(S[0].x+=1)),I=!0)}const F=a.aF(T.center.lng);return I&&F<Math.abs(F-1)&&S.forEach(H=>{H.x-=1}),{polygon:S,unwrapped:I}}(Rn(o,h).map(S=>new a.P(zs(S.x),S.y)),h);return{polygon:v.polygon.map(S=>new a.ae(S.x,S.y)),unwrapped:v.unwrapped}}}function Rn(g,o){return a.aG(g,h=>{const _=o.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function zs(g){return g<0?1+g%1:g%1}function ci(g){return 100*g|0}function bs(g,o,h,_,v){const S=function(I,A){if(I)return v(I);if(A){if(g.url&&A.tiles&&g.tiles&&delete g.tiles,A.variants){if(!Array.isArray(A.variants))return v(new Error("variants must be an array"));for(const F of A.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return v(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){A=Object.assign(A,F);break}}}const L=a.aH(Object.assign({},A,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=o.canonicalizeTileset(L,g.url),v(null,L)}},T=function(I,A,L){if(!I)return null;if(!A&&!L)return I;L=L||I.worldview_default;const F=Object.values(I.language||{});if(F.length===0)return null;const H=Object.values(I.worldview||{});if(H.length===0)return null;const U=F.every(te=>te===A),Y=H.every(te=>te===L);return U&&Y?I:A in(I.language_options||{})||L in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(g.data,h,_);return T?a.o.frame(()=>S(null,T)):g.url?a.m(o.transformRequest(o.normalizeSourceURL(g.url,null,h,_),a.R.Source),S):a.o.frame(()=>{const{data:I,...A}=g;S(null,A)})}function Ks(g,o){const h=Math.pow(2,o.z),_=Math.floor(a.aF(g.getWest())*h),v=Math.floor(a.aJ(g.getNorth())*h),S=Math.ceil(a.aF(g.getEast())*h),T=Math.ceil(a.aJ(g.getSouth())*h);return o.x>=_&&o.x<S&&o.y>=v&&o.y<T}class da{constructor(o,h,_){this.bounds=o?a.aI.convert(this.validateBounds(o)):null,this.minzoom=h||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const h of o)this.extraBounds.push(a.aI.convert(this.validateBounds(h)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!Ks(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const h of this.extraBounds)if(Ks(h,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const h=new da(o.bounds,o.minzoom,o.maxzoom);return h.addExtraBounds(o.extra_bounds),h}}class ao extends a.E{constructor(o,h,_,v){if(super(),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,a.aH(h,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new a.aK}load(o){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=bs(this._options,this.map._requestManager,h,_,(v,S)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new a.y(v));else if(S){if(Object.assign(this,S),this.hasWorldviews=!!S.worldview_options,S.worldview_default&&(this.worldviewDefault=S.worldview_default),S.vector_layers){this.vectorLayers=S.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of S.vector_layers)this.vectorLayerIds.push(T.id),S.worldview&&S.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=da.fromTileJSON(S),ar(S.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(v)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,h){const _=o.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(_),S=this.map._requestManager.transformRequest(v,a.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,I=T?{image:T.image.clone()}:null,A={request:S,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&a.h(_)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",A,L.bind(this));else if(o.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",A,L.bind(this),void 0,!0);else{const F=a.aL.call({deduped:this._deduped},A,(H,U)=>{if(H||!U)L.call(this,H);else{const Y=a.aM(U.responseHeaders);A.data={cacheControl:Y.cacheControl,expires:Y.expires,rawData:U.rawData.slice(0)},o.actor&&o.actor.send("loadTile",A,L.bind(this),void 0,!0)}},!0);o.request={cancel:F}}function L(F,H){return delete o.request,o.aborted?h(null):F&&F.status!==404?h(F):(H&&H.resourceTiming&&(o.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&o.setExpiryData(H),o.loadVectorData(H,this.map.painter),a.aN(this.dispatcher),h(null,H),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,h){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ml extends a.E{constructor(o,h,_,v){super(),this.id=o,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},h),Object.assign(this,a.aH(h,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const h=this.map.getWorldview();this._tileJSONRequest=bs(this._options,this.map._requestManager,null,h,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?this.fire(new a.y(_)):v&&(Object.assign(this,v),v.raster_layers&&(this.rasterLayers=v.raster_layers,this.rasterLayerIds=this.rasterLayers.map(S=>S.id)),this.tileBounds=da.fromTileJSON(v),ar(v.tiles),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(_)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const _=a.o.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);o.request=a.n(this.map._requestManager.transformRequest(v,a.R.Tile),(S,T,I)=>{if(delete o.request,o.aborted)return o.state="unloaded",h(null);if(S)return o.state="errored",h(S);if(!T)return h(null);const A=a.aM(I);this.map._refreshExpiredTiles&&o.setExpiryData(A),o.setTexture(T,this.map.painter),o.state="loaded",a.aN(this.dispatcher),h(null)})}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h&&h()}unloadTile(o,h){o.texture&&o.texture instanceof a.T?(o.destroy(!0),o.texture&&o.texture instanceof a.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function pd([g,o],h,_,{scaled:v=!0}={}){const{tileSize:S,buffer:T}=_,{x:I,y:A,z:L}=h;if(!isFinite(I)||!isFinite(A)||!isFinite(L))throw new Error("Invalid MRT header");const F=2**L,H=F*a.aF(g),U=F*a.aJ(o);return function([Y,te],se,{scaled:fe=!0}={}){if(!se)throw new Error("bandView is undefined");const{data:de,tileSize:_e,buffer:Ee,offset:xe,scale:Re,dimension:Te}=se;if(Y<-Ee||Y>_e+Ee||te<-Ee||te>_e+Ee)throw new Error(`Point (${Y}, ${te}) out of bounds for tileSize=${_e}, buffer=${Ee}`);const De=(te+Ee)*(_e+2*Ee)+(Y+Ee);if(new Uint32Array(de.buffer)[De]===4294967295)return null;let Pe=[];Pe=fe?[]:new se.data.constructor(Te);for(let Ie=0;Ie<Te;Ie++)Pe[Ie]=Math.round(1e12*(de[Te*De+Ie]*Re+xe))/1e12;return Pe}([Math.min(Math.max(-T,Math.floor((H-I)*S)),S-1+T),Math.min(Math.max(-T,Math.floor((U-A)*S)),S-1+T)],_,{scaled:v})}class Mi extends ml{constructor(o,h,_,v){super(o,h,_,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},h)}triggerRepaint(o){const h=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);h&&h.enabled&&_&&h._clearRenderCacheForTile(_.id,o.tileID),this.map.triggerRepaint()}loadTile(o,h){const _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(_,a.R.Tile),S={request:v,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=v,o.actor||(o.actor=this.dispatcher.getActor());const T=(I,A,L)=>{if(delete o.request,o.aborted)return o.state="unloaded",h(null);if(I)return I.name==="AbortError"?void 0:(o.state="errored",h(I));if(this.map._refreshExpiredTiles&&A){const F=a.aM(L);o.setExpiryData(F)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!A)return h(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=A}h(null)};o.request=this.partial?o.fetchHeader(void 0,T.bind(this)):o.actor.send("loadTile",S,T.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,h){const _=o.texturePerLayer;if(o.flushAllQueues(),_.size){o.destroy(!0);for(const v of _.values())this.map.painter.saveTileTexture(v)}else o.destroy()}prepareTile(o,h,_,v){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(h,_,v,(S,T)=>{if(S)return o.state="errored",this.fire(new a.y(S)),void this.triggerRepaint(o);T&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(_,T,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:S})=>S===o),_=h&&h.fields,v=_&&_.bands&&_.bands;return v?v[0]:0}getTextureDescriptor(o,h,_){if(!o)return;const v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let S=null;h instanceof a.aQ?S=h.paint.get("raster-array-band"):h instanceof a.aR&&(S=h.paint.get("raster-particle-array-band"));const T=S||this.getInitialBand(v);if(T==null)return;if(!o.textureDescriptorPerLayer.get(h.id))return void this.prepareTile(o,v,h.id,T);if(o.updateNeeded(h.id,T)&&!_)return;const I=o.textureDescriptorPerLayer.get(h.id);return Object.assign({},I,{texture:o.texturePerLayer.get(h.id)})}getImages(o,h){const _=new Map;for(const v of o)for(const S of h){const[T,I]=S.split("/"),A=v.getLayer(T);if(!A||!A.hasBand(I)||!A.hasDataForBand(I))continue;const{bytes:L,tileSize:F,buffer:H}=A.getBandView(I),U=F+2*H,Y={data:new a.q({width:U,height:U},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};_.set(S,Y)}return _}queryRasterArrayValueByBandId(o,h,_){const v=h._mrt;return new Promise(S=>{const T={},I=new Set;for(const[A,L]of Object.entries(v.layers)){if(_.layerName&&A!==_.layerName)continue;const F={};T[A]=F;for(const{bands:H}of L.dataIndex)for(const U of H)_.bands&&!_.bands.includes(U)||(I.add(a.B(A,U)),h.fetchBand(A,null,U,Y=>{a.o.frame(()=>{F[U]=Y?null:pd([o.lng,o.lat],v,L.getBandView(U)),I.delete(a.B(A,U)),I.size===0&&S(T)})},!1))}I.size===0&&S(T)})}_loadTileForQuery(o,h){if(this._loadTileLoaded[o.uid])return void h(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(h);this._loadTilePending[o.uid]=[h];const _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(_,a.R.Tile);o.actor.send("loadTile",{request:v,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(S,T,I)=>{if(S)return this._loadTilePending[o.uid].forEach(A=>A(S,null)),void delete this._loadTilePending[o.uid];if(!T)return this._loadTilePending[o.uid].forEach(A=>A(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&T){const A=a.aM(I);o.setExpiryData(A)}o._mrt=T,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(A=>A(null,T)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,h,_){return new Promise((v,S)=>{this._loadTileForQuery(h,(T,I)=>{T?S(T):v(I?this.queryRasterArrayValueByBandId(o,h,_):null)})})}queryRasterArrayValue(o,h){const _=a.aS.convert(o),v=this.findLoadedParent(_);return v&&v._mrt?h.bands||!this.partial?this.queryRasterArrayValueByBandId(_,v,h):this.queryRasterArrayValueByAllBands(_,v,h):Promise.resolve(null)}findLoadedParent(o){const h=a.ae.fromLngLat(o,this.map.transform.tileSize),_=this.maxzoom+1,v=1<<_,S=Math.floor(h.x),T=Math.floor((h.x-S)*v),I=Math.floor(h.y*v),A=this.map.style.getSourceCache(this.id),L=new a.aP(_,S,_,T,I);return A.findLoadedParent(L,this.minzoom)}}const Ma={vector:ao,raster:ml,"raster-dem":class extends ml{constructor(g,o,h,_){super(g,o,h,_),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(g,o){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(v,S){v&&(g.state="errored",o(v)),S&&(g.dem=S,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",o(null))}g.request=a.n(this.map._requestManager.transformRequest(h,a.R.Tile),(function(v,S,T){if(delete g.request,g.aborted)g.state="unloaded",o(null);else if(v)g.state="errored",o(v);else if(S){const I=a.aM(T);this.map._refreshExpiredTiles&&g.setExpiryData(I);const A=ImageBitmap&&S instanceof ImageBitmap&&a.r(),L=1-(S.width-a.aO(S.width))/2;L<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const F=A?S:a.o.getImageData(S,L),H={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:L};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",H,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const o=g.canonical,h=Math.pow(2,o.z),_=(o.x-1+h)%h,v=o.x===0?g.wrap-1:g.wrap,S=(o.x+1+h)%h,T=o.x+1===h?g.wrap+1:g.wrap,I={};return I[new a.aP(g.overscaledZ,v,o.z,_,o.y).key]={backfilled:!1},I[new a.aP(g.overscaledZ,T,o.z,S,o.y).key]={backfilled:!1},o.y>0&&(I[new a.aP(g.overscaledZ,v,o.z,_,o.y-1).key]={backfilled:!1},I[new a.aP(g.overscaledZ,g.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},I[new a.aP(g.overscaledZ,T,o.z,S,o.y-1).key]={backfilled:!1}),o.y+1<h&&(I[new a.aP(g.overscaledZ,v,o.z,_,o.y+1).key]={backfilled:!1},I[new a.aP(g.overscaledZ,g.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},I[new a.aP(g.overscaledZ,T,o.z,S,o.y+1).key]={backfilled:!1}),I}},"raster-array":Mi,geojson:class extends a.E{constructor(g,o,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const v=a.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*v,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*v,extent:a.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:a.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new a.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new a.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const h of this._data.features)o.set(h.id,h);for(const h of g.features)o.set(h.id,h);this._data.features=[...o.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterChildren(g,o){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterLeaves(g,o,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:o,offset:h},_),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.z("dataloading",{dataType:"source"})),this._loaded=!1;const o=Object.assign({append:g},this.workerOptions);o.scope=this.scope;const h=this._data;typeof h=="string"?(o.request=this.map._requestManager.transformRequest(a.o.resolveURL(h),a.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(_,v)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new a.y(_));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(S.resourceTiming=v.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new a.z("data",S)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const g=a.B(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,o){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,v=_?{image:_.image.clone()}:null,S=this._partialReload,T={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:g.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:S,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};g.request=this.actor.send(h,T,(I,A)=>S&&!A?(g.state="loaded",o(null)):(delete g.request,g.destroy(),g.aborted?o(null):I?o(I):(g.loadVectorData(A,this.map.painter,h==="reloadTile"),o(null))),void 0,h==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,o){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aT{constructor(g,o,h,_){super(g,o,h,_),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const o of g.urls)this.urls.push(this.map._requestManager.transformRequest(o,a.R.Source).url);a.aU(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new a.y(o)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const o=this.video.seekable;g<o.start(0)||g>o.end(0)?this.fire(new a.y(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,o=g.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(g,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aT,model:a.aW,"batched-model":class extends a.E{constructor(g,o,h,_){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(g))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=bs(this._options,this.map._requestManager,o,h,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new a.y(_))):v&&(Object.assign(this,v),v.bounds&&(this.tileBounds=new da(v.bounds,this.minzoom,this.maxzoom)),ar(v.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),g&&g(_)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,o){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,a.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:a.o.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=o;else{if(g.buckets){const S=Object.values(g.buckets);for(const T of S)T.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",_,v.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",_,v.bind(this),void 0,!0);function v(S,T){return g.aborted?o(null):S&&S.status!==404?o(S):(this.map._refreshExpiredTiles&&T&&g.setExpiryData(T),g.loadModelData(T,this.map.painter),g.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends a.aT{constructor(g,o,h,_){super(g,o,h,_),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(S=>typeof S!="number"))||this.fire(new a.y(new a.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.y(new a.V(`sources.${g}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new a.y(new a.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new a.y(new a.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.y(new a.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof a.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends a.E{constructor(g,o,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=o,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new da(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,a.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:o,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:o,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,o){const{x:h,y:_,z:v}=g.tileID.canonical,S=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:v},{signal:S.signal})).then((function(T){return delete g.request,g.aborted?(g.state="unloaded",o(null)):T===void 0?(g.state="errored",o(null)):T===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",o(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(T)?(this.loadTileData(g,T),g.state="loaded",void o(null)):(g.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(g.state="errored",o(T))}),g.request.cancel=()=>S.abort()}loadTileData(g,o){g.setTexture(o,this.map.painter)}unloadTile(g,o){if(g.texture&&g.texture instanceof a.T?(g.destroy(!0),g.texture&&g.texture instanceof a.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:h,y:_,z:v}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:v})}o&&o()}abortTile(g,o){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=a.B(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}}},za=function(g,o,h,_){const v=new Ma[o.type](g,o,h,_);if(v.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${v.id}`);return a.aX(["load","abort","unload","serialize","prepare"],v),v};function el(g,o,h=""){return`${h}:${o.id||""}:${o.layer.id}:${function(_){if("layerId"in _)return`layer:${_.layerId}`;{const{featuresetId:v,importId:S}=_;return`featureset:${v}${S?`:import:${S}`:""}`}}(g.target)}`}function Uo(g,o,h,_=""){if(g.uniqueFeatureID){const v=el(g,o,_);if(h.has(v))return!0;h.add(v)}return!1}function Bs(g,o,h,_,v=!1){const S=o.sourceCache.transform,T=o.sourceCache.tilesIn(g,o.has3DLayers,v);T.sort(hu);const I=[];for(const A of T){const L=A.tile.queryRenderedFeatures(o,A,h,_,S,v);Object.keys(L).length&&I.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:L})}for(const A in o.layers){const L=o.layers[A];if(L.styleLayer){const F=L.styleLayer.queryRenderedFeatures(g,o.sourceCache,_);Object.keys(F).length&&I.push({wrappedTileID:0,queryResults:F})}}return I.length===0?{}:function(A){const L={},F={};for(const H of A){const U=H.queryResults,Y=H.wrappedTileID,te=F[Y]=F[Y]||{};for(const se in U){const fe=U[se],de=te[se]=te[se]||{},_e=L[se]=L[se]||[];for(const Ee of fe)de[Ee.featureIndex]||(de[Ee.featureIndex]=!0,_e.push(Ee))}}return L}(I)}function md(g,o,h,_,v,S){const T={},I=_.queryRenderedSymbols(g),A=[];for(const L of Object.keys(I).map(Number))A.push(v[L]);A.sort(hu);for(const L of A){const F=L.featureIndex.lookupSymbolFeatures(I[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,o,h,S);for(const H in F){const U=T[H]=T[H]||[],Y=F[H];Y.sort((te,se)=>{const fe=L.featureSortOrder;if(fe){const de=fe.indexOf(te.featureIndex);return fe.indexOf(se.featureIndex)-de}return se.featureIndex-te.featureIndex});for(const te of Y)U.push(te)}}return T}function du(g,o){const h=g.getRenderableIds().map(S=>g.getTileByID(S)),_=[],v={};for(let S=0;S<h.length;S++){const T=h[S],I=T.tileID.canonical.key;v[I]||(v[I]=!0,T.querySourceFeatures(_,o))}return _}function hu(g,o){const h=g.tileID,_=o.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function yf(g,o){const h={};if(!o)return h;for(const _ of g){const v=_.layerIds.map(S=>o.getLayer(S)).filter(Boolean);if(v.length!==0){_.layers=v,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(S=>v.filter(T=>T.id===S)[0]));for(const S of v)h[S.fqid]=_}}return h}const Eo=32,Jl=33,To=new Uint16Array(8184);for(let g=0;g<2046;g++){let o=g+2,h=0,_=0,v=0,S=0,T=0,I=0;for(1&o?v=S=T=Eo:h=_=I=Eo;(o>>=1)>1;){const L=h+v>>1,F=_+S>>1;1&o?(v=h,S=_,h=T,_=I):(h=v,_=S,v=T,S=I),T=L,I=F}const A=4*g;To[A+0]=h,To[A+1]=_,To[A+2]=v,To[A+3]=S}const gl=new Uint16Array(2178),fu=new Uint8Array(1089),Ql=new Uint16Array(1089);function ec(g){return g===0?-.03125:g===32?.03125:0}const xf={type:2,extent:a.al,loadGeometry:()=>[[new a.P(0,0),new a.P(a.al+1,0),new a.P(a.al+1,a.al+1),new a.P(0,a.al+1),new a.P(0,0)]]};class tc{constructor(o,h,_,v,S,T){this.tileID=o,this.uid=a.b1(),this.uses=0,this.tileSize=h,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=S,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(o){const h=o+this.timeAdded;h<a.o.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,h,_){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=yf(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const S=this.buckets[v];if(S instanceof a.b3){if(this.hasSymbolBuckets=!0,!_)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const S=this.buckets[v];if(S instanceof a.b3&&S.hasRTLText){this.hasRTLText=!0,a.b4();break}}this.queryPadding=0;for(const v in this.buckets){const S=this.buckets[v],T=h.style.getOwnLayer(v);if(!T)continue;const I=T.queryRadius(S);this.queryPadding=Math.max(this.queryPadding,I)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new a.b2}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,h,_){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,yf(o.buckets,h.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,h){for(const S in this.buckets){const T=this.buckets[S];if(T.uploadPending()){let I={},A=[],L={zoom:0,pitch:0,brightness:0,worldview:""};if(h){if(h.style){A=h.style.listImages();const F=T.layers[0],H=F.sourceLayer||"_geojsonTileLayer",U=h.style.getLayerSourceCache(F);U&&(I=U._state.getState(H,void 0))}L={zoom:h.transform.zoom||0,pitch:h.transform.pitch||0,brightness:h.style.getBrightness()||0,worldview:h.worldview||""}}T.upload(o,this.tileID.canonical,I,A,L)}}const _=o.gl,v=this.imageAtlas;v&&!v.uploaded&&(this.imageAtlasTexture=new a.T(o,v.image,_.RGBA8,{useMipmap:!!v.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(o,this.glyphAtlasImage,_.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(o,this.lineAtlas.image,_.R8),this.lineAtlas.uploaded=!0)}prepare(o,h,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,_),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=h.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(h)),(this._lastUpdatedBrightness||v||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}evaluateQueryRenderedFeaturePadding(){let o=0;for(const h in this.buckets){const _=this.buckets[h];_.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,_.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,h,_,v,S,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=this.evaluateQueryRenderedFeaturePadding(),A=function(L,F){const H=a.bp([],[.5*L.width,.5*-L.height,1]);return a.bq(H,H,[1,-1,0]),a.aB(H,H,L.calculateProjMatrix(F.toUnwrapped())),Float32Array.from(H)}(S,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:h,pixelPosMatrix:A,transform:v,availableImages:_,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:I})}querySourceFeatures(o,h){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const v=_.loadVTLayers(),S=h?h.sourceLayer:"",T=v._geojsonTileLayer||v[S];if(!T)return;const I=a.b5(h&&h.filter),{z:A,x:L,y:F}=this.tileID.canonical,H={z:A,x:L,y:F};for(let U=0;U<T.length;U++){const Y=T.feature(U);if(I.needGeometry){const fe=a.b6(Y,!0);if(!I.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),fe,this.tileID.canonical))continue}else if(!I.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Y))continue;const te=_.getId(Y,S),se=new a.b7(Y,A,L,F,te);se.tile=H,o.push(se)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const _=a.b8(o.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const _=Date.now();let v=!1;if(this.expirationTime>_)v=!1;else if(h)if(this.expirationTime<h)v=!0;else{const S=this.expirationTime-h;S?this.expirationTime=_+Math.max(S,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(const h in this.buckets)if(o.style.hasLayer(h)&&this.buckets[h].layers.some(_=>_.appearances&&_.appearances.length>0))return!0;return!1}updateBuckets(o,h){if(!this.latestFeatureIndex||!o.style)return;const _=this.latestFeatureIndex.loadVTLayers(),v=o.style.listImages(),S=o.style.getBrightness();for(const T in this.buckets){if(!o.style.hasLayer(T))continue;const I=this.buckets[T],A=I.layers[0],L=A.sourceLayer||"_geojsonTileLayer",F=_[L],H=o.style.getLayerSourceCache(A);let U={};H&&(U=H._state.getState(L,void 0));const Y=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},te=Object.keys(U).length>0&&!h;if(I.hasAppearances=I.layers.some(fe=>fe.appearances&&fe.appearances.length>0),(te&&I.stateDependentLayers.length!==0||h)&&I.update(U,F,v,Y,te?I.stateDependentLayers:I.layers,h,S),te&&I.stateDependentLayers.length!==0||h||I.hasAppearances){const fe={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};I.updateAppearances(this.tileID.canonical,U,v,fe)}(I instanceof a.b9||I instanceof a.ba)&&o._terrain&&o._terrain.enabled&&H&&I.uploadPending()&&o._terrain._clearRenderCacheForTile(H.id,this.tileID);const se=o&&o.style&&o.style.getOwnLayer(T);se&&(this.queryPadding=Math.max(this.queryPadding,se.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=a.o.now()+o}setTexture(o,h){const _=h.context,v=_.gl;this.texture=this.texture||h.getTileTexture(o.width),this.texture&&this.texture instanceof a.T?this.texture.update(o):(this.texture=new a.T(_,o,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(o,h){const _={};for(const v of h)_[v]=!0;this.dependencies[o]=_}hasDependency(o,h){for(const _ of o){const v=this.dependencies[_];if(v){for(const S of h)if(v[S])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const _=a.bb(xf,this.tileID.canonical,this.tileTransform)[0],v=new a.bc,S=new a.bd;for(let T=0;T<_.length;T++){const{x:I,y:A}=_[T];v.emplaceBack(I,A),S.emplaceBack(T)}S.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(S),this._tileDebugBuffer=o.createVertexBuffer(v,a.be.members),this._tileDebugSegments=a.bf.simpleSegment(0,0,v.length,S.length)}_makeTileBoundsBuffers(o,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const _=a.bb(xf,this.tileID.canonical,this.tileTransform)[0];let v,S;if(this.isRaster){const T=function(I,A){const L=a.aY(I,A),F=Math.pow(2,I.z);for(let fe=0;fe<Jl;fe++)for(let de=0;de<Jl;de++){const _e=a.aZ((I.x+(de+ec(de))/Eo)/F),Ee=a.a_((I.y+(fe+ec(fe))/Eo)/F),xe=A.project(_e,Ee),Re=fe*Jl+de;gl[2*Re+0]=Math.round((xe.x*L.scale-L.x)*a.al),gl[2*Re+1]=Math.round((xe.y*L.scale-L.y)*a.al)}fu.fill(0),Ql.fill(0);for(let fe=2045;fe>=0;fe--){const de=4*fe,_e=To[de+0],Ee=To[de+1],xe=To[de+2],Re=To[de+3],Te=_e+xe>>1,De=Ee+Re>>1,Pe=Te+De-Ee,Ie=De+_e-Te,Oe=Ee*Jl+_e,et=Re*Jl+xe,Ke=De*Jl+Te,pt=Math.hypot((gl[2*Oe+0]+gl[2*et+0])/2-gl[2*Ke+0],(gl[2*Oe+1]+gl[2*et+1])/2-gl[2*Ke+1])>=16;fu[Ke]=fu[Ke]||(pt?1:0),fe<1022&&(fu[Ke]=fu[Ke]||fu[(Ee+Ie>>1)*Jl+(_e+Pe>>1)]||fu[(Re+Ie>>1)*Jl+(xe+Pe>>1)])}const H=new a.a$,U=new a.b0;let Y=0;function te(fe,de){const _e=de*Jl+fe;return Ql[_e]===0&&(H.emplaceBack(gl[2*_e+0],gl[2*_e+1],fe*a.al/Eo,de*a.al/Eo),Ql[_e]=++Y),Ql[_e]-1}function se(fe,de,_e,Ee,xe,Re){const Te=fe+_e>>1,De=de+Ee>>1;if(Math.abs(fe-xe)+Math.abs(de-Re)>1&&fu[De*Jl+Te])se(xe,Re,fe,de,Te,De),se(_e,Ee,xe,Re,Te,De);else{const Pe=te(fe,de),Ie=te(_e,Ee),Oe=te(xe,Re);U.emplaceBack(Pe,Ie,Oe)}}return se(0,0,Eo,Eo,Eo,0),se(Eo,Eo,0,0,0,Eo),{vertices:H,indices:U}}(this.tileID.canonical,h);v=T.vertices,S=T.indices}else{v=new a.a$,S=new a.b0;for(const{x:I,y:A}of _)v.emplaceBack(I,A,0,0);const T=a.bg(v.int16.subarray(0,4*v.length),void 0,4);for(let I=0;I<T.length;I+=3)S.emplaceBack(T[I],T[I+1],T[I+2])}this._tileBoundsBuffer=o.createVertexBuffer(v,a.bh.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(S),this._tileBoundsSegments=a.bf.simpleSegment(0,0,v.length,S.length)}_makeGlobeTileDebugBuffers(o,h){const _=h.projection;if(!_||_.name!=="globe"||h.freezeTileCoverage)return;const v=this.tileID.canonical,S=a.bi(v,h),T=a.bj(S),I=a.aj(h.zoom);let A;I>0&&(A=a.bk(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,v,h,T,A,I),this._makeGlobeTileDebugTextBuffer(o,v,h,T,A,I)}_globePoint(o,h,_,v,S,T,I){let A=a.bl(o,h,_);if(T){const L=1<<_.z,F=a.aF(v.center.lng),H=a.aJ(v.center.lat),U=(_.x+.5)/L-F;let Y=0;U>.5?Y=-1:U<-.5&&(Y=1);let te=(o/a.al+_.x)/L+Y,se=(h/a.al+_.y)/L;te=(te-F)*v._pixelsPerMercatorPixel+F,se=(se-H)*v._pixelsPerMercatorPixel+H;const fe=[te*v.worldSize,se*v.worldSize,0];a.af(fe,fe,T),A=a.bm(A,fe,I)}return a.af(A,A,S)}_makeGlobeTileDebugBorderBuffer(o,h,_,v,S,T){const I=new a.bc,A=new a.bd,L=new a.bn,F=(U,Y,te,se,fe)=>{const de=(te-U)/(fe-1),_e=(se-Y)/(fe-1),Ee=I.length;for(let xe=0;xe<fe;xe++){const Re=U+xe*de,Te=Y+xe*_e;I.emplaceBack(Re,Te);const De=this._globePoint(Re,Te,h,_,v,S,T);L.emplaceBack(De[0],De[1],De[2]),A.emplaceBack(Ee+xe)}},H=a.al;F(0,0,H,0,16),F(H,0,H,H,16),F(H,H,0,H,16),F(0,H,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(A),this._tileDebugBuffer=o.createVertexBuffer(I,a.be.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(L,a.bo.members),this._tileDebugSegments=a.bf.simpleSegment(0,0,I.length,A.length)}_makeGlobeTileDebugTextBuffer(o,h,_,v,S,T){const I=a.al/4,A=new a.bc,L=new a.b0,F=new a.bn,H=25;L.reserve(32),A.reserve(H),F.reserve(H);const U=(Y,te)=>H*Y+te;for(let Y=0;Y<H;Y++){const te=Y*I;for(let se=0;se<H;se++){const fe=se*I;A.emplaceBack(fe,te);const de=this._globePoint(fe,te,h,_,v,S,T);F.emplaceBack(de[0],de[1],de[2])}}for(let Y=0;Y<4;Y++)for(let te=0;te<4;te++){const se=U(Y,te),fe=U(Y,te+1),de=U(Y+1,te),_e=U(Y+1,te+1);L.emplaceBack(se,fe,de),L.emplaceBack(de,fe,_e)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(L),this._tileDebugTextBuffer=o.createVertexBuffer(A,a.be.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(F,a.bo.members),this._tileDebugTextSegments=a.bf.simpleSegment(0,0,H,32)}destroy(o=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.br.setPbf(a.bs);class pu extends tc{constructor(o,h,_,v,S){super(o,h,_,v,S),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,h,_){const v=_.context,S=v.gl;let T=this.texturePerLayer.get(o)||_.getTileTexture(h.width);T&&T instanceof a.T?T.update(h,{premultiply:!1}):T=new a.T(v,h,S.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,T)}flushQueues(o){const h=this._workQueuePerLayer.get(o)||[],_=this._fetchQueuePerLayer.get(o)||[];for(;h.length;)h.pop()();for(;_.length;)_.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const h=this._workQueuePerLayer.get(o)||[];for(;h.length;)h.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const h=this._fetchQueuePerLayer.get(o)||[];for(;h.length;)h.pop()()}}fetchHeader(o=16384,h){const _=this._mrt=new a.br(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=a.bt(v,(S,T,I)=>{if(S)h(S);else try{const A=_.getHeaderLength(T);if(A>o)return void(this.request=this.fetchHeader(A,h));_.parseHeader(T),this._isHeaderLoaded=!0;let L=0;for(const F of Object.values(_.layers))L=Math.max(L,F.dataIndex[F.dataIndex.length-1].lastByte);T.byteLength>=L&&(this.entireBuffer=T),h(null,this.entireBuffer||T,I)}catch(A){h(A)}}),this.request}fetchBandForRender(o,h,_,v){this.fetchBand(o,h,_,S=>{if(S)return void v(S);this.updateTextureDescriptor(o,h,_);const T=this.textureDescriptorPerLayer.get(h);v(null,T?T.img:null)})}fetchBand(o,h,_,v,S=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void v(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void v(new Error("Can't fetch tile band without an actor"));let A;const L=a.B(String(_),a.B(this.tileID.key,o));let F=this._taskQueue.get(L);F?F.add(v):(F=new Set,F.add(v),this._taskQueue.set(L,F));const H=(se,fe)=>{A.complete(se,fe),se?v(se):(F.values().forEach(de=>de(null,fe)),this._taskQueue.delete(L))},U=(se,fe)=>{if(se)return v(se);const de=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:fe,task:A},H,void 0,!0);if(h!==null){const _e=this._workQueuePerLayer.get(h)||[];_e.push(()=>{de&&de.cancel(),A.cancel()}),this._workQueuePerLayer.has(h)||this._workQueuePerLayer.set(h,_e)}};let Y;try{Y=T.getLayer(o)}catch(se){if(this.state==="reloading")return;throw se}if(!Y)return void v(new Error(`Unknown sourceLayer "${o}"`));if(Y.hasDataForBand(_))return F.values().forEach(se=>se(null,null)),void this._taskQueue.delete(L);const te=Y.getDataRange([_]);if(A=T.createDecodingTask(te),!A||A.tasks.length)if(h!==null&&this.flushQueues(h),this.entireBuffer)U(null,this.entireBuffer.slice(te.firstByte,te.lastByte+1));else{const se=Object.assign({},this.requestParams,{headers:{Range:`bytes=${te.firstByte}-${te.lastByte}`}}),fe=a.bt(se,U);if(h!==null){const de=this._fetchQueuePerLayer.get(h)||[];de.push(()=>{fe.cancel(),A.cancel()}),this._fetchQueuePerLayer.has(h)||this._fetchQueuePerLayer.set(h,de)}}}updateNeeded(o,h){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==h||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,h,_){if(!this._mrt)return;const v=this._mrt.getLayer(o);if(!v||!v.hasBand(_)||!v.hasDataForBand(_))return;const{bytes:S,tileSize:T,buffer:I,offset:A,scale:L}=v.getBandView(_),F=T+2*I,H=new a.q({width:F,height:F},S),U=this.texturePerLayer.get(h);U&&U instanceof a.T&&U.update(H,{premultiply:!1}),this.textureDescriptorPerLayer.set(h,{layer:o,band:_,img:H,buffer:I,offset:A,tileSize:T,format:v.pixelFormat,mix:[L,256*L,65536*L,16777216*L]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const h of this.texturePerLayer.values())h&&h instanceof a.T&&h.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Vu{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,_){const v=o.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const S={value:h,timeout:void 0};if(_!==void 0&&(S.timeout=setTimeout(()=>{this.remove(o,S)},_)),this.data[v].push(S),this.order.push(v),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const _=o.wrapped().key,v=h===void 0?0:this.data[_].indexOf(h),S=this.data[_][v];return this.data[_].splice(v,1),S.timeout&&clearTimeout(S.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(S.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const _ in this.data)for(const v of this.data[_])o(v.value)||h.push(v);for(const _ of h)this.remove(_.value.tileID,_)}}class Uy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,_){const v=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][v]=this.stateChanges[o][v]||{},Object.assign(this.stateChanges[o][v],_),this.deletedStates[o]===null){this.deletedStates[o]={};for(const S in this.state[o])S!==v&&(this.deletedStates[o][S]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][v]===null){this.deletedStates[o][v]={};for(const S in this.state[o][v])_[S]||(this.deletedStates[o][v][S]=null)}else for(const S in _)this.deletedStates[o]&&this.deletedStates[o][v]&&this.deletedStates[o][v][S]===null&&delete this.deletedStates[o][v][S]}removeFeatureState(o,h,_){if(this.deletedStates[o]===null)return;const v=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},_&&h!==void 0)this.deletedStates[o][v]!==null&&(this.deletedStates[o][v]=this.deletedStates[o][v]||{},this.deletedStates[o][v][_]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][v])for(_ in this.deletedStates[o][v]={},this.stateChanges[o][v])this.deletedStates[o][v][_]=null;else this.deletedStates[o][v]=null;else this.deletedStates[o]=null}getState(o,h){const _=this.state[o]||{},v=this.stateChanges[o]||{},S=this.deletedStates[o];if(S===null)return{};if(h!==void 0){const I=String(h),A=Object.assign({},_[I],v[I]);if(S){const L=S[h];if(L===null)return{};for(const F in L)delete A[F]}return A}const T=Object.assign({},_,v);if(S)for(const I in S)delete T[I];return T}initializeTileState(o,h){o.refreshFeatureState(h)}coalesceChanges(o,h){const _={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const S={};for(const T in this.stateChanges[v])this.state[v][T]||(this.state[v][T]={}),Object.assign(this.state[v][T],this.stateChanges[v][T]),S[T]=this.state[v][T];_[v]=S}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const S={};if(this.deletedStates[v]===null)for(const T in this.state[v])S[T]={},this.state[v][T]={};else for(const T in this.deletedStates[v]){if(this.deletedStates[v][T]===null)this.state[v][T]={};else if(this.state[v][T])for(const I of Object.keys(this.deletedStates[v][T]))delete this.state[v][T][I];S[T]=this.state[v][T]}_[v]=_[v]||{},Object.assign(_[v],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const v in o)o[v].refreshFeatureState(h)}}class kl extends a.E{constructor(o,h,_){super(),this.id=o,this._onlySymbols=_,h.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new Vu(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Uy,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,h){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,h)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const _=this._tiles[h];_.upload(o,this.map?this.map.painter:void 0),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(zg).map(o=>o.key)}getRenderableIds(o,h){const _=[];for(const v in this._tiles)this._isIdRenderable(+v,o,h)&&_.push(this._tiles[v]);return o?_.sort((v,S)=>{const T=v.tileID,I=S.tileID,A=new a.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),L=new a.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-I.overscaledZ||L.y-A.y||L.x-A.x}).map(v=>v.tileID.key):_.map(v=>v.tileID).sort(zg).map(v=>v.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h,_){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())&&(_||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,h){const _=this._tiles[o];_&&(_.state!=="loading"&&(_.state=h),this._loadTile(_,this._tileLoaded.bind(this,_,o,h)))}_tileLoaded(o,h,_,v,S){if(v){if(o.state="errored",v.status!==404)this._source.fire(new a.y(v,{tile:o}));else{if(this._source.fire(new a.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=a.o.now(),_==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let T=new Map;S&&S.responseHeaders&&(T=S.responseHeaders),this._source.fire(new a.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(o){const h=this.getRenderableIds();for(let v=0;v<h.length;v++){const S=h[v];if(o.neighboringTiles&&o.neighboringTiles[S]){const T=this.getTileByID(S);_(o,T),_(T,o)}}function _(v,S){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let T=S.tileID.canonical.x-v.tileID.canonical.x;const I=S.tileID.canonical.y-v.tileID.canonical.y,A=Math.pow(2,v.tileID.canonical.z),L=S.tileID.key;T===0&&I===0||Math.abs(I)>1||(Math.abs(T)>1&&(Math.abs(T+A)===1?T+=A:Math.abs(T-A)===1&&(T-=A)),S.dem&&v.dem&&(v.dem.backfillBorder(S.dem,T,I),v.neighboringTiles&&v.neighboringTiles[L]&&(v.neighboringTiles[L].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,_,v){for(const S in this._tiles){let T=this._tiles[S];if(v[S]||!T.hasData()||T.tileID.overscaledZ<=h||T.tileID.overscaledZ>_)continue;let I=T.tileID;for(;T&&T.tileID.overscaledZ>h+1;){const L=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[L.key],T&&T.hasData()&&(I=L)}let A=I;for(;A.overscaledZ>h;)if(A=A.scaledTo(A.overscaledZ-1),o[A.key]){v[I.key]=I;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const _=this._loadedParentTiles[o.key];return _&&_.tileID.overscaledZ>=h?_:null}for(let _=o.overscaledZ-1;_>=h;_--){const v=o.scaledTo(_),S=this._getLoadedTile(v);if(S)return S}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,h){h=h||this._source.tileSize;const _=Math.ceil(o.width/h)+1,v=Math.ceil(o.height/h)+1,S=Math.floor(_*v*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,S):S,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(I)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const _={};for(const v in this._tiles){const S=this._tiles[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),_[S.tileID.key]=S}this._tiles=_;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(o,h,_,v,S){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;this.updateCacheSize(o,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let I,A=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const U=L.attenuationRange()[0],Y=Math.floor(U)-Math.log2(L.getDemUpscale());A>Y&&(A=Y)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new a.aP(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(this.tileCoverLift!==0){const U=o.clone();U.tileCoverLift=this.tileCoverLift,I=U.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&o.projection.name==="globe"&&(I.push(new a.aP(1,0,1,0,0)),I.push(new a.aP(1,0,1,1,0)),I.push(new a.aP(1,0,1,0,1)),I.push(new a.aP(1,0,1,1,1)))}else if(I=o.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);I=I.filter(Y=>U(Y))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!tl(this._source.type)){const U=o.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),Y=Math.min(U,this._source.maxzoom);if(T){const te=o.extendTileCover(I,Y);for(const se of te)I.push(se)}else if(S){const te=o.extendTileCoverToNearPlane(I,this.transform.getFrustum(Y),Y);for(const se of te)I.push(se)}else if(this.castsShadows&&v){const te=o.extendTileCover(I,Y,v);for(const se of te)this._shadowCasterTiles[se.key]=!0,I.push(se)}}const F=this._updateRetainedTiles(I);if(tl(this._source.type)&&I.length!==0){const U={},Y={},te=Object.keys(F);for(const fe of te){const de=F[fe],_e=this._tiles[fe];if(!_e||_e.fadeEndTime&&_e.fadeEndTime<=a.o.now())continue;const Ee=this.findLoadedParent(de,Math.max(de.overscaledZ-kl.maxOverzooming,this._source.minzoom));Ee&&(this._addTile(Ee.tileID),U[Ee.tileID.key]=Ee.tileID),Y[fe]=de}const se=I[I.length-1].overscaledZ;for(const fe in this._tiles){const de=this._tiles[fe];if(F[fe]||!de.hasData())continue;let _e=de.tileID;for(;_e.overscaledZ>se;){_e=_e.scaledTo(_e.overscaledZ-1);const Ee=this._tiles[_e.key];if(Ee&&Ee.hasData()&&Y[_e.key]){F[fe]=de.tileID;break}}}for(const fe in U)F[fe]||(this._coveredTiles[fe]=!0,F[fe]=U[fe])}for(const U in F)this._tiles[U].clearFadeHold();const H=a.bu(this._tiles,F);for(const U of H){const Y=this._tiles[U];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const h={};if(o.length===0)return h;const _={},v=o.reduce((L,F)=>Math.min(L,F.overscaledZ),1/0),S=o[0].overscaledZ,T=Math.max(S-kl.maxOverzooming,this._source.minzoom),I=Math.max(S+kl.maxUnderzooming,this._source.minzoom),A={};for(const L of o){const F=this._addTile(L);h[L.key]=L,F.hasData()||v<this._source.maxzoom&&(A[L.key]=L)}this._retainLoadedChildren(A,v,I,h);for(const L of o){let F=this._tiles[L.key];if(F.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const U=L.children(this._source.maxzoom)[0],Y=this.getTile(U);if(Y&&Y.hasData()){h[U.key]=U;continue}}else{const U=L.children(this._source.maxzoom);if(h[U[0].key]&&h[U[1].key]&&h[U[2].key]&&h[U[3].key])continue}let H=F.wasRequested();for(let U=L.overscaledZ-1;U>=T;--U){const Y=L.scaledTo(U);if(_[Y.key]||(_[Y.key]=!0,F=this.getTile(Y),!F&&H&&(F=this._addTile(Y)),F&&(h[Y.key]=Y,H=F.wasRequested(),F.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let _,v=this._tiles[o].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){_=this._loadedParentTiles[v.key];break}h.push(v.key);const S=v.scaledTo(v.overscaledZ-1);if(_=this._getLoadedTile(S),_)break;v=S}for(const S of h)this._loadedParentTiles[S]=_}}_addTile(o){let h=this._tiles[o.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const _=!!h;if(!_){const v=this.map?this.map.painter:null,S=this._source.tileSize*o.overscaleFactor();h=this._source.type==="raster-array"?new pu(o,S,this.transform.tileZoom,v,this._isRaster):new tc(o,S,this.transform.tileZoom,v,this._isRaster,this._source.worldview),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))}return h.uses++,this._tiles[o.key]=h,_||this._source.fire(new a.z("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const _=h.getExpiryTimeout();_&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},_))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,h,_){const v=[],S=this.transform;if(!S)return v;const T=S.projection.name==="globe",I=a.aF(S.center.lng);for(const A in this._tiles){const L=this._tiles[A];if(_&&L.clearQueryDebugViz(),L.holdingForFade())continue;let F;if(T){const H=L.tileID.canonical;if(H.z===0){const U=[Math.abs(a.aA(I,...gd(H,-1))-I),Math.abs(a.aA(I,...gd(H,1))-I)];F=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(a.aA(I,...gd(H,-1))-I),Math.abs(a.aA(I,...gd(H,0))-I),Math.abs(a.aA(I,...gd(H,1))-I)];F=[U.indexOf(Math.min(...U))-1]}}else F=[0];for(const H of F){const U=o.containsTile(L,S,h,H);U&&v.push(U)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,h){const _=this.getRenderableIds(o,h).map(S=>this._tiles[S].tileID),v=this.transform.projection.name==="globe";for(const S of _)S.projMatrix=this.transform.calculateProjMatrix(S.toUnwrapped()),S.expandedProjMatrix=v?this.transform.calculateProjMatrix(S.toUnwrapped(),!1,!0):S.projMatrix;return _}sortCoordinatesByDistance(o){const h=o.slice(),_=this.transform._camera.position,v=this.transform._camera.forward(),S={};for(const T of h){const I=1/(1<<T.canonical.z);S[T.key]=((T.canonical.x+.5)*I+T.wrap-_[0])*v[0]+((T.canonical.y+.5)*I-_[1])*v[1]-_[2]*v[2]}return h.sort((T,I)=>S[T.key]-S[I.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(tl(this._source.type))for(const o in this._tiles){const h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=a.o.now())return!0}return!1}setFeatureState(o,h,_){this._state.updateState(o=o||"_geojsonTileLayer",h,_)}removeFeatureState(o,h,_){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,_)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,_){const v=this._tiles[o];v&&v.setDependencies(h,_)}reloadTilesForDependencies(o,h){for(const _ in this._tiles)this._tiles[_].hasDependency(o,h)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(o,h))}_preloadTiles(o,h){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(o,h))};return void this._source.on("data",A)}const _=new Map,v=Array.isArray(o)?o:[o],S=this.map.painter.terrain,T=this.usedForTerrain&&S?S.getScaledDemTileSize():this._source.tileSize;for(const A of v){const L=A.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of L)_.set(F.key,F);this.usedForTerrain&&A.updateElevation(!1)}const I=Array.from(_.values());a.bv(I,(A,L)=>{const F=new tc(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,H=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),L(H,F)})},h)}}function zg(g,o){const h=Math.abs(2*g.wrap)-+(g.wrap<0),_=Math.abs(2*o.wrap)-+(o.wrap<0);return g.overscaledZ-o.overscaledZ||_-h||o.canonical.y-g.canonical.y||o.canonical.x-g.canonical.x}function tl(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function gd(g,o){const h=1<<g.z;return[g.x/h+o,(g.x+1)/h+o]}kl.maxOverzooming=10,kl.maxUnderzooming=3;class Bg{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,h=!1;for(const _ in this.style._mergedLayers){const v=this.style._mergedLayers[_];if(v.type==="fill-extrusion"||v.type==="building")this.layers.push({layer:v,visible:o,visibilityChanged:h});else if(v.type==="model"){const S=this.style.getLayerSource(v);S&&S.type==="batched-model"&&this.layers.push({layer:v,visible:o,visibilityChanged:h})}}}onNewFrame(o){this.layersGotHidden=!1;for(const h of this.layers){const _=h.layer;let v=!1;_.type==="fill-extrusion"?v=!_.isHidden(o)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="building"?v=!_.isHidden(o)&&_.paint.get("building-opacity")>0:_.type==="model"&&(v=!_.isHidden(o)&&_.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(o,h){this.currentBuildingBuckets=[];for(const v of this.layers){const S=v.layer,T=this.style.getLayerSourceCache(S);let I=1;S.type==="fill-extrusion"?I=v.visible?S.paint.get("fill-extrusion-vertical-scale"):0:S.type==="building"&&(I=v.visible?S.paint.get("building-vertical-scale"):0);let A=T?T.getTile(h):null;if(!A&&T)for(const L in T._tiles){const F=T._tiles[L];if(h.canonical.isChildOf(F.tileID.canonical)){A=F;break}}this.currentBuildingBuckets.push({bucket:A?A.getBucket(S):null,tileID:A?A.tileID:h,verticalScale:I})}o.hasAnyZOffset=!1;let _=!1;for(let v=0;v<o.symbolInstances.length;v++){const S=o.symbolInstances.get(v),T=S.zOffset,I=this._getHeightAtTileOffset(h,S.tileAnchorX,S.tileAnchorY);S.zOffset=I!==Number.NEGATIVE_INFINITY?I:T,_||T===S.zOffset||(_=!0),o.hasAnyZOffset||S.zOffset===0||(o.hasAnyZOffset=!0)}_&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,h,_,v){let S=h,T=_;if(o.canonical.z!==v.canonical.z){const I=v.canonical,A=1/(1<<o.canonical.z-I.z);S=(h+o.canonical.x*a.al)*A-I.x*a.al|0,T=(_+o.canonical.y*a.al)*A-I.y*a.al|0}return{tileX:S,tileY:T}}_getHeightAtTileOffset(o,h,_){let v,S;for(let T=0;T<this.layers.length;++T){const I=this.layers[T].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:A,tileID:L,verticalScale:F}=this.currentBuildingBuckets[T];if(!A)continue;const{tileX:H,tileY:U}=this._mapCoordToOverlappingTile(o,h,_,L),Y=A.getHeightAtTileCoord(H,U);Y&&Y.height!==void 0&&(Y.hidden?v=Y.height:S=Math.max(Y.height*F,S||0))}if(S!==void 0)return S;for(let T=0;T<this.layers.length;++T){const I=this.layers[T];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:A,tileID:L}=this.currentBuildingBuckets[T];if(!A)continue;const{tileX:F,tileY:H}=this._mapCoordToOverlappingTile(o,h,_,L),U=A.getHeightAtTileCoord(F,H);if(U&&!U.hidden)return U.height===void 0&&v!==void 0?Math.min(U.maxHeight,v)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Uu(g,o){const h={};for(const _ in g)_!=="ref"&&(h[_]=g[_]);return a.bw.forEach(_=>{_ in o&&(h[_]=o[_])}),h}function mu(g){g=g.slice();const o=Object.create(null);for(let h=0;h<g.length;h++)o[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=Uu(g[h],o[g[h].ref]));return g}const Xn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function _d(g,o,h){h.push({command:Xn.addSource,args:[g,o[g]]})}function gu(g,o,h){o.push({command:Xn.removeSource,args:[g]}),h[g]=!0}function ph(g,o,h,_){gu(g,h,_),_d(g,o,h)}function vf(g,o,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&_!=="data"&&!a.bx(g[h][_],o[h][_]))return!1;for(_ in o[h])if(o[h].hasOwnProperty(_)&&_!=="data"&&!a.bx(g[h][_],o[h][_]))return!1;return!0}function qi(g,o,h,_,v,S){let T;for(T in o=o||{},g=g||{})g.hasOwnProperty(T)&&(a.bx(g[T],o[T])||h.push({command:S,args:[_,T,o[T],v]}));for(T in o)o.hasOwnProperty(T)&&!g.hasOwnProperty(T)&&(a.bx(g[T],o[T])||h.push({command:S,args:[_,T,o[T],v]}))}function wf(g){return g.id}function bf(g,o){return g[o.id]=o,g}function $u(g,o,h){const _=o.createTileMatrix(g,g.worldSize,h.toUnwrapped());return a.aB(new Float32Array(16),g.projMatrix,_)}function Vg(g,o,h){if(o.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(o.projection),$u(_,o.getProjection(),g)}function Sf(g,o,h){return o.name===h.projection.name?g.projMatrix:$u(h,o,g)}class Mp{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.aA(o,0,1);let h=1,_=this._distances[h];const v=o*this.paddedLength+this.padding;for(;_<v&&h<this._distances.length;)_=this._distances[++h];const S=h-1,T=this._distances[S],I=_-T,A=I>0?(v-T)/I:0;return this.points[S].mult(1-A).add(this.points[h].mult(A))}}class mh{constructor(o,h,_){const v=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(h/_);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,_,v,S){this._forEachCell(h,_,v,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(S)}insertCircle(o,h,_,v){this._forEachCell(h-v,_-v,h+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(_),this.circles.push(v)}_insertBoxCell(o,h,_,v,S,T){this.boxCells[S].push(T)}_insertCircleCell(o,h,_,v,S,T){this.circleCells[S].push(T)}_query(o,h,_,v,S,T){if(_<0||o>this.width||v<0||h>this.height)return!S&&[];const I=[];if(o<=0&&h<=0&&this.width<=_&&this.height<=v){if(S)return!0;for(let A=0;A<this.boxKeys.length;A++)I.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const L=this.circles[3*A],F=this.circles[3*A+1],H=this.circles[3*A+2];I.push({key:this.circleKeys[A],x1:L-H,y1:F-H,x2:L+H,y2:F+H})}return T?I.filter(T):I}return this._forEachCell(o,h,_,v,this._queryCell,I,{hitTest:S,seenUids:{box:{},circle:{}}},T),S?I.length>0:I}_queryCircle(o,h,_,v,S){const T=o-_,I=o+_,A=h-_,L=h+_;if(I<0||T>this.width||L<0||A>this.height)return!v&&[];const F=[];return this._forEachCell(T,A,I,L,this._queryCellCircle,F,{hitTest:v,circle:{x:o,y:h,radius:_},seenUids:{box:{},circle:{}}},S),v?F.length>0:F}query(o,h,_,v,S){return this._query(o,h,_,v,!1,S)}hitTest(o,h,_,v,S){return this._query(o,h,_,v,!0,S)}hitTestCircle(o,h,_,v){return this._queryCircle(o,h,_,!0,v)}_queryCell(o,h,_,v,S,T,I,A){const L=I.seenUids,F=this.boxCells[S];if(F!==null){const U=this.bboxes;for(const Y of F)if(!L.box[Y]){L.box[Y]=!0;const te=4*Y;if(o<=U[te+2]&&h<=U[te+3]&&_>=U[te+0]&&v>=U[te+1]&&(!A||A(this.boxKeys[Y]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Y],x1:U[te],y1:U[te+1],x2:U[te+2],y2:U[te+3]})}}}const H=this.circleCells[S];if(H!==null){const U=this.circles;for(const Y of H)if(!L.circle[Y]){L.circle[Y]=!0;const te=3*Y;if(this._circleAndRectCollide(U[te],U[te+1],U[te+2],o,h,_,v)&&(!A||A(this.circleKeys[Y]))){if(I.hitTest)return T.push(!0),!0;{const se=U[te],fe=U[te+1],de=U[te+2];T.push({key:this.circleKeys[Y],x1:se-de,y1:fe-de,x2:se+de,y2:fe+de})}}}}}_queryCellCircle(o,h,_,v,S,T,I,A){const L=I.circle,F=I.seenUids,H=this.boxCells[S];if(H!==null){const Y=this.bboxes;for(const te of H)if(!F.box[te]){F.box[te]=!0;const se=4*te;if(this._circleAndRectCollide(L.x,L.y,L.radius,Y[se+0],Y[se+1],Y[se+2],Y[se+3])&&(!A||A(this.boxKeys[te])))return T.push(!0),!0}}const U=this.circleCells[S];if(U!==null){const Y=this.circles;for(const te of U)if(!F.circle[te]){F.circle[te]=!0;const se=3*te;if(this._circlesCollide(Y[se],Y[se+1],Y[se+2],L.x,L.y,L.radius)&&(!A||A(this.circleKeys[te])))return T.push(!0),!0}}}_forEachCell(o,h,_,v,S,T,I,A){const L=this._convertToXCellCoord(o),F=this._convertToYCellCoord(h),H=this._convertToXCellCoord(_),U=this._convertToYCellCoord(v);for(let Y=L;Y<=H;Y++)for(let te=F;te<=U;te++)if(S.call(this,o,h,_,v,this.xCellCount*te+Y,T,I,A))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,_,v,S,T){const I=v-o,A=S-h,L=_+T;return L*L>I*I+A*A}_circleAndRectCollide(o,h,_,v,S,T,I){const A=(T-v)/2,L=Math.abs(o-(v+A));if(L>A+_)return!1;const F=(I-S)/2,H=Math.abs(h-(S+F));if(H>F+_)return!1;if(L<=A||H<=F)return!0;const U=L-A,Y=H-F;return U*U+Y*Y<=_*_}}const Sa={unknown:0,flipRequired:1,flipNotRequired:2},gh=Math.tan(85*Math.PI/180);function _h(g,o,h,_,v,S,T){const I=a.bB();if(h)if(S.name==="globe"){const A=a.bC(v,o);a.aB(I,I,A)}else{const A=a.bD([],T);I[0]=A[0],I[1]=A[1],I[4]=A[2],I[5]=A[3],_||a.bA(I,I,v.angle)}else a.aB(I,v.labelPlaneMatrix,g);return I}function _u(g,o,h,_,v,S,T){const I=_h(g,o,h,_,v,S,T);return S.name==="globe"&&h||(I[2]=I[6]=I[10]=I[14]=0),I}function Oc(g,o,h,_,v,S,T){if(h){if(S.name==="globe"){const I=_h(g,o,h,_,v,S,T);return a.bk(I,I),a.aB(I,g,I),I}{const I=a.by(g),A=a.bz([]);return A[0]=T[0],A[1]=T[1],A[4]=T[2],A[5]=T[3],a.aB(I,I,A),_||a.bA(I,I,-v.angle),I}}return v.glCoordMatrix}function Yi(g,o,h,_){const v=[g,o,h,1];h?a.aC(v,v,_):_l(v,v,_);const S=v[3];return v[0]/=S,v[1]/=S,v[2]/=S,v}function yh(g,o){return Math.min(.5+g/o*.5,1.5)}function Dp(g,o){const h=g[0]/g[3],_=g[1]/g[3];return h>=-o[0]&&h<=o[0]&&_>=-o[1]&&_<=o[1]}function xh(g,o,h,_,v,S,T,I,A,L,F=1){const H=h.transform,U=_?g.textSizeData:g.iconSizeData,Y=a.bJ(U,h.transform.zoom,F),te=H.projection.name==="globe",se=[256/h.width*2+1,256/h.height*2+1],fe=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;fe.clear();let de=null;te&&(de=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const _e=g.lineVertexArray,Ee=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,xe=h.transform.width/h.transform.height;let Re,Te=!1;for(let De=0;De<Ee.length;De++){const Pe=Ee.get(De),{numGlyphs:Ie,writingMode:Oe}=Pe;if(Oe!==a.bK.vertical||Te||Re===a.bK.horizontal||(Te=!0),Re=Oe,(Pe.hidden||Oe===a.bK.vertical)&&!Te){rc(Ie,fe);continue}Te=!1;const et=new a.P(Pe.tileAnchorX,Pe.tileAnchorY),Ke=g.elevationType==="road",pt=!!H.elevation||Ke;let{x:ot,y:vt,z:qt}=H.projection.projectTilePoint(et.x,et.y,L.canonical),nt=null;if(pt){const cr=Ke?g.getElevationFeatureForText(De):null;nt={getElevation:A,elevation:H.elevation,elevationFeature:cr};const[Lr,Cn,Un]=A(et,H.elevation,cr);ot+=Lr,vt+=Cn,qt+=Un}const Ue=[ot,vt,qt,1];if(a.aC(Ue,Ue,o),!Dp(Ue,se)){rc(Ie,fe);continue}const wt=Ue[3],lt=yh(h.transform.getCameraToCenterDistance(H.projection),wt),Pt=a.bL(U,Y,Pe),Kt=T?Pt/lt:Pt*lt,gr=Yi(ot,vt,qt,v);if(gr[3]<=0){rc(Ie,fe);continue}let Ut={};const Ht=a.an(g.layers[0].layout.get("text-max-angle")),yr=Math.cos(Ht),lr=T?null:nt,sr=vh(Pe,Kt,!1,I,o,v,S,g.glyphOffsetArray,_e,fe,de,gr,et,Ut,xe,lr,H.projection,L,T,yr);Te=sr.useVertical,lr&&sr.needsFlipping&&(Ut={}),(sr.notEnoughRoom||Te||sr.needsFlipping&&vh(Pe,Kt,!0,I,o,v,S,g.glyphOffsetArray,_e,fe,de,gr,et,Ut,xe,lr,H.projection,L,T,yr).notEnoughRoom)&&rc(Ie,fe)}_?(g.text.dynamicLayoutVertexBuffer.updateData(fe),de&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(de)):(g.icon.dynamicLayoutVertexBuffer.updateData(fe),de&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(de))}function os(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe){const{lineStartIndex:de,glyphStartIndex:_e,segment:Ee}=I,xe=_e+I.numGlyphs,Re=de+I.lineLength,Te=o.getoffsetX(_e),De=o.getoffsetX(xe-1),Pe=yd(g*Te,h,_,v,S,T,Ee,de,Re,A,L,F,H,U,!0,Y,te,se,fe);if(!Pe)return null;const Ie=yd(g*De,h,_,v,S,T,Ee,de,Re,A,L,F,H,U,!0,Y,te,se,fe);return Ie?{first:Pe,last:Ie}:null}function Op(g,o,h,_){return g===a.bK.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:g===a.bK.vertical?_>0?{needsFlipping:!0}:null:o!==Sa.unknown&&function(v,S){return v===0||Math.abs(S/v)>gh}(h,_)?o===Sa.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function vh(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe,de,_e,Ee){const xe=o/24,Re=g.lineOffsetX*xe,Te=g.lineOffsetY*xe,{lineStartIndex:De,glyphStartIndex:Pe,numGlyphs:Ie,segment:Oe,writingMode:et,flipState:Ke}=g,pt=De+g.lineLength,ot=vt=>{if(F){const[wt,lt,Pt]=vt.up,Kt=L.length;a.bM(F,Kt+0,wt,lt,Pt),a.bM(F,Kt+1,wt,lt,Pt),a.bM(F,Kt+2,wt,lt,Pt),a.bM(F,Kt+3,wt,lt,Pt)}const[qt,nt,Ue]=vt.point;a.bN(L,qt,nt,Ue,vt.angle)};if(Ie>1){const vt=os(xe,I,Re,Te,h,H,U,g,A,S,Y,se,!1,fe,de,_e,Ee);if(!vt)return{notEnoughRoom:!0};if(_&&!h){let[qt,nt,Ue]=vt.first.point,[wt,lt,Pt]=vt.last.point;[qt,nt]=Yi(qt,nt,Ue,T),[wt,lt]=Yi(wt,lt,Pt,T);const Kt=Op(et,Ke,(wt-qt)*te,lt-nt);if(g.flipState=Kt&&Kt.needsFlipping?Sa.flipRequired:Sa.flipNotRequired,Kt)return Kt}ot(vt.first);for(let qt=Pe+1;qt<Pe+Ie-1;qt++){const nt=yd(xe*I.getoffsetX(qt),Re,Te,h,H,U,Oe,De,pt,A,S,Y,se,!1,!1,fe,de,_e,Ee);if(!nt)return L.length-=4*(qt-Pe),{notEnoughRoom:!0};ot(nt)}ot(vt.last)}else{if(_&&!h){const qt=Yi(U.x,U.y,0,v),nt=De+Oe+1,Ue=new a.P(A.getx(nt),A.gety(nt)),wt=Yi(Ue.x,Ue.y,0,v),lt=wt[3]>0?wt:Ur(U,Ue,qt,1,v,void 0,fe,de.canonical),Pt=Op(et,Ke,(lt[0]-qt[0])*te,lt[1]-qt[1]);if(g.flipState=Pt&&Pt.needsFlipping?Sa.flipRequired:Sa.flipNotRequired,Pt)return Pt}const vt=yd(xe*I.getoffsetX(Pe),Re,Te,h,H,U,Oe,De,pt,A,S,Y,se,!1,!1,fe,de,_e,Ee);if(!vt)return{notEnoughRoom:!0};ot(vt)}return{}}function Ug(g,o,h,_,v){const{x:S,y:T,z:I}=_.projectTilePoint(g.x,g.y,o);if(!v)return Yi(S,T,I,h);const[A,L,F]=v.getElevation(g,v.elevation,v.elevationFeature);return Yi(S+A,T+L,I+F,h)}function Ur(g,o,h,_,v,S,T,I){const A=Ug(g.sub(o)._unit()._add(g),I,v,T,S);return a.av(A,h,A),a.aw(A,A),a.bG(A,h,A,_)}function yd(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe,de,_e){const Ee=_?g-o:g+o;let xe=Ee>0?1:-1,Re=0;_&&(xe*=-1,Re=Math.PI),xe<0&&(Re+=Math.PI);let Te=I+T+(xe>0?0:1)|0,De=v,Pe=v,Ie=0,Oe=0;const et=Math.abs(Ee),Ke=[],pt=[];let ot=S,vt=ot,qt=a.bE([]);const nt=()=>Ur(vt,ot,Pe,et-Ie+1,F,U,se,fe.canonical);for(;Ie+Oe<=et;){if(Te+=xe,Te<I||Te>=A)return null;if(Pe=De,vt=ot,Ke.push(Pe),Y&&pt.push(vt),ot=new a.P(L.getx(Te),L.gety(Te)),De=H[Te],!De){const lr=Ug(ot,fe.canonical,F,se,U);De=lr[3]>0?H[Te]=lr:nt()}Ie+=Oe;const Ht=a.av([],De,Pe),yr=a.bF(Pe,De);if(h&&yr>0&&Oe>0&&a.bI(qt,Ht)/(Oe*yr)<_e)return null;Oe=yr,qt=Ht}te&&U&&(H[Te]&&(De=nt(),Oe=a.bF(Pe,De),qt=a.av([],De,Pe)),H[Te]=De);const Ue=(et-Ie)/Oe,wt=ot.sub(vt)._mult(Ue)._add(vt),lt=a.bG([],Pe,qt,Ue);let Pt=[0,0,1],Kt=qt[0],gr=qt[1];if(de&&(Pt=se.upVector(fe.canonical,wt.x,wt.y),Pt[0]!==0||Pt[1]!==0||Pt[2]!==1)){const Ht=[Pt[2],0,-Pt[0]],yr=a.bH([],Pt,Ht);a.aw(Ht,Ht),a.aw(yr,yr),Kt=a.bI(qt,Ht),gr=a.bI(qt,yr)}if(h){const Ht=a.bH([],Pt,qt);a.aw(Ht,Ht),a.bG(lt,lt,Ht,h*xe)}const Ut=Re+Math.atan2(gr,Kt);return Ke.push(lt),Y&&pt.push(wt),{point:lt,angle:Ut,path:Ke,tilePath:pt,up:Pt}}function rc(g,o){const h=o.length,_=h+4*g;o.resize(_),o.float32.fill(-1/0,4*h,4*_)}function _l(g,o,h){const _=o[0],v=o[1];return g[0]=h[0]*_+h[4]*v+h[12],g[1]=h[1]*_+h[5]*v+h[13],g[3]=h[3]*_+h[7]*v+h[15],g}const $o=100;class xd{constructor(o,h,_=new mh(o.width+200,o.height+200,25),v=new mh(o.width+200,o.height+200,25)){this.transform=o,this.grid=_,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+$o,this.screenBottomBoundary=o.height+$o,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,_,v,S,T,I,A,L,F,H){let U=_.projectedAnchorX,Y=_.projectedAnchorY,te=_.projectedAnchorZ;const se=_.tileAnchorX,fe=_.tileAnchorY,de=_.elevation,_e=_.tileID,Ee=o.getProjection();if(de&&_e){const[pt,ot,vt]=Ee.upVector(_e.canonical,_.tileAnchorX,_.tileAnchorY),qt=Ee.upVectorScale(_e.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;U+=pt*de*qt,Y+=ot*de*qt,te+=vt*de*qt}const xe=o.projection.name==="globe",Re=o.projection.name==="globe"?a.aj(this.transform.zoom):0;if(_e&&xe&&Re<1&&!T){const pt=1<<_e.canonical.z,ot=a.bO(se,fe);a.bP(ot,ot,1/a.al),a.bQ(ot,ot,a.bO(_e.canonical.x,_e.canonical.y)),a.bP(ot,ot,1/pt),a.bR(ot,ot,a.bO(v[0],v[1])),ot[0]=a.bS(ot[0],-.5,.5),a.bP(ot,ot,a.al);const vt=a.bT(ot[0],ot[1],a.al/(2*Math.PI),1);a.aC(vt,vt,S),U=a.ak(U,vt[0],Re),Y=a.ak(Y,vt[1],Re),te=a.ak(te,vt[2],Re)}const Te=this.projectAndGetPerspectiveRatio(F,U,Y,te,_.tileID,Ee.name==="globe"||!!de||this.transform.pitch>0,Ee),De=L*Te.perspectiveRatio,Pe=(_.x1*h+I.x-_.padding)*De+Te.point.x,Ie=(_.y1*h+I.y-_.padding)*De+Te.point.y,Oe=(_.x2*h+I.x+_.padding)*De+Te.point.x,et=(_.y2*h+I.y+_.padding)*De+Te.point.y,Ke=Te.perspectiveRatio<=.55||Te.occluded;return!this.isInsideGrid(Pe,Ie,Oe,et)||!A&&this.grid.hitTest(Pe,Ie,Oe,et,H)||Ke?{box:[],offscreen:!1,occluded:Te.occluded}:{box:[Pe,Ie,Oe,et],offscreen:this.isOffscreen(Pe,Ie,Oe,et),occluded:!1}}placeCollisionCircles(o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe){const de=[],_e=this.transform.elevation,Ee=o.getProjection(),xe=o.elevationType==="road",Re=!!_e||xe,Te=a.bU.getAtTileOffsetFunc(fe,this.transform.center.lat,this.transform.worldSize,Ee),De=new a.P(_.tileAnchorX,_.tileAnchorY),Pe=new a.P(_.tileAnchorX,_.tileAnchorY);let{x:Ie,y:Oe,z:et}=Ee.projectTilePoint(Pe.x,Pe.y,fe.canonical),Ke=null;if(Re){const yr=xe?o.getElevationFeatureForText(v):null;Ke={getElevation:Te,elevation:_e,elevationFeature:yr};const[lr,sr,cr]=Te(De,_e,yr);Ie+=lr,Oe+=sr,et+=cr}const pt=Ee.name==="globe",ot=this.projectAndGetPerspectiveRatio(A,Ie,Oe,et,fe,pt||!!_e||this.transform.pitch>0,Ee),{perspectiveRatio:vt}=ot,qt=(U?I/vt:I*vt)/a.bX,nt=Yi(Ie,Oe,et,L),Ue=_.lineOffsetX*qt,wt=_.lineOffsetY*qt,lt=a.an(o.layers[0].layout.get("text-max-angle")),Pt=Math.cos(lt),Kt=ot.signedDistanceFromCamera>0?os(qt,T,Ue,wt,xe&&_.flipState===1,nt,Pe,_,S,L,{},Re&&!U?Ke:null,U&&Re,Ee,fe,U,Pt):null;let gr=!1,Ut=!1,Ht=!0;if(Kt&&!ot.occluded){const yr=.5*te*vt+se,lr=new a.P(-100,-100),sr=new a.P(this.screenRightBoundary,this.screenBottomBoundary),cr=new Mp,{first:Lr,last:Cn}=Kt,Un=Lr.path.length;let Is=[];for(let pn=Un-1;pn>=1;pn--)Is.push(Lr.path[pn]);for(let pn=1;pn<Cn.path.length;pn++)Is.push(Cn.path[pn]);const Yr=2.5*yr;F&&(Is=Is.map(([pn,Ss,$n],Vs)=>(Re&&!pt&&($n=Te(Vs<Un-1?Lr.tilePath[Un-1-Vs]:Cn.tilePath[Vs-Un+2],_e,Ke.elevationFeature)[2]),Yi(pn,Ss,$n,F))),Is.some(pn=>pn[3]<=0)&&(Is=[]));let Bn=[];if(Is.length>0){let pn=1/0,Ss=-1/0,$n=1/0,Vs=-1/0;for(const Jn of Is)pn=Math.min(pn,Jn[0]),$n=Math.min($n,Jn[1]),Ss=Math.max(Ss,Jn[0]),Vs=Math.max(Vs,Jn[1]);Ss>=lr.x&&pn<=sr.x&&Vs>=lr.y&&$n<=sr.y&&(Bn=[Is.map(Jn=>new a.P(Jn[0],Jn[1]))],(pn<lr.x||Ss>sr.x||$n<lr.y||Vs>sr.y)&&(Bn=a.bV(Bn,lr.x,lr.y,sr.x,sr.y)))}for(const pn of Bn){cr.reset(pn,.25*yr);let Ss=0;Ss=cr.length<=.5*yr?1:Math.ceil(cr.paddedLength/Yr)+1;for(let $n=0;$n<Ss;$n++){const Vs=$n/Math.max(Ss-1,1),Jn=cr.lerp(Vs),gn=Jn.x+$o,us=Jn.y+$o;de.push(gn,us,yr,0);const wn=gn-yr,ei=us-yr,ps=gn+yr,Jr=us+yr;if(Ht=Ht&&this.isOffscreen(wn,ei,ps,Jr),Ut=Ut||this.isInsideGrid(wn,ei,ps,Jr),!h&&this.grid.hitTestCircle(gn,us,yr,Y)&&(gr=!0,!H))return{circles:[],offscreen:!1,collisionDetected:gr,occluded:!1}}}}return{circles:!H&&gr||!Ut?[]:de,offscreen:Ht,collisionDetected:gr,occluded:ot.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let _=1/0,v=1/0,S=-1/0,T=-1/0;for(const F of o){const H=new a.P(F.x+$o,F.y+$o);_=Math.min(_,H.x),v=Math.min(v,H.y),S=Math.max(S,H.x),T=Math.max(T,H.y),h.push(H)}const I=this.grid.query(_,v,S,T).concat(this.ignoredGrid.query(_,v,S,T)),A={},L={};for(const F of I){const H=F.key;if(A[H.bucketInstanceId]===void 0&&(A[H.bucketInstanceId]={}),A[H.bucketInstanceId][H.featureIndex])continue;const U=[new a.P(F.x1,F.y1),new a.P(F.x2,F.y1),new a.P(F.x2,F.y2),new a.P(F.x1,F.y2)];a.bW(h,U)&&(A[H.bucketInstanceId][H.featureIndex]=!0,L[H.bucketInstanceId]===void 0&&(L[H.bucketInstanceId]=[]),L[H.bucketInstanceId].push(H.featureIndex))}return L}insertCollisionBox(o,h,_,v,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:S},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,_,v,S){const T=h?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:v,collisionGroupID:S};for(let A=0;A<o.length;A+=4)T.insertCircle(I,o[A],o[A+1],o[A+2])}projectAndGetPerspectiveRatio(o,h,_,v,S,T,I){const A=[h,_,v,1];let L=!1;v||this.transform.pitch>0?(a.aC(A,A,o),this.fogState&&S&&I.name!=="globe"&&(L=function(U,Y,te,se,fe,de){const _e=de.calculateFogTileMatrix(fe),Ee=[Y,te,se];return a.af(Ee,Ee,_e),zt(U,a.ag(Ee),de.pitch,de._fov)}(this.fogState,h,_,v,S.toUnwrapped(),this.transform)>.9)):_l(A,A,o);const F=A[3];return{point:new a.P((A[0]/F+1)/2*this.transform.width+$o,(-A[1]/F+1)/2*this.transform.height+$o),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/F*.5,1.5),signedDistanceFromCamera:F,occluded:T&&A[2]>F||L}}isOffscreen(o,h,_,v){return _<$o||o>=this.screenRightBoundary||v<$o||h>this.screenBottomBoundary}isInsideGrid(o,h,_,v){return _>=0&&o<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=a.bz([]);return a.bq(o,o,[-100,-100,0]),o}}class Tr{constructor(o,h,_,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):v&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Mn{constructor(o,h,_,v,S,T=!1){this.text=new Tr(o?o.text:null,h,_,S),this.icon=new Tr(o?o.icon:null,h,v,S),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yn{constructor(o,h,_,v=!1){this.text=o,this.icon=h,this.skipFade=_,this.clipped=v}}class qo{constructor(){this.invProjMatrix=a.bB(),this.viewportMatrix=a.bB(),this.circles=[]}}class vd{constructor(o,h,_,v,S){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=S}}class ls{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[o]}}function qu(g,o,h,_,v){const{horizontalAlign:S,verticalAlign:T}=a.c0(g),I=-(S-.5)*o,A=-(T-.5)*h,L=a.c1(g,_);return new a.P(I+L[0]*v,A+L[1]*v)}function Ba(g,o,h,_,v){const S=new a.P(g,o);return h&&S._rotate(_?v:-v),S}class wh{constructor(o,h,_,v,S,T){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new xd(this.transform,S),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ls(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,_,v,S=1){const T=_.getBucket(h),I=_.latestFeatureIndex;if(!T||!I||h.fqid!==T.layerIds[0])return;const A=T.layers[0].layout,L=T.layers[0].paint,F=_.collisionBoxArray,H=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),U=_.tileSize/a.al,Y=_.tileID.toUnwrapped();this.transform.setProjection(T.projection);const te=(se=_.tileID,fe=T.getProjection(),de=this.transform,fe.name===this.projection?de.calculateProjMatrix(se.toUnwrapped()):$u(de,fe,se));var se,fe,de;const _e=A.get("text-pitch-alignment")==="map",Ee=A.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const xe=h.dynamicFilter(),Re=h.dynamicFilterNeedsFeature(),Te=this.transform.calculatePixelsToTileUnitsMatrix(_),De=_u(te,_.tileID.canonical,_e,Ee,this.transform,T.getProjection(),Te);let Pe=null;const Ie=T.getProjection().createInversionMatrix(this.transform,_.tileID.canonical);if(_e){const Ue=Oc(te,_.tileID.canonical,_e,Ee,this.transform,T.getProjection(),Te);Pe=a.aB([],this.transform.labelPlaneMatrix,Ue)}let Oe=null;xe&&_.latestFeatureIndex&&(Oe={unwrappedTileID:Y,dynamicFilter:xe,dynamicFilterNeedsFeature:Re}),this.retainedQueryData[T.bucketInstanceId]=new vd(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,_.tileID);const[et,Ke]=T.layers[0].layout.get("text-size-scale-range"),pt=a.aA(S,et,Ke),[ot,vt]=A.get("icon-size-scale-range"),qt=a.aA(S,ot,vt),nt={bucket:T,layout:A,paint:L,posMatrix:te,invMatrix:Ie,mercatorCenter:[a.aF(this.transform.center.lng),a.aJ(this.transform.center.lat)],textLabelPlaneMatrix:De,labelToScreenMatrix:Pe,clippingData:Oe,scale:H,textPixelRatio:U,holdingForFade:_.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:a.bJ(T.textSizeData,this.transform.zoom,pt),partiallyEvaluatedIconSize:a.bJ(T.iconSizeData,this.transform.zoom,qt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:_.latestFeatureIndex};if(v)for(const Ue of T.sortKeyRanges){const{sortKey:wt,symbolInstanceStart:lt,symbolInstanceEnd:Pt}=Ue;o.push({sortKey:wt,symbolInstanceStart:lt,symbolInstanceEnd:Pt,parameters:nt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:nt})}attemptAnchorPlacement(o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe,de,_e,Ee,xe,Re){const{textOffset0:Te,textOffset1:De,crossTileID:Pe}=se,Ie=[Te,De],Oe=qu(o,T,I,Ie,A),et=this.collisionIndex.placeCollisionBox(de,A,h,_,v,S,Ba(Oe.x,Oe.y,L,F,this.transform.angle),te,H,U,Y.predicate);if(Ee){const Ke=de.getSymbolInstanceIconSize(Re,this.transform.zoom,se.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(de,Ke,Ee,_,v,S,Ba(Oe.x,Oe.y,L,F,this.transform.angle),te,H,U,Y.predicate).box.length===0)return}if(et.box.length>0){let Ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[Pe]&&this.prevPlacement.placements[Pe]&&this.prevPlacement.placements[Pe].text&&(Ke=this.prevPlacement.variableOffsets[Pe].anchor),this.variableOffsets[Pe]={textOffset:Ie,width:T,height:I,anchor:o,textScale:A,prevAnchor:Ke},this.markUsedJustification(de,o,se,_e),de.allowVerticalPlacement&&(this.markUsedOrientation(de,_e,se),this.placedOrientations[Pe]=_e),{shift:Oe,placedGlyphBoxes:et}}}placeLayerBucketPart(o,h,_,v,S=1){const{bucket:T,layout:I,paint:A,posMatrix:L,textLabelPlaneMatrix:F,labelToScreenMatrix:H,clippingData:U,textPixelRatio:Y,mercatorCenter:te,invMatrix:se,holdingForFade:fe,collisionBoxArray:de,partiallyEvaluatedTextSize:_e,partiallyEvaluatedIconSize:Ee,collisionGroup:xe,latestFeatureIndex:Re}=o.parameters,Te=I.get("text-optional"),De=I.get("icon-optional"),Pe=I.get("text-allow-overlap"),Ie=I.get("icon-allow-overlap"),Oe=I.get("text-rotation-alignment")==="map",et=I.get("icon-rotation-alignment")==="map",Ke=I.get("text-pitch-alignment")==="map",pt=A.get("symbol-z-offset"),ot=I.get("symbol-elevation-reference")==="sea",vt=I.get("symbol-placement"),[qt,nt]=I.get("text-size-scale-range"),[Ue,wt]=I.get("icon-size-scale-range"),lt=a.aA(S,qt,nt),Pt=a.aA(S,Ue,wt),Kt=I.get("text-variable-anchor"),gr=Oe&&vt!=="point",Ut=et&&vt!=="point",Ht=Kt&&T.hasTextData(),yr=T.hasIconTextFit()&&Ht&&T.hasIconData();this.transform.setProjection(T.projection);const lr=Ht||gr,sr=Ut||yr;let cr=Pe&&(Ie||!T.hasIconData()||De),Lr=Ie&&(Pe||!T.hasTextData()||Te);const Cn=!pt.isConstant();!T.collisionArrays&&de&&T.deserializeCollisionBoxes(de),_&&v&&T.updateCollisionDebugBuffers(this.transform.zoom,de,lt,Pt);const Un=(Yr,Bn,pn)=>{const{crossTileID:Ss,numVerticalGlyphVertices:$n}=Yr;let Vs=null;if(U&&U.dynamicFilterNeedsFeature||Cn){const Ei=this.retainedQueryData[T.bucketInstanceId];Vs=Re.loadFeature({featureIndex:Yr.featureIndex,bucketIndex:Ei.bucketIndex,sourceLayerIndex:Ei.sourceLayerIndex,layoutVertexArrayOffset:0})}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},Vs,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new a.P(Yr.tileAnchorX,Yr.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[Ss]=new Yn(!1,!1,!1,!0),void h.add(Ss);const Jn=pt.evaluate(Vs,{});if(h.has(Ss))return;if(fe)return void(this.placements[Ss]=new Yn(!1,!1,!1));let gn=!1,us=!1,wn=!0,ei=!1,ps=!1,Jr=null,Gn={box:null,offscreen:null,occluded:null},pi={box:null},Vi=null,vi=null,ki=null,vl=0,nl=0,yo=0;pn.textFeatureIndex?vl=pn.textFeatureIndex:Yr.useRuntimeCollisionCircles&&(vl=Yr.featureIndex),pn.verticalTextFeatureIndex&&(nl=pn.verticalTextFeatureIndex);const No=T.elevationFeatures?T.elevationFeatures[Yr.elevationFeatureIndex]:void 0,oc=Ei=>{Ei.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Ui=this.transform.elevation;Ei.elevation=ot?Jn:Jn+a.bU.getAtTileOffset(Ei.tileID,new a.P(Ei.tileAnchorX,Ei.tileAnchorY),Ui,No),Ei.elevation+=Yr.zOffset},xo=pn.textBox;if(xo){oc(xo);const Ei=Os=>{let Gi=a.bK.horizontal;if(T.allowVerticalPlacement&&!Os&&this.prevPlacement){const $a=this.prevPlacement.placedOrientations[Ss];$a&&(this.placedOrientations[Ss]=$a,Gi=$a,this.markUsedOrientation(T,Gi,Yr))}return Gi},Ui=(Os,Gi)=>{if(T.allowVerticalPlacement&&$n>0&&pn.verticalTextBox){for(const $a of T.writingModes)if($a===a.bK.vertical?(Gn=Gi(),pi=Gn):Gn=Os(),Gn&&Gn.box&&Gn.box.length)break}else Gn=Os()};if(Kt){let Os=Kt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ss]){const Ti=this.prevPlacement.variableOffsets[Ss];Os.indexOf(Ti.anchor)>0&&(Os=Os.filter(cc=>cc!==Ti.anchor),Os.unshift(Ti.anchor))}const Gi=(Ti,cc,hm)=>{const Id=T.getSymbolInstanceTextSize(_e,Yr,this.transform.zoom,Bn),fm=(Ti.x2-Ti.x1)*Id+2*Ti.padding,pm=(Ti.y2-Ti.y1)*Id+2*Ti.padding,uc=Yr.hasIconTextFit&&!Ie?cc:null;uc&&oc(uc);let Ku={box:[],offscreen:!1,occluded:!1};const Oa=Pe?2*Os.length:Os.length;for(let dc=0;dc<Oa;++dc){const Lf=this.attemptAnchorPlacement(Os[dc%Os.length],Ti,te,se,lr,fm,pm,Id,Oe,Ke,Y,L,xe,dc>=Os.length,Yr,Bn,T,hm,uc,_e,Ee);if(Lf&&(Ku=Lf.placedGlyphBoxes,Ku&&Ku.box&&Ku.box.length)){gn=!0,Jr=Lf.shift;break}}return Ku};Ui(()=>Gi(xo,pn.iconBox,a.bK.horizontal),()=>{const Ti=pn.verticalTextBox;return Ti&&oc(Ti),T.allowVerticalPlacement&&!(Gn&&Gn.box&&Gn.box.length)&&$n>0&&Ti?Gi(Ti,pn.verticalIconBox,a.bK.vertical):{box:null,offscreen:null,occluded:null}}),Gn&&(gn=Gn.box,wn=Gn.offscreen,ei=Gn.occluded);const $a=Ei(!(!Gn||!Gn.box));if(!gn&&this.prevPlacement){const Ti=this.prevPlacement.variableOffsets[Ss];Ti&&(this.variableOffsets[Ss]=Ti,this.markUsedJustification(T,Ti.anchor,Yr,$a))}}else{const Os=(Gi,$a)=>{const Ti=T.getSymbolInstanceTextSize(_e,Yr,this.transform.zoom,Bn),cc=this.collisionIndex.placeCollisionBox(T,Ti,Gi,te,se,lr,new a.P(0,0),Pe,Y,L,xe.predicate);return cc&&cc.box&&cc.box.length&&(this.markUsedOrientation(T,$a,Yr),this.placedOrientations[Ss]=$a),cc};Ui(()=>Os(xo,a.bK.horizontal),()=>{const Gi=pn.verticalTextBox;return T.allowVerticalPlacement&&$n>0&&Gi?(oc(Gi),Os(Gi,a.bK.vertical)):{box:null,offscreen:null,occluded:null}}),Ei(!!(Gn&&Gn.box&&Gn.box.length))}}if(Vi=Gn,gn=Vi&&Vi.box&&Vi.box.length>0,wn=Vi&&Vi.offscreen,ei=Vi&&Vi.occluded,Yr.useRuntimeCollisionCircles){const Ei=Yr.centerJustifiedTextSymbolIndex>=0?Yr.centerJustifiedTextSymbolIndex:Yr.verticalPlacedTextSymbolIndex,Ui=T.text.placedSymbolArray.get(Ei),Os=a.bL(T.textSizeData,_e,Ui),Gi=I.get("text-padding");vi=this.collisionIndex.placeCollisionCircles(T,Pe,Ui,Ei,T.lineVertexArray,T.glyphOffsetArray,Os,L,F,H,_,Ke,xe.predicate,Yr.collisionCircleDiameter*Os/a.bX,Gi,this.retainedQueryData[T.bucketInstanceId].tileID),gn=Pe||vi.circles.length>0&&!vi.collisionDetected,wn=wn&&vi.offscreen,ei=vi.occluded}if(pn.iconFeatureIndex&&(yo=pn.iconFeatureIndex),pn.iconBox){const Ei=Ui=>{oc(Ui);const Os=Yr.hasIconTextFit&&Jr?Ba(Jr.x,Jr.y,Oe,Ke,this.transform.angle):new a.P(0,0),Gi=T.getSymbolInstanceIconSize(Ee,this.transform.zoom,Yr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Gi,Ui,te,se,sr,Os,Ie,Y,L,xe.predicate)};pi&&pi.box&&pi.box.length&&pn.verticalIconBox?(ki=Ei(pn.verticalIconBox),us=ki.box.length>0):(ki=Ei(pn.iconBox),us=ki.box.length>0),wn=wn&&ki.offscreen,ps=ki.occluded}const lc=Te||Yr.numHorizontalGlyphVertices===0&&$n===0,$c=De||Yr.numIconVertices===0;if(lc||$c?$c?lc||(us=us&&gn):gn=us&&gn:us=gn=us&&gn,gn&&Vi&&Vi.box&&this.collisionIndex.insertCollisionBox(Vi.box,I.get("text-ignore-placement"),T.bucketInstanceId,pi&&pi.box&&nl?nl:vl,xe.ID),us&&ki&&this.collisionIndex.insertCollisionBox(ki.box,I.get("icon-ignore-placement"),T.bucketInstanceId,yo,xe.ID),vi&&(gn&&this.collisionIndex.insertCollisionCircles(vi.circles,I.get("text-ignore-placement"),T.bucketInstanceId,vl,xe.ID),_)){const Ei=T.bucketInstanceId;let Ui=this.collisionCircleArrays[Ei];Ui===void 0&&(Ui=this.collisionCircleArrays[Ei]=new qo);for(let Os=0;Os<vi.circles.length;Os+=4)Ui.circles.push(vi.circles[Os+0]),Ui.circles.push(vi.circles[Os+1]),Ui.circles.push(vi.circles[Os+2]),Ui.circles.push(vi.collisionDetected?1:0)}const Ua=T.projection.name!=="globe";cr=cr&&(Ua||!ei),Lr=Lr&&(Ua||!ps),this.placements[Ss]=new Yn(gn||cr,us||Lr,wn||T.justReloaded),h.add(Ss)},Is=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,Is),T.elevationType==="road"&&T.updateRoadElevation(Is.canonical),T.updateZOffset(),T.sortFeaturesByY){const Yr=T.getSortedSymbolIndexes(this.transform.angle);for(let Bn=Yr.length-1;Bn>=0;--Bn){const pn=Yr[Bn];Un(T.symbolInstances.get(pn),pn,T.collisionArrays[pn])}T.hasAnyZOffset&&a.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Yr=T.getSortedIndexesByZOffset();for(let Bn=0;Bn<Yr.length;++Bn){const pn=Yr[Bn];Un(T.symbolInstances.get(pn),pn,T.collisionArrays[pn])}}else for(let Yr=o.symbolInstanceStart;Yr<o.symbolInstanceEnd;Yr++)Un(T.symbolInstances.get(Yr),Yr,T.collisionArrays[Yr]);if(_&&T.bucketInstanceId in this.collisionCircleArrays){const Yr=this.collisionCircleArrays[T.bucketInstanceId];a.bk(Yr.invProjMatrix,L),Yr.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(o,h,_,v){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:A,crossTileID:L}=_,F=a.c2(h),H=v===a.bK.vertical?A:F==="left"?S:F==="center"?T:F==="right"?I:-1;S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=H>=0&&S!==H?0:L),T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=H>=0&&T!==H?0:L),I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=H>=0&&I!==H?0:L),A>=0&&(o.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:L)}markUsedOrientation(o,h,_){const v=h===a.bK.horizontal||h===a.bK.horizontalOnly?h:0,S=h===a.bK.vertical?h:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:L}=_,F=o.text.placedSymbolArray;T>=0&&(F.get(T).placedOrientation=v),I>=0&&(F.get(I).placedOrientation=v),A>=0&&(F.get(A).placedOrientation=v),L>=0&&(F.get(L).placedOrientation=S)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(o):1,S=h?h.opacities:{},T=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const A in this.placements){const L=this.placements[A],F=S[A];F?(this.opacities[A]=new Mn(F,v,L.text,L.icon,null,L.clipped),_=_||L.text!==F.text.placed||L.icon!==F.icon.placed):(this.opacities[A]=new Mn(null,v,L.text,L.icon,L.skipFade,L.clipped),_=_||L.text||L.icon)}for(const A in S){const L=S[A];if(!this.opacities[A]){const F=new Mn(L,v,!1,!1);F.isHidden()||(this.opacities[A]=F,_=_||L.text.placed||L.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in I)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=I[A]);_?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h,_,v){const S=new Set;for(const T of h){const I=T.getBucket(o);I&&T.latestFeatureIndex&&o.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,S,T,T.collisionBoxArray,_,v,T.tileID,o.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,T.tileID),I.elevationType==="road"&&I.updateRoadElevation(T.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(o,h,_,v,S,T,I,A){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const L=o.layers[0].layout,F=o.layers[0].paint,H=!!o.layers[0].dynamicFilter(),U=new Mn(null,0,!1,!1,!0),Y=L.get("text-allow-overlap"),te=L.get("icon-allow-overlap"),se=L.get("text-variable-anchor"),fe=L.get("text-rotation-alignment")==="map",de=L.get("text-pitch-alignment")==="map",_e=F.get("symbol-z-offset"),Ee=L.get("symbol-elevation-reference")==="sea",xe=!_e.isConstant(),Re=new Mn(null,0,Y&&(te||!o.hasIconData()||L.get("icon-optional")),te&&(Y||!o.hasTextData()||L.get("text-optional")),!0);!o.collisionArrays&&v&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(v);const Te=(Pe,Ie,Oe)=>{for(let et=0;et<Ie/4;et++)Pe.opacityVertexArray.emplaceBack(Oe)};let De=0;T&&o.updateReplacement(I,T);for(let Pe=0;Pe<o.symbolInstances.length;Pe++){const Ie=o.symbolInstances.get(Pe),{numHorizontalGlyphVertices:Oe,numVerticalGlyphVertices:et,crossTileID:Ke,numIconVertices:pt,tileAnchorX:ot,tileAnchorY:vt}=Ie;let qt=null;const nt=this.retainedQueryData[o.bucketInstanceId];xe&&Ie&&nt&&(qt=_.latestFeatureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:nt.bucketIndex,sourceLayerIndex:nt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ue=_e.evaluate(qt,{}),wt=h.has(Ke);let lt=this.opacities[Ke];wt?lt=U:lt||(lt=Re,this.opacities[Ke]=lt),h.add(Ke);const Pt=Oe>0||et>0,Kt=pt>0,gr=this.placedOrientations[Ke],Ut=gr===a.bK.vertical,Ht=gr===a.bK.horizontal||gr===a.bK.horizontalOnly;!Pt&&!Kt||lt.isHidden()||De++;let yr=!1;if((Pt||Kt)&&T)for(const lr of o.activeReplacements){if(a.bY(lr,S,a.bZ.Symbol,A)||lr.min.x>ot||ot>lr.max.x||lr.min.y>vt||vt>lr.max.y)continue;const sr=a.b_(ot,vt,I.canonical,lr.footprintTileId.canonical);if(yr=a.b$(sr,lr.footprint),yr)break}if(Pt){const lr=yr?es:zr(lt.text);Te(o.text,Oe,Ut?es:lr),Te(o.text,et,Ht?es:lr);const sr=lt.text.isHidden(),{leftJustifiedTextSymbolIndex:cr,centerJustifiedTextSymbolIndex:Lr,rightJustifiedTextSymbolIndex:Cn,verticalPlacedTextSymbolIndex:Un}=Ie,Is=o.text.placedSymbolArray,Yr=sr||Ut?1:0;cr>=0&&(Is.get(cr).hidden=Yr),Lr>=0&&(Is.get(Lr).hidden=Yr),Cn>=0&&(Is.get(Cn).hidden=Yr),Un>=0&&(Is.get(Un).hidden=sr||Ht?1:0);const Bn=this.variableOffsets[Ke];Bn&&this.markUsedJustification(o,Bn.anchor,Ie,gr);const pn=this.placedOrientations[Ke];pn&&(this.markUsedJustification(o,"left",Ie,pn),this.markUsedOrientation(o,pn,Ie))}if(Kt){const lr=yr?es:zr(lt.icon),{placedIconSymbolIndex:sr,verticalPlacedIconSymbolIndex:cr}=Ie,Lr=o.icon.placedSymbolArray,Cn=lt.icon.isHidden()?1:0;sr>=0&&(Te(o.icon,pt,Ut?es:lr),Lr.get(sr).hidden=Cn),cr>=0&&(Te(o.icon,Ie.numVerticalIconVertices,Ht?es:lr),Lr.get(cr).hidden=Cn)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const lr=o.collisionArrays[Pe];if(lr){let sr=new a.P(0,0),cr=!0;if(lr.textBox||lr.verticalTextBox){if(se){const Cn=this.variableOffsets[Ke];Cn?(sr=qu(Cn.anchor,Cn.width,Cn.height,Cn.textOffset,Cn.textScale),fe&&sr._rotate(de?this.transform.angle:-this.transform.angle)):cr=!1}H&&(cr=!lt.clipped),lr.textBox&&Ea(o.textCollisionBox.collisionVertexArray,lt.text.placed,!cr||Ut,Ue,Ee,sr.x,sr.y),lr.verticalTextBox&&Ea(o.textCollisionBox.collisionVertexArray,lt.text.placed,!cr||Ht,Ue,Ee,sr.x,sr.y)}const Lr=cr&&!!(!Ht&&lr.verticalIconBox);lr.iconBox&&Ea(o.iconCollisionBox.collisionVertexArray,lt.icon.placed,Lr,Ue,Ee,Ie.hasIconTextFit?sr.x:0,Ie.hasIconTextFit?sr.y:0),lr.verticalIconBox&&Ea(o.iconCollisionBox.collisionVertexArray,lt.icon.placed,!Lr,Ue,Ee,Ie.hasIconTextFit?sr.x:0,Ie.hasIconTextFit?sr.y:0)}}}if(o.fullyClipped=De===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Pe.invProjMatrix,o.placementViewportMatrix=Pe.viewportMatrix,o.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function Ea(g,o,h,_,v,S,T){g.emplaceBack(o?1:0,h?1:0,S||0,T||0,_,v?1:0),g.emplaceBack(o?1:0,h?1:0,S||0,T||0,_,v?1:0),g.emplaceBack(o?1:0,h?1:0,S||0,T||0,_,v?1:0),g.emplaceBack(o?1:0,h?1:0,S||0,T||0,_,v?1:0)}const Ai=Math.pow(2,25),O=Math.pow(2,24),ae=Math.pow(2,17),we=Math.pow(2,16),Be=Math.pow(2,9),Lt=Math.pow(2,8),Qt=Math.pow(2,1);function zr(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const o=g.placed?1:0,h=Math.floor(127*g.opacity);return h*Ai+o*O+h*ae+o*we+h*Be+o*Lt+h*Qt+o}const es=0;class Ji{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,h,_,v,S,T){const I=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(I,v,o[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,L)=>A.sortKey-L.sortKey));this._currentPartIndex<I.length;){const A=I[this._currentPartIndex];if(h.placeLayerBucketPart(A,this._seenCrossTileIDs,_,A.symbolInstanceStart===0,T),this._currentPartIndex++,S())return!0}return!1}}class cs{constructor(o,h,_,v,S,T,I,A,L){this.placement=new wh(o,S,T,I,A,L),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,h,_,v,S){const T=a.o.now(),I=()=>{const A=a.o.now()-T;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=h[o[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=L)&&(!A.maxzoom||A.maxzoom>L)){const F=A,H=F.layout.get("symbol-z-elevate"),U=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,Y=F.layout.get("symbol-z-order"),te=Y==="viewport-y"||Y==="auto"&&!(Y!=="viewport-y"&&U),se=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),fe=te&&se,de=this._inProgressLayer=this._inProgressLayer||new Ji(F),_e=a.B(A.source,A.scope);if(de.continuePlacement(H||fe?v[_e]:_[_e],this.placement,this._showCollisionBoxes,A,I,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Va=512/a.al/2;class Ta{constructor(o,h,_){this.tileID=o,this.bucketInstanceId=_,this.index=new a.c3(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=o.canonical.x*a.al,S=o.canonical.y*a.al;for(let T=0;T<h.length;T++){const{key:I,crossTileID:A,tileAnchorX:L,tileAnchorY:F}=h.get(T),H=Math.floor((v+L)*Va),U=Math.floor((S+F)*Va);this.index.add(H,U),this.keys.push(I),this.crossTileIDs.push(A)}this.index.finish()}findMatches(o,h,_){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=Va/Math.pow(2,h.canonical.z-this.tileID.canonical.z),T=h.canonical.x*a.al,I=h.canonical.y*a.al;for(let A=0;A<o.length;A++){const L=o.get(A);if(L.crossTileID)continue;const{key:F,tileAnchorX:H,tileAnchorY:U}=L,Y=Math.floor((T+H)*S),te=Math.floor((I+U)*S),se=this.index.range(Y-v,te-v,Y+v,te+v).sort((fe,de)=>fe-de);for(const fe of se){const de=this.crossTileIDs[fe];if(this.keys[fe]===F&&!_.has(de)){_.add(de),L.crossTileID=de;break}}}}}class Bi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Da{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const _ in this.indexes){const v=this.indexes[_],S={};for(const T in v){const I=v[T];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),S[I.tileID.key]=I}this.indexes[_]=S}this.lng=o}addBucket(o,h,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let S=0;S<h.symbolInstances.length;S++)h.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const v=this.usedCrossTileIDs[o.overscaledZ];for(const S in this.indexes){const T=this.indexes[S];if(Number(S)>o.overscaledZ)for(const I in T){const A=T[I];A.tileID.isChildOf(o)&&A.findMatches(h.symbolInstances,o,v)}else{const I=T[o.scaledTo(Number(S)).key];I&&I.findMatches(h.symbolInstances,o,v)}}for(let S=0;S<h.symbolInstances.length;S++){const T=h.symbolInstances.get(S);T.crossTileID||(T.crossTileID=_.generate(),v.add(T.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Ta(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const _ of h.crossTileIDs)this.usedCrossTileIDs[o].delete(_)}removeStaleBuckets(o){let h=!1;for(const _ in this.indexes){const v=this.indexes[_];for(const S in v)o[v[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[S]),delete v[S],h=!0)}return h}}class Rl{constructor(){this.layerIndexes={},this.crossTileIDs=new Bi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,_,v){let S=this.layerIndexes[o.fqid];S===void 0&&(S=this.layerIndexes[o.fqid]=new Da);let T=!1;const I={};v.name!=="globe"&&S.handleWrapJump(_);for(const A of h){const L=A.getBucket(o);L&&o.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(A.tileID,L,this.crossTileIDs)&&(T=!0),I[L.bucketInstanceId]=!0)}return S.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(o){const h={};o.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Si=771;class vn{constructor(o,h,_,v){this.blendFunction=o,this.blendColor=h.toNonPremultipliedRenderColor(null),this.mask=_,this.blendEquation=v}}vn.Replace=[1,0,1,0],vn.disabled=new vn(vn.Replace,a.ao.transparent,[!1,!1,!1,!1]),vn.unblended=new vn(vn.Replace,a.ao.transparent,[!0,!0,!0,!0]),vn.alphaBlended=new vn([1,Si,1,Si],a.ao.transparent,[!0,!0,!0,!0]),vn.alphaBlendedNonPremultiplied=new vn([770,Si,770,Si],a.ao.transparent,[!0,!0,!0,!0]),vn.multiply=new vn([774,0,774,0],a.ao.transparent,[!0,!0,!0,!0]),vn.additive=new vn([1,1,1,1],a.ao.transparent,[!0,!0,!0,!0]);class wr{constructor(o,h,_){this.func=o,this.mask=h,this.range=_}}wr.ReadOnly=!1,wr.ReadWrite=!0,wr.disabled=new wr(519,wr.ReadOnly,[0,1]);const Ef=7680;class en{constructor(o,h,_,v,S,T){this.test=o,this.ref=h,this.mask=_,this.fail=v,this.depthFail=S,this.pass=T}}en.disabled=new en({func:519,mask:0},0,0,Ef,Ef,Ef);const Lp=1029,$y=2305;class Xr{constructor(o,h,_){this.enable=o,this.mode=h,this.frontFace=_}}function $g(g,o){const h=a.c9(g,3);a.cb(g,o),a.cf(g,3,h)}function qy(g,o){const h=a.c6([]);return a.c7(h,h,-o),a.c8(h,h,-g),h}function nT(g,o){const h=[g[0],g[1],0],_=[o[0],o[1],0];if(a.ag(h)>=1e-15){const T=a.aw([],h);a.c4(_,T,a.bI(_,T)),o[0]=_[0],o[1]=_[1]}const v=a.bH([],o,g);if(a.c5(v)<1e-15)return null;const S=Math.atan2(-v[1],v[0]);return qy(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),S)}Xr.disabled=new Xr(!1,Lp,$y),Xr.backCCW=new Xr(!0,Lp,$y),Xr.backCW=new Xr(!0,Lp,2304),Xr.frontCW=new Xr(!0,1028,2304),Xr.frontCCW=new Xr(!0,1028,$y);class Gu{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){if(o){const h=o instanceof a.ae?o:new a.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(h.x=a.bS(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(o,h,_){if(this.orientation=null,!this.position)return;const v=this.position,S=_||(this._elevation?this._elevation.getAtPointOrZero(a.ae.fromLngLat(o)):0),T=a.ae.fromLngLat(o,S),I=[T.x-v.x,T.y-v.y,T.z-v.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=nT(I,h)}setPitchBearing(o,h){this.orientation=qy(a.an(o),a.an(-h))}}class Gy{constructor(o,h){this._transform=a.bz([]),this.orientation=h,this.position=o}get mercatorPosition(){const o=this.position;return new a.ae(o[0],o[1],o[2])}get position(){const o=a.c9(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var h;o&&a.cf(this._transform,3,[(h=o)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||a.c6([]),o&&$g(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=qy(o,h),$g(this._transform,this._orientation)}forward(){const o=a.c9(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=a.c9(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=a.c9(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){const _=new Float64Array(16);return a.bk(_,this.getWorldToCamera(o,h)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,h,_){const v=this.position;a.c4(v,v,-o);const S=new Float64Array(16);return a.bp(S,[_,_,_]),a.bq(S,S,v),S[10]*=h,S}getWorldToCamera(o,h){const _=new Float64Array(16),v=new Float64Array(4),S=this.position;return a.ca(v,this._orientation),a.c4(S,S,-o),a.cb(_,v),a.bq(_,_,S),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(o,h,_,v){const S=new Float64Array(16);return a.cc(S,o,h,_,v),S}getCameraToClipOrthographic(o,h,_,v,S,T){const I=new Float64Array(16);return a.cd(I,o,h,_,v,S,T),I}getDistanceToElevation(o,h=!1){const _=o===0?0:a.ce(o,h?a.a_(this.position[1]):this.position[1]),v=this.forward();return(_-this.position[2])/v[2]}clone(){return new Gy([...this.position],[...this.orientation])}}const oo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Go{constructor(o=0,h=0,_=0,v=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=_,this.right=v}interpolate(o,h,_){return h.top!=null&&o.top!=null&&(this.top=a.ak(o.top,h.top,_)),h.bottom!=null&&o.bottom!=null&&(this.bottom=a.ak(o.bottom,h.bottom,_)),h.left!=null&&o.left!=null&&(this.left=a.ak(o.left,h.left,_)),h.right!=null&&o.right!=null&&(this.right=a.ak(o.right,h.right,_)),this}getCenter(o,h){const _=a.aA((this.left+o-this.right)/2,0,o),v=a.aA((this.top+h-this.bottom)/2,0,h);return new a.P(_,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Go(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Tf=15;class Fp{constructor(o,h,_,v,S,T,I){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new a.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Go,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Gy,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new Fp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Tf}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(o||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return a.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=a.cl(this.projectionOptions);const _=this.getProjection(),v=!a.bx(h,_);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.cl({name:"mercator"});const h=o!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bS(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const h=-o*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=a.cm(),a.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=a.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=a.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let v=0,S=0;for(let T=0;T<h.length;T++){const I=new a.P(h[T][0]*this.width,_+h[T][1]*(this.height-_)),A=o.pointCoordinate(I);if(!A)continue;const L=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);v+=A[3]*L,S+=L}return S===0?NaN:v/S}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(o),S=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-_,S);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let _;_=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];const v=a.ag(a.av([],this._camera.position,_));return a.aA(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!a.co(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){const _=[o.position.x,o.position.y,o.position.z];a.cp(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,h=new Gu;return h.position=new a.ae(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(o){if(!a.cq(o))return!1;a.cr(o,o);const h=a.cs([],[0,0,-1],o),_=a.cs([],[0,-1,0],o);if(_[2]<0)return!1;const v=nT(h,_);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=a.aA(o[2],v/_,v/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,_){this._unmodified=!1,this._edgeInsets.interpolate(o,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new a.ct(0,o)];if(this.renderWorldCopies){const _=this.pointCoordinate(new a.P(0,0)),v=this.pointCoordinate(new a.P(this.width,0)),S=this.pointCoordinate(new a.P(this.width,this.height)),T=this.pointCoordinate(new a.P(0,this.height)),I=Math.floor(Math.min(_.x,v.x,S.x,T.x)),A=Math.floor(Math.max(_.x,v.x,S.x,T.x)),L=1;for(let F=I-L;F<=A+L;F++)F!==0&&h.push(new a.ct(F,o))}return h}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,h,_){let v=[];const S=_!=null,T=!S;if(T&&this.zoom<h||S&&_[0]===0&&_[1]===0)return v;const I=new Set,A=(F,H,U,Y,te)=>{const se=a.cX(H,F,U,Y,te);I.has(se)||(v.push(new a.aP(F,H,U,Y,te)),I.add(se))};for(let F=0;F<o.length;F++){const H=o[F];if(T&&H.canonical.z!==h)continue;const U=H.canonical,Y=H.overscaledZ,te=H.wrap,se=1<<U.z,fe=U.x+1<se,de=U.x>0,_e=U.y+1<se,Ee=U.y>0,xe=H.wrap-(de?0:1),Re=H.wrap+(fe?0:1),Te=de?U.x-1:se-1,De=fe?U.x+1:0;if(S)_[0]<0?(A(Y,Re,U.z,De,U.y),_[1]<0&&_e&&(A(Y,te,U.z,U.x,U.y+1),A(Y,Re,U.z,De,U.y+1)),_[1]>0&&Ee&&(A(Y,te,U.z,U.x,U.y-1),A(Y,Re,U.z,De,U.y-1))):_[0]>0?(A(Y,xe,U.z,Te,U.y),_[1]<0&&_e&&(A(Y,te,U.z,U.x,U.y+1),A(Y,xe,U.z,Te,U.y+1)),_[1]>0&&Ee&&(A(Y,te,U.z,U.x,U.y-1),A(Y,xe,U.z,Te,U.y-1))):_[1]<0&&_e?A(Y,te,U.z,U.x,U.y+1):Ee&&A(Y,te,U.z,U.x,U.y-1);else{const Pe=H.visibleQuadrants;1&Pe&&(A(Y,xe,U.z,Te,U.y),Ee&&(A(Y,te,U.z,U.x,U.y-1),A(Y,xe,U.z,Te,U.y-1))),2&Pe&&(A(Y,Re,U.z,De,U.y),Ee&&(A(Y,te,U.z,U.x,U.y-1),A(Y,Re,U.z,De,U.y-1))),4&Pe&&(A(Y,xe,U.z,Te,U.y),_e&&(A(Y,te,U.z,U.x,U.y+1),A(Y,xe,U.z,Te,U.y+1))),8&Pe&&(A(Y,Re,U.z,De,U.y),_e&&(A(Y,te,U.z,U.x,U.y+1),A(Y,Re,U.z,De,U.y+1)))}}const L=[];for(const F of v)v.some(H=>F.isChildOf(H))||L.push(F);if(v=L.filter(F=>!o.some(H=>!!(F.overscaledZ<h&&H.isChildOf(F))||F.equals(H)||F.isChildOf(H))),T){const F=1<<h,H=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[F*H.x,F*H.y],Y=4,te=Y*Y;v=v.filter(se=>{const fe=se.canonical.x+.5-U[0],de=se.canonical.y+.5-U[1];return fe*fe+de*de<te})}return v}extendTileCoverToNearPlane(o,h,_){const v=[],S=new Set;for(const _e of o)S.add(_e.key);const T=(_e,Ee,xe,Re,Te)=>{const De=a.cX(Ee,_e,xe,Re,Te);S.has(De)||(v.push(new a.aP(_e,Ee,xe,Re,Te)),S.add(De))},I=o.reduce((_e,Ee)=>Math.max(_e,Ee.overscaledZ),_),A=1<<_,L=[new a.P(0,0),new a.P(a.al,0),new a.P(a.al,a.al),new a.P(0,a.al)],F=new a.P(0,0),H=new a.P(0,0),U=(_e,Ee)=>{const xe=Math.floor(_e[0]),Re=Math.floor(_e[1]),Te=(_e[0]-xe)*a.al,De=(_e[1]-Re)*a.al,Pe=Math.floor(Ee[0]),Ie=Math.floor(Ee[1]),Oe=(Ee[0]-Pe)*a.al,et=(Ee[1]-Ie)*a.al;for(let Ke=-1;Ke<=1;Ke++){const pt=xe+Ke;if(!(pt<0||pt>=A)){F.x=Te-Ke*a.al,H.x=Oe-(pt-Pe)*a.al;for(let ot=-1;ot<=1;ot++){const vt=Re+ot;F.y=De-ot*a.al,H.y=et-(vt-Ie)*a.al,a.cY(F,H,L)&&T(I,0,_,pt,vt)}}}},Y=h.points,te=Y[a.cu],se=Y[a.cv],fe=this._projectToGround(te,Y[a.cw]),de=this._projectToGround(se,Y[a.cx]);return U(te,fe),U(se,de),v}_projectToGround(o,h){return a.cy(a.cz(),o,h,o[2]/(o[2]-h[2]))}coveringTiles(o){let h=this.coveringZoomLevel(o);const _=h,v=this.elevation&&this.elevation.exaggeration(),S=v&&!o.isTerrainDEM,T=this.projection.name==="mercator";if(o.minzoom!==void 0&&h<o.minzoom)return[];o.maxzoom!==void 0&&h>o.maxzoom&&(h=o.maxzoom);const I=this.locationCoordinate(this.center),A=this.center.lat,L=1<<h,F=[L*I.x,L*I.y,0],H=this.projection.name==="globe",U=!H,Y=a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,U),te=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),se=L*a.ce(1,this.center.lat),fe=this._camera.position[2]/a.ce(1,this.center.lat),de=[L*te.x,L*te.y,fe*(U?1:se)],_e=H||v,Ee=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),xe=this.isLODDisabled(!0)?h:0;let Re;if(this._elevation&&o.isTerrainDEM)Re=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();Re=Ue?Ue.max:this._centerAltitude}else Re=this._centerAltitude;const Te=o.isTerrainDEM?-Re:this._elevation?this._elevation.getMinElevationBelowMSL():0,De=this.projection.isReprojectedInTileSpace?a.cB(this):1,Pe=Ue=>{const lt=new a.ae(Ue.x+25e-6,Ue.y,Ue.z),Pt=new a.ae(Ue.x,Ue.y+25e-6,Ue.z),Kt=Ue.toLngLat(),gr=lt.toLngLat(),Ut=Pt.toLngLat(),Ht=this.locationCoordinate(Kt),yr=this.locationCoordinate(gr),lr=this.locationCoordinate(Ut),sr=Math.hypot(yr.x-Ht.x,yr.y-Ht.y),cr=Math.hypot(lr.x-Ht.x,lr.y-Ht.y);return Math.sqrt(sr*cr)*De/25e-6},Ie=Ue=>{const wt=Re,lt=Te;return{aabb:a.cE(this,L,0,0,0,Ue,lt,wt,this.projection),zoom:0,x:0,y:0,minZ:lt,maxZ:wt,wrap:Ue,fullyVisible:!1}},Oe=[];let et=[];const Ke=h,pt=o.reparseOverscaled?_:h,ot=(fe-this._centerAltitude)*se,vt=Ue=>{if(!this._elevation||!Ue.tileID||!T)return;const wt=this._elevation.getMinMaxForTile(Ue.tileID),lt=Ue.aabb;wt?(lt.min[2]=wt.min,lt.max[2]=wt.max,lt.center[2]=(lt.min[2]+lt.max[2])/2):(Ue.shouldSplit=nt(Ue),Ue.shouldSplit||(lt.min[2]=lt.max[2]=lt.center[2]=this._centerAltitude))},qt=(Ue,wt)=>{if(.707*wt<Ue)return 1;const lt=wt/Ue;return lt/(1.4144271570014144+(Math.pow(1.1,lt-1.4144271570014144+1)-1)/(1.1-1)-1)},nt=Ue=>{if(Ue.zoom<xe)return!0;if(Ue.zoom===Ke)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const wt=Ue.aabb.distanceX(de),lt=Ue.aabb.distanceY(de);let Pt=ot,Kt=1;if(H){Pt=Ue.aabb.distanceZ(de);const cr=Math.pow(2,Ue.zoom),Lr=a.a_((Ue.y+1)/cr),Cn=a.a_(Ue.y/cr),Un=Math.min(Math.max(A,Lr),Cn),Is=a.d0(Un)/a.d0(A);if(Kt=Un===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Is/this._mercatorScaleRatio),this.zoom<=a.cZ&&Ue.zoom===Ke-1&&Is>=.9)return!0}else if(S&&(Pt=Ue.aabb.distanceZ(de)*se),this.projection.isReprojectedInTileSpace&&_<=5){const cr=Math.pow(2,Ue.zoom),Lr=Pe(new a.ae((Ue.x+.5)/cr,(Ue.y+.5)/cr));Kt=Lr>.85?1:Lr}if(!T&&!H){const cr=Math.sqrt(wt*wt+lt*lt+Pt*Pt);let Lr=(1<<Ke-Ue.zoom)*Ee*Kt;return Lr*=qt(Math.max(Pt,ot),cr),cr<Lr}let gr=Number.MAX_VALUE,Ut=0;const Ht=Ue.aabb.getCorners(),yr=[];for(const cr of Ht){a.av(yr,cr,de),H||(S?yr[2]*=se:yr[2]=ot);const Lr=a.bI(yr,this._camera.forward());Lr<gr&&(gr=Lr,Ut=Math.abs(yr[2]))}let lr=(1<<Ke-Ue.zoom)*Ee*Kt;if(lr*=qt(Math.max(Ut,ot),gr),gr<lr)return!0;const sr=Ue.aabb.closestPoint(F);return sr[0]===F[0]&&sr[1]===F[1]};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)Oe.push(Ie(-Ue)),Oe.push(Ie(Ue));for(Oe.push(Ie(0));Oe.length>0;){const Ue=Oe.pop(),wt=Ue.x,lt=Ue.y;let Pt=Ue.fullyVisible;const Kt=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!Pt){let gr=_e?Ue.aabb.intersects(Y):Ue.aabb.intersectsFlat(Y);if(gr===0&&Kt()){const Ut=new a.cC(Ue.zoom,wt,lt);gr=a.cD(this,L,Ut,!0).intersects(Y)}if(gr===0)continue;Pt=gr===2}if(Ue.zoom!==Ke&&nt(Ue))for(let gr=0;gr<4;gr++){const Ut=(wt<<1)+gr%2,Ht=(lt<<1)+(gr>>1),yr={aabb:T?Ue.aabb.quadrant(gr):a.cE(this,L,Ue.zoom+1,Ut,Ht,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:Ut,y:Ht,wrap:Ue.wrap,fullyVisible:Pt,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};S&&!H&&(yr.tileID=new a.aP(Ue.zoom+1===Ke?pt:Ue.zoom+1,Ue.wrap,Ue.zoom+1,Ut,Ht),vt(yr)),Oe.push(yr)}else{const gr=Ue.zoom===Ke?pt:Ue.zoom;if(o.minzoom&&o.minzoom>gr)continue;let Ut=0;if(!Pt){let sr=_e?Ue.aabb.intersectsPrecise(Y):Ue.aabb.intersectsPreciseFlat(Y);if(sr===0&&Kt()){const cr=new a.cC(Ue.zoom,wt,lt);sr=a.cD(this,L,cr,!0).intersectsPrecise(Y)}if(sr===0)continue;if(o.calculateQuadrantVisibility)if(Y.containsPoint(Ue.aabb.center))Ut=15;else for(let cr=0;cr<4;cr++)Ue.aabb.quadrant(cr).intersects(Y)!==0&&(Ut|=1<<cr)}const Ht=F[0]-(.5+wt+(Ue.wrap<<Ue.zoom))*(1<<h-Ue.zoom),yr=F[1]-.5-lt,lr=Ue.tileID?Ue.tileID:new a.aP(gr,Ue.wrap,Ue.zoom,wt,lt);o.calculateQuadrantVisibility&&(lr.visibleQuadrants=Ut),et.push({tileID:lr,distanceSq:Ht*Ht+yr*yr})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,wt=this.horizonLineFromTop();et=et.filter(lt=>{const Pt=[0,0,0,1],Kt=[a.al,a.al,0,1],gr=this.calculateFogTileMatrix(lt.tileID.toUnwrapped());a.aC(Pt,Pt,gr),a.aC(Kt,Kt,gr);const Ut=a.cF([],Pt,Kt),Ht=a.cG([],Pt,Kt),yr=a.c_(Ut,Ht);if(yr===0)return!0;let lr=!1;const sr=this._elevation;if(sr&&yr>Ue&&wt!==0){const cr=this.calculateProjMatrix(lt.tileID.toUnwrapped());let Lr;o.isTerrainDEM||(Lr=sr.getMinMaxForTile(lt.tileID)),Lr||(Lr={min:Te,max:Re});const Cn=a.cH(this.rotation),Un=[Cn[0]*a.al,Cn[1]*a.al,Lr.max];a.af(Un,Un,cr),lr=(1-Un[1])*this.height*.5<wt}return yr<Ue||lr})}return et.sort((Ue,wt)=>Ue.distanceSq-wt.distanceSq).map(Ue=>Ue.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){const h=a.aA(o.lat,-a.cI,a.cI),_=this.projection.project(o.lng,h);return new a.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,h){let _,v;const S=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;_=(h.x-S.x)/I,v=(h.y-S.y)/I}else{const I=this.pointCoordinate(h),A=this.pointCoordinate(S);_=I.x-A.x,v=I.y-A.y}const T=this.locationCoordinate(o);this.setLocation(new a.ae(T.x-_,T.y-v))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,h){return this.projection.locationPoint(this,o,h)}locationPoint3D(o,h){return this.projection.locationPoint(this,o,h,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,h){return this.coordinateLocation(this.pointCoordinate3D(o,h))}locationCoordinate(o,h){const _=h?a.ce(h,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new a.ae(v.x,v.y,_)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,h){const _=h??this._centerAltitude,v=[o.x,o.y,0,1],S=[o.x,o.y,1,1];a.aC(v,v,this.pixelMatrixInverse),a.aC(S,S,this.pixelMatrixInverse);const T=S[3];a.cJ(v,v,1/v[3]),a.cJ(S,S,1/T);const I=v[2],A=S[2];return{p0:v,p1:S,t:I===A?0:(_-I)/(A-I)}}screenPointToMercatorRay(o){const h=[o.x,o.y,0,1],_=[o.x,o.y,1,1];return a.aC(h,h,this.pixelMatrixInverse),a.aC(_,_,this.pixelMatrixInverse),a.cJ(h,h,1/h[3]),a.cJ(_,_,1/_[3]),h[2]=a.ce(h[2],this._center.lat)*this.worldSize,_[2]=a.ce(_[2],this._center.lat)*this.worldSize,a.cJ(h,h,1/this.worldSize),a.cJ(_,_,1/this.worldSize),new a.ax([h[0],h[1],h[2]],a.aw([],a.av([],_,h)))}rayIntersectionCoordinate(o){const{p0:h,p1:_,t:v}=o,S=a.ce(h[2],this._center.lat),T=a.ce(_[2],this._center.lat);return new a.ae(a.ak(h[0],_[0],v)/this.worldSize,a.ak(h[1],_[1],v)/this.worldSize,a.ak(S,T,v))}pointCoordinate(o,h=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,h)}pointCoordinate3D(o,h){if(!this.elevation)return this.pointCoordinate(o,h);let _=this.projection.pointCoordinate3D(this,o.x,o.y);if(_)return new a.ae(_[0],_[1],_[2]);let v=0,S=this.horizonLineFromTop();if(o.y>S)return this.pointCoordinate(o,h);const T=.02*S,I=o.clone();for(let A=0;A<10&&S-v>T;A++){I.y=a.ak(v,S,.66);const L=this.projection.pointCoordinate3D(this,I.x,I.y);L?(S=I.y,_=L):v=I.y}return _?new a.ae(_[0],_[1],_[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=a.cK)return!this.isPointAboveHorizon(o);const h=this.pointCoordinate(o);return h.y>=0&&h.y<=1}_coordinatePoint(o,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,_+o.toAltitude(),1];return a.aC(v,v,this.pixelMatrix),v[3]>0?new a.P(v[0]/v[3],v[1]/v[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,S=this.pointLocation3D(new a.P(h,o)),T=this.pointLocation3D(new a.P(v,o)),I=this.pointLocation3D(new a.P(v,_)),A=this.pointLocation3D(new a.P(h,_));let L=Math.min(S.lng,T.lng,I.lng,A.lng),F=Math.max(S.lng,T.lng,I.lng,A.lng),H=Math.min(S.lat,T.lat,I.lat,A.lat),U=Math.max(S.lat,T.lat,I.lat,A.lat);const Y=Math.pow(2,-this.zoom)/16*270,te=this.projection.name==="globe"?1:4,se=(fe,de,_e,Ee,xe)=>{const Re=(fe+_e)/2,Te=(de+Ee)/2,De=new a.P(Re,Te),{lng:Pe,lat:Ie}=this.pointLocation3D(De),Oe=Math.max(0,L-Pe,H-Ie,Pe-F,Ie-U);L=Math.min(L,Pe),F=Math.max(F,Pe),H=Math.min(H,Ie),U=Math.max(U,Ie),(xe<te||Oe>Y)&&(se(fe,de,Re,Te,xe+1),se(Re,Te,_e,Ee,xe+1))};if(se(h,o,v,o,1),se(v,o,v,_,1),se(v,_,h,_,1),se(h,_,h,o,1),this.projection.name==="globe"){const[fe,de]=a.cL(this);fe?(U=90,F=180,L=-180):de&&(H=-90,F=180,L=-180)}return new a.aI(new a.aS(L,H),new a.aS(F,U))}_getBoundsRectangular(o,h){const{top:_,left:v}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,I=new a.P(v,_),A=new a.P(T,_),L=new a.P(T,S),F=new a.P(v,S);let H=this.pointCoordinate(I,o),U=this.pointCoordinate(A,o);const Y=this.pointCoordinate(L,h),te=this.pointCoordinate(F,h),se=(fe,de)=>(de.y-fe.y)/(de.x-fe.x);return H.y>1&&U.y>=0?H=new a.ae((1-te.y)/se(te,H)+te.x,1):H.y<0&&U.y<=1&&(H=new a.ae(-te.y/se(te,H)+te.x,0)),U.y>1&&H.y>=0?U=new a.ae((1-Y.y)/se(Y,U)+Y.x,1):U.y<0&&H.y<=1&&(U=new a.ae(-Y.y/se(Y,U)+Y.x,0)),new a.aI().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(Y))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=o.visibleDemTiles.reduce((_,v)=>{if(v.dem){const S=v.dem.tree;_.min=Math.min(_.min,S.minimums[0]),_.max=Math.max(_.max,S.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-a.cI,this.maxLat=a.cI,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.aF(this.minLng)*this.tileSize,this.worldMaxX=a.aF(this.maxLng)*this.tileSize,this.worldMinY=a.aJ(this.maxLat)*this.tileSize,this.worldMaxY=a.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,h){return this.projection.createTileMatrix(this,h,o)}calculateDistanceTileData(o){const h=o.key,_=this._distanceTileDataCache;if(_[h])return _[h];const v=o.canonical,S=1/this.height,T=this.cameraWorldSize,I=T/this.zoomScale(v.z),A=(v.x+Math.pow(2,v.z)*o.wrap)*I,L=v.y*I,F=this.point;F.x*=T/this.worldSize,F.y*=T/this.worldSize;const H=this.angle,U=Math.sin(-H),Y=-Math.cos(-H);return _[h]={bearing:[U,Y],center:[(F.x-A)*S,(F.y-L)*S],scale:I/a.al*S},_[h]}calculateFogTileMatrix(o){const h=o.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return a.aB(v,this.worldToFogMatrix,v),_[h]=new Float32Array(v),_[h]}calculateProjMatrix(o,h=!1,_=!1){const v=o.key;let S;if(S=_?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,S[v])return S[v];const T=this.calculatePosMatrix(o,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,a.aB(T,I,T),S[v]=new Float32Array(T),S[v]}calculatePixelsToTileUnitsMatrix(o){const h=o.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const v=a.cM(o,this);return _[h]=v,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,h=a.bp([],[o,o,o]);return a.aB(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const h=a.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),v=this._camera.forward(),S=a.ce(1,this._center.lat);_[2]/=S,v[2]/=S,a.aw(v,v);const T=o.raycast(_,v,o.exaggeration());if(T){const I=a.bG([],_,v,T),A=new a.ae(I[0],I[1],a.ce(I[2],a.a_(I[1]))),L=(A.z+a.ag([A.x-_[0],A.y-_[1],A.z-_[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const h=this._elevation,_=a.ce(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(_),S=h.getAtPointOrZero(new a.ae(...v)),T=this.pixelsPerMeter/this.worldSize*S,I=this._minimumHeightOverTerrain(),A=v[2]-T;if(A<=I)if(A<0||o){const L=this.locationCoordinate(this._center,this._centerAltitude),F=[v[0],v[1],L.z-v[2]],H=a.ag(F);F[2]-=(I-A)/this._pixelsPerMercatorPixel;const U=a.ag(F);if(U===0)return;a.c4(F,F,H/U*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],L.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const U=this.center;return U.lat=a.aA(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(U.lng=a.aA(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:v}=this.point;let S=0,T=_,I=v;const A=this.width/2,L=this.height/2,F=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(v-L<F&&(I=F+L),v+L>H&&(I=H-L),H-F<this.height&&(S=Math.max(S,this.height/(H-F)),I=(H+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,te=this.worldSize/2-(U+Y)/2;T=(_+te+this.worldSize)%this.worldSize-te,T-A<U&&(T=U+A),T+A>Y&&(T=Y-A),Y-U<this.width&&(S=Math.max(S,this.width/(Y-U)),T=(Y+U)/2)}T===_&&I===v||this._allowWorldUnderZoom||(this.center=this.unproject(new a.P(T,I))),S&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ce(1,this.center.lat)/a.ce(1,a.d1));const v=a.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?_:1,T=this._camera.getWorldToCamera(this.worldSize,S);let I;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-o.x/this.width,A[9]=2*o.y/this.height,this.isOrthographic){let Ie=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Oe=Ie*this.aspect,et=-Oe,Ke=-Ie;Oe-=o.x,et-=o.x,Ie+=o.y,Ke+=o.y,I=this._camera.getCameraToClipOrthographic(et,Oe,Ke,Ie,this._nearZ,this._farZ),((pt,ot,vt,qt)=>{for(let nt=0;nt<16;nt++)pt[nt]=a.ak(ot[nt],vt[nt],qt)})(I,I,A,a.c$(this.pitch>=Tf?1:this.pitch/Tf))}else I=A;const L=a.cO([],A,T);let F=a.cO([],I,T);if(this.projection.isReprojectedInTileSpace){const Ie=this.locationCoordinate(this.center),Oe=a.bz([]);a.bq(Oe,Oe,[Ie.x*this.worldSize,Ie.y*this.worldSize,0]),a.aB(Oe,Oe,a.cP(this)),a.bq(Oe,Oe,[-Ie.x*this.worldSize,-Ie.y*this.worldSize,0]),a.aB(F,F,Oe),a.aB(L,L,Oe),this.inverseAdjustmentMatrix=a.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.cR([],F,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=F,this.invProjMatrix=a.bk(new Float64Array(16),this.projMatrix),h){const Ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ie[8]=2*-o.x/this.width,Ie[9]=2*o.y/this.height,this.expandedFarZProjMatrix=a.cO([],Ie,T)}else this.expandedFarZProjMatrix=this.projMatrix;const H=a.bk([],I);this.frustumCorners=a.cS.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const U=new Float32Array(16);a.bz(U),a.cR(U,U,[1,-1,1]),a.cT(U,U,this._pitch),a.bA(U,U,this.angle);const Y=a.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.by(Y);const te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-o.x/this.width,Y[9]=2*(o.y+te)/this.height,this.skyboxMatrix=a.aB(U,Y,U);const se=this.point,fe=se.x,de=se.y,_e=this.width%2/2,Ee=this.height%2/2,xe=Math.cos(this.angle),Re=Math.sin(this.angle),Te=fe-Math.round(fe)+xe*_e+Re*Ee,De=de-Math.round(de)+xe*Ee+Re*_e,Pe=new Float64Array(F);if(a.bq(Pe,Pe,[Te>.5?Te-1:Te,De>.5?De-1:De,0]),this.alignedProjMatrix=Pe,F=a.bB(),a.cR(F,F,[this.width/2,-this.height/2,1]),a.bq(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=a.bB(),a.cR(F,F,[1,-1,1]),a.bq(F,F,[-1,-1,0]),a.cR(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=a.aB(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},F=a.bk(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.cU(this);const Ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.af(Ie,Ie,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,S=[o,o,h];a.c4(S,S,v),a.c4(_,_,-1),a.cV(_,_,S);const T=a.bB();a.bq(T,T,_),a.cR(T,T,S),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,v)}_computeCameraPosition(o){const h=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),v=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-_[0]*S,v.y/this.worldSize-_[1]*S,o/this.worldSize*this._centerAltitude-_[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],v=o[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(S=Math.min((h-_)/v,1)),this._camera.position=a.bG([],this._camera.position,o,S),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:v}=this._camera.getPitchBearing(),S=a.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.an(this._maxPitch)),I=Math.max((o[2]-S)/Math.cos(_),T),A=this._zoomFromMercatorZ(I);a.bG(o,o,h,I),this._pitch=a.aA(_,a.an(this.minPitch),a.an(this.maxPitch)),this.angle=a.bS(v,-Math.PI,Math.PI),this._setZoom(a.aA(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let h=0,_=a.cK,v=0,S=1/0;for(;_-h>1e-6&&_>h;){const T=h+.5*(_-h),I=this.tileSize*Math.pow(2,T),A=this.getCameraToCenterDistance(this.projection,T,I),L=this.scaleZoom(A/(Math.max(0,o)*this.tileSize)),F=Math.abs(T-L);F<S&&(S=F,v=T),T<L?h=T:_=T}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,h){const _=Math.min(o.x,h.x),v=Math.max(o.x,h.x),S=Math.min(o.y,h.y),T=Math.max(o.y,h.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new a.P(_,S),new a.P(v,T),new a.P(_,T),new a.P(v,S)],A=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const F of I){const H=this.pointRayIntersection(F);if(H.t<0)return!0;const U=this.rayIntersectionCoordinate(H);if(U.x<A||U.y<0||U.x>L||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(o,h){const _=a.ag(a.av([],this._camera.position,o)),v=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([h,_,v],S){const T=[h,_,v,1];a.aC(T,T,S);const I=T[3]=Math.max(T[3],1e-6);return T[0]/=I,T[1]/=I,T[2]/=I,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,o))}}getCameraToCenterDistance(o,h=this.zoom,_=this.worldSize){const v=a.cN(o,h,this.width,this.height,1024),S=o.pixelSpaceConversion(this.center.lat,_,v);let T=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(T=a.ak(1,T,a.c$(this.pitch>=Tf?1:this.pitch/Tf))),T}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.aB(o,o,this.globeMatrix),o}getFrustum(o){return a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const wd=(g,o)=>{if(o>0&&g.terrain&&a.w("Cutoff is currently disabled on terrain"),o<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=g.transform,_=Math.max(Math.abs(h._zoom-(g.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?a.ah(60,45,h.pitch):a.ah(30,15,h.pitch),S=h._farZ-h._nearZ,T=o*h.height,I=((1-(A=v))*h.cameraToCenterDistance+A*(h._farZ+T))*_;var A;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(I-h._nearZ)/S,(I-T-h._nearZ)/S]}}},lo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class AA{constructor(o,h){this.aabb=o,this.lastCascade=h}}class PA{add(o,h){const _=this.receivers[o.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],h.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],h.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],h.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],h.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],h.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],h.max[2])):this.receivers[o.key]=new AA(h,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,h,_){const v=a.d8.fromPoints(o.points);let S=0;for(const T in this.receivers){const I=this.receivers[T];if(!I||!v.intersectsAabb(I.aabb))continue;I.aabb.min=v.closestPoint(I.aabb.min),I.aabb.max=v.closestPoint(I.aabb.max);const A=I.aabb.getCorners();for(let L=0;L<_.length;L++){let F=!0;for(const H of A){const U=[H[0]*h,H[1]*h,H[2]];if(a.af(U,U,_[L].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){F=!1;break}}if(I.lastCascade=L,S=Math.max(S,L),F)break}}return S+1}}class qg{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new PA,this._depthMode=new wr(o.context.gl.LEQUAL,wr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(lo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(lo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(lo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,h){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=_.style.order.reduce((te,se)=>{const fe=_.style._mergedLayers[se];return te+(fe.hasShadowPass()&&!fe.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const S=_.context,T=lo.shadowMapResolution,I=lo.shadowMapResolution;if(this._cascades.length===0||lo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let te=0;te<lo.cascadeCount;++te){const se=_._shadowMapDebug,fe=S.gl,de=S.createFramebuffer(T,I,se,"texture"),_e=new a.T(S,{width:T,height:I,data:null},fe.DEPTH_COMPONENT16);if(de.depthAttachment.set(_e.texture),se){const Ee=new a.T(S,{width:T,height:I,data:null},fe.RGBA8);de.colorAttachment.set(Ee.texture)}this._cascades.push({framebuffer:de,texture:_e,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.cA,scale:0})}}this.shadowDirection=sT(h);let A=0;if(o.elevation){const te=o.elevation,se=[1e4,-1e4];te.visibleDemTiles.filter(fe=>fe.dem).forEach(fe=>{const de=fe.dem.tree;se[0]=Math.min(se[0],de.minimums[0]),se[1]=Math.max(se[1],de.maximums[0])}),se[0]!==1e4&&(A=(se[1]-se[0])*te.exaggeration())}const L=1.5*o.cameraToCenterDistance,F=3*L,H=new Float64Array(16);for(let te=0;te<this._cascades.length;++te){const se=this._cascades[te];let fe=o.height/50,de=1;lo.cascadeCount===1?de=F:te===0?de=L:(fe=L,de=F);const[_e,Ee]=iT(o,this.shadowDirection,fe,de,lo.shadowMapResolution,A);se.scale=o.scale,se.matrix=_e,se.boundingSphereRadius=Ee,a.bk(H,se.matrix),se.frustum=a.cA.fromInvProjectionMatrix(H,1,0,!0),se.far=de}const U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/lo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=lo.shadowMapResolution,this._uniformValues.u_shadowmap_0=oo.ShadowMap0,this._uniformValues.u_shadowmap_1=oo.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Y=_.transform.elevation;for(const te of this._groundShadowTiles){let se={min:0,max:0};if(Y){const fe=Y.getMinMaxForTile(te);fe&&(se=fe)}this.addShadowReceiver(te.toUnwrapped(),se.min,se.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,h){if(!this.enabled)return;const _=this.painter,v=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),v.viewport.set([0,0,lo.shadowMapResolution,lo.shadowMapResolution]);for(let S=0;S<this._numCascadesToRender;++S){_.currentShadowCascade=S,v.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),v.clear({color:a.ao.white,depth:1});for(const T of o.order){const I=o._mergedLayers[T];if(!I.hasShadowPass()||I.isHidden(_.transform.zoom))continue;const A=o.getLayerSourceCache(I),L=A?h[A.id]:void 0;(I.type==="model"||L&&L.length)&&_.renderLayer(_,A,I,L)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,h=o.style,_=o.context,v=_.gl,S=h.directionalLight,T=h.ambientLight;if(!S||!T)return;const I=[],A=wd(o,o.longestCutoffRange);A.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const L=Lc(h,S,T),F=new wr(v.LEQUAL,wr.ReadOnly,o.depthRangeFor3D),H=new en({func:v.EQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.KEEP);for(const U of this._groundShadowTiles){const Y=U.toUnwrapped(),te=o.isTileAffectedByFog(U),se=o.getOrCreateProgram("groundShadow",{defines:I,overrideFog:te});this.setupShadows(Y,se),o.uploadCommonUniforms(_,se,Y,null,A);const fe={u_matrix:o.transform.calculateProjMatrix(Y),u_ground_shadow_factor:L};se.draw(o,v.TRIANGLES,F,H,vn.multiply,Xr.disabled,fe,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?vn.unblended:vn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const h=this.painter.transform,_=h.calculatePosMatrix(o,h.worldSize);return a.aB(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(o){const h=a.by(o);return a.aB(h,this._cascades[this.painter.currentShadowCascade].matrix,o),h}setupShadows(o,h,_){if(!this.enabled)return;const v=this.painter.transform,S=this.painter.context,T=S.gl,I=this._uniformValues,A=new Float64Array(16),L=v.calculatePosMatrix(o,v.worldSize);for(let F=0;F<this._cascades.length;F++)a.aB(A,this._cascades[F].matrix,L),I[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),S.activeTexture.set(T.TEXTURE0+oo.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!_,this.useNormalOffset){const F=a.d6(o.canonical),H=2/v.tileSize*a.al/lo.shadowMapResolution,U=H*this._cascades[0].boundingSphereRadius,Y=H*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(_==="vector-tile"?1:3)*function(se,fe,de,_e,Ee){const xe=a.aA((se-22)/-22,0,1);return .125*(1-xe)+4*xe}(v.zoom);I.u_shadow_normal_offset=[F,U*te,Y*te],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(S,I)}setupShadowsFromMatrix(o,h,_=!1){if(!this.enabled)return;const v=this.painter.context,S=v.gl,T=this._uniformValues,I=new Float64Array(16);for(let A=0;A<lo.cascadeCount;A++)a.aB(I,this._cascades[A].matrix,o),T[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),v.activeTexture.set(S.TEXTURE0+oo.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=_,_){const A=lo.normalOffset;T.u_shadow_normal_offset=[1,A,A],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(v,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,h,_,v){if(v[2]>=0)return{};const S=function(A,L,F){const H=F/(1<<A.canonical.z);return new a.d8([A.canonical.x*H+A.wrap*F,A.canonical.y*H+A.wrap*F,0],[(A.canonical.x+1)*H+A.wrap*F,(A.canonical.y+1)*H+A.wrap*F,L])}(o,h,_).getCorners(),T=h/-v[2];v[0]<0?(a.d7(S[0],S[0],[v[0]*T,0,0]),a.d7(S[3],S[3],[v[0]*T,0,0])):v[0]>0&&(a.d7(S[1],S[1],[v[0]*T,0,0]),a.d7(S[2],S[2],[v[0]*T,0,0])),v[1]<0?(a.d7(S[0],S[0],[0,v[1]*T,0]),a.d7(S[1],S[1],[0,v[1]*T,0])):v[1]>0&&(a.d7(S[2],S[2],[0,v[1]*T,0]),a.d7(S[3],S[3],[0,v[1]*T,0]));const I={};return I.vertices=S,I.planes=[bh(S[1],S[0],S[4]),bh(S[2],S[1],S[5]),bh(S[3],S[2],S[6]),bh(S[0],S[3],S[7])],I}addShadowReceiver(o,h,_){this._receivers.add(o,a.d8.fromTileIdAndHeight(o,h,_))}getMaxCascadeForTile(o){const h=this._receivers.get(o);return h&&h.lastCascade?h.lastCascade:0}}function bh(g,o,h){const _=a.av([],h,o),v=a.av([],g,o),S=a.bH([],_,v),T=a.ag(S);return T===0?[0,0,1,0]:(a.c4(S,S,1/T),[S[0],S[1],S[2],-a.bI(S,o)])}function sT(g){const o=g.properties.get("direction"),h=a.d3(o.x,o.y,o.z);h[2]=a.aA(h[2],0,75);const _=a.d5([h[0],h[1],h[2]]);return a.d4(_.x,_.y,_.z)}function Lc(g,o,h){const _=o.properties.get("color-use-theme")==="none",v=o.properties.get("color"),S=o.properties.get("intensity"),T=o.properties.get("direction"),I=[T.x,T.y,T.z],A=h.properties.get("color-use-theme")==="none",L=h.properties.get("color"),F=h.properties.get("intensity"),H=Math.max(a.bI([0,0,1],I),0),U=[0,0,0];a.c4(U,L.toPremultipliedRenderColor(A?null:g.getLut(o.scope)).toArray01Linear().slice(0,3),F);const Y=[0,0,0];return a.c4(Y,v.toPremultipliedRenderColor(_?null:g.getLut(h.scope)).toArray01Linear().slice(0,3),H*S),a.da([U[0]>0?U[0]/(U[0]+Y[0]):0,U[1]>0?U[1]/(U[1]+Y[1]):0,U[2]>0?U[2]/(U[2]+Y[2]):0])}function iT(g,o,h,_,v,S){const T=g.zoom,I=g.scale,A=g.worldSize,L=1/A,F=g.aspect,H=Math.sqrt(1+F*F)*Math.tan(.5*g.fovX),U=H*H,Y=_-h,te=_+h;let se,fe;U>Y/te?(se=_,fe=_*H):(se=.5*te*(1+U),fe=.5*Math.sqrt(Y*Y+2*(_*_+h*h)*U+te*te*U*U));const de=g.projection.pixelsPerMeter(g.center.lat,A),_e=g._camera.getCameraToWorldMercator(),Ee=[0,0,-se*L];a.af(Ee,Ee,_e);let xe=fe*L;const Re=g._edgeInsets;if(!(Re.left===0&&Re.top===0&&Re.right===0&&Re.bottom===0||Re.left===Re.right&&Re.top===Re.bottom)){const Pt=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?de:1),Kt=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,h,_);Kt[8]=2*-g.centerOffset.x/g.width,Kt[9]=2*g.centerOffset.y/g.height;const gr=new Float64Array(16);a.cO(gr,Kt,Pt);const Ut=new Float64Array(16);a.bk(Ut,gr);const Ht=a.cA.fromInvProjectionMatrix(Ut,A,T,!0);for(const yr of Ht.points){const lr=((Te=yr)[0]/=I,Te[1]/=I,Te[2]=a.ce(Te[2],g._center.lat),Te);xe=Math.max(xe,a.c5(a.d9([],Ee,lr)))}}var Te;xe*=v/(v-1);const De=Math.acos(o[2]),Pe=Math.atan2(-o[0],-o[1]),Ie=new Gy;Ie.position=Ee,Ie.setPitchBearing(De,Pe);const Oe=Ie.getWorldToCamera(A,de),et=xe*A,Ke=Math.min(g._mercatorZfromZoom(17)*A*-2,-2*et),pt=Ie.getCameraToClipOrthographic(-et,et,-et,et,Ke,(et+S*de)/o[2]),ot=new Float64Array(16);a.aB(ot,pt,Oe);const vt=a.d4(Math.floor(1e6*Ee[0])/1e6*A,Math.floor(1e6*Ee[1])/1e6*A,0),qt=.5*v,nt=[0,0,0];a.af(nt,vt,ot),a.c4(nt,nt,qt);const Ue=[Math.floor(nt[0]),Math.floor(nt[1]),Math.floor(nt[2])],wt=[0,0,0];a.av(wt,nt,Ue),a.c4(wt,wt,-1/qt);const lt=new Float64Array(16);return a.bz(lt),a.bq(lt,lt,wt),a.aB(ot,lt,ot),[ot,et]}class Hy extends a.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,h){return a.db(this.requestManager.transformRequest(h,a.R.Model).url).then(_=>{if(!_)return;const v=a.dc(_),S=new a.dd(o,h,void 0,void 0,v);return S.computeBoundsAndApplyParent(),S}).catch(_=>{if(_&&_.status===404)return null;this.fire(new a.y(new Error(`Could not load model ${o} from ${h}: ${_.message}`)))})}load(o,h,_={forceReload:!1}){this.models[h]||(this.models[h]={});const v=Object.keys(o),S=[],T=[];for(const I of v){const A=o[I];this.hasURLBeenRequested(A)&&!_.forceReload||(this.modelByURL[A]={modelId:I,scope:h},S.push(this.loadModel(I,A)),T.push(I)),this.models[h][I]||(this.models[h][I]={model:null,numReferences:1})}this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+T.length,Promise.allSettled(S).then(I=>{for(let A=0;A<I.length;A++){const{status:L}=I[A];if(L==="rejected")continue;const{value:F}=I[A];this.models[h][T[A]]||(this.models[h][T[A]]={model:null,numReferences:1}),this.models[h][T[A]].model=F}this.numModelsLoading[h]-=T.length,this.fire(new a.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new a.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,h,_={exactIdMatch:!1}){return!!(_.exactIdMatch?this.getModel(o,h):this.getModelByURL(this.modelUris[h][o]))}getModel(o,h){return this.models[h]||(this.models[h]={}),this.models[h][o]?this.models[h][o].model:void 0}getModelByURL(o){if(!o)return null;const h=this.modelByURL[o];return h?this.models[h.scope][h.modelId].model:null}hasModelBeenAdded(o,h){return this.models[h]&&this.models[h][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,h,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={});const v=this.requestManager.normalizeModelURL(h);if((this.hasModel(o,_,{exactIdMatch:!0})||this.hasModelBeenAdded(o,_))&&this.modelUris[_][o]===v)this.models[_][o].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:S,modelId:T}=this.modelByURL[v];this.models[S][T].numReferences++}else this.modelUris[_][o]=v,this.load({[o]:this.modelUris[_][o]},_)}addModelURLs(o,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const _=this.modelUris[h];for(const v in o)_[v]=this.requestManager.normalizeModelURL(o[v])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const _={};for(const v of o)this.hasModel(v,h,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[h][v].numReferences++:this.modelUris[h][v]&&!this.hasURLBeenRequested(v)?_[v]=this.modelUris[h][v]:!this.hasURLBeenRequested(v)&&a.de(v,!1)&&(this.modelUris[h][v]=this.requestManager.normalizeModelURL(v),_[v]=this.modelUris[h][v]);this.load(_,h)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,h,_=!1,v=!1){if(this.models[h]&&this.models[h][o]&&(this.models[h][o].numReferences--,this.models[h][o].numReferences===0||v)){const S=this.modelUris[h][o];_||delete this.modelUris[h][o],delete this.modelByURL[S];const T=this.models[h][o].model;if(!T)return;delete this.models[h][o],T.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const h of Object.keys(this.models[o])){const _=this.models[o][h].model;delete this.models[o][h],_&&_.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,h){this.models[h]||(this.models[h]={});for(const _ in this.models[h])this.models[h][_].model&&this.models[h][_].model.upload(o.context)}}const Gg=a.a6.colorTheme,Sh=new a.a9({data:new a.aa(Gg.data)});function kA(g){if(!g.metadata||!g.metadata.content_area)return;const o=a.o.devicePixelRatio,{left:h,top:_,width:v,height:S}=g.metadata.content_area,T=h*o,I=_*o;return[T,I,T+v*o,I+S*o]}function aT(g){if(g)return g.map(([o,h])=>[o*a.o.devicePixelRatio,h*a.o.devicePixelRatio])}class RA{constructor(o,h,_){this.id=o,this.scope=h,this.sourceCache=_,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const h=this.sourceCache.getVisibleCoordinates();if(h.length===0)return o;const _=this.sourceCache.getSource();if(!(_ instanceof Mi))return o;const v=h.map(T=>this.sourceCache.getTile(T)),S=_.getImages(v,Array.from(this.pendingRequests));for(const[T,I]of S)o.set(a.I.from({name:T,iconsetId:this.id}),I),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),o}}const Eh=(g,o)=>oe(g,o&&o.filter(h=>h.identifier!=="source.canvas")),MA=a.aH(Xn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Sw=a.aH(Xn,["setCenter","setZoom","setBearing","setPitch"]),Wy=new Set(["background","sky","slot","custom"]),Ew={version:8,layers:[],sources:{}},Tw={duration:300,delay:0};class Fc extends a.E{constructor(o,h={}){super(),this.map=o,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=Object.assign({},Tw),this._buildingIndex=new Bg(this),this.crossTileSymbolIndex=new Rl,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=h.styleChanges||new Vr,this.dispatcher=h.dispatcher?h.dispatcher:new a.D(a.dg(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Ln(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new a.dh(o._requestManager,h.localFontFamily?a.di.all:h.localIdeographFontFamily?a.di.ideographs:a.di.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new Hy(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._indoorDependentLayers=h.indoorDependentLayers?h.indoorDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",a.dj());const _=this;this._rtlTextPluginCallback=Fc.registerForPluginStateChange(v=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(S,T)=>{if(a.dk(S),T&&T.every(I=>I))for(const I in _._sourceCaches){const A=_._sourceCaches[I],L=A.getSource().type;L!=="vector"&&L!=="geojson"||A.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const S=this.getOwnSource(v.sourceId);if(S&&S.vectorLayerIds)for(const T in this._layers){const I=this._layers[T];I.source===S.id&&this._validateLayer(I)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(a.h(o))return o;const h=a.dl(o);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${a.dm(JSON.stringify(o))}`}_diffStyle(o,h,_){this.globalId=this._getGlobalId(o);const v=(S,T)=>{try{T(null,this.setState(S,_))}catch(I){T(I,!1)}};if(typeof o=="string"){const S=this.map._requestManager.normalizeStyleURL(o),T=this.map._requestManager.transformRequest(S,a.R.Style);a.m(T,(I,A)=>{I?this.fire(new a.y(I)):A&&v(A,h)})}else typeof o=="object"&&v(o,h)}loadURL(o,h={}){this.fire(new a.z("dataloading",{dataType:"style"}));const _=typeof h.validate=="boolean"?h.validate:!a.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,h.accessToken),this.resolvedImports.add(o);const v=this.importsCache.get(o);if(v)return this._load(v,_);const S=this.map._requestManager.transformRequest(o,a.R.Style);this._request=a.m(S,(T,I)=>{if(this._request=null,T)this.fire(new a.y(T));else if(I)return this.importsCache.set(o,I),this._load(I,_)})}loadJSON(o,h={}){this.fire(new a.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=a.o.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new a.z("dataloading",{dataType:"style"})),this._load(Ew,!1)}_loadImports(o,h,_){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const S of o){const T=this._createFragmentStyle(S),I=new Promise(F=>{T.once("style.import.load",F),T.once("error",F)}).then(()=>this.mergeAll());if(v.push(I),this.resolvedImports.has(S.url)){T.loadEmpty();continue}const A=S.data||this.importsCache.get(S.url);A?(T.loadJSON(A,{validate:h}),this._isInternalStyle(A)&&(T.globalId=null)):S.url?T.loadURL(S.url,{validate:h}):T.loadEmpty();const L={style:T,id:S.id,config:S.config};if(_){const F=this.fragments.findIndex(({id:H})=>H===_);this.fragments=this.fragments.slice(0,F).concat(L).concat(this.fragments.slice(F))}else this.fragments.push(L)}return Promise.allSettled(v)}getImportGlobalIds(o=this,h=new Set){for(const _ of o.fragments)_.style.globalId&&h.add(_.style.globalId),this.getImportGlobalIds(_.style,h);return[...h.values()]}_createFragmentStyle(o){const h=this.scope?a.B(o.id,this.scope):o.id;let _;const v=this._initialConfig&&this._initialConfig[h];(o.config||v)&&(_=Object.assign({},o.config,v));const S=new Fc(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return S.setEventedParent(this.map,{style:S}),S}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,h){if(this._isInternalStyle(o)){const S=Object.assign({},Ew,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(S,h)}if(this.updateConfig(this._config,o.schema),h&&Eh(this,Fa(o)))return;this._loaded=!0,this.stylesheet=a.dn(o);const _=()=>{for(const A in o.sources)this.addSource(A,o.sources[A],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const A in o.iconsets)this.addIconset(A,o.iconsets[A]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const S=mu(this.stylesheet.layers);if(this._order=S.map(A=>A.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new ze(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ze(this.stylesheet.light)),this._layers={};for(const A of S){const L=a.dt(A,this.scope,this._styleColorTheme.lut,this.options);L.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(L.fqid),this._hasAppearances=this._hasAppearances||L.getAppearances().length!==0,L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const F=this.getOwnLayerSourceCache(L),H=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&L.canCastShadows()&&H&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.z("data",{dataType:"style"}));const I=this.isRootStyle();o.imports?this._loadImports(o.imports,h).then(()=>{this._reloadImports(),this.fire(new a.z(I?"style.load":"style.import.load"))}).catch(A=>{this.fire(new a.y(new Error("Failed to load imports",A))),this.fire(new a.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const S=this._evaluateColorThemeData(v);this._loadColorTheme(S).then(()=>{_()}).catch(T=>{a.w(`Couldn't load color theme from the stylesheet: ${T}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let o,h,_,v,S,T,I,A,L,F;const H={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(U=>{if(U.stylesheet){if(U.light!=null&&(o=U.light),U.stylesheet.lights)for(const Y of U.stylesheet.lights)Y.type==="ambient"&&U.ambientLight!=null&&(h=U.ambientLight),Y.type==="directional"&&U.directionalLight!=null&&(_=U.directionalLight);v=this._prioritizeTerrain(v,U.terrain,U.stylesheet.terrain),U.stylesheet.fog&&U.fog!=null&&(S=U.fog),U.stylesheet.snow&&U.snow!=null&&(T=U.snow),U.stylesheet.rain&&U.rain!=null&&(I=U.rain),U.stylesheet.camera!=null&&(F=U.stylesheet.camera),U.stylesheet.projection!=null&&(A=U.stylesheet.projection),U.stylesheet.transition!=null&&(L=U.stylesheet.transition),H[U.scope]=U._styleColorTheme}}),this.light=o,this.ambientLight=h,this.directionalLight=_,this.fog=S,this.snow=T,this.rain=I,this._styleColorThemeForScope=H,v===null?delete this.terrain:this.terrain=v,this.camera=F||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=Object.assign({},Tw,L),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){const h=_=>{for(const v of _.fragments)h(v.style);o(_)};h(this)}_prioritizeTerrain(o,h,_){const v=o&&o.drapeRenderMode===0;return _===null?h&&h.drapeRenderMode===0?h:v?o:null:h!=null&&(!o||v||h&&h.drapeRenderMode===1)?h:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{o=this._prioritizeTerrain(o,h.terrain,h.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(o=h.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},h={},_={};this.forEachFragmentStyle(v=>{for(const S in v._sourceCaches){const T=a.B(S,v.scope);o[T]=v._sourceCaches[S]}for(const S in v._otherSourceCaches){const T=a.B(S,v.scope);h[T]=v._otherSourceCaches[S]}for(const S in v._symbolSourceCaches){const T=a.B(S,v.scope);_[T]=v._symbolSourceCaches[S]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=_}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(const h of Object.values(o.stylesheet.indoor)){const _=h,v=a.B(_.sourceId,o.scope);this._mergedIndoor[v]=new Set(_.sourceLayers||[])}})}mergeLayers(){const o={},h=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const I of T._order){const A=T._layers[I];if(A.type==="slot"){const L=a.dp(I);if(o[L])continue;o[L]=[]}A.slot&&o[A.slot]?o[A.slot].push(A):h.push(A)}}),this._mergedOrder=[];let v=-1;const S=(T=[])=>{for(const I of T)if(I.type==="slot"){const A=a.dp(I.id);o[A]&&S(o[A]),this._mergedSlots.push(A)}else{const A=a.B(I.id,I.scope);this._mergedOrder.push(A),_[A]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,v=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(S(h),this._has3DLayers){const T={};for(let I=0;I<this._mergedOrder.length;++I){const A=this._mergedOrder[I];T[A]=I===v?1:I<v?_[A].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,A)=>T[I]-T[A])}this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(h,_,v,S){const T=Object.assign({},_);for(const A of Object.keys(Gg))T[A]===void 0&&(T[A]=Gg[A].default);const I=new a.a8(Sh,h,new Map(v));return I.setTransitionOrValue(T,v),I.untransitioned().possiblyEvaluate(new a.ac(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,v)=>{const S="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let T=o;T.startsWith(S)||(T=S+T);const I=a.I.from("mapbox-reserved-lut"),A=new Image;A.src=T,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void _();this._styleColorTheme.lutLoading=!1;const{width:L,height:F,data:H}=a.o.getImageData(A);if(F>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==F*F)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new a.q({width:L,height:F},H),pixelRatio:1,sdf:!1,usvg:!1,version:0});const U=this.imageManager.getImage(I,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:o},_()):v(new Error("Missing LUT image."))}})}getLut(o){const h=this._styleColorThemeForScope[o];return h?h.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(h,_,v){let S,T,I;const A=a.o.devicePixelRatio>1?"@2x":"";let L=a.m(_.transformRequest(_.normalizeSpriteURL(h,A,".json"),a.R.SpriteJSON),(U,Y)=>{L=null,I||(I=U,S=Y,H())}),F=a.n(_.transformRequest(_.normalizeSpriteURL(h,A,".png"),a.R.SpriteImage),(U,Y)=>{F=null,I||(I=U,T=Y,H())});function H(){if(I)v(I);else if(S&&T){const U=a.o.getImageData(T),Y={};for(const te in S){const{width:se,height:fe,x:de,y:_e,sdf:Ee,pixelRatio:xe,stretchX:Re,stretchY:Te,content:De}=S[te],Pe=new a.q({width:se,height:fe});a.q.copy(U,Pe,{x:de,y:_e},{x:0,y:0},{width:se,height:fe},null),Y[te]={data:Pe,pixelRatio:xe!==void 0?xe:1,sdf:Ee!==void 0&&Ee,stretchX:Re,stretchY:Te,content:De,usvg:!1,version:0}}v(null,Y)}}return{cancel(){L&&(L.cancel(),L=null),F&&(F.cancel(),F=null)}}}(o,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new a.y(h));else if(_){const v=new Map;for(const S in _)v.set(a.I.from(S),_[S]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))})}addIconset(o,h){if(h.type==="sprite")return void this._loadSprite(h.url);const _=this.getOwnSourceCache(h.source);if(!_)return void this.fire(new a.y(new Error(`Source "${h.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const v=_.getSource();if(v.type!=="raster-array")return void this.fire(new a.y(new Error(`Source "${h.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const S=new RA(o,this.scope,_);this.imageManager.addImageProvider(S,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!a.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const h=this.map._spriteFormat==="auto";var _,v;this._spriteRequest=(v=(S,T)=>{if(this._spriteRequest=null,S)h?this._loadSprite(o):this.fire(new a.y(S));else if(T){const I=new Map;for(const A in T)I.set(a.I.from(A),T[A]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))},a.bt((_=this.map._requestManager).transformRequest(_.normalizeIconsetURL(o),a.R.Iconset),(S,T)=>{if(S)return void v(S);const I={},A=a.df(new a.bs(T));for(const L of A.icons){const F={version:1,pixelRatio:a.o.devicePixelRatio,content:kA(L),stretchX:L.metadata?aT(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?aT(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};I[L.name]=F}v(null,I)}))}_validateLayer(o){const h=this.getOwnSource(o.source);if(!h)return;const _=o.sourceLayer;_&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(_)===-1)&&this.fire(new a.y(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,h)=>{const _=this.fragments[h];return _&&_.style&&(o.data=_.style.serialize()),o})}_serializeSources(){const o={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();o[_.id]||(o[_.id]=_.serialize())}return o}_serializeLayers(o){const h=[];for(const _ of o){const v=this._layers[_];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const h=this.getOwnLayer(o);if(h)return h;this.fire(new a.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const h=this.getOwnSource(o);if(h)return h;this.fire(new a.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,h){const _=this.map.painter;if(_)for(let v=o.minzoom||0;v<(o.maxzoom||25.5);v++){const S=o.getProgramIds();if(S)for(const T of S){const I=o.getDefaultProgramParams(T,h.zoom,this._styleColorTheme.lut);I&&(_.style=this,this.fog&&(_._fogVisible=!0,I.overrideFog=!0,_.getOrCreateProgram(T,I)),_._fogVisible=!1,I.overrideFog=!1,_.getOrCreateProgram(T,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,_.getOrCreateProgram(T,I)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const h=this.calculateLightsBrightness();o.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const _=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const A in I){const{updatedIds:L,removedIds:F}=I[A];(L||F)&&(this._updateWorkerLayers(A,L,F),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const S={};for(const I in this._mergedSourceCaches){const A=this._mergedSourceCaches[I];S[I]=A.used,A.used=!1,A.tileCoverLift=0}for(const I of this._mergedOrder){const A=this._mergedLayers[I];if(A.recalculate(o,this._availableImages),!A.isHidden(o.zoom)){const L=this.getLayerSourceCache(A);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,o)}):this.precompilePrograms(A,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const I of T)I.sourceCache.used=!0;for(const I in S){const A=this._mergedSourceCaches[I];S[I]!==A.used&&A.getSource().fire(new a.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_&&this.fire(new a.z("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const h of o){const _=h.resolvePendingRequests(),v=this.getFragmentStyle(h.scope);v&&v.addImages(_)}}_updateTilesForChangedImages(){const o={};for(const h in this._mergedSourceCaches){const _=this._mergedSourceCaches[h].getSource().scope;o[_]=o[_]||this._changes.getUpdatedImages(_),o[_].length!==0&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o[_])}for(const h in o)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(o,h,_){const v=this.getFragmentStyle(o);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:o,removedIds:_||[],options:v.options})}setState(o,h){if(this._checkLoaded(),Eh(this,Fa(o)))return!1;(o=a.dn(o)).layers=mu(o.layers);const _=function(T,I){if(!T)return[{command:Xn.setStyle,args:[I]}];let A=[];try{if(!a.bx(T.version,I.version))return[{command:Xn.setStyle,args:[I]}];if(a.bx(T.center,I.center)||A.push({command:Xn.setCenter,args:[I.center]}),a.bx(T.zoom,I.zoom)||A.push({command:Xn.setZoom,args:[I.zoom]}),a.bx(T.bearing,I.bearing)||A.push({command:Xn.setBearing,args:[I.bearing]}),a.bx(T.pitch,I.pitch)||A.push({command:Xn.setPitch,args:[I.pitch]}),a.bx(T.sprite,I.sprite)||A.push({command:Xn.setSprite,args:[I.sprite]}),a.bx(T.glyphs,I.glyphs)||A.push({command:Xn.setGlyphs,args:[I.glyphs]}),a.bx(T.imports,I.imports)||function(Y=[],te=[],se){te=te||[];const fe=(Y=Y||[]).map(wf),de=te.map(wf),_e=Y.reduce(bf,{}),Ee=te.reduce(bf,{}),xe=fe.slice();let Re,Te,De,Pe;for(Re=0,Te=0;Re<fe.length;Re++)De=fe[Re],Ee.hasOwnProperty(De)?Te++:(se.push({command:Xn.removeImport,args:[De]}),xe.splice(xe.indexOf(De,Te),1));for(Re=0,Te=0;Re<de.length;Re++)De=de[de.length-1-Re],xe[xe.length-1-Re]!==De&&(_e.hasOwnProperty(De)?(se.push({command:Xn.removeImport,args:[De]}),xe.splice(xe.lastIndexOf(De,xe.length-Te),1)):Te++,Pe=xe[xe.length-Re],se.push({command:Xn.addImport,args:[Ee[De],Pe]}),xe.splice(xe.length-Re,0,De));for(const Ie of te){const Oe=_e[Ie.id];Oe&&(delete Oe.data,a.bx(Oe,Ie)||se.push({command:Xn.updateImport,args:[Ie.id,Ie]}))}}(T.imports,I.imports,A),a.bx(T.transition,I.transition)||A.push({command:Xn.setTransition,args:[I.transition]}),a.bx(T.light,I.light)||A.push({command:Xn.setLight,args:[I.light]}),a.bx(T.fog,I.fog)||A.push({command:Xn.setFog,args:[I.fog]}),a.bx(T.snow,I.snow)||A.push({command:Xn.setSnow,args:[I.snow]}),a.bx(T.rain,I.rain)||A.push({command:Xn.setRain,args:[I.rain]}),a.bx(T.projection,I.projection)||A.push({command:Xn.setProjection,args:[I.projection]}),a.bx(T.lights,I.lights)||A.push({command:Xn.setLights,args:[I.lights]}),a.bx(T.camera,I.camera)||A.push({command:Xn.setCamera,args:[I.camera]}),a.bx(T.iconsets,I.iconsets)||function(Y,te,se){let fe;for(fe in te=te||{},Y=Y||{})Y.hasOwnProperty(fe)&&(te.hasOwnProperty(fe)||se.push({command:Xn.removeIconset,args:[fe]}));for(fe in te){if(!te.hasOwnProperty(fe))continue;const de=te[fe];Y.hasOwnProperty(fe)?a.bx(Y[fe],de)||(se.push({command:Xn.removeIconset,args:[fe]}),se.push({command:Xn.addIconset,args:[fe,de]})):se.push({command:Xn.addIconset,args:[fe,de]})}}(T.iconsets,I.iconsets,A),!a.bx(T["color-theme"],I["color-theme"]))return[{command:Xn.setStyle,args:[I]}];const L={},F=[];(function(Y,te,se,fe){let de;for(de in te=te||{},Y=Y||{})Y.hasOwnProperty(de)&&(te.hasOwnProperty(de)||gu(de,se,fe));for(de in te){if(!te.hasOwnProperty(de))continue;const _e=te[de];Y.hasOwnProperty(de)?a.bx(Y[de],_e)||(Y[de].type==="geojson"&&_e.type==="geojson"&&vf(Y,te,de)?se.push({command:Xn.setGeoJSONSourceData,args:[de,_e.data]}):ph(de,te,se,fe)):_d(de,te,se)}})(T.sources,I.sources,F,L);const H=[];T.layers&&T.layers.forEach(Y=>{Y.source&&L[Y.source]?A.push({command:Xn.removeLayer,args:[Y.id]}):H.push(Y)});let U=T.terrain;U&&L[U.source]&&(A.push({command:Xn.setTerrain,args:[void 0]}),U=void 0),A=A.concat(F),a.bx(U,I.terrain)||A.push({command:Xn.setTerrain,args:[I.terrain]}),function(Y,te,se){te=te||[];const fe=(Y=Y||[]).map(wf),de=te.map(wf),_e=Y.reduce(bf,{}),Ee=te.reduce(bf,{}),xe=fe.slice(),Re=Object.create(null);let Te,De,Pe,Ie,Oe,et,Ke;for(Te=0,De=0;Te<fe.length;Te++)Pe=fe[Te],Ee.hasOwnProperty(Pe)?De++:(se.push({command:Xn.removeLayer,args:[Pe]}),xe.splice(xe.indexOf(Pe,De),1));for(Te=0,De=0;Te<de.length;Te++)Pe=de[de.length-1-Te],xe[xe.length-1-Te]!==Pe&&(_e.hasOwnProperty(Pe)?(se.push({command:Xn.removeLayer,args:[Pe]}),xe.splice(xe.lastIndexOf(Pe,xe.length-De),1)):De++,et=xe[xe.length-Te],se.push({command:Xn.addLayer,args:[Ee[Pe],et]}),xe.splice(xe.length-Te,0,Pe),Re[Pe]=!0);for(Te=0;Te<de.length;Te++)if(Pe=de[Te],Ie=_e[Pe],Oe=Ee[Pe],!Re[Pe]&&!a.bx(Ie,Oe))if(a.bx(Ie.source,Oe.source)&&a.bx(Ie["source-layer"],Oe["source-layer"])&&a.bx(Ie.type,Oe.type)){for(Ke in qi(Ie.layout,Oe.layout,se,Pe,null,Xn.setLayoutProperty),qi(Ie.paint,Oe.paint,se,Pe,null,Xn.setPaintProperty),a.bx(Ie.slot,Oe.slot)||se.push({command:Xn.setSlot,args:[Pe,Oe.slot]}),a.bx(Ie.filter,Oe.filter)||se.push({command:Xn.setFilter,args:[Pe,Oe.filter]}),a.bx(Ie.minzoom,Oe.minzoom)&&a.bx(Ie.maxzoom,Oe.maxzoom)||se.push({command:Xn.setLayerZoomRange,args:[Pe,Oe.minzoom,Oe.maxzoom]}),Ie)Ie.hasOwnProperty(Ke)&&Ke!=="layout"&&Ke!=="paint"&&Ke!=="filter"&&Ke!=="metadata"&&Ke!=="minzoom"&&Ke!=="maxzoom"&&Ke!=="slot"&&(Ke.indexOf("paint.")===0?qi(Ie[Ke],Oe[Ke],se,Pe,Ke.slice(6),Xn.setPaintProperty):a.bx(Ie[Ke],Oe[Ke])||se.push({command:Xn.setLayerProperty,args:[Pe,Ke,Oe[Ke]]}));for(Ke in Oe)Oe.hasOwnProperty(Ke)&&!Ie.hasOwnProperty(Ke)&&Ke!=="layout"&&Ke!=="paint"&&Ke!=="filter"&&Ke!=="metadata"&&Ke!=="minzoom"&&Ke!=="maxzoom"&&Ke!=="slot"&&(Ke.indexOf("paint.")===0?qi(Ie[Ke],Oe[Ke],se,Pe,Ke.slice(6),Xn.setPaintProperty):a.bx(Ie[Ke],Oe[Ke])||se.push({command:Xn.setLayerProperty,args:[Pe,Ke,Oe[Ke]]}))}else se.push({command:Xn.removeLayer,args:[Pe]}),et=xe[xe.lastIndexOf(Pe)+1],se.push({command:Xn.addLayer,args:[Oe,et]})}(H,I.layers,A)}catch(L){console.warn("Unable to compute style diff:",L),A=[{command:Xn.setStyle,args:[I]}]}return A}(this.serialize(),o).filter(T=>!(T.command in Sw));if(_.length===0)return!1;const v=_.filter(T=>!(T.command in MA));if(v.length>0)throw new Error(`Unimplemented: ${v.map(T=>T.command).join(", ")}.`);const S=[];return _.forEach(T=>{S.push(this[T.command](...T.args))}),h&&Promise.all(S).then(h).catch(h),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[h,_]of o.entries()){if(this.getImage(h))return this.fire(new a.y(new Error(`An image with the name "${h.name}" already exists.`)));this.imageManager.addImage(h,this.scope,_),this._changes.updateImage(h,this.scope)}return this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this}addImage(o,h){return this.getImage(o)?this.fire(new a.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,h),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this)}updateImage(o,h,_=!1){this.imageManager.updateImage(o,this.scope,h),_&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(o){return this.modelManager.addModelURLs(o,this.scope),this._updateWorkerModels(),this.fire(new a.z("data",{dataType:"style"})),this}addModel(o,h,_={}){return this._checkLoaded(),this._validate(Dc,`models.${o}`,h,null,_)||(this.modelManager.addModel(o,h,this.scope),this.fire(new a.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope,!1,!0),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,h,_={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(_f,`sources.${o}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=za(o,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const S=T=>{const I=(T?"symbol:":"other:")+v.id,A=a.B(I,this.scope),L=this._sourceCaches[I]=new kl(A,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=L,L.onAdd(this.map)};S(!1),h.type!=="vector"&&h.type!=="geojson"||S(!0),v.onAdd&&v.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const h=this.getOwnSource(o);if(!h)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===o)return this.fire(new a.y(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new a.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find(([S,T])=>T.type==="source"&&T.source===o);if(v)return this.fire(new a.y(new Error(`Source "${o}" cannot be removed while iconset "${v[0]}" is using it.`)))}const _=this.getOwnSourceCaches(o);for(const v of _){const S=a.dp(v.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(v.id),v.fire(new a.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getOwnSource(o).setData(h),this._changes.setDirty()}getOwnSource(o){const h=this.getOwnSourceCache(o);return h&&h.getSource()}getOwnSources(){const o=[];for(const h in this._otherSourceCaches){const _=this.getOwnSourceCache(h);_&&o.push(_.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const h in o){const _=o[h]._tiles;for(const v in _){const S=_[v];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const S of o){if(this._validate(Rp,"lights",S))return;switch(S.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(S),T.updateTransitions(h)}else this.ambientLight=new bi(S,Kn||(Kn=new a.a9({color:new a.aa(a.a6.properties_light_ambient.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(S),T.updateTransitions(h)}else this.directionalLight=new bi(S,li||(li=new a.a9({direction:new a.ap(a.a6.properties_light_directional.direction),color:new a.aa(a.a6.properties_light_directional.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_directional.intensity),"cast-shadows":new a.aa(a.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new a.aa(a.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new a.aa(a.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=Object.assign(h,{worldview:this.map.getWorldview()}),v=new a.ac(this.z||0,_);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,h=this.ambientLight;if(!o||!h)return;const _=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),v=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),S=o.properties.get("intensity"),T=o.properties.get("direction"),I=1-a.d3(T.x,T.y,T.z)[2]/90,A=_(v)*S*I,L=h.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=h.properties.get("intensity"),H=_(L)*F;return Number(((A+H)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(a.dq(o)){const h=a.dr(o),_=this.fragments.find(({id:S})=>S===h);if(!_)return;const v=a.dp(o);return _.style.getFragmentStyle(v)}{const h=this.fragments.find(({id:_})=>_===o);return h?h.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const h={},_=(v,S="")=>`${v}::${S}`;this._featuresetSelectors={};for(const v in o){const S=this._featuresetSelectors[v]=[];for(const T of o[v].selectors){if(T.featureNamespace){const A=this.getOwnLayer(T.layer);if(!A){a.w(`Layer is undefined for selector: ${T.layer}`);continue}const L=_(A.source,A.sourceLayer);if(L in h&&h[L]!==T.featureNamespace){a.w(`"featureNamespace ${T.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}h[L]=T.featureNamespace}let I;if(T.properties)for(const A in T.properties){const L=a.U(T.properties[A]);L.result==="success"&&(I=I||{},I[A]=L.value)}S.push({layerId:T.layer,namespace:T.featureNamespace,properties:I,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const h=this.getFragmentStyle(o);if(!h||!h.stylesheet.featuresets)return[];const _=[];for(const v in h.stylesheet.featuresets)_.push({featuresetId:v,importId:h.scope?h.scope:void 0});return _}getFeaturesetLayers(o,h){const _=this.getFragmentStyle(h),v=_.stylesheet.featuresets;if(!v||!v[o])return this.fire(new a.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const S=[];for(const T of v[o].selectors){const I=_.getOwnLayer(T.layer);I&&S.push(I)}return S}getConfigProperty(o,h){const _=this.getFragmentStyle(o);if(!_)return null;const v=a.B(h,_.scope),S=_.options.get(v),T=S?S.value||S.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,h){const _=a.B(o,h);return this._mergedIndoor[_]}setIndoorData(o,h){this.map.indoor.setIndoorData(h)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,h,_){const v=this.getFragmentStyle(o);if(!v)return;const S=v.stylesheet.schema;if(!S||!S[h])return;const T=a.U(_);if(T.result!=="success")return void Eh(this,T.value);const I=T.value.expression,A=a.B(h,v.scope),L=v.options.get(A);if(!L)return;let F;const{minValue:H,maxValue:U,stepValue:Y,type:te,values:se}=S[h],fe=a.U(S[h].default);fe.result==="success"&&(F=fe.value.expression),F?(this.options.set(A,Object.assign({},L,{value:I,default:F,minValue:H,maxValue:U,stepValue:Y,type:te,values:se})),this.updateConfigDependencies(h)):this.fire(new a.y(new Error(`No schema defined for the config option "${h}" in the "${o}" fragment.`)))}getConfig(o){const h=this.getFragmentStyle(o);if(!h)return null;const _=h.stylesheet.schema;if(!_)return null;const v={};for(const S in _){const T=a.B(S,h.scope),I=h.options.get(T),A=I?I.value||I.default:null;v[S]=A?A.serialize():null}return v}setConfig(o,h){const _=this.getFragmentStyle(o);_&&(_.updateConfig(h,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const h=this.getFragmentStyle(o);return h?h.stylesheet.schema:null}setSchema(o,h){const _=this.getFragmentStyle(o);_&&(_.stylesheet.schema=h,_.updateConfig(_._config,h),this.updateConfigDependencies())}updateConfig(o,h){if(this._config=o,o||h)if(h)for(const _ in h){let v,S;const T=a.U(h[_].default);if(T.result==="success"&&(v=T.value.expression),o&&o[_]!==void 0){const U=a.U(o[_]);U.result==="success"&&(S=U.value.expression)}const{minValue:I,maxValue:A,stepValue:L,type:F,values:H}=h[_];if(v){const U=a.B(_,this.scope);this.options.set(U,{default:v,value:S,minValue:I,maxValue:A,stepValue:L,type:F,values:H})}else this.fire(new a.y(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new a.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,h=()=>!0){for(const _ of o){const v=this.getLayer(_);v&&h(v)&&(v.possiblyEvaluateVisibility(),this._updateLayer(v),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,h=>!o||h.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(h=>{const _=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(_){const v=h._evaluateColorThemeData(_);(!h._styleColorTheme.lut&&v!==""||h._styleColorTheme.lut&&v!==h._styleColorTheme.lut.data)&&h.setColorTheme(_)}}),this._changes.setDirty()}addLayer(o,h,_={}){this._checkLoaded();const v=o.id;if(this._layers[v])return void this.fire(new a.y(new Error(`Layer with id "${v}" already exists on this map`)));let S;if(o.type==="custom"){if(Eh(this,a.ds(o)))return;S=a.dt(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(v,o.source),o=a.dn(o),o=Object.assign(o,{source:v})),this._validate(uu,`layers.${v}`,o,{arrayIndex:-1},_))return;S=a.dt(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:v}})}const T=a.B(S.source,S.scope);S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let I=this._order.length;if(h){const H=this._order.indexOf(h);if(H===-1)return void this.fire(new a.y(new Error(`Layer with id "${h}" does not exist on this map.`)));S.slot===this._layers[h].slot?I=H:a.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,v),this._layerOrderChanged=!0,this._layers[v]=S;const A=this.getOwnLayerSourceCache(S),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&S.canCastShadows()&&L&&(A.castsShadows=!0);const F=this._changes.getRemovedLayer(S);if(F&&S.source&&A&&S.type!=="custom"){this._changes.discardLayerRemoval(S);const H=a.B(S.source,S.scope);F.type!==S.type?this._changes.updateSourceCache(H,"clear"):(this._changes.updateSourceCache(H,"reload"),A.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(o,h){this._checkLoaded();const _=this._checkLayer(o);if(!_||o===h)return;const v=this._order.indexOf(o);this._order.splice(v,1);let S=this._order.length;if(h){const T=this._order.indexOf(h);if(T===-1)return void this.fire(new a.y(new Error(`Layer with id "${h}" does not exist on this map.`)));_.slot===this._layers[h].slot?S=T:a.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const h=this._checkLayer(o);if(!h)return;h.setEventedParent(null);const _=this._order.indexOf(o);this._order.splice(_,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._indoorDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let S=!1;for(const T in this._layers)if(this._layers[T].source===h.source&&this._layers[T].canCastShadows()){S=!0;break}v.castsShadows=S}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,_){this._checkLoaded();const v=this._checkLayer(o);v&&(v.minzoom===h&&v.maxzoom===_||(h!=null&&(v.minzoom=h),_!=null&&(v.maxzoom=_),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,h){this._checkLoaded();const _=this._checkLayer(o);_&&_.slot!==h&&(_.slot=h,this._updateLayer(_))}setFilter(o,h,_={}){this._checkLoaded();const v=this._checkLayer(o);if(v&&!a.bx(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Nn,`layers.${v.id}.filter`,h,{layerType:v.type},_)||(v.filter=a.dn(h),this._updateLayer(v)))}getFilter(o){const h=this._checkLayer(o);if(h)return a.dn(h.filter)}setLayoutProperty(o,h,_,v={}){this._checkLoaded();const S=this._checkLayer(o);if(S&&!a.bx(S.getLayoutProperty(h),_)){if(_!=null&&(!v||v.validate!==!1)&&Eh(S,Fg.call(Fa,{key:`layers.${o}.layout.${h}`,layerType:S.type,objectKey:h,value:_,styleSpec:a.a6,style:{glyphs:!0,sprite:!0}})))return;S.setLayoutProperty(h,_),S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S.fqid),this._updateLayer(S)}}setLayerProperty(o,h,_,v={}){this._checkLoaded();const S=this._checkLayer(o);S&&(h==="appearances"?(S.setAppearances(_),this._changes.setDirty()):S.isPaintProperty(h)?this.setPaintProperty(o,h,_,v):this.setLayoutProperty(o,h,_,v))}getLayoutProperty(o,h){const _=this._checkLayer(o);if(_)return _.getLayoutProperty(h)}setPaintProperty(o,h,_,v={}){this._checkLoaded();const S=this._checkLayer(o);if(!S||a.bx(S.getPaintProperty(h),_)||_!=null&&(!v||v.validate!==!1)&&Eh(S,_o.call(Fa,{key:`layers.${o}.paint.${h}`,layerType:S.type,objectKey:h,value:_,styleSpec:a.a6})))return;const T=S.setPaintProperty(h,_);S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S.fqid),T&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(o,h){const _=this._checkLayer(o);if(_)return _.getPaintProperty(h)}setFeatureState(o,h){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:A,importId:L}=o.target,F=this.getFragmentStyle(L),H=F.getFeaturesetLayers(A);for(const{source:U,sourceLayer:Y}of H)F.setFeatureState({id:o.id,source:U,sourceLayer:Y},h)}else if("layerId"in o.target){const{layerId:A}=o.target,L=this.getLayer(A);this.setFeatureState({id:o.id,source:L.source,sourceLayer:L.sourceLayer},h)}return}const _=o.source,v=o.sourceLayer,S=this._checkSource(_);if(!S)return;const T=S.type;if(T==="geojson"&&v)return void this.fire(new a.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(_);for(const A of I)A.setFeatureState(v,o.id,h)}removeFeatureState(o,h){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:A,importId:L}=o.target,F=this.getFragmentStyle(L),H=F.getFeaturesetLayers(A);for(const{source:U,sourceLayer:Y}of H)F.removeFeatureState({id:o.id,source:U,sourceLayer:Y},h)}else if("layerId"in o.target){const{layerId:A}=o.target,L=this.getLayer(A);this.removeFeatureState({id:o.id,source:L.source,sourceLayer:L.sourceLayer},h)}return}const _=o.source,v=this._checkSource(_);if(!v)return;const S=v.type,T=S==="vector"?o.sourceLayer:void 0;if(S==="vector"&&!T)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new a.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(_);for(const A of I)A.removeFeatureState(T,o.id,h)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let S;if("featuresetId"in o.target){const{featuresetId:T,importId:I}=o.target,A=this.getFragmentStyle(I),L=A.getFeaturesetLayers(T);for(const{source:F,sourceLayer:H}of L){const U=A.getFeatureState({id:o.id,source:F,sourceLayer:H});if(U&&!S)S=U;else if(!a.bx(S,U))return void this.fire(new a.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:T}=o.target,I=this.getLayer(T);S=this.getFeatureState({id:o.id,source:I.source,sourceLayer:I.sourceLayer})}return S}const h=o.source,_=o.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||_)return o.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(_,o.id);this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),h=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return a.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateFilteredLayers(o){for(const h of Object.values(this._mergedLayers))o(h)&&this._updateLayer(h)}_updateLayer(o){this._changes.updateLayer(o);const h=this.getLayerSourceCache(o),_=a.B(o.source,o.scope),v=this._changes.getUpdatedSourceCaches();o.source&&!v[_]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),h.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const h=I=>this._mergedLayers[I].is3D(!!this.terrain),_=this.order,v={},S=[];for(let I=_.length-1;I>=0;I--){const A=_[I];if(h(A)){v[A]=I;for(const L of o){const F=L[A];if(F)for(const H of F)S.push(H)}}}S.sort((I,A)=>A.intersectionZ-I.intersectionZ);const T=[];for(let I=_.length-1;I>=0;I--){const A=_[I];if(h(A))for(let L=S.length-1;L>=0;L--){const F=S[L].feature;if(F.layer&&v[F.layer.id]<I)break;T.push(F),S.pop()}else for(const L of o){const F=L[A];if(F)for(const H of F)T.push(H.feature)}}return T}queryRasterValue(o,h,_){const v=this.getOwnSource(o);return v?v.type!=="raster-array"?(this.fire(new a.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):v.queryRasterArrayValue(h,_):(this.fire(new a.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,h,_){let v;h&&!Array.isArray(h)&&h.filter&&(this._validate(Nn,"queryRenderedFeatures.filter",h.filter,null,h),v=a.b5(h.filter));const S={},T=F=>{if(Wy.has(F.type))return;const H=this.getOwnLayerSourceCache(F),U=S[H.id]=S[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(U.has3DLayers=!0),U.layers[F.fqid]=U.layers[F.fqid]||{styleLayer:F,targets:[]},U.layers[F.fqid].targets.push({filter:v})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.y(new Error("parameters.layers must be an Array."))),[];for(const F of h.layers){const H=this._layers[F];if(!H)return this.fire(new a.y(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];T(H)}}else for(const F in this._layers)T(this._layers[F]);const I=this._queryRenderedFeatures(o,S,_),A=this._flattenAndSortRenderedFeatures(I),L=[];for(const F of A)a.dv(F.layer.id)===this.scope&&L.push(F);return L}queryRenderedFeatureset(o,h,_){let v;h&&!Array.isArray(h)&&h.filter&&(this._validate(Nn,"queryRenderedFeatures.filter",h.filter,null,h),v=a.b5(h.filter));const S="mock",T=[];if(h&&h.target)T.push(Object.assign({},h,{targetId:S,filter:v}));else{const F=this.getFeaturesetDescriptors();for(const H of F)T.push({targetId:S,filter:v,target:H});for(const{style:H}of this.fragments){const U=H.getFeaturesetDescriptors();for(const Y of U)T.push({targetId:S,filter:v,target:Y})}}const I=this.queryRenderedTargets(o,T,_),A=[],L=new Set;for(const F of I)for(const H of F.variants[S])Uo(H,F,L)||A.push(new a.dw(F,H));return A}queryRenderedTargets(o,h,_){const v={},S=(I,A,L,F)=>{const H=v[A.id]=v[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(H.layers[I.fqid]=H.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(H.has3DLayers=!0),!F)return L.uniqueFeatureID=!1,void H.layers[I.fqid].targets.push(L);H.layers[I.fqid].targets.push(Object.assign({},L,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const I of h)if("featuresetId"in I.target){const{featuresetId:A,importId:L}=I.target,F=this.getFragmentStyle(L);if(!F||!F._featuresetSelectors)continue;const H=F._featuresetSelectors[A];if(!H){this.fire(new a.y(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const U of H){const Y=F.getOwnLayer(U.layerId);Y&&!Wy.has(Y.type)&&S(Y,F.getOwnLayerSourceCache(Y),I,U)}}else if("layerId"in I.target){const{layerId:A}=I.target,L=this.getLayer(A);if(!L||Wy.has(L.type))continue;S(L,this.getLayerSourceCache(L),I)}const T=this._queryRenderedFeatures(o,v,_);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(o,h,_){const v=[],S=!!this.map._showQueryGeometry,T=fs.createFromScreenPoints(o,_);for(const I in h){const A=Bs(T,h[I],this._availableImages,_,S);Object.keys(A).length&&v.push(A)}if(this.placement)for(const I in h){if(!h[I].sourceCache._onlySymbols)continue;const A=md(T.screenGeometry,h[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&v.push(A)}return v}querySourceFeatures(o,h){const _=h&&h.filter;_&&this._validate(Nn,"querySourceFeatures.filter",_,null,h);let v=[];const S=this.getOwnSourceCaches(o);for(const T of S)v=v.concat(du(T,h));return v}addSourceType(o,h,_){return Fc.getSourceType(o)?_(new Error(`A source type called "${o}" already exists.`)):(Fc.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,h,_={}){this._checkLoaded();const v=this.light.getLight();let S=!1;for(const I in o)if(!a.bx(o[I],v[I])){S=!0;break}if(!S)return;const T=this._getTransitionParameters();this.light.setLight(o,h,_),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,h=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=o;const v=o.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){const I="terrain-dem-src";this.addSource(I,_.source),_=a.dn(_),_=Object.assign(_,{source:I})}const S=Object.assign({},_),T={};if(this.terrain&&v){S.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(T.style=I.serialize())}if(this._validate(Mc,"terrain",S,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h),this.fire(new a.z("data",{dataType:"style"}))}else{const S=this.terrain,T=S.get();for(const I of Object.keys(a.a6.terrain))!_.hasOwnProperty(I)&&a.a6.terrain[I].default&&(_[I]=a.a6.terrain[I].default);for(const I in o)if(!a.bx(o[I],T[I])){S.set(o,this.options),this.stylesheet.terrain=o;const A=this._getTransitionParameters({duration:0});S.updateTransitions(A),this.fire(new a.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const h=this.fog=new Ar(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_createSnow(o){const h=this.snow=new Xi(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_createRain(o){const h=this.rain=new Ci(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!a.bx(h.get(),o)){h.set(o,this.options),this.stylesheet.fog=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!a.bx(h.get(),o)){h.set(o,this.options),this.stylesheet.snow=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!a.bx(h.get(),o)){h.set(o,this.options),this.stylesheet.rain=h.get();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void o();const _=this._evaluateColorThemeData(h);this._loadColorTheme(_).then(()=>{this.fire(new a.z("colorthemeset")),o()}).catch(v=>{a.w(`Couldn't set color theme: ${v}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&a.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,h){const _=this.getFragmentStyle(o);_&&(_._styleColorTheme.colorThemeOverride=h,_._reloadColorTheme())}_getTransitionParameters(o){return{now:a.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],h=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?o.push(_):h.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o,h){const _=this.terrain=new We(o,h,this.scope,this.options,this.map.getWorldview());h===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});_.updateTransitions(v)}_force3DLayerUpdate(){for(const o in this._layers){const h=this._layers[o];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const h=this._layers[o];h.type==="symbol"&&this._updateLayer(h)}}_validate(o,h,_,v,S={}){if(S&&S.validate===!1)return!1;const T=Object.assign({},this.serialize());return Eh(this,o.call(Fa,Object.assign({key:h,style:T,value:_,styleSpec:a.a6},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const h=this.getSourceCaches(o);for(const _ of h)_.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const h=this._mergedLayers[o];h._clear&&h._clear()}}reloadSource(o){const h=this.getSourceCaches(o);for(const _ of h)_.resume(),_.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let h;this.directionalLight&&(h=sT(this.directionalLight));const _=new Set;for(const v in this._mergedLayers){const S=this._mergedLayers[v];S.hasElevation()&&!_.has(S.source)&&_.add(S.source)}for(const v in this._mergedSourceCaches){const S=this._mergedSourceCaches[v],T=_.has(S._source.id);S.update(o,void 0,void 0,h,T)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,_,v,S,T,I=!1){let A=!1,L=!1;const F={},H={};for(const U of this._mergedOrder){const Y=this._mergedLayers[U];if(Y.type!=="symbol")continue;const te=a.B(Y.source,Y.scope);let se=F[te];if(!se){const de=this.getLayerSourceCache(Y);if(!de)continue;const _e=de.getRenderableIds(!0).map(Ee=>de.getTileByID(Ee));H[te]=_e.slice(),se=F[te]=_e.sort((Ee,xe)=>xe.tileID.overscaledZ-Ee.tileID.overscaledZ||(Ee.tileID.isLessThan(xe.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(Y,se,h.center.lng,h.projection);A=A||fe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new a.z("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.o.now(),h.zoom))&&(this.pauseablePlacement=new cs(h,this._mergedOrder,I,_,v,S,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,H,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.o.now()),L=!0),A&&this.pauseablePlacement.placement.setStale()),L||A){this._buildingIndex.onNewFrame(h.zoom);for(let U=0;U<this._mergedOrder.length;U++){const Y=this._mergedLayers[this._mergedOrder[U]];if(Y.type!=="symbol")continue;const te=this.isLayerClipped(Y);this.placement.updateLayerOpacities(Y,F[a.B(Y.source,Y.scope)],U,te?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.o.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,h){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:S})=>S===o.id)!==-1)return void this.fire(new a.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!h)return _.push(o),this._loadImports([o],!0);const v=_.findIndex(({id:S})=>S===h);return v===-1&&this.fire(new a.y(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,v).concat(o).concat(_.slice(v)),this._loadImports([o],!0,h)}updateImport(o,h){this._checkLoaded();const _=this.stylesheet.imports||[],v=this.getImportIndex(o);return v===-1?this:typeof h=="string"?(this.setImportUrl(o,h),this):(h.url&&h.url!==_[v].url&&this.setImportUrl(o,h.url),a.bx(h.config,_[v].config)||this.setImportConfig(o,h.config,h.data.schema),a.bx(h.data,_[v].data)||this.setImportData(o,h.data),this)}moveImport(o,h){this._checkLoaded();let _=this.stylesheet.imports||[];const v=this.getImportIndex(o);if(v===-1)return this;const S=this.getImportIndex(h);if(S===-1)return this;const T=_[v],I=this.fragments[v];return _=_.filter(({id:A})=>A!==o),this.fragments=this.fragments.filter(({id:A})=>A!==o),this.stylesheet.imports=_.slice(0,S).concat(T).concat(_.slice(S)),this.fragments=this.fragments.slice(0,S).concat(I).concat(this.fragments.slice(S)),this.mergeLayers(),this}setImportUrl(o,h){this._checkLoaded();const _=this.stylesheet.imports||[],v=this.getImportIndex(o);if(v===-1)return this;_[v].url=h;const S=this.fragments[v];return S.style=this._createFragmentStyle(_[v]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(h),this}setImportData(o,h){this._checkLoaded();const _=this.getImportIndex(o),v=this.stylesheet.imports||[];return _===-1?this:h?(this.fragments[_].style.setState(h),this._reloadImports(),this):(delete v[_].data,this.setImportUrl(o,v[_].url))}setImportConfig(o,h,_){this._checkLoaded();const v=this.getImportIndex(o),S=this.stylesheet.imports||[];if(v===-1)return this;h?S[v].config=h:delete S[v].config;const T=this.fragments[v];_&&T.style.stylesheet&&(T.style.stylesheet.schema=_);const I=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=h,T.style.updateConfig(h,I),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const h=this.stylesheet.imports||[],_=this.getImportIndex(o);_!==-1&&(h.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(o){const h=(this.stylesheet.imports||[]).findIndex(_=>_.id===o);return h===-1&&this.fire(new a.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),h}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const h in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[h];_&&o.push(_.getSource())}return o}getSource(o,h){const _=this.getSourceCache(o,h);return _&&_.getSource()}getLayerSource(o){const h=this.getLayerSourceCache(o);return h&&h.getSource()}getSourceCache(o,h){const _=a.B(o,h);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(o){const h=a.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[o]&&h.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&h.push(this._mergedSymbolSourceCaches[o]),h}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const h in o){const _=o[h];_==="reload"?this.reloadSource(h):_==="clear"&&this.clearSource(h)}}updateLayers(o){const h=this._changes.getUpdatedPaintProperties();for(const _ of h){const v=this.getLayer(_);v&&v.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,h,_){this.imageManager.getImages(h.images,h.scope,_),this._updateTilesForChangedImages();const v=T=>{if(T){const I=h.images.map(A=>a.I.toString(A));T.setDependencies(h.tileID.key,h.type,I)}},S=a.B(h.source,h.scope);v(this._mergedOtherSourceCaches[S]),v(this._mergedSymbolSourceCaches[S]),h.images.some(T=>T.iconsetId)&&this.fire(new a.z("data",{dataType:"style"}))}rasterizeImages(o,h,_){this.imageManager.rasterizeImages(h,_)}getGlyphs(o,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(o,h,_){return a.dy(h,_)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}_isSourceCacheLoaded(o){const h=this.getOwnSourceCaches(o);return h.length===0?(this.fire(new a.y(new Error(`There is no source with ID '${o}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,h){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const _=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),v=o.type==="building";if(o.is3D(!!this.terrain)){if(_||v||h&&h.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Fc.getSourceType=function(g){return Ma[g]},Fc.setSourceType=function(g,o){Ma[g]=o},Fc.registerForPluginStateChange=a.dz;class jf extends a.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},a.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(const[h,_]of Object.entries(o.buildings))if(this._buildings[h])for(const v of _.floorIds)this._buildings[h].floors[v]||(this._buildings[h].floors[v]=_.floors[v]);else this._buildings[h]=_;for(const h of o.activeFloors)this._activeFloors.add(h);this._updateIndoorSelector()}getIndoorTileOptions(o,h){const _=this._style.getIndoorSourceLayers(o,h);return _&&this._indoorState?{sourceLayers:_,indoorState:this._indoorState}:null}_updateUI(o,h,_){const v=function(S,T,I,A){let L=null,F=Number.MAX_SAFE_INTEGER;if(A<16)return null;for(const[H,U]of Object.entries(S)){const Y=U.center;if(Y){const te=T.distanceTo(a.aS.convert(Y));te<F&&I.contains(Y)&&(F=te,L=H)}}return L}(this._buildings,h,_,o);v!==this._closestBuildingId&&(this._closestBuildingId=v,this._updateIndoorSelector())}_updateIndoorSelector(){const o=this._buildings,h=this._closestBuildingId,_=h&&o?o[h]:void 0;if(!_)return void this.fire(new a.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let v=null;for(const T of _.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){v=T;break}const S=Array.from(_.floorIds).map(T=>({id:T,name:_.floors[T].name,zIndex:_.floors[T].zIndex})).sort((T,I)=>I.zIndex-T.zIndex);this.fire(new a.z("selector-update",{selectedFloorId:v,activeFloorsVisible:this._activeFloorsVisible,floors:S}))}_updateActiveFloors(){const o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Hg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,jw=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Nw=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,zp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Bp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Iw=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Zy=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,nc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ky=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Zt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Cw=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Vp=[];zc(Hg,Vp),zc(Nw,Vp),zc(jw,Vp);const Up={"_prelude_fog.vertex.glsl":Iw,"_prelude_terrain.vertex.glsl":Bp,"_prelude_shadow.vertex.glsl":Zt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Zy,"_prelude_shadow.fragment.glsl":Cw,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":nc,"_prelude_raster_particle.glsl":Ky},Wg={};Dn("",Bp),Dn(Zy,Iw),Dn(Cw,Zt),Dn(nc,""),Dn(Ky,"");const Zg=Dn(jw,Nw),Hu=Hg;var Xy={background:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Dn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Dn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Dn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Dn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Dn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Dn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Dn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Dn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Dn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Dn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Dn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Dn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Dn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Dn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Dn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Dn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,zp),skyboxGradient:Dn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,zp),skyboxCapture:Dn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Dn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Dn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Dn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Dn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Dn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Dn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function zc(g,o){const h=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of h)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=_.split(" ");for(const S of v)o.includes(S)||o.push(S)}}function Dn(g,o){const h=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v={},S=[],T=[];if(g=g.replace(h,(A,L)=>(T.push(L),"")),(o=o.replace(h,(A,L)=>(S.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Vp];zc(g,I),zc(o,I);for(const A of[...S,...T])Up[A]||console.error(`Undefined include: ${A}`),Wg[A]||(Wg[A]=[],zc(Up[A],Wg[A])),I=[...I,...Wg[A]];return{fragmentSource:g=g.replace(_,(A,L,F,H,U)=>(v[U]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${F} ${H} ${U};
#else
uniform ${F} ${H} u_${U};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${U}
    ${F} ${H} ${U} = u_${U};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${F} ${H} ${U};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(_,(A,L,F,H,U)=>{const Y=`MATERIAL_ATTRIBUTE_OFFSET_${U}`,te=H==="float"?"vec2":H,se=`GET_ATTRIBUTE_${te}(a_${U}, materialInfo, ${Y})`,fe=U.match(/color/)?"color":te;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${U}
in ${F} ${H} a_${U};
#endif
`:v[U]?L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
    #if !defined(${Y})
        in ${F} ${te} a_${U};
    #endif
out ${F} ${H} ${U};
#else
uniform ${F} ${H} u_${U};
#endif
`:L==="initialize"?fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${F} ${H} ${U} = u_${U};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${U}) 
    #ifdef ${Y}
        ${U} = unpack_mix_${fe}(${se}, u_${U}_t);
    #else
        ${U} = unpack_mix_${fe}(a_${U}, u_${U}_t);
    #endif
#else
    ${F} ${H} ${U} = u_${U};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${F} ${H} a_${U};
    out ${F} ${H} ${U};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${U} = a_${U};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
    #if !defined(${Y})
        in ${F} ${te} a_${U};
    #endif  
#else
uniform ${F} ${H} u_${U};
#endif
`:L==="define-instanced"?fe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${U}0;
in vec4 a_${U}1;
in vec4 a_${U}2;
in vec4 a_${U}3;
#else
uniform ${F} ${H} u_${U};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${te} a_${U};
#else
uniform ${F} ${H} u_${U};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${F} ${H} ${U} = a_${U};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    #ifdef ${Y}
        ${F} ${H} ${U} = ${se};
    #else
        ${F} ${H} ${U} = a_${U};
    #endif
#else
    ${F} ${H} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    #ifdef ${Y}
        ${F} ${H} ${U} = unpack_mix_${fe}(${se}, u_${U}_t);
    #else
        ${F} ${H} ${U} = unpack_mix_${fe}(a_${U}, u_${U}_t);
    #endif
#else
    ${F} ${H} ${U} = u_${U};
#endif
`}),usedDefines:I,vertexIncludes:S,fragmentIncludes:T}}class $p{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,h,_,v,S,T,I,A){this.context=o;let L=this.boundPaintVertexBuffers.length!==v.length;for(let H=0;!L&&H<v.length;H++)this.boundPaintVertexBuffers[H]!==v[H]&&(L=!0);let F=this.boundDynamicVertexBuffers.length!==I.length;for(let H=0;!F&&H<I.length;H++)this.boundDynamicVertexBuffers[H]!==I[H]&&(F=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||L||F||this.boundIndexBuffer!==S||this.boundVertexOffset!==T)this.freshBind(h,_,v,S,T,I,A);else{o.bindVertexArrayOES.set(this.vao);for(const H of I)H&&(H.bind(),A&&H.instanceCount&&H.setVertexAttribDivisor(o.gl,h,A));S&&S.dynamicDraw&&S.bind()}}freshBind(o,h,_,v,S,T,I){const A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=T,h.enableAttributes(L,o),h.bind(),h.setVertexAttribPointers(L,o,S);for(const F of _)F.enableAttributes(L,o),F.bind(),F.setVertexAttribPointers(L,o,S);for(const F of T)F&&(F.enableAttributes(L,o),F.bind(),F.setVertexAttribPointers(L,o,S),I&&F.instanceCount&&F.setVertexAttribDivisor(L,o,I));v&&v.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function DA(g,o){const h=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new a.ae(0,_/h).toLngLat().lat,new a.ae(0,(_+1)/h).toLngLat().lat]}function OA(g,o,h,_,v,S,T){const I=g.context,A=I.gl,L=h.hillshadeFBO;if(!L)return;g.prepareDrawTile();const F=g.isTileAffectedByFog(o),H=g.getOrCreateProgram("hillshade",{overrideFog:F});I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,L.colorAttachment.get());const U=((fe,de,_e,Ee)=>{const xe=_e.paint.get("hillshade-shadow-color"),Re=_e.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Te=_e.paint.get("hillshade-highlight-color"),De=_e.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Pe=_e.paint.get("hillshade-accent-color"),Ie=_e.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Oe=_e.paint.get("hillshade-emissive-strength");let et=a.an(_e.paint.get("hillshade-illumination-direction"));if(_e.paint.get("hillshade-illumination-anchor")==="viewport")et-=fe.transform.angle;else if(fe.style&&fe.style.enable3dLights()&&fe.style.directionalLight){const pt=fe.style.directionalLight.properties.get("direction"),ot=a.d3(pt.x,pt.y,pt.z);et=a.an(ot[1])}const Ke=!fe.options.moving;return{u_matrix:Ee||fe.transform.calculateProjMatrix(de.tileID.toUnwrapped(),Ke),u_image:0,u_latrange:DA(0,de.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),et],u_shadow:xe.toPremultipliedRenderColor(Re?null:_e.lut),u_highlight:Te.toPremultipliedRenderColor(De?null:_e.lut),u_emissive_strength:Oe,u_accent:Pe.toPremultipliedRenderColor(Ie?null:_e.lut)}})(g,h,_,g.terrain?o.projMatrix:null);g.uploadCommonUniforms(I,H,o.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:te,tileBoundsSegments:se}=g.getTileBoundsBuffers(h);H.draw(g,A.TRIANGLES,v,S,T,Xr.disabled,U,_.id,Y,te,se)}function Yy(g,o,h){if(!o.needsDEMTextureUpload)return;const _=g.context,v=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||g.getTileTexture(h.stride);const S=h.getPixels();o.demTexture?o.demTexture.update(S,{premultiply:!1}):o.demTexture=new a.T(_,S,v.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function LA(g,o,h){const _=g.context,v=_.gl;if(!o.dem)return;const S=o.dem;if(_.activeTexture.set(v.TEXTURE1),Yy(g,o,S),!o.demTexture)return;o.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const T=S.dim;_.activeTexture.set(v.TEXTURE0);let I=o.hillshadeFBO;if(!I){const U=new a.T(_,{width:T,height:T,data:null},v.RGBA8);U.bind(v.LINEAR,v.CLAMP_TO_EDGE),I=o.hillshadeFBO=_.createFramebuffer(T,T,!0,"renderbuffer"),I.colorAttachment.set(U.texture)}_.bindFramebuffer.set(I.framebuffer),_.viewport.set([0,0,T,T]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:L,tileBoundsSegments:F}=g.getMercatorTileBoundsBuffers(),H=[];g.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(g,v.TRIANGLES,wr.disabled,en.disabled,vn.unblended,Xr.disabled,((U,Y)=>{const te=Y.stride,se=a.bB();return a.cd(se,0,a.al,-a.al,0,0,1),a.bq(se,se,[0,-a.al,0]),{u_matrix:se,u_image:1,u_dimension:[te,te],u_zoom:U.overscaledZ}})(o.tileID,S),h.id,A,L,F),o.needsHillshadePrepare=!1}class yi{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oT extends yi{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Aw extends yi{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class FA extends yi{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class zA extends yi{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class BA extends yi{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class VA extends yi{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class lT extends yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class UA extends yi{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Jy extends yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class $A extends yi{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class cT extends yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Pw extends yi{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Qy extends yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class kw extends yi{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Nf extends yi{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class qp extends yi{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Kg extends yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class Gp extends yi{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class uT extends yi{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let Rw=class extends yi{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class dT extends yi{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Hp extends yi{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ex extends yi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class tx extends yi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Mw extends yi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class rx extends yi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Xg extends yi{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class hT extends yi{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class fT extends yi{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class pT extends yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Wp extends yi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class nx extends yi{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class qA extends nx{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class mT extends nx{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class GA extends nx{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Dw extends mT{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ow=(g,o,h)=>({u_matrix:g,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:h}),sx=(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:S,u_image0:0,u_frustum_tl:T,u_frustum_tr:I,u_frustum_br:A,u_frustum_bl:L,u_globe_pos:F,u_globe_radius:H,u_viewport:U,u_grid_matrix:se?Float32Array.from(se):new Float32Array(9),u_skirt_height:Y,u_far_z_cutoff:te});function ix(g,o){return g!=null&&o!=null&&!(!g.hasData()||!o.hasData())&&g.demTexture!=null&&o.demTexture!=null&&g.tileID.key!==o.tileID.key}const If=new class{constructor(){this.operations={}}newMorphing(g,o,h,_,v){if(g in this.operations){const S=this.operations[g];S.to.tileID.key!==h.tileID.key&&(S.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:v,from:o,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const o=this.operations[g];return{from:o.from,to:o.to,phase:o.phase}}update(g){for(const o in this.operations){const h=this.operations[o];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[o];break}}}_nextOp(g,o){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=o,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Lw={0:null,1:"TERRAIN_VERTEX_MORPHING"};function gT(g,o,h){if(o===0)return 0;const _=o<1&&h===514?.25/o:1;return 6*Math.pow(1.5,22-g)*Math.max(o,1)*_}function Yg(g,o){const h=1<<g.z;return!o&&(g.x===0||g.x===h-1)||g.y===0||g.y===h-1}const Cf=g=>({u_matrix:g});function ax(g,o,h,_,v){if(v>0){const S=a.o.now(),T=(S-g.timeAdded)/v,I=o?(S-o.timeAdded)/v:-1,A=h.getSource(),L=_.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!o||Math.abs(o.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),H=F&&g.refreshedUponExpiration?1:a.aA(F?T:1-I,0,1);return o?{opacity:1,mix:1-H,isFading:T<1}:{opacity:H,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class sc extends kl{constructor(o){const h=za("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",h,!1),h.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,h){o.state="loaded",h(null)}}class Fw extends kl{constructor(o){const h=za("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,_){if(o.freezeTileCoverage)return;this.transform=o;const v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,T)=>{if(S[T.key]="",!this._tiles[T.key]){const I=new tc(T,this._source.tileSize*T.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[T.key]=I}return S},{});for(const S in this._tiles)S in v||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(o){const h=this.proxyCachedFBO[o];if(h!==void 0){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Jg extends a.aP{constructor(o,h,_){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class Qg extends a.bU{constructor(o,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,v,S]=function(A){const L=new a.bc,F=new a.b0,H=131;L.reserve(17161),F.reserve(33800);const U=a.al/128,Y=a.al+U/2,te=Y+U;for(let fe=-U;fe<te;fe+=U)for(let de=-U;de<te;de+=U){const _e=de<0||de>Y||fe<0||fe>Y?24575:0,Ee=a.aA(Math.round(de),0,a.al),xe=a.aA(Math.round(fe),0,a.al);L.emplaceBack(Ee+_e,xe)}const se=(fe,de)=>{const _e=de*H+fe;F.emplaceBack(_e+1,_e,_e+H),F.emplaceBack(_e+H,_e+H+1,_e+1)};for(let fe=1;fe<129;fe++)for(let de=1;de<129;de++)se(de,fe);return[0,129].forEach(fe=>{for(let de=0;de<130;de++)se(de,fe),se(fe,de)}),[L,F,32768]}(),T=o.context;this.gridBuffer=T.createVertexBuffer(_,a.be.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=a.bf.simpleSegment(0,0,_.length,v.length),this.gridNoSkirtSegments=a.bf.simpleSegment(0,0,_.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Fw(h.map),this.orthoMatrix=a.bB(),a.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.al,0,a.al,0,1);const I=T.gl;this._overlapStencilMode=new en({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new sc(h.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,h,_){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const v=o.terrain.properties,S=o.terrain.drapeRenderMode===0,T=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.o.now();const I=o.terrain&&o.terrain.scope,A=v.get("source"),L=S?this._mockSourceCache:o.getSourceCache(A,I);if(!L)return void a.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=L,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(h,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const h=this._previousCameraAltitude,_=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=_;const v=h!=null?_-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const S=o.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(S);let I=S-this._previousZoom;const A=this._previousUpdateTimestamp;let L=S;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(S-L)>.5&&(I=.5*(S-L+I)),I*v<0&&(L+=I)),this._evaluationZoom=L;const F=T.getExaggeration(L),H=F===T.getExaggeration(Math.max(0,L-.1));if(H&&Math.abs(F-this._exaggeration)<.01)return F;let U=Math.min(.1,.00375*(this._updateTimestamp-A));return(H||F<.1||Math.abs(I)<1e-4)&&(U=Math.min(.2,4*U)),a.ak(this._exaggeration,F,U)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(a.ae.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=h.getIds().map(A=>{const L=h.getTileByID(A).tileID;return L.projMatrix=_.calculateProjMatrix(L.toUnwrapped()),L});(function(A,L){const F=L.transform.pointCoordinate(L.transform.getCameraPoint()),H=new a.P(F.x,F.y);A.sort((U,Y)=>{if(Y.overscaledZ-U.overscaledZ)return Y.overscaledZ-U.overscaledZ;const te=new a.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),se=new a.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),fe=H.mult(1<<U.canonical.z);return fe.x-=.5,fe.y-=.5,fe.distSqr(te)-fe.distSqr(se)})})(v,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},v.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const A in T){const L=T[A];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,o[A],S),L.usedForTerrain))continue;const F=o[A];L.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[h.id]=v.map(A=>new Jg(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const L=this.terrainTileForTile[A.key];if(!L)continue;const F=L.tileID.key;F in I||(this._visibleDemTiles.push(L),I[F]=F)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const o=this.painter.context,h=o.gl;for(const _ in this.terrainTileForTile){const v=this.terrainTileForTile[_],S=v.dem;!S||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),Yy(this.painter,v,S))}}_prepareDemTileUniforms(o,h,_,v){if(!h||h.demTexture==null)return!1;const S=o.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-S.z),I=v||"";return _[`u_dem_tl${I}`]=[S.x*T%1,S.y*T%1],_[`u_dem_scale${I}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const h=this._visibleDemTiles.reduce((_,v)=>{if(!v.dem)return _;const S=v.dem.tree.minimums[0];return S>0&&o++,_+S},0);return o?h/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),v=new a.dK({width:1,height:1},new Float32Array([_]));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(v,{premultiply:!1}):S=this._emptyDEMTexture=new a.T(o,v,h.R32F,{premultiply:!1}),S}setupElevationDraw(o,h,_){const v=this.painter.context,S=v.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let I=null,A=null,L=1;if(_&&_.morphing&&this._useVertexMorphing){const Y=_.morphing.srcDemTile,te=_.morphing.dstDemTile;L=_.morphing.phase,Y&&te&&(this._prepareDemTileUniforms(o,Y,T,"_prev")&&(A=Y),this._prepareDemTileUniforms(o,te,T)&&(I=te))}const F=Y=>Y&&Y.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST;let H=null;var U;if(this.enabled?A&&I?(H=I.demTexture,v.activeTexture.set(S.TEXTURE4),A.demTexture.bind(F(A),S.CLAMP_TO_EDGE),T.u_dem_lerp=L):(I=this.terrainTileForTile[o.tileID.key],H=this._prepareDemTileUniforms(o,I,T)?I.demTexture:this.emptyDEMTexture):H=this.emptyDEMTexture,v.activeTexture.set(S.TEXTURE2),H&&(T.u_dem_size=(U=H).size[0]===1?1:U.size[0]-2,H.bind(F(I),S.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,h,T),_&&_.useMeterToDem&&I){const Y=(1<<I.tileID.canonical.z)*a.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=Y}if(_&&_.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(v,T),this.painter.transform.projection.name==="globe"){const Y=this.globeUniformValues(this.painter.transform,o.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,Y)}}globeUniformValues(o,h,_){const v=o.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,a.al,0),u_tile_br_up:v.upVector(h,a.al,a.al),u_tile_bl_up:v.upVector(h,0,a.al),u_tile_up_scale:_?a.dL(1):v.upVectorScale(h,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const h=this.painter,_=this.painter.context;o.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,S,T,I,A){if(v.transform.projection.name==="globe")(function(L,F,H,U,Y){const te=L.context,se=te.gl;let fe,de;const _e=L.transform,Ee=a.dD(L,te,_e),xe=(pt,ot)=>{if(de===ot)return;const vt=[Lw[ot],"PROJECTION_GLOBE_VIEW"];Ee&&vt.push("CUSTOM_ANTIALIASING");const qt=L.isTileAffectedByFog(pt);fe=L.getOrCreateProgram("globeRaster",{defines:vt,overrideFog:qt}),de=ot},Re=L.colorModeForRenderPass(),Te=new wr(se.LEQUAL,wr.ReadWrite,L.depthRangeFor3D);If.update(Y);const De=a.dE(_e),Pe=[a.aF(_e.center.lng),a.aJ(_e.center.lat)],Ie=L.globeSharedBuffers,Oe=[_e.width*a.o.devicePixelRatio,_e.height*a.o.devicePixelRatio],et=Float32Array.from(_e.globeMatrix),Ke={useDenormalizedUpVectorScale:!0};{const pt=L.transform,ot=gT(pt.zoom,F.exaggeration(),F.sourceCache._source.tileSize);de=-1;const vt=se.TRIANGLES;for(const qt of U){const nt=H.getTile(qt),Ue=en.disabled,wt=F.prevTerrainTileForTile[qt.key],lt=F.terrainTileForTile[qt.key];ix(wt,lt)&&If.newMorphing(qt.key,wt,lt,Y,250),te.activeTexture.set(se.TEXTURE0),nt.texture&&nt.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Pt=If.getMorphValuesForProxy(qt.key),Kt=Pt?1:0;Pt&&Object.assign(Ke,{morphing:{srcDemTile:Pt.from,dstDemTile:Pt.to,phase:a.dC(Pt.phase)}});const gr=a.dF(qt.canonical),Ut=a.dG(gr.getCenter().lat),Ht=a.dH(qt.canonical,gr,Ut,pt.worldSize/pt._pixelsPerMercatorPixel),yr=a.bj(a.dI(qt.canonical)),lr=sx(pt.expandedFarZProjMatrix,et,De,yr,a.aj(pt.zoom),Pe,pt.frustumCorners.TL,pt.frustumCorners.TR,pt.frustumCorners.BR,pt.frustumCorners.BL,pt.globeCenterInViewSpace,pt.globeRadius,Oe,ot,pt._farZ,Ht);if(xe(qt,Kt),fe&&(F.setupElevationDraw(nt,fe,Ke),L.uploadCommonUniforms(te,fe,qt.toUnwrapped()),Ie)){const[sr,cr,Lr]=Ie.getGridBuffers(Ut,ot!==0);fe.draw(L,vt,Te,Ue,Re,Xr.backCCW,lr,"globe_raster",sr,cr,Lr)}}}if(Ie&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const pt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ee&&pt.push("CUSTOM_ANTIALIASING"),fe=L.getOrCreateProgram("globeRaster",{defines:pt});for(const ot of U){const{x:vt,y:qt,z:nt}=ot.canonical,Ue=qt===0,wt=qt===(1<<nt)-1,[lt,Pt,Kt,gr]=Ie.getPoleBuffers(nt,!1);if(gr&&(Ue||wt)){const Ut=H.getTile(ot);te.activeTexture.set(se.TEXTURE0),Ut.texture&&Ut.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);let Ht=a.dJ(nt,vt,_e);const yr=a.bj(a.dI(ot.canonical)),lr=(sr,cr)=>sr.draw(L,se.TRIANGLES,Te,en.disabled,Re,Xr.disabled,sx(_e.expandedFarZProjMatrix,Ht,Ht,yr,0,Pe,_e.frustumCorners.TL,_e.frustumCorners.TR,_e.frustumCorners.BR,_e.frustumCorners.BL,_e.globeCenterInViewSpace,_e.globeRadius,Oe,0,_e._farZ),"globe_pole_raster",cr,Kt,gr);F.setupElevationDraw(Ut,fe,Ke),L.uploadCommonUniforms(te,fe,ot.toUnwrapped()),Ue&&L.renderDefaultNorthPole&&lr(fe,lt),wt&&L.renderDefaultSouthPole&&(Ht=a.cR(a.bB(),Ht,[1,-1,1]),lr(fe,Pt))}}}})(v,S,T,I,A);else{const L=v.context,F=L.gl;let H,U;const Y=v.shadowRenderer,te=wd(v,v.longestCutoffRange),se=Re=>{if(U===Re)return;const Te=[];Te.push(Lw[Re]),te.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),Y&&(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&Te.push("NORMAL_OFFSET")),H=v.getOrCreateProgram("terrainRaster",{defines:Te}),U=Re},fe=v.colorModeForRenderPass(),de=new wr(F.LEQUAL,wr.ReadWrite,v.depthRangeFor3D);If.update(A);const _e=v.transform,Ee=gT(_e.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let xe=[0,0,0];if(Y){const Re=v.style.directionalLight,Te=v.style.ambientLight;Re&&Te&&(xe=Lc(v.style,Re,Te))}{U=-1;const Re=F.TRIANGLES,[Te,De]=[S.gridIndexBuffer,S.gridSegments];for(const Pe of I){const Ie=T.getTile(Pe),Oe=en.disabled,et=S.prevTerrainTileForTile[Pe.key],Ke=S.terrainTileForTile[Pe.key];ix(et,Ke)&&If.newMorphing(Pe.key,et,Ke,A,250),L.activeTexture.set(F.TEXTURE0),Ie.texture&&Ie.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const pt=If.getMorphValuesForProxy(Pe.key),ot=pt?1:0;let vt;pt&&(vt={morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:a.dC(pt.phase)}});const qt=Ow(Pe.projMatrix,Yg(Pe.canonical,_e.renderWorldCopies)?Ee/10:Ee,xe);if(se(ot),!H)continue;S.setupElevationDraw(Ie,H,vt);const nt=Pe.toUnwrapped();Y&&Y.setupShadows(nt,H),v.uploadCommonUniforms(L,H,nt,null,te),H.draw(v,Re,de,Oe,fe,Xr.backCCW,qt,"terrain_raster",S.gridBuffer,Te,De)}}}}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,v=this.proxySourceCache,S=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),I=h.style.order,A=[];let L=0;for(const F of S){const H=v.getTileByID(F.proxyTileKey),U=v.proxyCachedFBO[F.key]?v.proxyCachedFBO[F.key][o]:void 0,Y=U!==void 0?v.renderCache[U]:this.pool[L++],te=U!==void 0;if(H.texture=Y.tex,te&&!Y.dirty){A.push(H.tileID);continue}let se;_.bindFramebuffer.set(Y.fb.framebuffer),this.renderedToTile=!1,Y.dirty&&(_.clear({color:a.ao.transparent,stencil:0}),Y.dirty=!1);for(let fe=T.start;fe<=T.end;++fe){const de=h.style._mergedLayers[I[fe]];if(de.isHidden(h.transform.zoom))continue;const _e=h.style.getLayerSourceCache(de),Ee=_e?this.proxyToSource[F.key][_e.id]:[F];if(!Ee)continue;const xe=Ee;_.viewport.set([0,0,Y.fb.width,Y.fb.height]),se!==(_e?_e.id:null)&&(this._setupStencil(Y,Ee,de,_e),se=_e?_e.id:null),h.renderLayer(h,_e,de,xe)}if(this._drapedRenderBatches.length===0)for(const fe of this._pendingGroundEffectLayers){const de=h.style._mergedLayers[I[fe]];if(de.isHidden(h.transform.zoom))continue;const _e=h.style.getLayerSourceCache(de),Ee=_e?this.proxyToSource[F.key][_e.id]:[F];if(!Ee)continue;const xe=Ee;_.viewport.set([0,0,Y.fb.width,Y.fb.height]),se!==(_e?_e.id:null)&&(this._setupStencil(Y,Ee,de,_e),se=_e?_e.id:null),h.renderLayer(h,_e,de,xe)}this.renderedToTile?(Y.dirty=!0,A.push(H.tileID)):te||--L,L===5&&(L=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}isLayerOrderingCorrect(o){const h=o.order.length;let _=-1,v=h;for(let S=0;S<h;++S)this._style.isLayerDraped(o._mergedLayers[o.order[S]])?_=Math.max(_,S):v=Math.min(v,S);return v>_}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,h,_){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const T=S.tileID,I=1<<T.overscaledZ,{x:A,y:L}=T.canonical,F=A/I,H=(A+1)/I,U=L/I,Y=(L+1)/I;return{minx:F,miny:U,maxx:H,maxy:Y,t:S.dem.tree.raycastRoot(F,U,H,Y,o,h,_),tile:S}});v.sort((S,T)=>(S.t!==null?S.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const S of v){if(S.t==null)return null;const T=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,o,h,_);if(T!=null)return T}return null}_createFBO(){const o=this.painter.context,h=o.gl,_=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);const v=new a.T(o,{width:_[0],height:_[1],data:null},h.RGBA8);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);const S=o.createFramebuffer(_[0],_[1],!0,null);return S.colorAttachment.set(v.texture),S.depthAttachment=new Dw(o,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:S,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const h=this._style._mergedLayers[o],_=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const _ of this._style.getSources())if(_ instanceof ao){o=!0;break}if(!o)return;const h={};for(let _=0;_<this._style.order.length;++_){const v=this._style._mergedLayers[this._style.order[_]],S=this._style.getLayerSourceCache(v);if(S&&!h[S.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof a.ad){h[S.id]=!0;for(const T of this.proxyCoords){const I=this.proxyToSource[T.key][S.id];if(I)for(const A of I)this._clearRenderCacheForTile(S.id,A)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof ml){o=!0;break}if(!o)return;const h={};for(let _=0;_<this._style.order.length;++_){const v=this._style._mergedLayers[this._style.order[_]],S=this._style.getLayerSourceCache(v);if(!S||h[S.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const T=v.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][S.id];if(A)for(const L of A){const F=ax(S.getTile(L),S.findLoadedParent(L,0),S,this.painter.transform,T);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(S.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,h=o.length;if(h===0)return;const _=[];this._pendingGroundEffectLayers=[];let v,S=0,T=this._style._mergedLayers[o[S]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++S<h;)T=this._style._mergedLayers[o[S]];for(;S<h;++S){const I=this._style._mergedLayers[o[S]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=S):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),v!==void 0&&(_.push({start:v,end:S-1}),v=void 0)))}if(v!==void 0&&_.push({start:v,end:S-1}),_.length!==0){const I=_[_.length-1];this._pendingGroundEffectLayers.every(A=>A>I.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(o){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let I=0;I<T.length;++I){const A=Object.values(T[I]);h.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,v=this._tilesDirty;for(let T=_.length-1;T>=0;T--){const I=_[T];if(h.getTileByID(I.key),h.proxyCachedFBO[I.key]!==void 0){const A=o[I.key],L=this.proxyToSource[I.key];let F=0;for(const H in L){const U=L[H],Y=A[H];if(!Y||Y.length!==U.length||U.some((te,se)=>te!==Y[se]||v[H]&&v[H].hasOwnProperty(te.key))){F=-1;break}++F}for(const H in h.proxyCachedFBO[I.key])h.renderCache[h.proxyCachedFBO[I.key][H]].dirty=F<0||F!==Object.values(A).length}}const S=[...this._drapedRenderBatches];S.sort((T,I)=>I.end-I.start-(T.end-T.start));for(const T of S)for(const I of _){if(h.proxyCachedFBO[I.key])continue;let A=h.renderCachePool.pop();A===void 0&&h.renderCache.length<50&&(A=h.renderCache.length,h.renderCache.push(this._createFBO())),A!==void 0&&(h.proxyCachedFBO[I.key]={},h.proxyCachedFBO[I.key][T.start]=A,h.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,_,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,T=S.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let I;if(_.isTileClipped())I=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):en.disabled}_renderTileClippingMasks(o,h){const _=this.painter,v=this.painter.context,S=v.gl;_._tileClippingMaskIDs={},v.setColorMode(vn.disabled),v.setDepthMode(wr.disabled);const T=_.getOrCreateProgram("clippingMask");for(const I of o){const A=_._tileClippingMaskIDs[I.key]=--h;T.draw(_,S.TRIANGLES,wr.disabled,new en({func:S.ALWAYS,mask:0},A,255,S.KEEP,S.KEEP,S.REPLACE),vn.disabled,Xr.disabled,Cf(I.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(o){const h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;const _=[o.x,o.y,1,1];a.aC(_,_,h.pixelMatrixInverse),a.cJ(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const v=h._camera.position,S=a.ce(1,h.center.lat),T=[v[0],v[1],v[2]/S,0],I=a.d9([],_.slice(0,3),T);a.aw(I,I);const A=this.raycast(T,I,this._exaggeration);return A!==null&&A?(a.bG(T,T,I,A),T[3]=T[2],T[2]*=S,T):null}_setupProxiedCoordsForOrtho(o,h,_){if(o.getSource()instanceof a.aT)return this._setupProxiedCoordsForImageSource(o,h,_);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const v=this.proxiedCoords[o.id]=[],S=this.proxyCoords;for(let A=0;A<S.length;A++){const L=S[A],F=this._findTileCoveringTileID(L,o);if(F){const H=this._createProxiedId(L,F,_[L.key]&&_[L.key][o.id]);v.push(H),this.proxyToSource[L.key][o.id]=[H]}}let T=!1;const I=new Set;for(let A=0;A<h.length;A++){const L=o.getTile(h[A]);if(!L||!L.hasData())continue;const F=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==L.tileID.canonical.z){const H=this.proxyToSource[F.tileID.key][o.id],U=this._createProxiedId(F.tileID,L,_[F.tileID.key]&&_[F.tileID.key][o.id]);H?H.splice(H.length-1,0,U):this.proxyToSource[F.tileID.key][o.id]=[U];const Y=this.proxyToSource[F.tileID.key][o.id];I.has(Y)||I.add(Y),v.push(U),T=!0}}if(this._sourceTilesOverlap[o.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const A of I)A.sort((L,F)=>F.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(o,h,_){if(!o.getSource().loaded())return;const v=this.proxiedCoords[o.id]=[],S=this.proxyCoords,T=o.getSource(),I=T.tileID;if(!I)return;const A=new a.P(I.x,I.y)._div(1<<I.z),L=T.coordinates.map(a.ae.fromLngLat).reduce((H,U)=>(H.min.x=Math.min(H.min.x,U.x-A.x),H.min.y=Math.min(H.min.y,U.y-A.y),H.max.x=Math.max(H.max.x,U.x-A.x),H.max.y=Math.max(H.max.y,U.y-A.y),H),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(H,U)=>{const Y=H.wrap+H.canonical.x/(1<<H.canonical.z),te=H.canonical.y/(1<<H.canonical.z),se=a.al/(1<<H.canonical.z),fe=U.wrap+U.canonical.x/(1<<U.canonical.z),de=U.canonical.y/(1<<U.canonical.z);return Y+se<fe+L.min.x||Y>fe+L.max.x||te+se<de+L.min.y||te>de+L.max.y};for(let H=0;H<S.length;H++){const U=S[H];for(let Y=0;Y<h.length;Y++){const te=o.getTile(h[Y]);if(!te||!te.hasData()||F(U,te.tileID))continue;const se=this._createProxiedId(U,te,_[U.key]&&_[U.key][o.id]),fe=this.proxyToSource[U.key][o.id];fe?fe.push(se):this.proxyToSource[U.key][o.id]=[se],v.push(se)}}}_createProxiedId(o,h,_){let v=this.orthoMatrix;if(_){const S=_.find(T=>T.key===h.tileID.key);if(S)return S}if(h.tileID.key!==o.key){const S=o.canonical.z-h.tileID.canonical.z;let T,I,A;v=a.bB();const L=h.tileID.wrap-o.wrap<<o.overscaledZ;S>0?(T=a.al>>S,I=T*((h.tileID.canonical.x<<S)-o.canonical.x+L),A=T*((h.tileID.canonical.y<<S)-o.canonical.y)):(T=a.al<<-S,I=a.al*(h.tileID.canonical.x-(o.canonical.x+L<<-S)),A=a.al*(h.tileID.canonical.y-(o.canonical.y<<-S))),a.cd(v,0,T,0,T,0,1),a.bq(v,v,[I,A,0])}return new Jg(h.tileID,o.key,v)}_findTileCoveringTileID(o,h){let _=h.getTile(o);if(_&&_.hasData())return _;const v=this._findCoveringTileCache[h.id],S=v[o.key];if(_=S?h.getTileByID(S):null,_&&_.hasData()||S===null)return _;let T=_?_.tileID:o,I=T.overscaledZ;const A=h.getSource().minzoom,L=[];if(!S){const H=h.getSource().maxzoom;if(o.canonical.z>=H){const U=o.canonical.z-H;h.getSource().reparseOverscaled?(I=Math.max(o.canonical.z+2,h.transform.tileZoom),T=new a.aP(I,o.wrap,H,o.canonical.x>>U,o.canonical.y>>U)):U!==0&&(I=H,T=new a.aP(I,o.wrap,H,o.canonical.x>>U,o.canonical.y>>U))}T.key!==o.key&&(L.push(T.key),_=h.getTile(T))}const F=H=>{L.forEach(U=>{v[U]=H}),L.length=0};for(I-=1;I>=A&&(!_||!_.hasData());I--){_&&F(_.tileID.key);const H=T.calculateScaledKey(I);if(_=h.getTileByID(H),_&&_.hasData())break;const U=v[H];if(U===null)break;U===void 0?L.push(H):_=h.getTileByID(U)}return F(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let _=this._tilesDirty[o];_||(_=this._tilesDirty[o]={}),_[h.key]=!0}}function zw(g,o,h){const _=function(I,A,L){const F=a.bI(A,I),H=a.bI(L,[.2126,.7152,.0722]),U=(te,se,fe)=>(1-fe)*te+fe*se,Y=U(1-.3*Math.min(H,1),1,Math.min(F+1,1));return U(.92,1,Math.asin(a.aA(A[2],-1,1))/Math.PI+.5)*Y}(g,[0,0,1],o),v=[0,0,0];a.c4(v,h.slice(0,3),_);const S=[0,0,0];a.c4(S,o.slice(0,3),g[2]);const T=[0,0,0];return a.d7(T,v,S),a.da(T)}const Bw=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Vw=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class e_{static cacheKey(o,h,_,v){let S=`${h}${v?v.cacheKey:""}`;for(const T of _)o.usedDefines.includes(T)&&(S+=`/${T}`);return S}constructor(o,h,_,v,S,T){const I=o.gl;this.program=I.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...T];let A=v?v.defines():[];A=A.concat(T.map(te=>`#define ${te}`));const L=`#version 300 es
`;let F=L+A.concat("precision mediump float;",Hu,Zg.fragmentSource).join(`
`);for(const te of _.fragmentIncludes)F+=`
${Up[te]}`;F+=`
${_.fragmentSource}`;let H=L+A.concat("precision highp float;",Hu,Zg.vertexSource).join(`
`);for(const te of _.vertexIncludes)H+=`
${Up[te]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&_.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(H+=`
uniform int u_instanceID;
`),H+=`
${_.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(H=H.replaceAll("gl_InstanceID","u_instanceID"));const U=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(U,F),I.compileShader(U),I.attachShader(this.program,U);const Y=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(Y,H),I.compileShader(Y),I.attachShader(this.program,Y),this.attributes={},I.linkProgram(this.program),I.deleteShader(Y),I.deleteShader(U),this.fixedUniforms=S(o),this.binderUniforms=v?v.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(te=>({u_instanceID:new a.cg(te)}))(o)),(T.includes("TERRAIN")||h.indexOf("symbol")!==-1||h.indexOf("circle")!==-1)&&(this.terrainUniforms=(te=>({u_dem:new a.cg(te),u_dem_prev:new a.cg(te),u_dem_tl:new a.cj(te),u_dem_scale:new a.ci(te),u_dem_tl_prev:new a.cj(te),u_dem_scale_prev:new a.ci(te),u_dem_size:new a.ci(te),u_dem_lerp:new a.ci(te),u_exaggeration:new a.ci(te),u_depth:new a.cg(te),u_depth_size_inv:new a.cj(te),u_depth_range_unpack:new a.cj(te),u_occluder_half_size:new a.ci(te),u_occlusion_depth_offset:new a.ci(te),u_meter_to_dem:new a.ci(te),u_label_plane_matrix_inv:new a.ck(te)}))(o)),T.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new a.ch(te),u_tile_tr_up:new a.ch(te),u_tile_br_up:new a.ch(te),u_tile_bl_up:new a.ch(te),u_tile_up_scale:new a.ci(te)}))(o)),T.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new a.ck(te),u_fog_range:new a.cj(te),u_fog_color:new a.d2(te),u_fog_horizon_blend:new a.ci(te),u_fog_vertical_limit:new a.cj(te),u_fog_temporal_offset:new a.ci(te),u_frustum_tl:new a.ch(te),u_frustum_tr:new a.ch(te),u_frustum_br:new a.ch(te),u_frustum_bl:new a.ch(te),u_globe_pos:new a.ch(te),u_globe_radius:new a.ci(te),u_globe_transition:new a.ci(te),u_is_globe:new a.cg(te),u_viewport:new a.cj(te)}))(o)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(te=>({u_cutoff_params:new a.d2(te)}))(o)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(te=>({u_lighting_ambient_color:new a.ch(te),u_lighting_directional_dir:new a.ch(te),u_lighting_directional_color:new a.ch(te),u_ground_radiance:new a.ch(te)}))(o)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(te=>({u_light_matrix_0:new a.ck(te),u_light_matrix_1:new a.ck(te),u_fade_range:new a.cj(te),u_shadow_normal_offset:new a.ch(te),u_shadow_intensity:new a.ci(te),u_shadow_texel_size:new a.ci(te),u_shadow_map_resolution:new a.ci(te),u_shadow_direction:new a.ch(te),u_shadow_bias:new a.ch(te),u_shadowmap_0:new a.cg(te),u_shadowmap_1:new a.cg(te)}))(o)))}getAttributeLocation(o,h){let _=this.attributes[h];return _===void 0&&(_=this.attributes[h]=o.getAttribLocation(this.program,h)),_}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in h)_[v]&&_[v].set(this.program,v,h[v])}}setGlobeUniformValues(o,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in h)_[v]&&_[v].set(this.program,v,h[v])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in h)_[v].set(this.program,v,h[v])}}setCutoffUniformValues(o,h){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in h)_[v].set(this.program,v,h[v])}}setLightsUniformValues(o,h){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in h)_[v].set(this.program,v,h[v])}}setShadowUniformValues(o,h){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;o.program.set(this.program);for(const v in h)_[v].set(this.program,v,h[v])}_drawDebugWireframe(o,h,_,v,S,T,I,A,L,F){const H=o.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const U=o.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||o._terrain&&o._terrain.renderingToTexture||!Bw.includes(this.name))||!(!H.layers3D||!Vw.includes(this.name))))return;const Y=U.gl,te=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,S,U);if(!te)return;const se=[...this.fixedDefines];se.push("DEBUG_WIREFRAME");const fe=o.getOrCreateProgram(this.name,{config:this.configuration,defines:se});U.program.set(fe.program);const de=(xe,Re,Te)=>{if(Re[xe]&&Te[xe])for(const De in Re[xe])Te[xe][De]&&Te[xe][De].set(Te.program,De,Re[xe][De].current)};L&&L.setUniforms(fe.program,U,fe.binderUniforms,I,{zoom:A}),de("fixedUniforms",this,fe),de("terrainUniforms",this,fe),de("globeUniforms",this,fe),de("fogUniforms",this,fe),de("lightsUniforms",this,fe),de("shadowUniforms",this,fe),te.bind(),U.setColorMode(new vn([Y.ONE,Y.ONE_MINUS_SRC_ALPHA,Y.ZERO,Y.ONE],a.ao.transparent,[!0,!0,!0,!1])),U.setDepthMode(new wr(h.func===Y.LESS?Y.LEQUAL:h.func,wr.ReadOnly,h.range)),U.setStencilMode(en.disabled);const _e=3*T.primitiveLength*2,Ee=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const xe=F||1;for(let Re=0;Re<xe;++Re)fe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Re),Y.drawElements(Y.LINES,_e,Y.UNSIGNED_SHORT,Ee)}else F&&F>1?Y.drawElementsInstanced(Y.LINES,_e,Y.UNSIGNED_SHORT,Ee,F):Y.drawElements(Y.LINES,_e,Y.UNSIGNED_SHORT,Ee);S.bind(),U.program.set(this.program),U.setDepthMode(h),U.setStencilMode(_),U.setColorMode(v)}checkUniforms(o,h,_){if(this.fixedDefines.includes(h)){for(const v of Object.keys(_))if(!_[v].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${v} not set but required by ${h} being defined`)}}draw(o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe){const de=o.context,_e=de.gl;if(this.failedToCreate)return;de.program.set(this.program),de.setDepthMode(_),de.setStencilMode(v),de.setColorMode(S),de.setCullFace(T);for(const Re of Object.keys(this.fixedUniforms))this.fixedUniforms[Re].set(this.program,Re,I[Re]);te&&te.setUniforms(this.program,de,this.binderUniforms,U,{zoom:Y});const Ee={[_e.POINTS]:1,[_e.LINES]:2,[_e.TRIANGLES]:3,[_e.LINE_STRIP]:1}[h];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const xe=fe&&fe>0?1:void 0;for(const Re of H.get()){const Te=Re.vaos||(Re.vaos={});if((Te[A]||(Te[A]=new $p)).bind(de,this,L,te?te.getPaintVertexBuffers():[],F,Re.vertexOffset,se||[],xe),this.forceManualRenderingForInstanceIDShaders){const De=fe||1;for(let Pe=0;Pe<De;++Pe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pe),F?_e.drawElements(h,Re.primitiveLength*Ee,_e.UNSIGNED_SHORT,Re.primitiveOffset*Ee*2):_e.drawArrays(h,Re.vertexOffset,Re.vertexLength)}else fe&&fe>1?_e.drawElementsInstanced(h,Re.primitiveLength*Ee,_e.UNSIGNED_SHORT,Re.primitiveOffset*Ee*2,fe):F?_e.drawElements(h,Re.primitiveLength*Ee,_e.UNSIGNED_SHORT,Re.primitiveOffset*Ee*2):_e.drawArrays(h,Re.vertexOffset,Re.vertexLength);h===_e.TRIANGLES&&F&&this._drawDebugWireframe(o,_,v,S,F,Re,U,Y,te,fe)}}}function ox(g,o,h=0){const _=Math.pow(2,o.tileID.overscaledZ),v=o.tileSize*Math.pow(2,g.transform.tileZoom)/_,S=v*(o.tileID.canonical.x+o.tileID.wrap*_),T=v*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.ay(o,1,g.transform.tileZoom),u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T],u_pattern_transition:h}}const Zp={terrain:0,flat:1},lx=a.bB(),cx=(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe,de)=>{const _e=o.style.light,Ee=_e.properties.get("position"),xe=[Ee.x,Ee.y,Ee.z],Re=a.dN();_e.properties.get("anchor")==="viewport"&&(a.dO(Re,-o.transform.angle),a.dP(xe,xe,Re));const Te=_e.properties.get("color").toPremultipliedRenderColor(null),De=o.transform,Pe={u_matrix:g,u_lightpos:xe,u_lightintensity:_e.properties.get("intensity"),u_lightcolor:[Te.r,Te.g,Te.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lx,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Zp[L],u_base_type:Zp[F],u_ao:v,u_edge_radius:S,u_width_scale:T,u_flood_light_color:te,u_vertical_scale:se,u_flood_light_intensity:fe,u_ground_shadow_factor:de};return De.projection.name==="globe"&&(Pe.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Pe.u_zoom_transition=H,Pe.u_inv_rot_matrix=Y,Pe.u_merc_center=U,Pe.u_up_dir=De.projection.upVector(new a.cC(0,0,0),U[0]*a.al,U[1]*a.al),Pe.u_height_lift=A),Pe},_T=(g,o,h,_,v,S)=>({u_matrix:g,u_edge_radius:o,u_width_scale:h,u_vertical_scale:_,u_height_type:Zp[v],u_base_type:Zp[S]}),yT=(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe,de)=>{const _e=cx(g,o,h,_,v,S,T,I,L,F,H,U,Y,te,se,fe,1,[0,0,0]),Ee={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return Object.assign(_e,ox(o,A,de),Ee)},Kp=(g,o,h,_,v,S,T,I,A,L,F)=>({u_matrix:o,u_opacity:h,u_ao_pass:_?1:0,u_meter_to_tile:v,u_ao:S,u_flood_light_intensity:T,u_flood_light_color:I,u_attenuation:A,u_edge_radius:L,u_fb:0,u_fb_size:F,u_dynamic_offset:1}),xT=(g,o,h)=>({u_matrix:g,u_emissive_strength:o,u_ground_shadow_factor:h}),vT=(g,o,h,_,v,S=0)=>Object.assign(xT(g,o,v),ox(h,_,S)),HA=(g,o,h,_)=>({u_matrix:g,u_world:h,u_emissive_strength:o,u_ground_shadow_factor:_}),WA=(g,o,h,_,v,S,T=0)=>Object.assign(vT(g,o,h,_,S,T),{u_world:v}),ZA=(g,o)=>({u_matrix:g,u_ground_shadow_factor:o}),ux=(g,o,h,_,v)=>({u_matrix:g,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:h,u_height_scale:_,u_reset_depth:v}),Uw=(g,o,h,_,v,S,T,I,A)=>({u_matrix:g,u_normal_matrix:o,u_opacity:h,u_faux_facade_ao_intensity:_,u_camera_pos:v,u_tile_to_meter:S,u_facade_emissive_chance:T,u_flood_light_color:I,u_flood_light_intensity:A}),$w=g=>({u_matrix:g}),wT=g=>({u_matrix:g}),Xp=(g,o,h,_,v,S,T,I)=>{const A=a.al/S.tileSize;return{u_matrix:g,u_inv_rot_matrix:o,u_camera_to_center_distance:h.getCameraToCenterDistance(I),u_extrude_scale:[h.pixelsToGLUnits[0]/A,h.pixelsToGLUnits[1]/A],u_zoom_transition:_,u_tile_id:T,u_merc_center:v}},qw=(g,o,h=1)=>({u_matrix:g,u_color:o,u_overlay:0,u_overlay_scale:h}),bT=a.bB(),ST=(g,o,h,_,v,S,T)=>{const I=g.transform,A=I.projection.name==="globe",L=A?a.dQ(I.zoom,o.canonical)*I._pixelsPerMercatorPixel:a.ay(h,1,S),F={u_matrix:o.projMatrix,u_extrude_scale:L,u_intensity:T,u_inv_rot_matrix:bT,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){F.u_inv_rot_matrix=_,F.u_merc_center=v,F.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],F.u_zoom_transition=a.aj(I.zoom);const H=v[0]*a.al,U=v[1]*a.al;F.u_up_dir=I.projection.upVector(new a.cC(0,0,0),H,U)}return F};function dx(g,[o,h,_,v],[S,T]){if(S===T)return[0,0,0,0];const I=255*(g-1)/(g*(T-S));return[o*I,h*I,_*I,v*I]}function bd(g,o,[h,_]){return h===_?0:.5/g+(o-h)*(g-1)/(g*(_-h))}const t_=(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe,de,_e,Ee,xe)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:_,u_grid_matrix:v,u_tl_parent:S,u_scale_parent:L,u_fade_t:F.mix,u_opacity:F.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:a.dS(H.paint.get("raster-saturation")),u_contrast_factor:a.dR(H.paint.get("raster-contrast")),u_spin_weights:hx(H.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:Y,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:A,u_colorization_mix:dx(a.dT,se,de),u_colorization_offset:bd(a.dT,fe,de),u_color_ramp:te,u_texture_offset:[Ee/(_e+2*Ee),_e/(_e+2*Ee)],u_texture_res:[_e+2*Ee,_e+2*Ee],u_emissive_strength:xe});function hx(g){g*=Math.PI/180;const o=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Af=.05,Th=(g,o,h,_,v,S,T,I,A,L,F,H)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:_,u_grid_matrix:v,u_tl_parent:S,u_scale_parent:L,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:H,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:A}),Gw=(g,o,h,_,v,S,T,I,A,L)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_tile_offset:h,u_velocity:_,u_color_ramp:S,u_velocity_res:v,u_max_speed:T,u_uv_offset:I,u_data_scale:[255*A[0],255*A[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Af,Af]}),fx=(g,o,h,_,v,S,T,I,A,L)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_velocity:h,u_velocity_res:_,u_max_speed:v,u_speed_factor:S,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*A[0],255*A[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Af,Af]}),Hw=a.bB(),Ww=(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe,de,_e,Ee,xe,Re,Te,De)=>{const Pe=v.transform,Ie={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Pe.getCameraToCenterDistance(_e),u_rotate_symbol:+h,u_aspect_ratio:Pe.width/Pe.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+L,u_elevation_from_sea:A?1:0,u_pitch_with_map:+_,u_texsize:F,u_texsize_icon:H,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hw,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Hw,u_up_vector:[0,-1,0],u_color_adj_mat:Re,u_icon_transition:Te||0,u_gamma_scale:_?v.transform.getCameraToCenterDistance(_e)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:a.o.devicePixelRatio,u_is_halo:1,u_scale_factor:De||1,u_ground_shadow_factor:Ee,u_inv_matrix:a.bk(a.bB(),T),u_normal_scale:xe,u_lutTexture:oo.LUT};return _e.name==="globe"&&(Ie.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],Ie.u_zoom_transition=te,Ie.u_inv_rot_matrix=fe,Ie.u_merc_center=se,Ie.u_camera_forward=Pe._camera.forward(),Ie.u_ecef_origin=a.dU(Pe.globeMatrix,Y.toUnwrapped()),Ie.u_tile_matrix=Float32Array.from(Pe.globeMatrix),Ie.u_up_vector=de),Ie},px=(g,o,h,_)=>({u_matrix:g,u_emissive_strength:o,u_opacity:h,u_color:_}),mx=(g,o,h,_,v,S,T,I,A)=>Object.assign(function(L,F,H,U,Y,te){const{width:se,height:fe}=U.imageManager.getPixelSize(F),de=Math.pow(2,te.tileID.overscaledZ),_e=te.tileSize*Math.pow(2,U.transform.tileZoom)/de,Ee=_e*(te.tileID.canonical.x+te.tileID.wrap*de),xe=_e*te.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[se,fe],u_pattern_size:H.displaySize,u_pattern_units_to_pixels:Y?[U.transform.width,-1*U.transform.height]:[1/a.ay(te,1,U.transform.tileZoom),1/a.ay(te,1,U.transform.tileZoom)],u_pixel_coord_upper:[Ee>>16,xe>>16],u_pixel_coord_lower:[65535&Ee,65535&xe]}}(0,S,T,_,I,A),{u_matrix:g,u_emissive_strength:o,u_opacity:h}),Zw=new Float32Array(a.bz([])),gx=(g,o,h,_,v,S,T,I,A,L,F,H,U,Y=[0,0,0],te,se,fe)=>{const de=v.style.light,_e=de.properties.get("position"),Ee=[-_e.x,-_e.y,_e.z],xe=a.dN();de.properties.get("anchor")==="viewport"&&(a.dO(xe,-v.transform.angle),a.dP(Ee,Ee,xe));const Re=F.alphaMode==="MASK",Te=de.properties.get("color").toNonPremultipliedRenderColor(null),De=U.paint.get("model-ambient-occlusion-intensity"),Pe=U.paint.get("model-color").constantOr(a.ao.white).toNonPremultipliedRenderColor(null);return Pe.a=U.paint.get("model-color-mix-intensity").constantOr(0),fe&&(Pe.r=fe[0],Pe.g=fe[1],Pe.b=fe[2],Pe.a=fe[3]),se&&(Pe.r=se.color.r,Pe.g=se.color.g,Pe.b=se.color.b,Pe.a=se.colorMix,H=se.emissionStrength,S=se.opacity),{u_matrix:g,u_lighting_matrix:o,u_normal_matrix:h,u_node_matrix:_||Zw,u_lightpos:Ee,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[Te.r,Te.g,Te.b],u_camera_pos:Y,u_opacity:S,u_baseTextureIsAlpha:0,u_alphaMask:+Re,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:L,u_baseColorTexture:oo.BaseColor,u_metallicRoughnessTexture:oo.MetallicRoughness,u_normalTexture:oo.Normal,u_occlusionTexture:oo.Occlusion,u_emissionTexture:oo.Emission,u_lutTexture:oo.LUT,u_color_mix:Pe.toArray01(),u_aoIntensity:De,u_emissive_strength:H,u_occlusionTextureTransform:te||[0,0,0,0]}},Yp=(g,o=Zw,h=Zw)=>({u_matrix:g,u_instance:o,u_node_matrix:h}),KA={fillExtrusion:g=>({u_matrix:new a.ck(g),u_lightpos:new a.ch(g),u_lightintensity:new a.ci(g),u_lightcolor:new a.ch(g),u_vertical_gradient:new a.ci(g),u_opacity:new a.ci(g),u_edge_radius:new a.ci(g),u_width_scale:new a.ci(g),u_ao:new a.cj(g),u_height_type:new a.cg(g),u_base_type:new a.cg(g),u_tile_id:new a.ch(g),u_zoom_transition:new a.ci(g),u_inv_rot_matrix:new a.ck(g),u_merc_center:new a.cj(g),u_up_dir:new a.ch(g),u_height_lift:new a.ci(g),u_flood_light_color:new a.ch(g),u_vertical_scale:new a.ci(g),u_flood_light_intensity:new a.ci(g),u_ground_shadow_factor:new a.ch(g)}),fillExtrusionDepth:g=>({u_matrix:new a.ck(g),u_edge_radius:new a.ci(g),u_width_scale:new a.ci(g),u_vertical_scale:new a.ci(g),u_height_type:new a.cg(g),u_base_type:new a.cg(g)}),fillExtrusionPattern:g=>({u_matrix:new a.ck(g),u_lightpos:new a.ch(g),u_lightintensity:new a.ci(g),u_lightcolor:new a.ch(g),u_vertical_gradient:new a.ci(g),u_height_factor:new a.ci(g),u_edge_radius:new a.ci(g),u_width_scale:new a.ci(g),u_ao:new a.cj(g),u_height_type:new a.cg(g),u_base_type:new a.cg(g),u_tile_id:new a.ch(g),u_zoom_transition:new a.ci(g),u_inv_rot_matrix:new a.ck(g),u_merc_center:new a.cj(g),u_up_dir:new a.ch(g),u_height_lift:new a.ci(g),u_image:new a.cg(g),u_texsize:new a.cj(g),u_pixel_coord_upper:new a.cj(g),u_pixel_coord_lower:new a.cj(g),u_tile_units_to_pixels:new a.ci(g),u_opacity:new a.ci(g),u_pattern_transition:new a.ci(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new a.ck(g),u_opacity:new a.ci(g),u_ao_pass:new a.ci(g),u_meter_to_tile:new a.ci(g),u_ao:new a.cj(g),u_flood_light_intensity:new a.ci(g),u_flood_light_color:new a.ch(g),u_attenuation:new a.ci(g),u_edge_radius:new a.ci(g),u_fb:new a.cg(g),u_fb_size:new a.ci(g),u_dynamic_offset:new a.ci(g)}),fill:g=>({u_matrix:new a.ck(g),u_emissive_strength:new a.ci(g),u_ground_shadow_factor:new a.ch(g)}),fillPattern:g=>({u_matrix:new a.ck(g),u_emissive_strength:new a.ci(g),u_image:new a.cg(g),u_texsize:new a.cj(g),u_pixel_coord_upper:new a.cj(g),u_pixel_coord_lower:new a.cj(g),u_tile_units_to_pixels:new a.ci(g),u_ground_shadow_factor:new a.ch(g),u_pattern_transition:new a.ci(g)}),fillOutline:g=>({u_matrix:new a.ck(g),u_emissive_strength:new a.ci(g),u_world:new a.cj(g),u_ground_shadow_factor:new a.ch(g)}),fillOutlinePattern:g=>({u_matrix:new a.ck(g),u_emissive_strength:new a.ci(g),u_world:new a.cj(g),u_image:new a.cg(g),u_texsize:new a.cj(g),u_pixel_coord_upper:new a.cj(g),u_pixel_coord_lower:new a.cj(g),u_tile_units_to_pixels:new a.ci(g),u_ground_shadow_factor:new a.ch(g),u_pattern_transition:new a.ci(g)}),building:g=>({u_matrix:new a.ck(g),u_normal_matrix:new a.ck(g),u_opacity:new a.ci(g),u_faux_facade_ao_intensity:new a.ci(g),u_camera_pos:new a.ch(g),u_tile_to_meter:new a.ci(g),u_facade_emissive_chance:new a.ci(g),u_flood_light_color:new a.ch(g),u_flood_light_intensity:new a.ci(g)}),buildingBloom:g=>({u_matrix:new a.ck(g)}),buildingDepth:g=>({u_matrix:new a.ck(g)}),elevatedStructuresDepth:g=>({u_matrix:new a.ck(g),u_depth_bias:new a.ci(g)}),elevatedStructures:g=>({u_matrix:new a.ck(g),u_ground_shadow_factor:new a.ch(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new a.ck(g),u_camera_pos:new a.ch(g),u_depth_bias:new a.ci(g),u_height_scale:new a.ci(g),u_reset_depth:new a.ci(g)}),circle:a.dX,collisionBox:g=>({u_matrix:new a.ck(g),u_inv_rot_matrix:new a.ck(g),u_camera_to_center_distance:new a.ci(g),u_extrude_scale:new a.cj(g),u_zoom_transition:new a.ci(g),u_merc_center:new a.cj(g),u_tile_id:new a.ch(g)}),collisionCircle:g=>({u_matrix:new a.ck(g),u_inv_matrix:new a.ck(g),u_camera_to_center_distance:new a.ci(g),u_viewport_size:new a.cj(g)}),debug:g=>({u_color:new a.dA(g),u_matrix:new a.ck(g),u_overlay:new a.cg(g),u_overlay_scale:new a.ci(g)}),clippingMask:g=>({u_matrix:new a.ck(g)}),heatmap:g=>({u_extrude_scale:new a.ci(g),u_intensity:new a.ci(g),u_matrix:new a.ck(g),u_inv_rot_matrix:new a.ck(g),u_merc_center:new a.cj(g),u_tile_id:new a.ch(g),u_zoom_transition:new a.ci(g),u_up_dir:new a.ch(g)}),heatmapTexture:g=>({u_image:new a.cg(g),u_color_ramp:new a.cg(g),u_opacity:new a.ci(g)}),hillshade:g=>({u_matrix:new a.ck(g),u_image:new a.cg(g),u_latrange:new a.cj(g),u_light:new a.cj(g),u_shadow:new a.dA(g),u_highlight:new a.dA(g),u_emissive_strength:new a.ci(g),u_accent:new a.dA(g)}),hillshadePrepare:g=>({u_matrix:new a.ck(g),u_image:new a.cg(g),u_dimension:new a.cj(g),u_zoom:new a.ci(g)}),line:a.dW,linePattern:a.dV,raster:g=>({u_matrix:new a.ck(g),u_normalize_matrix:new a.ck(g),u_globe_matrix:new a.ck(g),u_merc_matrix:new a.ck(g),u_grid_matrix:new a.dB(g),u_tl_parent:new a.cj(g),u_scale_parent:new a.ci(g),u_fade_t:new a.ci(g),u_opacity:new a.ci(g),u_image0:new a.cg(g),u_image1:new a.cg(g),u_brightness_low:new a.ci(g),u_brightness_high:new a.ci(g),u_saturation_factor:new a.ci(g),u_contrast_factor:new a.ci(g),u_spin_weights:new a.ch(g),u_perspective_transform:new a.cj(g),u_raster_elevation:new a.ci(g),u_zoom_transition:new a.ci(g),u_merc_center:new a.cj(g),u_cutoff_params:new a.d2(g),u_colorization_mix:new a.d2(g),u_colorization_offset:new a.ci(g),u_color_ramp:new a.cg(g),u_texture_offset:new a.cj(g),u_texture_res:new a.cj(g),u_emissive_strength:new a.ci(g)}),rasterParticle:g=>({u_matrix:new a.ck(g),u_normalize_matrix:new a.ck(g),u_globe_matrix:new a.ck(g),u_merc_matrix:new a.ck(g),u_grid_matrix:new a.dB(g),u_tl_parent:new a.cj(g),u_scale_parent:new a.ci(g),u_fade_t:new a.ci(g),u_opacity:new a.ci(g),u_image0:new a.cg(g),u_image1:new a.cg(g),u_raster_elevation:new a.ci(g),u_zoom_transition:new a.ci(g),u_merc_center:new a.cj(g),u_cutoff_params:new a.d2(g)}),rasterParticleTexture:g=>({u_texture:new a.cg(g),u_opacity:new a.ci(g)}),rasterParticleDraw:g=>({u_particle_texture:new a.cg(g),u_particle_texture_side_len:new a.ci(g),u_tile_offset:new a.cj(g),u_velocity:new a.cg(g),u_color_ramp:new a.cg(g),u_velocity_res:new a.cj(g),u_max_speed:new a.ci(g),u_uv_offset:new a.cj(g),u_data_scale:new a.cj(g),u_data_offset:new a.ci(g),u_particle_pos_scale:new a.ci(g),u_particle_pos_offset:new a.cj(g)}),rasterParticleUpdate:g=>({u_particle_texture:new a.cg(g),u_particle_texture_side_len:new a.ci(g),u_velocity:new a.cg(g),u_velocity_res:new a.cj(g),u_max_speed:new a.ci(g),u_speed_factor:new a.ci(g),u_reset_rate:new a.ci(g),u_rand_seed:new a.ci(g),u_uv_offset:new a.cj(g),u_data_scale:new a.cj(g),u_data_offset:new a.ci(g),u_particle_pos_scale:new a.ci(g),u_particle_pos_offset:new a.cj(g)}),symbol:g=>({u_is_size_zoom_constant:new a.cg(g),u_is_size_feature_constant:new a.cg(g),u_size_t:new a.ci(g),u_size:new a.ci(g),u_camera_to_center_distance:new a.ci(g),u_rotate_symbol:new a.cg(g),u_aspect_ratio:new a.ci(g),u_fade_change:new a.ci(g),u_matrix:new a.ck(g),u_label_plane_matrix:new a.ck(g),u_coord_matrix:new a.ck(g),u_is_text:new a.cg(g),u_elevation_from_sea:new a.cg(g),u_pitch_with_map:new a.cg(g),u_texsize:new a.cj(g),u_texsize_icon:new a.cj(g),u_texture:new a.cg(g),u_texture_icon:new a.cg(g),u_gamma_scale:new a.ci(g),u_device_pixel_ratio:new a.ci(g),u_tile_id:new a.ch(g),u_zoom_transition:new a.ci(g),u_inv_rot_matrix:new a.ck(g),u_merc_center:new a.cj(g),u_camera_forward:new a.ch(g),u_tile_matrix:new a.ck(g),u_up_vector:new a.ch(g),u_ecef_origin:new a.ch(g),u_is_halo:new a.cg(g),u_icon_transition:new a.ci(g),u_color_adj_mat:new a.ck(g),u_scale_factor:new a.ci(g),u_ground_shadow_factor:new a.ch(g),u_inv_matrix:new a.ck(g),u_normal_scale:new a.ci(g),u_lutTexture:new a.cg(g)}),background:g=>({u_matrix:new a.ck(g),u_emissive_strength:new a.ci(g),u_opacity:new a.ci(g),u_color:new a.dA(g)}),backgroundPattern:g=>({u_matrix:new a.ck(g),u_emissive_strength:new a.ci(g),u_opacity:new a.ci(g),u_image:new a.cg(g),u_pattern_tl:new a.cj(g),u_pattern_br:new a.cj(g),u_texsize:new a.cj(g),u_pattern_size:new a.cj(g),u_pixel_coord_upper:new a.cj(g),u_pixel_coord_lower:new a.cj(g),u_pattern_units_to_pixels:new a.cj(g)}),terrainRaster:g=>({u_matrix:new a.ck(g),u_image0:new a.cg(g),u_skirt_height:new a.ci(g),u_ground_shadow_factor:new a.ch(g)}),skybox:g=>({u_matrix:new a.ck(g),u_sun_direction:new a.ch(g),u_cubemap:new a.cg(g),u_opacity:new a.ci(g),u_temporal_offset:new a.ci(g)}),skyboxGradient:g=>({u_matrix:new a.ck(g),u_color_ramp:new a.cg(g),u_center_direction:new a.ch(g),u_radius:new a.ci(g),u_opacity:new a.ci(g),u_temporal_offset:new a.ci(g)}),skyboxCapture:g=>({u_matrix_3f:new a.dB(g),u_sun_direction:new a.ch(g),u_sun_intensity:new a.ci(g),u_color_tint_r:new a.d2(g),u_color_tint_m:new a.d2(g),u_luminance:new a.ci(g)}),globeRaster:g=>({u_proj_matrix:new a.ck(g),u_globe_matrix:new a.ck(g),u_normalize_matrix:new a.ck(g),u_merc_matrix:new a.ck(g),u_zoom_transition:new a.ci(g),u_merc_center:new a.cj(g),u_image0:new a.cg(g),u_grid_matrix:new a.dB(g),u_skirt_height:new a.ci(g),u_far_z_cutoff:new a.ci(g),u_frustum_tl:new a.ch(g),u_frustum_tr:new a.ch(g),u_frustum_br:new a.ch(g),u_frustum_bl:new a.ch(g),u_globe_pos:new a.ch(g),u_globe_radius:new a.ci(g),u_viewport:new a.cj(g)}),globeAtmosphere:g=>({u_frustum_tl:new a.ch(g),u_frustum_tr:new a.ch(g),u_frustum_br:new a.ch(g),u_frustum_bl:new a.ch(g),u_horizon:new a.ci(g),u_transition:new a.ci(g),u_fadeout_range:new a.ci(g),u_atmosphere_fog_color:new a.d2(g),u_high_color:new a.d2(g),u_space_color:new a.d2(g),u_temporal_offset:new a.ci(g),u_horizon_angle:new a.ci(g)}),model:g=>({u_matrix:new a.ck(g),u_lighting_matrix:new a.ck(g),u_normal_matrix:new a.ck(g),u_node_matrix:new a.ck(g),u_lightpos:new a.ch(g),u_lightintensity:new a.ci(g),u_lightcolor:new a.ch(g),u_camera_pos:new a.ch(g),u_opacity:new a.ci(g),u_baseColorFactor:new a.d2(g),u_emissiveFactor:new a.d2(g),u_metallicFactor:new a.ci(g),u_roughnessFactor:new a.ci(g),u_baseTextureIsAlpha:new a.cg(g),u_alphaMask:new a.cg(g),u_alphaCutoff:new a.ci(g),u_baseColorTexture:new a.cg(g),u_metallicRoughnessTexture:new a.cg(g),u_normalTexture:new a.cg(g),u_occlusionTexture:new a.cg(g),u_emissionTexture:new a.cg(g),u_lutTexture:new a.cg(g),u_color_mix:new a.d2(g),u_aoIntensity:new a.ci(g),u_emissive_strength:new a.ci(g),u_occlusionTextureTransform:new a.d2(g)}),modelDepth:g=>({u_matrix:new a.ck(g),u_instance:new a.ck(g),u_node_matrix:new a.ck(g)}),groundShadow:g=>({u_matrix:new a.ck(g),u_ground_shadow_factor:new a.ch(g)}),stars:g=>({u_matrix:new a.ck(g),u_up:new a.ch(g),u_right:new a.ch(g),u_intensity_multiplier:new a.ci(g)}),snowParticle:g=>({u_modelview:new a.ck(g),u_projection:new a.ck(g),u_time:new a.ci(g),u_cam_pos:new a.ch(g),u_velocityConeAperture:new a.ci(g),u_velocity:new a.ci(g),u_horizontalOscillationRadius:new a.ci(g),u_horizontalOscillationRate:new a.ci(g),u_boxSize:new a.ci(g),u_billboardSize:new a.ci(g),u_simpleShapeParameters:new a.cj(g),u_screenSize:new a.cj(g),u_thinningCenterPos:new a.cj(g),u_thinningShape:new a.ch(g),u_thinningAffectedRatio:new a.ci(g),u_thinningParticleOffset:new a.ci(g),u_particleColor:new a.d2(g),u_direction:new a.ch(g)}),rainParticle:g=>({u_modelview:new a.ck(g),u_projection:new a.ck(g),u_time:new a.ci(g),u_cam_pos:new a.ch(g),u_texScreen:new a.cg(g),u_velocityConeAperture:new a.ci(g),u_velocity:new a.ci(g),u_boxSize:new a.ci(g),u_rainDropletSize:new a.cj(g),u_distortionStrength:new a.ci(g),u_rainDirection:new a.ch(g),u_color:new a.d2(g),u_screenSize:new a.cj(g),u_thinningCenterPos:new a.cj(g),u_thinningShape:new a.ch(g),u_thinningAffectedRatio:new a.ci(g),u_thinningParticleOffset:new a.ci(g),u_shapeDirectionalPower:new a.ci(g),u_shapeNormalPower:new a.ci(g),u_mode:new a.ci(g)}),vignette:g=>({u_vignetteShape:new a.ch(g),u_vignetteColor:new a.d2(g)}),occlusion:g=>({u_matrix:new a.ck(g),u_anchorPos:new a.ch(g),u_screenSizePx:new a.cj(g),u_occluderSizePx:new a.cj(g),u_color:new a.d2(g)})};class jh{constructor(o,h,_,v){this.id=jh.uniqueIdxCounter,jh.uniqueIdxCounter++,this.context=o;const S=o.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||v||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=jh.uniqueIdxCounter,jh.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}jh.uniqueIdxCounter=0;const ET={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class XA{constructor(o,h,_,v,S,T){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=T,this.context=o;const I=o.gl;this.buffer=I.createBuffer(),o.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||S||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let _=0;_<this.attributes.length;_++){const v=h.getAttributeLocation(o,this.attributes[_].name);v!==-1&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,h,_){for(let v=0;v<this.attributes.length;v++){const S=this.attributes[v],T=h.getAttributeLocation(o,S.name);T!==-1&&o.vertexAttribPointer(T,S.components,o[ET[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(o,h,_){for(let v=0;v<this.attributes.length;v++){const S=h.getAttributeLocation(o,this.attributes[v].name);S!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(S,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _x{constructor(o,h,_,v,S){this.context=o,this.width=h,this.height=_;const T=this.framebuffer=o.gl.createFramebuffer();v&&(this.colorAttachment=new qA(o,T)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new mT(o,T):new GA(o,T))}destroy(){const o=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&o.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&o.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&o.deleteTexture(h)}o.deleteFramebuffer(this.framebuffer)}}class yx{constructor(o,h){this.gl=o,this.clearColor=new oT(this),this.clearDepth=new Aw(this),this.clearStencil=new FA(this),this.colorMask=new zA(this),this.depthMask=new BA(this),this.stencilMask=new VA(this),this.stencilFunc=new lT(this),this.stencilOp=new UA(this),this.stencilTest=new Jy(this),this.depthRange=new $A(this),this.depthTest=new cT(this),this.depthFunc=new Pw(this),this.blend=new Qy(this),this.blendFunc=new kw(this),this.blendColor=new Nf(this),this.blendEquation=new qp(this),this.cullFace=new Kg(this),this.cullFaceSide=new Gp(this),this.frontFace=new uT(this),this.program=new Rw(this),this.activeTexture=new dT(this),this.viewport=new Hp(this),this.bindFramebuffer=new ex(this),this.bindRenderbuffer=new tx(this),this.bindTexture=new Mw(this),this.bindVertexBuffer=new rx(this),this.bindElementBuffer=new Xg(this),this.bindVertexArrayOES=new hT(this),this.pixelStoreUnpack=new fT(this),this.pixelStoreUnpackPremultiplyAlpha=new pT(this),this.pixelStoreUnpackFlipY=new Wp(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h,_){return new jh(this,o,h,_)}createVertexBuffer(o,h,_,v,S){return new XA(this,o,h,_,v,S)}createRenderbuffer(o,h,_){const v=this.gl,S=v.createRenderbuffer();return this.bindRenderbuffer.set(S),v.renderbufferStorage(v.RENDERBUFFER,o,h,_),this.bindRenderbuffer.set(null),S}createFramebuffer(o,h,_,v){return new _x(this,o,h,_,v)}clear({color:o,depth:h,stencil:_,colorMask:v}){const S=this.gl;let T=0;o&&(T|=S.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(T|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(T|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),S.clear(T)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){a.bx(o.blendFunction,vn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Wu;function r_(g,o,h,_,v,S,T){const I=g.context,A=I.gl,L=g.transform,F=[a.aF(L.center.lng),a.aJ(L.center.lat)],H=h.layout.get("symbol-placement"),U=h.layout.get("text-variable-anchor"),Y=h.layout.get("icon-rotation-alignment")==="map",te=h.layout.get("text-rotation-alignment")==="map",se=H!=="point",fe=[];let de=0,_e=0;for(let Ie=0;Ie<_.length;Ie++){const Oe=_[Ie],et=o.getTile(Oe),Ke=et.getBucket(h);if(!Ke)continue;const pt=Ke.getProjection().createInversionMatrix(L,Oe.canonical),ot=[],vt=Vg(Oe,Ke,L),qt=!T&&Y&&se,nt=T&&te&&se,Ue=U&&Ke.hasTextData(),wt=Ke.hasIconTextFit()&&Ue&&Ke.hasIconData(),lt=qt||nt||T&&Ue||wt,Pt=Ke.projection.name==="globe",Kt=Pt?a.aj(L.zoom):0;Pt&&(ot.push("PROJECTION_GLOBE_VIEW"),lt&&ot.push("PROJECTED_POS_ON_VIEWPORT"));const gr=g.getOrCreateProgram("collisionBox",{defines:ot});let Ut=vt;v[0]===0&&v[1]===0||(Ut=g.translatePosMatrix(vt,et,v,S));const Ht=T?Ke.textCollisionBox:Ke.iconCollisionBox,yr=Ke.collisionCircleArray;if(yr.length>0){const sr=a.bB(),cr=Ut;a.cO(sr,Ke.placementInvProjMatrix,L.glCoordMatrix),a.cO(sr,sr,Ke.placementViewportMatrix),fe.push({circleArray:yr,circleOffset:_e,transform:cr,invTransform:sr,projection:Ke.getProjection()}),de+=yr.length/4,_e=de}if(!Ht)continue;g.terrain&&g.terrain.setupElevationDraw(et,gr);const lr=Pt?[Oe.canonical.x,Oe.canonical.y,1<<Oe.canonical.z]:[0,0,0];gr.draw(g,A.LINES,wr.disabled,en.disabled,g.colorModeForRenderPass(),Xr.disabled,Xp(Ut,pt,L,Kt,F,et,lr,Ke.getProjection()),h.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Ht.segments,null,L.zoom,null,[Ht.collisionVertexBuffer,Ht.collisionVertexBufferExt])}if(!T||!fe.length)return;const Ee=g.getOrCreateProgram("collisionCircle"),xe=new a.dY;xe.resize(4*de),xe._trim();let Re=0;for(const Ie of fe)for(let Oe=0;Oe<Ie.circleArray.length/4;Oe++){const et=4*Oe,Ke=Ie.circleArray[et+0],pt=Ie.circleArray[et+1],ot=Ie.circleArray[et+2],vt=Ie.circleArray[et+3];xe.emplace(Re++,Ke,pt,ot,vt,0),xe.emplace(Re++,Ke,pt,ot,vt,1),xe.emplace(Re++,Ke,pt,ot,vt,2),xe.emplace(Re++,Ke,pt,ot,vt,3)}(!Wu||Wu.length<2*de)&&(Wu=function(Ie){const Oe=2*Ie,et=new a.b0;et.resize(Oe),et._trim();for(let Ke=0;Ke<Oe;Ke++){const pt=6*Ke;et.uint16[pt+0]=4*Ke+0,et.uint16[pt+1]=4*Ke+1,et.uint16[pt+2]=4*Ke+2,et.uint16[pt+3]=4*Ke+2,et.uint16[pt+4]=4*Ke+3,et.uint16[pt+5]=4*Ke+0}return et}(de));const Te=I.createIndexBuffer(Wu,!0),De=I.createVertexBuffer(xe,a.dZ.members,!0);for(const Ie of fe){const Oe={u_matrix:Ie.transform,u_inv_matrix:Ie.invTransform,u_camera_to_center_distance:(Pe=L).getCameraToCenterDistance(Ie.projection),u_viewport_size:[Pe.width,Pe.height]};Ee.draw(g,A.TRIANGLES,wr.disabled,en.disabled,g.colorModeForRenderPass(),Xr.disabled,Oe,h.id,De,Te,a.bf.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,L.zoom)}var Pe;De.destroy(),Te.destroy()}const Nh=a.bB();function Kw(g){const o=g._camera.getWorldToCamera(g.worldSize,1),h=a.aB([],o,g.globeMatrix);a.bk(h,h);const _=[0,0,0],v=[0,1,0,0];return a.aC(v,v,h),_[0]=v[0],_[1]=v[1],_[2]=v[2],a.aw(_,_),_}function xx({width:g,height:o,anchor:h,textOffset:_,textScale:v},S){const{horizontalAlign:T,verticalAlign:I}=a.c0(h),A=-(T-.5)*g,L=-(I-.5)*o,F=a.c1(h,_);return new a.P((A/v+F[0])*S,(L/v+F[1])*S)}function vx(g,o,h,_,v,S,T,I,A,L){const F=g.text.placedSymbolArray,H=g.text.dynamicLayoutVertexArray,U=g.icon.dynamicLayoutVertexArray,Y={},te=g.getProjection(),se=Sf(T,te,v),fe=v.elevation,de=te.upVectorScale(T.canonical,v.center.lat,v.worldSize).metersToTile;H.clear();for(let _e=0;_e<F.length;_e++){const Ee=F.get(_e),{tileAnchorX:xe,tileAnchorY:Re,numGlyphs:Te}=Ee,De=Ee.hidden||!Ee.crossTileID||g.allowVerticalPlacement&&!Ee.placedOrientation?null:_[Ee.crossTileID];if(De){let Pe=0,Ie=0,Oe=0;const et=g.elevationType==="road";if(fe||et){const lt=et?g.getElevationFeatureForText(_e):null,Pt=a.bU.getAtTileOffset(T,new a.P(xe,Re),fe,lt),[Kt,gr,Ut]=te.upVector(T.canonical,xe,Re);Pe=Pt*Kt*de,Ie=Pt*gr*de,Oe=Pt*Ut*de}let[Ke,pt,ot,vt]=Yi(Ee.projectedAnchorX+Pe,Ee.projectedAnchorY+Ie,Ee.projectedAnchorZ+Oe,h?se:S);const qt=yh(v.getCameraToCenterDistance(te),vt);let nt=a.bL(g.textSizeData,A,Ee)*qt/a.bX;h&&(nt*=g.tilePixelRatio/I);const Ue=xx(De,nt);h?({x:Ke,y:pt,z:ot}=te.projectTilePoint(xe+Ue.x,Re+Ue.y,T.canonical),[Ke,pt,ot]=Yi(Ke+Pe,pt+Ie,ot+Oe,S)):(o&&Ue._rotate(-v.angle),Ke+=Ue.x,pt+=Ue.y,ot=0);const wt=g.allowVerticalPlacement&&Ee.placedOrientation===a.bK.vertical?Math.PI/2:0;for(let lt=0;lt<Te;lt++)a.bN(H,Ke,pt,ot,wt);L&&Ee.associatedIconIndex>=0&&(Y[Ee.associatedIconIndex]={x:Ke,y:pt,z:ot,angle:wt})}else rc(Te,H)}if(L){U.clear();const _e=g.icon.placedSymbolArray;for(let Ee=0;Ee<_e.length;Ee++){const xe=_e.get(Ee),{numGlyphs:Re}=xe,Te=Y[Ee];if(xe.hidden||!Te)rc(Re,U);else{const{x:De,y:Pe,z:Ie,angle:Oe}=Te;for(let et=0;et<Re;et++)a.bN(U,De,Pe,Ie,Oe)}}g.icon.dynamicLayoutVertexBuffer.updateData(U)}g.text.dynamicLayoutVertexBuffer.updateData(H)}function n_(g,o,h,_,v,S,T={}){const I=h.paint.get("icon-translate"),A=h.paint.get("text-translate"),L=h.paint.get("icon-translate-anchor"),F=h.paint.get("text-translate-anchor"),H=h.layout.get("icon-rotation-alignment"),U=h.layout.get("text-rotation-alignment"),Y=h.layout.get("icon-pitch-alignment"),te=h.layout.get("text-pitch-alignment"),se=h.layout.get("icon-keep-upright"),fe=h.layout.get("text-keep-upright"),de=h.paint.get("icon-color-saturation"),_e=h.paint.get("icon-color-contrast"),Ee=h.paint.get("icon-color-brightness-min"),xe=h.paint.get("icon-color-brightness-max"),Re=h.layout.get("symbol-elevation-reference")==="sea",Te=h.layout.get("icon-image-use-theme")==="none",De=g.context,Pe=De.gl,Ie=g.transform,Oe=H==="map",et=U==="map",Ke=Y==="map",pt=te==="map",ot=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let vt=!1;const qt=g.depthModeForSublayer(0,wr.ReadOnly),nt=new wr(g.context.gl.LEQUAL,wr.ReadOnly,g.depthRangeFor3D),Ue=[a.aF(Ie.center.lng),a.aJ(Ie.center.lat)],wt=h.layout.get("text-variable-anchor"),lt=Ie.projection.name==="globe",Pt=[],Kt=[0,-1,0];for(const gr of _){const Ut=o.getTile(gr),Ht=Ut.getBucket(h);if(!Ht||Ht.projection.name==="mercator"&&lt||Ht.fullyClipped)continue;const yr=Ht.projection.name==="globe",lr=yr?a.aj(Ie.zoom):0,sr=Sf(gr,Ht.getProjection(),Ie),cr=Ie.calculatePixelsToTileUnitsMatrix(Ut),Lr=wt&&Ht.hasTextData(),Cn=Ht.hasIconTextFit()&&Lr&&Ht.hasIconData(),Un=Ht.getProjection().createInversionMatrix(Ie,gr.canonical),Is=(1<<Ut.tileID.canonical.z)*a.al/g.transform.worldSize,Yr=ps=>{let Jr=[0,0,0];if(ps){const Gn=g.style.directionalLight,pi=g.style.ambientLight;Gn&&pi&&(Jr=Lc(g.style,Gn,pi))}return Jr},Bn=ps=>{Ie.depthOcclusionForSymbolsAndCircles&&(h.hasOcclusionOpacityProperties||g.terrain)&&(ps.push("DEPTH_D24"),ps.push("DEPTH_OCCLUSION"))},pn=ps=>{h.lut&&!Te&&(h.lut.texture||(h.lut.texture=new a.d_(g.context,h.lut.image,[h.lut.image.height,h.lut.image.height,h.lut.image.height],De.gl.RGBA8)),De.activeTexture.set(De.gl.TEXTURE0+oo.LUT),h.lut.texture&&h.lut.texture.bind(De.gl.LINEAR,De.gl.CLAMP_TO_EDGE),ps.push("APPLY_LUT_ON_GPU"))},Ss=()=>{const ps=Oe&&h.layout.get("symbol-placement")!=="point",Jr=[];Bn(Jr),pn(Jr);const Gn=ps||Cn,pi=Ht.elevationType==="road",Vi=g.shadowRenderer,vi=pi&&Ke&&!!Vi&&Vi.enabled,ki=Yr(vi),vl=pi&&Ke&&!g.terrain?nt:qt,nl=h.paint.get("icon-image-cross-fade");g.terrainRenderModeElevated()&&Ke&&Jr.push("PITCH_WITH_MAP_TERRAIN"),yr&&(Jr.push("PROJECTION_GLOBE_VIEW"),Gn&&Jr.push("PROJECTED_POS_ON_VIEWPORT")),nl>0&&Ht.hasAnySecondaryIcon&&Jr.push("ICON_TRANSITION"),!Ht.icon.zOffsetVertexBuffer||pi&&g.terrain||Jr.push("Z_OFFSET"),de===0&&_e===0&&Ee===0&&xe===1||Jr.push("COLOR_ADJUSTMENT"),Ht.sdfIcons&&Jr.push("RENDER_SDF"),vi&&Jr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),pi&&Ke&&!g.terrain&&Ht.icon.orientationVertexBuffer&&Jr.push("ELEVATED_ROADS");const yo=Ht.icon.programConfigurations.get(h.id),No=g.getOrCreateProgram("symbol",{config:yo,defines:Jr}),oc=Ut.imageAtlasTexture?Ut.imageAtlasTexture.size:[0,0],xo=Ht.iconSizeData,lc=a.bJ(xo,Ie.zoom),$c=Ke||!Ie.isOrthographic,Ua=_h(sr,Ut.tileID.canonical,Ke,Oe,Ie,Ht.getProjection(),cr),Ei=Oc(sr,Ut.tileID.canonical,Ke,Oe,Ie,Ht.getProjection(),cr),Ui=g.translatePosMatrix(Ei,Ut,I,L,!0),Os=g.translatePosMatrix(sr,Ut,I,L),Gi=Gn?Nh:Ua,$a=Oe&&!Ke&&!ps;let Ti=Kt;!lt&&!Ie.mercatorFromTransition||Oe||(Ti=Kw(Ie));const cc=yr?Ti:Kt,hm=h.getColorAdjustmentMatrix(de,_e,Ee,xe),Id=Ww(xo.kind,lc,$a,Ke,g,Os,Gi,Ui,Re,!1,oc,[0,0],0,gr,lr,Ue,Un,cc,Ht.getProjection(),ki,Is,hm,nl,null),fm=Ut.imageAtlasTexture?Ut.imageAtlasTexture:null,pm=h.layout.get("icon-size").constantOr(0)!==1||Ht.iconsNeedLinear,uc=Ht.sdfIcons||g.options.rotating||g.options.zooming||pm||$c?Pe.LINEAR:Pe.NEAREST,Ku=Ht.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,Oa=g.terrain&&Ke&&ps?a.bk(a.bB(),Ua):Nh;if(ps&&Ht.icon){const dc=a.bU.getAtTileOffsetFunc(gr,Ie.center.lat,Ie.worldSize,Ht.getProjection()),Lf=_u(sr,Ut.tileID.canonical,Ke,Oe,Ie,Ht.getProjection(),cr),ZT=h.layout.get("icon-size-scale-range"),Vx=a.aA(g.scaleFactor,ZT[0],ZT[1]);xh(Ht,sr,g,!1,Lf,Ei,Ke,se,dc,gr,Vx)}return{program:No,buffers:Ht.icon,uniformValues:Id,atlasTexture:fm,atlasTextureIcon:null,atlasInterpolation:uc,atlasInterpolationIcon:null,isSDF:Ht.sdfIcons,hasHalo:Ku,depthMode:vl,tile:Ut,renderWithShadows:vi,labelPlaneMatrixInv:Oa}},$n=()=>{const ps=et&&h.layout.get("symbol-placement")!=="point",Jr=[],Gn=ps||wt||Cn,pi=Ht.elevationType==="road",Vi=g.shadowRenderer,vi=pi&&pt&&!!Vi&&Vi.enabled,ki=Yr(vi),vl=pi&&pt&&!g.terrain?nt:qt;g.terrainRenderModeElevated()&&pt&&Jr.push("PITCH_WITH_MAP_TERRAIN"),yr&&(Jr.push("PROJECTION_GLOBE_VIEW"),Gn&&Jr.push("PROJECTED_POS_ON_VIEWPORT")),!Ht.text.zOffsetVertexBuffer||pi&&g.terrain||Jr.push("Z_OFFSET"),Ht.iconsInText&&Jr.push("RENDER_TEXT_AND_SYMBOL"),Jr.push("RENDER_SDF"),vi&&Jr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),pi&&pt&&!g.terrain&&Ht.text.orientationVertexBuffer&&Jr.push("ELEVATED_ROADS"),Bn(Jr);const nl=Ht.text.programConfigurations.get(h.id),yo=g.getOrCreateProgram("symbol",{config:nl,defines:Jr});let No,oc=[0,0],xo=null;const lc=Ht.textSizeData;Ht.iconsInText&&(oc=Ut.imageAtlasTexture?Ut.imageAtlasTexture.size:[0,0],xo=Ut.imageAtlasTexture?Ut.imageAtlasTexture:null,No=pt||!Ie.isOrthographic||g.options.rotating||g.options.zooming||lc.kind==="composite"||lc.kind==="camera"?Pe.LINEAR:Pe.NEAREST);const $c=Ut.glyphAtlasTexture?Ut.glyphAtlasTexture.size:[0,0],Ua=h.layout.get("text-size-scale-range"),Ei=a.aA(g.scaleFactor,Ua[0],Ua[1]),Ui=a.bJ(lc,Ie.zoom,Ei),Os=_h(sr,Ut.tileID.canonical,pt,et,Ie,Ht.getProjection(),cr),Gi=Oc(sr,Ut.tileID.canonical,pt,et,Ie,Ht.getProjection(),cr),$a=g.translatePosMatrix(Gi,Ut,A,F,!0),Ti=g.translatePosMatrix(sr,Ut,A,F),cc=Gn?Nh:Os,hm=et&&!pt&&!ps;let Id=Kt;!lt&&!Ie.mercatorFromTransition||et||(Id=Kw(Ie));const fm=Ww(lc.kind,Ui,hm,pt,g,Ti,cc,$a,Re,!0,$c,oc,0,gr,lr,Ue,Un,yr?Id:Kt,Ht.getProjection(),ki,Is,null,null,Ei),pm=Ut.glyphAtlasTexture?Ut.glyphAtlasTexture:null,uc=Pe.LINEAR,Ku=h.paint.get("text-halo-width").constantOr(1)!==0,Oa=g.terrain&&pt&&ps?a.bk(a.bB(),Os):Nh;if(ps&&Ht.text){const dc=a.bU.getAtTileOffsetFunc(gr,Ie.center.lat,Ie.worldSize,Ht.getProjection()),Lf=_u(sr,Ut.tileID.canonical,pt,et,Ie,Ht.getProjection(),cr);xh(Ht,sr,g,!0,Lf,Gi,pt,fe,dc,gr,Ei)}return{program:yo,buffers:Ht.text,uniformValues:fm,atlasTexture:pm,atlasTextureIcon:xo,atlasInterpolation:uc,atlasInterpolationIcon:No,isSDF:!0,hasHalo:Ku,depthMode:vl,tile:Ut,renderWithShadows:vi,labelPlaneMatrixInv:Oa}},Vs=Ht.icon.segments.get().length,Jn=Ht.text.segments.get().length,gn=Vs&&!T.onlyText?Ss():null,us=Jn&&!T.onlyIcons?$n():null,wn=h.paint.get("icon-opacity").constantOr(1),ei=h.paint.get("text-opacity").constantOr(1);if(ot&&Ht.canOverlap){vt=!0;const ps=wn&&!T.onlyText?Ht.icon.segments.get():[],Jr=ei&&!T.onlyIcons?Ht.text.segments.get():[];for(const Gn of ps)Pt.push({segments:new a.bf([Gn]),sortKey:Gn.sortKey,state:gn});for(const Gn of Jr)Pt.push({segments:new a.bf([Gn]),sortKey:Gn.sortKey,state:us})}else T.onlyText||Pt.push({segments:wn?Ht.icon.segments:new a.bf([]),sortKey:0,state:gn}),T.onlyIcons||Pt.push({segments:ei?Ht.text.segments:new a.bf([]),sortKey:0,state:us})}vt&&Pt.sort((gr,Ut)=>gr.sortKey-Ut.sortKey);for(const gr of Pt){const Ut=gr.state;if(Ut)if(g.terrain?g.terrain.setupElevationDraw(Ut.tile,Ut.program,{useDepthForOcclusion:Ie.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ut.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Ie.depthOcclusionForSymbolsAndCircles,Ut.program),De.activeTexture.set(Pe.TEXTURE0),Ut.atlasTexture&&Ut.atlasTexture.bind(Ut.atlasInterpolation,Pe.CLAMP_TO_EDGE,!0),Ut.atlasTextureIcon&&(De.activeTexture.set(Pe.TEXTURE1),Ut.atlasTextureIcon&&Ut.atlasTextureIcon.bind(Ut.atlasInterpolationIcon,Pe.CLAMP_TO_EDGE,!0)),Ut.renderWithShadows&&g.shadowRenderer.setupShadows(Ut.tile.tileID.toUnwrapped(),Ut.program,"vector-tile"),g.uploadCommonLightUniforms(g.context,Ut.program),Ut.hasHalo){const Ht=Ut.uniformValues;Ht.u_is_halo=1,wx(Ut.buffers,gr.segments,h,g,Ut.program,Ut.depthMode,v,S,Ht,2),Ht.u_is_halo=0}else{if(Ut.isSDF){const Ht=Ut.uniformValues;Ut.hasHalo&&(Ht.u_is_halo=1,wx(Ut.buffers,gr.segments,h,g,Ut.program,Ut.depthMode,v,S,Ht,1)),Ht.u_is_halo=0}wx(Ut.buffers,gr.segments,h,g,Ut.program,Ut.depthMode,v,S,Ut.uniformValues,1)}}}function wx(g,o,h,_,v,S,T,I,A,L){const F=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer,g.orientationVertexBuffer];v.draw(_,_.context.gl.TRIANGLES,S,T,I,Xr.disabled,A,h.id,g.layoutVertexBuffer,g.indexBuffer,o,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),F,L)}function TT(g,o){const h=1<<g.canonical.z,_=(o.x*h-g.canonical.x-g.wrap*h)*a.al,v=(o.y*h-g.canonical.y)*a.al,S=a.e7(o.z,o.y);return a.d4(_,v,S)}function Pf(g,o,h,_,v){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const S=g.context.gl,T=new wr(g.context.gl.LEQUAL,wr.ReadWrite,g.depthRangeFor3D),I=new wr(g.context.gl.GREATER,wr.ReadWrite,g.depthRangeFor3D),A=function(Y){let te=.01;return Y.isOrthographic&&(te=a.ak(1e-4,te,a.c$(Y.pitch>=Tf?1:Y.pitch/Tf))),2*te}(g.transform),L=g.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",H=g.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),U=g.getOrCreateProgram(F);for(const Y of _){const te=o.getTile(Y),se=te.getBucket(h);if(!se)continue;const fe=se.elevatedStructures;if(!fe)continue;const de=se.elevationBufferData.heightRange,_e=TT(Y.toUnwrapped(),L),Ee=g.translatePosMatrix(Y.projMatrix,te,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let xe,Re,Te,De;if(v==="initialize"){if(!de||de.min>=1||fe.depthSegments.segments[0].primitiveLength===0)continue;xe=ux(Ee,_e,A,1,0),Re=T,Te=fe.depthSegments,De=H}else if(v==="reset"){if(!de||de.min>=0||fe.maskSegments.segments[0].primitiveLength===0)continue;xe=ux(Ee,_e,0,0,1),Re=I,Te=fe.maskSegments,De=H}else if(v==="geometry"){if(fe.depthSegments.segments[0].primitiveLength===0)continue;xe=ux(Ee,_e,A,1,0),Re=T,Te=fe.depthSegments,De=U}De.draw(g,S.TRIANGLES,Re,en.disabled,vn.disabled,Xr.disabled,xe,h.id,fe.vertexBuffer,fe.indexBuffer,Te,h.paint,g.transform.zoom)}}function Jp(g,o,h){const{painter:_,sourceCache:v,layer:S,coords:T,colorMode:I,elevationType:A,terrainEnabled:L,pass:F}=g,H=_.context.gl,U=S.paint.get("fill-pattern"),Y=S.paint.get("fill-pattern-cross-fade"),te=U.constantOr(null);let se=A;A!=="road"||o&&!L||(se="none");const fe=se==="road",de=g.painter.shadowRenderer,_e=fe&&!!de&&de.enabled,Ee=new wr(_.context.gl.LEQUAL,wr.ReadOnly,_.depthRangeFor3D);let xe=[0,0,0];if(_e){const De=_.style.directionalLight,Pe=_.style.ambientLight;De&&Pe&&(xe=Lc(_.style,De,Pe))}const Re=U&&U.constantOr(1),Te=(De,Pe)=>{let Ie,Oe,et,Ke,pt;Pe?(Ie=Re&&!S.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",et=H.LINES):(Ie=Re?"fillPattern":"fill",et=H.TRIANGLES);for(const ot of T){const vt=v.getTile(ot);if(Re&&!vt.patternsLoaded())continue;const qt=vt.getBucket(S);if(!qt)continue;const nt=o?qt.elevationBufferData:qt.bufferData;if(nt.isEmpty())continue;_.prepareDrawTile();const Ue=nt.programConfigurations.get(S.id),wt=_.isTileAffectedByFog(ot),lt=[],Pt=[];fe&&(lt.push("ELEVATED_ROADS"),Pt.push(nt.elevatedLayoutVertexBuffer)),_e&&lt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Re&&(_.context.activeTexture.set(H.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ue.updatePaintBuffers());let Kt=!1;if(te&&vt.imageAtlas){const lr=vt.imageAtlas,sr=a.e2.from(te),cr=sr.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),Lr=sr.getSecondary(),Cn=lr.patternPositions.get(cr),Un=Lr?lr.patternPositions.get(Lr.scaleSelf(a.o.devicePixelRatio).toString()):null;Kt=!!Cn&&!!Un,Cn&&Ue.setConstantPatternPositions(Cn,Un)}Y>0&&(Kt||Ue.getPatternTransitionVertexBuffer("fill-pattern"))&&lt.push("FILL_PATTERN_TRANSITION");const gr=_.getOrCreateProgram(Ie,{config:Ue,overrideFog:wt,defines:lt}),Ut=_.translatePosMatrix(ot.projMatrix,vt,S.paint.get("fill-translate"),S.paint.get("fill-translate-anchor"));_e&&de.setupShadows(vt.tileID.toUnwrapped(),gr,"vector-tile");const Ht=S.paint.get("fill-emissive-strength");if(Pe){Ke=nt.lineIndexBuffer,pt=nt.lineSegments;const lr=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[H.drawingBufferWidth,H.drawingBufferHeight];Oe=Ie==="fillOutlinePattern"&&Re?WA(Ut,Ht,_,vt,lr,xe,Y):HA(Ut,Ht,lr,xe)}else Ke=nt.indexBuffer,pt=nt.triangleSegments,Oe=Re?vT(Ut,Ht,_,vt,xe,Y):xT(Ut,Ht,xe);_.uploadCommonUniforms(_.context,gr,ot.toUnwrapped());let yr=De;(A==="road"&&!L||A==="offset")&&(yr=Ee),gr.draw(_,et,yr,h||_.stencilModeForClipping(ot),I,Xr.disabled,Oe,S.id,nt.layoutVertexBuffer,Ke,pt,S.paint,_.transform.zoom,Ue,Pt)}};_.renderPass===F&&Te(_.depthModeForSublayer(1,_.renderPass==="opaque"?wr.ReadWrite:wr.ReadOnly),!1),se==="none"&&_.renderPass==="translucent"&&S.paint.get("fill-antialias")&&Te(_.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,wr.ReadOnly),!0)}function hr(g,o,h,_,v,S,T,I){h.resetLayerRenderingStats(g);const A=g.context,L=A.gl,F=g.transform,H=h.paint.get("fill-extrusion-pattern"),U=h.paint.get("fill-extrusion-pattern-cross-fade"),Y=H.constantOr(null),te=H.constantOr(1),se=h.paint.get("fill-extrusion-opacity"),fe=g.style.enable3dLights(),de=h.paint.get(fe&&!te?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_e=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),de],Ee=h.layout.get("fill-extrusion-edge-radius"),xe=Ee>0&&!h.paint.get("fill-extrusion-rounded-roof"),Re=xe?0:Ee,Te=F.projection.name==="globe"?a.ea():0,De=F.projection.name==="globe",Pe=De?a.aj(F.zoom):0,Ie=[a.aF(F.center.lng),a.aJ(F.center.lat)],Oe=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",et=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Oe?null:h.lut).toArray01().slice(0,3),Ke=h.paint.get("fill-extrusion-flood-light-intensity"),pt=h.paint.get("fill-extrusion-vertical-scale"),ot=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,vt=h.paint.get("fill-extrusion-height-alignment"),qt=h.paint.get("fill-extrusion-base-alignment"),nt=wd(g,h.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let wt;De&&Ue.push("PROJECTION_GLOBE_VIEW"),_e[0]>0&&Ue.push("FAUX_AO"),xe&&Ue.push("ZERO_ROOF_RADIUS"),I&&Ue.push("HAS_CENTROID"),Ke>0&&Ue.push("FLOOD_LIGHT"),nt.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),ot&&Ue.push("RENDER_WALL_MODE");const lt=g.renderPass==="shadow",Pt=g.shadowRenderer,Kt=lt&&!!Pt,gr=lt?Xr.disabled:Xr.backCCW;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Ut=[0,0,0];if(Pt){const lr=g.style.directionalLight,sr=g.style.ambientLight;lr&&sr&&(Ut=Lc(g.style,lr,sr)),lt||(Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Pt.useNormalOffset&&Ue.push("NORMAL_OFFSET")),wt=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const Ht=Kt?"fillExtrusionDepth":te?"fillExtrusionPattern":"fillExtrusion",yr=h.getLayerRenderingStats();for(const lr of _){const sr=o.getTile(lr),cr=sr.getBucket(h);if(!cr||cr.projection.name!==F.projection.name)continue;let Lr=!1;Pt&&(Lr=Pt.getMaxCascadeForTile(lr.toUnwrapped())===0);const Cn=g.isTileAffectedByFog(lr),Un=cr.programConfigurations.get(h.id);let Is=!1;if(Y&&sr.imageAtlas){const Jn=sr.imageAtlas,gn=a.e2.from(Y),us=gn.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),wn=gn.getSecondary(),ei=Jn.patternPositions.get(us),ps=wn?Jn.patternPositions.get(wn.scaleSelf(a.o.devicePixelRatio).toString()):null;Is=!!ei&&!!ps,ei&&Un.setConstantPatternPositions(ei,ps)}U>0&&(Is||Un.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ue.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Yr=g.getOrCreateProgram(Ht,{config:Un,defines:Lr?wt:Ue,overrideFog:Cn});if(g.terrain&&g.terrain.setupElevationDraw(sr,Yr,{useMeterToDem:!0}),!cr.centroidVertexBuffer){const Jn=Yr.getAttributeLocation(L,"a_centroid_pos");Jn!==-1&&L.vertexAttrib2f(Jn,0,0)}!lt&&Pt&&Pt.setupShadows(sr.tileID.toUnwrapped(),Yr,"vector-tile"),te&&(g.context.activeTexture.set(L.TEXTURE0),sr.imageAtlasTexture&&sr.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Un.updatePaintBuffers());const Bn=h.paint.get("fill-extrusion-vertical-gradient"),pn=1/cr.tileToMeter;let Ss;if(lt&&Pt){if(jT(sr.tileID,cr.maxHeight,g))continue;const Jn=Pt.calculateShadowPassMatrixFromTile(sr.tileID.toUnwrapped());Ss=_T(Jn,Re,pn,pt,vt,qt)}else{const Jn=g.translatePosMatrix(lr.expandedProjMatrix,sr,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),gn=F.projection.createInversionMatrix(F,lr.canonical);Ss=te?yT(Jn,g,Bn,se,_e,Re,pn,lr,sr,Te,vt,qt,Pe,Ie,gn,et,pt,U):cx(Jn,g,Bn,se,_e,Re,pn,lr,Te,vt,qt,Pe,Ie,gn,et,pt,Ke,Ut)}g.uploadCommonUniforms(A,Yr,lr.toUnwrapped(),null,nt);let $n=cr.segments;if(F.projection.name==="mercator"&&!lt&&($n=cr.getVisibleSegments(sr.tileID,g.terrain,g.transform.getFrustum(0)),!$n.get().length))continue;if(yr)if(lt)for(const Jn of $n.get())yr.numRenderedVerticesInShadowPass+=Jn.primitiveLength;else for(const Jn of $n.get())yr.numRenderedVerticesInTransparentPass+=Jn.primitiveLength;const Vs=[];(g.terrain||I)&&Vs.push(cr.centroidVertexBuffer),De&&Vs.push(cr.layoutVertexExtBuffer),ot&&Vs.push(cr.wallVertexBuffer),Yr.draw(g,A.gl.TRIANGLES,v,S,T,gr,Ss,h.id,cr.layoutVertexBuffer,cr.indexBuffer,$n,h.paint,g.transform.zoom,Un,Vs)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}class Xw{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Sd(g,o,h,_,v,S,T,I,A,L,F,H,U,Y,te,se,fe,de,_e,Ee){const xe=o.context,Re=xe.gl,Te=o.transform,De=o.transform.zoom,Pe=[],Ie=g.translate,Oe=g.translateAnchor,et=g.edgeRadius,Ke=wd(o,g.cutoffFadeRange);F==="clear"?(Pe.push("CLEAR_SUBPASS"),Ee&&(Pe.push("CLEAR_FROM_TEXTURE"),xe.activeTexture.set(Re.TEXTURE0),Ee.bind(Re.LINEAR,Re.CLAMP_TO_EDGE))):F==="sdf"&&Pe.push("SDF_SUBPASS"),de&&Pe.push("HAS_CENTROID"),Ke.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF");const pt=(ot,vt,qt,nt,Ue)=>{let wt=Pe;vt.groundRadiusBuffer!=null&&(wt=Pe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const lt=vt.programConfigurations.get(_.id),Pt=o.isTileAffectedByFog(ot),Kt=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:lt,defines:wt,overrideFog:Pt}),gr=Kp(o,nt,H,L,Ue,[U,Y*Ue],te,se,fe,De>=17?0:et*Ue,Ee?Ee.size[0]:0),Ut=[];de&&Ut.push(vt.hiddenByLandmarkVertexBuffer),vt.groundRadiusBuffer!=null&&Ut.push(vt.groundRadiusBuffer),o.uploadCommonUniforms(xe,Kt,ot.toUnwrapped(),null,Ke),Kt.draw(o,xe.gl.TRIANGLES,S,T,I,A,gr,_.id,vt.vertexBuffer,vt.indexBuffer,qt,_.paint,De,lt,Ut)};for(const ot of v){const vt=h.getTile(ot),qt=vt.getBucket(_);if(!qt||qt.projection.name!==Te.projection.name||!qt.groundEffect||qt.groundEffect&&!qt.groundEffect.hasData())continue;const nt=qt.groundEffect,Ue=1/qt.tileToMeter;{const wt=o.translatePosMatrix(ot.projMatrix,vt,Ie,Oe),lt=nt.getDefaultSegment();pt(ot,nt,lt,wt,Ue)}if(_e)for(let wt=0;wt<4;wt++){const lt=a.e8[wt](ot),Pt=h.getTile(lt);if(!Pt)continue;const Kt=Pt.getBucket(_);if(!Kt||Kt.projection.name!==Te.projection.name||!Kt.groundEffect||Kt.groundEffect&&!Kt.groundEffect.hasData())continue;const gr=Kt.groundEffect;let Ut,Ht;wt===0?(Ut=[-a.al,0,0],Ht=1):wt===1?(Ut=[a.al,0,0],Ht=0):wt===2?(Ut=[0,-a.al,0],Ht=3):(Ut=[0,a.al,0],Ht=2);const yr=gr.regionSegments[Ht];if(!yr)continue;const lr=new Float32Array(16);a.bq(lr,ot.projMatrix,Ut),pt(ot,gr,yr,o.translatePosMatrix(lr,vt,Ie,Oe),Ue)}}}function Ih(g,o,h,_,v,S,T){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const I=S?S.findDEMTileFor(h):null;if(!(I&&I.dem||T))return;S&&I&&I.dem&&_.selfDEMTileTimestamp!==I.dem._timestamp&&(_.borderDoneWithNeighborZ=[-1,-1,-1,-1],_.selfDEMTileTimestamp=I.dem._timestamp);const A=de=>new a.P(Math.ceil((de+a.ec)*a.ed),0),L=de=>{const _e=o.getSource().minzoom,Ee=Re=>{const Te=o.getTileByID(Re);if(Te&&Te.hasData())return Te.getBucket(v)},xe=[0,-1,1];for(const Re of xe){if(de.overscaledZ+Re<_e)continue;const Te=Ee(de.calculateScaledKey(de.overscaledZ+Re));if(Te)return Te}},F=[0,0,0],H=(de,_e)=>(F[0]=Math.min(de.min.y,_e.min.y),F[1]=Math.max(de.max.y,_e.max.y),F[2]=a.al-_e.min.x>de.max.x?_e.min.x-a.al:de.max.x,F),U=(de,_e)=>(F[0]=Math.min(de.min.x,_e.min.x),F[1]=Math.max(de.max.x,_e.max.x),F[2]=a.al-_e.min.y>de.max.y?_e.min.y-a.al:de.max.y,F),Y=[(de,_e)=>H(de,_e),(de,_e)=>H(_e,de),(de,_e)=>U(de,_e),(de,_e)=>U(_e,de)],te=(de,_e,Ee,xe,Re,Te,De)=>{if(!S)return 0;const Pe=[[Te?Ee:de,Te?de:Ee,0],[Te?Ee:_e,Te?_e:Ee,0]],Ie=De<0?a.al+De:De,Oe=[Te?Ie:(de+_e)/2,Te?(de+_e)/2:Ie,0];return Ee===0&&De<0||Ee!==0&&De>0?S.getForTilePoints(Re,[Oe],!0,xe):Pe.push(Oe),S.getForTilePoints(h,Pe,!0,I),Math.max(Pe[0][2],Pe[1][2],Oe[2])/S.exaggeration()};for(let de=0;de<4;de++){const _e=_.borderFeatureIndices[de];if(_e.length===0)continue;const Ee=a.e8[de](h),xe=L(Ee);if(!(xe&&xe instanceof a.e9))continue;const Re=S?S.findDEMTileFor(Ee):null;if(!(Re&&Re.dem||T)||(S&&Re&&Re.dem&&_.borderDEMTileTimestamp[de]!==Re.dem._timestamp&&(_.borderDoneWithNeighborZ[de]=-1,_.borderDEMTileTimestamp[de]=Re.dem._timestamp),_.borderDoneWithNeighborZ[de]===xe.canonical.z))continue;xe.centroidVertexArray.length===0&&xe.createCentroidsBuffer();const Te=(de<2?1:5)-de,De=xe.borderDoneWithNeighborZ[Te]!==_.canonical.z,Pe=xe.borderFeatureIndices[Te];let Ie=0;if(_.canonical.z!==xe.canonical.z){for(const Oe of _e)_.showCentroid(_.featuresOnBorder[Oe]);if(De)for(const Oe of Pe)xe.showCentroid(xe.featuresOnBorder[Oe]);_.borderDoneWithNeighborZ[de]=xe.canonical.z,xe.borderDoneWithNeighborZ[Te]=_.canonical.z}for(const Oe of _e){const et=_.featuresOnBorder[Oe],Ke=_.centroidData[et.centroidDataIndex],pt=et.borders[de];let ot;for(;Ie<Pe.length;){ot=xe.featuresOnBorder[Pe[Ie]];const vt=ot.borders[Te];if(vt[1]>pt[0]+3||vt[0]>pt[0]-3)break;xe.showCentroid(ot),Ie++}if(ot&&Ie<Pe.length){const vt=Ie;let qt=0;for(;!(ot.borders[Te][0]>pt[1]-3)&&(qt++,++Ie!==Pe.length);)ot=xe.featuresOnBorder[Pe[Ie]];ot=xe.featuresOnBorder[Pe[vt]];let nt=!1;if(qt>=1){const lt=ot.borders[Te];Math.abs(pt[0]-lt[0])<3&&Math.abs(pt[1]-lt[1])<3&&(qt=1,nt=!0,Ie=vt+1)}else if(qt===0){_.showCentroid(et);continue}const Ue=xe.centroidData[ot.centroidDataIndex];T&&nt&&(((se=Ke).flags|(fe=Ue).flags)&a.eb?(se.flags|=a.eb,fe.flags|=a.eb):(se.flags&=~a.eb,fe.flags&=~a.eb));const wt=et.intersectsCount()>1||ot.intersectsCount()>1;if(qt>1)Ie=vt,Ke.centroidXY=Ue.centroidXY=new a.P(0,0);else if(Re&&Re.dem&&!wt){const lt=Y[de](Ke,Ue),Pt=de%2?a.al-1:0,Kt=te(lt[0],Math.min(a.al-1,lt[1]),Pt,Re,Ee,de<2,lt[2]);Ke.centroidXY=Ue.centroidXY=A(Kt)}else wt?Ke.centroidXY=Ue.centroidXY=new a.P(0,0):(Ke.centroidXY=_.encodeBorderCentroid(et),Ue.centroidXY=xe.encodeBorderCentroid(ot));_.writeCentroidToBuffer(Ke),xe.writeCentroidToBuffer(Ue)}else _.showCentroid(et)}_.borderDoneWithNeighborZ[de]=xe.canonical.z,xe.borderDoneWithNeighborZ[Te]=_.canonical.z}var se,fe;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(g)}const Ch=[1,0,0],Or=[0,1,0],Yw=[0,0,1];function jT(g,o,h){const _=h.transform,v=h.shadowRenderer;if(!v)return!0;const S=g.toUnwrapped(),T=_.tileSize*v._cascades[h.currentShadowCascade].scale;let I=o;if(_.elevation){const se=_.elevation.getMinMaxForTile(g);se&&(I+=se.max)}const A=[...v.shadowDirection];A[2]=-A[2];const L=v.computeSimplifiedTileShadowVolume(S,I,T,A);if(!L)return!1;const F=[Ch,Or,Yw,A,[A[0],0,A[2]],[0,A[1],A[2]]],H=_.projection.name==="globe",U=_.scaleZoom(T),Y=a.cA.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,U,!H),te=v.getCurrentCascadeFrustum();return Y.intersectsPrecise(L.vertices,L.planes,F)===0||te.intersectsPrecise(L.vertices,L.planes,F)===0}function bx(g){const{painter:o,source:h,layer:_,coords:v}=g;let S=g.defines;const T=o.context,I=o.renderPass==="shadow",A=o.renderPass==="light-beam",L=o.shadowRenderer,F=a.ee(o.transform.center.lat,o.transform.zoom),H=wd(o,_.paint.get("building-cutoff-fade-range"));H.shouldRenderCutoff&&(S=S.concat("RENDER_CUTOFF")),g.floodLightIntensity>0&&(S=S.concat("FLOOD_LIGHT"));for(const U of v){const Y=h.getTile(U),te=Y.getBucket(_);if(!te)continue;L&&L.getMaxCascadeForTile(U.toUnwrapped())===0&&(S=S.concat("SHADOWS_SINGLE_CASCADE"));const se=te.programConfigurations.get(_.id);let fe,de,_e,Ee=o.translatePosMatrix(U.expandedProjMatrix,Y,[0,0],"map");if(Ee=a.cR(a.bB(),Ee,[1,1,g.verticalScale]),I&&L){if(jT(Y.tileID,te.maxHeight*F,o))continue;let Re=L.calculateShadowPassMatrixFromTile(Y.tileID.toUnwrapped());Re=a.cR(a.bB(),Re,[1,1,g.verticalScale]),_e=wT(Re),fe=de=o.getOrCreateProgram("buildingDepth",{config:se,defines:S,overrideFog:!1})}else if(A)fe=de=o.getOrCreateProgram("buildingBloom",{config:se,defines:S,overrideFog:!1}),_e=$w(Ee);else{const Re=o.transform.calculatePosMatrix(U.toUnwrapped(),o.transform.worldSize);a.cR(Re,Re,[1,1,g.verticalScale]);const Te=a.bB();a.cR(Te,Re,[1,-1,1/F]),a.bk(Te,Te),a.ef(Te,Te);const De=o.transform.getFreeCameraOptions().position,Pe=1<<U.canonical.z;if(_e=Uw(Ee,Te,g.opacity,g.facadeAOIntensity,[((De.x-U.wrap)*Pe-U.canonical.x)*a.al,(De.y*Pe-U.canonical.y)*a.al,De.z*Pe*a.al],te.tileToMeter,g.facadeEmissiveChance,g.floodLightColor,g.floodLightIntensity),de=o.getOrCreateProgram("building",{config:se,defines:S,overrideFog:!1}),g.depthOnly===!0)fe=de;else{const Ie=S.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);fe=o.getOrCreateProgram("building",{config:se,defines:Ie,overrideFog:!1})}L&&(L.setupShadowsFromMatrix(Re,de,!0),fe!==de&&L.setupShadowsFromMatrix(Re,fe,!0))}const xe=(Re,Te)=>{if(A){const De=Re.entranceBloom;Te.draw(o,T.gl.TRIANGLES,g.depthMode,en.disabled,g.blendMode,Xr.disabled,_e,_.id,De.layoutVertexBuffer,De.indexBuffer,De.segmentsBucket,_.paint,o.transform.zoom,se,[De.layoutAttenuationBuffer,De.layoutColorBuffer])}else{const De=Re.segmentsBucket;let Pe=[Re.layoutNormalBuffer,Re.layoutCentroidBuffer,Re.layoutColorBuffer,Re.layoutFloodLightDataBuffer];Re.layoutFacadePaintBuffer&&(Pe=Pe.concat([Re.layoutFacadeDataBuffer,Re.layoutFacadeVerticalRangeBuffer,Re.layoutFacadePaintBuffer])),Te.draw(o,T.gl.TRIANGLES,g.depthMode,en.disabled,g.blendMode,I?Xr.disabled:Xr.backCW,_e,_.id,Re.layoutVertexBuffer,Re.indexBuffer,De,_.paint,o.transform.zoom,se,Pe)}};o.uploadCommonUniforms(T,de,U.toUnwrapped(),null,H),te.buildingWithoutFacade&&xe(te.buildingWithoutFacade,de),te.buildingWithFacade&&(fe!==de&&o.uploadCommonUniforms(T,fe,U.toUnwrapped(),null,H),xe(te.buildingWithFacade,fe))}}function Sx(g,o,h,_,v,S,T,I,A,L,F,H,U){const Y=g.context.gl,te=g.depthModeForSublayer(1,wr.ReadOnly,Y.LEQUAL,!0),se=.1*(1-(fe=F))+3*fe;var fe;const de=g._showOverdrawInspector,_e=H,Ee=new Xw;de||Sd(Ee,g,o,h,_,te,new en({func:Y.ALWAYS,mask:255},255,255,Y.KEEP,Y.KEEP,Y.REPLACE),new vn([Y.ONE,Y.ONE,Y.ONE,Y.ONE],a.ao.transparent,[!1,!1,!1,!0],Y.MIN),Xr.disabled,v,"sdf",S,T,I,A,L,se,_e,!1);{const xe=de?en.disabled:new en({func:Y.EQUAL,mask:255},255,255,Y.KEEP,Y.DECR,Y.DECR),Re=de?g.colorModeForRenderPass():new vn([Y.ONE_MINUS_DST_ALPHA,Y.DST_ALPHA,Y.ONE,Y.ONE],a.ao.transparent,[!0,!0,!0,!0]);Sd(Ee,g,o,h,_,te,xe,Re,Xr.disabled,v,"color",S,T,I,A,L,se,_e,!1)}}function Jw(g){return[g[0]*a.eg,g[1]*a.eg,g[2]*a.eg,0]}function Qw(g,o,h,_,v,S,T,I,A){const L=_.getSource(),F=h.globeSharedBuffers;if(!F)return;let H,U,Y;if(o&&(H=_.getTile(o)),L instanceof a.aT?(U=L.texture,Y=a.dJ(0,0,h.transform)):H&&o&&(U=H.texture,Y=a.dJ(o.canonical.z,o.canonical.x,h.transform)),!U||!Y)return;g||(Y=a.cR(a.bB(),Y,[1,-1,1]));const te=h.context,se=te.gl,fe=v.paint.get("raster-resampling")==="nearest"?se.NEAREST:se.LINEAR,de=h.colorModeForDrapableLayerRenderPass(S),_e=T.defines;_e.push("GLOBE_POLES");const Ee=new wr(se.LEQUAL,wr.ReadWrite,h.depthRangeFor3D),xe=Float32Array.from(h.transform.expandedFarZProjMatrix),Re=Float32Array.from(a.bj(a.dI(new a.cC(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),te.activeTexture.set(se.TEXTURE0),U.bind(fe,se.CLAMP_TO_EDGE),te.activeTexture.set(se.TEXTURE1),U.bind(fe,se.CLAMP_TO_EDGE),"useMipmap"in U&&te.extTextureFilterAnisotropic&&h.transform.pitch>20&&se.texParameterf(se.TEXTURE_2D,te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,te.extTextureFilterAnisotropicMax);const[Te,De,Pe,Ie]=o?F.getPoleBuffers(o.canonical.z,!1):F.getPoleBuffers(0,!0),Oe=v.paint.get("raster-elevation");let et;g?(et=Te,h.renderDefaultNorthPole=Oe!==0):(et=De,h.renderDefaultSouthPole=Oe!==0);const Ke=Jw(T.mix),pt=((vt,qt,nt,Ue,wt,lt,Pt,Kt,gr,Ut,Ht,yr,lr)=>t_(vt,qt,nt,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},lt,[0,0],Kt,2,Ut,Ht,yr,1,0,lr))(xe,Re,Y,a.aj(h.transform.zoom),0,v,0,Oe,0,Ke,T.offset,T.range,S),ot=h.getOrCreateProgram("raster",{defines:_e});h.uploadCommonUniforms(te,ot,null),ot.draw(h,se.TRIANGLES,Ee,A,de,I,pt,v.id,et,Pe,Ie)}function NT(g){const o=g._nearZ,h=g.projection.farthestPixelDistance(g),_=h-o,v=.2*g.height,S=o+v;return[o,h,(S-v-o)/_,(S-o)/_]}function YA(g,o,h,_){if(g)return o instanceof Mi&&g instanceof pu?o.getTextureDescriptor(g,h,!0):{texture:g.texture,mix:Jw(_.mix),offset:_.offset,buffer:0,tileSize:1}}var JA=a.eh([{name:"a_index",type:"Int16",components:1}]);class Ml{constructor(o,h,_,v){const S={width:_[0],height:_[1],data:null},T=o.gl;this.targetColorTexture=new a.T(o,S,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(o,S,T.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(h,v),this.lastInvalidatedAt=0}updateParticleTexture(o,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,v=h.width*h.height;this.particleTexture0=new a.T(this.context,h,_.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,h,_.RGBA8,{premultiply:!1,useMipmap:!1});const S=new a.ei;S.reserve(v);for(let T=0;T<v;T++)S.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(S,JA.members,!0),this.particleSegment=a.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=a.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function eb(g,o,h){if(!g)return null;const _=o.getTextureDescriptor(g,h,!0);if(!_)return null;let{texture:v,mix:S,offset:T,tileSize:I,buffer:A,format:L}=_;if(!v||!L)return null;let F=!1;return L==="uint32"&&(F=!0,S[3]=0,S=dx(a.ej,S,[0,h.paint.get("raster-particle-max-speed")]),T=bd(a.ej,T,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[A/(I+2*A),I/(I+2*A)],tileSize:I,scalarData:F,scale:S,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function rl(g){const o=g._nearZ,h=g.projection.farthestPixelDistance(g),_=h-o,v=.2*g.height,S=o+v;return[o,h,(S-v-o)/_,(S-o)/_]}const Ah=new a.ao(1,0,0,1),IT=new a.ao(0,1,0,1),tb=new a.ao(0,0,1,1),rb=new a.ao(1,0,1,1),nb=new a.ao(0,1,1,1);function sb(g,o,h,_,v,S){for(let T=0;T<h.length;T++)if(v){const L=new a.ao(_.r*.8,_.g*.8,_.b*.8,1);Dl(g,o,h[T],_,-1,-1,S),Dl(g,o,h[T],_,-1,1,S),Dl(g,o,h[T],_,1,1,S),Dl(g,o,h[T],_,1,-1,S),Dl(g,o,h[T],L,0,0,S)}else Dl(g,o,h[T],_,0,0,S)}function Dl(g,o,h,_,v,S,T){const I=g.context,A=g.transform,L=I.gl,F=A.projection.name==="globe",H=F?["PROJECTION_GLOBE_VIEW"]:[];let U=a.by(h.projMatrix);if(F&&a.aj(A.zoom)>0){const Ke=a.bi(h.canonical,A),pt=a.ek(Ke);U=a.aB(new Float32Array(16),A.globeMatrix,pt),a.aB(U,A.projMatrix,U)}const Y=a.bB();Y[12]+=2*v/(a.o.devicePixelRatio*A.width),Y[13]+=2*S/(a.o.devicePixelRatio*A.height),a.aB(U,Y,U);const te=g.getOrCreateProgram("debug",{defines:H}),se=o.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(se,te);const fe=wr.disabled,de=en.disabled,_e=g.colorModeForRenderPass(),Ee="$debug";I.activeTexture.set(L.TEXTURE0),g.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),F?se._makeGlobeTileDebugBuffers(g.context,A):se._makeDebugTileBoundsBuffers(g.context,A.projection);const xe=se._tileDebugBuffer||g.debugBuffer,Re=se._tileDebugIndexBuffer||g.debugIndexBuffer,Te=se._tileDebugSegments||g.debugSegments;if(te.draw(g,L.LINE_STRIP,fe,de,_e,Xr.disabled,qw(U,_.toPremultipliedRenderColor(null)),Ee,xe,Re,Te,null,null,null,[se._globeTileDebugBorderBuffer]),T){const Ke=se.latestRawTileData,pt=Math.floor((Ke&&Ke.byteLength||0)/1024);let ot=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ot+=` => ${h.overscaledZ}`),ot+=` ${se.state}`,ot+=` ${pt}kb`,function(vt,qt){vt.initDebugOverlayCanvas();const nt=vt.debugOverlayCanvas,Ue=vt.context.gl,wt=vt.debugOverlayCanvas.getContext("2d");wt.clearRect(0,0,nt.width,nt.height),wt.shadowColor="white",wt.shadowBlur=2,wt.lineWidth=1.5,wt.strokeStyle="white",wt.textBaseline="top",wt.font="bold 36px Open Sans, sans-serif",wt.fillText(qt,5,5),wt.strokeText(qt,5,5),vt.debugOverlayTexture.update(nt),vt.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(g,ot)}const De=o.getTile(h).tileSize,Pe=512/Math.min(De,512)*(h.overscaledZ/A.zoom)*.5,Ie=se._tileDebugTextBuffer||g.debugBuffer,Oe=se._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,et=se._tileDebugTextSegments||g.debugSegments;te.draw(g,L.TRIANGLES,fe,de,vn.alphaBlended,Xr.disabled,qw(U,a.ao.transparent.toPremultipliedRenderColor(null),Pe),Ee,Ie,Oe,et,null,null,null,[se._globeTileDebugTextBuffer])}function Xs(g,o,h,_){Qp(g,0,o+h/2,g.transform.width,h,_)}function s_(g,o,h,_){Qp(g,o-h/2,0,h,g.transform.height,_)}function Qp(g,o,h,_,v,S){const T=g.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*a.o.devicePixelRatio,h*a.o.devicePixelRatio,_*a.o.devicePixelRatio,v*a.o.devicePixelRatio),T.clear({color:S}),I.disable(I.SCISSOR_TEST)}const CT=a.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:AT}=CT;function Ed(g,o,h,_){g.emplaceBack(o,h,_)}class ib{constructor(o){this.vertexArray=new a.el,this.indices=new a.b0,Ed(this.vertexArray,-1,-1,1),Ed(this.vertexArray,1,-1,1),Ed(this.vertexArray,-1,1,1),Ed(this.vertexArray,1,1,1),Ed(this.vertexArray,-1,-1,-1),Ed(this.vertexArray,1,-1,-1),Ed(this.vertexArray,-1,1,-1),Ed(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,AT),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=a.bf.simpleSegment(0,0,36,12)}}function Bc(g,o,h,_,v,S){const T=g.context.gl,I=o.paint.get("sky-atmosphere-color"),A=o.paint.get("sky-atmosphere-halo-color"),L=o.paint.get("sky-atmosphere-sun-intensity"),F=((H,U,Y,te,se)=>({u_matrix_3f:H,u_sun_direction:U,u_sun_intensity:Y,u_color_tint_r:[te.r,te.g,te.b,te.a],u_color_tint_m:[se.r,se.g,se.b,se.a],u_luminance:5e-5}))(a.en(a.dN(),_),v,L,I.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+S,o.skyboxTexture,0),h.draw(g,T.TRIANGLES,wr.disabled,en.disabled,vn.unblended,Xr.frontCW,F,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const kf=a.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Vt{constructor(o){const h=new a.eo;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new a.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(h,kf.members),this.indexBuffer=o.createIndexBuffer(_),this.segments=a.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const nr=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class em{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Pi{constructor(o){this.colorModeAlphaBlendedWriteRGB=new vn([1,Si,1,Si],a.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new vn([1,0,1,0],a.ao.transparent,[!1,!1,!1,!0]),this.params=new em,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){const h=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Vt(h);const _=this.params.sizeRange,v=this.params.intensityRange,S=function(F){const H=a.eq(30),U=[];for(let Y=0;Y<F;++Y){const te=2*Math.PI*H(),se=Math.acos(1-2*H())-.5*Math.PI;U.push(a.d4(Math.cos(se)*Math.cos(te),Math.cos(se)*Math.sin(te),Math.sin(se)))}return U}(this.params.starsCount),T=a.eq(300),I=new a.ep,A=new a.b0;let L=0;for(let F=0;F<S.length;++F){const H=a.c4([],S[F],200),U=Math.max(0,1+.01*_*(1*T()-.5)),Y=Math.max(0,1+.01*v*(1*T()-.5));I.emplaceBack(H[0],H[1],H[2],-1,-1,U,Y),I.emplaceBack(H[0],H[1],H[2],1,-1,U,Y),I.emplaceBack(H[0],H[1],H[2],1,1,U,Y),I.emplaceBack(H[0],H[1],H[2],-1,1,U,Y),A.emplaceBack(L+0,L+1,L+2),A.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=h.createVertexBuffer(I,nr.members),this.starsIdx=h.createIndexBuffer(A),this.starsSegments=a.bf.simpleSegment(0,0,I.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,h){const _=o.context,v=_.gl,S=o.transform,T=new wr(v.LEQUAL,wr.ReadOnly,[0,1]),I=a.aj(S.zoom),A=o.style.getLut(h.scope),L=h.properties.get("color-use-theme")==="none",F=h.properties.get("color").toNonPremultipliedRenderColor(L?null:A),H=h.properties.get("high-color-use-theme")==="none",U=h.properties.get("high-color").toNonPremultipliedRenderColor(H?null:A),Y=h.properties.get("space-color-use-theme")==="none",te=h.properties.get("space-color").toNonPremultipliedRenderColor(Y?null:A),se=5e-4,fe=a.er(h.properties.get("horizon-blend"),0,1,se,.25),de=a.dD(o,_,S)&&fe===se?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,_e=o.frameCounter/1e3%1,Ee=a.ag(S.globeCenterInViewSpace),xe=Math.sqrt(Math.pow(Ee,2)-Math.pow(de,2)),Re=Math.acos(xe/Ee),Te=De=>{const Pe=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];De&&Pe.push("ALPHA_PASS");const Ie=o.getOrCreateProgram("globeAtmosphere",{defines:Pe}),Oe=((Ke,pt,ot,vt,qt,nt,Ue,wt,lt,Pt,Kt,gr)=>({u_frustum_tl:Ke,u_frustum_tr:pt,u_frustum_br:ot,u_frustum_bl:vt,u_horizon:qt,u_transition:nt,u_fadeout_range:Ue,u_atmosphere_fog_color:wt.toArray01(),u_high_color:lt.toArray01(),u_space_color:Pt.toArray01(),u_temporal_offset:Kt,u_horizon_angle:gr}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,I,fe,F,U,te,_e,Re);o.uploadCommonUniforms(_,Ie);const et=this.atmosphereBuffer;et&&Ie.draw(o,v.TRIANGLES,T,en.disabled,De?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Xr.backCW,Oe,De?"atmosphere_glow_alpha":"atmosphere_glow",et.vertexBuffer,et.indexBuffer,et.segments)};Te(!1),Te(!0)}drawStars(o,h){const _=a.aA(h.properties.get("star-intensity"),0,1);if(_===0)return;const v=o.context,S=v.gl,T=o.transform,I=o.getOrCreateProgram("stars"),A=a.c6([]);a.c8(A,A,-T._pitch),a.c7(A,A,-T.angle),a.c8(A,A,a.an(T._center.lat)),a.es(A,A,-a.an(T._center.lng));const L=a.cb(new Float32Array(16),A),F=a.aB([],T.starsProjMatrix,L),H=a.en([],L),U=a.et([],H),Y=[0,1,0];a.dP(Y,Y,U),a.c4(Y,Y,this.params.sizeMultiplier);const te=[1,0,0];a.dP(te,te,U),a.c4(te,te,this.params.sizeMultiplier);const se=(fe=Y,de=te,_e=_,{u_matrix:Float32Array.from(F),u_up:fe,u_right:de,u_intensity_multiplier:_e});var fe,de,_e;o.uploadCommonUniforms(v,I),this.starsVx&&this.starsIdx&&I.draw(o,S.TRIANGLES,wr.disabled,en.disabled,this.colorModeAlphaBlendedWriteRGB,Xr.disabled,se,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class tt{constructor(){this.visibleTiles=[]}updateBorders(o,h){const _=[],v=[],S=o._getRenderableCoordinates(!1,!0);for(const A of S){const L=o.getTile(A);if(!L.hasData())continue;const F=L.getBucket(h);F&&(F.isEmpty()||(_.push(A.key),v.push({bucket:F,tileID:A.canonical})))}let T=_.length!==this.visibleTiles.length;if(!T){_.sort();for(let A=0;A<_.length;A++)if(_[A]!==this.visibleTiles[A]){T=!0;break}}if(!T)return;const I=new Set;this.visibleTiles=_,v.sort((A,L)=>A.tileID.z-L.tileID.z||A.tileID.x-L.tileID.x||A.tileID.y-L.tileID.y);for(const A of v){const L=new Array,F=new Array,H=A.bucket;for(const U of H.featuresOnBorder)I.has(U.featureId)?F.push(U.footprintIndex):(I.add(U.featureId),L.push(U.footprintIndex));H.updateFootprintHiddenFlags(L,a.eu,!1),H.updateFootprintHiddenFlags(F,a.eu,!0)}}}function ab(g,o){const h=[...g],_=o.cameraWorldSizeForFog/o.worldSize,v=a.bz([]);return a.cR(v,v,[_,_,1]),a.aB(h,v,h),a.aB(h,o.worldToFogMatrix,h),h}function tm(g,o,h,_,v){const S=h.material,T=_.context,{baseColorTexture:I,metallicRoughnessTexture:A}=S.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:F,emissionTexture:H}=S;function U(te,se,fe){if(te&&(g.push(se),T.activeTexture.set(T.gl.TEXTURE0+fe),te.gfxTexture)){const{minFilter:de,magFilter:_e,wrapS:Ee,wrapT:xe}=te.sampler;te.gfxTexture.bindExtraParam(de,_e,Ee,xe)}}U(I,"HAS_TEXTURE_u_baseColorTexture",oo.BaseColor),U(A,"HAS_TEXTURE_u_metallicRoughnessTexture",oo.MetallicRoughness),U(L,"HAS_TEXTURE_u_normalTexture",oo.Normal),U(F,"HAS_TEXTURE_u_occlusionTexture",oo.Occlusion),U(H,"HAS_TEXTURE_u_emissionTexture",oo.Emission),v&&(v.texture||(v.texture=new a.d_(_.context,v.image,[v.image.height,v.image.height,v.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+oo.LUT),v.texture&&v.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(h.texcoordBuffer)),h.colorBuffer&&(g.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(h.colorBuffer)),h.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(h.normalBuffer)),h.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(h.pbrBuffer)),S.alphaMode!=="OPAQUE"&&S.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),S.defined||g.push("DIFFUSE_SHADED");const Y=_.shadowRenderer;Y&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&g.push("NORMAL_OFFSET"))}function rm(g,o,h,_,v,S){const T=h.paint.get("model-opacity").constantOr(1),I=o.context,A=new wr(o.context.gl.LEQUAL,g.isLightMesh?wr.ReadOnly:wr.ReadWrite,o.depthRangeFor3D),L=o.transform,F=g.mesh,H=F.material,U=H.pbrMetallicRoughness,Y=o.style.fog;let te;te=o.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:a.aB([],_.zScaleMatrix,g.nodeModelMatrix),a.aB(te,_.negCameraPosMatrix,te);const se=a.bk([],te);a.ef(se,se);const fe=h.paint.get("model-color-use-theme").constantOr("default")==="none",de=h.paint.get("model-emissive-strength").constantOr(0),_e=gx(new Float32Array(g.worldViewProjection),new Float32Array(te),new Float32Array(se),null,o,T,U.baseColorFactor,H.emissiveFactor,U.metallicFactor,U.roughnessFactor,H,de,h,void 0,void 0,g.materialOverride,g.modelColor),Ee={defines:[]},xe=[],Re=o.shadowRenderer;Re&&(Re.useNormalOffset=!1),tm(Ee.defines,xe,F,o,fe?null:h.lut);let Te=null;if(Y){const Ie=ab(g.nodeModelMatrix,o.transform);if(Te=new Float32Array(Ie),L.projection.name!=="globe"){const Oe=F.aabb.min,et=F.aabb.max,[Ke,pt]=Y.getOpacityForBounds(Ie,Oe[0],Oe[1],et[0],et[1]);Ee.overrideFog=Ke>=at||pt>=at}}const De=wd(o,h.paint.get("model-cutoff-fade-range"));De.shouldRenderCutoff&&Ee.defines.push("RENDER_CUTOFF");const Pe=o.getOrCreateProgram("model",Ee);o.uploadCommonUniforms(I,Pe,null,Te,De),o.renderPass!=="shadow"&&Re&&Re.setupShadowsFromMatrix(g.nodeModelMatrix,Pe),Pe.draw(o,I.gl.TRIANGLES,A,v,S,F.material.doubleSided?Xr.disabled:Xr.backCCW,_e,h.id,F.vertexBuffer,F.indexBuffer,F.segments,h.paint,o.transform.zoom,void 0,xe)}function Ex(g,o,h){return g.type==="vector"?o.scope:h?"basemap":""}function Tx(g,o,h,_,v,S,T,I,A){const L=g.transform,F=!!o.isGeometryBloom&&o.isGeometryBloom;if(F&&g.renderPass==="shadow")return;const H=L.projection.name==="globe"?a.eC(h,L):[...h];a.aB(H,H,o.globalMatrix);const U=a.aB([],_,H);if(o.meshes)for(const Y of o.meshes){const te=I.get(Y.material.name);if(te&&te.opacity<=0)continue;if(Y.material.alphaMode!=="BLEND"){T.push({mesh:Y,depth:0,modelIndex:v,worldViewProjection:U,nodeModelMatrix:H,isLightMesh:F,materialOverride:te,modelColor:A});continue}const se=a.af([],Y.centroid,U);!L.isOrthographic&&se[2]<=0||S.push({mesh:Y,depth:se[2],modelIndex:v,worldViewProjection:U,nodeModelMatrix:H,isLightMesh:F,materialOverride:te,modelColor:A})}if(o.children)for(const Y of o.children)Tx(g,Y,h,_,v,S,T,I,A)}function nm(g,o,h,_){const v=h.shadowRenderer;if(!v)return;const S=v.getShadowPassDepthMode(),T=v.getShadowPassColorMode(),I=v.calculateShadowPassMatrixFromMatrix(o),A=Yp(I);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,S,en.disabled,T,Xr.disabled,A,_.id,g.vertexBuffer,g.indexBuffer,g.segments,_.paint,h.transform.zoom,void 0,void 0)}function sm(g,o,h,_,v,S){for(const T of v){const I=Object.assign({},_);I.part=T;const A={type:"Unknown",id:o,properties:I},L={orientation:g.paint.get("model-rotation").evaluate(A,h)};S.set(T,L)}}function QA(g,o,h,_,v,S){for(const T of v){const I=Object.assign({},_);I.part=T;const A={type:"Unknown",id:o,properties:I},L={color:g.paint.get("model-color").evaluate(A,h),colorMix:g.paint.get("model-color-mix-intensity").evaluate(A,h),opacity:g.paint.get("model-opacity").evaluate(A,h),emissionStrength:g.paint.get("model-emissive-strength").evaluate(A,h)};S.set(T,L)}}function PT(g,o,h,_,v,S){if(h===1)for(const I of v)rm(I,g,o,S[I.modelIndex],en.disabled,g.colorModeForRenderPass());else{for(const I of v)rm(I,g,o,S[I.modelIndex],en.disabled,vn.disabled);for(const I of v)rm(I,g,o,S[I.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}const T=vn.additive;for(const I of _)rm(I,g,o,S[I.modelIndex],en.disabled,I.isLightMesh?T:g.colorModeForRenderPass())}function kT(g,o,h){const _=o.updateZoomBasedPaintProperties(),v=function(S,T,I){let A,L,F,H=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&H>0){const U=S.terrain,Y=U.findDEMTileFor(I);Y&&Y.dem?A=a.eE.create(U,I,Y):H=0}if(H===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),H===T.validForExaggeration&&(H===0||A&&A._demTile&&A._demTile.tileID===T.validForDEMTile.id&&A._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const U in T.instancesPerModel){const Y=T.instancesPerModel[U];for(let te=0;te<Y.instancedDataArray.length;++te){const se=(A?H*A.getElevationAt(0|Y.instancedDataArray.float32[16*te],0|Y.instancedDataArray.float32[16*te+1],!0,!0):0)+Y.instancesEvaluatedElevation[te];Y.instancedDataArray.float32[16*te+6]=se,L=L?Math.min(T.terrainElevationMin,se):se,F=F?Math.max(T.terrainElevationMax,se):se}}return T.terrainElevationMin=L||0,T.terrainElevationMax=F||0,T.validForExaggeration=H,T.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,o,h);(_||v)&&(o.uploaded=!1,o.upload(g.context))}const ic={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.d8([0,0,0],[a.al,a.al,0])};function ob(g,o){const h=1<<g.canonical.z,_=o.getFreeCameraOptions().position,v=o.elevation,S=g.canonical.x/h,T=(g.canonical.x+1)/h,I=g.canonical.y/h,A=(g.canonical.y+1)/h;let L=o._centerAltitude;if(v){const Y=v.getMinMaxForTile(g);Y&&Y.max>L&&(L=Y.max)}const F=a.aA(_.x,S,T)-_.x,H=a.aA(_.y,I,A)-_.y,U=a.ce(L,o.center.lat)-_.z;return o._zoomFromMercatorZ(Math.sqrt(F*F+H*H+U*U))}function lb(g,o,h,_,v,S,T){const I=g.context,A=g.renderPass==="shadow",L=g.shadowRenderer,F=A&&L?L.getShadowPassDepthMode():new wr(I.gl.LEQUAL,wr.ReadWrite,g.depthRangeFor3D),H=g.isTileAffectedByFog(S),U=g.transform.projection.name==="globe";if(h.meshes)for(const Y of h.meshes){const te=U?[]:["MODEL_POSITION_ON_GPU"],se=[];let fe,de,_e;const Ee=!U&&_.instancedDataArray.length>20;Ee&&te.push("INSTANCED_ARRAYS");const xe=wd(g,o.paint.get("model-cutoff-fade-range"));if(xe.shouldRenderCutoff&&te.push("RENDER_CUTOFF"),A&&L)fe=g.getOrCreateProgram("modelDepth",{defines:te}),de=Yp(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(h.globalMatrix)),_e=L.getShadowPassColorMode();else{tm(te,se,Y,g,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),fe=g.getOrCreateProgram("model",{defines:te,overrideFog:H});const Te=Y.material,De=Te.pbrMetallicRoughness,Pe=o.paint.get("model-opacity").constantOr(1),Ie=o.paint.get("model-emissive-strength").constantOr(0);de=gx(S.expandedProjMatrix,Float32Array.from(h.globalMatrix),new Float32Array(16),null,g,Pe,De.baseColorFactor,Te.emissiveFactor,De.metallicFactor,De.roughnessFactor,Te,Ie,o,v),L&&(T.shadowUniformsInitialized?fe.setShadowUniformValues(I,L.getShadowUniformValues()):(L.setupShadows(S.toUnwrapped(),fe,"model-tile"),T.shadowUniformsInitialized=!0)),_e=xe.shouldRenderCutoff||Pe<1||Te.alphaMode!=="OPAQUE"?vn.alphaBlended:vn.unblended}g.uploadCommonUniforms(I,fe,S.toUnwrapped(),null,xe);const Re=Y.material.doubleSided?Xr.disabled:Xr.backCCW;if(Ee)se.push(_.instancedDataBuffer),fe.draw(g,I.gl.TRIANGLES,F,en.disabled,_e,Re,de,o.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,o.paint,g.transform.zoom,void 0,se,_.instancedDataArray.length);else{const Te=A?"u_instance":"u_normal_matrix";for(let De=0;De<_.instancedDataArray.length;++De)de[Te]=new Float32Array(_.instancedDataArray.arrayBuffer,64*De,16),fe.draw(g,I.gl.TRIANGLES,F,en.disabled,_e,Re,de,o.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,o.paint,g.transform.zoom,void 0,se)}}if(h.children)for(const Y of h.children)lb(g,o,Y,_,v,S,T)}const RT=[1,-1,1];function jx(g,o,h,_){if(!h.modelManager)return!0;const v=h.modelManager;if(!h.shadowRenderer)return!0;const S=h.shadowRenderer,T=o.aabb;let I=!0,A=g.maxHeight;if(A===0){let F=0;for(const H in g.instancesPerModel){const U=v.getModel(H,_);U?F=Math.max(F,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):I=!1}A=g.maxScale*F*1.41+g.maxVerticalOffset,I&&(g.maxHeight=A)}T.max[2]=A,T.min[2]+=g.terrainElevationMin,T.max[2]+=g.terrainElevationMax,a.af(T.min,T.min,o.tileMatrix),a.af(T.max,T.max,o.tileMatrix);const L=T.intersects(S.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=L===2),L===0}function i_(g,o){const h=g.uniformValues.u_cutoff_params[0],_=g.uniformValues.u_cutoff_params[1],v=g.uniformValues.u_cutoff_params[2],S=g.uniformValues.u_cutoff_params[3];return _===h||S===v?1:a.aA(((o-h)/(_-h)-v)/(S-v),0,1)}function Rf(g,o,h,_){if(o.pitch<20)return 1;const v=o.getWorldToCameraMatrix();a.aB(v,v,g);const S=a.bT(h.min[0],h.min[1],h.min[2],1);let T=a.aC(a.eF(),S,v),I=T,A=T;S[1]=h.max[1],T=a.aC(a.eF(),S,v),I=T[1]<I[1]?T:I,A=T[1]>A[1]?T:A,S[0]=h.max[0],T=a.aC(a.eF(),S,v),I=T[1]<I[1]?T:I,A=T[1]>A[1]?T:A,S[1]=h.min[1],T=a.aC(a.eF(),S,v),I=T[1]<I[1]?T:I,A=T[1]>A[1]?T:A;const L=a.aA(_[0],0,1),F=100*o.pixelsPerMeter*a.aA(_[1],0,1),H=a.aA(_[2],0,1),U=a.eG(a.eF(),I,A,L),Y=Math.tan(.5*o.fovX),te=-U[2]*Y;if(F===0)return U[1]<-Math.abs(te)?H:1;const se=(-Math.abs(te)-U[1])/F,fe=(_e,Ee,xe)=>(1-xe)*_e+xe*Ee,de=a.aA(fe(1,H,se),H,1);return fe(1,de,a.aA((o.pitch-20)/20,0,1))}class MT{}class DT{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,h,_){{const H=this._storage.get(h.id);if(H)return H.lastUsedFrameIdx=o,H.buf}const v=_.gl,S=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),T=new ArrayBuffer(S),I=new Int16Array(T);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const A=new a.eI;for(let H=0;H<S/2;H+=3){const U=I[H],Y=I[H+1],te=I[H+2];A.emplaceBack(U,Y),A.emplaceBack(Y,te),A.emplaceBack(te,U)}const L=_.bindVertexArrayOES.current,F=new MT;return F.buf=new jh(_,A),F.lastUsedFrameIdx=o,this._storage.set(h.id,F),_.bindVertexArrayOES.set(L),F.buf}update(o){for(const[h,_]of this._storage)o-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(h))}destroy(){for(const[o,h]of this._storage)h.buf.destroy(),this._storage.delete(o)}}class eP{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const OT=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class tP{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ho{constructor(o,h){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...h,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...h,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const rP=a.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class a_{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,h){const _=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new a.eJ,I=new a.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(T,rP.members),this.vignetteIdx=o.context.createIndexBuffer(I)}const v=a.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,_);const T={u_vignetteShape:(S={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:S.vignetteColor};_.draw(o,o.context.gl.TRIANGLES,wr.disabled,en.disabled,vn.alphaBlended,Xr.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,v)}var S}}class ti{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,h){const _=o.getFreeCameraOptions().position,v=_.toAltitude(),S=_.toLngLat(),T=a.an(S.lng),I=a.an(S.lat),A=o.pixelsPerMeter/h,L=T*a.eL,F=a.eL*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const H=-this._offsetYPrev+F,U=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*A,this._accumulatedOffsetY+=H*A,this._accumulatedElevation+=U*A,this._offsetXPrev=L,this._offsetYPrev=F,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function In(g,o){return[-(g[0]-Math.floor(g[0]/o)*o),-(g[1]-Math.floor(g[1]/o)*o),-(g[2]-Math.floor(g[2]/o)*o)]}function cb(g){const o=a.eq(1323123451230),h=[];for(let _=0;_<g;++_){const v=2*o()-1,S=2*o()-1,T=2*o()-1;h.push(a.d4(v,S,T))}return h}function yl(g,o,h,_,v){const S=a.aA((v-h)/(_-h),0,1);return(1-S)*g+S*o}class Mf{constructor(o){this._movement=new ti,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new a_,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,h){const _=o.transform;this._movement.update(_,this._ppmScaleFactor);const v=_.starsProjMatrix,S=a.c6([]);a.c8(S,S,a.an(90)-_._pitch),a.c7(S,S,-_.angle);const T=a.cb(new Float32Array(16),S),I=a.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=a.ef([],I),L=a.aB([],A,T),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*h,this._prevTime=F,{projectionMatrix:v,modelviewMatrix:L}}}class im extends Mf{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ho(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const h=o.context;if(!this.particlesVx){const _=cb(this.particlesCount),v=new a.eM,S=new a.b0;let T=0;const I=a.eq(1323123451230);for(let A=0;A<_.length;++A){const L=_[A],F=[2*I()-1,I(),I(),I()];v.emplaceBack(L[0],L[1],L[2],-1,-1,...F),v.emplaceBack(L[0],L[1],L[2],1,-1,...F),v.emplaceBack(L[0],L[1],L[2],1,1,...F),v.emplaceBack(L[0],L[1],L[2],-1,1,...F),S.emplaceBack(T+0,T+1,T+2),S.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=h.createVertexBuffer(v,OT.members),this.particlesIdx=h.createIndexBuffer(S)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=o.transform.zoom;if(h.revealStart>_)return;const v=yl(0,1,h.revealStart,h.revealStart+h.revealRange,_);if(!this.particlesVx||!this.particlesIdx)return;const S=structuredClone(this._params);let T=[-S.direction.x,S.direction.y,-100];a.aw(T,T);const I=structuredClone(this._vignetteParams);I.strength*=v,S.overrideStyleParameters||(S.intensity=o.style.rain.state.density,S.timeFactor=o.style.rain.state.intensity,S.color=structuredClone(o.style.rain.state.color),T=structuredClone(o.style.rain.state.direction),S.screenThinning.intensity=o.style.rain.state.centerThinning,S.dropletSizeX=o.style.rain.state.dropletSize[0],S.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],S.distortionStrength=100*o.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(o.style.rain.state.vignetteColor));const A=this.updateOnRender(o,S.timeFactor),L=o.context,F=L.gl,H=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new a.T(L,{width:o.width,height:o.height,data:null},F.RGBA8)),S.distortionStrength>0&&(L.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const U=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(L,U),L.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Y=[S.color.r,S.color.g,S.color.b,S.color.a],te=(se,fe)=>{const de=In(this._movement.getPosition(),se),_e=S.dropletSizeX,Ee=S.dropletSizeX*S.dropletSizeYScale,xe=o.width/2,Re=o.height/2,Te=yl(0,S.screenThinning.start,0,1,S.screenThinning.intensity),De=yl(.001,S.screenThinning.range,0,1,S.screenThinning.intensity),Pe=yl(0,S.screenThinning.particleOffset,0,1,S.screenThinning.intensity),Ie=(Oe={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:S.velocityConeAperture,velocity:S.velocity,boxSize:se,rainDropletSize:[_e,Ee],distortionStrength:S.distortionStrength,rainDirection:T,color:Y,screenSize:[H.width,H.height],thinningCenterPos:[xe,Re],thinningShape:[Te,De,Math.pow(10,S.screenThinning.fadePower)],thinningAffectedRatio:S.screenThinning.affectedRatio,thinningParticleOffset:Pe,shapeDirectionalPower:S.shapeDirPower,shapeNormalPower:S.shapeNormalPower,mode:fe?0:1},{u_modelview:Float32Array.from(Oe.modelview),u_projection:Float32Array.from(Oe.projection),u_time:Oe.time,u_cam_pos:Oe.camPos,u_texScreen:0,u_velocityConeAperture:Oe.velocityConeAperture,u_velocity:Oe.velocity,u_boxSize:Oe.boxSize,u_rainDropletSize:Oe.rainDropletSize,u_distortionStrength:Oe.distortionStrength,u_rainDirection:Oe.rainDirection,u_color:Oe.color,u_screenSize:Oe.screenSize,u_thinningCenterPos:Oe.thinningCenterPos,u_thinningShape:Oe.thinningShape,u_thinningAffectedRatio:Oe.thinningAffectedRatio,u_thinningParticleOffset:Oe.thinningParticleOffset,u_shapeDirectionalPower:Oe.shapeDirectionalPower,u_shapeNormalPower:Oe.shapeNormalPower,u_mode:Oe.mode});var Oe;const et=Math.round(S.intensity*this.particlesCount),Ke=a.bf.simpleSegment(0,0,4*et,2*et);U.draw(o,F.TRIANGLES,wr.disabled,en.disabled,vn.alphaBlended,Xr.disabled,Ie,"rain_particles",this.particlesVx,this.particlesIdx,Ke)};S.distortionStrength>0&&te(S.boxSize,!0),te(S.boxSize,!1),this._vignette.draw(o,I)}}const Td=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ub extends Mf{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ho(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const h=o.context;if(!this.particlesVx){const _=cb(this.particlesCount),v=new a.eN,S=new a.b0;let T=0;const I=a.eq(1323123451230);for(let A=0;A<_.length;++A){const L=_[A],F=I(),H=I(),U=I(),Y=[A/_.length,F,H,U],te=[I(),I()];v.emplaceBack(L[0],L[1],L[2],-1,-1,...Y,...te),v.emplaceBack(L[0],L[1],L[2],1,-1,...Y,...te),v.emplaceBack(L[0],L[1],L[2],1,1,...Y,...te),v.emplaceBack(L[0],L[1],L[2],-1,1,...Y,...te),S.emplaceBack(T+0,T+1,T+2),S.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=h.createVertexBuffer(v,Td.members),this.particlesIdx=h.createIndexBuffer(S)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const h=structuredClone(this._params);let _=[-h.direction.x,h.direction.y,-100];a.aw(_,_);const v=structuredClone(this._vignetteParams),S=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=o.transform.zoom;if(S.revealStart>T)return;const I=yl(0,1,S.revealStart,S.revealStart+S.revealRange,T);v.strength*=I,h.overrideStyleParameters||(h.intensity=o.style.snow.state.density,h.timeFactor=o.style.snow.state.intensity,h.color=structuredClone(o.style.snow.state.color),_=structuredClone(o.style.snow.state.direction),h.screenThinning.intensity=o.style.snow.state.centerThinning,h.billboardSize=2.79*o.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(o.style.snow.state.vignetteColor));const A=this.updateOnRender(o,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=o.context,F=L.gl,H=o.transform,U=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(L,U),((Y,te,se)=>{const fe=In(this._movement.getPosition(),Y),de=H.width/2,_e=H.height/2,Ee=yl(0,se.screenThinning.start,0,1,se.screenThinning.intensity),xe=yl(.001,se.screenThinning.range,0,1,se.screenThinning.intensity),Re=yl(0,se.screenThinning.particleOffset,0,1,se.screenThinning.intensity),Te=(De={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:fe,velocityConeAperture:se.velocityConeAperture,velocity:se.velocity,horizontalOscillationRadius:se.horizontalOscillationRadius,horizontalOscillationRate:se.horizontalOscillationRate,boxSize:Y,billboardSize:1*se.billboardSize,simpleShapeParameters:[se.shapeFadeStart,se.shapeFadePower],screenSize:[H.width,H.height],thinningCenterPos:[de,_e],thinningShape:[Ee,xe,Math.pow(10,se.screenThinning.fadePower)],thinningAffectedRatio:se.screenThinning.affectedRatio,thinningParticleOffset:Re,color:[se.color.r,se.color.g,se.color.b,se.color.a],direction:_},{u_modelview:Float32Array.from(De.modelview),u_projection:Float32Array.from(De.projection),u_time:De.time,u_cam_pos:De.camPos,u_velocityConeAperture:De.velocityConeAperture,u_velocity:De.velocity,u_horizontalOscillationRadius:De.horizontalOscillationRadius,u_horizontalOscillationRate:De.horizontalOscillationRate,u_boxSize:De.boxSize,u_billboardSize:De.billboardSize,u_simpleShapeParameters:De.simpleShapeParameters,u_screenSize:De.screenSize,u_thinningCenterPos:De.thinningCenterPos,u_thinningShape:De.thinningShape,u_thinningAffectedRatio:De.thinningAffectedRatio,u_thinningParticleOffset:De.thinningParticleOffset,u_particleColor:De.color,u_direction:De.direction});var De;const Pe=Math.round(se.intensity*this.particlesCount),Ie=a.bf.simpleSegment(0,0,4*Pe,2*Pe);this.particlesVx&&this.particlesIdx&&U.draw(o,F.TRIANGLES,wr.disabled,en.disabled,vn.alphaBlended,Xr.disabled,Te,"snow_particles",this.particlesVx,this.particlesIdx,Ie)})(h.boxSize,0,h),this._vignette.draw(o,v)}}const db={symbol:function(g,o,h,_,v){if(g.renderPass!=="translucent")return;const S=en.disabled,T=g.colorModeForRenderPass(),I=h.layout.get("text-variable-anchor"),A=h.layout.get("text-size-scale-range"),L=a.aA(g.scaleFactor,A[0],A[1]);I&&function(U,Y,te,se,fe,de,_e,Ee){const xe=Y.transform,Re=fe==="map",Te=de==="map";for(const De of U){const Pe=se.getTile(De),Ie=Pe.getBucket(te);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;const Oe=a.bJ(Ie.textSizeData,xe.zoom,Ee),et=Sf(De,Ie.getProjection(),xe),Ke=xe.calculatePixelsToTileUnitsMatrix(Pe),pt=_h(et,Pe.tileID.canonical,Te,Re,xe,Ie.getProjection(),Ke),ot=Ie.hasIconTextFit()&&Ie.hasIconData();Oe&&vx(Ie,Re,Te,_e,xe,pt,De,Math.pow(2,xe.zoom-Pe.tileID.overscaledZ),Oe,ot)}}(_,g,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v,L);const F=h.paint.get("icon-opacity").constantOr(1)!==0,H=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||H)?n_(g,o,h,_,S,T):(F&&n_(g,o,h,_,S,T,{onlyIcons:!0}),H&&n_(g,o,h,_,S,T,{onlyText:!0})),o.map.showCollisionBoxes&&(r_(g,o,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),r_(g,o,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,o,h,_){if(g.renderPass!=="translucent")return;const v=h.paint.get("circle-opacity"),S=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),I=h.layout.get("circle-sort-key").constantOr(1)!==void 0,A=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(S.constantOr(1)===0||T.constantOr(1)===0))return;const L=g.context,F=L.gl,H=g.transform,U=!(!g.terrain||!g.terrain.enabled),Y=h.layout.get("circle-elevation-reference"),te=g.depthModeForSublayer(0,wr.ReadOnly),se=new wr(g.context.gl.LEQUAL,wr.ReadOnly,g.depthRangeFor3D),fe=Y==="none"||U?te:se,de=en.disabled,_e=g.colorModeForDrapableLayerRenderPass(A),Ee=H.projection.name==="globe",xe=[a.aF(H.center.lng),a.aJ(H.center.lat)],Re=[];for(let De=0;De<_.length;De++){const Pe=_[De],Ie=o.getTile(Pe),Oe=Ie.getBucket(h);if(!Oe||Oe.projection.name!==H.projection.name)continue;const et=Oe.programConfigurations.get(h.id),Ke=Oe.layoutVertexBuffer,pt=Oe.globeExtVertexBuffer,ot=Oe.indexBuffer,vt=a.d$(h),qt=[pt],nt=g.isTileAffectedByFog(Pe);Ee&&vt.push("PROJECTION_GLOBE_VIEW"),vt.push("DEPTH_D24"),g.terrain&&H.depthOcclusionForSymbolsAndCircles&&vt.push("DEPTH_OCCLUSION"),Oe.hasElevation&&!g.terrain&&(vt.push("ELEVATED_ROADS"),qt.push(Oe.elevatedLayoutVertexBuffer));const Ue=g.getOrCreateProgram("circle",{config:et,defines:vt,overrideFog:nt}),wt=H.projection.createInversionMatrix(H,Pe.canonical),lt={programConfiguration:et,program:Ue,layoutVertexBuffer:Ke,dynamicBuffers:qt,indexBuffer:ot,uniformValues:a.e0(g,Pe,Ie,wt,xe,h),tile:Ie};if(I){const Pt=Oe.segments.get();for(const Kt of Pt)Re.push({segments:new a.bf([Kt]),sortKey:Kt.sortKey,state:lt})}else Re.push({segments:Oe.segments,sortKey:0,state:lt})}I&&Re.sort((De,Pe)=>De.sortKey-Pe.sortKey);const Te={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const De of Re){const{programConfiguration:Pe,program:Ie,layoutVertexBuffer:Oe,dynamicBuffers:et,indexBuffer:Ke,uniformValues:pt,tile:ot}=De.state,vt=De.segments;g.terrain&&g.terrain.setupElevationDraw(ot,Ie,Te),g.uploadCommonUniforms(L,Ie,ot.tileID.toUnwrapped()),Ie.draw(g,F.TRIANGLES,fe,de,_e,Xr.disabled,pt,h.id,Oe,Ke,vt,h.paint,H.zoom,Pe,et)}},heatmap:function(g,o,h,_){if(h.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const v=g.context,S=v.gl,T=en.disabled,I=new vn([S.ONE,S.ONE,S.ONE,S.ONE],a.ao.transparent,[!0,!0,!0,!0]);(function(Y,te,se,fe){const de=Y.gl,_e=te.width*fe,Ee=te.height*fe;Y.activeTexture.set(de.TEXTURE1),Y.viewport.set([0,0,_e,Ee]);let xe=se.heatmapFbo;if(!xe||xe&&(xe.width!==_e||xe.height!==Ee)){xe&&xe.destroy();const Re=de.createTexture();de.bindTexture(de.TEXTURE_2D,Re),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_S,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_T,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MIN_FILTER,de.LINEAR),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MAG_FILTER,de.LINEAR),xe=se.heatmapFbo=Y.createFramebuffer(_e,Ee,!0,null),function(Te,De,Pe,Ie,Oe,et){const Ke=Te.gl;Ke.texImage2D(Ke.TEXTURE_2D,0,Te.extRenderToTextureHalfFloat?Ke.RGBA16F:Ke.RGBA,Oe,et,0,Ke.RGBA,Te.extRenderToTextureHalfFloat?Ke.HALF_FLOAT:Ke.UNSIGNED_BYTE,null),Ie.colorAttachment.set(Pe)}(Y,0,Re,xe,_e,Ee)}else de.bindTexture(de.TEXTURE_2D,xe.colorAttachment.get()),Y.bindFramebuffer.set(xe.framebuffer)})(v,g,h,g.transform.projection.name==="globe"?.5:.25),v.clear({color:a.ao.transparent});const A=g.transform,L=A.projection.name==="globe",F=L?["PROJECTION_GLOBE_VIEW"]:[],H=L?Xr.frontCCW:Xr.disabled,U=[a.aF(A.center.lng),a.aJ(A.center.lat)];for(let Y=0;Y<_.length;Y++){const te=_[Y];if(o.hasRenderableParent(te))continue;const se=o.getTile(te),fe=se.getBucket(h);if(!fe||fe.projection.name!==A.projection.name)continue;const de=g.isTileAffectedByFog(te),_e=fe.programConfigurations.get(h.id),Ee=g.getOrCreateProgram("heatmap",{config:_e,defines:F,overrideFog:de}),{zoom:xe}=g.transform;g.terrain&&g.terrain.setupElevationDraw(se,Ee),g.uploadCommonUniforms(v,Ee,te.toUnwrapped());const Re=A.projection.createInversionMatrix(A,te.canonical);Ee.draw(g,S.TRIANGLES,wr.disabled,T,I,H,ST(g,te,se,Re,U,xe,h.paint.get("heatmap-intensity")),h.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,h.paint,g.transform.zoom,_e,L?[fe.globeExtVertexBuffer]:null)}v.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(v,S){const T=v.context,I=T.gl,A=S.heatmapFbo;if(!A)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,A.colorAttachment.get()),T.activeTexture.set(I.TEXTURE1);let L=S.colorRampTexture;L||(L=S.colorRampTexture=new a.T(T,S.colorRamp,I.RGBA8)),L.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,I.TRIANGLES,wr.disabled,en.disabled,v.colorModeForRenderPass(),Xr.disabled,((F,H,U,Y)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,S),S.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,S.paint,v.transform.zoom)}(g,h))},line:function(g,o,h,_){if(g.renderPass!=="translucent")return;const v=h.paint.get("line-opacity"),S=h.paint.get("line-width");if(v.constantOr(1)===0||S.constantOr(1)===0)return;const T=h.paint.get("line-emissive-strength"),I=h.paint.get("line-occlusion-opacity"),A=h.layout.get("line-elevation-reference"),L=h.layout.get("line-width-unit")==="meters",F=A==="sea",H=!(!g.terrain||!g.terrain.enabled),U=g.context,Y=U.gl;if(h.hasElevatedBuckets&&g.transform.projection.name==="globe")return;const te=h.layout.get("line-cross-slope"),se=te!==void 0,fe=te<1,de=g.colorModeForDrapableLayerRenderPass(T),_e=g.terrain&&g.terrain.renderingToTexture,Ee=_e?1:a.o.devicePixelRatio,xe=h.paint.get("line-dasharray"),Re=xe.constantOr(1),Te=h.layout.get("line-cap"),De=xe.constantOr(null),Pe=Te.constantOr(null),Ie=h.paint.get("line-pattern"),Oe=Ie.constantOr(1),et=h.paint.get("line-pattern-cross-fade"),Ke=Ie.constantOr(null),pt=h.paint.get("line-opacity").constantOr(1);let ot=!Oe&&pt!==1||g.depthOcclusion&&I>0&&I<1;const vt=h.paint.get("line-gradient"),qt=Oe?"linePattern":"line",nt=a.e1(h);let Ue;if(_e&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ot=!1),I!==0&&g.depthOcclusion){const Kt=h.paint._values["line-opacity"];Kt&&Kt.value&&Kt.value.kind==="constant"?Ue=Kt.value:a.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}S.value.kind!=="constant"&&S.value.isLineProgressConstant===!1&&nt.push("VARIABLE_LINE_WIDTH");const wt=(Kt,gr,Ut,Ht,yr,lr)=>{for(const sr of Kt){const cr=o.getTile(sr);if(Oe&&!cr.patternsLoaded())continue;const Lr=cr.getBucket(h);if(!Lr||Lr.elevationType!=="none"&&!yr||Lr.elevationType==="none"&&yr)continue;g.prepareDrawTile();const Cn=[...gr],Un=g.shadowRenderer,Is=Lr.elevationType==="road"&&!!Un&&Un.enabled;let Yr=[0,0,0];if(Is){const Jr=g.style.directionalLight,Gn=g.style.ambientLight;Jr&&Gn&&(Yr=Lc(g.style,Jr,Gn)),Cn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Bn=Lr.programConfigurations.get(h.id);let pn=!1;if(Ke&&cr.imageAtlas){const Jr=a.e2.from(Ke),Gn=Jr.getPrimary().scaleSelf(Ee).toString(),pi=cr.imageAtlas.patternPositions.get(Gn),Vi=Jr.getSecondary(),vi=Vi?cr.imageAtlas.patternPositions.get(Vi.scaleSelf(Ee).toString()):null;pn=!!pi&&!!vi,pi&&Bn.setConstantPatternPositions(pi,vi)}et>0&&(pn||Bn.getPatternTransitionVertexBuffer("line-pattern"))&&Cn.push("LINE_PATTERN_TRANSITION");const Ss=g.isTileAffectedByFog(sr),$n=g.getOrCreateProgram(qt,{config:Bn,defines:Cn,overrideFog:Ss});if(!Oe&&De&&Pe&&cr.lineAtlas){const Jr=cr.lineAtlas.getDash(De,Pe);Jr&&Bn.setConstantPatternPositions(Jr)}Is&&Un.setupShadows(cr.tileID.toUnwrapped(),$n,"vector-tile");let[Vs,Jn]=h.paint.get("line-trim-offset");(Pe==="round"||Pe==="square")&&Vs!==Jn&&(Vs===0&&(Vs-=1),Jn===1&&(Jn+=1));const gn=_e?sr.projMatrix:null,us=L?1/Lr.tileToMeter/a.ay(cr,1,g.transform.zoom):1,wn=L?1/Lr.tileToMeter/a.ay(cr,1,Math.floor(g.transform.zoom)):1,ei=Oe?a.e3(g,cr,h,gn,Ee,us,wn,[Vs,Jn],Yr,et):a.e4(g,cr,h,gn,Lr.lineClipsArray.length,Ee,us,wn,[Vs,Jn],Yr);if(vt){const Jr=Lr.gradients[h.id];let Gn=Jr.texture;if(h.gradientVersion!==Jr.version){let pi=256;if(h.stepInterpolant){const Vi=o.getSource().maxzoom,vi=sr.canonical.z===Vi?Math.ceil(1<<g.transform.maxZoom-sr.canonical.z):1;pi=a.aA(a.e5(Lr.maxLineLength/a.al*1024*vi),256,U.maxTextureSize)}Jr.gradient=a.e6({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:Jr.gradient||void 0,clips:Lr.lineClipsArray}),Jr.texture?Jr.texture.update(Jr.gradient):Jr.texture=new a.T(U,Jr.gradient,Y.RGBA8),Jr.version=h.gradientVersion,Gn=Jr.texture}U.activeTexture.set(Y.TEXTURE1),Gn.bind(h.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}Re&&(U.activeTexture.set(Y.TEXTURE0),cr.lineAtlasTexture&&cr.lineAtlasTexture.bind(Y.LINEAR,Y.REPEAT),Bn.updatePaintBuffers()),Oe&&(U.activeTexture.set(Y.TEXTURE0),cr.imageAtlasTexture&&cr.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Bn.updatePaintBuffers()),yr&&!F&&g.terrain.setupElevationDraw(cr,$n),g.uploadCommonUniforms(U,$n,sr.toUnwrapped());const ps=Jr=>{Ue!=null&&(Ue.value=pt*I),$n.draw(g,Y.TRIANGLES,Ut,Jr,de,Xr.disabled,ei,h.id,Lr.layoutVertexBuffer,Lr.indexBuffer,Lr.segments,h.paint,g.transform.zoom,Bn,[Lr.layoutVertexBuffer2,Lr.patternVertexBuffer,Lr.zOffsetVertexBuffer]),Ue!=null&&(Ue.value=pt)};if(ot&&!yr){const Jr=g.stencilModeForClipping(sr).ref;Jr===0&&_e&&U.clear({stencil:0});const Gn={func:Y.EQUAL,mask:255};ei.u_alpha_discard_threshold=.8,ps(new en(Gn,Jr,255,Y.KEEP,Y.KEEP,Y.INVERT)),ei.u_alpha_discard_threshold=0,ps(new en(Gn,Jr,255,Y.KEEP,Y.KEEP,Y.KEEP))}else ei.u_alpha_discard_threshold=ot&&yr&&lr?.8:0,ps(yr?Ht:g.stencilModeForClipping(sr))}};let lt=g.depthModeForSublayer(0,wr.ReadOnly);const Pt=new wr(g.depthOcclusion?Y.GREATER:Y.LEQUAL,wr.ReadOnly,g.depthRangeFor3D);if(h.hasNonElevatedBuckets){const Kt=!_e&&g.terrain;I!==0&&Kt?a.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):Kt?a.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):wt(_,nt,lt,en.disabled,!1,!0)}if(h.hasElevatedBuckets){A==="hd-road-markup"?H||(lt=Pt,nt.push("ELEVATED_ROADS")):(nt.push("ELEVATED"),lt=Pt,se&&nt.push(fe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&nt.push("ELEVATION_REFERENCE_SEA"));const Kt=ot?g.stencilModeFor3D():en.disabled;g.forceTerrainMode=!0,wt(_,nt,lt,Kt,!0,!0),ot&&wt(_,nt,lt,Kt,!0,!1),g.forceTerrainMode=!1}ot&&(g.resetStencilClippingMasks(),_e&&U.clear({stencil:0})),I===0||g.depthOcclusion||_e||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,o,h,_){const v=h.paint.get("fill-color"),S=h.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const T=h.paint.get("fill-emissive-strength"),I=g.colorModeForDrapableLayerRenderPass(T),A=h.paint.get("fill-pattern"),L=g.opaquePassEnabledForLayer()&&!A.constantOr(1)&&v.constantOr(a.ao.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";let F="none";h.layout.get("fill-elevation-reference")!=="none"?F="road":h.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const H=!(!g.terrain||!g.terrain.enabled),U={painter:g,sourceCache:o,layer:h,coords:_,colorMode:I,elevationType:F,terrainEnabled:H,pass:L};if(g.renderPass!=="shadow")if(F!=="offset"){if(Jp(U,!1),F==="road"){const Y=!H&&g.renderPass==="translucent";Y&&Pf(g,o,h,_,"geometry"),Jp(U,!0,en.disabled),Y&&function(te){const{painter:se,sourceCache:fe,layer:de,coords:_e,colorMode:Ee}=te,xe=se.context.gl,Re=te.painter.shadowRenderer,Te=!!Re&&Re.enabled,De=new wr(se.context.gl.LEQUAL,wr.ReadOnly,se.depthRangeFor3D);let Pe=[0,0,0];if(Te){const Oe=se.style.directionalLight,et=se.style.ambientLight;Oe&&et&&(Pe=Lc(se.style,Oe,et))}const Ie=Oe=>{for(const et of _e){const Ke=fe.getTile(et),pt=Ke.getBucket(de);if(!pt)continue;const ot=pt.elevatedStructures;if(!ot)continue;let vt,qt;if(Oe?(vt=ot.renderableBridgeSegments,qt=ot.bridgeProgramConfigurations.get(de.id)):(vt=ot.renderableTunnelSegments,qt=ot.tunnelProgramConfigurations.get(de.id)),!vt||vt.segments[0].primitiveLength===0)continue;qt.updatePaintBuffers(),se.prepareDrawTile();const nt=se.isTileAffectedByFog(et),Ue=[];Te&&Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const wt=se.getOrCreateProgram("elevatedStructures",{config:qt,overrideFog:nt,defines:Ue}),lt=se.translatePosMatrix(et.projMatrix,Ke,de.paint.get("fill-translate"),de.paint.get("fill-translate-anchor"));Te&&Re.setupShadows(Ke.tileID.toUnwrapped(),wt,"vector-tile");const Pt=ZA(lt,Pe);se.uploadCommonUniforms(se.context,wt,et.toUnwrapped()),wt.draw(se,xe.TRIANGLES,De,en.disabled,Ee,Xr.backCCW,Pt,de.id,ot.vertexBuffer,ot.indexBuffer,vt,de.paint,se.transform.zoom,qt,[ot.vertexBufferNormal])}};Ie(!0),Ie(!1)}(U)}}else Jp(U,!1,g.stencilModeFor3D());else g.shadowRenderer&&F==="road"&&!H&&function(Y){const{painter:te,sourceCache:se,layer:fe,coords:de}=Y,_e=te.context.gl,Ee=Y.painter.shadowRenderer;for(const xe of de){const Re=se.getTile(xe),Te=Re.getBucket(fe);if(!Te)continue;const De=Te.elevatedStructures;if(!De||!De.shadowCasterSegments||De.shadowCasterSegments.segments[0].primitiveLength===0)continue;te.prepareDrawTile();const Pe=Te.bufferData.programConfigurations.get(fe.id),Ie=te.isTileAffectedByFog(xe),Oe=te.getOrCreateProgram("elevatedStructuresDepth",{config:Pe,overrideFog:Ie}),et=Ee.calculateShadowPassMatrixFromTile(Re.tileID.toUnwrapped());te.uploadCommonUniforms(te.context,Oe,xe.toUnwrapped());const Ke={u_matrix:et,u_depth_bias:0};Oe.draw(te,_e.TRIANGLES,Ee.getShadowPassDepthMode(),en.disabled,Ee.getShadowPassColorMode(),Xr.disabled,Ke,fe.id,De.vertexBuffer,De.indexBuffer,De.shadowCasterSegments,fe.paint,te.transform.zoom,Pe)}}(U)},"fill-extrusion":function(g,o,h,_){const v=h.paint.get("fill-extrusion-opacity"),S=g.context,T=S.gl,I=g.terrain,A=I&&I.renderingToTexture;if(v===0)return;const L=g.conflationActive&&g.style.isLayerClipped(h,o.getSource()),F=g.style.order.indexOf(h.fqid);if(L&&function(H,U,Y,te,se){for(const fe of te){const de=U.getTile(fe).getBucket(Y);de&&(de.updateReplacement(fe,H.replacementSource,se),de.uploadCentroid(H.context))}}(g,o,h,_,F),I||L)for(const H of _){const U=o.getTile(H).getBucket(h);U&&Ih(g.context,o,H,U,h,I,L)}if(g.renderPass==="shadow"&&g.shadowRenderer){const H=g.shadowRenderer;if(I&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.ad)return;const U=H.getShadowPassDepthMode(),Y=H.getShadowPassColorMode();hr(g,o,h,_,U,en.disabled,Y,L)}else if(g.renderPass==="translucent"){const H=!h.paint.get("fill-extrusion-pattern").constantOr(1),U=h.paint.get("fill-extrusion-color").constantOr(a.ao.white);if(!A&&U.a!==0){const Y=new wr(g.context.gl.LEQUAL,wr.ReadWrite,g.depthRangeFor3D);v===1&&H?hr(g,o,h,_,Y,en.disabled,vn.unblended,L):(hr(g,o,h,_,Y,en.disabled,vn.disabled,L),hr(g,o,h,_,Y,g.stencilModeFor3D(),g.colorModeForRenderPass(),L),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&H&&(!I&&g.transform.projection.name!=="globe"||A)){const Y=h.paint.get("fill-extrusion-opacity"),te=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),se=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),fe=h.paint.get("fill-extrusion-flood-light-intensity"),de=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",_e=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(de?null:h.lut).toArray01().slice(0,3),Ee=te>0&&se>0,xe=fe>0,Re=(Pe,Ie,Oe)=>(1-Oe)*Pe+Oe*Ie,Te=new Xw;Te.translate=h.paint.get("fill-extrusion-translate"),Te.translateAnchor=h.paint.get("fill-extrusion-translate-anchor"),Te.edgeRadius=h.layout.get("fill-extrusion-edge-radius"),Te.cutoffFadeRange=h.paint.get("fill-extrusion-cutoff-fade-range");const De=Pe=>{const Ie=g.depthModeForSublayer(1,wr.ReadOnly,T.LEQUAL,!0),Oe=h.paint.get(Pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),et=Re(.1,3,Oe),Ke=g._showOverdrawInspector;if(!Ke){const pt=new en({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ot=new vn([T.ONE,T.ONE,T.ONE,T.ONE],a.ao.transparent,[!1,!1,!1,!0],T.MIN);Sd(Te,g,o,h,_,Ie,pt,ot,Xr.disabled,Pe,"sdf",Y,te,se,fe,_e,et,L,!1)}{const pt=Ke?en.disabled:new en({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ot=Ke?g.colorModeForRenderPass():new vn([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],a.ao.transparent,[!0,!0,!0,!0]);Sd(Te,g,o,h,_,Ie,pt,ot,Xr.disabled,Pe,"color",Y,te,se,fe,_e,et,L,!1)}};if(A){const Pe=(Ie,Oe,et)=>{const Ke=g.depthModeForSublayer(1,wr.ReadOnly,T.LEQUAL,!1),pt=h.paint.get(Ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ot=Re(.1,3,pt);{const vt=new vn([T.ONE,T.ONE,T.ONE,T.ONE],a.ao.transparent,[!1,!1,!1,!0]);Sd(Te,g,o,h,_,Ke,en.disabled,vt,Xr.disabled,Ie,"clear",Y,te,se,fe,_e,ot,L,Oe)}{const vt=new en({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),qt=new vn([T.ONE,T.ONE,T.ONE,T.ONE],a.ao.transparent,[!1,!1,!1,!0],T.MIN);Sd(Te,g,o,h,_,Ke,vt,qt,Xr.disabled,Ie,"sdf",Y,te,se,fe,_e,ot,L,Oe)}{const vt=Ie?T.ZERO:T.ONE_MINUS_DST_ALPHA,qt=new en({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),nt=new vn([vt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],a.ao.transparent,[!0,!0,!0,!0]);Sd(Te,g,o,h,_,Ke,qt,nt,Xr.disabled,Ie,"color",Y,te,se,fe,_e,ot,L,Oe)}{const vt=new vn([T.ONE,T.ONE,T.ONE,Ie?T.ZERO:T.ONE],a.ao.transparent,[!1,!1,!1,!0],Ie?T.FUNC_ADD:T.MAX);Sd(Te,g,o,h,_,Ke,en.disabled,vt,Xr.disabled,Ie,"clear",Y,te,se,fe,_e,ot,L,Oe,et)}};if(Ee||xe){let Ie;if(g.prepareDrawTile(),I){const Oe=I.drapeBufferSize[0],et=I.drapeBufferSize[1];Ie=I.framebufferCopyTexture,Ie&&(!Ie||Ie.size[0]===Oe&&Ie.size[1]===et)||(Ie&&Ie.destroy(),Ie=I.framebufferCopyTexture=new a.T(S,new a.q({width:Oe,height:et}),T.RGBA8)),Ie.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Oe,et)}Ee&&Pe(!0,!1,Ie),xe&&Pe(!1,!0,Ie)}}else Ee&&De(!0),xe&&De(!1),(Ee||xe)&&g.resetStencilClippingMasks()}}},building:function(g,o,h,_){g.currentLayer<g.firstLightBeamLayer&&(g.firstLightBeamLayer=g.currentLayer);const v=h.paint.get("building-ambient-occlusion-ground-intensity"),S=h.paint.get("building-ambient-occlusion-ground-radius"),T=h.paint.get("building-ambient-occlusion-ground-attenuation"),I=h.paint.get("building-opacity");if(I<=0)return;let A=v>0&&S>0,L=!0;const F=h.paint.get("building-vertical-scale");if(F<=0)return;(!g.shadowRenderer||F<1)&&(L=!1);const H=g.conflationActive&&g.style.isLayerClipped(h,o.getSource()),U=g.style.order.indexOf(h.fqid);if(function(Y,te,se,fe,de,_e){for(const Ee of _e){const xe=te.getTile(Ee).getBucket(se);xe&&(de&&xe.updateReplacement(Ee,Y.replacementSource,fe),xe.uploadUpdatedIndexBuffer(Y.context))}}(g,o,h,U,H,_),function(Y,te,se,fe){for(const de of fe){const _e=te.getTile(de).getBucket(se);_e&&_e.needsEvaluation()&&_e.uploadUpdatedColorBuffer(Y.context)}}(g,o,h,_),h.resetLayerRenderingStats(g),g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0),g.renderPass==="shadow"&&g.shadowRenderer){const Y=g.shadowRenderer,te=[],se=Y.getShadowPassDepthMode();bx({painter:g,source:o,layer:h,coords:_,defines:te,blendMode:Y.getShadowPassColorMode(),depthMode:se,opacity:I,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(g.renderPass==="translucent"){let Y=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];L&&(Y=Y.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),g.shadowRenderer&&g.shadowRenderer.useNormalOffset&&(Y=Y.concat("NORMAL_OFFSET"));const te=h.paint.get("building-facade-emissive-chance"),se=h.paint.get("building-ambient-occlusion-intensity"),fe=h.paint.get("building-flood-light-intensity"),de=h.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",_e=h.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(de?null:h.lut).toArray01().slice(0,3),Ee=h.paint.get("building-flood-light-ground-attenuation"),xe=fe>0,Re=new wr(g.context.gl.LEQUAL,wr.ReadWrite,g.depthRangeFor3D);I<1&&bx({painter:g,source:o,layer:h,coords:_,defines:Y,blendMode:vn.disabled,depthMode:Re,opacity:I,verticalScale:F,facadeEmissiveChance:te,facadeAOIntensity:se,floodLightIntensity:fe,floodLightColor:_e,depthOnly:!0});const Te=g.colorModeForRenderPass();bx({painter:g,source:o,layer:h,coords:_,defines:Y,blendMode:Te,depthMode:Re,opacity:I,verticalScale:F,facadeEmissiveChance:te,facadeAOIntensity:se,floodLightIntensity:fe,floodLightColor:_e}),A&&Sx(g,o,h,_,!0,I,v,S,fe,_e,T,H),xe&&Sx(g,o,h,_,!1,I,v,S,fe,_e,Ee,H)}else if(g.renderPass==="light-beam"){const Y=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],te=new wr(g.context.gl.LEQUAL,wr.ReadOnly,g.depthRangeFor3D);bx({painter:g,source:o,layer:h,coords:_,defines:Y,blendMode:vn.alphaBlended,depthMode:te,opacity:I,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1),g.resetStencilClippingMasks()},hillshade:function(g,o,h,_){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const v=g.context,S=g.terrain&&g.terrain.renderingToTexture,[T,I]=g.renderPass!=="translucent"||S?[{},_]:g.stencilConfigForOverlap(_);for(const A of I){const L=o.getTile(A);if(L.needsHillshadePrepare&&g.renderPass==="offscreen")LA(g,L,h);else if(g.renderPass==="translucent"){const F=g.depthModeForSublayer(0,wr.ReadOnly),H=h.paint.get("hillshade-emissive-strength"),U=g.colorModeForDrapableLayerRenderPass(H),Y=S&&g.terrain?g.terrain.stencilModeForRTTOverlap(A):T[A.overscaledZ];OA(g,A,L,h,F,Y,U)}}v.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,o,h,_,v,S){if(g.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const T=g.transform.projection.name==="globe",I=h.paint.get("raster-elevation")!==0,A=I&&T;if(g.renderElevatedRasterBackface&&!A)return;const L=g.context,F=L.gl,H=o.getSource(),U=function(Te,De,Pe,Ie){const Oe=De.paint.get("raster-color"),et=Te.type==="raster-array",Ke=[],pt=De.paint.get("raster-resampling"),ot=De.paint.get("raster-color-mix");let vt=De.paint.get("raster-color-range");const qt=[ot[0],ot[1],ot[2],0],nt=ot[3];let Ue=pt==="nearest"?Ie.NEAREST:Ie.LINEAR;if(et&&(Ke.push("RASTER_ARRAY"),Oe||Ke.push("RASTER_COLOR"),pt==="linear"&&Ke.push("RASTER_ARRAY_LINEAR"),Ue=Ie.NEAREST,!vt&&Te.rasterLayers)){const wt=Te.rasterLayers.find(({id:lt})=>lt===De.sourceLayer);wt&&wt.fields&&wt.fields.range&&(vt=wt.fields.range)}if(vt=vt||[0,1],Oe){Ke.push("RASTER_COLOR"),Pe.activeTexture.set(Ie.TEXTURE2),De.updateColorRamp(vt);let wt=De.colorRampTexture;wt||(wt=De.colorRampTexture=new a.T(Pe,De.colorRamp,Ie.RGBA8)),wt.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}return{mix:qt,range:vt,offset:nt,defines:Ke,resampling:Ue}}(H,h,L,F);if(H instanceof a.aT&&!_.length&&!T)return;const Y=h.paint.get("raster-emissive-strength"),te=g.colorModeForDrapableLayerRenderPass(Y),se=g.terrain&&g.terrain.renderingToTexture,fe=!g.options.moving,de=h.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(H instanceof a.aT&&!_.length&&(H.onNorthPole||H.onSouthPole)){const Te=I?g.stencilModeFor3D():en.disabled;return void Qw(!!H.onNorthPole,null,g,o,h,Y,U,Xr.disabled,Te)}if(!_.length)return;const[_e,Ee]=H instanceof a.aT||se?[{},_]:g.stencilConfigForOverlap(_),xe=Ee[Ee.length-1].overscaledZ;A&&U.defines.push("PROJECTION_GLOBE_VIEW"),I&&U.defines.push("RENDER_CUTOFF");const Re=(Te,De,Pe)=>{for(const Ie of Te){const Oe=Ie.toUnwrapped(),et=o.getTile(Ie);if(se&&(!et||!et.hasData()))continue;L.activeTexture.set(F.TEXTURE0);const Ke=YA(et,H,h,U);if(!Ke||!Ke.texture)continue;const{texture:pt,mix:ot,offset:vt,tileSize:qt,buffer:nt}=Ke;let Ue,wt;se?(Ue=wr.disabled,wt=Ie.projMatrix):I?(Ue=new wr(F.LEQUAL,wr.ReadWrite,g.depthRangeFor3D),wt=T?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Oe,fe)):(Ue=g.depthModeForSublayer(Ie.overscaledZ-xe,h.paint.get("raster-opacity")===1?wr.ReadWrite:wr.ReadOnly,F.LESS),wt=g.transform.calculateProjMatrix(Oe,fe));const lt=g.terrain&&se?g.terrain.stencilModeForRTTOverlap(Ie):_e[Ie.overscaledZ],Pt=S?0:h.paint.get("raster-fade-duration");et.registerFadeDuration(Pt);const Kt=o.findLoadedParent(Ie,0),gr=ax(et,Kt,o,g.transform,Pt);let Ut,Ht;!gr.isFading&&et.refreshedUponExpiration&&(et.refreshedUponExpiration=!1),g.terrain&&g.terrain.prepareDrawTile(),L.activeTexture.set(F.TEXTURE0),pt.bind(de,F.CLAMP_TO_EDGE),L.activeTexture.set(F.TEXTURE1),Kt?(Kt.texture&&Kt.texture.bind(de,F.CLAMP_TO_EDGE),Ut=Math.pow(2,Kt.tileID.overscaledZ-et.tileID.overscaledZ),Ht=[et.tileID.canonical.x*Ut%1,et.tileID.canonical.y*Ut%1]):pt.bind(de,F.CLAMP_TO_EDGE),"useMipmap"in pt&&L.extTextureFilterAnisotropic&&g.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const yr=g.transform;let lr;const sr=I?NT(yr):[0,0,0,0];let cr,Lr,Cn,Un,Is,Yr=0;if(A&&H instanceof a.aT&&H.coordinates.length>3)cr=Float32Array.from(a.bj(a.dI(new a.cC(0,0,0)))),Lr=Float32Array.from(yr.globeMatrix),Cn=Float32Array.from(a.dE(yr)),Un=[a.aF(yr.center.lng),a.aJ(yr.center.lat)],lr=H.elevatedGlobePerspectiveTransform,Is=H.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const $n=a.dF(Ie.canonical);Yr=a.dG($n.getCenter().lat),cr=Float32Array.from(a.bj(a.dI(Ie.canonical))),Lr=Float32Array.from(yr.globeMatrix),Cn=Float32Array.from(a.dE(yr)),Un=[a.aF(yr.center.lng),a.aJ(yr.center.lat)],lr=[0,0],Is=Float32Array.from(a.dH(Ie.canonical,$n,Yr,yr.worldSize/yr._pixelsPerMercatorPixel))}else lr=H instanceof a.aT?H.perspectiveTransform:[0,0],cr=new Float32Array(16),Lr=new Float32Array(9),Cn=new Float32Array(16),Un=[0,0],Is=new Float32Array(9);const Bn=t_(wt,cr,Lr,Cn,Is,Ht||[0,0],a.aj(g.transform.zoom),Un,sr,Ut||1,gr,h,lr,I?h.paint.get("raster-elevation"):0,2,ot,vt,U.range,qt,nt,Y),pn=g.isTileAffectedByFog(Ie),Ss=g.getOrCreateProgram("raster",{defines:U.defines,overrideFog:pn});if(g.uploadCommonUniforms(L,Ss,Oe),H instanceof a.aT){const $n=H.elevatedGlobeVertexBuffer,Vs=H.elevatedGlobeIndexBuffer;if(se||!T)H.boundsBuffer&&H.boundsSegments&&Ss.draw(g,F.TRIANGLES,Ue,en.disabled,te,Xr.disabled,Bn,h.id,H.boundsBuffer,g.quadTriangleIndexBuffer,H.boundsSegments);else if($n&&Vs){const Jn=yr.zoom<=a.cZ?H.elevatedGlobeSegments:H.getSegmentsForLongitude(yr.center.lng);Jn&&Ss.draw(g,F.TRIANGLES,Ue,en.disabled,te,De,Bn,h.id,$n,Vs,Jn)}}else if(A){Ue=new wr(F.LEQUAL,wr.ReadOnly,g.depthRangeFor3D);const $n=g.globeSharedBuffers;if($n){const[Vs,Jn,gn]=$n.getGridBuffers(Yr,!1);Ss.draw(g,F.TRIANGLES,Ue,Pe||lt,g.colorModeForRenderPass(),De,Bn,h.id,Vs,Jn,gn)}}else{const{tileBoundsBuffer:$n,tileBoundsIndexBuffer:Vs,tileBoundsSegments:Jn}=g.getTileBoundsBuffers(et);Ss.draw(g,F.TRIANGLES,Ue,lt,te,Xr.disabled,Bn,h.id,$n,Vs,Jn)}}if(!(H instanceof a.aT)&&A)for(const Ie of Te){const Oe=Ie.canonical.y===(1<<Ie.canonical.z)-1;Ie.canonical.y===0&&Qw(!0,Ie,g,o,h,Y,U,De,Pe||en.disabled),Oe&&Qw(!1,Ie,g,o,h,Y,U,De===Xr.frontCW?Xr.backCW:Xr.frontCW,Pe||en.disabled)}};A?Re(Ee,g.renderElevatedRasterBackface?Xr.backCW:Xr.frontCW,g.stencilModeFor3D()):Re(Ee,Xr.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,o,h,_,v,S){g.renderPass==="offscreen"&&function(T,I,A,L){if(!L.length)return;const F=T.context,H=F.gl,U=I.getSource();if(!(U instanceof Mi))return;const Y=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let te=A.particlePositionRGBAImage;if(!te||te.width!==Y){const Ee=function(xe){const Re=xe*xe,Te=new Uint8Array(4*Re),De=function(Ie){return Ie|=0,Ie=Math.imul(2747636419^Ie,2654435769),Ie=Math.imul(Ie^Ie>>>16,2654435769),((Ie=Math.imul(Ie^Ie>>>16,2654435769))>>>0)/4294967296},Pe=1/1.1;for(let Ie=0;Ie<Re;Ie++){const Oe=Pe*(De(2*Ie+0)+Af),et=Pe*(De(2*Ie+1)+Af),Ke=255*Oe%1,pt=255*et%1,ot=Ke,vt=et-pt/255,qt=pt;Te[4*Ie+0]=255*(Oe-Ke/255),Te[4*Ie+1]=255*ot,Te[4*Ie+2]=255*vt,Te[4*Ie+3]=255*qt}return Te}(Y);te=A.particlePositionRGBAImage=new a.q({width:Y,height:Y},Ee)}let se=A.particleFramebuffer;se?se.width!==Y&&(se.destroy(),se=A.particleFramebuffer=F.createFramebuffer(Y,Y,!0,null)):se=A.particleFramebuffer=F.createFramebuffer(Y,Y,!0,null);const fe=[];for(const Ee of L){const xe=I.getTile(Ee);if(!(xe instanceof pu))continue;const Re=eb(xe,U,A);if(!Re)continue;const Te=[xe.tileSize,xe.tileSize];let De=A.tileFramebuffer;De||(De=A.tileFramebuffer=F.createFramebuffer(Te[0],Te[1],!0,null));let Pe=xe.rasterParticleState;Pe||(Pe=xe.rasterParticleState=new Ml(F,Ee,Te,te));const Ie=Pe.update(A.lastInvalidatedAt);Pe.particleTextureDimension!==Y&&Pe.updateParticleTexture(Ee,te);const Oe=Pe.targetColorTexture;Pe.targetColorTexture=Pe.backgroundColorTexture,Pe.backgroundColorTexture=Oe;const et=Pe.particleTexture0;Pe.particleTexture0=Pe.particleTexture1,Pe.particleTexture1=et,fe.push([Ee,Re,Pe,Ie])}if(fe.length===0)return;const de=a.o.now(),_e=A.previousDrawTimestamp?.001*(de-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=de,A.hasColorMap()){F.activeTexture.set(H.TEXTURE0+2);let Ee=A.colorRampTexture;Ee||(Ee=A.colorRampTexture=new a.T(F,A.colorRamp,H.RGBA8)),Ee.bind(H.LINEAR,H.CLAMP_TO_EDGE)}F.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(Ee,xe,Re){const Te=Ee.context,De=Te.gl,Pe=xe.tileFramebuffer;Te.activeTexture.set(De.TEXTURE0);const Ie={u_texture:0,u_opacity:1.05*(et=xe.paint.get("raster-particle-fade-opacity-factor"))/(et+.05)},Oe=Ee.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var et;for(const Ke of Re){const[,,pt,ot]=Ke;Pe.colorAttachment.set(pt.targetColorTexture.texture),Te.viewport.set([0,0,Pe.width,Pe.height]),Te.clear({color:a.ao.transparent}),ot&&(pt.backgroundColorTexture.bind(De.NEAREST,De.CLAMP_TO_EDGE),Oe.draw(Ee,De.TRIANGLES,wr.disabled,en.disabled,vn.alphaBlended,Xr.disabled,Ie,xe.id,Ee.viewportBuffer,Ee.quadTriangleIndexBuffer,Ee.viewportSegments))}}(T,A,fe),function(Ee,xe,Re,Te){const De=Ee.context,Pe=De.gl,Ie=Re.tileFramebuffer,Oe=Ee.transform.projection.name==="globe",et=Re.paint.get("raster-particle-max-speed");for(const Ke of Te){const[pt,ot,vt]=Ke;De.activeTexture.set(Pe.TEXTURE0+0),ot.texture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),Ie.colorAttachment.set(vt.targetColorTexture.texture);const qt=Ee.getOrCreateProgram("rasterParticleDraw",{defines:ot.defines,overrideFog:!1});De.activeTexture.set(Pe.TEXTURE0+1);const nt=ot.scalarData?[]:[0,1,2,3].map(lt=>a.e8[lt](pt));nt.push(pt);const Ue=pt.canonical.x,wt=pt.canonical.y;for(const lt of nt){const Pt=xe.getTile(Oe?lt.wrapped():lt);if(!Pt)continue;const Kt=Pt.rasterParticleState;if(!Kt)continue;const gr=lt.canonical.x+(1<<lt.canonical.z)*(lt.wrap-pt.wrap),Ut=lt.canonical.y;Kt.particleTexture0.bind(Pe.NEAREST,Pe.CLAMP_TO_EDGE);const Ht=Gw(1,Kt.particleTexture0.size[0],[gr-Ue,Ut-wt],0,ot.texture.size,2,et,ot.textureOffset,ot.scale,ot.offset);qt.draw(Ee,Pe.POINTS,wr.disabled,en.disabled,vn.alphaBlended,Xr.disabled,Ht,Re.id,Kt.particleIndexBuffer,void 0,Kt.particleSegment)}}}(T,I,A,fe),F.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(Ee,xe,Re,Te){const De=Ee.context,Pe=De.gl,Ie=xe.paint.get("raster-particle-max-speed"),Oe=Te*xe.paint.get("raster-particle-speed-factor")*.15,et=function(pt){return Math.pow(pt,6)}(.01+1*xe.paint.get("raster-particle-reset-rate-factor")),Ke=xe.particleFramebuffer;De.viewport.set([0,0,Ke.width,Ke.height]);for(const pt of Re){const[,ot,vt]=pt;De.activeTexture.set(Pe.TEXTURE0+0),ot.texture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),De.activeTexture.set(Pe.TEXTURE0+1);const qt=vt.particleTexture0;qt.bind(Pe.NEAREST,Pe.CLAMP_TO_EDGE);const nt=fx(1,qt.size[0],0,ot.texture.size,Ie,Oe,et,ot.textureOffset,ot.scale,ot.offset);Ke.colorAttachment.set(vt.particleTexture1.texture),De.clear({color:a.ao.transparent}),Ee.getOrCreateProgram("rasterParticleUpdate",{defines:ot.defines}).draw(Ee,Pe.TRIANGLES,wr.disabled,en.disabled,vn.unblended,Xr.disabled,nt,xe.id,Ee.viewportBuffer,Ee.quadTriangleIndexBuffer,Ee.viewportSegments)}}(T,A,fe,_e)}(g,o,h,_),g.renderPass==="translucent"&&(function(T,I,A,L,F){const H=T.context,U=H.gl,Y=I.getSource().tileSize,te=5*(1-a.ah(a.cK,a.cK+1,T.transform.zoom))*Y+A.paint.get("raster-particle-elevation"),se=!T.options.moving,fe=T.transform.projection.name==="globe";if(!L.length)return;const[de,_e]=T.stencilConfigForOverlap(L),Ee=[];fe&&Ee.push("PROJECTION_GLOBE_VIEW");const xe=T.stencilModeFor3D();for(const Re of _e){const Te=Re.toUnwrapped(),De=I.getTile(Re);if(!De.rasterParticleState)continue;const Pe=De.rasterParticleState,Ie=100;De.registerFadeDuration(Ie);const Oe=I.findLoadedParent(Re,0),et=ax(De,Oe,I,T.transform,Ie);let Ke,pt;T.terrain&&T.terrain.prepareDrawTile(),H.activeTexture.set(U.TEXTURE0),Pe.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),H.activeTexture.set(U.TEXTURE1),Oe&&Oe.rasterParticleState?(Oe.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ke=Math.pow(2,Oe.tileID.overscaledZ-De.tileID.overscaledZ),pt=[De.tileID.canonical.x*Ke%1,De.tileID.canonical.y*Ke%1]):Pe.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ot=fe?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Te,se),vt=T.transform,qt=rl(vt),nt=a.dF(Re.canonical),Ue=a.dG(nt.getCenter().lat);let wt,lt,Pt,Kt,gr;fe?(wt=Float32Array.from(a.bj(a.dI(Re.canonical))),lt=Float32Array.from(vt.globeMatrix),Pt=Float32Array.from(a.dE(vt)),Kt=[a.aF(vt.center.lng),a.aJ(vt.center.lat)],gr=Float32Array.from(a.dH(Re.canonical,nt,Ue,vt.worldSize/vt._pixelsPerMercatorPixel))):(wt=new Float32Array(16),lt=new Float32Array(9),Pt=new Float32Array(16),Kt=[0,0],gr=new Float32Array(9));const Ut=Th(ot,wt,lt,Pt,gr,pt||[0,0],a.aj(T.transform.zoom),Kt,qt,Ke||1,et,te),Ht=T.isTileAffectedByFog(Re),yr=T.getOrCreateProgram("rasterParticle",{defines:Ee,overrideFog:Ht});if(T.uploadCommonUniforms(H,yr,Te),fe){const lr=new wr(U.LEQUAL,wr.ReadOnly,T.depthRangeFor3D),sr=0,cr=T.globeSharedBuffers;if(cr){const[Lr,Cn,Un]=cr.getGridBuffers(Ue,sr!==0);yr.draw(T,U.TRIANGLES,lr,xe,vn.alphaBlended,T.renderElevatedRasterBackface?Xr.frontCCW:Xr.backCCW,Ut,A.id,Lr,Cn,Un)}}else{const lr=T.depthModeForSublayer(0,wr.ReadOnly),sr=de[Re.overscaledZ],{tileBoundsBuffer:cr,tileBoundsIndexBuffer:Lr,tileBoundsSegments:Cn}=T.getTileBoundsBuffers(De);yr.draw(T,U.TRIANGLES,lr,sr,vn.alphaBlended,Xr.disabled,Ut,A.id,cr,Lr,Cn)}}T.resetStencilClippingMasks()}(g,o,h,_),g.style.map.triggerRepaint())},background:function(g,o,h,_){const v=h.paint.get("background-color"),S=h.paint.get("background-color-use-theme").constantOr("default")==="none",T=h.paint.get("background-opacity"),I=h.paint.get("background-emissive-strength"),A=h.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const L=g.context,F=L.gl,H=g.transform,U=H.tileSize,Y=h.paint.get("background-pattern");let te;if(Y!==void 0&&(Y===null||(te=g.imageManager.getPattern(a.I.from(Y.toString()),h.scope,g.style.getLut(h.scope)),!te)))return;const se=!Y&&v.a===1&&T===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==se)return;const fe=en.disabled,de=g.depthModeForSublayer(0,se==="opaque"?wr.ReadWrite:wr.ReadOnly),_e=g.colorModeForDrapableLayerRenderPass(I),Ee=Y?"backgroundPattern":"background";let xe,Re=_;if(Re||(xe=g.getBackgroundTiles(),Re=Object.values(xe).map(Te=>Te.tileID)),Y&&(L.activeTexture.set(F.TEXTURE0),g.imageManager.bind(g.context,h.scope)),A){const Te=g.getOrCreateProgram(Ee,{overrideFog:!1,overrideRtt:!0}),De=new Float32Array(a.bz([])),Pe=new a.aP(0,0,0,0,0),Ie=Y?mx(De,I,T,g,0,h.scope,te,A,{tileID:Pe,tileSize:U}):px(De,I,T,v.toPremultipliedRenderColor(S?null:h.lut));Te.draw(g,F.TRIANGLES,de,fe,_e,Xr.disabled,Ie,h.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const Te of Re){const De=g.isTileAffectedByFog(Te),Pe=g.getOrCreateProgram(Ee,{overrideFog:De}),Ie=Te.toUnwrapped(),Oe=_?Te.projMatrix:g.transform.calculateProjMatrix(Ie);g.prepareDrawTile();const et=o?o.getTile(Te):xe?xe[Te.key]:new tc(Te,U,H.zoom,g),Ke=Y?mx(Oe,I,T,g,0,h.scope,te,A,{tileID:Te,tileSize:U}):px(Oe,I,T,v.toPremultipliedRenderColor(S?null:h.lut));g.uploadCommonUniforms(L,Pe,Ie);const{tileBoundsBuffer:pt,tileBoundsIndexBuffer:ot,tileBoundsSegments:vt}=g.getTileBoundsBuffers(et);Pe.draw(g,F.TRIANGLES,de,fe,_e,Xr.disabled,Ke,h.id,pt,ot,vt)}},sky:function(g,o,h){const _=g._atmosphere?a.aj(g.transform.zoom):1,v=h.paint.get("sky-opacity")*_;if(v===0)return;const S=g.context,T=h.paint.get("sky-type"),I=new wr(S.gl.LEQUAL,wr.ReadOnly,[0,1]),A=g.frameCounter/1e3%1;T==="atmosphere"?g.renderPass==="offscreen"?h.needsSkyboxCapture(g)&&(function(L,F,H,U){const Y=L.context,te=Y.gl;let se=F.skyboxFbo;if(!se){se=F.skyboxFbo=Y.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new ib(Y),F.skyboxTexture=Y.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,F.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let Ee=0;Ee<6;++Ee)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(se.framebuffer),Y.viewport.set([0,0,32,32]);const fe=F.getCenter(L,!0),de=L.getOrCreateProgram("skyboxCapture"),_e=new Float64Array(16);a.bz(_e),a.em(_e,_e,.5*-Math.PI),Bc(L,F,de,_e,fe,0),a.bz(_e),a.em(_e,_e,.5*Math.PI),Bc(L,F,de,_e,fe,1),a.bz(_e),a.cT(_e,_e,.5*-Math.PI),Bc(L,F,de,_e,fe,2),a.bz(_e),a.cT(_e,_e,.5*Math.PI),Bc(L,F,de,_e,fe,3),a.bz(_e),Bc(L,F,de,_e,fe,4),a.bz(_e),a.em(_e,_e,Math.PI),Bc(L,F,de,_e,fe,5),Y.viewport.set([0,0,L.width,L.height])}(g,h),h.markSkyboxValid(g)):g.renderPass==="sky"&&function(L,F,H,U,Y){const te=L.context,se=te.gl,fe=L.transform,de=L.getOrCreateProgram("skybox");te.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,F.skyboxTexture);const _e=((Ee,xe,Re,Te,De)=>({u_matrix:Ee,u_sun_direction:xe,u_cubemap:0,u_opacity:Te,u_temporal_offset:De}))(fe.skyboxMatrix,F.getCenter(L,!1),0,U,Y);L.uploadCommonUniforms(te,de),de.draw(L,se.TRIANGLES,H,en.disabled,L.colorModeForRenderPass(),Xr.backCW,_e,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(g,h,I,v,A):T==="gradient"&&g.renderPass==="sky"&&function(L,F,H,U,Y){const te=L.context,se=te.gl,fe=L.transform,de=L.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new ib(te)),te.activeTexture.set(se.TEXTURE0);let _e=F.colorRampTexture;_e||(_e=F.colorRampTexture=new a.T(te,F.colorRamp,se.RGBA8)),_e.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Ee=((xe,Re,Te,De,Pe)=>({u_matrix:xe,u_color_ramp:0,u_center_direction:Re,u_radius:a.an(Te),u_opacity:De,u_temporal_offset:Pe}))(fe.skyboxMatrix,F.getCenter(L,!1),F.paint.get("sky-gradient-radius"),U,Y);L.uploadCommonUniforms(te,de),de.draw(L,se.TRIANGLES,H,en.disabled,L.colorModeForRenderPass(),Xr.backCW,Ee,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(g,h,I,v,A)},custom:function(g,o,h,_){const v=g.context,S=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&h.isDraped(o)){if(g.renderPass==="offscreen"){const T=S.prerender;if(T){if(g.setCustomLayerDefaults(),v.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const I=g.transform.pointMerc;T.call(S,v.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.aj(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else T.call(S,v.gl,g.transform.customLayerMatrix());v.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const I=S.renderToTile;if(I){const A=_[0].canonical,L={x:A.x+_[0].wrap*(S.wrapTileId?0:1<<A.z),y:A.y,z:A.z};v.setDepthMode(wr.disabled),v.setStencilMode(en.disabled),v.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),I.call(S,v.gl,L),v.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),v.setColorMode(g.colorModeForRenderPass()),v.setStencilMode(en.disabled);const T=S.renderingMode==="3d"?new wr(g.context.gl.LEQUAL,wr.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,wr.ReadOnly);if(v.setDepthMode(T),g.transform.projection.name==="globe"){const I=g.transform.pointMerc;S.render(v.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.aj(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else S.render(v.gl,g.transform.customLayerMatrix());v.setDirty(),g.setBaseState(),v.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,o,h,_){if(g.renderPass==="opaque")return;const v=h.paint.get("model-opacity").constantOr(1),S=h.paint.get("model-elevation-reference"),T=S==="ground",I=S==="ground";if(v===0)return;const A=h.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!A||g.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof a.ad))return;const L=g.shadowRenderer,F=h.paint.get("model-receive-shadows");L&&(L.useNormalOffset=!0,F||(L.enabled=!1));const H=()=>{L&&(L.useNormalOffset=!0,F||(L.enabled=!0))},U=o.getSource();if(g.renderPass==="light-beam"&&U.type!=="batched-model")return;if(U.type==="vector"||U.type==="geojson")return function(xe,Re,Te,De,Pe){const Ie=xe.transform,Oe=Ie.projection.name==="globe",et=Ie.getFreeCameraOptions().position;if(!xe.modelManager)return;const Ke=xe.modelManager;Te.modelManager=Ke;const pt=xe.shadowRenderer;if(!Te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ot=Te._unevaluatedLayout._values["model-id"],vt=Object.assign({},Te.layout.get("model-id").parameters),qt=xe.style.order.indexOf(Te.fqid);for(const nt of De){const Ue=Re.getTile(nt).getBucket(Te);if(!Ue||Ue.projection.name!==Ie.projection.name)continue;const wt=Ue.getModelUris();if(wt&&!Ue.modelsRequested&&(Ke.addModelsFromBucket(wt,Pe),Ue.modelsRequested=!0),Oe)vt.zoom=nt.overscaledZ;else{const lr=ob(nt,Ie);vt.zoom=lr}const lt=ot.possiblyEvaluate(vt);if(kT(xe,Ue,nt),ic.shadowUniformsInitialized=!1,ic.useSingleShadowCascade=!!pt&&pt.getMaxCascadeForTile(nt.toUnwrapped())===0,xe.renderPass==="shadow"&&pt){if(xe.currentShadowCascade===1&&Ue.isInsideFirstShadowMapFrustum)continue;const lr=Ie.calculatePosMatrix(nt.toUnwrapped(),Ie.worldSize);if(ic.tileMatrix.set(lr),ic.shadowTileMatrix=Float32Array.from(pt.calculateShadowPassMatrixFromMatrix(lr)),ic.aabb.min=[0,0,0],ic.aabb.max[0]=ic.aabb.max[1]=a.al,ic.aabb.max[2]=0,jx(Ue,ic,xe,Te.scope))continue}const Pt=1<<nt.canonical.z,Kt=[((et.x-nt.wrap)*Pt-nt.canonical.x)*a.al,(et.y*Pt-nt.canonical.y)*a.al,et.z*Pt*a.al];xe.conflationActive&&Object.keys(Ue.instancesPerModel).length>0&&xe.style.isLayerClipped(Te,Re.getSource())&&Ue.updateReplacement(nt,xe.replacementSource,qt,Pe)&&(Ue.uploaded=!1,Ue.upload(xe.context));let gr=0;const Ut=new Array,Ht=new Array,yr=new Array;for(let lr in Ue.instancesPerModel){const sr=Ue.instancesPerModel[lr];sr.features.length>0&&!Oe&&(lr=lt.evaluate(sr.features[0].feature,{}));const cr=Ke.getModel(lr,Pe);if(cr||Ke.hasURLBeenRequested(lr)||Ue.modelUris.includes(lr)||(Ue.modelUris.push(lr),Ue.modelsRequested=!1),cr&&cr.uploaded)if(Oe){const Lr=a.c4([],[et.x,et.y,et.z],xe.transform.worldSize);a.ev(Lr,Lr);for(let Cn=0;Cn<sr.instancedDataArray.length;++Cn){const Un=[0,0,0],Is=[1,1,1],Yr=a.ew(),Bn=sr.tileCoordinatesForInstance(Cn),pn=sr.transformForInstance(Cn);a.ex(Is,pn),a.ey(Yr,pn),a.ez(Un,Yr);const Ss=sr.translationForInstance(Cn),$n=new a.aS(0,0);a.eA(Ue.canonical,$n,Bn.x,Bn.y);const Vs=a.bB();a.eB(Vs,cr,xe.transform,$n,Un,Is,Ss,!0,!1,!1);const Jn=sr.colorForInstance(Cn),gn=a.bz([]),us=a.ee($n.lat,xe.transform.zoom),wn=a.bp([],[1,1,1/us]);a.bq(gn,gn,Lr),yr.push({zScaleMatrix:wn,negCameraPosMatrix:gn});for(const ei of cr.nodes)Tx(xe,ei,Vs,xe.transform.expandedFarZProjMatrix,gr,Ut,Ht,cr.materialOverrides,Jn);++gr}}else for(const Lr of cr.nodes)lb(xe,Te,Lr,sr,Kt,nt,ic)}if(Oe)if(xe.renderPass==="shadow"){for(const lr of Ht)nm(lr.mesh,lr.nodeModelMatrix,xe,Te);for(const lr of Ut)nm(lr.mesh,lr.nodeModelMatrix,xe,Te)}else PT(xe,Te,1,Ut,Ht,yr)}}(g,o,h,_,Ex(U,h,g.style._importedAsBasemap)),void H();if(!U.loaded())return;if(U.type==="batched-model")return function(xe,Re,Te,De){Te.resetLayerRenderingStats(xe);const Pe=xe.context,Ie=xe.transform,Oe=xe.style.fog,et=xe.shadowRenderer;if(Ie.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Ie.projection.name} projection is not yet implemented`);const Ke=xe.transform.getFreeCameraOptions().position,pt=a.c4([],[Ke.x,Ke.y,Ke.z],xe.transform.worldSize),ot=a.ev([],pt),vt=a.bz([]),qt=a.ee(Ie.center.lat,Ie.zoom),nt=a.bp([],[1,1,1/qt]);a.bq(vt,vt,ot);const Ue=Te.paint.get("model-opacity").constantOr(1),wt=new wr(Pe.gl.LEQUAL,wr.ReadWrite,xe.depthRangeFor3D),lt=new wr(Pe.gl.LEQUAL,wr.ReadOnly,xe.depthRangeFor3D),Pt=new a.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Kt=xe.renderPass==="shadow",gr=Kt&&et?et.getCurrentCascadeFrustum():Ie.getFrustum(Ie.scaleZoom(Ie.worldSize)),Ut=Te.paint.get("model-front-cutoff"),Ht=Ut[2]<1,yr=wd(xe,Te.paint.get("model-cutoff-fade-range")),lr=Te.getLayerRenderingStats();(function(sr,cr,Lr,Cn){const Un=sr.terrain?sr.terrain.exaggeration():0,Is=sr.transform.zoom;for(const Yr of Cn){const Bn=cr.getTile(Yr).getBucket(Lr);Bn&&(Bn.setFilter(Lr.filter),sr.conflationActive&&Bn.updateReplacement(Yr,sr.replacementSource),Bn.evaluateTransform(sr,Lr),sr.terrain&&Un>0&&Bn.elevationUpdate(sr.terrain,Un,Yr,Lr.source),Bn.needsReEvaluation(sr,Is,Lr)&&Bn.evaluate(Lr))}})(xe,Re,Te,De),function(){let sr,cr,Lr;Ht?(sr=De.length-1,cr=-1,Lr=-1):(sr=0,cr=De.length,Lr=1);const Cn=new Float64Array(16),Un=a.cz(),Is=new a.P(0,0);for(let Yr=sr;Yr!==cr;Yr+=Lr){const Bn=De[Yr],pn=Re.getTile(Bn).getBucket(Te);if(!pn||!pn.uploaded)continue;let Ss=!1;et&&(Ss=et.getMaxCascadeForTile(Bn.toUnwrapped())===0);const $n=Ie.calculatePosMatrix(Bn.toUnwrapped(),Ie.worldSize),Vs=pn.modelTraits;!Kt&&Ht&&(a.bk(Cn,$n),a.af(Un,pt,Cn),Is.x=Un[0],Is.y=Un[1]);const Jn=[];pn.setFilter(Te.filter);for(const gn of pn.getNodesInfo()){if(gn.hiddenByReplacement||!gn.node.meshes)continue;const us=gn.node;let wn=0;xe.terrain&&us.elevation&&(wn=us.elevation*xe.terrain.exaggeration());const ei=(()=>{const No=gn.aabb;return Pt.min=[...No.min],Pt.max=[...No.max],Pt.min[2]+=wn,Pt.max[2]+=wn,a.af(Pt.min,Pt.min,$n),a.af(Pt.max,Pt.max,$n),Pt})(),ps=gn.evaluatedScale;if(ps[0]<=1&&ps[1]<=1&&ps[2]<=1&&ei.intersects(gr)===0)continue;if(!Kt&&Ht){const No=.16666666666666666;gn.cameraCollisionOpacity=pt[0]>ei.min[0]&&pt[0]<ei.max[0]&&pt[1]>ei.min[1]&&pt[1]<ei.max[1]&&pt[2]*qt<ei.max[2]&&us.footprint&&a.b$(Is,us.footprint)?Math.max(gn.cameraCollisionOpacity-No,0):Math.min(1,gn.cameraCollisionOpacity+No)}const Jr=[...$n],Gn=1/a.d6(Bn.canonical),pi=us.anchor?us.anchor[0]:0,Vi=us.anchor?us.anchor[1]:0;a.bq(Jr,Jr,[pi*(ps[0]-1)+gn.evaluatedTranslation[0]*Gn,Vi*(ps[1]-1)+gn.evaluatedTranslation[1]*Gn,wn+gn.evaluatedTranslation[2]]),a.cp(ps,a.eD)||a.cR(Jr,Jr,ps);const vi=a.aB([],Jr,us.globalMatrix),ki=a.aB([],Ie.expandedFarZProjMatrix,vi),vl=a.aB([],Ie.expandedFarZProjMatrix,Jr),nl=a.aC([],[pi,Vi,wn,1],ki)[2];us.hidden=!1;let yo=Ue;Kt||(Ht&&(yo*=gn.cameraCollisionOpacity,yo*=Rf(Jr,Ie,gn.aabb,Ut)),yo*=i_(yr,nl)),yo!==0?Jn.push({nodeInfo:gn,depth:nl,opacity:yo,wvpForNode:ki,wvpForTile:vl,nodeModelMatrix:vi,tileModelMatrix:Jr}):us.hidden=!0}Kt||Jn.sort((gn,us)=>!Ht||gn.opacity===1&&us.opacity===1?gn.depth<us.depth?-1:1:gn.opacity===1?-1:us.opacity===1?1:gn.depth>us.depth?-1:1);for(const gn of Jn){const us=gn.nodeInfo,wn=us.node;let ei=a.aB([],nt,gn.tileModelMatrix);a.aB(ei,vt,ei);const ps=a.bk([],ei);a.ef(ps,ps),a.cR(ps,ps,RT),ei=a.aB(ei,ei,wn.globalMatrix);const Jr=xe.renderPass==="light-beam",Gn=Te.paint.get("model-color-use-theme").constantOr("default")==="none",pi=Vs&a.eH.HasMapboxMeshFeatures,Vi=pi?0:us.evaluatedRMEA[0][2];for(let vi=0;vi<wn.meshes.length;++vi){const ki=wn.meshes[vi],vl=vi===wn.lightMeshIndex;let nl=gn.wvpForNode;if(vl){if(!Jr&&!xe.terrain&&xe.shadowRenderer){xe.currentLayer<xe.firstLightBeamLayer&&(xe.firstLightBeamLayer=xe.currentLayer);continue}nl=gn.wvpForTile}else if(Jr)continue;const yo={defines:[]},No=[];if(!Kt&&et&&(et.useNormalOffset=!!ki.normalBuffer),tm(yo.defines,No,ki,xe,Gn?null:Te.lut),pi||yo.defines.push("DIFFUSE_SHADED"),Ss&&yo.defines.push("SHADOWS_SINGLE_CASCADE"),lr&&(Kt?lr.numRenderedVerticesInShadowPass+=ki.vertexArray.length:lr.numRenderedVerticesInTransparentPass+=ki.vertexArray.length),Kt){nm(ki,gn.nodeModelMatrix,xe,Te);continue}let oc=null;if(Oe){const Ui=ab(gn.nodeModelMatrix,xe.transform);if(oc=new Float32Array(Ui),Ie.projection.name!=="globe"){const Os=ki.aabb.min,Gi=ki.aabb.max,[$a,Ti]=Oe.getOpacityForBounds(Ui,Os[0],Os[1],Gi[0],Gi[1]);yo.overrideFog=$a>=at||Ti>=at}}const xo=ki.material;let lc;xo.occlusionTexture&&xo.occlusionTexture.offsetScale&&(lc=xo.occlusionTexture.offsetScale,yo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const $c=xe.getOrCreateProgram("model",yo);!Kt&&et&&et.setupShadowsFromMatrix(gn.tileModelMatrix,$c,et.useNormalOffset),xe.uploadCommonUniforms(Pe,$c,null,oc);const Ua=xo.pbrMetallicRoughness;Ua.metallicFactor=.9,Ua.roughnessFactor=.5;const Ei=gx(new Float32Array(nl),new Float32Array(ei),new Float32Array(ps),new Float32Array(wn.globalMatrix),xe,gn.opacity,Ua.baseColorFactor,xo.emissiveFactor,Ua.metallicFactor,Ua.roughnessFactor,xo,Vi,Te,[0,0,0],lc);!vl&&(us.hasTranslucentParts||gn.opacity<1)&&$c.draw(xe,Pe.gl.TRIANGLES,wt,en.disabled,vn.disabled,Xr.backCCW,Ei,Te.id,ki.vertexBuffer,ki.indexBuffer,ki.segments,Te.paint,xe.transform.zoom,void 0,No),$c.draw(xe,Pe.gl.TRIANGLES,vl?lt:wt,en.disabled,vl||gn.opacity<1||us.hasTranslucentParts?vn.alphaBlended:vn.unblended,Xr.backCCW,Ei,Te.id,ki.vertexBuffer,ki.indexBuffer,ki.segments,Te.paint,xe.transform.zoom,void 0,No)}}}}()}(g,o,h,_),void H();if(U.type!=="model")return;const Y=U.getModels(),te=[],se=g.transform.getFreeCameraOptions().position,fe=a.c4([],[se.x,se.y,se.z],g.transform.worldSize);a.ev(fe,fe);const de=[],_e=[];let Ee=0;for(const xe of Y){const Re=o.getFeatureState("",xe.id),Te={type:"Unknown",id:xe.id,properties:xe.featureProperties},De=h.paint.get("model-rotation").evaluate(Te,Re),Pe=h.paint.get("model-scale").evaluate(Te,Re),Ie=h.paint.get("model-translation").evaluate(Te,Re);sm(h,xe.id,Re,xe.featureProperties,xe.nodeOverrideNames,xe.nodeOverrides),QA(h,xe.id,Re,xe.featureProperties,xe.materialOverrideNames,xe.materialOverrides),xe.nodeOverrides.size>0&&xe.computeBoundsAndApplyParent(),xe.computeModelMatrix(g,De,Pe,Ie,I,T,!1);const Oe=a.bz([]),et=a.ee(xe.position.lat,g.transform.zoom),Ke=a.bp([],[1,1,1/et]);a.bq(Oe,Oe,fe),te.push({zScaleMatrix:Ke,negCameraPosMatrix:Oe});for(const pt of xe.nodes)Tx(g,pt,xe.matrix,g.transform.expandedFarZProjMatrix,Ee,de,_e,xe.materialOverrides);Ee++}if(de.sort((xe,Re)=>Re.depth-xe.depth),g.renderPass!=="shadow")PT(g,h,v,de,_e,te),H();else{for(const xe of _e)nm(xe.mesh,xe.nodeModelMatrix,g,h);for(const xe of de)nm(xe.mesh,xe.nodeModelMatrix,g,h);H()}}},Nx={line:function(g,o,h){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,g._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||g._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const _=o.getVisibleCoordinates();for(const v of _){const S=o.getTile(v).getBucket(g);if(S&&(S.elevationType!=="none"?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,o,h){const _=o.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson"){const S=Ex(_,g,h.style._importedAsBasemap);return void(h.modelManager&&h.modelManager.upload(h,S))}if(_.type==="batched-model"||_.type!=="model")return;const v=_.getModels();for(const S of v)S.upload(h.context)},raster:function(g,o,h){const _=o.getSource();if(!(_ instanceof Mi&&_.loaded()))return;const v=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!v)return;const S=g.paint.get("raster-array-band")||_.getInitialBand(v);if(S==null)return;const T=o.getIds().map(I=>o.getTileByID(I));for(const I of T)I.updateNeeded(g.id,S)&&_.prepareTile(I,v,g.id,S)},"raster-particle":function(g,o,h){const _=o.getSource();if(!(_ instanceof Mi&&_.loaded()))return;const v=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!v)return;const S=g.paint.get("raster-particle-array-band")||_.getInitialBand(v);if(S==null)return;const T=o.getIds().map(I=>o.getTileByID(I));for(const I of T)I.updateNeeded(g.id,S)&&_.prepareTile(I,v,g.id,S)}},Ix={fill:Pf},ac={fill:function(g,o,h,_){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const v=g.context.gl,S=new wr(v.LEQUAL,wr.ReadOnly,g.depthRangeFor3D),T=new en({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),I=g.transform.getFreeCameraOptions().position,A=g.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const L of _){const F=o.getTile(L),H=F.getBucket(h);if(!H)continue;const U=H.elevatedStructures;if(!U||U.depthSegments.segments[0].primitiveLength===0)continue;const Y=TT(L.toUnwrapped(),I),te=g.translatePosMatrix(L.projMatrix,F,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),se=ux(te,Y,0,1,0);A.draw(g,v.TRIANGLES,S,T,vn.disabled,Xr.disabled,se,h.id,U.vertexBuffer,U.indexBuffer,U.depthSegments,h.paint,g.transform.zoom)}}};class Ph{constructor(o,h,_,v,S,T){this.context=new yx(o,h),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=S,this._timeStamp=a.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const I=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const L of I)this._debugParams.enabledLayers[L]=!0;S.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),S.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),S.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),S.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),S.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),S.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of I)S.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new eP(S),this.setup(),this.numSublayers=kl.maxUnderzooming+kl.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new qg(this),this._wireframeDebugCache=new DT,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new a.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,A,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v,this.worldview=T}updateTerrain(o,h){const _=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qg(this,o));const v=this._terrain;this.transform.elevation=_?v:null,v.update(o,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(o){const h=o.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,v]=h.getFovAdjustedRange(this.transform._fov);if(_>v)return void(this.transform.fogCullDistSq=null);const S=_+.78*(v-_);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Qg(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,h){if(this.width=o*a.o.devicePixelRatio,this.height=h*a.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const o=this.context,h=new a.bc;h.emplaceBack(0,0),h.emplaceBack(a.al,0),h.emplaceBack(0,a.al),h.emplaceBack(a.al,a.al),this.tileExtentBuffer=o.createVertexBuffer(h,a.be.members),this.tileExtentSegments=a.bf.simpleSegment(0,0,4,2);const _=new a.bc;_.emplaceBack(0,0),_.emplaceBack(a.al,0),_.emplaceBack(0,a.al),_.emplaceBack(a.al,a.al),this.debugBuffer=o.createVertexBuffer(_,a.be.members),this.debugSegments=a.bf.simpleSegment(0,0,4,5);const v=new a.bc;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,a.be.members),this.viewportSegments=a.bf.simpleSegment(0,0,4,2);const S=new a.a$;S.emplaceBack(0,0,0,0),S.emplaceBack(a.al,0,a.al,0),S.emplaceBack(0,a.al,0,a.al),S.emplaceBack(a.al,a.al,a.al,a.al),this.mercatorBoundsBuffer=o.createVertexBuffer(S,a.bh.members),this.mercatorBoundsSegments=a.bf.simpleSegment(0,0,4,2);const T=new a.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(T);const I=new a.bd;for(const L of[0,1,3,2,0])I.emplaceBack(L);this.debugIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new a.T(o,new a.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=a.bB();const A=this.context.gl;this.stencilClearMode=new en({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,wr.disabled,this.stencilClearMode,vn.disabled,Xr.disabled,Cf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,h,_){if(!h||this.currentStencilSource===h.id||!o.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const A of _)if(this._tileClippingMaskIDs[A.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=h.id;const v=this.context,S=v.gl;this.nextStencilID+_.length>256&&this.clearStencil(),v.setColorMode(vn.disabled),v.setDepthMode(wr.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of _){const A=h.getTile(I),L=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:H,tileBoundsSegments:U}=this.getTileBoundsBuffers(A);T.draw(this,S.TRIANGLES,wr.disabled,new en({func:S.ALWAYS,mask:0},L,255,S.KEEP,S.KEEP,S.REPLACE),vn.disabled,Xr.disabled,Cf(I.projMatrix),"$clipping",F,H,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new en({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const h=this.context.gl;return new en({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,_=o.sort((T,I)=>I.overscaledZ-T.overscaledZ),v=_[_.length-1].overscaledZ,S=_[0].overscaledZ-v+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const T={};for(let I=0;I<S;I++)T[I+v]=new en({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=S,[T,_]}return[{[v]:en.disabled},_]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new vn([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new a.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vn.unblended:vn.alphaBlended}colorModeForDrapableLayerRenderPass(o){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new vn([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new a.ao(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,h,_,v=!1){if(this.depthOcclusion)return new wr(this.context.gl.GREATER,wr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return wr.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new wr(_||this.context.gl.LEQUAL,h,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,h=Math.ceil(this.width),_=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),S=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&_!==0&&(this.depthFBO=new _x(this.context,h,_,!1,"texture"),this.depthTexture=new a.T(this.context,{width:h,height:_,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),o.bindTexture(o.TEXTURE_2D,S),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,h,_,0,0,h,_,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,h)=>o+h/this._fpsHistory.length,0))}render(o,h){const _=a.o.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=h;const v=this.style._mergedLayers,S=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(S).filter(nt=>{const Ue=v[nt];return!(Ue.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ue.type]});let I=T(),A=!1,L=!1,F=null;for(const nt of I){const Ue=v[nt];Ue.type==="circle"?A=!0:Ue.type==="building"?F=Ue:Ue.type==="symbol"&&(Ue.hasOcclusionOpacityProperties?L=!0:A=!0)}let H=I.map(nt=>v[nt]);const U=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(a.o.now()),this.imageManager.beginFrame();let Y=0,te=!1;for(const nt in U){const Ue=U[nt];Ue.used&&(Ue.prepare(this.context),Ue.getSource().usedInConflation&&++Y)}let se=!1;for(const nt of H)nt.isHidden(this.transform.zoom)||(nt.type==="clip"&&(se=!0),this.prepareLayer(nt));const fe={},de={},_e={},Ee={},xe={};for(const nt in U){const Ue=U[nt];fe[nt]=Ue.getVisibleCoordinates(),de[nt]=fe[nt].slice().reverse(),_e[nt]=Ue.getVisibleCoordinates(!0).reverse(),Ee[nt]=Ue.getShadowCasterCoordinates(),xe[nt]=Ue.sortCoordinatesByDistance(fe[nt])}const Re=nt=>{const Ue=this.style.getLayerSourceCache(nt);return Ue&&Ue.used?Ue.getSource():null};if(Y||se||this._clippingActiveLastFrame){const nt=[],Ue=[];let wt=0;for(const lt of H)this.isSourceForClippingOrConflation(lt,Re(lt))&&(nt.push(lt),Ue.push(wt)),wt++;if(nt&&(se||nt.length>1)||this._clippingActiveLastFrame){se=!1;const lt=[];for(let Pt=0;Pt<nt.length;Pt++){const Kt=nt[Pt],gr=Ue[Pt],Ut=this.style.getLayerSourceCache(Kt);if(!Ut||!Ut.used||!Ut.getSource().usedInConflation&&Kt.type!=="clip"&&Kt.type!=="building")continue;let Ht=a.eP,yr=a.bZ.None;const lr=[];let sr=!0;if(Kt.type==="building")Ht=a.eR;else if(Kt.type==="clip"){Ht=gr;for(const cr of Kt.layout.get("clip-layer-types"))yr|=cr==="model"?a.bZ.Model:cr==="symbol"?a.bZ.Symbol:a.bZ.FillExtrusion;for(const cr of Kt.layout.get("clip-layer-scope"))lr.push(cr);Kt.isHidden(this.transform.zoom)?sr=!1:se=!0}sr&&lt.push({layer:Kt.fqid,cache:Ut,order:Ht,clipMask:yr,clipScope:lr})}this.replacementSource.setSources(lt),te=!0}}this._clippingActiveLastFrame=se,te||this.replacementSource.clear(),this.conflationActive=te,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let nt=0;nt<H.length;nt++){const Ue=H[nt],wt=Ue.cutoffRange();if(this.longestCutoffRange=Math.max(wt,this.longestCutoffRange),wt>0){const lt=Re(Ue);lt&&(this.minCutoffZoom=Math.max(lt.minzoom,this.minCutoffZoom)),Ue.minzoom&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom))}Ue.is3D(S)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=nt),this._lastOcclusionLayer=nt)}const Te=this.style&&this.style.fog;Te?(this._fogVisible=Te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_e),this.opaquePassCutoff=0,I=T(),H=I.map(nt=>v[nt]));const De=this._shadowRenderer;if(De){De.updateShadowParameters(this.transform,this.style.directionalLight);for(const nt in U)for(const Ue of fe[nt]){let wt={min:0,max:0};this.terrain&&(wt=this.terrain.getMinMaxForTile(Ue)||wt),De.addShadowReceiver(Ue.toUnwrapped(),wt.min,wt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Pi(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ie=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Pe&&!this._snow&&(this._snow=new ub(this)),!Pe&&this._snow&&(this._snow.destroy(),delete this._snow),Ie&&!this._rain&&(this._rain=new im(this)),!Ie&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new tt);const nt=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(nt,F)}if(!ln.has(this.context.gl))return;this.renderPass="offscreen";for(const nt of H){const Ue=o.getLayerSourceCache(nt);if(!nt.hasOffscreenPass()||nt.isHidden(this.transform.zoom))continue;const wt=Ue?de[Ue.id]:void 0;(nt.type==="custom"||nt.type==="raster"||nt.type==="raster-particle"||nt.isSky()||wt&&wt.length)&&this.renderLayer(this,Ue,nt,wt)}this.depthRangeFor3D=[0,1-(H.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Ee)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Oe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),et=(()=>{if(h.showOverdrawInspector)return a.ao.black;const nt=this.style.fog;if(nt&&this.transform.projection.supportsFog){const Ue=this.style.getLut(nt.scope);if(!Oe){const wt=nt.properties.get("color-use-theme")==="none",lt=nt.properties.get("color").toNonPremultipliedRenderColor(wt?null:Ue).toArray01();return new a.ao(...lt)}if(Oe){const wt=nt.properties.get("space-color-use-theme")==="none",lt=nt.properties.get("space-color").toNonPremultipliedRenderColor(wt?null:Ue).toArray01();return new a.ao(...lt)}}return a.ao.transparent})();if(this.context.clear({color:et,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Oe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const nt=H[this.currentLayer],Ue=o.getLayerSourceCache(nt);if(nt.isSky())continue;const wt=Ue?(nt.is3D(S)?xe:de)[Ue.id]:void 0;this._renderTileClippingMasks(nt,Ue,wt),this.renderLayer(this,Ue,nt,wt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Oe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const nt=H[this.currentLayer],Ue=o.getLayerSourceCache(nt);nt.isSky()&&this.renderLayer(this,Ue,nt,Ue?de[Ue.id]:void 0)}function Ke(nt,Ue){let wt;return Ue&&(wt=(nt.type==="symbol"?_e:nt.is3D(S)?xe:de)[Ue.id]),wt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const nt=H[this.currentLayer];if(nt.type==="raster"||nt.type==="raster-particle"){const Ue=o.getLayerSourceCache(nt);this.renderLayer(this,Ue,nt,Ke(nt,Ue))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let pt=0;De&&(pt=De.getShadowCastingLayerCount());let ot=!1,vt=-1;for(let nt=0;nt<I.length;++nt){const Ue=H[nt];Ue.isHidden(this.transform.zoom)||Ue.is3D(S)&&(vt=nt)}L&&vt===-1&&(A=!0);let qt=!1;for(;this.currentLayer<I.length;){const nt=H[this.currentLayer],Ue=o.getLayerSourceCache(nt);if(nt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(nt)){if(nt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!qt&&nt.is3D(S)&&!S){const wt=this.currentLayer,lt=Pt=>{for(this.currentLayer=0;this.currentLayer<H.length;this.currentLayer++){const Kt=H[this.currentLayer];if(Ix[Kt.type]){const gr=this.style.getLayerSourceCache(Kt);Ix[Kt.type](this,gr,Kt,Ke(Kt,gr),Pt)}}};lt("initialize"),lt("reset"),this.currentLayer=wt,qt=!0}if(A&&!ot&&this.terrain&&!this.transform.isOrthographic&&(ot=!0,this.blitDepth()),L&&vt!==-1&&this.currentLayer===vt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(nt,Ue,Ue?fe[Ue.id]:void 0),this.renderLayer(this,Ue,nt,Ke(nt,Ue)),!this.terrain&&De&&pt>0&&nt.hasShadowPass()&&--pt==0){{this.clearStencil(),this.resetStencilClippingMasks();const wt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<H.length;this.currentLayer++){const lt=H[this.currentLayer];if(ac[lt.type]){const Pt=this.style.getLayerSourceCache(lt);ac[lt.type](this,Pt,lt,Ke(lt,Pt))}}this.currentLayer=wt}if(De.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const wt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=wt;this.currentLayer++){const lt=H[this.currentLayer];if(!lt.hasLightBeamPass())continue;const Pt=o.getLayerSourceCache(lt);this.renderLayer(this,Pt,lt,Pt?de[Pt.id]:void 0)}this.currentLayer=wt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const wt=this.currentLayer;this.depthOcclusion=!0;for(const lt of this.layersWithOcclusionOpacity){this.currentLayer=lt;const Pt=H[this.currentLayer],Kt=o.getLayerSourceCache(Pt),gr=Kt?de[Kt.id]:void 0;this.terrain||this._renderTileClippingMasks(Pt,Kt,Kt?fe[Kt.id]:void 0),this.renderLayer(this,Kt,Pt,gr)}this.depthOcclusion=!1,this.currentLayer=wt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let nt=null;H.forEach(Ue=>{const wt=o.getLayerSourceCache(Ue);wt&&!Ue.isHidden(this.transform.zoom)&&wt.getVisibleCoordinates().length&&(!nt||nt.getSource().maxzoom<wt.getSource().maxzoom)&&(nt=wt)}),nt&&this.options.showTileBoundaries&&sb(this,nt,nt.getVisibleCoordinates(),a.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&sb(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(nt){const Ue=nt.transform.padding;Xs(nt,nt.transform.height-(Ue.top||0),3,Ah),Xs(nt,Ue.bottom||0,3,IT),s_(nt,Ue.left||0,3,tb),s_(nt,nt.transform.width-(Ue.right||0),3,rb);const wt=nt.transform.centerPoint;(function(lt,Pt,Kt,gr){Qp(lt,Pt-1,Kt-10,2,20,gr),Qp(lt,Pt-10,Kt-1,20,2,gr)})(nt,wt.x,nt.transform.height-wt.y,nb)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),te||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:h}=this.transform.projection,_=!h||!h.includes(o.type);if(Nx[o.type]&&(_||this.terrain&&o.type==="custom")){const v=this.style.getLayerSourceCache(o);Nx[o.type](o,v,this)}this.gpuTimingEnd()}renderLayer(o,h,_,v){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||v&&v.length)&&(this.id=_.id,this.gpuTimingStart(_),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(_.type)&&(!o.terrain||_.type!=="custom")||_.type==="clip"||db[_.type](o,h,_,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,_=this.context.gl;let v=this.gpuTimers[o.id];v||(v=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:_.createQuery()}),v.calls++,_.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,h=this.context.gl,_=h.createQuery();this.deferredRenderGpuTimeQueries.push(_),h.beginQuery(o.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const h={};for(const _ in o){const v=o[_],S=this.context.extTimerQuery,T=S.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(v.query),h[_]=T}return h}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let _=0;for(const v of o)_+=h.getQueryParameter(v,h.QUERY_RESULT)/1e6,h.deleteQuery(v);return _}translatePosMatrix(o,h,_,v,S){if(!_[0]&&!_[1])return o;const T=S?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){const L=Math.sin(T),F=Math.cos(T);_=[_[0]*F-_[1]*L,_[0]*L+_[1]*F]}const I=[S?_[0]:a.ay(h,_[0],this.transform.zoom),S?_[1]:a.ay(h,_[1],this.transform.zoom),0],A=new Float32Array(16);return a.bq(A,o,I),A}saveTileTexture(o){if(o.context!==this.context)return;const h=o.size[0],_=this._tileTextures[h];_?_.push(o):this._tileTextures[h]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,h,_){const v=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,S=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(S.push("LIGHTING_3D_MODE"),S.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||S.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||S.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(S.push("TERRAIN"),this.linearFloatFilteringSupported()&&S.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&S.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||S.push("FOG","FOG_DITHERING"),v&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}getOrCreateProgram(o,h){this.cache=this.cache||{};const _=h&&h.defines||[],v=h&&h.config,S=this.currentGlobalDefines(o,h&&h.overrideFog,h&&h.overrideRtt).concat(_),T=e_.cacheKey(Xy[o],o,S,v);return this.cache[T]||(this.cache[T]=new e_(this.context,o,Xy[o],v,KA[o],S)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,h){if(this.style.enable3dLights()){const _=this.style.directionalLight,v=this.style.ambientLight;if(_&&v){const S=((T,I,A)=>{const L=T.properties.get("direction"),F=T.properties.get("color-use-theme")==="none",H=T.properties.get("color").toNonPremultipliedRenderColor(F?null:A.getLut(T.scope)).toArray01(),U=T.properties.get("intensity"),Y=I.properties.get("color-use-theme")==="none",te=I.properties.get("color").toNonPremultipliedRenderColor(Y?null:A.getLut(I.scope)).toArray01(),se=I.properties.get("intensity"),fe=[L.x,L.y,L.z],de=a.dM(te,se),_e=a.dM(H,U);return{u_lighting_ambient_color:de,u_lighting_directional_dir:fe,u_lighting_directional_color:_e,u_ground_radiance:zw(fe,_e,de)}})(_,v,this.style);h.setLightsUniformValues(o,S)}}}uploadCommonUniforms(o,h,_,v,S){if(this.uploadCommonLightUniforms(o,h),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const I=T.getOpacity(this.transform.pitch),A=((L,F,H,U,Y,te,se,fe,de,_e,Ee,xe)=>{const Re=L.transform,Te=F.properties.get("color-use-theme")==="none",De=F.properties.get("color").toNonPremultipliedRenderColor(Te?null:L.style.getLut(F.scope)).toArray01();De[3]=U;const Pe=L.frameCounter/1e3%1,[Ie,Oe]=F.properties.get("vertical-range");return{u_fog_matrix:H?Re.calculateFogTileMatrix(H):xe||L.identityMat,u_fog_range:F.getFovAdjustedRange(Re._fov),u_fog_color:De,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ie,Oe),Oe],u_fog_temporal_offset:Pe,u_frustum_tl:Y,u_frustum_tr:te,u_frustum_br:se,u_frustum_bl:fe,u_globe_pos:de,u_globe_radius:_e,u_viewport:Ee,u_globe_transition:a.aj(Re.zoom),u_is_globe:+(Re.projection.name==="globe")}})(this,T,_,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.o.devicePixelRatio,this.transform.height*a.o.devicePixelRatio],v);h.setFogUniformValues(o,A)}S&&h.setCutoffUniformValues(o,S.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const v of _)h[v.key]=o[v.key]||new tc(v,512,this.transform.tileZoom,this,void 0,this.worldview);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,h){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[o.key];return h||(this._cachedTileFogOpacities[o.key]=h=this.style.fog.getOpacityForTile(o)),h[0]>=at||h[1]>=at}setupDepthForOcclusion(o,h,_){const v=this.context,S=v.gl,T=!!_;var I;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(S.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),v.activeTexture.set(S.TEXTURE0),T||h.setTerrainUniformValues(v,_)}}function Df(g,o){let h=!1,_=null;const v=()=>{_=null,h&&(g(),_=setTimeout(v,o),h=!1)};return()=>(h=!0,_||v(),_)}class Cx{constructor(o){this._hashName=o&&encodeURIComponent(o),a.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Df(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const h=Ax(o);if(this._hashName){const _=this._hashName;let v=!1;const S=location.hash.slice(1).split("&").map(T=>{const I=T.split("=")[0];return I===_?(v=!0,`${I}=${h}`):T}).filter(T=>T);return v||S.push(`${_}=${h}`),`#${S.join("&")}`}return`#${h}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(Number(_)))){const _=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(h[3]||0):o.getBearing();return o.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ax(g,o){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,v),T=Math.round(h.lng*S)/S,I=Math.round(h.lat*S)/S,A=g.getBearing(),L=g.getPitch();let F=o?`/${T}/${I}/${_}`:`${_}/${I}/${T}`;return(A||L)&&(F+="/"+Math.round(10*A)/10),L&&(F+=`/${Math.round(L)}`),F}const am={linearity:.3,easing:a.eS(0,0,.3,1)},kh=Object.assign({deceleration:2500,maxSpeed:1400},am),hb=Object.assign({deceleration:20,maxSpeed:1400},am),Vc=Object.assign({deceleration:1e3,maxSpeed:360},am),fb=Object.assign({deceleration:1e3,maxSpeed:90},am);class Px{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.o.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=a.o.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const S=lm(h.pan.mag(),_,Object.assign({},kh,o||{}));v.offset=h.pan.mult(S.amount/h.pan.mag()),v.center=this._map.transform.center,om(v,S)}if(h.zoom){const S=lm(h.zoom,_,hb);v.zoom=this._map.transform.zoom+S.amount,om(v,S)}if(h.bearing){const S=lm(h.bearing,_,Vc);v.bearing=this._map.transform.bearing+a.aA(S.amount,-179,179),om(v,S)}if(h.pitch){const S=lm(h.pitch,_,fb);v.pitch=this._map.transform.pitch+S.amount,om(v,S)}if(v.zoom||v.bearing){const S=h.pinchAround===void 0?h.around:h.pinchAround;v.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function om(g,o){(!g.duration||g.duration<o.duration)&&(g.duration=o.duration,g.easing=o.easing)}function lm(g,o,h){const{maxSpeed:_,linearity:v,deceleration:S}=h,T=a.aA(g*v/(o/1e3),-_,_),I=Math.abs(T)/(S*v);return{easing:h.easing,duration:1e3*I,amount:T*(I/2)}}class ui extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,_,v={}){const S=ue(h.getCanvasContainer(),_),T=h.unproject(S);super(o,Object.assign({point:S,lngLat:T,originalEvent:_},v)),this._defaultPrevented=!1,this.target=h}}class cm extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,_){const v=o==="touchend"?_.changedTouches:_.touches,S=ge(h.getCanvasContainer(),v),T=S.map(A=>h.unproject(A)),I=S.reduce((A,L,F,H)=>A.add(L.div(H.length)),new a.P(0,0));super(o,{points:S,point:I,lngLats:T,lngLat:h.unproject(I),originalEvent:_}),this._defaultPrevented=!1}}class pb extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class mb{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new pb(this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new ui(o.type,this._map,o))}mouseup(o){this._map.fire(new ui(o.type,this._map,o))}preclick(o){const h=new MouseEvent("preclick",o);this._map.fire(new ui(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new ui(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new ui(o.type,this._map,o))}mouseover(o){this._map.fire(new ui(o.type,this._map,o))}mouseout(o){this._map.fire(new ui(o.type,this._map,o))}touchstart(o){return this._firePreventable(new cm(o.type,this._map,o))}touchmove(o){this._map.fire(new cm(o.type,this._map,o))}touchend(o){this._map.fire(new cm(o.type,this._map,o))}touchcancel(o){this._map.fire(new cm(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Of{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new ui(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ui("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new ui(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gb{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(Q(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const _=h,v=this._startPos,S=this._lastPos;if(!v||!S||S.equals(_)||!this._box&&_.dist(v)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=W("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const T=Math.min(v.x,_.x),I=Math.max(v.x,_.x),A=Math.min(v.y,_.y),L=Math.max(v.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${A}px)`,this._box.style.width=I-T+"px",this._box.style.height=L-A+"px")})}mouseupWindow(o,h){if(!this._active)return;const _=this._startPos,v=h;if(_&&o.button===0){if(this.reset(),pe(),_.x!==v.x||_.y!==v.y)return this._map.fire(new a.z("boxzoomend",{originalEvent:o})),{cameraAnimation:S=>S.fitScreenCoordinates(_,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),re(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new a.z(o,{originalEvent:h}))}}function o_(g,o){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=o[_];return h}class _b{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){const S=new a.P(0,0);for(const T of v)S._add(T);return S.div(v.length)}(h),this.touches=o_(_,h)))}touchmove(o,h,_){if(this.aborted||!this.centroid)return;const v=o_(_,h);for(const S in this.touches){const T=v[S];(!T||T.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(o,h,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Rh{constructor(o){this.singleTap=new _b(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,h,_){this.singleTap.touchstart(o,h,_)}touchmove(o,h,_){this.singleTap.touchmove(o,h,_)}touchend(o,h,_){const v=this.singleTap.touchend(o,h,_);if(v){const S=o.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(S&&T||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class yb{constructor(){this._zoomIn=new Rh({numTouches:1,numTaps:2}),this._zoomOut=new Rh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,_){this._zoomIn.touchstart(o,h,_),this._zoomOut.touchstart(o,h,_)}touchmove(o,h,_){this._zoomIn.touchmove(o,h,_),this._zoomOut.touchmove(o,h,_)}touchend(o,h,_){const v=this._zoomIn.touchend(o,h,_),S=this._zoomOut.touchend(o,h,_);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:o})}):S?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(S)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const kx={0:1,2:2},Rx={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class um{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const _=ce(o);this._correctButton(o,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(o,h){const _=this._lastPoint;if(_){if(o.preventDefault(),this._eventButton!=null&&function(v,S){const T=kx[S];return v.buttons===void 0||(v.buttons&T)!==T}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}}mouseupWindow(o){this._lastPoint&&ce(o)===this._eventButton&&(this._moved&&pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xb extends um{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class Mx extends um{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Rx[o.pitchRotateKey]:void 0}_correctButton(o,h){return this._pitchRotateKey?h===0&&o[this._pitchRotateKey]:h===0&&o.ctrlKey||h===2}_move(o,h){const _=.8*(h.x-o.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class vb extends um{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Rx[o.pitchRotateKey]:void 0}_correctButton(o,h){return this._pitchRotateKey?h===0&&o[this._pitchRotateKey]:h===0&&o.ctrlKey||h===2}_move(o,h){const _=-.5*(h.y-o.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class LT{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),a.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(o,h,_){return this._calculateTransform(o,h,_)}touchmove(o,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!a.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,h,_)}}touchend(o,h,_){this._calculateTransform(o,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,_){_.length>0&&(this._active=!0);const v=o_(_,h),S=new a.P(0,0),T=new a.P(0,0);let I=0;for(const L in v){const F=v[L],H=this._touches[L];H&&(S._add(F),T._add(F.sub(H)),I++,v[L]=F)}if(this._touches=v,I<this._minTouches||!T.mag())return;const A=T.div(I);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(I),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Dx{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,h,_){return{}}touchstart(o,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,_){const v=this._firstTwoTouches;if(!v)return;o.preventDefault();const[S,T]=v,I=l_(_,h,S),A=l_(_,h,T);if(!I||!A)return;const L=this._aroundCenter?null:I.add(A).div(2);return this._move([I,A],L,o)}touchend(o,h,_){if(!this._firstTwoTouches)return;const[v,S]=this._firstTwoTouches,T=l_(_,h,v),I=l_(_,h,S);T&&I||(this._active&&pe(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function l_(g,o,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return o[_]}function wb(g,o){return Math.log2(g/o)}class FT extends Dx{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(wb(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wb(this._distance,_),pinchAround:h}}}function bb(g,o){return 180*g.angleWith(o)/Math.PI}class zT extends Dx{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const _=this._vector;if(this._vector=o[0].sub(o[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bb(this._vector,_),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const v=bb(o,_);return Math.abs(v)<h}}function Ox(g){return Math.abs(g.y)>Math.abs(g.x)}class BT extends Dx{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Ox(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,_){const v=this._lastPoints;if(!v)return;const S=o[0].sub(v[0]),T=o[1].sub(v[1]);return this._map._cooperativeGestures&&!a.eT()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(S,T,_.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(S.y+T.y)/2*-.5})}gestureBeginsVertically(o,h,_){if(this._valid!==void 0)return this._valid;const v=o.mag()>=2,S=h.mag()>=2;if(!v&&!S)return;if(!v||!S)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const T=o.y>0==h.y>0;return Ox(o)&&Ox(h)&&T}}const VT={panStep:100,bearingStep:15,pitchStep:10};class UT{constructor(){const o=VT;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,_=0,v=0,S=0,T=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),S=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),S=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),T=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:I=>{const A=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:$T,zoom:h?Math.round(A)+h*(o.shiftKey?2:1):A,bearing:I.getBearing()+_*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-S*this._panStep,-T*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $T(g){return g*(2-g)}const qT=4.000244140625,nP=1/450;class sP{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=nP,a.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||a.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const _=a.o.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%qT==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=ue(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>qT?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&F!==0&&(F=1/F);const H=h(),U=Math.pow(2,H),Y=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Y*F))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,S=this._easing;let T,I=!1;if(this._type==="wheel"&&v&&S){const L=Math.min((a.o.now()-this._lastWheelEventTime)/200,1),F=S(L);T=a.ak(v,_,F),L<1?this._frameId||(this._frameId=!0):I=!0}else T=_,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=T-h();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=a.eU;if(this._prevEase){const _=this._prevEase,v=(a.o.now()-_.start)/_.duration,S=_.easing(v+.01)-_.easing(v),T=.27/Math.sqrt(S*S+1e-4)*.01,I=Math.sqrt(.0729-T*T);h=a.eS(T,I,.25,1)}return this._prevEase={start:a.o.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class xi{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class GT{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(o.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iP{constructor(){this._tap=new Rh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,h,_){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(o,h,_))}touchmove(o,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const v=h[0],S=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(o,h,_)}touchend(o,h,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(o,h,_)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class aP{constructor(o,h,_){this._el=o,this._mousePan=h,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class oP{constructor(o,h,_){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class c_{constructor(o,h,_,v){this._el=o,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const u_=g=>g.zoom||g.drag||g.pitch||g.rotate;class Sb extends a.z{}class Lx{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){const _=a.av([],h,o);this.radius=a.ag(_[2]<0?a.eW([],_,this.constants):[_[0],_[1],0])}projectRay(o){a.eW(o,o,this.constants),a.aw(o,o),a.eX(o,o,this.constants);const h=a.c4([],o,this.radius);if(h[2]>0){const _=a.c4([],[0,0,1],a.bI(h,[0,0,1])),v=a.c4([],a.aw([],[h[0],h[1],0]),this.radius),S=a.d7([],h,a.c4([],a.av([],a.d7([],v,_),h),2));h[0]=S[0],h[1]=S[1]}return h}}function Uc(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Fx{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Px(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Lx,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),a.aX(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,S,T]of this._listeners){const I=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(S,I,T)}}destroy(){for(const[o,h,_]of this._listeners){const v=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(h,v,_)}}_addDefaultHandlers(o){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new mb(h,o));const v=h.boxZoom=new gb(h,o);this._add("boxZoom",v);const S=new yb,T=new GT;h.doubleClickZoom=new xi(T,S),this._add("tapZoom",S),this._add("clickZoom",T);const I=new iP;this._add("tapDragZoom",I);const A=h.touchPitch=new BT(h);this._add("touchPitch",A);const L=new Mx(o),F=new vb(o);h.dragRotate=new oP(o,L,F),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const H=new xb(o),U=new LT(h,o);h.dragPan=new aP(_,H,U),this._add("mousePan",H),this._add("touchPan",U,["touchZoom","touchRotate"]);const Y=new zT,te=new FT;h.touchZoomRotate=new c_(_,te,Y,I),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Of(h));const se=h.scrollZoom=new sP(h,this);this._add("scrollZoom",se,["mousePan"]);const fe=h.keyboard=new UT;this._add("keyboard",fe);for(const de of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[de]&&h[de].enable(o[de])}_add(o,h,_){this._handlers.push({handlerName:o,handler:h,allowed:_}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!u_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,h,_){for(const v in o)if(v!==_&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const _ of o)this._el.contains(_.target)&&h.push(_);return h}handleEvent(o,h){this._updatingCamera=!0;const _=o.type==="renderFrame",v=_?void 0:o,S={needsRenderFrame:!1},T={},I={},A=o.touches?this._getMapTouches(o.touches):void 0,L=A?ge(this._el,A):_?void 0:ue(this._el,o);for(const{handlerName:U,handler:Y,allowed:te}of this._handlers){if(!Y.isEnabled())continue;let se;this._blockedByActive(I,te,U)?Y.reset():Y[h||o.type]&&(se=Y[h||o.type](o,L,A),this.mergeHandlerResult(S,T,se,U,v),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||Y.isActive())&&(I[U]=Y)}const F={};for(const U in this._previousActiveHandlers)I[U]||(F[U]=v);this._previousActiveHandlers=I,(Object.keys(F).length||Uc(S))&&(this._changes.push([S,T,F]),this._triggerRenderFrame()),(Object.keys(I).length||Uc(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=S;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(o,h,_,v,S){if(!_)return;Object.assign(o,_);const T={handlerName:v,originalEvent:_.originalEvent||S};_.zoomDelta!==void 0&&(h.zoom=T),_.panDelta!==void 0&&(h.drag=T),_.pitchDelta!==void 0&&(h.pitch=T),_.bearingDelta!==void 0&&(h.rotate=T)}_applyChanges(){const o={},h={},_={};for(const[v,S,T]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new a.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(o.around=v.around),v.aroundCoord!==void 0&&(o.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),Object.assign(h,S),Object.assign(_,T);this._updateMapTransform(o,h,_),this._changes=[]}_updateMapTransform(o,h,_){const v=this._map,S=v.transform,T=_e=>[_e.x,_e.y,_e.z];if((_e=>{const Ee=this._eventsInProgress.drag;return Ee&&!this._handlersById[Ee.handlerName].isActive()})()&&!Uc(o)){const _e=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),_e!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&v._stop(!0),!Uc(o))return void this._fireEvents(h,_,!0);let{panDelta:I,zoomDelta:A,bearingDelta:L,pitchDelta:F,around:H,aroundCoord:U,pinchAround:Y}=o;S._isCameraConstrained&&(A>0&&(A=0),S._isCameraConstrained=!1),Y!==void 0&&(H=Y),(A||(_e=>h[_e]&&!this._eventsInProgress[_e])("drag"))&&H&&(this._dragOrigin=T(S.pointCoordinate3D(H)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",v._stop(!0),H=H||v.transform.centerPoint,L&&(S.bearing+=L),F&&(S.pitch+=F),S._updateCameraState();const te=[0,0,0];if(I)if(S.projection.name==="mercator"){const _e=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(H).dir),Ee=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(H.sub(I)).dir);te[0]=Ee[0]-_e[0],te[1]=Ee[1]-_e[1]}else{const _e=S.pointCoordinate(H);if(S.projection.name==="globe"){I=I.rotate(-S.angle);const Ee=S._pixelsPerMercatorPixel/S.worldSize;te[0]=-I.x*a.eV(a.a_(_e.y))*Ee,te[1]=-I.y*a.eV(S.center.lat)*Ee}else{const Ee=S.pointCoordinate(H.sub(I));_e&&Ee&&(te[0]=Ee.x-_e.x,te[1]=Ee.y-_e.y)}}const se=S.zoom,fe=[0,0,0];if(A){const _e=T(U||S.pointCoordinate3D(H)),Ee={dir:a.aw([],a.av([],_e,S._camera.position))};if(Ee.dir[2]<0){const xe=S.zoomDeltaToMovement(_e,A);a.c4(fe,Ee.dir,xe)}}const de=a.d7(te,te,fe);S._translateCameraConstrained(de),A&&Math.abs(S.zoom-se)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,_,!0)}_fireEvents(o,h,_){const v=u_(this._eventsInProgress),S=u_(o),T={};for(const F in o){const{originalEvent:H}=o[F];this._eventsInProgress[F]||(T[`${F}start`]=H),this._eventsInProgress[F]=o[F]}!v&&S&&this._fireEvent("movestart",S.originalEvent);for(const F in T)this._fireEvent(F,T[F]);S&&this._fireEvent("move",S.originalEvent);for(const F in o){const{originalEvent:H}=o[F];this._fireEvent(F,H)}const I={};let A;for(const F in this._eventsInProgress){const{handlerName:H,originalEvent:U}=this._eventsInProgress[F];this._handlersById[H].isActive()||(delete this._eventsInProgress[F],A=h[H]||U,I[`${F}end`]=A)}for(const F in I)this._fireEvent(F,I[F]);const L=u_(this._eventsInProgress);if(_&&(v||S)&&!L){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;F?(H(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:A})):(this._map.fire(new a.z("moveend",{originalEvent:A})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new a.z(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Sb("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qi="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Zu extends a.E{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,a.aX(["_renderFrameCallback"],this)}getCenter(){return new a.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,_){return o=a.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},h),_)}panTo(o,h,_){return this.easeTo(Object.assign({center:o},h),_)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,_){return this.easeTo(Object.assign({zoom:o},h),_)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,_){return this.easeTo(Object.assign({bearing:o},h),_)}resetNorth(o,h){return this.rotateTo(0,Object.assign({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=a.aI.convert(o);const _=h&&h.bearing||0,v=h&&h.pitch||0,S=o.getNorthWest(),T=o.getSouthEast();return this._cameraForBounds(this.transform,S,T,_,v,h)}_extendPadding(o){const h={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},h,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},h,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,h){const _=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return _/v>o.aspect?_/(2*Math.tan(.5*o.fovX)*o.aspect):v/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,h,_,v,S,T){const I=o.clone(),A=this._extendCameraOptions(T);I.bearing=v,I.pitch=S;const L=a.aS.convert(h),F=a.aS.convert(_),H=.5*(L.lat+F.lat),U=.5*(L.lng+F.lng),Y=a.eY(H,U),te=a.aw([],Y),se=a.aw([],a.bH([],te,[0,1,0])),fe=a.bH([],se,te),de=[se[0],se[1],se[2],0,fe[0],fe[1],fe[2],0,te[0],te[1],te[2],0,0,0,0,1],_e=[Y,a.eY(L.lat,L.lng),a.eY(F.lat,L.lng),a.eY(F.lat,F.lng),a.eY(L.lat,F.lng),a.eY(H,L.lng),a.eY(H,F.lng),a.eY(L.lat,U),a.eY(F.lat,U)];let Ee=a.d8.fromPoints(_e.map(lt=>[a.bI(se,lt),a.bI(fe,lt),a.bI(te,lt)]));const xe=a.af([],Ee.center,de);a.eZ(xe)===0&&a.e_(xe,0,0,1),a.aw(xe,xe),a.c4(xe,xe,a.aD),I.center=a.e$(xe);const Re=I.getWorldToCameraMatrix(),Te=a.bk(new Float64Array(16),Re);Ee=a.d8.applyTransform(Ee,a.aB([],Re,de));const De=this._extendAABB(Ee,I,A,v);if(!De)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ee=De,a.af(xe,xe,Re);const Pe=.5*(Ee.max[2]-Ee.min[2]),Ie=this._minimumAABBFrustumDistance(I,Ee),Oe=a.c4([],[0,0,1],Pe),et=a.d7(Oe,xe,Oe),Ke=Ie+(I.pitch===0?0:a.bF(xe,et)),pt=I.globeCenterInViewSpace,ot=a.av([],xe,[pt[0],pt[1],pt[2]]);a.aw(ot,ot),a.c4(ot,ot,Ke);const vt=a.d7([],xe,ot);a.af(vt,vt,Te);const qt=a.eL/a.aD,nt=a.ag(vt),Ue=a.ce(Math.max(nt*qt-a.eL,Number.EPSILON),0),wt=Math.min(I.zoomFromMercatorZAdjusted(Ue),A.maxZoom);return wt>.5*(a.cZ+a.cK)?(I.setProjection({name:"mercator"}),I.zoom=wt,this._cameraForBounds(I,h,_,v,S,T)):{center:I.center,zoom:wt,bearing:v,pitch:S}}_extendAABB(o,h,_,v){const S=.5*((_.padding.left||0)+(_.padding.right||0)),T=.5*((_.padding.top||0)+(_.padding.bottom||0)),I=T,A=S,L=S,F=T,H=h.width-(A+L),U=h.height-(I+F),Y=a.av([],o.max,o.min),te=Math.min(H/Y[0],U/Y[1]),se=Math.min(h.scaleZoom(h.scale*te),_.maxZoom);if(isNaN(se))return null;const fe=h.scale/h.zoomScale(se),de=new a.d8([o.min[0]-A*fe,o.min[1]-F*fe,o.min[2]],[o.max[0]+L*fe,o.max[1]+I*fe,o.max[2]]),_e=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new a.P(_.offset.x,_.offset.y):a.P.convert(_.offset)).rotate(-a.an(v));return de.center[0]-=_e.x*fe,de.center[1]+=_e.y*fe,de}queryTerrainElevation(o,h){const _=this.transform.elevation;return _?(h=Object.assign({},{exaggerated:!0},h),_.getAtPoint(a.ae.fromLngLat(o),null,h.exaggerated)):null}_cameraForBounds(o,h,_,v,S,T){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,h,_,v,S,T);const I=o.clone(),A=this._extendCameraOptions(T);I.bearing=v,I.pitch=S;const L=a.aS.convert(h),F=a.aS.convert(_),H=new a.aS(L.lng,F.lat),U=new a.aS(F.lng,L.lat),Y=I.project(L),te=I.project(F),se=this.queryTerrainElevation(L),fe=this.queryTerrainElevation(F),de=this.queryTerrainElevation(H),_e=this.queryTerrainElevation(U),Ee=[[Y.x,Y.y,Math.min(se||0,fe||0,de||0,_e||0)],[te.x,te.y,Math.max(se||0,fe||0,de||0,_e||0)]];let xe=a.d8.fromPoints(Ee);const Re=I.getWorldToCameraMatrix(),Te=a.bk(new Float64Array(16),Re);xe=a.d8.applyTransform(xe,Re);const De=this._extendAABB(xe,I,A,v);if(!De)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xe=De;const Pe=.5*a.av([],xe.max,xe.min)[2],Ie=this._minimumAABBFrustumDistance(I,xe),Oe=[0,0,1,0];a.aC(Oe,Oe,Re),a.f0(Oe,Oe);const et=a.c4([],Oe,Ie+Pe),Ke=a.d7([],xe.center,et);a.af(xe.center,xe.center,Te),a.af(Ke,Ke,Te);const pt=I.unproject(new a.P(xe.center[0],xe.center[1])),ot=a.f1(I.projection,pt),vt=Math.pow(2,ot),qt=Math.min(I._zoomFromMercatorZ(Ke[2]*I.pixelsPerMeter*vt/I.worldSize),A.maxZoom);return I.mercatorFromTransition&&qt<.5*(a.cZ+a.cK)?(I.setProjection({name:"globe"}),I.zoom=qt,this._cameraForBounds(I,h,_,v,S,T)):{center:pt,zoom:qt,bearing:v,pitch:S}}fitBounds(o,h,_){const v=this.cameraForBounds(o,h);return this._fitInternal(v,h,_)}fitScreenCoordinates(o,h,_,v,S){const T=a.P.convert(o),I=a.P.convert(h),A=new a.P(Math.min(T.x,I.x),Math.min(T.y,I.y)),L=new a.P(Math.max(T.x,I.x),Math.max(T.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,I))return this;const F=this.transform.pointLocation3D(A),H=this.transform.pointLocation3D(L),U=this.transform.pointLocation3D(new a.P(A.x,L.y)),Y=this.transform.pointLocation3D(new a.P(L.x,A.y)),te=[Math.min(F.lng,H.lng,U.lng,Y.lng),Math.min(F.lat,H.lat,U.lat,Y.lat)],se=[Math.max(F.lng,H.lng,U.lng,Y.lng),Math.max(F.lat,H.lat,U.lat,Y.lat)],fe=v&&v.pitch?v.pitch:this.getPitch(),de=this._cameraForBounds(this.transform,te,se,_,fe,v);return this._fitInternal(de,v,S)}_fitInternal(o,h,_){return o?(h=Object.assign(o,h)).linear?this.easeTo(h,_):this.flyTo(h,_):this}jumpTo(o,h){this.stop();const _=o.preloadOnly?this.transform.clone():this.transform;let v=!1,S=!1,T=!1;"zoom"in o&&_.zoom!==+o.zoom&&(v=!0,_.zoom=+o.zoom),o.center!==void 0&&(_.center=a.aS.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(S=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(T=!0,_.pitch=+o.pitch);const I=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!_.isPaddingEqual(I))if(o.retainPadding===!1){const A=_.clone();A.padding=I,_.setLocationAtPoint(_.center,A.centerPoint)}else _.padding=I;return o.preloadOnly?(this._preloadTiles(_),this):(this.fire(new a.z("movestart",h)).fire(new a.z("move",h)),v&&this.fire(new a.z("zoomstart",h)).fire(new a.z("zoom",h)).fire(new a.z("zoomend",h)),S&&this.fire(new a.z("rotatestart",h)).fire(new a.z("rotate",h)).fire(new a.z("rotateend",h)),T&&this.fire(new a.z("pitchstart",h)).fire(new a.z("pitch",h)).fire(new a.z("pitchend",h)),this.fire(new a.z("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(Qi),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return a.w(Qi),this;this.stop();const v=_.zoom,S=_.pitch,T=_.bearing;_.setFreeCameraOptions(o);const I=v!==_.zoom,A=S!==_.pitch,L=T!==_.bearing;return this.fire(new a.z("movestart",h)).fire(new a.z("move",h)),I&&this.fire(new a.z("zoomstart",h)).fire(new a.z("zoom",h)).fire(new a.z("zoomend",h)),L&&this.fire(new a.z("rotatestart",h)).fire(new a.z("rotate",h)).fire(new a.z("rotateend",h)),A&&this.fire(new a.z("pitchstart",h)).fire(new a.z("pitch",h)).fire(new a.z("pitchend",h)),this.fire(new a.z("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:a.eU},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const _=this.transform,v=this.getZoom(),S=this.getBearing(),T=this.getPitch(),I=this.getPadding(),A="zoom"in o?+o.zoom:v,L="bearing"in o?this._normalizeBearing(o.bearing,S):S,F="pitch"in o?+o.pitch:T,H=this._extendPadding(o.padding),U=a.P.convert(o.offset);let Y,te,se;if(_.projection.name==="globe"){const Oe=a.ae.fromLngLat(_.center),et=U.rotate(-_.angle);Oe.x+=et.x/_.worldSize,Oe.y+=et.y/_.worldSize;const Ke=Oe.toLngLat(),pt=a.aS.convert(o.center||Ke);this._normalizeCenter(pt),Y=_.centerPoint.add(et),te=new a.P(Oe.x,Oe.y).mult(_.worldSize),se=new a.P(a.aF(pt.lng),a.aJ(pt.lat)).mult(_.worldSize).sub(te)}else{Y=_.centerPoint.add(U);const Oe=_.pointLocation(Y),et=a.aS.convert(o.center||Oe);this._normalizeCenter(et),te=_.project(Oe),se=_.project(et).sub(te)}const fe=_.zoomScale(A-v);let de,_e;o.around&&(de=a.aS.convert(o.around),_e=_.locationPoint(de));const Ee=this._zooming||A!==v,xe=this._rotating||S!==L,Re=this._pitching||F!==T,Te=!_.isPaddingEqual(H),De=o.retainPadding===!1?_.clone():_,Pe=Oe=>et=>{if(Ee&&(Oe.zoom=a.ak(v,A,et)),xe&&(Oe.bearing=a.ak(S,L,et)),Re&&(Oe.pitch=a.ak(T,F,et)),Te&&(De.interpolatePadding(I,H,et),Y=De.centerPoint.add(U)),de)Oe.setLocationAtPoint(de,_e);else{const Ke=Oe.zoomScale(Oe.zoom-v),pt=A>v?Math.min(2,fe):Math.max(.5,fe),ot=Math.pow(pt,1-et),vt=Oe.unproject(te.add(se.mult(et*ot)).mult(Ke));Oe.setLocationAtPoint(Oe.renderWorldCopies?vt.wrap():vt,Y)}return o.preloadOnly||this._fireMoveEvents(h),Oe};if(o.preloadOnly){const Oe=this._emulate(Pe,o.duration,_);return this._preloadTiles(Oe),this}const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ee,this._rotating=xe,this._pitching=Re,this._padding=Te,this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Ie),this._ease(Pe(_),Oe=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(h,Oe)},o),this}_prepareEase(o,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||_.moving||this.fire(new a.z("movestart",o)),this._zooming&&!_.zooming&&this.fire(new a.z("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new a.z("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new a.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new a.z("move",o)),this._zooming&&this.fire(new a.z("zoom",o)),this._rotating&&this.fire(new a.z("rotate",o)),this._pitching&&this.fire(new a.z("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,v=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new a.z("zoomend",o)),v&&this.fire(new a.z("rotateend",o)),S&&this.fire(new a.z("pitchend",o)),this.fire(new a.z("moveend",o))}flyTo(o,h){if(this._prefersReducedMotion(o)){const lt=a.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(lt,h)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:a.eU},o);const _=this.transform,v=this.getZoom(),S=this.getBearing(),T=this.getPitch(),I=this.getPadding(),A="zoom"in o?a.aA(+o.zoom,_.minZoom,_.maxZoom):v,L="bearing"in o?this._normalizeBearing(o.bearing,S):S,F="pitch"in o?+o.pitch:T,H=this._extendPadding(o.padding),U=_.zoomScale(A-v),Y=a.P.convert(o.offset);let te=_.centerPoint.add(Y);const se=_.pointLocation(te),fe=a.aS.convert(o.center||se);this._normalizeCenter(fe);const de=_.project(se),_e=_.project(fe).sub(de);let Ee=o.curve;const xe=Math.max(_.width,_.height),Re=xe/U,Te=_e.mag();if("minZoom"in o){const lt=a.aA(Math.min(o.minZoom,v,A),_.minZoom,_.maxZoom),Pt=xe/_.zoomScale(lt-v);Ee=Math.sqrt(Pt/Te*2)}const De=Ee*Ee;function Pe(lt){const Pt=(Re*Re-xe*xe+(lt?-1:1)*De*De*Te*Te)/(2*(lt?Re:xe)*De*Te);return Math.log(Math.sqrt(Pt*Pt+1)-Pt)}function Ie(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Oe(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const et=Pe(0);let Ke=function(lt){return Oe(et)/Oe(et+Ee*lt)},pt=function(lt){return xe*((Oe(et)*(Ie(Pt=et+Ee*lt)/Oe(Pt))-Ie(et))/De)/Te;var Pt},ot=(Pe(1)-et)/Ee;if(Math.abs(Te)<1e-6||!isFinite(ot)){if(Math.abs(xe-Re)<1e-6)return this.easeTo(o,h);const lt=Re<xe?-1:1;ot=Math.abs(Math.log(Re/xe))/Ee,pt=function(){return 0},Ke=function(Pt){return Math.exp(lt*Ee*Pt)}}o.duration="duration"in o?+o.duration:1e3*ot/("screenSpeed"in o?+o.screenSpeed/Ee:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const vt=S!==L,qt=F!==T,nt=!_.isPaddingEqual(H),Ue=o.retainPadding===!1?_.clone():_,wt=lt=>Pt=>{const Kt=Pt*ot,gr=1/Ke(Kt);lt.zoom=Pt===1?A:v+lt.scaleZoom(gr),vt&&(lt.bearing=a.ak(S,L,Pt)),qt&&(lt.pitch=a.ak(T,F,Pt)),nt&&(Ue.interpolatePadding(I,H,Pt),te=Ue.centerPoint.add(Y));const Ut=Pt===1?fe:lt.unproject(de.add(_e.mult(pt(Kt))).mult(gr));return lt.setLocationAtPoint(lt.renderWorldCopies?Ut.wrap():Ut,te),lt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(h),lt};if(o.preloadOnly){const lt=this._emulate(wt,o.duration,_);return this._preloadTiles(lt),this}return this._zooming=!0,this._rotating=vt,this._pitching=qt,this._padding=nt,this._prepareEase(h,!1),this._ease(wt(_),()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!o){const _=this.handlers;_&&_.stop(!1)}return this}_ease(o,h,_){_.animate===!1||_.duration===0?(o(1),h()):(this._easeStart=a.o.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((a.o.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=a.bS(o,-180,180);const _=Math.abs(o-h);return Math.abs(o-360-h)<_&&(o-=360),Math.abs(o+360-h)<_&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const _=o.lng-h.center.lng;o.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&a.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,h,_){const v=Math.ceil(15*h/1e3),S=[],T=o(_.clone());for(let I=0;I<=v;I++){const A=T(I/v);S.push(A.clone())}return S}_preloadTiles(o,h){}}class dm{constructor(o={}){this.options=o,a.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const h=this.options&&this.options.compact,_=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const v=W("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",_),this._innerContainer=W("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(o){const _=h.reduce((v,S,T)=>(S.value&&(v+=`${S.key}=${S.value}${T<h.length-1?"&":""}`),v),"?");o.href=`${a.e.FEEDBACK_URL}/${_}#${Ax(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style._mergedSourceCaches;for(const v in h){const S=h[v];if(S.used){const T=S.getSource();T.attribution&&o.indexOf(T.attribution)<0&&o.push(T.attribution)}}o.sort((v,S)=>v.length-S.length),o=o.filter((v,S)=>{for(let T=S+1;T<o.length;T++)if(o[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class d_{constructor(){a.aX(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=W("div","mapboxgl-ctrl");const h=W("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const h in o){const _=o[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Eb{constructor(){a.aX(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",h=>this._onIndoorUpdate(h)),this._container}_createButton(o,h){const _=W("button",o,this._container);return _.type="button",_.addEventListener("click",h),_}_createSeparator(){return W("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,h){this._map&&(o.setAttribute("aria-label",h),o.textContent=h)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");const h=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",h&&Array.from(this._container.children).forEach(_=>_.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const h=this._map;this._model&&h&&h._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});W("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){const o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,h){for(let _=0;_<o.length;_++){const v=o[_],S=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(v.id)});this._setButtonTitle(S,v.zIndex.toString()),this._model&&v.id===this._model.selectedFloorId&&h&&S.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(S),_<o.length-1&&this._createSeparator()}}}class HT{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const v of _)if(v.id===o)return void(v.cancelled=!0)}run(o=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class h_{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const h=a.dC((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,_){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+_}}const lP={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class WT extends a.z{constructor(o,h,_,v){const{point:S,lngLat:T,originalEvent:I,target:A}=o;super(o.type,{point:S,lngLat:T,originalEvent:I,target:A}),this.preventDefault=()=>{o.preventDefault()},this.id=h,this.interaction=_,this.feature=v}}class Tb{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,h){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const _=h.filter;let v=h.type;_&&this.filters.set(o,a.b5(_)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const S=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,h)):S.size===0&&this.map.on(v,this.handleType),S.size===0&&this.interactionsByType.set(v,S),S.set(o,h),this.typeById.set(o,v)}get(o){const h=this.typeById.get(o);if(!h)return;const _=this.interactionsByType.get(h);return _?_.get(o):void 0}remove(o){const h=this.typeById.get(o);if(!h)return;this.typeById.delete(o),this.filters.delete(o);const _=this.interactionsByType.get(h);_&&(_.delete(o),h==="mouseenter"||h==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):_.size===0&&this.map.off(h,this.handleType))}queryTargets(o,h){const _=[];for(const[v,S]of h)S.target&&_.push({targetId:v,target:S.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(o,_,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());h.length&&(o.type="mouseenter",this.handleType(o,h));const _=new Map;for(const[v,{feature:S}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||_.set(S.id,S);_.size&&(o.type="mouseleave",this.handleType(o,Array.from(_.values())))}handleOut(o){const h=Array.from(this.hoveredFeatures.values()).map(({feature:_})=>_);h.length&&(o.type="mouseleave",this.handleType(o,h)),this.hoveredFeatures.clear()}handleType(o,h){const _=o.type==="mouseenter";if(_&&!this.interactionsByType.has(o.type))return void a.w("mouseenter interaction required for mouseleave to work.");const v=Array.from(this.interactionsByType.get(o.type)).reverse(),S=!!h;h=h||this.queryTargets(o.point,v);let T=!1;const I=new Set;for(const A of h){for(const[L,F]of v){if(!F.target)continue;const H=A.variants?A.variants[L]:null;if(H){for(const U of H){if(Uo(U,A,I,L))continue;const Y=new a.dw(A,U),te=el(U,A,L);S&&Y.id!==void 0&&(Y.state=this.map.getFeatureState(Y));const se=_?this.prevHoveredFeatures.get(te):null,fe=new WT(o,L,F,Y),de=se?se.stop:F.handler(fe);if(_&&this.hoveredFeatures.set(te,{feature:A,stop:de}),de!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[A,L]of v){const{handler:F,target:H}=L;if(!H&&F(new WT(o,A,L,null))!==!1)break}}}function jb(g,o){if(Array.isArray(g)&&Array.isArray(o)){const h=new Set(g),_=new Set(o);return h.size===_.size&&g.every(v=>_.has(v))}return a.bx(g,o)}const zx={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Bx={showCompass:!0,showZoom:!0,visualizePitch:!1};class f_{constructor(o,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Mx({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,_&&(this.mousePitch=new vb({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),a.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),Q()}move(o,h){const _=this.map,v=this.mouseRotate.mousemoveWindow(o,h),S=v&&v.bearingDelta;if(S&&_.setBearing(_.getBearing()+S),this.mousePitch){const T=this.mousePitch.mousemoveWindow(o,h),I=T&&T.pitchDelta;I&&_.setPitch(_.getPitch()+I)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){re(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ue(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ue(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ge(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=ge(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function jd(g,o,h){if(g=new a.aS(g.lng,g.lat),o){const _=new a.aS(g.lng-360,g.lat),v=new a.aS(g.lng+360,g.lat),S=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),T=h.locationPoint3D(g).distSqr(o),I=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint3D(_).distSqr(o)<T&&(I||Math.abs(_.lng-h.center.lng)<S)?g=_:h.locationPoint3D(v).distSqr(o)<T&&(I||Math.abs(v.lng-h.center.lng)<S)&&(g=v)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint3D(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const yu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},jo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Nd extends a.E{constructor(o,h){super(),(o instanceof HTMLElement||h)&&(o=Object.assign({element:o},h)),a.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:_="center",color:v="#3FB1CE",scale:S=1,draggable:T=!1,clickTolerance:I=0,rotation:A=jo.rotation,rotationAlignment:L=jo.rotationAlignment,pitchAlignment:F=jo.pitchAlignment,occludedOpacity:H=jo.occludedOpacity,altitude:U=jo.altitude}=o||{};this._anchor=_,this._color=v,this._scale=S,this._draggable=T,this._clickTolerance=I,this._rotation=A,this._rotationAlignment=L,this._pitchAlignment=F,this._occludedOpacity=H,this._altitude=U,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=a.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=a.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",se=>{se.preventDefault()}),this._element.addEventListener("mousedown",se=>{se.preventDefault()});const Y=this._element.classList;for(const se in yu)Y.remove(`mapboxgl-marker-anchor-${se}`);Y.add(`mapboxgl-marker-anchor-${this._anchor}`);const te=o&&o.className?o.className.trim().split(/\s+/):[];Y.add(...te),this._popup=null}_createDefaultMarker(){const o=W("div"),h=K("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const _=K("radialGradient",{id:"shadowGradient"},K("defs",{},h));K("stop",{offset:"10%","stop-opacity":.4},_),K("stop",{offset:"100%","stop-opacity":.05},_),K("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return K("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),K("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),K("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.aS.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||jo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const h=o.code,_=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,h=this._pos;if(!o||!h)return!1;const _=o.unproject(h,this._altitude),v=o.getFreeCameraOptions();if(!v.position)return!1;const S=v.position.toLngLat();return S.distanceTo(_)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const h=this._pos;if(!h||h.x<0||h.x>o.transform.width||h.y<0||h.y>o.transform.height)return void this._clearFadeTimer();const _=o.unproject(h,this._altitude);let v;o._showingGlobe()&&a.f4(o.transform,this._lngLat)?v=0:(v=1-o._queryFogOpacity(_),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${yu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const o=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!o||_!=="map")return"";if(!h._showingGlobe()){const A=h.getPitch();return A?`rotateX(${A}deg)`:""}const v=a.cW(a.f5(h.transform,this._lngLat)),S=o.sub(a.f6(h.transform)),T=Math.abs(S.x)+Math.abs(S.y);if(T===0)return"";const I=v/T;return`rotateX(${-S.y*I}deg) rotateY(${S.x*I}deg)`}_calculateZTransform(){const o=this._pos,h=this._map;if(!h||!o)return"";let _=0;const v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){const S=h.project(new a.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=h.project(new a.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(S);_=a.cW(Math.atan2(T.y,T.x))-90}else _=-h.getBearing();else if(v==="horizon"){const S=a.ah(4,6,h.getZoom()),T=a.f6(h.transform);T.y+=S*h.transform.height;const I=o.sub(T),A=a.cW(Math.atan2(I.y,I.x));_=(A>90?A-270:A+90)*(1-S)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=jd(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=a.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const h=this._map;if(!h)return;const _=this._pointerdownPos,v=this._positionDelta;if(_&&v){if(!this._isDragging){const S=this._clickTolerance||h._clickTolerance;if(o.point.dist(_)<S)return;this._isDragging=!0}this._pos=o.point.sub(v),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.z("dragstart"))),this.fire(new a.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.z("dragend")),this._state="inactive"}_addDragHandler(o){const h=this._map,_=this._pos;h&&_&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(_),this._pointerdownPos=o.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const h=this._map;return h&&(o?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||jo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||jo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||jo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||jo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},cP={maxWidth:100,unit:"metric"},uP={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},dP={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},hP=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nb(g=new a.P(0,0),o="bottom"){if(typeof g=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(o){case"top":return new a.P(0,g);case"top-left":return new a.P(h,h);case"top-right":return new a.P(-h,h);case"bottom":return new a.P(0,-g);case"bottom-left":return new a.P(h,-h);case"bottom-right":return new a.P(-h,-h);case"left":return new a.P(g,0);case"right":return new a.P(-g,0)}return new a.P(0,0)}return g instanceof a.P||Array.isArray(g)?a.P.convert(g):a.P.convert(g[o]||[0,0])}return{version:w,supported:V.supported,setRTLTextPlugin:a.fa,getRTLTextPluginStatus:a.f9,Map:class extends Zu{constructor(g){C.mark(E.create);const o=g;if((g=Object.assign({},zx,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&a.f2(window)&&(g.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fp(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new HT,this._domRenderTaskQueue=new HT,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.b1(),this._locale=Object.assign({},lP,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new h_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new ke(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},typeof g.container=="string"){const h=document.getElementById(g.container);if(!h)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=h}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,a.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new tP),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Fx(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||a.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new Cx(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const h=g.bounds;h&&(this.resize(),this.fitBounds(h,Object.assign({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new dm({customAttribution:g.customAttribution})),this._logoControl=new d_,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new a.z(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new a.z(`${h.dataType}dataloading`,h))}),this._interactions=new Tb(this)}_getMapId(){return this._mapId}addControl(g,o){if(o===void 0&&(o=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[o];return o.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(g);return o>-1&&this._controls.splice(o,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new a.z("movestart",g)).fire(new a.z("move",g)),this.fire(new a.z("resize",g)),o&&this.fire(new a.z("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(a.aI.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(o=>o==="auto"?navigator.language:o):g}setLanguage(g){const o=this._parseLanguage(g);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,o=g.projection.name;let h;o==="globe"&&g.zoom>=a.cK?(g.setMercatorFromTransition(),h=!0):o==="mercator"&&g.zoom<a.cK&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(g,o){return this._updateProjection(g||o||{name:"mercator"})}_updateProjection(g){let o;const h=this.transform.mercatorFromTransition;o=g.name==="globe"&&this.transform.zoom>=a.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate();const _=this.transform.getProjection().name==="mercator"&&h!==this.transform.mercatorFromTransition;return(o||_)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,o){return this.transform.locationPoint3D(a.aS.convert(g),o)}unproject(g,o){return this.transform.pointLocation3D(a.P.convert(g),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,o,h){const _=v=>{let S=[];if(Array.isArray(o)){const T=o.filter(I=>this.getLayer(I));S=T.length?this.queryRenderedFeatures(v,{layers:T}):[]}else S=this.queryRenderedFeatures(v,{target:o});return S};if(g==="mouseenter"||g==="mouseover"){let v=!1;return{listener:h,targets:o,delegates:{mousemove:T=>{const I=_(T.point);I.length?v||(v=!0,h.call(this,new ui(g,this,T.originalEvent,{features:I}))):v=!1},mouseout:()=>{v=!1}}}}if(g==="mouseleave"||g==="mouseout"){let v=!1;return{listener:h,targets:o,delegates:{mousemove:I=>{_(I.point).length?v=!0:v&&(v=!1,h.call(this,new ui(g,this,I.originalEvent)))},mouseout:I=>{v&&(v=!1,h.call(this,new ui(g,this,I.originalEvent)))}}}}{const v=S=>{const T=_(S.point);T.length&&(S.features=T,h.call(this,S),delete S.features)};return{listener:h,targets:o,delegates:{[g]:v}}}}on(g,o,h){if(typeof o=="function"||h===void 0)return super.on(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _=this._createDelegatedListener(g,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const v in _.delegates)this.on(v,_.delegates[v]);return this}once(g,o,h){if(typeof o=="function"||h===void 0)return super.once(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _=this._createDelegatedListener(g,o,h);for(const v in _.delegates)this.once(v,_.delegates[v]);return this}off(g,o,h){if(typeof o=="function"||h===void 0)return super.off(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _=this._delegatedListeners?this._delegatedListeners[g]:void 0;return _&&(v=>{for(let S=0;S<v.length;S++){const T=v[S];if(T.listener===h&&jb(T.targets,o)){for(const I in T.delegates)this.off(I,T.delegates[I]);return v.splice(S,1),this}}})(_),this}queryRenderedFeatures(g,o){if(!this.style)return[];if(g===void 0||g instanceof a.P||Array.isArray(g)||o!==void 0||(o=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!o){const S=this.style.queryRenderedFeatures(g,void 0,this.transform),T=this.style.queryRenderedFeatureset(g,void 0,this.transform);return S.concat(T)}let h=!0;if(o.target&&(h=this._isTargetValid(o.target),h&&!o.layers))return this.style.queryRenderedFeatureset(g,o,this.transform);let _=!0;if(o.layers&&Array.isArray(o.layers)){for(const S of o.layers)if(!this._isValidId(S)){_=!1;break}if(_&&!o.target)return this.style.queryRenderedFeatures(g,o,this.transform)}let v=[];return _&&(v=v.concat(this.style.queryRenderedFeatures(g,o,this.transform))),h&&(v=v.concat(this.style.queryRenderedFeatureset(g,o,this.transform))),v}querySourceFeatures(g,o){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,o)}queryRasterValue(g,o,h){return this._isValidId(g)?this.style.queryRasterValue(g,o,h):Promise.resolve(null)}isPointOnSurface(g){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&a.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(g))}addInteraction(g,o){return this._interactions.add(g,o),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&g&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(g,(h,_)=>{if(h){const v=typeof h=="string"?h:h instanceof Error?h.message:h.error;a.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(g,o)}else _&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(g,o))}_getUIString(g){const o=this._locale[g];if(o==null)throw new Error(`Missing UI string '${g}'`);return o}_updateStyle(g,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const h=Object.assign({},o);o&&o.config&&(h.initialConfig=o.config,delete h.config),this.style=new Fc(this,h).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Fc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new a.y(new Error("IDs can't be empty."))),!1):!a.dq(g)||(this.fire(new a.y(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const o of g)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(g)}addSource(g,o){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,o),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,o,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,o,h)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,o,{pixelRatio:h=1,sdf:_=!1,stretchX:v,stretchY:S,content:T}={}){this._lazyInitEmptyStyle();const I=a.I.from(g);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:A,height:L,data:F}=a.o.getImageData(o);this.style.addImage(I,{data:new a.q({width:A,height:L},F),pixelRatio:h,stretchX:v,stretchY:S,content:T,sdf:_,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new a.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:L}=o,F=o;this.style.addImage(I,{data:new a.q({width:A,height:L},new Uint8Array(F.data)),pixelRatio:h,stretchX:v,stretchY:S,content:T,sdf:_,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,g)}}updateImage(g,o){this._lazyInitEmptyStyle();const h=a.I.from(g),_=this.style.getImage(h);if(!_)return void this.fire(new a.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?a.o.getImageData(o):o,{width:S,height:T,data:I}=v;if(S===void 0||T===void 0)return void this.fire(new a.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==(_.usvg?_.icon.usvg_tree.width:_.data.width)||T!==(_.usvg?_.icon.usvg_tree.height:_.data.height))return void this.fire(new a.y(new Error(`The width and height of the updated image (${S}, ${T})
                must be that same as the previous version of the image
                (${_.data.width}, ${_.data.height})`)));const A=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let L=!1;_.usvg?(_.data=new a.q({width:S,height:T},new Uint8Array(I)),_.usvg=!1,_.icon=void 0,L=!0):_.data.replace(I,A),this.style.updateImage(h,_,L)}hasImage(g){return g?!!this.style&&!!this.style.getImage(a.I.from(g)):(this.fire(new a.y(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(a.I.from(g))}loadImage(g,o){a.n(this._requestManager.transformRequest(g,a.R.Image),(h,_)=>{o(h,_ instanceof HTMLImageElement?a.o.getImageData(_):_)})}listImages(){return this.style.listImages().map(g=>g.name)}addModel(g,o){this._lazyInitEmptyStyle(),this.style.addModel(g,o)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new a.y(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,o){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,o),this._update(!0)):this}getSlot(g){const o=this.getLayer(g);return o&&o.slot||null}setSlot(g,o){return this.style.setSlot(g,o),this.style.mergeLayers(),this._update(!0)}addImport(g,o){return this.style.addImport(g,o).catch(h=>this.fire(new a.y(new Error("Failed to add import",h)))),this}updateImport(g,o){return typeof o!="string"&&o.id!==g?(this.removeImport(g),this.addImport(o)):(this.style.updateImport(g,o),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,o){return this.style.moveImport(g,o),this._update(!0)}moveLayer(g,o){return this._isValidId(g)?(this.style.moveLayer(g,o),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const o=this.style.getOwnLayer(g);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,o,h){return this._isValidId(g)?(this.style.setLayerZoomRange(g,o,h),this._update(!0)):this}setFilter(g,o,h={}){return this._isValidId(g)?(this.style.setFilter(g,o,h),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,o,h,_={}){return this._isValidId(g)?(this.style.setPaintProperty(g,o,h,_),this._update(!0)):this}getPaintProperty(g,o){return this._isValidId(g)?this.style.getPaintProperty(g,o):null}setLayoutProperty(g,o,h,_={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,o,h,_),this._update(!0)):this}getLayoutProperty(g,o){return this._isValidId(g)?this.style.getLayoutProperty(g,o):null}setLayerProperty(g,o,h,_={}){return this._isValidId(g)?(this.style.setLayerProperty(g,o,h,_),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,o){return this.style.setSchema(g,o),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,o){return this.style.setConfig(g,o),this._update(!0)}getConfigProperty(g,o){return this.style.getConfigProperty(g,o)}setConfigProperty(g,o,h){return this.style.setConfigProperty(g,o,h),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const o=g[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,o),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aS.convert(g),this.transform):0}setFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,o),this._update())}removeFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,o),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_selectIndoorFloor(g){this.indoor.selectFloor(g)}_setIndoorActiveFloorsVisibility(g){this.indoor.setActiveFloorsVisibility(g)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Eb),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let h,_,v,S=this._container;for(;S&&(!_||!v);){const T=window.getComputedStyle(S).transform;T&&T!=="none"&&(h=T.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(_=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),S=S.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=v?Math.abs(o/v):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new jf(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=W("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=W("div","mapboxgl-canvas-container",g);this._canvas=W("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=W("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{_[v]=W("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,o){const h=a.o.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${o}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const o=this._markers.indexOf(g);o!==-1&&this._markers.splice(o,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const o=this._popups.indexOf(g);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const g=Object.assign({},V.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",g);o?(dr(o,!0),this.painter=new Ph(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.k.testSupport(o)):this.fire(new a.y(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.z("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new a.z("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let o;this.fire(new a.z("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,_=a.o.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,F=this.transform.pitch,H=a.o.now(),U=new a.ac(L,{now:H,fadeDuration:S,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(_),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(_);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,C.mark(E.load),this.fire(new a.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const L=a.o.now()-_;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const F=v.getQueryParameter(o,v.QUERY_RESULT)/1e6;v.deleteQuery(o),this.fire(new a.z("gpu-timing-frame",{cpuTime:L,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(L);this.fire(new a.z("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(L);this.fire(new a.z("gpu-timing-deferred-render",{gpuTime:F}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(A||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(T=this._updateAverageElevation(_,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new a.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new a.z("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,C.mark(E.fullLoad),this._performanceMetricsCollection&&Br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const o of this._markers)g&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!g||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(g,o=!1){const h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(o||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const v=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=g;const T=Math.abs(v-S);if(T>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(S),h(S);this._averageElevation.easeTo(S,g,300)}else if(T>1e-4)return this._averageElevation.jumpTo(S),h(S)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){Zn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===J||g.status===401)){const o=this.painter.context.gl;dr(o,!1),this._logoControl instanceof d_&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Xt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ft(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Wr(this._requestManager._customAccessToken)}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function v(S){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,S,0);const T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(v(g),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(g,o,h){let _=h[1]-h[0];const v=g.length/4;for(let S=0;S<o.length;S++){const T=o[S];let I=0;for(let A=0;A<T.length;A+=4)T[A]===g[A]&&T[A+1]===g[A+1]&&T[A+2]===g[A+2]&&T[A+3]===g[A+3]&&(I+=1);_+=(h[S+2]-h[S+1])*(1-I/v)}return _}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ln.delete(this.painter.context.gl),on.remove(),St.remove(),this._removed=!0,this.fire(new a.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=a.o.frame(o=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_preloadTiles(g){const o=this.style?this.style.getSourceCaches():[];return a.bv(o,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,o){a.f3(g,o)}get version(){return w}},NavigationControl:class{constructor(g={}){this.options=Object.assign({},Bx,g),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(a.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),W("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),W("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:o}):h.resetNorth({},{originalEvent:o}))}),this._compassIcon=W("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const o=g.getZoom(),h=o===g.getMaxZoom(),_=o===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new f_(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,o){const h=W("button",g,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(g,o){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${o}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends a.E{constructor(g={}){super();const o=navigator.geolocation;this.options=Object.assign({geolocation:o},xu,g),a.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Df(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const o=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>o(h.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(g){const o=this._map.getMaxBounds(),h=g.coords;return!!o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new a.z("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("geolocate",Object.assign({coords:g.coords,timestamp:g.timestamp},g.toJSON?{toJSON:g.toJSON.bind(g)}:{}))),this._finish()}}_updateCamera(g){const o=new a.aS(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),v=Object.assign({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),v,{geolocateSource:!0})}_updateMarker(g){if(g){const o=new a.aS(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,o=a.ce(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=W("button","mapboxgl-ctrl-geolocate",this._container),W("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W("div","mapboxgl-user-location"),this._dotElement.appendChild(W("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(W("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Nd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=W("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.z("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dm,ScaleControl:class{constructor(g={}){this.options=Object.assign({},cP,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,o=this._map,h=o._containerHeight/2,_=o._containerWidth/2-g/2,v=o.unproject([_,h]),S=o.unproject([_+g,h]),T=v.distanceTo(S);if(this.options.unit==="imperial"){const I=3.2808*T;I>5280?this._setScale(g,I/5280,"mile"):this._setScale(g,I,"foot")}else this.options.unit==="nautical"?this._setScale(g,T/1852,"nautical-mile"):T>=1e3?this._setScale(g,T/1e3,"kilometer"):this._setScale(g,T,"meter")}_setScale(g,o,h){this._map._requestDomTask(()=>{const _=function(S){const T=Math.pow(10,`${Math.floor(S)}`.length-1);let I=S/T;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(A){const L=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*L)/L}(I),T*I}(o),v=_/o;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(_):`${_}&nbsp;${uP[h]}`,this._container.style.width=g*v+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.w("Full screen control 'container' must be a DOM element.")),a.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=W("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Eb,Popup:class extends a.E{constructor(g){super(),this.options=Object.assign(Object.create(dP),g),this._altitude=this.options.altitude,a.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new a.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new a.z("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=a.aS.convert(g),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const o=document.createDocumentFragment(),h=document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=W("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(g),this.options.closeButton){const h=this._closeButton=W("button","mapboxgl-popup-close-button",o);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let o;return this._classList.delete(g)?o=!1:(this._classList.add(g),o=!0),this._updateClassList(),o}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const o=this._map,h=this._container,_=this._pos;if(!o||!h||!_)return"bottom";const v=h.offsetWidth,S=h.offsetHeight,T=_.x<v/2,I=_.x>o.transform.width-v/2;if(_.y+g<S)return T?"top-left":I?"top-right":"top";if(_.y>o.transform.height-S){if(T)return"bottom-left";if(I)return"bottom-right"}return T?"left":I?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),g.className=o.join(" ")}_update(g){const o=this._map,h=this._content;if(!o||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=W("div","mapboxgl-popup",o.getContainer()),this._tip=W("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=jd(this._lngLat,this._pos,o.transform)),!this._trackPointer||g){const v=this._pos=this._trackPointer&&g instanceof a.P?g:o.project(this._lngLat,this._altitude),S=Nb(this.options.offset),T=this._anchor=this._getAnchor(S.y),I=Nb(this.options.offset,T),A=v.add(I).round();o._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${yu[T]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&o._showingGlobe()){const v=a.f4(o.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(hP);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Nd,Style:Fc,LngLat:a.aS,LngLatBounds:a.aI,Point:a.P,MercatorCoordinate:a.ae,FreeCameraOptions:Gu,Evented:a.E,config:a.e,prewarm:a.f8,clearPrewarmedResources:a.f7,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(g){a.e.ACCESS_TOKEN=g},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(g){a.e.API_URL=g},get workerCount(){return a.fh.workerCount},set workerCount(g){a.fh.workerCount=g},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){a.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){a.fg(g)},get workerUrl(){return a.ff.workerUrl},set workerUrl(g){a.ff.workerUrl=g},get workerClass(){return a.ff.workerClass},set workerClass(g){a.ff.workerClass=g},get workerParams(){return a.ff.workerParams},set workerParams(g){a.ff.workerParams=g},get dracoUrl(){return a.fe()},set dracoUrl(g){a.fd(g)},get meshoptUrl(){return a.fc()},set meshoptUrl(g){a.fb(g)},setNow:a.o.setNow,restoreNow:a.o.restoreNow}});var p=c;return p})})(NJ);var gIe=NJ.exports;const Sl=W0(gIe),_Ie=`
  .mapboxgl-ctrl-bottom-left {
    opacity: 0.4 !important;
    transition: opacity 0.2s ease !important;
  }
  
  .mapboxgl-ctrl-bottom-left:hover {
    opacity: 0.8 !important;
  }
  
  .mapboxgl-ctrl-logo {
    width: 65px !important;
    height: 20px !important;
    margin: 0 0 4px 4px !important;
  }
  
  .mapboxgl-ctrl-attrib,
  .mapboxgl-ctrl-attrib-button,
  .mapboxgl-ctrl-attrib.mapboxgl-compact,
  .mapboxgl-ctrl-attrib.mapboxgl-compact-show,
  .mapboxgl-ctrl-attrib-inner,
  .mapboxgl-ctrl.mapboxgl-ctrl-attrib,
  .mapboxgl-ctrl-bottom-right,
  .mapboxgl-ctrl-bottom-right .mapboxgl-ctrl-attrib {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
  }
  
  .mapboxgl-ctrl-bottom-left a.mapboxgl-ctrl-logo {
    display: block !important;
    visibility: visible !important;
    opacity: 0.4 !important;
  }
`;Sl.accessToken="pk.eyJ1IjoibWJhcnJ5MjIiLCJhIjoiY21oM3FyZXZsMTZodTJqcXk0dTRybWVkMSJ9.A1RGamevhBLlCZFhz-EFqQ";const yIe=({latitude:t,longitude:e,address:r,title:n="Point de rencontre"})=>{const c=z.useRef(null),d=z.useRef(null),p="route",a="route-source",{resolvedTheme:w}=lC(),[E,C]=z.useState(null),[P,R]=z.useState(!1),[B,V]=z.useState(!1),[W,K]=z.useState(!1),[Z,$]=z.useState(null);if(!(t&&e&&!isNaN(t)&&!isNaN(e)&&t!==0&&e!==0))return i.jsx(Tt,{children:i.jsx(jt,{className:"p-6",children:i.jsxs("div",{className:"text-center text-muted-foreground",children:[i.jsx(dl,{className:"w-8 h-8 mx-auto mb-2"}),i.jsx("p",{children:"Aucune localisation GPS disponible pour cette annonce"}),i.jsx("p",{className:"text-sm mt-1",children:"Le vendeur n'a pas spécifié de point de rencontre précis"})]})})});z.useEffect(()=>{navigator.geolocation&&(R(!0),navigator.geolocation.getCurrentPosition(ve=>{const pe=[ve.coords.longitude,ve.coords.latitude];C(pe),R(!1)},ve=>{console.error("Erreur de géolocalisation:",ve),R(!1)}))},[]),z.useEffect(()=>{if(!c.current||d.current)return;const ve=w==="dark";d.current=new Sl.Map({container:c.current,style:ve?"mapbox://styles/mapbox/dark-v11":"mapbox://styles/mapbox/light-v11",center:[e,t],zoom:14,attributionControl:!1,logoPosition:"bottom-left"}),d.current.addControl(new Sl.NavigationControl,"top-right"),d.current.addControl(new Sl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),"top-right");const pe=document.createElement("div");return pe.style.width="40px",pe.style.height="40px",pe.style.backgroundImage="url(https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png)",pe.style.backgroundSize="cover",new Sl.Marker({element:pe,anchor:"bottom"}).setLngLat([e,t]).setPopup(new Sl.Popup({offset:25}).setHTML(`
            <div style="padding: 8px;">
              <h3 style="font-weight: bold; margin-bottom: 4px; color: #1a202c;">${n}</h3>
              <p style="font-size: 14px; color: #4a5568; margin: 0;">${r}</p>
            </div>
          `)).addTo(d.current),()=>{d.current&&(d.current.remove(),d.current=null)}},[t,e,r,n,w]),z.useEffect(()=>{const ve=d.current;if(!ve)return;const ue=w==="dark"?"mapbox://styles/mapbox/dark-v11":"mapbox://styles/mapbox/light-v11";if(ve.isStyleLoaded())ve.setStyle(ue);else{const ge=()=>{ve.setStyle(ue)};ve.once("load",ge)}},[w]);const Q=async()=>{var ve,pe,ue,ge;if(E){V(!0);try{const Se=await(await fetch(`https://api.mapbox.com/directions/v5/mapbox/walking/${E[0]},${E[1]};${e},${t}?geometries=geojson&access_token=${Sl.accessToken}&language=fr`)).json();if(Se.routes&&Se.routes.length>0){const le=Se.routes[0],J=le.geometry;(ve=d.current)!=null&&ve.getSource(a)?d.current.getSource(a).setData(J):((pe=d.current)==null||pe.addSource(a,{type:"geojson",data:J}),(ue=d.current)==null||ue.addLayer({id:p,type:"line",source:a,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":5,"line-opacity":.75}}));const ke=J.coordinates,Ze=ke.reduce((Xe,qe)=>Xe.extend(qe),new Sl.LngLatBounds(ke[0],ke[0]));(ge=d.current)==null||ge.fitBounds(Ze,{padding:80,duration:1e3}),$({distance:le.distance,duration:le.duration}),K(!0)}else console.warn("Aucun itinéraire trouvé."),$(null),K(!1)}catch(ce){console.error("Erreur lors du calcul de l'itinéraire:",ce),$(null),K(!1)}finally{V(!1)}}},re=()=>{var ve,pe;(ve=d.current)!=null&&ve.getLayer(p)&&d.current.removeLayer(p),(pe=d.current)!=null&&pe.getSource(a)&&d.current.removeSource(a),K(!1),$(null),d.current&&d.current.flyTo({center:[e,t],zoom:14,duration:1e3})};return i.jsxs("div",{className:"space-y-4",children:[i.jsx("style",{children:_Ie}),i.jsx(Tt,{children:i.jsx(jt,{className:"p-0",children:i.jsxs("div",{className:"relative",children:[i.jsx("div",{ref:c,className:"w-full h-[400px] rounded-lg overflow-hidden"}),E&&i.jsx("div",{className:"absolute bottom-4 left-4 right-4 flex flex-col gap-2",children:W?i.jsx(Tt,{className:"bg-background/95 backdrop-blur border-primary/20 shadow-lg",children:i.jsx(jt,{className:"p-3",children:i.jsxs("div",{className:"flex items-center justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(aI,{className:"w-5 h-5 text-primary"}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold text-foreground",children:"Itinéraire calculé"}),Z&&i.jsx("p",{className:"text-sm text-muted-foreground",children:`${(Z.distance/1e3).toFixed(2)} km - ${Math.ceil(Z.duration/60)} min à pied`})]})]}),i.jsx(Ge,{type:"button",variant:"ghost",size:"icon",onClick:re,className:"h-8 w-8 flex-shrink-0",title:"Masquer l'itinéraire",children:i.jsx(of,{className:"w-4 h-4"})})]})})}):i.jsx(Ge,{type:"button",onClick:Q,disabled:B||P,className:"w-full shadow-lg",children:B?i.jsxs(i.Fragment,{children:[i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}),"Calcul de l'itinéraire..."]}):i.jsxs(i.Fragment,{children:[i.jsx(aI,{className:"w-4 h-4 mr-2"}),"Afficher l'itinéraire piéton"]})})}),!E&&!P&&i.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:i.jsx(Tt,{className:"bg-background/95 backdrop-blur border-border shadow-lg",children:i.jsx(jt,{className:"p-3",children:i.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[i.jsx(dl,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),i.jsx("p",{children:"Activez la géolocalisation pour calculer l'itinéraire vers ce point de rencontre"})]})})})})]})})})]})},xIe=({amount:t,currency:e,onPaymentSuccess:r,onPaymentError:n})=>{const c=JNe(),d=WNe(),[p,a]=z.useState(!1),[w,E]=z.useState(null),[C,P]=z.useState(!1),R=async V=>{if(V.preventDefault(),!(!c||!d)){a(!0),E(null);try{const{error:W}=await d.submit();if(W){E(W.message||"Une erreur est survenue"),n(W.message||"Erreur de validation");return}const{error:K,paymentIntent:Z}=await c.confirmPayment({elements:d,confirmParams:{return_url:`${window.location.origin}/StudyMarket/payment/success`},redirect:"if_required"});K?(E(K.message||"Le paiement a échoué"),n(K.message||"Erreur de paiement"),Nt.error("Paiement échoué")):(P(!0),r((Z==null?void 0:Z.id)||""),Nt.success("Paiement effectué avec succès !"))}catch(W){const K=W.message||"Une erreur inattendue est survenue";E(K),n(K),Nt.error(K)}finally{a(!1)}}},B=(V,W)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:W.toUpperCase()}).format(V);return C?i.jsx(Tt,{children:i.jsxs(jt,{className:"p-6 text-center",children:[i.jsx(qs,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),i.jsx("h3",{className:"text-xl font-semibold text-green-700 mb-2",children:"Paiement réussi !"}),i.jsxs("p",{className:"text-muted-foreground",children:["Votre paiement de ",B(t,e)," a été traité avec succès."]})]})}):i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Aa,{className:"w-5 h-5"}),"Paiement sécurisé"]}),i.jsxs(Ls,{children:["Montant : ",B(t,e)]})]}),i.jsxs(jt,{children:[i.jsxs("form",{onSubmit:R,className:"space-y-6",children:[i.jsx("div",{className:"space-y-4",children:i.jsx(QNe,{options:{layout:"tabs"}})}),w&&i.jsxs(Ys,{variant:"destructive",children:[i.jsx(va,{className:"h-4 w-4"}),i.jsx(Js,{children:w})]}),i.jsx(Ge,{type:"submit",disabled:!c||!d||p,className:"w-full",size:"lg",children:p?i.jsxs(i.Fragment,{children:[i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}),"Traitement en cours..."]}):i.jsxs(i.Fragment,{children:[i.jsx(xy,{className:"w-4 h-4 mr-2"}),"Payer ",B(t,e)]})})]}),i.jsx("div",{className:"mt-4 text-center",children:i.jsxs("p",{className:"text-xs text-muted-foreground flex items-center justify-center gap-1",children:[i.jsx(xy,{className:"w-3 h-3"}),"Paiement sécurisé par Stripe"]})})]})]})},CJ=({orderId:t,method:e,onPaymentSuccess:r,onPaymentError:n,enabled:c=!0})=>{const[d,p]=z.useState(null),[a,w]=z.useState(null),[E,C]=z.useState(!0);if(z.useEffect(()=>{(async()=>{if(c){if(e!=="stripe"){n(`Méthode ${e} pas encore implémentée`),C(!1);return}try{const W=await fetch("http://localhost:3001/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:t})}),K=await W.json().catch(()=>({}));if(W.ok){const{client_secret:Z,breakdown:$}=K;p(Z),$&&w($)}else throw console.error("❌ Create PI server error:",K),new Error(K.error||"Erreur lors de la création du PaymentIntent")}catch(V){console.error("❌ Erreur lors de la création du PaymentIntent:",V),n(V.message||"Erreur lors de l'initialisation du paiement")}finally{C(!1)}}})()},[t,e,n,c]),E)return i.jsxs("div",{className:"flex items-center justify-center p-8",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),i.jsx("span",{className:"ml-2",children:"Initialisation du paiement..."})]});if(!d)return i.jsx("div",{className:"p-4 text-center text-red-600",children:c?"Erreur lors de l'initialisation du paiement":"Acceptez les conditions pour continuer"});const P=a?a.totalCents/100:0,R=(a==null?void 0:a.currency)||"eur";return i.jsxs("div",{className:"space-y-4",children:[a&&i.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Sous-total"}),i.jsxs("span",{className:"font-medium",children:[(a.subtotalCents/100).toFixed(2)," ",R.toUpperCase()]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Frais de service (5%)"}),i.jsxs("span",{className:"font-medium",children:[(a.serviceFeeCents/100).toFixed(2)," ",R.toUpperCase()]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Frais de traitement"}),i.jsxs("span",{className:"font-medium",children:[(a.processingFeeCents/100).toFixed(2)," ",R.toUpperCase()]})]}),i.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border",children:[i.jsx("span",{className:"font-semibold",children:"Total"}),i.jsxs("span",{className:"text-lg font-bold text-primary",children:[P.toFixed(2)," ",R.toUpperCase()]})]})]}),i.jsx(jJ,{clientSecret:d,amount:P,currency:R,children:i.jsx(xIe,{amount:P,currency:R,onPaymentSuccess:r,onPaymentError:n})})]})},d$=[{id:"stripe",name:"Carte Bancaire",description:"Paiement sécurisé par carte (Visa, Mastercard, etc.)",icon:Aa,enabled:!0},{id:"paypal",name:"PayPal",description:"Payez avec votre compte PayPal",icon:Aa,enabled:!1,comingSoon:!0},{id:"lydia",name:"Lydia",description:"Paiement instantané entre étudiants",icon:Ag,enabled:!1,comingSoon:!0},{id:"cash",name:"Espèces",description:"Paiement en main propre lors du rendez-vous",icon:z3,enabled:!1,comingSoon:!0}],vIe=({onSelect:t,onCancel:e})=>{const[r,n]=z.useState(null),c=p=>{var a;(a=d$.find(w=>w.id===p))!=null&&a.enabled&&n(p)},d=()=>{r&&t(r)};return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Choisissez votre mode de paiement"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Sélectionnez la méthode qui vous convient le mieux"})]}),i.jsx("div",{className:"grid gap-3",children:d$.map(p=>{const a=p.icon,w=r===p.id,E=!p.enabled;return i.jsx("button",{onClick:()=>c(p.id),disabled:E,className:kn("relative p-4 rounded-lg border-2 transition-all text-left","hover:border-primary/50 focus:outline-none focus:ring-2 focus:ring-primary",w&&"border-primary bg-primary/5",!w&&!E&&"border-border hover:bg-accent",E&&"opacity-50 cursor-not-allowed"),children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:kn("p-3 rounded-full",w?"bg-primary text-white":"bg-muted"),children:i.jsx(a,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h4",{className:"font-semibold",children:p.name}),p.comingSoon&&i.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full",children:"Bientôt"})]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p.description})]}),w&&i.jsx(qs,{className:"w-6 h-6 text-primary flex-shrink-0"})]})},p.id)})}),i.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[i.jsx(Ge,{variant:"outline",onClick:e,className:"flex-1",children:"Annuler"}),i.jsx(Ge,{onClick:d,disabled:!r,className:"flex-1",children:"Continuer"})]})]})},wIe=({listing:t,className:e})=>{const[r,n]=z.useState(!1),[c,d]=z.useState(!1),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState("stripe"),{currentUser:R}=$i(),B=Ra(),V=()=>R?t.sellerId&&R.uid===t.sellerId?(Nt.error("Vous ne pouvez pas acheter votre propre annonce"),!1):t.status&&t.status!=="active"?(t.status==="sold"?Nt.error("Cet article a déjà été vendu"):Nt.error("Annonce indisponible"),!1):!t.price||t.price<=0?(Nt.error("Montant invalide"),!1):!0:(Nt("Connectez-vous pour continuer"),B("/auth"),!1),W=async()=>{if(V()){d(!0);try{const re=await fetch("http://localhost:3001/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({listingId:t.id,buyerId:R==null?void 0:R.uid,sellerId:t.sellerId})}),ve=await re.json();if(!re.ok)throw new Error(ve.error||"Erreur lors de la création de la commande");console.log("✅ Commande créée:",ve.orderId),a(ve.orderId),E(!0)}catch(Q){console.error("❌ Erreur création commande:",Q),Nt.error(Q.message||"Erreur lors de la création de la commande")}finally{d(!1)}}},K=Q=>{P(Q),E(!1),n(!0)},Z=()=>{E(!1),a(null)},$=Q=>{console.log("✅ Paiement réussi:",Q),n(!1),p&&B(`/payment/success?orderId=${p}&payment_intent=${Q}`)},X=Q=>{console.error("❌ Erreur de paiement:",Q),Nt.error(Q||"Erreur lors du paiement")};return t.transactionType==="donation"||t.transactionType==="exchange"?null:i.jsxs(i.Fragment,{children:[i.jsx(Ge,{className:e,disabled:c,onClick:W,children:c?i.jsxs(i.Fragment,{children:[i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}),"Création..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Aa,{className:"w-4 h-4 mr-2"}),"Acheter maintenant"]})}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsx(Ki,{className:"max-w-md",children:i.jsx(vIe,{onSelect:K,onCancel:Z})})}),i.jsx(ta,{open:r,onOpenChange:n,children:i.jsxs(Ki,{className:"max-w-md",children:[i.jsxs(oa,{children:[i.jsxs(ra,{children:["Paiement - ",t.title]}),i.jsx(go,{children:"Finalisez votre achat de manière sécurisée"})]}),p&&i.jsx(CJ,{orderId:p,method:C,onPaymentSuccess:$,onPaymentError:X})]})})]})},bIe=()=>{var $;const{id:t}=yE(),e=Ra(),{currentUser:r}=$i(),{currentListing:n,loading:c,fetchListingById:d}=mw(),{fetchUserFavorites:p}=xX(),[a,w]=z.useState(0);if(z.useEffect(()=>{t&&d(t)},[t,d]),z.useEffect(()=>{r&&p(r.uid)},[r,p]),c)return i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"animate-pulse space-y-6",children:[i.jsx("div",{className:"h-8 bg-muted rounded w-1/4"}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsx("div",{className:"aspect-square bg-muted rounded-lg"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"h-8 bg-muted rounded w-3/4"}),i.jsx("div",{className:"h-6 bg-muted rounded w-1/2"}),i.jsx("div",{className:"h-20 bg-muted rounded"})]})]})]})});if(!n)return i.jsx("div",{className:"container mx-auto px-4 py-8 text-center",children:i.jsxs("div",{className:"max-w-md mx-auto",children:[i.jsx(va,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),i.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Annonce introuvable"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Cette annonce n'existe pas ou a été supprimée."}),i.jsx(Ge,{onClick:()=>e("/listings"),children:"Retour aux annonces"})]})});const E=n,C=(r==null?void 0:r.uid)===E.sellerId,P=(X,Q)=>{if(E.transactionType==="donation")return"Gratuit";if(E.transactionType==="exchange")return"Échange";const re=Q||"EUR";try{return new Intl.NumberFormat("fr-FR",{style:"currency",currency:re}).format(X)}catch{return`${X} €`}},R=X=>{switch(X){case"new":return"Neuf";case"like-new":return"Comme neuf";case"good":return"Bon état";case"fair":return"État correct";case"poor":return"Mauvais état";default:return X}},B=X=>{switch(X){case"new":return"bg-green-100 text-green-800 border-green-200";case"like-new":return"bg-blue-100 text-blue-800 border-blue-200";case"good":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"fair":return"bg-blue-100 text-blue-800 border-blue-200";case"poor":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},V=()=>{switch(E.transactionType){case"donation":return i.jsx(P0,{className:"w-4 h-4"});case"exchange":return i.jsx(Yo,{className:"w-4 h-4"});case"service":return i.jsx(cw,{className:"w-4 h-4"});default:return i.jsx(_y,{className:"w-4 h-4"})}},W=()=>{switch(E.transactionType){case"donation":return"Don gratuit";case"exchange":return"Troc";case"service":return"Service";default:return"Vente"}},K=()=>{E.images&&E.images.length>1&&w(X=>X===E.images.length-1?0:X+1)},Z=()=>{E.images&&E.images.length>1&&w(X=>X===0?E.images.length-1:X-1)};return i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx("div",{className:"border-b border-border bg-muted/30",children:i.jsx("div",{className:"container mx-auto px-4 py-4",children:i.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[i.jsx(Nr,{to:"/",className:"hover:text-foreground transition-colors",children:"Accueil"}),i.jsx("span",{children:"/"}),i.jsx(Nr,{to:"/listings",className:"hover:text-foreground transition-colors",children:"Annonces"}),i.jsx("span",{children:"/"}),i.jsx("span",{className:"text-foreground",children:E.title})]})})}),i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsxs(Ge,{variant:"ghost",onClick:()=>e(-1),className:"mb-6 -ml-4",children:[i.jsx(vp,{className:"w-4 h-4 mr-2"}),"Retour"]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[i.jsx("div",{className:"lg:col-span-2",children:i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"relative aspect-[4/3] rounded-lg overflow-hidden bg-muted",children:E.images&&E.images.length>0?i.jsxs(i.Fragment,{children:[i.jsx("img",{src:E.images[a],alt:E.title,className:"w-full h-full object-cover"}),E.images.length>1&&i.jsxs(i.Fragment,{children:[i.jsx("div",{onClick:Z,className:"absolute left-4 top-1/2 transform -translate-y-1/2 cursor-pointer text-white hover:text-primary transition-colors bg-black/50 rounded-full p-2","aria-label":"Image précédente",children:i.jsx(Cxe,{className:"w-6 h-6"})}),i.jsx("div",{onClick:K,className:"absolute right-4 top-1/2 transform -translate-y-1/2 cursor-pointer text-white hover:text-primary transition-colors bg-black/50 rounded-full p-2","aria-label":"Image suivante",children:i.jsx(Zh,{className:"w-6 h-6"})}),i.jsxs("div",{className:"absolute bottom-4 right-4 bg-black/70 text-white px-3 py-1 rounded-full text-sm",children:[a+1," / ",E.images.length]})]}),i.jsxs(ta,{children:[i.jsx(l0,{asChild:!0,children:i.jsx("div",{className:"absolute top-4 right-4 cursor-pointer text-white hover:text-primary transition-colors bg-black/50 rounded-full p-2","aria-label":"Agrandir l'image",children:i.jsx(H_,{className:"w-5 h-5"})})}),i.jsxs(Ki,{className:"max-w-4xl",children:[i.jsx(ra,{children:"Image en plein écran de l'annonce"}),i.jsx("img",{src:E.images[a],alt:E.title,className:"w-full h-auto max-h-[80vh] object-contain"})]})]})]}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsxs("div",{className:"text-center text-muted-foreground",children:[i.jsx(H_,{className:"w-16 h-16 mx-auto mb-4"}),i.jsx("p",{children:"Aucune image disponible"})]})})}),E.images&&E.images.length>1&&i.jsx("div",{className:"grid grid-cols-6 gap-2",children:E.images.map((X,Q)=>i.jsx("button",{onClick:()=>w(Q),className:`aspect-square rounded-lg overflow-hidden border-2 transition-all ${Q===a?"border-primary":"border-transparent hover:border-muted-foreground"}`,children:i.jsx("img",{src:X,alt:`${E.title} ${Q+1}`,className:"w-full h-full object-cover"})},Q))})]})}),i.jsxs("div",{className:"space-y-6",children:[i.jsx(Tt,{children:i.jsx(jt,{className:"p-6",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(Ir,{className:"bg-primary/10 text-primary border-primary/20",children:[V(),i.jsx("span",{className:"ml-1",children:W()})]}),E.sellerVerificationStatus?i.jsx(D0,{status:E.sellerVerificationStatus,size:"sm",showText:!1}):E.sellerVerified&&i.jsxs(Ir,{className:"bg-green-100 text-green-800 border-green-200",children:[i.jsx(Ms,{className:"w-3 h-3 mr-1"}),"Vérifié"]})]}),i.jsxs("div",{className:"text-3xl font-bold text-primary",children:[P(E.price,E.currency),E.transactionType==="service"&&i.jsx("span",{className:"text-lg text-muted-foreground",children:"/h"})]}),E.transactionType==="exchange"&&E.exchangeFor&&i.jsxs("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 text-purple-800",children:[i.jsx(Yo,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:"Recherche en échange :"})]}),i.jsx("p",{className:"text-purple-700 mt-1",children:E.exchangeFor})]}),E.aiPriceEstimate&&E.transactionType==="sale"&&i.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[i.jsx(bp,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:"Prix estimé par IA :"})]}),i.jsxs("p",{className:"text-green-700 text-sm",children:[E.aiPriceEstimate.min,"€ - ",E.aiPriceEstimate.max,"€",i.jsxs("span",{className:"ml-2 text-xs",children:["(Confiance: ",Math.round(E.aiPriceEstimate.confidence*100),"%)"]})]})]}),i.jsx("div",{className:"space-y-3",children:C?i.jsxs("div",{className:"space-y-2",children:[i.jsx(Nr,{to:`/edit-listing/${E.id}`,children:i.jsxs(Ge,{variant:"outline",className:"w-full",children:[i.jsx(Hl,{className:"w-4 h-4 mr-2"}),"Modifier l'annonce"]})}),i.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"C'est votre annonce"})]}):i.jsxs(i.Fragment,{children:[i.jsx(mIe,{listing:E,className:"w-full"}),i.jsx(wIe,{listing:E,className:"w-full"}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(vX,{listing:E,size:"lg",showText:!1}),i.jsx(wX,{listing:E,size:"lg",showText:!1})]}),i.jsx("div",{className:"cursor-pointer text-muted-foreground hover:text-destructive transition-colors","aria-label":"Signaler",children:i.jsx(V_,{className:"w-5 h-5"})})]})]})})]})})}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{className:"text-lg",children:"Vendeur"})}),i.jsx(jt,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs(Jc,{className:"w-12 h-12",children:[i.jsx(cf,{src:E.sellerAvatar||void 0}),i.jsx(Sc,{children:($=E.sellerName[0])==null?void 0:$.toUpperCase()})]}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h3",{className:"font-semibold",children:E.sellerName}),E.sellerVerificationStatus?i.jsx(D0,{status:E.sellerVerificationStatus,size:"sm",showText:!1}):E.sellerVerified&&i.jsx(Ms,{className:"w-4 h-4 text-green-600"})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:E.sellerUniversity})]})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-lg font-semibold",children:"4.8"}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"Note"})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-lg font-semibold",children:"23"}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"Ventes"})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-lg font-semibold",children:"98%"}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"Confiance"})]})]})]})})]}),E.environmentalImpact&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"text-lg flex items-center gap-2",children:[i.jsx(Jd,{className:"w-5 h-5 text-green-600"}),"Impact écologique"]})}),i.jsx(jt,{children:i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"text-2xl font-bold text-green-600 mb-1",children:["-",E.environmentalImpact.co2Saved," kg CO₂"]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"économisés en achetant d'occasion"})]})})]})]})]}),i.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h1",{className:"text-2xl font-bold mb-2",children:E.title}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Fo,{className:"w-4 h-4"}),i.jsxs("span",{children:[E.views," vues"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Fi,{className:"w-4 h-4"}),i.jsx("span",{children:_w(E.createdAt,{addSuffix:!0,locale:po})})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(dl,{className:"w-4 h-4"}),i.jsx("span",{children:E.location.city})]})]})]}),i.jsx(Ir,{className:B(E.condition),children:R(E.condition)})]})}),i.jsx(jt,{children:i.jsx("div",{className:"prose prose-sm max-w-none",children:i.jsx("p",{className:"whitespace-pre-wrap",children:E.description})})})]}),E.tags&&E.tags.length>0&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{className:"text-lg",children:"Tags"})}),i.jsx(jt,{children:i.jsx("div",{className:"flex flex-wrap gap-2",children:E.tags.map((X,Q)=>i.jsx(Ir,{variant:"secondary",children:X},Q))})})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"text-lg flex items-center gap-2",children:[i.jsx(dl,{className:"w-5 h-5"}),"Localisation"]})}),i.jsxs(jt,{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:E.location.city}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[E.location.state,", ",E.location.country]})]}),E.location.campus&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-medium",children:"Campus"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:E.location.campus})]}),E.location.university&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-medium",children:"Université"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:E.location.university})]})]})]}),E.location.coordinates&&!isNaN(E.location.coordinates.lat)&&!isNaN(E.location.coordinates.lng)&&E.location.coordinates.lat!==0&&E.location.coordinates.lng!==0?i.jsx("div",{children:i.jsx(yIe,{latitude:E.location.coordinates.lat,longitude:E.location.coordinates.lng,address:`${E.location.city}, ${E.location.state}`,title:"Point de rencontre"})}):i.jsx(Tt,{children:i.jsx(jt,{className:"p-6",children:i.jsxs("div",{className:"text-center text-muted-foreground",children:[i.jsx(dl,{className:"w-8 h-8 mx-auto mb-2"}),i.jsx("p",{children:"Aucune localisation GPS disponible pour cette annonce"}),i.jsx("p",{className:"text-sm mt-1",children:"Le vendeur n'a pas spécifié de point de rencontre précis"})]})})}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"text-lg flex items-center gap-2",children:[i.jsx(Ms,{className:"w-5 h-5"}),"Conseils de sécurité"]})}),i.jsx(jt,{children:i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(qs,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Rencontrez-vous dans un lieu public"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(qs,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Vérifiez l'identité de l'autre personne"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(qs,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Testez l'objet avant la transaction"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(yy,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),i.jsx("span",{children:"Utilisez la messagerie StudyMarket"})]})]})})]})]})]})]})]})};var JE=t=>t.type==="checkbox",Gv=t=>t instanceof Date,bc=t=>t==null;const AJ=t=>typeof t=="object";var zo=t=>!bc(t)&&!Array.isArray(t)&&AJ(t)&&!Gv(t),SIe=t=>zo(t)&&t.target?JE(t.target)?t.target.checked:t.target.value:t,EIe=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,TIe=(t,e)=>t.has(EIe(e)),jIe=t=>{const e=t.constructor&&t.constructor.prototype;return zo(e)&&e.hasOwnProperty("isPrototypeOf")},R4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Yu(t){let e;const r=Array.isArray(t);if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set(t);else if(!(R4&&(t instanceof Blob||t instanceof FileList))&&(r||zo(t)))if(e=r?[]:{},!r&&!jIe(t))e=t;else for(const n in t)t.hasOwnProperty(n)&&(e[n]=Yu(t[n]));else return t;return e}var fA=t=>Array.isArray(t)?t.filter(Boolean):[],vo=t=>t===void 0,bn=(t,e,r)=>{if(!e||!zo(t))return r;const n=fA(e.split(/[,[\].]+?/)).reduce((c,d)=>bc(c)?c:c[d],t);return vo(n)||n===t?vo(t[e])?r:t[e]:n},Uh=t=>typeof t=="boolean",M4=t=>/^\w*$/.test(t),PJ=t=>fA(t.replace(/["|']|\]/g,"").split(/\.|\[/)),ia=(t,e,r)=>{let n=-1;const c=M4(e)?[e]:PJ(e),d=c.length,p=d-1;for(;++n<d;){const a=c[n];let w=r;if(n!==p){const E=t[a];w=zo(E)||Array.isArray(E)?E:isNaN(+c[n+1])?{}:[]}if(a==="__proto__")return;t[a]=w,t=t[a]}return t};const h$={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Gd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Hf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};_n.createContext(null);var NIe=(t,e,r,n=!0)=>{const c={defaultValues:e._defaultValues};for(const d in t)Object.defineProperty(c,d,{get:()=>{const p=d;return e._proxyFormState[p]!==Gd.all&&(e._proxyFormState[p]=!n||Gd.all),t[p]}});return c},Gc=t=>zo(t)&&!Object.keys(t).length,IIe=(t,e,r,n)=>{r(t);const{name:c,...d}=t;return Gc(d)||Object.keys(d).length>=Object.keys(e).length||Object.keys(d).find(p=>e[p]===Gd.all)},oN=t=>Array.isArray(t)?t:[t];function CIe(t){const e=_n.useRef(t);e.current=t,_n.useEffect(()=>{const r=!t.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{r&&r.unsubscribe()}},[t.disabled])}var Xh=t=>typeof t=="string",AIe=(t,e,r,n,c)=>Xh(t)?(n&&e.watch.add(t),bn(r,t,c)):Array.isArray(t)?t.map(d=>(n&&e.watch.add(d),bn(r,d))):(n&&(e.watchAll=!0),r),kJ=(t,e,r,n,c)=>e?{...r[t],types:{...r[t]&&r[t].types?r[t].types:{},[n]:c||!0}}:{},f$=t=>({isOnSubmit:!t||t===Gd.onSubmit,isOnBlur:t===Gd.onBlur,isOnChange:t===Gd.onChange,isOnAll:t===Gd.all,isOnTouch:t===Gd.onTouched}),p$=(t,e,r)=>!r&&(e.watchAll||e.watch.has(t)||[...e.watch].some(n=>t.startsWith(n)&&/^\.\w+/.test(t.slice(n.length))));const uS=(t,e,r,n)=>{for(const c of r||Object.keys(t)){const d=bn(t,c);if(d){const{_f:p,...a}=d;if(p){if(p.refs&&p.refs[0]&&e(p.refs[0],c)&&!n)return!0;if(p.ref&&e(p.ref,p.name)&&!n)return!0;if(uS(a,e))break}else if(zo(a)&&uS(a,e))break}}};var PIe=(t,e,r)=>{const n=oN(bn(t,r));return ia(n,"root",e[r]),ia(t,r,n),t},D4=t=>t.type==="file",ip=t=>typeof t=="function",wI=t=>{if(!R4)return!1;const e=t?t.ownerDocument:0;return t instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},lN=t=>Xh(t),O4=t=>t.type==="radio",bI=t=>t instanceof RegExp;const m$={value:!1,isValid:!1},g$={value:!0,isValid:!0};var RJ=t=>{if(Array.isArray(t)){if(t.length>1){const e=t.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:e,isValid:!!e.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!vo(t[0].attributes.value)?vo(t[0].value)||t[0].value===""?g$:{value:t[0].value,isValid:!0}:g$:m$}return m$};const _$={isValid:!1,value:null};var MJ=t=>Array.isArray(t)?t.reduce((e,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:e,_$):_$;function y$(t,e,r="validate"){if(lN(t)||Array.isArray(t)&&t.every(lN)||Uh(t)&&!t)return{type:r,message:lN(t)?t:"",ref:e}}var _v=t=>zo(t)&&!bI(t)?t:{value:t,message:""},x$=async(t,e,r,n,c)=>{const{ref:d,refs:p,required:a,maxLength:w,minLength:E,min:C,max:P,pattern:R,validate:B,name:V,valueAsNumber:W,mount:K,disabled:Z}=t._f,$=bn(e,V);if(!K||Z)return{};const X=p?p[0]:d,Q=le=>{n&&X.reportValidity&&(X.setCustomValidity(Uh(le)?"":le||""),X.reportValidity())},re={},ve=O4(d),pe=JE(d),ue=ve||pe,ge=(W||D4(d))&&vo(d.value)&&vo($)||wI(d)&&d.value===""||$===""||Array.isArray($)&&!$.length,ce=kJ.bind(null,V,r,re),Se=(le,J,ke,Ze=Hf.maxLength,Xe=Hf.minLength)=>{const qe=le?J:ke;re[V]={type:le?Ze:Xe,message:qe,ref:d,...ce(le?Ze:Xe,qe)}};if(c?!Array.isArray($)||!$.length:a&&(!ue&&(ge||bc($))||Uh($)&&!$||pe&&!RJ(p).isValid||ve&&!MJ(p).isValid)){const{value:le,message:J}=lN(a)?{value:!!a,message:a}:_v(a);if(le&&(re[V]={type:Hf.required,message:J,ref:X,...ce(Hf.required,J)},!r))return Q(J),re}if(!ge&&(!bc(C)||!bc(P))){let le,J;const ke=_v(P),Ze=_v(C);if(!bc($)&&!isNaN($)){const Xe=d.valueAsNumber||$&&+$;bc(ke.value)||(le=Xe>ke.value),bc(Ze.value)||(J=Xe<Ze.value)}else{const Xe=d.valueAsDate||new Date($),qe=it=>new Date(new Date().toDateString()+" "+it),$e=d.type=="time",st=d.type=="week";Xh(ke.value)&&$&&(le=$e?qe($)>qe(ke.value):st?$>ke.value:Xe>new Date(ke.value)),Xh(Ze.value)&&$&&(J=$e?qe($)<qe(Ze.value):st?$<Ze.value:Xe<new Date(Ze.value))}if((le||J)&&(Se(!!le,ke.message,Ze.message,Hf.max,Hf.min),!r))return Q(re[V].message),re}if((w||E)&&!ge&&(Xh($)||c&&Array.isArray($))){const le=_v(w),J=_v(E),ke=!bc(le.value)&&$.length>+le.value,Ze=!bc(J.value)&&$.length<+J.value;if((ke||Ze)&&(Se(ke,le.message,J.message),!r))return Q(re[V].message),re}if(R&&!ge&&Xh($)){const{value:le,message:J}=_v(R);if(bI(le)&&!$.match(le)&&(re[V]={type:Hf.pattern,message:J,ref:d,...ce(Hf.pattern,J)},!r))return Q(J),re}if(B){if(ip(B)){const le=await B($,e),J=y$(le,X);if(J&&(re[V]={...J,...ce(Hf.validate,J.message)},!r))return Q(J.message),re}else if(zo(B)){let le={};for(const J in B){if(!Gc(le)&&!r)break;const ke=y$(await B[J]($,e),X,J);ke&&(le={...ke,...ce(J,ke.message)},Q(ke.message),r&&(re[V]=le))}if(!Gc(le)&&(re[V]={ref:X,...le},!r))return re}}return Q(!0),re};function kIe(t,e){const r=e.slice(0,-1).length;let n=0;for(;n<r;)t=vo(t)?n++:t[e[n++]];return t}function RIe(t){for(const e in t)if(t.hasOwnProperty(e)&&!vo(t[e]))return!1;return!0}function Wo(t,e){const r=Array.isArray(e)?e:M4(e)?[e]:PJ(e),n=r.length===1?t:kIe(t,r),c=r.length-1,d=r[c];return n&&delete n[d],c!==0&&(zo(n)&&Gc(n)||Array.isArray(n)&&RIe(n))&&Wo(t,r.slice(0,-1)),t}var GR=()=>{let t=[];return{get observers(){return t},next:c=>{for(const d of t)d.next&&d.next(c)},subscribe:c=>(t.push(c),{unsubscribe:()=>{t=t.filter(d=>d!==c)}}),unsubscribe:()=>{t=[]}}},SI=t=>bc(t)||!AJ(t);function Um(t,e){if(SI(t)||SI(e))return t===e;if(Gv(t)&&Gv(e))return t.getTime()===e.getTime();const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const c of r){const d=t[c];if(!n.includes(c))return!1;if(c!=="ref"){const p=e[c];if(Gv(d)&&Gv(p)||zo(d)&&zo(p)||Array.isArray(d)&&Array.isArray(p)?!Um(d,p):d!==p)return!1}}return!0}var DJ=t=>t.type==="select-multiple",MIe=t=>O4(t)||JE(t),HR=t=>wI(t)&&t.isConnected,OJ=t=>{for(const e in t)if(ip(t[e]))return!0;return!1};function EI(t,e={}){const r=Array.isArray(t);if(zo(t)||r)for(const n in t)Array.isArray(t[n])||zo(t[n])&&!OJ(t[n])?(e[n]=Array.isArray(t[n])?[]:{},EI(t[n],e[n])):bc(t[n])||(e[n]=!0);return e}function LJ(t,e,r){const n=Array.isArray(t);if(zo(t)||n)for(const c in t)Array.isArray(t[c])||zo(t[c])&&!OJ(t[c])?vo(e)||SI(r[c])?r[c]=Array.isArray(t[c])?EI(t[c],[]):{...EI(t[c])}:LJ(t[c],bc(e)?{}:e[c],r[c]):r[c]=!Um(t[c],e[c]);return r}var Tj=(t,e)=>LJ(t,e,EI(e)),FJ=(t,{valueAsNumber:e,valueAsDate:r,setValueAs:n})=>vo(t)?t:e?t===""?NaN:t&&+t:r&&Xh(t)?new Date(t):n?n(t):t;function WR(t){const e=t.ref;if(!(t.refs?t.refs.every(r=>r.disabled):e.disabled))return D4(e)?e.files:O4(e)?MJ(t.refs).value:DJ(e)?[...e.selectedOptions].map(({value:r})=>r):JE(e)?RJ(t.refs).value:FJ(vo(e.value)?t.ref.value:e.value,t)}var DIe=(t,e,r,n)=>{const c={};for(const d of t){const p=bn(e,d);p&&ia(c,d,p._f)}return{criteriaMode:r,names:[...t],fields:c,shouldUseNativeValidation:n}},C1=t=>vo(t)?t:bI(t)?t.source:zo(t)?bI(t.value)?t.value.source:t.value:t;const v$="AsyncFunction";var OIe=t=>(!t||!t.validate)&&!!(ip(t.validate)&&t.validate.constructor.name===v$||zo(t.validate)&&Object.values(t.validate).find(e=>e.constructor.name===v$)),LIe=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate);function w$(t,e,r){const n=bn(t,r);if(n||M4(r))return{error:n,name:r};const c=r.split(".");for(;c.length;){const d=c.join("."),p=bn(e,d),a=bn(t,d);if(p&&!Array.isArray(p)&&r!==d)return{name:r};if(a&&a.type)return{name:d,error:a};c.pop()}return{name:r}}var FIe=(t,e,r,n,c)=>c.isOnAll?!1:!r&&c.isOnTouch?!(e||t):(r?n.isOnBlur:c.isOnBlur)?!t:(r?n.isOnChange:c.isOnChange)?t:!0,zIe=(t,e)=>!fA(bn(t,e)).length&&Wo(t,e);const BIe={mode:Gd.onSubmit,reValidateMode:Gd.onChange,shouldFocusError:!0};function VIe(t={}){let e={...BIe,...t},r={submitCount:0,isDirty:!1,isLoading:ip(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},n={},c=zo(e.defaultValues)||zo(e.values)?Yu(e.defaultValues||e.values)||{}:{},d=e.shouldUnregister?{}:Yu(c),p={action:!1,mount:!1,watch:!1},a={mount:new Set,unMount:new Set,array:new Set,watch:new Set},w,E=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},P={values:GR(),array:GR(),state:GR()},R=f$(e.mode),B=f$(e.reValidateMode),V=e.criteriaMode===Gd.all,W=Je=>xt=>{clearTimeout(E),E=setTimeout(Je,xt)},K=async Je=>{if(C.isValid||Je){const xt=e.resolver?Gc((await ue()).errors):await ce(n,!0);xt!==r.isValid&&P.state.next({isValid:xt})}},Z=(Je,xt)=>{(C.isValidating||C.validatingFields)&&((Je||Array.from(a.mount)).forEach(Ft=>{Ft&&(xt?ia(r.validatingFields,Ft,xt):Wo(r.validatingFields,Ft))}),P.state.next({validatingFields:r.validatingFields,isValidating:!Gc(r.validatingFields)}))},$=(Je,xt=[],Ft,or,xr=!0,mr=!0)=>{if(or&&Ft){if(p.action=!0,mr&&Array.isArray(bn(n,Je))){const sn=Ft(bn(n,Je),or.argA,or.argB);xr&&ia(n,Je,sn)}if(mr&&Array.isArray(bn(r.errors,Je))){const sn=Ft(bn(r.errors,Je),or.argA,or.argB);xr&&ia(r.errors,Je,sn),zIe(r.errors,Je)}if(C.touchedFields&&mr&&Array.isArray(bn(r.touchedFields,Je))){const sn=Ft(bn(r.touchedFields,Je),or.argA,or.argB);xr&&ia(r.touchedFields,Je,sn)}C.dirtyFields&&(r.dirtyFields=Tj(c,d)),P.state.next({name:Je,isDirty:le(Je,xt),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else ia(d,Je,xt)},X=(Je,xt)=>{ia(r.errors,Je,xt),P.state.next({errors:r.errors})},Q=Je=>{r.errors=Je,P.state.next({errors:r.errors,isValid:!1})},re=(Je,xt,Ft,or)=>{const xr=bn(n,Je);if(xr){const mr=bn(d,Je,vo(Ft)?bn(c,Je):Ft);vo(mr)||or&&or.defaultChecked||xt?ia(d,Je,xt?mr:WR(xr._f)):Ze(Je,mr),p.mount&&K()}},ve=(Je,xt,Ft,or,xr)=>{let mr=!1,sn=!1;const Cs={name:Je},ys=!!(bn(n,Je)&&bn(n,Je)._f&&bn(n,Je)._f.disabled);if(!Ft||or){C.isDirty&&(sn=r.isDirty,r.isDirty=Cs.isDirty=le(),mr=sn!==Cs.isDirty);const Es=ys||Um(bn(c,Je),xt);sn=!!(!ys&&bn(r.dirtyFields,Je)),Es||ys?Wo(r.dirtyFields,Je):ia(r.dirtyFields,Je,!0),Cs.dirtyFields=r.dirtyFields,mr=mr||C.dirtyFields&&sn!==!Es}if(Ft){const Es=bn(r.touchedFields,Je);Es||(ia(r.touchedFields,Je,Ft),Cs.touchedFields=r.touchedFields,mr=mr||C.touchedFields&&Es!==Ft)}return mr&&xr&&P.state.next(Cs),mr?Cs:{}},pe=(Je,xt,Ft,or)=>{const xr=bn(r.errors,Je),mr=C.isValid&&Uh(xt)&&r.isValid!==xt;if(t.delayError&&Ft?(w=W(()=>X(Je,Ft)),w(t.delayError)):(clearTimeout(E),w=null,Ft?ia(r.errors,Je,Ft):Wo(r.errors,Je)),(Ft?!Um(xr,Ft):xr)||!Gc(or)||mr){const sn={...or,...mr&&Uh(xt)?{isValid:xt}:{},errors:r.errors,name:Je};r={...r,...sn},P.state.next(sn)}},ue=async Je=>{Z(Je,!0);const xt=await e.resolver(d,e.context,DIe(Je||a.mount,n,e.criteriaMode,e.shouldUseNativeValidation));return Z(Je),xt},ge=async Je=>{const{errors:xt}=await ue(Je);if(Je)for(const Ft of Je){const or=bn(xt,Ft);or?ia(r.errors,Ft,or):Wo(r.errors,Ft)}else r.errors=xt;return xt},ce=async(Je,xt,Ft={valid:!0})=>{for(const or in Je){const xr=Je[or];if(xr){const{_f:mr,...sn}=xr;if(mr){const Cs=a.array.has(mr.name),ys=xr._f&&OIe(xr._f);ys&&C.validatingFields&&Z([or],!0);const Es=await x$(xr,d,V,e.shouldUseNativeValidation&&!xt,Cs);if(ys&&C.validatingFields&&Z([or]),Es[mr.name]&&(Ft.valid=!1,xt))break;!xt&&(bn(Es,mr.name)?Cs?PIe(r.errors,Es,mr.name):ia(r.errors,mr.name,Es[mr.name]):Wo(r.errors,mr.name))}!Gc(sn)&&await ce(sn,xt,Ft)}}return Ft.valid},Se=()=>{for(const Je of a.unMount){const xt=bn(n,Je);xt&&(xt._f.refs?xt._f.refs.every(Ft=>!HR(Ft)):!HR(xt._f.ref))&&ft(Je)}a.unMount=new Set},le=(Je,xt)=>(Je&&xt&&ia(d,Je,xt),!Um(Mt(),c)),J=(Je,xt,Ft)=>AIe(Je,a,{...p.mount?d:vo(xt)?c:Xh(Je)?{[Je]:xt}:xt},Ft,xt),ke=Je=>fA(bn(p.mount?d:c,Je,t.shouldUnregister?bn(c,Je,[]):[])),Ze=(Je,xt,Ft={})=>{const or=bn(n,Je);let xr=xt;if(or){const mr=or._f;mr&&(!mr.disabled&&ia(d,Je,FJ(xt,mr)),xr=wI(mr.ref)&&bc(xt)?"":xt,DJ(mr.ref)?[...mr.ref.options].forEach(sn=>sn.selected=xr.includes(sn.value)):mr.refs?JE(mr.ref)?mr.refs.length>1?mr.refs.forEach(sn=>(!sn.defaultChecked||!sn.disabled)&&(sn.checked=Array.isArray(xr)?!!xr.find(Cs=>Cs===sn.value):xr===sn.value)):mr.refs[0]&&(mr.refs[0].checked=!!xr):mr.refs.forEach(sn=>sn.checked=sn.value===xr):D4(mr.ref)?mr.ref.value="":(mr.ref.value=xr,mr.ref.type||P.values.next({name:Je,values:{...d}})))}(Ft.shouldDirty||Ft.shouldTouch)&&ve(Je,xr,Ft.shouldTouch,Ft.shouldDirty,!0),Ft.shouldValidate&&it(Je)},Xe=(Je,xt,Ft)=>{for(const or in xt){const xr=xt[or],mr=`${Je}.${or}`,sn=bn(n,mr);(a.array.has(Je)||!SI(xr)||sn&&!sn._f)&&!Gv(xr)?Xe(mr,xr,Ft):Ze(mr,xr,Ft)}},qe=(Je,xt,Ft={})=>{const or=bn(n,Je),xr=a.array.has(Je),mr=Yu(xt);ia(d,Je,mr),xr?(P.array.next({name:Je,values:{...d}}),(C.isDirty||C.dirtyFields)&&Ft.shouldDirty&&P.state.next({name:Je,dirtyFields:Tj(c,d),isDirty:le(Je,mr)})):or&&!or._f&&!bc(mr)?Xe(Je,mr,Ft):Ze(Je,mr,Ft),p$(Je,a)&&P.state.next({...r}),P.values.next({name:p.mount?Je:void 0,values:{...d}})},$e=async Je=>{p.mount=!0;const xt=Je.target;let Ft=xt.name,or=!0;const xr=bn(n,Ft),mr=()=>xt.type?WR(xr._f):SIe(Je),sn=Cs=>{or=Number.isNaN(Cs)||Um(Cs,bn(d,Ft,Cs))};if(xr){let Cs,ys;const Es=mr(),so=Je.type===h$.BLUR||Je.type===h$.FOCUS_OUT,io=!LIe(xr._f)&&!e.resolver&&!bn(r.errors,Ft)&&!xr._f.deps||FIe(so,bn(r.touchedFields,Ft),r.isSubmitted,B,R),Cl=p$(Ft,a,so);ia(d,Ft,Es),so?(xr._f.onBlur&&xr._f.onBlur(Je),w&&w(0)):xr._f.onChange&&xr._f.onChange(Je);const Qo=ve(Ft,Es,so,!1),Al=!Gc(Qo)||Cl;if(!so&&P.values.next({name:Ft,type:Je.type,values:{...d}}),io)return C.isValid&&(t.mode==="onBlur"?so&&K():K()),Al&&P.state.next({name:Ft,...Cl?{}:Qo});if(!so&&Cl&&P.state.next({...r}),e.resolver){const{errors:kc}=await ue([Ft]);if(sn(Es),or){const zi=w$(r.errors,n,Ft),Pl=w$(kc,n,zi.name||Ft);Cs=Pl.error,Ft=Pl.name,ys=Gc(kc)}}else Z([Ft],!0),Cs=(await x$(xr,d,V,e.shouldUseNativeValidation))[Ft],Z([Ft]),sn(Es),or&&(Cs?ys=!1:C.isValid&&(ys=await ce(n,!0)));or&&(xr._f.deps&&it(xr._f.deps),pe(Ft,ys,Cs,Qo))}},st=(Je,xt)=>{if(bn(r.errors,xt)&&Je.focus)return Je.focus(),1},it=async(Je,xt={})=>{let Ft,or;const xr=oN(Je);if(e.resolver){const mr=await ge(vo(Je)?Je:xr);Ft=Gc(mr),or=Je?!xr.some(sn=>bn(mr,sn)):Ft}else Je?(or=(await Promise.all(xr.map(async mr=>{const sn=bn(n,mr);return await ce(sn&&sn._f?{[mr]:sn}:sn)}))).every(Boolean),!(!or&&!r.isValid)&&K()):or=Ft=await ce(n);return P.state.next({...!Xh(Je)||C.isValid&&Ft!==r.isValid?{}:{name:Je},...e.resolver||!Je?{isValid:Ft}:{},errors:r.errors}),xt.shouldFocus&&!or&&uS(n,st,Je?xr:a.mount),or},Mt=Je=>{const xt={...p.mount?d:c};return vo(Je)?xt:Xh(Je)?bn(xt,Je):Je.map(Ft=>bn(xt,Ft))},ar=(Je,xt)=>({invalid:!!bn((xt||r).errors,Je),isDirty:!!bn((xt||r).dirtyFields,Je),error:bn((xt||r).errors,Je),isValidating:!!bn(r.validatingFields,Je),isTouched:!!bn((xt||r).touchedFields,Je)}),St=Je=>{Je&&oN(Je).forEach(xt=>Wo(r.errors,xt)),P.state.next({errors:Je?r.errors:{}})},Xt=(Je,xt,Ft)=>{const or=(bn(n,Je,{_f:{}})._f||{}).ref,xr=bn(r.errors,Je)||{},{ref:mr,message:sn,type:Cs,...ys}=xr;ia(r.errors,Je,{...ys,...xt,ref:or}),P.state.next({name:Je,errors:r.errors,isValid:!1}),Ft&&Ft.shouldFocus&&or&&or.focus&&or.focus()},dt=(Je,xt)=>ip(Je)?P.values.subscribe({next:Ft=>Je(J(void 0,xt),Ft)}):J(Je,xt,!0),ft=(Je,xt={})=>{for(const Ft of Je?oN(Je):a.mount)a.mount.delete(Ft),a.array.delete(Ft),xt.keepValue||(Wo(n,Ft),Wo(d,Ft)),!xt.keepError&&Wo(r.errors,Ft),!xt.keepDirty&&Wo(r.dirtyFields,Ft),!xt.keepTouched&&Wo(r.touchedFields,Ft),!xt.keepIsValidating&&Wo(r.validatingFields,Ft),!e.shouldUnregister&&!xt.keepDefaultValue&&Wo(c,Ft);P.values.next({values:{...d}}),P.state.next({...r,...xt.keepDirty?{isDirty:le()}:{}}),!xt.keepIsValid&&K()},Wt=({disabled:Je,name:xt,field:Ft,fields:or,value:xr})=>{if(Uh(Je)&&p.mount||Je){const mr=Je?void 0:vo(xr)?WR(Ft?Ft._f:bn(or,xt)._f):xr;ia(d,xt,mr),ve(xt,mr,!1,!1,!0)}},Wr=(Je,xt={})=>{let Ft=bn(n,Je);const or=Uh(xt.disabled)||Uh(t.disabled);return ia(n,Je,{...Ft||{},_f:{...Ft&&Ft._f?Ft._f:{ref:{name:Je}},name:Je,mount:!0,...xt}}),a.mount.add(Je),Ft?Wt({field:Ft,disabled:Uh(xt.disabled)?xt.disabled:t.disabled,name:Je,value:xt.value}):re(Je,!0,xt.value),{...or?{disabled:xt.disabled||t.disabled}:{},...e.progressive?{required:!!xt.required,min:C1(xt.min),max:C1(xt.max),minLength:C1(xt.minLength),maxLength:C1(xt.maxLength),pattern:C1(xt.pattern)}:{},name:Je,onChange:$e,onBlur:$e,ref:xr=>{if(xr){Wr(Je,xt),Ft=bn(n,Je);const mr=vo(xr.value)&&xr.querySelectorAll&&xr.querySelectorAll("input,select,textarea")[0]||xr,sn=MIe(mr),Cs=Ft._f.refs||[];if(sn?Cs.find(ys=>ys===mr):mr===Ft._f.ref)return;ia(n,Je,{_f:{...Ft._f,...sn?{refs:[...Cs.filter(HR),mr,...Array.isArray(bn(c,Je))?[{}]:[]],ref:{type:mr.type,name:Je}}:{ref:mr}}}),re(Je,!1,void 0,mr)}else Ft=bn(n,Je,{}),Ft._f&&(Ft._f.mount=!1),(e.shouldUnregister||xt.shouldUnregister)&&!(TIe(a.array,Je)&&p.action)&&a.unMount.add(Je)}}},jr=()=>e.shouldFocusError&&uS(n,st,a.mount),Br=Je=>{Uh(Je)&&(P.state.next({disabled:Je}),uS(n,(xt,Ft)=>{const or=bn(n,Ft);or&&(xt.disabled=or._f.disabled||Je,Array.isArray(or._f.refs)&&or._f.refs.forEach(xr=>{xr.disabled=or._f.disabled||Je}))},0,!1))},on=(Je,xt)=>async Ft=>{let or;Ft&&(Ft.preventDefault&&Ft.preventDefault(),Ft.persist&&Ft.persist());let xr=Yu(d);if(P.state.next({isSubmitting:!0}),e.resolver){const{errors:mr,values:sn}=await ue();r.errors=mr,xr=sn}else await ce(n);if(Wo(r.errors,"root"),Gc(r.errors)){P.state.next({errors:{}});try{await Je(xr,Ft)}catch(mr){or=mr}}else xt&&await xt({...r.errors},Ft),jr(),setTimeout(jr);if(P.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Gc(r.errors)&&!or,submitCount:r.submitCount+1,errors:r.errors}),or)throw or},Zn=(Je,xt={})=>{bn(n,Je)&&(vo(xt.defaultValue)?qe(Je,Yu(bn(c,Je))):(qe(Je,xt.defaultValue),ia(c,Je,Yu(xt.defaultValue))),xt.keepTouched||Wo(r.touchedFields,Je),xt.keepDirty||(Wo(r.dirtyFields,Je),r.isDirty=xt.defaultValue?le(Je,Yu(bn(c,Je))):le()),xt.keepError||(Wo(r.errors,Je),C.isValid&&K()),P.state.next({...r}))},ln=(Je,xt={})=>{const Ft=Je?Yu(Je):c,or=Yu(Ft),xr=Gc(Je),mr=xr?c:or;if(xt.keepDefaultValues||(c=Ft),!xt.keepValues){if(xt.keepDirtyValues)for(const sn of a.mount)bn(r.dirtyFields,sn)?ia(mr,sn,bn(d,sn)):qe(sn,bn(mr,sn));else{if(R4&&vo(Je))for(const sn of a.mount){const Cs=bn(n,sn);if(Cs&&Cs._f){const ys=Array.isArray(Cs._f.refs)?Cs._f.refs[0]:Cs._f.ref;if(wI(ys)){const Es=ys.closest("form");if(Es){Es.reset();break}}}}n={}}d=t.shouldUnregister?xt.keepDefaultValues?Yu(c):{}:Yu(mr),P.array.next({values:{...mr}}),P.values.next({values:{...mr}})}a={mount:xt.keepDirtyValues?a.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!C.isValid||!!xt.keepIsValid||!!xt.keepDirtyValues,p.watch=!!t.shouldUnregister,P.state.next({submitCount:xt.keepSubmitCount?r.submitCount:0,isDirty:xr?!1:xt.keepDirty?r.isDirty:!!(xt.keepDefaultValues&&!Um(Je,c)),isSubmitted:xt.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:xr?{}:xt.keepDirtyValues?xt.keepDefaultValues&&d?Tj(c,d):r.dirtyFields:xt.keepDefaultValues&&Je?Tj(c,Je):xt.keepDirty?r.dirtyFields:{},touchedFields:xt.keepTouched?r.touchedFields:{},errors:xt.keepErrors?r.errors:{},isSubmitSuccessful:xt.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},dr=(Je,xt)=>ln(ip(Je)?Je(d):Je,xt);return{control:{register:Wr,unregister:ft,getFieldState:ar,handleSubmit:on,setError:Xt,_executeSchema:ue,_getWatch:J,_getDirty:le,_updateValid:K,_removeUnmounted:Se,_updateFieldArray:$,_updateDisabledField:Wt,_getFieldArray:ke,_reset:ln,_resetDefaultValues:()=>ip(e.defaultValues)&&e.defaultValues().then(Je=>{dr(Je,e.resetOptions),P.state.next({isLoading:!1})}),_updateFormState:Je=>{r={...r,...Je}},_disableForm:Br,_subjects:P,_proxyFormState:C,_setErrors:Q,get _fields(){return n},get _formValues(){return d},get _state(){return p},set _state(Je){p=Je},get _defaultValues(){return c},get _names(){return a},set _names(Je){a=Je},get _formState(){return r},set _formState(Je){r=Je},get _options(){return e},set _options(Je){e={...e,...Je}}},trigger:it,register:Wr,handleSubmit:on,watch:dt,setValue:qe,getValues:Mt,reset:dr,resetField:Zn,clearErrors:St,unregister:ft,setError:Xt,setFocus:(Je,xt={})=>{const Ft=bn(n,Je),or=Ft&&Ft._f;if(or){const xr=or.refs?or.refs[0]:or.ref;xr.focus&&(xr.focus(),xt.shouldSelect&&xr.select())}},getFieldState:ar}}function K_(t={}){const e=_n.useRef(),r=_n.useRef(),[n,c]=_n.useState({isDirty:!1,isValidating:!1,isLoading:ip(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,defaultValues:ip(t.defaultValues)?void 0:t.defaultValues});e.current||(e.current={...VIe(t),formState:n});const d=e.current.control;return d._options=t,CIe({subject:d._subjects.state,next:p=>{IIe(p,d._proxyFormState,d._updateFormState)&&c({...d._formState})}}),_n.useEffect(()=>d._disableForm(t.disabled),[d,t.disabled]),_n.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==n.isDirty&&d._subjects.state.next({isDirty:p})}},[d,n.isDirty]),_n.useEffect(()=>{t.values&&!Um(t.values,r.current)?(d._reset(t.values,d._options.resetOptions),r.current=t.values,c(p=>({...p}))):d._resetDefaultValues()},[t.values,d]),_n.useEffect(()=>{t.errors&&d._setErrors(t.errors)},[t.errors,d]),_n.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),_n.useEffect(()=>{t.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[t.shouldUnregister,d]),e.current.formState=NIe(n,d),e.current}const b$=(t,e,r)=>{if(t&&"reportValidity"in t){const n=bn(r,e);t.setCustomValidity(n&&n.message||""),t.reportValidity()}},zJ=(t,e)=>{for(const r in e.fields){const n=e.fields[r];n&&n.ref&&"reportValidity"in n.ref?b$(n.ref,r,t):n.refs&&n.refs.forEach(c=>b$(c,r,t))}},UIe=(t,e)=>{e.shouldUseNativeValidation&&zJ(t,e);const r={};for(const n in t){const c=bn(e.fields,n),d=Object.assign(t[n]||{},{ref:c&&c.ref});if($Ie(e.names||Object.keys(t),n)){const p=Object.assign({},bn(r,n));ia(p,"root",d),ia(r,n,p)}else ia(r,n,d)}return r},$Ie=(t,e)=>t.some(r=>r.startsWith(e+"."));var qIe=function(t,e){for(var r={};t.length;){var n=t[0],c=n.code,d=n.message,p=n.path.join(".");if(!r[p])if("unionErrors"in n){var a=n.unionErrors[0].errors[0];r[p]={message:a.message,type:a.code}}else r[p]={message:d,type:c};if("unionErrors"in n&&n.unionErrors.forEach(function(C){return C.errors.forEach(function(P){return t.push(P)})}),e){var w=r[p].types,E=w&&w[n.code];r[p]=kJ(p,e,r,c,E?[].concat(E,n.message):n.message)}t.shift()}return r},X_=function(t,e,r){return r===void 0&&(r={}),function(n,c,d){try{return Promise.resolve(function(p,a){try{var w=Promise.resolve(t[r.mode==="sync"?"parse":"parseAsync"](n,e)).then(function(E){return d.shouldUseNativeValidation&&zJ({},d),{errors:{},values:r.raw?n:E}})}catch(E){return a(E)}return w&&w.then?w.then(void 0,a):w}(0,function(p){if(function(a){return Array.isArray(a==null?void 0:a.errors)}(p))return{values:{},errors:UIe(qIe(p.errors,!d.shouldUseNativeValidation&&d.criteriaMode==="all"),d)};throw p}))}catch(p){return Promise.reject(p)}}},Ii;(function(t){t.assertEqual=c=>c;function e(c){}t.assertIs=e;function r(c){throw new Error}t.assertNever=r,t.arrayToEnum=c=>{const d={};for(const p of c)d[p]=p;return d},t.getValidEnumValues=c=>{const d=t.objectKeys(c).filter(a=>typeof c[c[a]]!="number"),p={};for(const a of d)p[a]=c[a];return t.objectValues(p)},t.objectValues=c=>t.objectKeys(c).map(function(d){return c[d]}),t.objectKeys=typeof Object.keys=="function"?c=>Object.keys(c):c=>{const d=[];for(const p in c)Object.prototype.hasOwnProperty.call(c,p)&&d.push(p);return d},t.find=(c,d)=>{for(const p of c)if(d(p))return p},t.isInteger=typeof Number.isInteger=="function"?c=>Number.isInteger(c):c=>typeof c=="number"&&isFinite(c)&&Math.floor(c)===c;function n(c,d=" | "){return c.map(p=>typeof p=="string"?`'${p}'`:p).join(d)}t.joinValues=n,t.jsonStringifyReplacer=(c,d)=>typeof d=="bigint"?d.toString():d})(Ii||(Ii={}));var oO;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(oO||(oO={}));const xn=Ii.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),$m=t=>{switch(typeof t){case"undefined":return xn.undefined;case"string":return xn.string;case"number":return isNaN(t)?xn.nan:xn.number;case"boolean":return xn.boolean;case"function":return xn.function;case"bigint":return xn.bigint;case"symbol":return xn.symbol;case"object":return Array.isArray(t)?xn.array:t===null?xn.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?xn.promise:typeof Map<"u"&&t instanceof Map?xn.map:typeof Set<"u"&&t instanceof Set?xn.set:typeof Date<"u"&&t instanceof Date?xn.date:xn.object;default:return xn.unknown}},Mr=Ii.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),GIe=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class Mu extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const r=e||function(d){return d.message},n={_errors:[]},c=d=>{for(const p of d.issues)if(p.code==="invalid_union")p.unionErrors.map(c);else if(p.code==="invalid_return_type")c(p.returnTypeError);else if(p.code==="invalid_arguments")c(p.argumentsError);else if(p.path.length===0)n._errors.push(r(p));else{let a=n,w=0;for(;w<p.path.length;){const E=p.path[w];w===p.path.length-1?(a[E]=a[E]||{_errors:[]},a[E]._errors.push(r(p))):a[E]=a[E]||{_errors:[]},a=a[E],w++}}};return c(this),n}static assert(e){if(!(e instanceof Mu))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ii.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},n=[];for(const c of this.issues)c.path.length>0?(r[c.path[0]]=r[c.path[0]]||[],r[c.path[0]].push(e(c))):n.push(e(c));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Mu.create=t=>new Mu(t);const V0=(t,e)=>{let r;switch(t.code){case Mr.invalid_type:t.received===xn.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case Mr.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Ii.jsonStringifyReplacer)}`;break;case Mr.unrecognized_keys:r=`Unrecognized key(s) in object: ${Ii.joinValues(t.keys,", ")}`;break;case Mr.invalid_union:r="Invalid input";break;case Mr.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Ii.joinValues(t.options)}`;break;case Mr.invalid_enum_value:r=`Invalid enum value. Expected ${Ii.joinValues(t.options)}, received '${t.received}'`;break;case Mr.invalid_arguments:r="Invalid function arguments";break;case Mr.invalid_return_type:r="Invalid function return type";break;case Mr.invalid_date:r="Invalid date";break;case Mr.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Ii.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case Mr.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case Mr.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case Mr.custom:r="Invalid input";break;case Mr.invalid_intersection_types:r="Intersection results could not be merged";break;case Mr.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case Mr.not_finite:r="Number must be finite";break;default:r=e.defaultError,Ii.assertNever(t)}return{message:r}};let BJ=V0;function HIe(t){BJ=t}function TI(){return BJ}const jI=t=>{const{data:e,path:r,errorMaps:n,issueData:c}=t,d=[...r,...c.path||[]],p={...c,path:d};if(c.message!==void 0)return{...c,path:d,message:c.message};let a="";const w=n.filter(E=>!!E).slice().reverse();for(const E of w)a=E(p,{data:e,defaultError:a}).message;return{...c,path:d,message:a}},WIe=[];function fn(t,e){const r=TI(),n=jI({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===V0?void 0:V0].filter(c=>!!c)});t.common.issues.push(n)}class Kl{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const c of r){if(c.status==="aborted")return ws;c.status==="dirty"&&e.dirty(),n.push(c.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){const n=[];for(const c of r){const d=await c.key,p=await c.value;n.push({key:d,value:p})}return Kl.mergeObjectSync(e,n)}static mergeObjectSync(e,r){const n={};for(const c of r){const{key:d,value:p}=c;if(d.status==="aborted"||p.status==="aborted")return ws;d.status==="dirty"&&e.dirty(),p.status==="dirty"&&e.dirty(),d.value!=="__proto__"&&(typeof p.value<"u"||c.alwaysSet)&&(n[d.value]=p.value)}return{status:e.value,value:n}}}const ws=Object.freeze({status:"aborted"}),Hv=t=>({status:"dirty",value:t}),Ic=t=>({status:"valid",value:t}),lO=t=>t.status==="aborted",cO=t=>t.status==="dirty",JS=t=>t.status==="valid",QS=t=>typeof Promise<"u"&&t instanceof Promise;function NI(t,e,r,n){if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function VJ(t,e,r,n,c){if(typeof e=="function"?t!==e||!c:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r}var Fn;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Fn||(Fn={}));var U1,$1;class df{constructor(e,r,n,c){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=c}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const S$=(t,e)=>{if(JS(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Mu(t.common.issues);return this._error=r,this._error}}};function Gs(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:n,description:c}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:c}:{errorMap:(p,a)=>{var w,E;const{message:C}=t;return p.code==="invalid_enum_value"?{message:C??a.defaultError}:typeof a.data>"u"?{message:(w=C??n)!==null&&w!==void 0?w:a.defaultError}:p.code!=="invalid_type"?{message:a.defaultError}:{message:(E=C??r)!==null&&E!==void 0?E:a.defaultError}},description:c}}class Qs{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return $m(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:$m(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Kl,ctx:{common:e.parent.common,data:e.data,parsedType:$m(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(QS(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;const c={common:{issues:[],async:(n=r==null?void 0:r.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$m(e)},d=this._parseSync({data:e,path:c.path,parent:c});return S$(c,d)}async parseAsync(e,r){const n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$m(e)},c=this._parse({data:e,path:n.path,parent:n}),d=await(QS(c)?c:Promise.resolve(c));return S$(n,d)}refine(e,r){const n=c=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(c):r;return this._refinement((c,d)=>{const p=e(c),a=()=>d.addIssue({code:Mr.custom,...n(c)});return typeof Promise<"u"&&p instanceof Promise?p.then(w=>w?!0:(a(),!1)):p?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,c)=>e(n)?!0:(c.addIssue(typeof r=="function"?r(n,c):r),!1))}_refinement(e){return new lh({schema:this,typeName:_s.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return nf.create(this,this._def)}nullable(){return wg.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Qd.create(this,this._def)}promise(){return $0.create(this,this._def)}or(e){return nE.create([this,e],this._def)}and(e){return sE.create(this,e,this._def)}transform(e){return new lh({...Gs(this._def),schema:this,typeName:_s.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new cE({...Gs(this._def),innerType:this,defaultValue:r,typeName:_s.ZodDefault})}brand(){return new L4({typeName:_s.ZodBranded,type:this,...Gs(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new uE({...Gs(this._def),innerType:this,catchValue:r,typeName:_s.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return QE.create(this,e)}readonly(){return dE.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ZIe=/^c[^\s-]{8,}$/i,KIe=/^[0-9a-z]+$/,XIe=/^[0-9A-HJKMNP-TV-Z]{26}$/,YIe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,JIe=/^[a-z0-9_-]{21}$/i,QIe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,eCe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tCe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ZR;const rCe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,nCe=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,sCe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,UJ="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",iCe=new RegExp(`^${UJ}$`);function $J(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function aCe(t){return new RegExp(`^${$J(t)}$`)}function qJ(t){let e=`${UJ}T${$J(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function oCe(t,e){return!!((e==="v4"||!e)&&rCe.test(t)||(e==="v6"||!e)&&nCe.test(t))}class Wd extends Qs{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==xn.string){const d=this._getOrReturnCtx(e);return fn(d,{code:Mr.invalid_type,expected:xn.string,received:d.parsedType}),ws}const n=new Kl;let c;for(const d of this._def.checks)if(d.kind==="min")e.data.length<d.value&&(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),n.dirty());else if(d.kind==="max")e.data.length>d.value&&(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),n.dirty());else if(d.kind==="length"){const p=e.data.length>d.value,a=e.data.length<d.value;(p||a)&&(c=this._getOrReturnCtx(e,c),p?fn(c,{code:Mr.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}):a&&fn(c,{code:Mr.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}),n.dirty())}else if(d.kind==="email")eCe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"email",code:Mr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="emoji")ZR||(ZR=new RegExp(tCe,"u")),ZR.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"emoji",code:Mr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="uuid")YIe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"uuid",code:Mr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="nanoid")JIe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"nanoid",code:Mr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="cuid")ZIe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"cuid",code:Mr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="cuid2")KIe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"cuid2",code:Mr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="ulid")XIe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"ulid",code:Mr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="url")try{new URL(e.data)}catch{c=this._getOrReturnCtx(e,c),fn(c,{validation:"url",code:Mr.invalid_string,message:d.message}),n.dirty()}else d.kind==="regex"?(d.regex.lastIndex=0,d.regex.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"regex",code:Mr.invalid_string,message:d.message}),n.dirty())):d.kind==="trim"?e.data=e.data.trim():d.kind==="includes"?e.data.includes(d.value,d.position)||(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.invalid_string,validation:{includes:d.value,position:d.position},message:d.message}),n.dirty()):d.kind==="toLowerCase"?e.data=e.data.toLowerCase():d.kind==="toUpperCase"?e.data=e.data.toUpperCase():d.kind==="startsWith"?e.data.startsWith(d.value)||(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.invalid_string,validation:{startsWith:d.value},message:d.message}),n.dirty()):d.kind==="endsWith"?e.data.endsWith(d.value)||(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.invalid_string,validation:{endsWith:d.value},message:d.message}),n.dirty()):d.kind==="datetime"?qJ(d).test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.invalid_string,validation:"datetime",message:d.message}),n.dirty()):d.kind==="date"?iCe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.invalid_string,validation:"date",message:d.message}),n.dirty()):d.kind==="time"?aCe(d).test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.invalid_string,validation:"time",message:d.message}),n.dirty()):d.kind==="duration"?QIe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"duration",code:Mr.invalid_string,message:d.message}),n.dirty()):d.kind==="ip"?oCe(e.data,d.version)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"ip",code:Mr.invalid_string,message:d.message}),n.dirty()):d.kind==="base64"?sCe.test(e.data)||(c=this._getOrReturnCtx(e,c),fn(c,{validation:"base64",code:Mr.invalid_string,message:d.message}),n.dirty()):Ii.assertNever(d);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(c=>e.test(c),{validation:r,code:Mr.invalid_string,...Fn.errToObj(n)})}_addCheck(e){return new Wd({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Fn.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Fn.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Fn.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Fn.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Fn.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Fn.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Fn.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Fn.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Fn.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Fn.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(r=e==null?void 0:e.offset)!==null&&r!==void 0?r:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...Fn.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Fn.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Fn.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...Fn.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...Fn.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...Fn.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...Fn.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...Fn.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...Fn.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...Fn.errToObj(r)})}nonempty(e){return this.min(1,Fn.errToObj(e))}trim(){return new Wd({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Wd({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Wd({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Wd.create=t=>{var e;return new Wd({checks:[],typeName:_s.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...Gs(t)})};function lCe(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,c=r>n?r:n,d=parseInt(t.toFixed(c).replace(".","")),p=parseInt(e.toFixed(c).replace(".",""));return d%p/Math.pow(10,c)}class yg extends Qs{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==xn.number){const d=this._getOrReturnCtx(e);return fn(d,{code:Mr.invalid_type,expected:xn.number,received:d.parsedType}),ws}let n;const c=new Kl;for(const d of this._def.checks)d.kind==="int"?Ii.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),fn(n,{code:Mr.invalid_type,expected:"integer",received:"float",message:d.message}),c.dirty()):d.kind==="min"?(d.inclusive?e.data<d.value:e.data<=d.value)&&(n=this._getOrReturnCtx(e,n),fn(n,{code:Mr.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):d.kind==="max"?(d.inclusive?e.data>d.value:e.data>=d.value)&&(n=this._getOrReturnCtx(e,n),fn(n,{code:Mr.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):d.kind==="multipleOf"?lCe(e.data,d.value)!==0&&(n=this._getOrReturnCtx(e,n),fn(n,{code:Mr.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):d.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),fn(n,{code:Mr.not_finite,message:d.message}),c.dirty()):Ii.assertNever(d);return{status:c.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,Fn.toString(r))}gt(e,r){return this.setLimit("min",e,!1,Fn.toString(r))}lte(e,r){return this.setLimit("max",e,!0,Fn.toString(r))}lt(e,r){return this.setLimit("max",e,!1,Fn.toString(r))}setLimit(e,r,n,c){return new yg({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:Fn.toString(c)}]})}_addCheck(e){return new yg({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Fn.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Fn.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Fn.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Fn.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Fn.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:Fn.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:Fn.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Fn.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Fn.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ii.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}}yg.create=t=>new yg({checks:[],typeName:_s.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...Gs(t)});class xg extends Qs{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==xn.bigint){const d=this._getOrReturnCtx(e);return fn(d,{code:Mr.invalid_type,expected:xn.bigint,received:d.parsedType}),ws}let n;const c=new Kl;for(const d of this._def.checks)d.kind==="min"?(d.inclusive?e.data<d.value:e.data<=d.value)&&(n=this._getOrReturnCtx(e,n),fn(n,{code:Mr.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):d.kind==="max"?(d.inclusive?e.data>d.value:e.data>=d.value)&&(n=this._getOrReturnCtx(e,n),fn(n,{code:Mr.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):d.kind==="multipleOf"?e.data%d.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),fn(n,{code:Mr.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):Ii.assertNever(d);return{status:c.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,Fn.toString(r))}gt(e,r){return this.setLimit("min",e,!1,Fn.toString(r))}lte(e,r){return this.setLimit("max",e,!0,Fn.toString(r))}lt(e,r){return this.setLimit("max",e,!1,Fn.toString(r))}setLimit(e,r,n,c){return new xg({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:Fn.toString(c)}]})}_addCheck(e){return new xg({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Fn.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Fn.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Fn.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Fn.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:Fn.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}xg.create=t=>{var e;return new xg({checks:[],typeName:_s.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...Gs(t)})};class eE extends Qs{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==xn.boolean){const n=this._getOrReturnCtx(e);return fn(n,{code:Mr.invalid_type,expected:xn.boolean,received:n.parsedType}),ws}return Ic(e.data)}}eE.create=t=>new eE({typeName:_s.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...Gs(t)});class jy extends Qs{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==xn.date){const d=this._getOrReturnCtx(e);return fn(d,{code:Mr.invalid_type,expected:xn.date,received:d.parsedType}),ws}if(isNaN(e.data.getTime())){const d=this._getOrReturnCtx(e);return fn(d,{code:Mr.invalid_date}),ws}const n=new Kl;let c;for(const d of this._def.checks)d.kind==="min"?e.data.getTime()<d.value&&(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),n.dirty()):d.kind==="max"?e.data.getTime()>d.value&&(c=this._getOrReturnCtx(e,c),fn(c,{code:Mr.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),n.dirty()):Ii.assertNever(d);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new jy({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:Fn.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:Fn.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}jy.create=t=>new jy({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:_s.ZodDate,...Gs(t)});class II extends Qs{_parse(e){if(this._getType(e)!==xn.symbol){const n=this._getOrReturnCtx(e);return fn(n,{code:Mr.invalid_type,expected:xn.symbol,received:n.parsedType}),ws}return Ic(e.data)}}II.create=t=>new II({typeName:_s.ZodSymbol,...Gs(t)});class tE extends Qs{_parse(e){if(this._getType(e)!==xn.undefined){const n=this._getOrReturnCtx(e);return fn(n,{code:Mr.invalid_type,expected:xn.undefined,received:n.parsedType}),ws}return Ic(e.data)}}tE.create=t=>new tE({typeName:_s.ZodUndefined,...Gs(t)});class rE extends Qs{_parse(e){if(this._getType(e)!==xn.null){const n=this._getOrReturnCtx(e);return fn(n,{code:Mr.invalid_type,expected:xn.null,received:n.parsedType}),ws}return Ic(e.data)}}rE.create=t=>new rE({typeName:_s.ZodNull,...Gs(t)});class U0 extends Qs{constructor(){super(...arguments),this._any=!0}_parse(e){return Ic(e.data)}}U0.create=t=>new U0({typeName:_s.ZodAny,...Gs(t)});class Y_ extends Qs{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ic(e.data)}}Y_.create=t=>new Y_({typeName:_s.ZodUnknown,...Gs(t)});class Np extends Qs{_parse(e){const r=this._getOrReturnCtx(e);return fn(r,{code:Mr.invalid_type,expected:xn.never,received:r.parsedType}),ws}}Np.create=t=>new Np({typeName:_s.ZodNever,...Gs(t)});class CI extends Qs{_parse(e){if(this._getType(e)!==xn.undefined){const n=this._getOrReturnCtx(e);return fn(n,{code:Mr.invalid_type,expected:xn.void,received:n.parsedType}),ws}return Ic(e.data)}}CI.create=t=>new CI({typeName:_s.ZodVoid,...Gs(t)});class Qd extends Qs{_parse(e){const{ctx:r,status:n}=this._processInputParams(e),c=this._def;if(r.parsedType!==xn.array)return fn(r,{code:Mr.invalid_type,expected:xn.array,received:r.parsedType}),ws;if(c.exactLength!==null){const p=r.data.length>c.exactLength.value,a=r.data.length<c.exactLength.value;(p||a)&&(fn(r,{code:p?Mr.too_big:Mr.too_small,minimum:a?c.exactLength.value:void 0,maximum:p?c.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:c.exactLength.message}),n.dirty())}if(c.minLength!==null&&r.data.length<c.minLength.value&&(fn(r,{code:Mr.too_small,minimum:c.minLength.value,type:"array",inclusive:!0,exact:!1,message:c.minLength.message}),n.dirty()),c.maxLength!==null&&r.data.length>c.maxLength.value&&(fn(r,{code:Mr.too_big,maximum:c.maxLength.value,type:"array",inclusive:!0,exact:!1,message:c.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((p,a)=>c.type._parseAsync(new df(r,p,r.path,a)))).then(p=>Kl.mergeArray(n,p));const d=[...r.data].map((p,a)=>c.type._parseSync(new df(r,p,r.path,a)));return Kl.mergeArray(n,d)}get element(){return this._def.type}min(e,r){return new Qd({...this._def,minLength:{value:e,message:Fn.toString(r)}})}max(e,r){return new Qd({...this._def,maxLength:{value:e,message:Fn.toString(r)}})}length(e,r){return new Qd({...this._def,exactLength:{value:e,message:Fn.toString(r)}})}nonempty(e){return this.min(1,e)}}Qd.create=(t,e)=>new Qd({type:t,minLength:null,maxLength:null,exactLength:null,typeName:_s.ZodArray,...Gs(e)});function Nv(t){if(t instanceof Ha){const e={};for(const r in t.shape){const n=t.shape[r];e[r]=nf.create(Nv(n))}return new Ha({...t._def,shape:()=>e})}else return t instanceof Qd?new Qd({...t._def,type:Nv(t.element)}):t instanceof nf?nf.create(Nv(t.unwrap())):t instanceof wg?wg.create(Nv(t.unwrap())):t instanceof hf?hf.create(t.items.map(e=>Nv(e))):t}class Ha extends Qs{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=Ii.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==xn.object){const E=this._getOrReturnCtx(e);return fn(E,{code:Mr.invalid_type,expected:xn.object,received:E.parsedType}),ws}const{status:n,ctx:c}=this._processInputParams(e),{shape:d,keys:p}=this._getCached(),a=[];if(!(this._def.catchall instanceof Np&&this._def.unknownKeys==="strip"))for(const E in c.data)p.includes(E)||a.push(E);const w=[];for(const E of p){const C=d[E],P=c.data[E];w.push({key:{status:"valid",value:E},value:C._parse(new df(c,P,c.path,E)),alwaysSet:E in c.data})}if(this._def.catchall instanceof Np){const E=this._def.unknownKeys;if(E==="passthrough")for(const C of a)w.push({key:{status:"valid",value:C},value:{status:"valid",value:c.data[C]}});else if(E==="strict")a.length>0&&(fn(c,{code:Mr.unrecognized_keys,keys:a}),n.dirty());else if(E!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const E=this._def.catchall;for(const C of a){const P=c.data[C];w.push({key:{status:"valid",value:C},value:E._parse(new df(c,P,c.path,C)),alwaysSet:C in c.data})}}return c.common.async?Promise.resolve().then(async()=>{const E=[];for(const C of w){const P=await C.key,R=await C.value;E.push({key:P,value:R,alwaysSet:C.alwaysSet})}return E}).then(E=>Kl.mergeObjectSync(n,E)):Kl.mergeObjectSync(n,w)}get shape(){return this._def.shape()}strict(e){return Fn.errToObj,new Ha({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var c,d,p,a;const w=(p=(d=(c=this._def).errorMap)===null||d===void 0?void 0:d.call(c,r,n).message)!==null&&p!==void 0?p:n.defaultError;return r.code==="unrecognized_keys"?{message:(a=Fn.errToObj(e).message)!==null&&a!==void 0?a:w}:{message:w}}}:{}})}strip(){return new Ha({...this._def,unknownKeys:"strip"})}passthrough(){return new Ha({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ha({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ha({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:_s.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new Ha({...this._def,catchall:e})}pick(e){const r={};return Ii.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new Ha({...this._def,shape:()=>r})}omit(e){const r={};return Ii.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new Ha({...this._def,shape:()=>r})}deepPartial(){return Nv(this)}partial(e){const r={};return Ii.objectKeys(this.shape).forEach(n=>{const c=this.shape[n];e&&!e[n]?r[n]=c:r[n]=c.optional()}),new Ha({...this._def,shape:()=>r})}required(e){const r={};return Ii.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let d=this.shape[n];for(;d instanceof nf;)d=d._def.innerType;r[n]=d}}),new Ha({...this._def,shape:()=>r})}keyof(){return GJ(Ii.objectKeys(this.shape))}}Ha.create=(t,e)=>new Ha({shape:()=>t,unknownKeys:"strip",catchall:Np.create(),typeName:_s.ZodObject,...Gs(e)});Ha.strictCreate=(t,e)=>new Ha({shape:()=>t,unknownKeys:"strict",catchall:Np.create(),typeName:_s.ZodObject,...Gs(e)});Ha.lazycreate=(t,e)=>new Ha({shape:t,unknownKeys:"strip",catchall:Np.create(),typeName:_s.ZodObject,...Gs(e)});class nE extends Qs{_parse(e){const{ctx:r}=this._processInputParams(e),n=this._def.options;function c(d){for(const a of d)if(a.result.status==="valid")return a.result;for(const a of d)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;const p=d.map(a=>new Mu(a.ctx.common.issues));return fn(r,{code:Mr.invalid_union,unionErrors:p}),ws}if(r.common.async)return Promise.all(n.map(async d=>{const p={...r,common:{...r.common,issues:[]},parent:null};return{result:await d._parseAsync({data:r.data,path:r.path,parent:p}),ctx:p}})).then(c);{let d;const p=[];for(const w of n){const E={...r,common:{...r.common,issues:[]},parent:null},C=w._parseSync({data:r.data,path:r.path,parent:E});if(C.status==="valid")return C;C.status==="dirty"&&!d&&(d={result:C,ctx:E}),E.common.issues.length&&p.push(E.common.issues)}if(d)return r.common.issues.push(...d.ctx.common.issues),d.result;const a=p.map(w=>new Mu(w));return fn(r,{code:Mr.invalid_union,unionErrors:a}),ws}}get options(){return this._def.options}}nE.create=(t,e)=>new nE({options:t,typeName:_s.ZodUnion,...Gs(e)});const Wf=t=>t instanceof aE?Wf(t.schema):t instanceof lh?Wf(t.innerType()):t instanceof oE?[t.value]:t instanceof vg?t.options:t instanceof lE?Ii.objectValues(t.enum):t instanceof cE?Wf(t._def.innerType):t instanceof tE?[void 0]:t instanceof rE?[null]:t instanceof nf?[void 0,...Wf(t.unwrap())]:t instanceof wg?[null,...Wf(t.unwrap())]:t instanceof L4||t instanceof dE?Wf(t.unwrap()):t instanceof uE?Wf(t._def.innerType):[];class pA extends Qs{_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==xn.object)return fn(r,{code:Mr.invalid_type,expected:xn.object,received:r.parsedType}),ws;const n=this.discriminator,c=r.data[n],d=this.optionsMap.get(c);return d?r.common.async?d._parseAsync({data:r.data,path:r.path,parent:r}):d._parseSync({data:r.data,path:r.path,parent:r}):(fn(r,{code:Mr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ws)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){const c=new Map;for(const d of r){const p=Wf(d.shape[e]);if(!p.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of p){if(c.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);c.set(a,d)}}return new pA({typeName:_s.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:c,...Gs(n)})}}function uO(t,e){const r=$m(t),n=$m(e);if(t===e)return{valid:!0,data:t};if(r===xn.object&&n===xn.object){const c=Ii.objectKeys(e),d=Ii.objectKeys(t).filter(a=>c.indexOf(a)!==-1),p={...t,...e};for(const a of d){const w=uO(t[a],e[a]);if(!w.valid)return{valid:!1};p[a]=w.data}return{valid:!0,data:p}}else if(r===xn.array&&n===xn.array){if(t.length!==e.length)return{valid:!1};const c=[];for(let d=0;d<t.length;d++){const p=t[d],a=e[d],w=uO(p,a);if(!w.valid)return{valid:!1};c.push(w.data)}return{valid:!0,data:c}}else return r===xn.date&&n===xn.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class sE extends Qs{_parse(e){const{status:r,ctx:n}=this._processInputParams(e),c=(d,p)=>{if(lO(d)||lO(p))return ws;const a=uO(d.value,p.value);return a.valid?((cO(d)||cO(p))&&r.dirty(),{status:r.value,value:a.data}):(fn(n,{code:Mr.invalid_intersection_types}),ws)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([d,p])=>c(d,p)):c(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}sE.create=(t,e,r)=>new sE({left:t,right:e,typeName:_s.ZodIntersection,...Gs(r)});class hf extends Qs{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==xn.array)return fn(n,{code:Mr.invalid_type,expected:xn.array,received:n.parsedType}),ws;if(n.data.length<this._def.items.length)return fn(n,{code:Mr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ws;!this._def.rest&&n.data.length>this._def.items.length&&(fn(n,{code:Mr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const d=[...n.data].map((p,a)=>{const w=this._def.items[a]||this._def.rest;return w?w._parse(new df(n,p,n.path,a)):null}).filter(p=>!!p);return n.common.async?Promise.all(d).then(p=>Kl.mergeArray(r,p)):Kl.mergeArray(r,d)}get items(){return this._def.items}rest(e){return new hf({...this._def,rest:e})}}hf.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new hf({items:t,typeName:_s.ZodTuple,rest:null,...Gs(e)})};class iE extends Qs{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==xn.object)return fn(n,{code:Mr.invalid_type,expected:xn.object,received:n.parsedType}),ws;const c=[],d=this._def.keyType,p=this._def.valueType;for(const a in n.data)c.push({key:d._parse(new df(n,a,n.path,a)),value:p._parse(new df(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?Kl.mergeObjectAsync(r,c):Kl.mergeObjectSync(r,c)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof Qs?new iE({keyType:e,valueType:r,typeName:_s.ZodRecord,...Gs(n)}):new iE({keyType:Wd.create(),valueType:e,typeName:_s.ZodRecord,...Gs(r)})}}class AI extends Qs{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==xn.map)return fn(n,{code:Mr.invalid_type,expected:xn.map,received:n.parsedType}),ws;const c=this._def.keyType,d=this._def.valueType,p=[...n.data.entries()].map(([a,w],E)=>({key:c._parse(new df(n,a,n.path,[E,"key"])),value:d._parse(new df(n,w,n.path,[E,"value"]))}));if(n.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const w of p){const E=await w.key,C=await w.value;if(E.status==="aborted"||C.status==="aborted")return ws;(E.status==="dirty"||C.status==="dirty")&&r.dirty(),a.set(E.value,C.value)}return{status:r.value,value:a}})}else{const a=new Map;for(const w of p){const E=w.key,C=w.value;if(E.status==="aborted"||C.status==="aborted")return ws;(E.status==="dirty"||C.status==="dirty")&&r.dirty(),a.set(E.value,C.value)}return{status:r.value,value:a}}}}AI.create=(t,e,r)=>new AI({valueType:e,keyType:t,typeName:_s.ZodMap,...Gs(r)});class Ny extends Qs{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==xn.set)return fn(n,{code:Mr.invalid_type,expected:xn.set,received:n.parsedType}),ws;const c=this._def;c.minSize!==null&&n.data.size<c.minSize.value&&(fn(n,{code:Mr.too_small,minimum:c.minSize.value,type:"set",inclusive:!0,exact:!1,message:c.minSize.message}),r.dirty()),c.maxSize!==null&&n.data.size>c.maxSize.value&&(fn(n,{code:Mr.too_big,maximum:c.maxSize.value,type:"set",inclusive:!0,exact:!1,message:c.maxSize.message}),r.dirty());const d=this._def.valueType;function p(w){const E=new Set;for(const C of w){if(C.status==="aborted")return ws;C.status==="dirty"&&r.dirty(),E.add(C.value)}return{status:r.value,value:E}}const a=[...n.data.values()].map((w,E)=>d._parse(new df(n,w,n.path,E)));return n.common.async?Promise.all(a).then(w=>p(w)):p(a)}min(e,r){return new Ny({...this._def,minSize:{value:e,message:Fn.toString(r)}})}max(e,r){return new Ny({...this._def,maxSize:{value:e,message:Fn.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}Ny.create=(t,e)=>new Ny({valueType:t,minSize:null,maxSize:null,typeName:_s.ZodSet,...Gs(e)});class c0 extends Qs{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==xn.function)return fn(r,{code:Mr.invalid_type,expected:xn.function,received:r.parsedType}),ws;function n(a,w){return jI({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,TI(),V0].filter(E=>!!E),issueData:{code:Mr.invalid_arguments,argumentsError:w}})}function c(a,w){return jI({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,TI(),V0].filter(E=>!!E),issueData:{code:Mr.invalid_return_type,returnTypeError:w}})}const d={errorMap:r.common.contextualErrorMap},p=r.data;if(this._def.returns instanceof $0){const a=this;return Ic(async function(...w){const E=new Mu([]),C=await a._def.args.parseAsync(w,d).catch(B=>{throw E.addIssue(n(w,B)),E}),P=await Reflect.apply(p,this,C);return await a._def.returns._def.type.parseAsync(P,d).catch(B=>{throw E.addIssue(c(P,B)),E})})}else{const a=this;return Ic(function(...w){const E=a._def.args.safeParse(w,d);if(!E.success)throw new Mu([n(w,E.error)]);const C=Reflect.apply(p,this,E.data),P=a._def.returns.safeParse(C,d);if(!P.success)throw new Mu([c(C,P.error)]);return P.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new c0({...this._def,args:hf.create(e).rest(Y_.create())})}returns(e){return new c0({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new c0({args:e||hf.create([]).rest(Y_.create()),returns:r||Y_.create(),typeName:_s.ZodFunction,...Gs(n)})}}class aE extends Qs{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}aE.create=(t,e)=>new aE({getter:t,typeName:_s.ZodLazy,...Gs(e)});class oE extends Qs{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return fn(r,{received:r.data,code:Mr.invalid_literal,expected:this._def.value}),ws}return{status:"valid",value:e.data}}get value(){return this._def.value}}oE.create=(t,e)=>new oE({value:t,typeName:_s.ZodLiteral,...Gs(e)});function GJ(t,e){return new vg({values:t,typeName:_s.ZodEnum,...Gs(e)})}class vg extends Qs{constructor(){super(...arguments),U1.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),n=this._def.values;return fn(r,{expected:Ii.joinValues(n),received:r.parsedType,code:Mr.invalid_type}),ws}if(NI(this,U1)||VJ(this,U1,new Set(this._def.values)),!NI(this,U1).has(e.data)){const r=this._getOrReturnCtx(e),n=this._def.values;return fn(r,{received:r.data,code:Mr.invalid_enum_value,options:n}),ws}return Ic(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return vg.create(e,{...this._def,...r})}exclude(e,r=this._def){return vg.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}}U1=new WeakMap;vg.create=GJ;class lE extends Qs{constructor(){super(...arguments),$1.set(this,void 0)}_parse(e){const r=Ii.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==xn.string&&n.parsedType!==xn.number){const c=Ii.objectValues(r);return fn(n,{expected:Ii.joinValues(c),received:n.parsedType,code:Mr.invalid_type}),ws}if(NI(this,$1)||VJ(this,$1,new Set(Ii.getValidEnumValues(this._def.values))),!NI(this,$1).has(e.data)){const c=Ii.objectValues(r);return fn(n,{received:n.data,code:Mr.invalid_enum_value,options:c}),ws}return Ic(e.data)}get enum(){return this._def.values}}$1=new WeakMap;lE.create=(t,e)=>new lE({values:t,typeName:_s.ZodNativeEnum,...Gs(e)});class $0 extends Qs{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==xn.promise&&r.common.async===!1)return fn(r,{code:Mr.invalid_type,expected:xn.promise,received:r.parsedType}),ws;const n=r.parsedType===xn.promise?r.data:Promise.resolve(r.data);return Ic(n.then(c=>this._def.type.parseAsync(c,{path:r.path,errorMap:r.common.contextualErrorMap})))}}$0.create=(t,e)=>new $0({type:t,typeName:_s.ZodPromise,...Gs(e)});class lh extends Qs{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===_s.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:n}=this._processInputParams(e),c=this._def.effect||null,d={addIssue:p=>{fn(n,p),p.fatal?r.abort():r.dirty()},get path(){return n.path}};if(d.addIssue=d.addIssue.bind(d),c.type==="preprocess"){const p=c.transform(n.data,d);if(n.common.async)return Promise.resolve(p).then(async a=>{if(r.value==="aborted")return ws;const w=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return w.status==="aborted"?ws:w.status==="dirty"||r.value==="dirty"?Hv(w.value):w});{if(r.value==="aborted")return ws;const a=this._def.schema._parseSync({data:p,path:n.path,parent:n});return a.status==="aborted"?ws:a.status==="dirty"||r.value==="dirty"?Hv(a.value):a}}if(c.type==="refinement"){const p=a=>{const w=c.refinement(a,d);if(n.common.async)return Promise.resolve(w);if(w instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ws:(a.status==="dirty"&&r.dirty(),p(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?ws:(a.status==="dirty"&&r.dirty(),p(a.value).then(()=>({status:r.value,value:a.value}))))}if(c.type==="transform")if(n.common.async===!1){const p=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!JS(p))return p;const a=c.transform(p.value,d);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(p=>JS(p)?Promise.resolve(c.transform(p.value,d)).then(a=>({status:r.value,value:a})):p);Ii.assertNever(c)}}lh.create=(t,e,r)=>new lh({schema:t,typeName:_s.ZodEffects,effect:e,...Gs(r)});lh.createWithPreprocess=(t,e,r)=>new lh({schema:e,effect:{type:"preprocess",transform:t},typeName:_s.ZodEffects,...Gs(r)});class nf extends Qs{_parse(e){return this._getType(e)===xn.undefined?Ic(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}nf.create=(t,e)=>new nf({innerType:t,typeName:_s.ZodOptional,...Gs(e)});class wg extends Qs{_parse(e){return this._getType(e)===xn.null?Ic(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}wg.create=(t,e)=>new wg({innerType:t,typeName:_s.ZodNullable,...Gs(e)});class cE extends Qs{_parse(e){const{ctx:r}=this._processInputParams(e);let n=r.data;return r.parsedType===xn.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}cE.create=(t,e)=>new cE({innerType:t,typeName:_s.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Gs(e)});class uE extends Qs{_parse(e){const{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},c=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return QS(c)?c.then(d=>({status:"valid",value:d.status==="valid"?d.value:this._def.catchValue({get error(){return new Mu(n.common.issues)},input:n.data})})):{status:"valid",value:c.status==="valid"?c.value:this._def.catchValue({get error(){return new Mu(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}uE.create=(t,e)=>new uE({innerType:t,typeName:_s.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Gs(e)});class PI extends Qs{_parse(e){if(this._getType(e)!==xn.nan){const n=this._getOrReturnCtx(e);return fn(n,{code:Mr.invalid_type,expected:xn.nan,received:n.parsedType}),ws}return{status:"valid",value:e.data}}}PI.create=t=>new PI({typeName:_s.ZodNaN,...Gs(t)});const cCe=Symbol("zod_brand");class L4 extends Qs{_parse(e){const{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class QE extends Qs{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const d=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return d.status==="aborted"?ws:d.status==="dirty"?(r.dirty(),Hv(d.value)):this._def.out._parseAsync({data:d.value,path:n.path,parent:n})})();{const c=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return c.status==="aborted"?ws:c.status==="dirty"?(r.dirty(),{status:"dirty",value:c.value}):this._def.out._parseSync({data:c.value,path:n.path,parent:n})}}static create(e,r){return new QE({in:e,out:r,typeName:_s.ZodPipeline})}}class dE extends Qs{_parse(e){const r=this._def.innerType._parse(e),n=c=>(JS(c)&&(c.value=Object.freeze(c.value)),c);return QS(r)?r.then(c=>n(c)):n(r)}unwrap(){return this._def.innerType}}dE.create=(t,e)=>new dE({innerType:t,typeName:_s.ZodReadonly,...Gs(e)});function HJ(t,e={},r){return t?U0.create().superRefine((n,c)=>{var d,p;if(!t(n)){const a=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,w=(p=(d=a.fatal)!==null&&d!==void 0?d:r)!==null&&p!==void 0?p:!0,E=typeof a=="string"?{message:a}:a;c.addIssue({code:"custom",...E,fatal:w})}}):U0.create()}const uCe={object:Ha.lazycreate};var _s;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(_s||(_s={}));const dCe=(t,e={message:`Input not instance of ${t.name}`})=>HJ(r=>r instanceof t,e),WJ=Wd.create,ZJ=yg.create,hCe=PI.create,fCe=xg.create,KJ=eE.create,pCe=jy.create,mCe=II.create,gCe=tE.create,_Ce=rE.create,yCe=U0.create,xCe=Y_.create,vCe=Np.create,wCe=CI.create,bCe=Qd.create,SCe=Ha.create,ECe=Ha.strictCreate,TCe=nE.create,jCe=pA.create,NCe=sE.create,ICe=hf.create,CCe=iE.create,ACe=AI.create,PCe=Ny.create,kCe=c0.create,RCe=aE.create,MCe=oE.create,DCe=vg.create,OCe=lE.create,LCe=$0.create,E$=lh.create,FCe=nf.create,zCe=wg.create,BCe=lh.createWithPreprocess,VCe=QE.create,UCe=()=>WJ().optional(),$Ce=()=>ZJ().optional(),qCe=()=>KJ().optional(),GCe={string:t=>Wd.create({...t,coerce:!0}),number:t=>yg.create({...t,coerce:!0}),boolean:t=>eE.create({...t,coerce:!0}),bigint:t=>xg.create({...t,coerce:!0}),date:t=>jy.create({...t,coerce:!0})},HCe=ws;var On=Object.freeze({__proto__:null,defaultErrorMap:V0,setErrorMap:HIe,getErrorMap:TI,makeIssue:jI,EMPTY_PATH:WIe,addIssueToContext:fn,ParseStatus:Kl,INVALID:ws,DIRTY:Hv,OK:Ic,isAborted:lO,isDirty:cO,isValid:JS,isAsync:QS,get util(){return Ii},get objectUtil(){return oO},ZodParsedType:xn,getParsedType:$m,ZodType:Qs,datetimeRegex:qJ,ZodString:Wd,ZodNumber:yg,ZodBigInt:xg,ZodBoolean:eE,ZodDate:jy,ZodSymbol:II,ZodUndefined:tE,ZodNull:rE,ZodAny:U0,ZodUnknown:Y_,ZodNever:Np,ZodVoid:CI,ZodArray:Qd,ZodObject:Ha,ZodUnion:nE,ZodDiscriminatedUnion:pA,ZodIntersection:sE,ZodTuple:hf,ZodRecord:iE,ZodMap:AI,ZodSet:Ny,ZodFunction:c0,ZodLazy:aE,ZodLiteral:oE,ZodEnum:vg,ZodNativeEnum:lE,ZodPromise:$0,ZodEffects:lh,ZodTransformer:lh,ZodOptional:nf,ZodNullable:wg,ZodDefault:cE,ZodCatch:uE,ZodNaN:PI,BRAND:cCe,ZodBranded:L4,ZodPipeline:QE,ZodReadonly:dE,custom:HJ,Schema:Qs,ZodSchema:Qs,late:uCe,get ZodFirstPartyTypeKind(){return _s},coerce:GCe,any:yCe,array:bCe,bigint:fCe,boolean:KJ,date:pCe,discriminatedUnion:jCe,effect:E$,enum:DCe,function:kCe,instanceof:dCe,intersection:NCe,lazy:RCe,literal:MCe,map:ACe,nan:hCe,nativeEnum:OCe,never:vCe,null:_Ce,nullable:zCe,number:ZJ,object:SCe,oboolean:qCe,onumber:$Ce,optional:FCe,ostring:UCe,pipeline:VCe,preprocess:BCe,promise:LCe,record:CCe,set:PCe,strictObject:ECe,string:WJ,symbol:mCe,transformer:E$,tuple:ICe,undefined:gCe,union:TCe,unknown:xCe,void:wCe,NEVER:HCe,ZodIssueCode:Mr,quotelessJson:GIe,ZodError:Mu}),XJ=["PageUp","PageDown"],YJ=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],JJ={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},xw="Slider",[dO,WCe,ZCe]=FE(xw),[QJ,bLe]=hd(xw,[ZCe]),[KCe,mA]=QJ(xw),eQ=z.forwardRef((t,e)=>{const{name:r,min:n=0,max:c=100,step:d=1,orientation:p="horizontal",disabled:a=!1,minStepsBetweenThumbs:w=0,defaultValue:E=[n],value:C,onValueChange:P=()=>{},onValueCommit:R=()=>{},inverted:B=!1,form:V,...W}=t,K=z.useRef(new Set),Z=z.useRef(0),X=p==="horizontal"?XCe:YCe,[Q=[],re]=ud({prop:C,defaultProp:E,onChange:Se=>{var J;(J=[...K.current][Z.current])==null||J.focus(),P(Se)}}),ve=z.useRef(Q);function pe(Se){const le=rAe(Q,Se);ce(Se,le)}function ue(Se){ce(Se,Z.current)}function ge(){const Se=ve.current[Z.current];Q[Z.current]!==Se&&R(Q)}function ce(Se,le,{commit:J}={commit:!1}){const ke=aAe(d),Ze=oAe(Math.round((Se-n)/d)*d+n,ke),Xe=YS(Ze,[n,c]);re((qe=[])=>{const $e=eAe(qe,Xe,le);if(iAe($e,w*d)){Z.current=$e.indexOf(Xe);const st=String($e)!==String(qe);return st&&J&&R($e),st?$e:qe}else return qe})}return i.jsx(KCe,{scope:t.__scopeSlider,name:r,disabled:a,min:n,max:c,valueIndexToChangeRef:Z,thumbs:K.current,values:Q,orientation:p,form:V,children:i.jsx(dO.Provider,{scope:t.__scopeSlider,children:i.jsx(dO.Slot,{scope:t.__scopeSlider,children:i.jsx(X,{"aria-disabled":a,"data-disabled":a?"":void 0,...W,ref:e,onPointerDown:tn(W.onPointerDown,()=>{a||(ve.current=Q)}),min:n,max:c,inverted:B,onSlideStart:a?void 0:pe,onSlideMove:a?void 0:ue,onSlideEnd:a?void 0:ge,onHomeKeyDown:()=>!a&&ce(n,0,{commit:!0}),onEndKeyDown:()=>!a&&ce(c,Q.length-1,{commit:!0}),onStepKeyDown:({event:Se,direction:le})=>{if(!a){const Ze=XJ.includes(Se.key)||Se.shiftKey&&YJ.includes(Se.key)?10:1,Xe=Z.current,qe=Q[Xe],$e=d*Ze*le;ce(qe+$e,Xe,{commit:!0})}}})})})})});eQ.displayName=xw;var[tQ,rQ]=QJ(xw,{startEdge:"left",endEdge:"right",size:"width",direction:1}),XCe=z.forwardRef((t,e)=>{const{min:r,max:n,dir:c,inverted:d,onSlideStart:p,onSlideMove:a,onSlideEnd:w,onStepKeyDown:E,...C}=t,[P,R]=z.useState(null),B=Fs(e,X=>R(X)),V=z.useRef(),W=Fy(c),K=W==="ltr",Z=K&&!d||!K&&d;function $(X){const Q=V.current||P.getBoundingClientRect(),re=[0,Q.width],pe=F4(re,Z?[r,n]:[n,r]);return V.current=Q,pe(X-Q.left)}return i.jsx(tQ,{scope:t.__scopeSlider,startEdge:Z?"left":"right",endEdge:Z?"right":"left",direction:Z?1:-1,size:"width",children:i.jsx(nQ,{dir:W,"data-orientation":"horizontal",...C,ref:B,style:{...C.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:X=>{const Q=$(X.clientX);p==null||p(Q)},onSlideMove:X=>{const Q=$(X.clientX);a==null||a(Q)},onSlideEnd:()=>{V.current=void 0,w==null||w()},onStepKeyDown:X=>{const re=JJ[Z?"from-left":"from-right"].includes(X.key);E==null||E({event:X,direction:re?-1:1})}})})}),YCe=z.forwardRef((t,e)=>{const{min:r,max:n,inverted:c,onSlideStart:d,onSlideMove:p,onSlideEnd:a,onStepKeyDown:w,...E}=t,C=z.useRef(null),P=Fs(e,C),R=z.useRef(),B=!c;function V(W){const K=R.current||C.current.getBoundingClientRect(),Z=[0,K.height],X=F4(Z,B?[n,r]:[r,n]);return R.current=K,X(W-K.top)}return i.jsx(tQ,{scope:t.__scopeSlider,startEdge:B?"bottom":"top",endEdge:B?"top":"bottom",size:"height",direction:B?1:-1,children:i.jsx(nQ,{"data-orientation":"vertical",...E,ref:P,style:{...E.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:W=>{const K=V(W.clientY);d==null||d(K)},onSlideMove:W=>{const K=V(W.clientY);p==null||p(K)},onSlideEnd:()=>{R.current=void 0,a==null||a()},onStepKeyDown:W=>{const Z=JJ[B?"from-bottom":"from-top"].includes(W.key);w==null||w({event:W,direction:Z?-1:1})}})})}),nQ=z.forwardRef((t,e)=>{const{__scopeSlider:r,onSlideStart:n,onSlideMove:c,onSlideEnd:d,onHomeKeyDown:p,onEndKeyDown:a,onStepKeyDown:w,...E}=t,C=mA(xw,r);return i.jsx(Pn.span,{...E,ref:e,onKeyDown:tn(t.onKeyDown,P=>{P.key==="Home"?(p(P),P.preventDefault()):P.key==="End"?(a(P),P.preventDefault()):XJ.concat(YJ).includes(P.key)&&(w(P),P.preventDefault())}),onPointerDown:tn(t.onPointerDown,P=>{const R=P.target;R.setPointerCapture(P.pointerId),P.preventDefault(),C.thumbs.has(R)?R.focus():n(P)}),onPointerMove:tn(t.onPointerMove,P=>{P.target.hasPointerCapture(P.pointerId)&&c(P)}),onPointerUp:tn(t.onPointerUp,P=>{const R=P.target;R.hasPointerCapture(P.pointerId)&&(R.releasePointerCapture(P.pointerId),d(P))})})}),sQ="SliderTrack",iQ=z.forwardRef((t,e)=>{const{__scopeSlider:r,...n}=t,c=mA(sQ,r);return i.jsx(Pn.span,{"data-disabled":c.disabled?"":void 0,"data-orientation":c.orientation,...n,ref:e})});iQ.displayName=sQ;var hO="SliderRange",aQ=z.forwardRef((t,e)=>{const{__scopeSlider:r,...n}=t,c=mA(hO,r),d=rQ(hO,r),p=z.useRef(null),a=Fs(e,p),w=c.values.length,E=c.values.map(R=>lQ(R,c.min,c.max)),C=w>1?Math.min(...E):0,P=100-Math.max(...E);return i.jsx(Pn.span,{"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,...n,ref:a,style:{...t.style,[d.startEdge]:C+"%",[d.endEdge]:P+"%"}})});aQ.displayName=hO;var fO="SliderThumb",oQ=z.forwardRef((t,e)=>{const r=WCe(t.__scopeSlider),[n,c]=z.useState(null),d=Fs(e,a=>c(a)),p=z.useMemo(()=>n?r().findIndex(a=>a.ref.current===n):-1,[r,n]);return i.jsx(JCe,{...t,ref:d,index:p})}),JCe=z.forwardRef((t,e)=>{const{__scopeSlider:r,index:n,name:c,...d}=t,p=mA(fO,r),a=rQ(fO,r),[w,E]=z.useState(null),C=Fs(e,$=>E($)),P=w?p.form||!!w.closest("form"):!0,R=J3(w),B=p.values[n],V=B===void 0?0:lQ(B,p.min,p.max),W=tAe(n,p.values.length),K=R==null?void 0:R[a.size],Z=K?nAe(K,V,a.direction):0;return z.useEffect(()=>{if(w)return p.thumbs.add(w),()=>{p.thumbs.delete(w)}},[w,p.thumbs]),i.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${V}% + ${Z}px)`},children:[i.jsx(dO.ItemSlot,{scope:t.__scopeSlider,children:i.jsx(Pn.span,{role:"slider","aria-label":t["aria-label"]||W,"aria-valuemin":p.min,"aria-valuenow":B,"aria-valuemax":p.max,"aria-orientation":p.orientation,"data-orientation":p.orientation,"data-disabled":p.disabled?"":void 0,tabIndex:p.disabled?void 0:0,...d,ref:C,style:B===void 0?{display:"none"}:t.style,onFocus:tn(t.onFocus,()=>{p.valueIndexToChangeRef.current=n})})}),P&&i.jsx(QCe,{name:c??(p.name?p.name+(p.values.length>1?"[]":""):void 0),form:p.form,value:B},n)]})});oQ.displayName=fO;var QCe=t=>{const{value:e,...r}=t,n=z.useRef(null),c=y4(e);return z.useEffect(()=>{const d=n.current,p=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(p,"value").set;if(c!==e&&w){const E=new Event("input",{bubbles:!0});w.call(d,e),d.dispatchEvent(E)}},[c,e]),i.jsx("input",{style:{display:"none"},...r,ref:n,defaultValue:e})};function eAe(t=[],e,r){const n=[...t];return n[r]=e,n.sort((c,d)=>c-d)}function lQ(t,e,r){const d=100/(r-e)*(t-e);return YS(d,[0,100])}function tAe(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function rAe(t,e){if(t.length===1)return 0;const r=t.map(c=>Math.abs(c-e)),n=Math.min(...r);return r.indexOf(n)}function nAe(t,e,r){const n=t/2,d=F4([0,50],[0,n]);return(n-d(e)*r)*r}function sAe(t){return t.slice(0,-1).map((e,r)=>t[r+1]-e)}function iAe(t,e){if(e>0){const r=sAe(t);return Math.min(...r)>=e}return!0}function F4(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(t[1]-t[0]);return e[0]+n*(r-t[0])}}function aAe(t){return(String(t).split(".")[1]||"").length}function oAe(t,e){const r=Math.pow(10,e);return Math.round(t*r)/r}var cQ=eQ,lAe=iQ,cAe=aQ,uAe=oQ;const uQ=z.forwardRef(({className:t,...e},r)=>i.jsxs(cQ,{ref:r,className:kn("relative flex w-full touch-none select-none items-center",t),...e,children:[i.jsx(lAe,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:i.jsx(cAe,{className:"absolute h-full bg-primary"})}),i.jsx(uAe,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));uQ.displayName=cQ.displayName;var vw=hAe,dAe=Object.prototype.hasOwnProperty;function hAe(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var n in r)dAe.call(r,n)&&(t[n]=r[n])}return t}var dQ={exports:{}};(function(t,e){(function(){var r={};t.exports=r,r.simpleFilter=function(n,c){return c.filter(function(d){return r.test(n,d)})},r.test=function(n,c){return r.match(n,c)!==null},r.match=function(n,c,d){d=d||{};var p=0,a=[],w=c.length,E=0,C=0,P=d.pre||"",R=d.post||"",B=d.caseSensitive&&c||c.toLowerCase(),V;n=d.caseSensitive&&n||n.toLowerCase();for(var W=0;W<w;W++)V=c[W],B[W]===n[p]?(V=P+V+R,p+=1,C+=1+C):C=0,E+=C,a[a.length]=V;return p===n.length?(E=B===n?1/0:E,{rendered:a.join(""),score:E}):null},r.filter=function(n,c,d){return!c||c.length===0?[]:typeof n!="string"?c:(d=d||{},c.reduce(function(p,a,w,E){var C=a;d.extract&&(C=d.extract(a));var P=r.match(n,C,d);return P!=null&&(p[p.length]={string:P.rendered,score:P.score,index:w,original:a}),p},[]).sort(function(p,a){var w=a.score-p.score;return w||p.index-a.index}))}})()})(dQ);var fAe=dQ.exports,ou=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};ou.prototype.show=function(){this.element.style.display="block"};ou.prototype.hide=function(){this.element.style.display="none"};ou.prototype.add=function(t){this.items.push(t)};ou.prototype.clear=function(){this.items=[],this.active=0};ou.prototype.isEmpty=function(){return!this.items.length};ou.prototype.isVisible=function(){return this.element.style.display==="block"};ou.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};ou.prototype.drawItem=function(t,e){var r=document.createElement("li"),n=document.createElement("a");e&&(r.className+=" active"),n.innerHTML=t.string,r.appendChild(n),this.element.appendChild(r),r.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),r.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))};ou.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};ou.prototype.move=function(t){this.active=t,this.draw()};ou.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};ou.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};ou.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()};var pAe=ou,mAe=vw,gAe=fAe,_Ae=pAe,Yl=function(t,e,r){return r=r||{},this.options=mAe({minLength:2,limit:5,filter:!0,hideOnBlur:!0},r),this.el=t,this.data=e||[],this.list=new _Ae(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Yl.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};Yl.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Yl.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Yl.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(t.target.value)},100)}};Yl.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var r=0;r<e.length&&(this.list.add(e[r]),r!==this.options.limit-1);r++);this.list.draw()}).bind(this))};Yl.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Yl.prototype.update=function(t){this.data=t,this.handleKeyUp()};Yl.prototype.clear=function(){this.data=[],this.list.clear()};Yl.prototype.normalize=function(t){return t=t.toLowerCase(),t};Yl.prototype.match=function(t,e){return t.indexOf(e)>-1};Yl.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")};Yl.prototype.getCandidates=function(t){var e={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},r;this.options.filter?(r=gAe.filter(this.query,this.data,e),r=r.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):r=this.data.map((function(n){var c=this.render(n);return{original:n,string:c}}).bind(this)),t(r)};Yl.prototype.getItemValue=function(t){return t};Yl.prototype.render=function(t,e){if(e)return e;for(var r=t.original?this.getItemValue(t.original):this.getItemValue(t),n=this.normalize(r),c=n.lastIndexOf(this.query);c>-1;){var d=c+this.query.length;r=r.slice(0,c)+"<strong>"+r.slice(c,d)+"</strong>"+r.slice(d),c=n.slice(0,c).lastIndexOf(this.query)}return r};Yl.prototype.renderError=function(t){this.list.drawError(t)};var yAe=Yl,hQ=yAe,xAe=hQ;typeof window<"u"&&(window.Suggestions=hQ);var vAe="Expected a function",T$=NaN,wAe="[object Symbol]",bAe=/^\s+|\s+$/g,SAe=/^[-+]0x[0-9a-f]+$/i,EAe=/^0b[01]+$/i,TAe=/^0o[0-7]+$/i,jAe=parseInt,NAe=typeof Ya=="object"&&Ya&&Ya.Object===Object&&Ya,IAe=typeof self=="object"&&self&&self.Object===Object&&self,CAe=NAe||IAe||Function("return this")(),AAe=Object.prototype,PAe=AAe.toString,kAe=Math.max,RAe=Math.min,KR=function(){return CAe.Date.now()};function MAe(t,e,r){var n,c,d,p,a,w,E=0,C=!1,P=!1,R=!0;if(typeof t!="function")throw new TypeError(vAe);e=j$(e)||0,pO(r)&&(C=!!r.leading,P="maxWait"in r,d=P?kAe(j$(r.maxWait)||0,e):d,R="trailing"in r?!!r.trailing:R);function B(ve){var pe=n,ue=c;return n=c=void 0,E=ve,p=t.apply(ue,pe),p}function V(ve){return E=ve,a=setTimeout(Z,e),C?B(ve):p}function W(ve){var pe=ve-w,ue=ve-E,ge=e-pe;return P?RAe(ge,d-ue):ge}function K(ve){var pe=ve-w,ue=ve-E;return w===void 0||pe>=e||pe<0||P&&ue>=d}function Z(){var ve=KR();if(K(ve))return $(ve);a=setTimeout(Z,W(ve))}function $(ve){return a=void 0,R&&n?B(ve):(n=c=void 0,p)}function X(){a!==void 0&&clearTimeout(a),E=0,n=w=c=a=void 0}function Q(){return a===void 0?p:$(KR())}function re(){var ve=KR(),pe=K(ve);if(n=arguments,c=this,w=ve,pe){if(a===void 0)return V(w);if(P)return a=setTimeout(Z,e),B(w)}return a===void 0&&(a=setTimeout(Z,e)),p}return re.cancel=X,re.flush=Q,re}function pO(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function DAe(t){return!!t&&typeof t=="object"}function OAe(t){return typeof t=="symbol"||DAe(t)&&PAe.call(t)==wAe}function j$(t){if(typeof t=="number")return t;if(OAe(t))return T$;if(pO(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=pO(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(bAe,"");var r=EAe.test(t);return r||TAe.test(t)?jAe(t.slice(2),r?2:8):SAe.test(t)?T$:+t}var LAe=MAe,z4={exports:{}},u0=typeof Reflect=="object"?Reflect:null,N$=u0&&typeof u0.apply=="function"?u0.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},cN;u0&&typeof u0.ownKeys=="function"?cN=u0.ownKeys:Object.getOwnPropertySymbols?cN=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:cN=function(e){return Object.getOwnPropertyNames(e)};function FAe(t){console&&console.warn&&console.warn(t)}var fQ=Number.isNaN||function(e){return e!==e};function ca(){ca.init.call(this)}z4.exports=ca;z4.exports.once=UAe;ca.EventEmitter=ca;ca.prototype._events=void 0;ca.prototype._eventsCount=0;ca.prototype._maxListeners=void 0;var I$=10;function gA(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(ca,"defaultMaxListeners",{enumerable:!0,get:function(){return I$},set:function(t){if(typeof t!="number"||t<0||fQ(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");I$=t}});ca.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ca.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||fQ(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function pQ(t){return t._maxListeners===void 0?ca.defaultMaxListeners:t._maxListeners}ca.prototype.getMaxListeners=function(){return pQ(this)};ca.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var c=e==="error",d=this._events;if(d!==void 0)c=c&&d.error===void 0;else if(!c)return!1;if(c){var p;if(r.length>0&&(p=r[0]),p instanceof Error)throw p;var a=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw a.context=p,a}var w=d[e];if(w===void 0)return!1;if(typeof w=="function")N$(w,this,r);else for(var E=w.length,C=xQ(w,E),n=0;n<E;++n)N$(C[n],this,r);return!0};function mQ(t,e,r,n){var c,d,p;if(gA(r),d=t._events,d===void 0?(d=t._events=Object.create(null),t._eventsCount=0):(d.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),d=t._events),p=d[e]),p===void 0)p=d[e]=r,++t._eventsCount;else if(typeof p=="function"?p=d[e]=n?[r,p]:[p,r]:n?p.unshift(r):p.push(r),c=pQ(t),c>0&&p.length>c&&!p.warned){p.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=p.length,FAe(a)}return t}ca.prototype.addListener=function(e,r){return mQ(this,e,r,!1)};ca.prototype.on=ca.prototype.addListener;ca.prototype.prependListener=function(e,r){return mQ(this,e,r,!0)};function zAe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function gQ(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},c=zAe.bind(n);return c.listener=r,n.wrapFn=c,c}ca.prototype.once=function(e,r){return gA(r),this.on(e,gQ(this,e,r)),this};ca.prototype.prependOnceListener=function(e,r){return gA(r),this.prependListener(e,gQ(this,e,r)),this};ca.prototype.removeListener=function(e,r){var n,c,d,p,a;if(gA(r),c=this._events,c===void 0)return this;if(n=c[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete c[e],c.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(d=-1,p=n.length-1;p>=0;p--)if(n[p]===r||n[p].listener===r){a=n[p].listener,d=p;break}if(d<0)return this;d===0?n.shift():BAe(n,d),n.length===1&&(c[e]=n[0]),c.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};ca.prototype.off=ca.prototype.removeListener;ca.prototype.removeAllListeners=function(e){var r,n,c;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var d=Object.keys(n),p;for(c=0;c<d.length;++c)p=d[c],p!=="removeListener"&&this.removeAllListeners(p);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(c=r.length-1;c>=0;c--)this.removeListener(e,r[c]);return this};function _Q(t,e,r){var n=t._events;if(n===void 0)return[];var c=n[e];return c===void 0?[]:typeof c=="function"?r?[c.listener||c]:[c]:r?VAe(c):xQ(c,c.length)}ca.prototype.listeners=function(e){return _Q(this,e,!0)};ca.prototype.rawListeners=function(e){return _Q(this,e,!1)};ca.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):yQ.call(t,e)};ca.prototype.listenerCount=yQ;function yQ(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ca.prototype.eventNames=function(){return this._eventsCount>0?cN(this._events):[]};function xQ(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function BAe(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function VAe(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function UAe(t,e){return new Promise(function(r,n){function c(p){t.removeListener(e,d),n(p)}function d(){typeof t.removeListener=="function"&&t.removeListener("error",c),r([].slice.call(arguments))}vQ(t,e,d,{once:!0}),e!=="error"&&$Ae(t,c,{once:!0})})}function $Ae(t,e,r){typeof t.on=="function"&&vQ(t,"error",e,r)}function vQ(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function c(d){n.once&&t.removeEventListener(e,c),r(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var qAe=z4.exports,GAe={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function HAe(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function WAe(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var r=e[1],n=e[2].split(";"),c=null,d=n.reduce(function(p,a){var w=HAe(a);return w?w.key==="rel"?(c||(c=w.value),p):(p[w.key]=w.value,p):p},{});return c?{url:r,rel:c,params:d}:null}function ZAe(t){return t?t.split(/,\s*</).reduce(function(e,r){var n=WAe(r);if(!n)return e;var c=n.rel.split(/\s+/);return c.forEach(function(d){e[d]||(e[d]={url:n.url,params:n.params})}),e},{}):{}}var KAe=ZAe,XAe=KAe;function B4(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch{this.body=e.body}this.links=XAe(this.headers.link)}B4.prototype.hasNextPage=function(){return!!this.links.next};B4.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var YAe=B4,_A={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},C$=_A;function JAe(t){var e=t.type||C$.ERROR_HTTP,r;if(t.body)try{r=JSON.parse(t.body)}catch{r=t.body}else r=null;var n=t.message||null;n||(typeof r=="string"?n=r:r&&typeof r.message=="string"?n=r.message:e===C$.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=e,this.statusCode=t.statusCode||null,this.request=t.request,this.body=r}var QAe=JAe;function ePe(t){var e=t.indexOf(":"),r=t.substring(0,e).trim().toLowerCase(),n=t.substring(e+1).trim();return{name:r,value:n}}function tPe(t){var e={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(r){var n=ePe(r);e[n.name]=n.value}),e}var rPe=tPe,nPe=YAe,A$=QAe,XR=_A,sPe=rPe,kI={};function iPe(t){var e=kI[t.id];e&&(e.abort(),delete kI[t.id])}function aPe(t,e){return new nPe(t,{body:e.response,headers:sPe(e.getAllResponseHeaders()),statusCode:e.status})}function P$(t){var e=t.total,r=t.loaded,n=100*r/e;return{total:e,transferred:r,percent:n}}function wQ(t,e){return new Promise(function(r,n){e.onprogress=function(p){t.emitter.emit(XR.EVENT_PROGRESS_DOWNLOAD,P$(p))};var c=t.file;c&&(e.upload.onprogress=function(p){t.emitter.emit(XR.EVENT_PROGRESS_UPLOAD,P$(p))}),e.onerror=function(p){n(p)},e.onabort=function(){var p=new A$({request:t,type:XR.ERROR_REQUEST_ABORTED});n(p)},e.onload=function(){if(delete kI[t.id],e.status<200||e.status>=400){var p=new A$({request:t,body:e.response,statusCode:e.status});n(p);return}r(e)};var d=t.body;typeof d=="string"?e.send(d):d?e.send(JSON.stringify(d)):c?e.send(c):e.send(),kI[t.id]=e}).then(function(r){return aPe(t,r)})}function bQ(t,e){var r=t.url(e),n=new window.XMLHttpRequest;return n.open(t.method,r),Object.keys(t.headers).forEach(function(c){n.setRequestHeader(c,t.headers[c])}),n}function oPe(t){return Promise.resolve().then(function(){var e=bQ(t,t.client.accessToken);return wQ(t,e)})}var lPe={browserAbort:iPe,sendRequestXhr:wQ,browserSend:oPe,createRequestXhr:bQ},RI={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */RI.exports;(function(t,e){(function(r){var n=e,c=t&&t.exports==n&&t,d=typeof Ya=="object"&&Ya;(d.global===d||d.window===d)&&(r=d);var p=function(V){this.message=V};p.prototype=new Error,p.prototype.name="InvalidCharacterError";var a=function(V){throw new p(V)},w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",E=/[\t\n\f\r ]/g,C=function(V){V=String(V).replace(E,"");var W=V.length;W%4==0&&(V=V.replace(/==?$/,""),W=V.length),(W%4==1||/[^+a-zA-Z0-9/]/.test(V))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var K=0,Z,$,X="",Q=-1;++Q<W;)$=w.indexOf(V.charAt(Q)),Z=K%4?Z*64+$:$,K++%4&&(X+=String.fromCharCode(255&Z>>(-2*K&6)));return X},P=function(V){V=String(V),/[^\0-\xFF]/.test(V)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var W=V.length%3,K="",Z=-1,$,X,Q,re,ve=V.length-W;++Z<ve;)$=V.charCodeAt(Z)<<16,X=V.charCodeAt(++Z)<<8,Q=V.charCodeAt(++Z),re=$+X+Q,K+=w.charAt(re>>18&63)+w.charAt(re>>12&63)+w.charAt(re>>6&63)+w.charAt(re&63);return W==2?($=V.charCodeAt(Z)<<8,X=V.charCodeAt(++Z),re=$+X,K+=w.charAt(re>>10)+w.charAt(re>>4&63)+w.charAt(re<<2&63)+"="):W==1&&(re=V.charCodeAt(Z),K+=w.charAt(re>>2)+w.charAt(re<<4&63)+"=="),K},R={encode:P,decode:C,version:"0.1.0"};if(n&&!n.nodeType)if(c)c.exports=R;else for(var B in R)R.hasOwnProperty(B)&&(n[B]=R[B]);else r.base64=R})(Ya)})(RI,RI.exports);var cPe=RI.exports,uPe=cPe,YR={};function dPe(t){if(YR[t])return YR[t];var e=t.split("."),r=e[0],n=e[1];if(!n)throw new Error("Invalid token");var c=hPe(n),d={usage:r,user:c.u};return T_(c,"a")&&(d.authorization=c.a),T_(c,"exp")&&(d.expires=c.exp*1e3),T_(c,"iat")&&(d.created=c.iat*1e3),T_(c,"scopes")&&(d.scopes=c.scopes),T_(c,"client")&&(d.client=c.client),T_(c,"ll")&&(d.lastLogin=c.ll),T_(c,"iu")&&(d.impersonator=c.iu),YR[t]=d,d}function hPe(t){try{return JSON.parse(uPe.decode(t))}catch{throw new Error("Invalid token")}}function T_(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var SQ=dPe,EQ={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function c(w,E,C){this.fn=w,this.context=E,this.once=C||!1}function d(w,E,C,P,R){if(typeof C!="function")throw new TypeError("The listener must be a function");var B=new c(C,P||w,R),V=r?r+E:E;return w._events[V]?w._events[V].fn?w._events[V]=[w._events[V],B]:w._events[V].push(B):(w._events[V]=B,w._eventsCount++),w}function p(w,E){--w._eventsCount===0?w._events=new n:delete w._events[E]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var E=[],C,P;if(this._eventsCount===0)return E;for(P in C=this._events)e.call(C,P)&&E.push(r?P.slice(1):P);return Object.getOwnPropertySymbols?E.concat(Object.getOwnPropertySymbols(C)):E},a.prototype.listeners=function(E){var C=r?r+E:E,P=this._events[C];if(!P)return[];if(P.fn)return[P.fn];for(var R=0,B=P.length,V=new Array(B);R<B;R++)V[R]=P[R].fn;return V},a.prototype.listenerCount=function(E){var C=r?r+E:E,P=this._events[C];return P?P.fn?1:P.length:0},a.prototype.emit=function(E,C,P,R,B,V){var W=r?r+E:E;if(!this._events[W])return!1;var K=this._events[W],Z=arguments.length,$,X;if(K.fn){switch(K.once&&this.removeListener(E,K.fn,void 0,!0),Z){case 1:return K.fn.call(K.context),!0;case 2:return K.fn.call(K.context,C),!0;case 3:return K.fn.call(K.context,C,P),!0;case 4:return K.fn.call(K.context,C,P,R),!0;case 5:return K.fn.call(K.context,C,P,R,B),!0;case 6:return K.fn.call(K.context,C,P,R,B,V),!0}for(X=1,$=new Array(Z-1);X<Z;X++)$[X-1]=arguments[X];K.fn.apply(K.context,$)}else{var Q=K.length,re;for(X=0;X<Q;X++)switch(K[X].once&&this.removeListener(E,K[X].fn,void 0,!0),Z){case 1:K[X].fn.call(K[X].context);break;case 2:K[X].fn.call(K[X].context,C);break;case 3:K[X].fn.call(K[X].context,C,P);break;case 4:K[X].fn.call(K[X].context,C,P,R);break;default:if(!$)for(re=1,$=new Array(Z-1);re<Z;re++)$[re-1]=arguments[re];K[X].fn.apply(K[X].context,$)}}return!0},a.prototype.on=function(E,C,P){return d(this,E,C,P,!1)},a.prototype.once=function(E,C,P){return d(this,E,C,P,!0)},a.prototype.removeListener=function(E,C,P,R){var B=r?r+E:E;if(!this._events[B])return this;if(!C)return p(this,B),this;var V=this._events[B];if(V.fn)V.fn===C&&(!R||V.once)&&(!P||V.context===P)&&p(this,B);else{for(var W=0,K=[],Z=V.length;W<Z;W++)(V[W].fn!==C||R&&!V[W].once||P&&V[W].context!==P)&&K.push(V[W]);K.length?this._events[B]=K.length===1?K[0]:K:p(this,B)}return this},a.prototype.removeAllListeners=function(E){var C;return E?(C=r?r+E:E,this._events[C]&&p(this,C)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a})(EQ);var fPe=EQ.exports;function pPe(t){return t.map(encodeURIComponent).join(",")}function TQ(t){return Array.isArray(t)?pPe(t):encodeURIComponent(String(t))}function jQ(t,e,r){if(r===!1||r===null)return t;var n=/\?/.test(t)?"&":"?",c=encodeURIComponent(e);return r!==void 0&&r!==""&&r!==!0&&(c+="="+TQ(r)),""+t+n+c}function mPe(t,e){if(!e)return t;var r=t;return Object.keys(e).forEach(function(n){var c=e[n];c!==void 0&&(Array.isArray(c)&&(c=c.filter(function(d){return d!=null}).join(",")),r=jQ(r,n,c))}),r}function gPe(t,e){if(!e||t.slice(0,4)==="http")return t;var r=t[0]==="/"?"":"/";return""+e.replace(/\/$/,"")+r+t}function _Pe(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,function(r,n){var c=e[n];if(c===void 0)throw new Error("Unspecified route parameter "+n);var d=TQ(c);return"/"+d}):t}var yPe={appendQueryObject:mPe,appendQueryParam:jQ,prependOrigin:gPe,interpolateRouteParams:_Pe},xPe=SQ,V4=vw,vPe=fPe,jj=yPe,k$=_A,wPe=1;function bg(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={};e.body&&(r["content-type"]="application/json");var n=V4(r,e.headers),c=Object.keys(n).reduce(function(d,p){return d[p.toLowerCase()]=n[p],d},{});this.id=wPe++,this._options=e,this.emitter=new vPe,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=c}bg.prototype.url=function(e){var r=jj.prependOrigin(this.path,this.origin);r=jj.appendQueryObject(r,this.query);var n=this.params,c=e??this.client.accessToken;if(c){r=jj.appendQueryParam(r,"access_token",c);var d=xPe(c).user;n=V4({ownerId:d},n)}return r=jj.interpolateRouteParams(r,n),r};bg.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(r){return e.response=r,e.emitter.emit(k$.EVENT_RESPONSE,r),r},function(r){throw e.error=r,e.emitter.emit(k$.EVENT_ERROR,r),r})};bg.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};bg.prototype.eachPage=function(e){var r=this;function n(p){function a(){delete r._nextPageRequest;var w=p.nextPage();w&&(r._nextPageRequest=w,d(w))}e(null,p,a)}function c(p){e(p,null,function(){})}function d(p){p.send().then(n,c)}d(this)};bg.prototype.clone=function(){return this._extend()};bg.prototype._extend=function(e){var r=V4(this._options,e);return new bg(this.client,r)};var bPe=bg,SPe=SQ,EPe=bPe,TPe=_A;function NQ(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");SPe(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||TPe.API_ORIGIN}NQ.prototype.createRequest=function(e){return new EPe(this,e)};var IQ=NQ,CQ=lPe,AQ=IQ;function q0(t){AQ.call(this,t)}q0.prototype=Object.create(AQ.prototype);q0.prototype.constructor=q0;q0.prototype.sendRequest=CQ.browserSend;q0.prototype.abortRequest=CQ.browserAbort;function jPe(t){return new q0(t)}var PQ=jPe,NPe=PQ,IPe=NPe,CPe=Object.prototype.toString,APe=function(t){var e;return CPe.call(t)==="[object Object]"&&(e=Object.getPrototypeOf(t),e===null||e===Object.getPrototypeOf({}))},PPe=APe,kPe=vw,kQ="value",JR=`
  `,wa={};wa.assert=function(t,e){return e=e||{},function(r){var n=Sg(t,r);if(n){var c=U4(n,e);throw e.apiName&&(c=e.apiName+": "+c),new Error(c)}}};wa.shape=function(e){var r=OPe(e);return function(c){var d=Sg(wa.plainObject,c);if(d)return d;for(var p,a,w=[],E=0;E<r.length;E++)p=r[E].key,a=r[E].value,d=Sg(a,c[p]),d&&w.push([p].concat(d));return w.length<2?w[0]:function(C){w=w.map(function(B){var V=B[0],W=U4(B,C).split(`
`).join(JR);return"- "+V+": "+W});var P=C.path.join("."),R=P===kQ?"":" of "+P;return"The following properties"+R+" have invalid values:"+JR+w.join(JR)}}};wa.strictShape=function(e){var r=wa.shape(e);return function(c){var d=r(c);if(d)return d;var p=Object.keys(c).reduce(function(a,w){return e[w]===void 0&&a.push(w),a},[]);if(p.length!==0)return function(){return"The following keys are invalid: "+p.join(", ")}}};wa.arrayOf=function(e){return RQ(e)};wa.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return RQ(e)};function RQ(t){var e=Array.isArray(t),r=function(n){return e?t[n]:t};return function(c){var d=Sg(wa.plainArray,c);if(d)return d;if(e&&c.length!==t.length)return"an array with "+t.length+" items";for(var p=0;p<c.length;p++)if(d=Sg(r(p),c[p]),d)return[p].concat(d)}}wa.required=function(e){function r(n){return n==null?function(c){return MQ(c,DQ(c.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return r.__required=!0,r};wa.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(n){var c=e.map(function(d){return Sg(d,n)}).filter(Boolean);if(c.length===e.length)return c.every(function(d){return d.length===1&&typeof d[0]=="string"})?RPe(c.map(function(d){return d[0]})):c.reduce(function(d,p){return p.length>d.length?p:d})}};wa.equal=function(e){return function(n){if(n!==e)return JSON.stringify(e)}};wa.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),r=e.map(function(n){return wa.equal(n)});return wa.oneOfType.apply(this,r)};wa.range=function(e){var r=e[0],n=e[1];return function(d){var p=Sg(wa.number,d);if(p||d<r||d>n)return"number between "+r+" & "+n+" (inclusive)"}};wa.any=function(){};wa.boolean=function(e){if(typeof e!="boolean")return"boolean"};wa.number=function(e){if(typeof e!="number")return"number"};wa.plainArray=function(e){if(!Array.isArray(e))return"array"};wa.plainObject=function(e){if(!PPe(e))return"object"};wa.string=function(e){if(typeof e!="string")return"string"};wa.func=function(e){if(typeof e!="function")return"function"};function Sg(t,e){if(!(e==null&&!t.hasOwnProperty("__required"))){var r=t(e);if(r)return Array.isArray(r)?r:[r]}}function U4(t,e){var r=t.length,n=t[r-1],c=t.slice(0,r-1);return c.length===0&&(c=[kQ]),e=kPe(e,{path:c}),typeof n=="function"?n(e):MQ(e,MPe(n))}function RPe(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function MPe(t){return"must be "+DPe(t)+"."}function DPe(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function MQ(t,e){var r=DQ(t.path),n=t.path.join(".")+" "+e,c=r?"Item at position ":"";return c+n}function DQ(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function OPe(t){return Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}})}wa.validate=Sg;wa.processMessage=U4;var LPe=wa,FPe=vw,d0=LPe;function zPe(t){if(typeof window<"u")return t instanceof Ya.Blob||t instanceof Ya.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function BPe(t,e){return d0.assert(d0.strictShape(t),e)}function VPe(t){var e="date";if(typeof t=="boolean")return e;try{var r=new Date(t);if(r.getTime&&isNaN(r.getTime()))return e}catch{return e}}function UPe(t){return d0.tuple(d0.number,d0.number)(t)}var $Pe=FPe(d0,{file:zPe,date:VPe,coordinates:UPe,assertShape:BPe});function qPe(t,e){var r=function(n,c){return e.indexOf(n)!==-1&&c!==void 0};return typeof e=="function"&&(r=e),Object.keys(t).filter(function(n){return r(n,t[n])}).reduce(function(n,c){return n[c]=t[c],n},{})}var GPe=qPe;function HPe(t,e){return Object.keys(t).reduce(function(r,n){return r[n]=e(n,t[n]),r},{})}var WPe=HPe,ZPe=WPe;function KPe(t){return ZPe(t,function(e,r){return typeof r=="boolean"?JSON.stringify(r):r})}var XPe=KPe,YPe=IQ,JPe=PQ;function QPe(t){return function(e){var r;YPe.prototype.isPrototypeOf(e)?r=e:r=JPe(e);var n=Object.create(t);return n.client=r,n}}var eke=QPe,OQ=vw,hi=$Pe,MI=GPe,LQ=XPe,tke=eke,$4={},FQ=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];$4.forwardGeocode=function(t){hi.assertShape({query:hi.required(hi.string),mode:hi.oneOf("mapbox.places","mapbox.places-permanent"),countries:hi.arrayOf(hi.string),proximity:hi.oneOf(hi.coordinates,"ip"),types:hi.arrayOf(hi.oneOf(FQ)),autocomplete:hi.boolean,bbox:hi.arrayOf(hi.number),limit:hi.number,language:hi.arrayOf(hi.string),routing:hi.boolean,fuzzyMatch:hi.boolean,worldview:hi.string,session_token:hi.string})(t),t.mode=t.mode||"mapbox.places";var e=LQ(OQ({country:t.countries},MI(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:MI(t,["mode","query"]),query:e})};$4.reverseGeocode=function(t){hi.assertShape({query:hi.required(hi.coordinates),mode:hi.oneOf("mapbox.places","mapbox.places-permanent"),countries:hi.arrayOf(hi.string),types:hi.arrayOf(hi.oneOf(FQ)),bbox:hi.arrayOf(hi.number),limit:hi.number,language:hi.arrayOf(hi.string),reverseMode:hi.oneOf("distance","score"),routing:hi.boolean,worldview:hi.string,session_token:hi.string})(t),t.mode=t.mode||"mapbox.places";var e=LQ(OQ({country:t.countries},MI(t,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:MI(t,["mode","query"]),query:e})};var rke=tke($4);let nke="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",zQ=t=>crypto.getRandomValues(new Uint8Array(t)),BQ=(t,e,r)=>{let n=(2<<Math.log(t.length-1)/Math.LN2)-1,c=-~(1.6*n*e/t.length);return(d=e)=>{let p="";for(;;){let a=r(c),w=c|0;for(;w--;)if(p+=t[a[w]&n]||"",p.length===d)return p}}},ske=(t,e=21)=>BQ(t,e,zQ),ike=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");const ake=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:ske,customRandom:BQ,nanoid:ike,random:zQ,urlAlphabet:nke},Symbol.toStringTag,{value:"Module"})),oke=c9(ake);var lke=oke.nanoid;function VQ(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}VQ.prototype={select:function(t,e){var r=this.getEventPayload("search.select",e,{selectedFeature:t});if(r&&!(r.resultIndex===this.lastSentIndex&&r.queryString===this.lastSentInput||r.resultIndex==-1))return this.lastSentIndex=r.resultIndex,this.lastSentInput=r.queryString,this.push(r)},start:function(t){var e=this.getEventPayload("search.start",t);if(e)return this.push(e)},keyevent:function(t,e){if(t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var r=this.getEventPayload("search.keystroke",e,{key:t.key});if(r)return this.push(r)}},send:function(t,e){if(!this.enableEventLogging)return e?e():void 0;var r=this.getRequestOptions(t);this.request(r,(function(n){if(n)return this.handleError(n,e);if(e)return e()}).bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var e={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return e},getEventPayload:function(t,e,r={}){if(t==="search.select"&&!r.selectedFeature||t==="search.keystroke"&&!r.key)return null;var n;if(!e.options.proximity)n=null;else if(typeof e.options.proximity=="object")n=[e.options.proximity.longitude,e.options.proximity.latitude];else if(e.options.proximity==="ip"){var c=e._headers?e._headers["ip-proximity"]:null;c&&typeof c=="string"?n=c.split(",").map(parseFloat):n=[999,999]}else n=e.options.proximity;var d=e._map?e._map.getZoom():void 0,p={event:t,version:this.getEventSchemaVersion(t),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:n,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:d,keyboardLocale:this.locale};if(t==="search.select"?p.queryString=e.inputString:t!="search.select"&&e._inputEl?p.queryString=e._inputEl.value:p.queryString=e.inputString,["search.keystroke","search.select"].includes(t)&&(p.path="geocoding/v5/mapbox.places"),t==="search.keystroke"&&r.key)p.lastAction=r.key;else if(t==="search.select"&&r.selectedFeature){var a=r.selectedFeature,w=this.getSelectedIndex(a,e);if(p.resultIndex=w,p.resultPlaceName=a.place_name,p.resultId=a.id,a.properties&&(p.resultMapboxId=a.properties.mapbox_id),e._typeahead){var E=e._typeahead.data;E&&E.length>0&&(p.suggestionIds=this.getSuggestionIds(E),p.suggestionNames=this.getSuggestionNames(E),p.suggestionTypes=this.getSuggestionTypes(E),p.suggestionSources=this.getSuggestionSources(E))}}return this.validatePayload(p)?p:null},request:function(t,e){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(this.readyState==4)return this.status==204?e(null):e(this.statusText)},r.open(t.method,t.host+"/"+t.path,!0);for(var n in t.headers){var c=t.headers[n];r.setRequestHeader(n,c)}r.send(t.body)},handleError:function(t,e){if(e)return e(t)},generateSessionID:function(){return lke()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,e){if(e._typeahead){var r=e._typeahead.data,n=t.id,c=r.map(function(p){return p.id}),d=c.indexOf(n);return d}},getSuggestionIds:function(t){return t.map(function(e){return e.properties?e.properties.mapbox_id||"":e.id||""})},getSuggestionNames:function(t){return t.map(function(e){return e.place_name||""})},getSuggestionTypes:function(t){return t.map(function(e){return e.place_type&&Array.isArray(e.place_type)&&e.place_type[0]||""})},getSuggestionSources:function(t){return t.map(function(e){return e._source||""})},getEventSchemaVersion:function(t){return["search.keystroke","search.select"].includes(t)?"2.2":"2.0"},validatePayload:function(t){if(!t||!t.event)return!1;var e=["event","created","sessionIdentifier","queryString"],r=["event","created","sessionIdentifier","queryString","lastAction"],n=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],c=t.event;return c==="search.start"?this.objectHasRequiredProps(t,e):c==="search.keystroke"?this.objectHasRequiredProps(t,r):c==="search.select"?this.objectHasRequiredProps(t,n):!0},objectHasRequiredProps:function(t,e){return e.every(function(r){return r==="queryString"?typeof t[r]=="string"&&t[r].length>0:t[r]!==void 0})},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,e){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}};var cke=VQ,uke={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},dke={placeholder:uke},UQ={exports:{}};(function(t){(function(e,r,n){t.exports?t.exports=n():e[r]=n()})(Ya,"subtag",function(){var e="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(w){return w.match(r)||[]}function c(w){return n(w).filter(function(E,C){return E&&C})}function d(w){return w=n(w),{language:w[1]||e,extlang:w[2]||e,script:w[3]||e,region:w[4]||e}}function p(w,E,C){Object.defineProperty(w,E,{value:C,enumerable:!0})}function a(w,E,C){function P(R){return n(R)[w]||e}p(P,"pattern",E),p(d,C,P)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),p(d,"split",c),d})})(UQ);var hke=UQ.exports;function $Q(){}$Q.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(e,r){window.navigator.geolocation.getCurrentPosition(e,r,t)})}};var fke=$Q;function pke(t,e){const r=qQ(t),n=["address","street","place","country"];var c;if(typeof e=="function")return e(r);const d=n.indexOf(e);return d===-1?c=n:c=n.slice(d),c.reduce(function(p,a){return r[a]?(p!==""&&(p=p+", "),p+r[a]):p},"")}function qQ(t){const e=t.address||"",r=t.text||"",n=t.place_name||"",d={address:n.split(",")[0],houseNumber:e,street:r,placeName:n};return t.context.forEach(function(p){const a=p.id.split(".")[0];d[a]=p.text}),d}const mke=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var gke={transformFeatureToGeolocationText:pke,getAddressInfo:qQ,REVERSE_GEOCODE_COORD_RGX:mke},_ke=xAe,yke=LAe,k_=vw,xke=qAe.EventEmitter,R$=GAe,QR=IPe,eM=rke,vke=cke,wke=dke,bke=hke,Ske=fke,M$=gke;const Im={FORWARD:0,LOCAL:1,REVERSE:2};function Eke(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function GQ(t){this._eventEmitter=new xke,this.options=k_({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Ske}function Tke(t){return t?String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}GQ.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",useBrowserFocus:!1,getItemValue:function(t){return t.place_name},render:function(t){var e=Tke(t.place_name).split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},_headers:{},addTo:function(t){function e(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const c=r.onAdd();n.appendChild(c)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)e(this,t);else if(typeof t=="string"){const r=document.querySelectorAll(t);if(r.length===0)throw new Error("Element ",t,"not found.");if(r.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,r[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=eM(QR({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new vke(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this),this._onSuggestionItemFocus=this._onSuggestionItemFocus.bind(this),this._onSuggestionItemKeyDown=this._onSuggestionItemKeydown.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var r=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",yke(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(R){this.eventManager.keyevent(R,this)}).bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var c=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(c),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),e.appendChild(r),e.appendChild(this._inputEl),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var d=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(d),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var p=this._typeahead=new _ke(this._inputEl,[],{hideOnBlur:!this.options.useBrowserFocus,filter:!1,minLength:this.options.minLength,limit:this.options.limit});e.insertBefore(n,p.list.wrapper),this.setRenderFunction(this.options.render),p.getItemValue=this.options.getItemValue;const a=this._typeahead.handleKeyDown.bind(this._typeahead),w=this._typeahead.handleKeyUp.bind(this._typeahead);this._typeahead.handleKeyUp,this.options.useBrowserFocus&&(this._typeahead.handleKeyDown=(function(R){if(!(R.keyCode===9&&!p.list.isEmpty())){if(R.keyCode===40){this._typeahead.list.active=0,this._typeahead.list.element.querySelectorAll("li").forEach(function(B){B.classList.remove("active")}),this._typeahead.list.element.querySelectorAll("li")[0].classList.add("active"),this._typeahead.list.element.querySelectorAll("li")[0].focus();return}else if(R.keyCode===38){this._typeahead.list.active=p.list.items.length-1,this._typeahead.list.element.querySelectorAll("li").forEach(function(B){B.classList.remove("active")}),this._typeahead.list.element.querySelectorAll("li")[this._typeahead.list.active].classList.add("active"),this._typeahead.list.element.querySelectorAll("li")[this._typeahead.list.active].focus();return}a(R)}}).bind(this),this._typeahead.handleKeyUp=function(R){if(R&&R.keyCode===16){R.preventDefault();return}w(R)});var E=p.list.draw,C=this._footerNode=Eke(),P=this;return p.list.draw=function(){P.options.useBrowserFocus&&p.list.element.querySelectorAll("li").forEach(function(R){R.removeEventListener("focus",P._onSuggestionItemFocus),R.removeEventListener("keydown",P._onSuggestionItemKeyDown)}),E.call(this),P.options.useBrowserFocus&&p.list.element.querySelectorAll("li").forEach((function(R,B){B===0&&R.focus(),R.setAttribute("data-index",B),R.tabIndex=0,R.addEventListener("focus",this._onSuggestionItemFocus),R.addEventListener("keydown",this._onSuggestionItemKeyDown)}).bind(P)),C.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),C.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(C)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_onSuggestionItemKeydown(t){const e=t.keyCode;if(e!==9){if(e===13){t.preventDefault();const r=this._typeahead.list.element.querySelector(".active");if(r){const n=r.getAttribute("data-index"),c=this._typeahead.list.items[n];c&&(this._typeahead.value(c.original),this._typeahead.list.hide())}}else if(e===38||e===40){const r=this._typeahead.list.element.querySelectorAll("li");if(r.length>0){if(e===38)if(this._typeahead.list.active>0)t.preventDefault(),this._typeahead.list.active--;else{this._typeahead.el.focus();return}else if(e===40)if(t.preventDefault(),this._typeahead.list.active<r.length-1)this._typeahead.list.active++;else return;r.forEach(function(c){c.classList.remove("active")});const n=r[this._typeahead.list.active];n&&(n.classList.add("active"),n.focus())}}}},_onSuggestionItemFocus(t){this._typeahead.list.active=t.target.getAttribute("data-index"),this._typeahead.list.element.querySelectorAll("li").forEach(function(e){e.classList.remove("active")}),t.target.classList.add("active")},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(t){this._hideLoadingIcon();const e={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(e),this._fly(e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(e),this._showClearButton(),this.fresh=!1;const r={limit:1,language:[this.options.language],query:e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const n=e.geometry.coordinates[0]+","+e.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:e})}else this.geocoderService.reverseGeocode(r).send().then((function(n){const c=n.body.features[0];if(c){const d=M$.transformFeatureToGeolocationText(c,this.options.addressAccuracy);this._setInputValue(d),c.user_coordinates=e.geometry.coordinates,this._eventEmitter.emit("result",{result:c})}else this._eventEmitter.emit("result",{result:{user_coordinates:e.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(t){t.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),r.innerHTML=e,r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(t){var e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(t){var e=27,r=9;if(t.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var n=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,c=n?n.value:"";if(!c)return this.fresh=!0,t.keyCode!==r&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(t.metaKey||[r,e,37,39,13,38,40].indexOf(t.keyCode)!==-1)&&n.value.length>=this.options.minLength&&this._geocode(n.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var e;if(t.properties&&R$[t.properties.short_code])e=k_({},this.options.flyTo),this._map&&this._map.fitBounds(R$[t.properties.short_code].bbox,e);else if(t.bbox){var r=t.bbox;e=k_({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],e)}else{var n={zoom:this.options.zoom};e=k_({},n,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}},_requestType:function(t,e){var r;return t.localGeocoderOnly?r=Im.LOCAL:t.reverseGeocode&&M$.REVERSE_GEOCODE_COORD_RGX.test(e)?r=Im.REVERSE:r=Im.FORWARD,r},_setupConfig:function(t,e){const r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],n=/[\s,]+/;var c=this,d=r.reduce(function(a,w){if(c.options[w]===void 0||c.options[w]===null)return a;["countries","types","language"].indexOf(w)>-1?a[w]=c.options[w].split(n):a[w]=c.options[w];const E=typeof c.options[w].longitude=="number"&&typeof c.options[w].latitude=="number";if(w==="proximity"&&E){const C=c.options[w].longitude,P=c.options[w].latitude;a[w]=[C,P]}return a},{});switch(t){case Im.REVERSE:{var p=e.split(n).map(function(a){return parseFloat(a,10)});c.options.flipCoordinates||p.reverse(),d.types&&d.types[0],d=k_(d,{query:p,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(a){a in d&&delete d[a]})}break;case Im.FORWARD:{const a=e.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(a)&&(e=e.replace(/,/g," ")),d=k_(d,{query:e})}break}return d.session_token=this.eventManager.getSessionId(),d},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});const e=this._requestType(this.options,t),r=this._setupConfig(e,t);var n;switch(e){case Im.LOCAL:n=Promise.resolve();break;case Im.FORWARD:n=this.geocoderService.forwardGeocode(r).send();break;case Im.REVERSE:n=this.geocoderService.reverseGeocode(r).send();break}var c=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],d=[],p=null;return n.catch((function(a){p=a}).bind(this)).then((function(a){this._hideLoadingIcon();var w={};return a?a.statusCode=="200"&&(w=a.body,w.request=a.request,w.headers=a.headers,this._headers=a.headers):w={type:"FeatureCollection",features:[]},w.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),w.features&&w.features.length&&w.features.map(function(E){E._source="mapbox"}),w.features=w.features?c.concat(w.features):c,this.options.externalGeocoder?(d=this.options.externalGeocoder(t,w.features)||Promise.resolve([]),d.then(function(E){return w.features=w.features?E.concat(w.features):E,w},function(){return w})):w}).bind(this)).then((function(a){if(p)throw p;this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter)),a.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",a),this._typeahead.update(a.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))}).bind(this)).catch((function(a){this._hideLoadingIcon(),this._hideAttribution(),c.length&&this.options.localGeocoder||d.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(c)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:c}),this._eventEmitter.emit("error",{error:a})}).bind(this)),n},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus(),this.options.useBrowserFocus&&this._typeahead.list.hide()},_clearOnBlur:function(t){var e=this;t.relatedTarget&&e._clear(t)},_onQueryResult:function(t){var e=t.body;if(e.features.length){var r=e.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderLocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderUserDeniedGeolocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],e=bke.language(t),r=wke.placeholder[e];if(r)return r}return"Search"},setInput:function(t,e){return e===void 0&&(e=!1),this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&(e?this._geocode(t):this._onChange()),this},setProximity:function(t,e=!0){return this.options.proximity=t,e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.options.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=eM(QR({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=eM(QR({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var e={color:"#4668F2"},r=k_({},e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(r),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,e){return this._eventEmitter.on(t,e),this},off:function(t,e){return this._eventEmitter.removeListener(t,e),this.eventManager.remove(),this}};var jke=GQ;const Nke=W0(jke),Ike=`
  .mapboxgl-ctrl-geocoder {
    min-width: 240px !important;
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05) !important;
  }
  
  .mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--icon {
    display: inline-block !important;
    width: 20px !important;
    height: 20px !important;
    background-size: contain !important;
  }
  
  .mapboxgl-ctrl-geocoder--icon-search {
    left: 10px !important;
    top: 10px !important;
    position: absolute !important;
  }
  
  .mapboxgl-ctrl-geocoder--icon-close {
    right: 10px !important;
    top: 10px !important;
    position: absolute !important;
  }
  
  .mapboxgl-ctrl-geocoder--input {
    padding: 8px 36px !important;
    font-size: 14px !important;
  }
  
  .mapboxgl-ctrl-geocoder--button {
    padding: 0 !important;
    width: 30px !important;
    height: 30px !important;
    background: transparent !important;
  }
  
  /* Rendre le logo Mapbox plus discret */
  .mapboxgl-ctrl-bottom-left {
    opacity: 0.4 !important;
    transition: opacity 0.2s ease !important;
  }
  
  .mapboxgl-ctrl-bottom-left:hover {
    opacity: 0.8 !important;
  }
  
  .mapboxgl-ctrl-logo {
    width: 65px !important;
    height: 20px !important;
    margin: 0 0 4px 4px !important;
  }
  
  /* Masquer complètement TOUS les contrôles d'attribution */
  .mapboxgl-ctrl-attrib,
  .mapboxgl-ctrl-attrib-button,
  .mapboxgl-ctrl-attrib.mapboxgl-compact,
  .mapboxgl-ctrl-attrib.mapboxgl-compact-show,
  .mapboxgl-ctrl-attrib-inner,
  .mapboxgl-ctrl.mapboxgl-ctrl-attrib,
  .mapboxgl-ctrl-bottom-right,
  .mapboxgl-ctrl-bottom-right .mapboxgl-ctrl-attrib {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    width: 0 !important;
    height: 0 !important;
    pointer-events: none !important;
    position: absolute !important;
    overflow: hidden !important;
  }
  
  /* Cibler spécifiquement le conteneur en bas à droite */
  .mapboxgl-ctrl-bottom-right {
    display: none !important;
  }
  
  /* Masquer tout texte d'attribution visible */
  .mapboxgl-ctrl-attrib a,
  .mapboxgl-ctrl-attrib span,
  .mapboxgl-ctrl-attrib button {
    display: none !important;
  }
  
  /* GARDER le logo Mapbox visible (en bas à gauche) */
  .mapboxgl-ctrl-bottom-left a.mapboxgl-ctrl-logo {
    display: block !important;
    visibility: visible !important;
    opacity: 0.4 !important;
  }
`;Sl.accessToken="pk.eyJ1IjoibWJhcnJ5MjIiLCJhIjoiY21oM3FyZXZsMTZodTJqcXk0dTRybWVkMSJ9.A1RGamevhBLlCZFhz-EFqQ";const tM=new Map,HQ=({onLocationSelect:t,initialLocation:e,placeholder:r="Cliquez sur la carte ou recherchez une adresse",showDirections:n=!1})=>{const c=z.useRef(null),d=z.useRef(null),p=z.useRef(null),a="route",w="route-source",{resolvedTheme:E}=lC(),[C,P]=z.useState(e),[R,B]=z.useState(null),[V,W]=z.useState(!1),[K,Z]=z.useState(!1),[$,X]=z.useState(!1),[Q,re]=z.useState(null);z.useEffect(()=>{navigator.geolocation?(W(!0),navigator.geolocation.getCurrentPosition(J=>{const ke=[J.coords.longitude,J.coords.latitude];B(ke),W(!1)},J=>{console.error("Erreur de géolocalisation:",J),W(!1),B([2.3522,48.8566])})):B([2.3522,48.8566])},[]),z.useEffect(()=>{if(!c.current||d.current||!R)return;const J=e&&e.latitude&&e.longitude&&!isNaN(e.latitude)&&!isNaN(e.longitude)&&e.latitude!==0&&e.longitude!==0,ke=E==="dark";d.current=new Sl.Map({container:c.current,style:ke?"mapbox://styles/mapbox/dark-v11":"mapbox://styles/mapbox/light-v11",center:J?[e.longitude,e.latitude]:R,zoom:13,attributionControl:!1,logoPosition:"bottom-left"}),d.current.addControl(new Sl.NavigationControl,"top-right"),d.current.addControl(new Sl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),"top-right");const Ze=new Nke({accessToken:Sl.accessToken||"",mapboxgl:Sl,marker:!1,placeholder:"Rechercher une adresse...",language:"fr",countries:"FR"});return d.current.addControl(Ze,"top-left"),Ze.on("result",Xe=>{const{center:qe,place_name:$e}=Xe.result;ue(qe[1],qe[0],$e)}),J&&ge(e.latitude,e.longitude),d.current.on("click",async Xe=>{const{lng:qe,lat:$e}=Xe.lngLat;await ve($e,qe)}),()=>{d.current&&(d.current.remove(),d.current=null)}},[R,E]),z.useEffect(()=>{if(!d.current)return;const ke=E==="dark"?"mapbox://styles/mapbox/dark-v11":"mapbox://styles/mapbox/light-v11";d.current.setStyle(ke)},[E]);const ve=async(J,ke)=>{const Ze=await pe(J,ke);ue(J,ke,Ze)},pe=async(J,ke)=>{const Ze=`${J.toFixed(5)},${ke.toFixed(5)}`;if(tM.has(Ze))return tM.get(Ze);try{const qe=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${ke},${J}.json?access_token=${Sl.accessToken}&language=fr`)).json();if(qe.features&&qe.features.length>0){const $e=qe.features[0].place_name;return tM.set(Ze,$e),$e}}catch(Xe){console.error("Erreur reverse geocoding:",Xe)}return`${J.toFixed(6)}, ${ke.toFixed(6)}`},ue=(J,ke,Ze)=>{const Xe={address:Ze,latitude:J,longitude:ke};P(Xe),t(Xe),ge(J,ke)},ge=(J,ke)=>{if(!d.current)return;p.current&&p.current.remove();const Ze=document.createElement("div");Ze.className="custom-marker",Ze.style.width="40px",Ze.style.height="40px",Ze.style.backgroundImage="url(https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png)",Ze.style.backgroundSize="cover",p.current=new Sl.Marker({element:Ze,anchor:"bottom",draggable:!0}).setLngLat([ke,J]).addTo(d.current),p.current.on("dragend",async()=>{const Xe=p.current.getLngLat();await ve(Xe.lat,Xe.lng)}),d.current.flyTo({center:[ke,J],zoom:15,duration:1e3})},ce=async()=>{var J,ke,Ze;if(!(!R||!C)){Z(!0);try{const qe=await(await fetch(`https://api.mapbox.com/directions/v5/mapbox/walking/${R[0]},${R[1]};${C.longitude},${C.latitude}?geometries=geojson&access_token=${Sl.accessToken}&language=fr`)).json();if(qe.routes&&qe.routes.length>0){const $e=qe.routes[0],st=$e.geometry;(J=d.current)!=null&&J.getSource(w)?d.current.getSource(w).setData(st):((ke=d.current)==null||ke.addSource(w,{type:"geojson",data:st}),(Ze=d.current)==null||Ze.addLayer({id:a,type:"line",source:w,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":5,"line-opacity":.75}})),re({distance:$e.distance,duration:$e.duration}),X(!0)}else console.warn("Aucun itinéraire trouvé."),re(null),X(!1)}catch(Xe){console.error("Erreur lors du calcul de l'itinéraire:",Xe),re(null),X(!1)}finally{Z(!1)}}},Se=()=>{var J,ke;(J=d.current)!=null&&J.getLayer(a)&&d.current.removeLayer(a),(ke=d.current)!=null&&ke.getSource(w)&&d.current.removeSource(w),X(!1),re(null)},le=()=>{p.current&&(p.current.remove(),p.current=null),Se(),P(void 0),t({address:"",latitude:0,longitude:0})};return i.jsxs("div",{className:"space-y-4",children:[i.jsx("style",{children:Ike}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"meeting-location",className:"text-foreground font-semibold",children:"Point de rencontre *"}),i.jsxs("div",{className:"relative mt-1",children:[i.jsx(dl,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),i.jsx(Gr,{id:"meeting-location",value:(C==null?void 0:C.address)||"",placeholder:r,readOnly:!0,className:"pl-10 pr-10 bg-muted/50 cursor-pointer",onClick:()=>{var J;(J=c.current)==null||J.scrollIntoView({behavior:"smooth",block:"center"})}}),C&&i.jsx("button",{type:"button",onClick:le,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:i.jsx(of,{className:"w-4 h-4"})})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:V?i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Ka,{className:"w-3 h-3 animate-spin"}),"Localisation en cours..."]}):"Cliquez sur la carte, recherchez une adresse ou déplacez le marqueur"})]}),i.jsx(Tt,{children:i.jsx(jt,{className:"p-0",children:i.jsxs("div",{className:"relative",children:[i.jsx("div",{ref:c,className:"w-full h-[400px] rounded-lg overflow-hidden"}),n&&C&&R&&i.jsx("div",{className:"absolute bottom-4 left-4 right-4 flex flex-col gap-2",children:$?i.jsx(Tt,{className:"bg-primary/5 border-primary/20",children:i.jsx(jt,{className:"p-3",children:i.jsxs("div",{className:"flex items-center justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(aI,{className:"w-5 h-5 text-primary"}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold text-foreground",children:"Itinéraire calculé"}),Q&&i.jsx("p",{className:"text-sm text-muted-foreground",children:`Distance: ${(Q.distance/1e3).toFixed(2)} km - Durée: ${(Q.duration/60).toFixed(0)} min`})]})]}),i.jsx(Ge,{type:"button",variant:"ghost",size:"icon",onClick:Se,className:"h-8 w-8 flex-shrink-0",title:"Masquer l'itinéraire",children:i.jsx(of,{className:"w-4 h-4"})})]})})}):i.jsx(Ge,{type:"button",onClick:ce,disabled:K,className:"w-full",children:K?i.jsxs(i.Fragment,{children:[i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}),"Calcul de l'itinéraire..."]}):i.jsxs(i.Fragment,{children:[i.jsx(aI,{className:"w-4 h-4 mr-2"}),"Afficher l'itinéraire piéton"]})})})]})})})]})},eT=On.object({title:On.string().min(5,"Le titre doit contenir au moins 5 caractères").max(80,"Le titre ne peut pas dépasser 80 caractères"),description:On.string().min(20,"La description doit contenir au moins 20 caractères").max(1e3,"La description ne peut pas dépasser 1000 caractères"),meetingLocation:On.string().min(1,"Veuillez spécifier un lieu de rencontre"),phone:On.string().optional(),availableDate:On.string().optional(),availableTimeStart:On.string().optional(),availableTimeEnd:On.string().optional()}),Cke=eT.extend({price:On.string().min(1,"Le prix est obligatoire").transform(t=>{const e=parseFloat(t.replace(",","."));if(isNaN(e)||e<1)throw new Error("Le prix doit être d'au moins 1€");if(e>1e4)throw new Error("Le prix ne peut pas dépasser 10 000€");return e}),condition:On.enum(["new","like-new","good","fair"]),paymentMethods:On.array(On.string()).min(1,"Sélectionnez au moins un mode de paiement")}),Ake=eT.extend({donationReason:On.string().min(10,"Expliquez pourquoi vous donnez cet objet").max(140,"Maximum 140 caractères")}),Pke=eT.extend({desiredItems:On.array(On.string()).min(1,"Ajoutez au moins un objet recherché"),estimatedValue:On.string().min(1,"La valeur estimée est obligatoire").transform(t=>{const e=parseFloat(t.replace(",","."));if(isNaN(e)||e<1)throw new Error("La valeur estimée doit être d'au moins 1€");return e})}),kke=eT.extend({hourlyRate:On.string().min(1,"Le tarif horaire est obligatoire").transform(t=>{const e=parseFloat(t.replace(",","."));if(isNaN(e)||e<5)throw new Error("Le tarif horaire doit être d'au moins 5€/h");if(e>200)throw new Error("Le tarif ne peut pas dépasser 200€/h");return e}),duration:On.number().min(1,"La durée doit être d'au moins 1 heure").max(720,"Maximum 720 heures"),skills:On.string().min(20,"Décrivez vos compétences en détail").max(500,"Maximum 500 caractères"),availability:On.string().optional()}),Rke=[{value:"new",label:"Neuf",description:"Jamais utilisé, dans son emballage"},{value:"like-new",label:"Très bon",description:"Utilisé très peu, aucun défaut visible"},{value:"good",label:"Bon",description:"Utilisé mais bien entretenu"},{value:"fair",label:"Correct",description:"Signes d'usure mais fonctionnel"}],D$=[{value:"cash",label:"Espèces",icon:z3},{value:"transfer",label:"Virement bancaire",icon:Aa},{value:"lydia",label:"Lydia",icon:Ag},{value:"paypal",label:"PayPal",icon:Aa}],Mke=()=>{var qe,$e,st,it,Mt,ar,St,Xt;const{currentUser:t,userProfile:e}=$i(),{createListing:r}=mw(),n=Ra(),[c]=xE(),[d,p]=z.useState(()=>c.get("type")||"sell"),[a,w]=z.useState([]),[E,C]=z.useState(!1),[P,R]=z.useState(!1),[B,V]=z.useState([""]),[W,K]=z.useState(""),[Z,$]=z.useState([]),[X,Q]=z.useState([1]),[re,ve]=z.useState(null),ue=K_({resolver:X_((()=>{switch(d){case"sell":return Cke;case"gift":return Ake;case"swap":return Pke;case"service":return kke;default:return eT}})()),defaultValues:{title:"",description:"",price:"",condition:"good",paymentMethods:[],donationReason:"",desiredItems:[],estimatedValue:"",hourlyRate:"",duration:1,skills:"",availability:"",meetingLocation:"",phone:"",availableDate:"",availableTimeStart:"",availableTimeEnd:""},mode:"onChange"});z.useEffect(()=>{ue.reset({title:"",description:"",price:"",condition:"good",paymentMethods:[],donationReason:"",desiredItems:[],estimatedValue:"",hourlyRate:"",duration:1,skills:"",availability:"",meetingLocation:""}),V([""]),$([]),Q([1]),w([])},[d,ue]);const ge=async dt=>{var ln;if(!t)throw new Error("User not authenticated");const ft=Date.now(),Wt=((ln=dt.name.split(".").pop())==null?void 0:ln.toLowerCase())||"jpg",Wr=Math.floor(Math.random()*1e4),jr=`image_${ft}_${Wr}.${Wt}`,Br=A0(gy,`listings/${t.uid}/${jr}`),on=await R3(Br,dt);return await zC(on.ref)},ce=async dt=>{const ft=dt.target.files;if(!(!ft||ft.length===0)){if(!t){alert("Vous devez être connecté pour uploader des images");return}C(!0);try{const Wt=Array.from(ft).slice(0,10-a.length).filter(Br=>["image/jpeg","image/jpg","image/png","image/webp"].includes(Br.type)?Br.size>15728640?(alert(`${Br.name} est trop volumineux (max 15MB)`),!1):!0:(alert(`${Br.name} n'est pas un format d'image supporté (JPG, PNG, WEBP uniquement)`),!1));if(Wt.length===0){C(!1);return}const Wr=Wt.map(Br=>ge(Br)),jr=await Promise.all(Wr);w(Br=>[...Br,...jr]),console.log(`✅ ${jr.length} image(s) uploadée(s) avec succès`)}catch(Wt){console.error("Error uploading images:",Wt),alert(`Erreur lors de l'upload des images: ${Wt.message||"Erreur inconnue"}`)}finally{C(!1),dt.target.value=""}}},Se=dt=>{w(ft=>ft.filter((Wt,Wr)=>Wr!==dt))},le=()=>{if(W.trim()){const dt=[...B.filter(ft=>ft.trim()),W.trim()];V(dt),ue.setValue("desiredItems",dt),K("")}},J=dt=>{const ft=B.filter((Wt,Wr)=>Wr!==dt);V(ft),ue.setValue("desiredItems",ft)},ke=(dt,ft)=>{const Wt=ft?[...Z,dt]:Z.filter(Wr=>Wr!==dt);$(Wt),ue.setValue("paymentMethods",Wt)},Ze=async dt=>{if(!(!t||!e)){R(!0);try{const ft={title:dt.title,description:dt.description,currency:"EUR",category:"electronics",images:a,tags:[],phone:dt.phone||null,availableDate:dt.availableDate||null,availableTimeStart:dt.availableTimeStart||null,availableTimeEnd:dt.availableTimeEnd||null,location:{city:(re==null?void 0:re.address.split(",")[0])||"Paris",state:"Île-de-France",country:"France",campus:e.campus||null,university:e.university||null,coordinates:re?{lat:re.latitude,lng:re.longitude}:void 0},meetingPoint:(re==null?void 0:re.address)||dt.meetingLocation,sellerId:t.uid,sellerName:e.displayName,sellerAvatar:e.photoURL,sellerUniversity:e.university,sellerVerified:e.isVerified,status:"active",views:0,likes:0,saves:0,reportCount:0,moderationStatus:"approved"};let Wt;switch(d){case"sell":Wt={...ft,price:dt.price,condition:dt.condition,transactionType:"sale",description:`${dt.description}

Modes de paiement acceptés: ${Z.map(jr=>{var Br;return(Br=D$.find(on=>on.value===jr))==null?void 0:Br.label}).join(", ")}`};break;case"gift":Wt={...ft,price:0,condition:"good",transactionType:"donation",description:`${dt.description}

Raison du don: ${dt.donationReason}`};break;case"swap":Wt={...ft,price:dt.estimatedValue,condition:"good",transactionType:"exchange",exchangeFor:B.filter(jr=>jr.trim()).join(", "),description:`${dt.description}

Recherche en échange: ${B.filter(jr=>jr.trim()).join(", ")}
Valeur estimée: ${dt.estimatedValue}€`};break;case"service":Wt={...ft,price:dt.hourlyRate,condition:"new",transactionType:"service",description:`${dt.description}

Compétences: ${dt.skills}
Tarif: ${dt.hourlyRate}€/h
Durée prévue: ${X[0]}h${dt.availability?`
Disponibilités: ${dt.availability}`:""}`};break;default:throw new Error("Type de transaction non supporté")}console.log("Submitting listing data:",Wt);const Wr=await r(Wt);n(`/listing/${Wr}`)}catch(ft){console.error("Error creating listing:",ft)}finally{R(!1)}}},Xe=()=>{const dt=ue.formState.errors,ft=ue.watch("title")&&ue.watch("description")&&re;switch(d){case"sell":return ft&&ue.watch("price")&&Z.length>0&&!dt.title&&!dt.description&&!dt.price;case"gift":return ft&&ue.watch("donationReason")&&!dt.title&&!dt.description&&!dt.donationReason;case"swap":return ft&&B.some(Wt=>Wt.trim())&&ue.watch("estimatedValue")&&!dt.title&&!dt.description&&!dt.estimatedValue;case"service":return ft&&ue.watch("hourlyRate")&&ue.watch("skills")&&!dt.title&&!dt.description&&!dt.hourlyRate&&!dt.skills;default:return!1}};return i.jsxs("div",{className:"create-listing-page container mx-auto px-4 py-8 max-w-4xl",children:[i.jsx("style",{children:`
          .create-listing-page input[type="date"]::-webkit-calendar-picker-indicator,
          .create-listing-page input[type="time"]::-webkit-calendar-picker-indicator {
            display: none;
            -webkit-appearance: none;
          }
          .create-listing-page input[type="date"]::-moz-focus-inner,
          .create-listing-page input[type="time"]::-moz-focus-inner {
            border: 0;
          }
          .create-listing-page input[type="date"],
          .create-listing-page input[type="time"] {
            appearance: textfield;
            -moz-appearance: textfield;
            -webkit-appearance: none;
          }
        `}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:"Créer une annonce"}),i.jsx("p",{className:"text-muted-foreground",children:"Partagez vos objets, services ou recherches avec la communauté étudiante vérifiée"})]}),i.jsxs("form",{onSubmit:ue.handleSubmit(Ze),className:"space-y-8",children:[i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(FD,{className:"w-5 h-5"}),"Type d'annonce"]}),i.jsx(Ls,{children:"Le formulaire s'adapte automatiquement selon votre choix"})]}),i.jsx(jt,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsx(Tt,{className:`cursor-pointer transition-all ${d==="sell"?"ring-2 ring-primary bg-primary/5":"hover:shadow-md"}`,onClick:()=>p("sell"),children:i.jsxs(jt,{className:"p-4 text-center",children:[i.jsx(_y,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),i.jsx("h3",{className:"font-semibold text-foreground",children:"Vendre"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Vendre un objet"})]})}),i.jsx(Tt,{className:`cursor-pointer transition-all ${d==="gift"?"ring-2 ring-primary bg-primary/5":"hover:shadow-md"}`,onClick:()=>p("gift"),children:i.jsxs(jt,{className:"p-4 text-center",children:[i.jsx(P0,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),i.jsx("h3",{className:"font-semibold text-foreground",children:"Donner"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Don gratuit"})]})}),i.jsx(Tt,{className:`cursor-pointer transition-all ${d==="swap"?"ring-2 ring-primary bg-primary/5":"hover:shadow-md"}`,onClick:()=>p("swap"),children:i.jsxs(jt,{className:"p-4 text-center",children:[i.jsx(Yo,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),i.jsx("h3",{className:"font-semibold text-foreground",children:"Troc"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Échanger des objets"})]})}),i.jsx(Tt,{className:`cursor-pointer transition-all ${d==="service"?"ring-2 ring-primary bg-primary/5":"hover:shadow-md"}`,onClick:()=>p("service"),children:i.jsxs(jt,{className:"p-4 text-center",children:[i.jsx(Fi,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),i.jsx("h3",{className:"font-semibold text-foreground",children:"Service"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Proposer un service"})]})})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{className:"text-foreground",children:"Informations principales"})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"title",className:"text-foreground",children:"Titre * (max 80 caractères)"}),i.jsx(Gr,{id:"title",placeholder:d==="sell"?"Ex: MacBook Pro 13' M1 - Parfait état":d==="gift"?"Ex: Vélo de ville - Don gratuit":d==="swap"?"Ex: Livre de maths contre livre de physique":"Ex: Cours particuliers de mathématiques",...ue.register("title"),className:"mt-1",maxLength:80}),i.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[i.jsx("span",{className:"text-destructive",children:(qe=ue.formState.errors.title)==null?void 0:qe.message}),i.jsxs("span",{children:[(($e=ue.watch("title"))==null?void 0:$e.length)||0,"/80"]})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"description",className:"text-foreground",children:"Description détaillée * (max 1000 caractères)"}),i.jsx(id,{id:"description",placeholder:d==="sell"?"Décrivez l'état, l'utilisation, la raison de la vente...":d==="gift"?"Décrivez l'objet et pourquoi vous le donnez...":d==="swap"?"Décrivez ce que vous proposez et ce que vous recherchez...":"Décrivez vos compétences, votre expérience, votre méthode...",rows:6,...ue.register("description"),className:"mt-1",maxLength:1e3}),i.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[i.jsx("span",{className:"text-destructive",children:(st=ue.formState.errors.description)==null?void 0:st.message}),i.jsxs("span",{children:[((it=ue.watch("description"))==null?void 0:it.length)||0,"/1000"]})]})]})]})]}),d==="sell"&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(_y,{className:"w-5 h-5 text-blue-600"}),"Informations de vente"]})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"price",className:"text-foreground",children:"Prix (€) *"}),i.jsx(Gr,{id:"price",type:"text",placeholder:"0,00",...ue.register("price"),className:"mt-1"}),ue.formState.errors.price&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:ue.formState.errors.price.message})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"condition",className:"text-foreground",children:"État du produit *"}),i.jsxs(ds,{onValueChange:dt=>ue.setValue("condition",dt),children:[i.jsx(is,{className:"mt-1",children:i.jsx(hs,{placeholder:"Sélectionnez un état"})}),i.jsx(as,{children:Rke.map(dt=>i.jsx(Bt,{value:dt.value,children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-foreground",children:dt.label}),i.jsx("div",{className:"text-xs text-muted-foreground",children:dt.description})]})},dt.value))})]}),ue.formState.errors.condition&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:ue.formState.errors.condition.message})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{className:"text-foreground font-semibold mb-3 block",children:"Modes de paiement acceptés *"}),i.jsx("div",{className:"grid grid-cols-2 gap-3 mt-2",children:D$.map(dt=>i.jsxs("div",{className:`
                            flex items-center space-x-3 p-4 rounded-lg border-2 transition-all cursor-pointer
                            ${Z.includes(dt.value)?"border-primary bg-primary/5 shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-primary/50"}
                          `,onClick:()=>ke(dt.value,!Z.includes(dt.value)),children:[i.jsx("div",{className:`
                            w-5 h-5 rounded border-2 flex items-center justify-center transition-all
                            ${Z.includes(dt.value)?"bg-primary border-primary":"border-gray-300 dark:border-gray-600"}
                          `,children:Z.includes(dt.value)&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{d:"M5 13l4 4L19 7"})})}),i.jsxs(Zr,{htmlFor:dt.value,className:"flex items-center gap-2 cursor-pointer text-foreground flex-1",children:[i.jsx(dt.icon,{className:"w-5 h-5"}),i.jsx("span",{className:"font-medium",children:dt.label})]})]},dt.value))}),Z.length===0&&i.jsxs("p",{className:"text-sm text-destructive mt-2 flex items-center gap-1",children:[i.jsx(Yd,{className:"w-4 h-4"}),"Sélectionnez au moins un mode de paiement"]})]})]})]}),d==="gift"&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(P0,{className:"w-5 h-5 text-green-600"}),"Informations du don"]})}),i.jsx(jt,{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"donationReason",className:"text-foreground",children:"Motif du don * (max 140 caractères)"}),i.jsx(id,{id:"donationReason",placeholder:"Ex: Je déménage, plus besoin, fin d'études...",rows:3,...ue.register("donationReason"),className:"mt-1",maxLength:140}),i.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[i.jsx("span",{className:"text-destructive",children:(Mt=ue.formState.errors.donationReason)==null?void 0:Mt.message}),i.jsxs("span",{children:[((ar=ue.watch("donationReason"))==null?void 0:ar.length)||0,"/140"]})]})]})})]}),d==="swap"&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(Yo,{className:"w-5 h-5 text-purple-600"}),"Informations d'échange"]})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{className:"text-foreground",children:"Objets recherchés * (minimum 1)"}),i.jsxs("div",{className:"space-y-2 mt-2",children:[B.filter(dt=>dt.trim()).map((dt,ft)=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Gr,{value:dt,readOnly:!0,className:"flex-1"}),i.jsx(Ge,{type:"button",variant:"outline",size:"icon",onClick:()=>J(ft),children:i.jsx(pZ,{className:"w-4 h-4"})})]},ft)),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Gr,{placeholder:"Ex: Livre de physique L2",value:W,onChange:dt=>K(dt.target.value),onKeyPress:dt=>dt.key==="Enter"&&(dt.preventDefault(),le()),className:"flex-1"}),i.jsx(Ge,{type:"button",onClick:le,disabled:!W.trim(),children:i.jsx(W_,{className:"w-4 h-4"})})]})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"estimatedValue",className:"text-foreground",children:"Valeur estimée (€) *"}),i.jsx(Gr,{id:"estimatedValue",type:"text",placeholder:"0,00",...ue.register("estimatedValue"),className:"mt-1"}),ue.formState.errors.estimatedValue&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:ue.formState.errors.estimatedValue.message})]})]})]}),d==="service"&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(Fi,{className:"w-5 h-5 text-blue-600"}),"Informations du service"]})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"skills",className:"text-foreground",children:"Description des compétences *"}),i.jsx(id,{id:"skills",placeholder:"Décrivez vos compétences, votre expérience, votre méthode d'enseignement...",rows:4,...ue.register("skills"),className:"mt-1",maxLength:500}),i.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[i.jsx("span",{className:"text-destructive",children:(St=ue.formState.errors.skills)==null?void 0:St.message}),i.jsxs("span",{children:[((Xt=ue.watch("skills"))==null?void 0:Xt.length)||0,"/500"]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"hourlyRate",className:"text-foreground",children:"Tarif horaire (€/h) *"}),i.jsx(Gr,{id:"hourlyRate",type:"text",placeholder:"15,00",...ue.register("hourlyRate"),className:"mt-1"}),ue.formState.errors.hourlyRate&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:ue.formState.errors.hourlyRate.message})]}),i.jsxs("div",{children:[i.jsxs(Zr,{className:"text-foreground",children:["Durée prévue: ",X[0],"h"]}),i.jsx(uQ,{value:X,onValueChange:dt=>{Q(dt),ue.setValue("duration",dt[0])},max:720,min:1,step:1,className:"mt-2"}),i.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[i.jsx("span",{children:"1h"}),i.jsx("span",{children:"720h"})]})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"availability",className:"text-foreground",children:"Disponibilités (optionnel)"}),i.jsx(Gr,{id:"availability",placeholder:"Ex: Lundi-Vendredi 18h-20h, Week-ends",...ue.register("availability"),className:"mt-1"})]})]})]}),i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(H_,{className:"w-5 h-5"}),"Photos ",d==="gift"?"(optionnelles)":"(1-10 photos)"]}),i.jsx(Ls,{children:d==="gift"?"Ajoutez des photos pour donner envie (optionnel)":"Première photo = photo principale. Max 15MB par image."})]}),i.jsx(jt,{children:i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-4",children:[a.map((dt,ft)=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:dt,alt:`Photo ${ft+1}`,className:"w-full h-20 object-cover rounded-lg"}),i.jsx(Ge,{type:"button",variant:"destructive",size:"icon",className:"absolute top-1 right-1 w-6 h-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity shadow-md",onClick:()=>Se(ft),children:i.jsx(of,{className:"w-4 h-4"})}),ft===0&&i.jsx(Ir,{className:"absolute bottom-1 left-1 text-xs bg-primary text-primary-foreground",children:"Principale"})]},ft)),a.length<10&&i.jsxs("label",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg h-20 flex items-center justify-center cursor-pointer hover:border-primary/50 transition-colors",children:[i.jsxs("div",{className:"text-center",children:[E?i.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-1"}):i.jsx(wy,{className:"w-5 h-5 mx-auto mb-1 text-muted-foreground"}),i.jsx("span",{className:"text-xs text-muted-foreground",children:E?"Upload...":"Ajouter"})]}),i.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:ce,className:"hidden",disabled:E})]})]})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-foreground",children:[i.jsx(dl,{className:"w-5 h-5"}),"Coordonnées et disponibilité"]})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"phone",className:"text-foreground font-semibold",children:"Numéro de téléphone (optionnel)"}),i.jsx(Gr,{id:"phone",type:"tel",placeholder:"+33 6 12 34 56 78",...ue.register("phone"),className:"mt-1"}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Pour faciliter le contact avec les acheteurs"})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"availableDate",className:"text-foreground font-semibold",children:"Date de disponibilité (optionnel)"}),i.jsxs("div",{className:"relative mt-1",children:[i.jsx(cl,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),i.jsx(Gr,{id:"availableDate",type:"date",...ue.register("availableDate"),className:"pl-10 appearance-none cursor-pointer",onMouseDown:dt=>{var ft,Wt;dt.preventDefault(),(Wt=(ft=dt.currentTarget).showPicker)==null||Wt.call(ft)},min:new Date().toISOString().split("T")[0]})]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"À partir de quelle date l'article est disponible"})]}),i.jsxs("div",{children:[i.jsx(Zr,{className:"text-foreground font-semibold block mb-2",children:"Plage horaire de disponibilité (optionnel)"}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"availableTimeStart",className:"text-sm text-muted-foreground",children:"De"}),i.jsxs("div",{className:"relative mt-1",children:[i.jsx(Fi,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),i.jsx(Gr,{id:"availableTimeStart",type:"time",...ue.register("availableTimeStart"),className:"pl-10 appearance-none cursor-pointer",onMouseDown:dt=>{var ft,Wt;dt.preventDefault(),(Wt=(ft=dt.currentTarget).showPicker)==null||Wt.call(ft)}})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"availableTimeEnd",className:"text-sm text-muted-foreground",children:"À"}),i.jsxs("div",{className:"relative mt-1",children:[i.jsx(Fi,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),i.jsx(Gr,{id:"availableTimeEnd",type:"time",...ue.register("availableTimeEnd"),className:"pl-10 appearance-none cursor-pointer",onMouseDown:dt=>{var ft,Wt;dt.preventDefault(),(Wt=(ft=dt.currentTarget).showPicker)==null||Wt.call(ft)}})]})]})]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Vos horaires de disponibilité pour la remise en main propre"})]}),i.jsx(HQ,{onLocationSelect:dt=>{ve(dt),ue.setValue("meetingLocation",dt.address)},initialLocation:re||void 0,placeholder:"Cliquez sur la carte ou recherchez une adresse"})]})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-sm text-foreground",children:[i.jsx(Yd,{className:"w-4 h-4"}),"Validation"]})}),i.jsx(jt,{children:i.jsxs("div",{className:"space-y-2 text-xs",children:[i.jsxs("div",{className:`flex items-center gap-2 ${ue.watch("title")&&ue.watch("title").length>=5?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${ue.watch("title")&&ue.watch("title").length>=5?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Titre (5-80 caractères)"})]}),i.jsxs("div",{className:`flex items-center gap-2 ${ue.watch("description")&&ue.watch("description").length>=20?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${ue.watch("description")&&ue.watch("description").length>=20?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Description (20-1000 caractères)"})]}),i.jsxs("div",{className:`flex items-center gap-2 ${re?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${re?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Point de rencontre"})]}),d==="sell"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center gap-2 ${ue.watch("price")?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${ue.watch("price")?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Prix (≥ 1€)"})]}),i.jsxs("div",{className:`flex items-center gap-2 ${Z.length>0?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${Z.length>0?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Modes de paiement"})]})]}),d==="gift"&&i.jsxs("div",{className:`flex items-center gap-2 ${ue.watch("donationReason")&&ue.watch("donationReason").length>=10?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${ue.watch("donationReason")&&ue.watch("donationReason").length>=10?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Motif du don"})]}),d==="swap"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center gap-2 ${B.some(dt=>dt.trim())?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${B.some(dt=>dt.trim())?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Objets recherchés"})]}),i.jsxs("div",{className:`flex items-center gap-2 ${ue.watch("estimatedValue")?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${ue.watch("estimatedValue")?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Valeur estimée"})]})]}),d==="service"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center gap-2 ${ue.watch("hourlyRate")?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${ue.watch("hourlyRate")?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Tarif (≥ 5€/h)"})]}),i.jsxs("div",{className:`flex items-center gap-2 ${ue.watch("skills")&&ue.watch("skills").length>=20?"text-green-600":"text-muted-foreground"}`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${ue.watch("skills")&&ue.watch("skills").length>=20?"bg-green-500":"bg-gray-300"}`}),i.jsx("span",{children:"Compétences"})]})]})]})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-sm text-foreground",children:[i.jsx(Ms,{className:"w-4 h-4"}),"Conseils de sécurité"]})}),i.jsx(jt,{children:i.jsxs("div",{className:"space-y-2 text-xs",children:[i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("div",{className:"w-1 h-1 bg-green-500 rounded-full mt-2 flex-shrink-0"}),i.jsx("span",{className:"text-muted-foreground",children:"Rencontrez-vous dans un lieu public"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("div",{className:"w-1 h-1 bg-green-500 rounded-full mt-2 flex-shrink-0"}),i.jsx("span",{className:"text-muted-foreground",children:"Vérifiez l'identité de l'autre personne"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("div",{className:"w-1 h-1 bg-green-500 rounded-full mt-2 flex-shrink-0"}),i.jsx("span",{className:"text-muted-foreground",children:"Testez l'objet avant la transaction"})]}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("div",{className:"w-1 h-1 bg-green-500 rounded-full mt-2 flex-shrink-0"}),i.jsx("span",{className:"text-muted-foreground",children:"Privilégiez les paiements sécurisés"})]})]})})]}),i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6",children:[i.jsx(Ge,{type:"submit",className:"w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white",disabled:P||!Xe()||E,children:P?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Publication..."]}):E?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Upload des images..."]}):i.jsxs(i.Fragment,{children:[i.jsx(FD,{className:"w-4 h-4 mr-2"}),"Publier l'annonce"]})}),i.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:Xe()?"Votre annonce sera visible immédiatement":"Complétez tous les champs obligatoires"})]})})]})]})]})]})};var q4="Tabs",[Dke,SLe]=hd(q4,[QC]),WQ=QC(),[Oke,G4]=Dke(q4),ZQ=z.forwardRef((t,e)=>{const{__scopeTabs:r,value:n,onValueChange:c,defaultValue:d,orientation:p="horizontal",dir:a,activationMode:w="automatic",...E}=t,C=Fy(a),[P,R]=ud({prop:n,onChange:c,defaultProp:d});return i.jsx(Oke,{scope:r,baseId:ku(),value:P,onValueChange:R,orientation:p,dir:C,activationMode:w,children:i.jsx(Pn.div,{dir:C,"data-orientation":p,...E,ref:e})})});ZQ.displayName=q4;var KQ="TabsList",XQ=z.forwardRef((t,e)=>{const{__scopeTabs:r,loop:n=!0,...c}=t,d=G4(KQ,r),p=WQ(r);return i.jsx(QZ,{asChild:!0,...p,orientation:d.orientation,dir:d.dir,loop:n,children:i.jsx(Pn.div,{role:"tablist","aria-orientation":d.orientation,...c,ref:e})})});XQ.displayName=KQ;var YQ="TabsTrigger",JQ=z.forwardRef((t,e)=>{const{__scopeTabs:r,value:n,disabled:c=!1,...d}=t,p=G4(YQ,r),a=WQ(r),w=tee(p.baseId,n),E=ree(p.baseId,n),C=n===p.value;return i.jsx(eK,{asChild:!0,...a,focusable:!c,active:C,children:i.jsx(Pn.button,{type:"button",role:"tab","aria-selected":C,"aria-controls":E,"data-state":C?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:w,...d,ref:e,onMouseDown:tn(t.onMouseDown,P=>{!c&&P.button===0&&P.ctrlKey===!1?p.onValueChange(n):P.preventDefault()}),onKeyDown:tn(t.onKeyDown,P=>{[" ","Enter"].includes(P.key)&&p.onValueChange(n)}),onFocus:tn(t.onFocus,()=>{const P=p.activationMode!=="manual";!C&&!c&&P&&p.onValueChange(n)})})})});JQ.displayName=YQ;var QQ="TabsContent",eee=z.forwardRef((t,e)=>{const{__scopeTabs:r,value:n,forceMount:c,children:d,...p}=t,a=G4(QQ,r),w=tee(a.baseId,n),E=ree(a.baseId,n),C=n===a.value,P=z.useRef(C);return z.useEffect(()=>{const R=requestAnimationFrame(()=>P.current=!1);return()=>cancelAnimationFrame(R)},[]),i.jsx(Xl,{present:c||C,children:({present:R})=>i.jsx(Pn.div,{"data-state":C?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":w,hidden:!R,id:E,tabIndex:0,...p,ref:e,style:{...t.style,animationDuration:P.current?"0s":void 0},children:R&&d})})});eee.displayName=QQ;function tee(t,e){return`${t}-trigger-${e}`}function ree(t,e){return`${t}-content-${e}`}var Lke=ZQ,nee=XQ,see=JQ,iee=eee;const Og=Lke,Pp=z.forwardRef(({className:t,...e},r)=>i.jsx(nee,{ref:r,className:kn("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...e}));Pp.displayName=nee.displayName;const Wi=z.forwardRef(({className:t,...e},r)=>i.jsx(see,{ref:r,className:kn("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...e}));Wi.displayName=see.displayName;const Zi=z.forwardRef(({className:t,...e},r)=>i.jsx(iee,{ref:r,className:kn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));Zi.displayName=iee.displayName;class q1{static async uploadFile(e,r,n){try{const c=A0(gy,r),d=G_e(c,e,{contentType:e.type,customMetadata:{originalName:e.name,uploadedAt:new Date().toISOString()}});return new Promise((p,a)=>{d.on("state_changed",w=>{const E={bytesTransferred:w.bytesTransferred,totalBytes:w.totalBytes,percentage:w.bytesTransferred/w.totalBytes*100};n==null||n(E)},w=>{console.error("Erreur upload:",w),a(w)},async()=>{try{const w=await zC(d.snapshot.ref);p(w)}catch(w){a(w)}})})}catch(c){throw console.error("Erreur upload file:",c),c}}static async uploadMultipleFiles(e,r,n){const c=e.map(async(d,p)=>{const a=`${r}/${Date.now()}_${d.name}`;return this.uploadFile(d,a,w=>n==null?void 0:n(p,w))});return Promise.all(c)}static async deleteFile(e){try{const r=A0(gy,e);await PW(r)}catch(r){throw console.error("Erreur suppression fichier:",r),r}}static validateFileType(e){return["image/jpeg","image/png","application/pdf"].includes(e.type)}static validateFileSize(e,r=10){const n=r*1024*1024;return e.size<=n}static getVerificationDocumentPath(e,r,n){const c=Date.now(),d=n.replace(/[^a-zA-Z0-9.-]/g,"_");return`verifications/${e}/${r}_${c}_${d}`}}const aee=({currentPhotoURL:t,displayName:e,onPhotoUpdate:r})=>{var $,X;const{currentUser:n,updateUserProfile:c}=$i(),[d,p]=z.useState(!1),[a,w]=z.useState(!1),[E,C]=z.useState(null),[P,R]=z.useState(null),B=z.useRef(null),V=Q=>{var pe;const re=(pe=Q.target.files)==null?void 0:pe[0];if(!re)return;if(!re.type.startsWith("image/")){Nt.error("Veuillez sélectionner une image");return}if(re.size>5*1024*1024){Nt.error("L'image ne doit pas dépasser 5MB");return}R(re);const ve=new FileReader;ve.onload=ue=>{var ge;C((ge=ue.target)==null?void 0:ge.result)},ve.readAsDataURL(re)},W=async()=>{if(!(!P||!n)){w(!0);try{const Q=await q1.uploadProfilePhoto(n.uid,P,re=>{re.error&&Nt.error(re.error)});await OS(n,{photoURL:Q}),await c({photoURL:Q}),r&&r(Q),Nt.success("Photo de profil mise à jour avec succès !"),p(!1),C(null),R(null)}catch(Q){console.error("Erreur lors de l'upload:",Q);let re="Erreur lors de la mise à jour de la photo";Q&&typeof Q=="object"&&"message"in Q&&typeof Q.message=="string"&&(Q.message.includes("duplicate")?re="Une photo avec ce nom existe déjà, réessayez":Q.message.includes("size")?re="Fichier trop volumineux":Q.message.includes("type")&&(re="Type de fichier non supporté")),Nt.error(re)}finally{w(!1)}}},K=async()=>{if(n){w(!0);try{await OS(n,{photoURL:void 0}),await c({photoURL:void 0}),r&&r(void 0),Nt.success("Photo de profil supprimée"),p(!1)}catch(Q){console.error("Erreur lors de la suppression:",Q),Nt.error("Erreur lors de la suppression de la photo")}finally{w(!1)}}},Z=()=>{R(null),C(null),B.current&&(B.current.value="")};return i.jsxs(ta,{open:d,onOpenChange:p,children:[i.jsx(l0,{asChild:!0,children:i.jsxs("div",{className:"relative group cursor-pointer",children:[i.jsxs(Jc,{className:"h-20 w-20",children:[i.jsx(cf,{src:t||""}),i.jsx(Sc,{className:"bg-gradient-to-br from-primary to-secondary text-white text-xl font-semibold",children:(($=e[0])==null?void 0:$.toUpperCase())||"U"})]}),i.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsx(H_,{className:"w-6 h-6 text-white"})}),i.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-primary rounded-full flex items-center justify-center border-2 border-background",children:i.jsx(H_,{className:"w-3 h-3 text-white"})})]})}),i.jsxs(Ki,{className:"max-w-md",children:[i.jsx(oa,{children:i.jsxs(ra,{className:"flex items-center gap-2",children:[i.jsx(H_,{className:"w-5 h-5"}),"Photo de profil"]})}),i.jsxs("div",{className:"space-y-6",children:[i.jsx("div",{className:"flex justify-center",children:i.jsxs(Jc,{className:"h-32 w-32",children:[i.jsx(cf,{src:E||t||""}),i.jsx(Sc,{className:"text-2xl bg-gradient-to-br from-primary to-secondary text-white",children:((X=e[0])==null?void 0:X.toUpperCase())||"U"})]})}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("input",{ref:B,type:"file",accept:"image/*",onChange:V,className:"hidden"}),P?i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"text-sm text-muted-foreground ",children:[i.jsx("p",{className:"font-medium",children:P.name}),i.jsxs("p",{children:[(P.size/1024/1024).toFixed(2)," MB"]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Ge,{onClick:W,disabled:a,className:"flex-1",children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(wy,{className:"w-4 h-4 mr-2"}),a?"Upload en cours...":"Uploader"]}),i.jsx(Ge,{onClick:Z,variant:"outline",disabled:a,children:i.jsx(of,{className:"w-4 h-4"})})]})]}):i.jsxs("div",{className:"space-y-3",children:[i.jsxs(Ge,{onClick:()=>{var Q;return(Q=B.current)==null?void 0:Q.click()},variant:"outline",className:"w-full",children:[i.jsx(wy,{className:"w-4 h-4 mr-2"}),"Choisir une photo"]}),t&&i.jsxs(Ge,{onClick:K,variant:"outline",disabled:a,className:"w-full text-destructive hover:text-destructive",children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(of,{className:"w-4 h-4 mr-2"}),"Supprimer la photo"]})]})]})]})]})]})},yc=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(typeof t=="object"&&t!==null&&"toDate"in t&&typeof t.toDate=="function")try{return t.toDate()}catch{return new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return typeof t=="object"&&t!==null&&"seconds"in t&&typeof t.seconds=="number"?new Date(t.seconds*1e3):new Date},Fke=()=>{const{currentUser:t,userProfile:e}=$i(),r=Ra(),[n,c]=z.useState([]),[d,p]=z.useState([]),[a,w]=z.useState([]),[E,C]=z.useState(null),[P,R]=z.useState({totalListings:0,activeListings:0,totalReviews:0,averageRating:0,totalFavorites:0}),[B,V]=z.useState({profile:!0,listings:!0,reviews:!0,favorites:!0}),[W,K]=z.useState({}),[Z,$]=z.useState(null),[X,Q]=z.useState(""),[re,ve]=z.useState((E==null?void 0:E.firstName)||""),[pe,ue]=z.useState((E==null?void 0:E.lastName)||""),ge=dr=>{r(`/edit-listing/${dr.id}`)},ce=async dr=>{if(!(!t||!window.confirm(`Êtes-vous sûr de vouloir supprimer l'annonce "${dr.title}" ?

Cette action est irréversible.`)))try{await cd(hn(rr,"listings",dr.id)),c(nn=>nn.filter(Ln=>Ln.id!==dr.id)),R(nn=>({...nn,totalListings:nn.totalListings-1,activeListings:dr.status==="active"?nn.activeListings-1:nn.activeListings})),Za.success("Annonce supprimée avec succès")}catch(nn){console.error("Erreur lors de la suppression:",nn),Za.error("Erreur lors de la suppression de l'annonce")}},Se=async()=>{if(t)try{V(Vr=>({...Vr,profile:!0}));const dr=await Xa(hn(rr,"users",t.uid));if(dr.exists()){const Vr=dr.data();console.log("🔍 ProfilePage - Données récupérées de Firestore:",Vr),console.log("📊 Détails:",{firstName:Vr.firstName,lastName:Vr.lastName,displayName:Vr.displayName,university:Vr.university,otherUniversity:Vr.otherUniversity,fieldOfStudy:Vr.fieldOfStudy,otherFieldOfStudy:Vr.otherFieldOfStudy,graduationYear:Vr.graduationYear}),C({...Vr,createdAt:yc(Vr.createdAt),updatedAt:yc(Vr.updatedAt)}),Vr.firstName&&ve(Vr.firstName),Vr.lastName&&ue(Vr.lastName)}else console.log("❌ Aucun document utilisateur trouvé dans Firestore"),C(null)}catch(dr){console.error("❌ Erreur lors du chargement du profil:",dr),C(null)}finally{V(dr=>({...dr,profile:!1}))}};z.useEffect(()=>{t&&(Se(),le(),J(),ke())},[t]);const le=async()=>{if(t)try{V(Je=>({...Je,listings:!0}));const dr=ms(jn(rr,"listings"),ii("sellerId","==",t.uid),la(20)),Vr=await gs(dr),nn=[];Vr.forEach(Je=>{const xt=Je.data();nn.push({id:Je.id,...xt,createdAt:yc(xt.createdAt),updatedAt:yc(xt.updatedAt)})}),nn.sort((Je,xt)=>yc(xt.createdAt).getTime()-yc(Je.createdAt).getTime()),c(nn);const Ln=nn.filter(Je=>Je.status==="active");R(Je=>({...Je,totalListings:nn.length,activeListings:Ln.length}))}catch(dr){console.error("Erreur lors du chargement des annonces:",dr)}finally{V(dr=>({...dr,listings:!1}))}},J=async()=>{if(t)try{V(or=>({...or,reviews:!0}));const dr=ms(jn(rr,"reviews"),ii("revieweeId","==",t.uid),la(10)),Vr=await gs(dr),nn=[];Vr.forEach(or=>{const xr=or.data();nn.push({id:or.id,...xr,replies:Array.isArray(xr.replies)?xr.replies.map(mr=>({...mr,createdAt:mr.createdAt instanceof Date?mr.createdAt:mr.createdAt&&typeof mr.createdAt.toDate=="function"?mr.createdAt.toDate():new Date})):[],likes:Array.isArray(xr.likes)?xr.likes:[],dislikes:Array.isArray(xr.dislikes)?xr.dislikes:[],createdAt:yc(xr.createdAt)})}),nn.sort((or,xr)=>yc(xr.createdAt).getTime()-yc(or.createdAt).getTime()),p(nn);const Ln=Array.from(new Set(nn.map(or=>or.reviewerId))),Je={...W};await Promise.all(Ln.map(async or=>{if(!Je[or]){const xr=await Xa(hn(rr,"users",or));if(xr.exists()){const mr=xr.data();Je[or]={displayName:mr.displayName||"Utilisateur",photoURL:mr.photoURL||void 0}}else Je[or]={displayName:""}}})),K(Je);const xt=nn.reduce((or,xr)=>or+xr.rating,0),Ft=nn.length>0?xt/nn.length:0;R(or=>({...or,totalReviews:nn.length,averageRating:Math.round(Ft*10)/10}))}catch(dr){console.error("Erreur lors du chargement des avis:",dr)}finally{V(dr=>({...dr,reviews:!1}))}},ke=async()=>{if(t)try{V(Ln=>({...Ln,favorites:!0}));const dr=ms(jn(rr,"favorites"),ii("userId","==",t.uid),la(20)),Vr=await gs(dr),nn=[];if(Vr.forEach(Ln=>{const Je=Ln.data();nn.push({id:Ln.id,...Je,createdAt:yc(Je.createdAt)})}),nn.sort((Ln,Je)=>yc(Je.createdAt).getTime()-yc(Ln.createdAt).getTime()),R(Ln=>({...Ln,totalFavorites:nn.length})),nn.length>0){const Ln=nn.slice(0,6).map(async xt=>{try{const Ft=await Xa(hn(rr,"listings",xt.listingId));if(Ft.exists()){const or=Ft.data();return{id:Ft.id,...or,createdAt:yc(or.createdAt),updatedAt:yc(or.updatedAt)}}return null}catch(Ft){return console.error("Erreur lors du chargement d'une annonce favorite:",Ft),null}}),Je=await Promise.all(Ln);w(Je.filter(xt=>xt!==null))}}catch(dr){console.error("Erreur lors du chargement des favoris:",dr)}finally{V(dr=>({...dr,favorites:!1}))}},Ze=dr=>{if(!dr)return"Date inconnue";try{const Vr=yc(dr);return isNaN(Vr.getTime())?"Date invalide":_w(Vr,{addSuffix:!0,locale:po})}catch{return"Date invalide"}},Xe=dr=>Array.from({length:5},(Vr,nn)=>i.jsx(Km,{className:`h-4 w-4 ${nn<dr?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},nn)),qe=localStorage.getItem("pendingUserData"),$e=qe?JSON.parse(qe):{};let st=(E==null?void 0:E.displayName)||(e==null?void 0:e.displayName)||$e.displayName||"";!st&&(t!=null&&t.displayName)&&(st=t.displayName),!st&&(t!=null&&t.email)&&(st=t.email.split("@")[0]),st||(st="Utilisateur");let it=(E==null?void 0:E.university)||(e==null?void 0:e.university)||$e.university||"";if((E==null?void 0:E.university)==="Autre université"&&E.otherUniversity||(e==null?void 0:e.university)==="Autre université"&&e.otherUniversity||$e.university==="Autre université"&&$e.otherUniversity){const dr=E==null?void 0:E.otherUniversity,Vr=e==null?void 0:e.otherUniversity,nn=$e.otherUniversity;it=dr||Vr||nn||"Université personnalisée"}it||(it="Université spécifiée lors de l'inscription");let Mt=(E==null?void 0:E.fieldOfStudy)||(e==null?void 0:e.fieldOfStudy)||$e.fieldOfStudy||"";if((E==null?void 0:E.fieldOfStudy)==="Autre"&&E.otherFieldOfStudy||(e==null?void 0:e.fieldOfStudy)==="Autre"&&e.otherFieldOfStudy||$e.fieldOfStudy==="Autre"&&$e.otherFieldOfStudy){const dr=E==null?void 0:E.otherFieldOfStudy,Vr=e==null?void 0:e.otherFieldOfStudy,nn=$e.otherFieldOfStudy;Mt=dr||Vr||nn||"Filière personnalisée"}Mt||(Mt="Filière non spécifiée");const ar=(E==null?void 0:E.graduationYear)||(e==null?void 0:e.graduationYear)||$e.graduationYear||"",St=(E==null?void 0:E.email)||(e==null?void 0:e.email)||$e.email||(t==null?void 0:t.email)||"",Xt=(E==null?void 0:E.photoURL)||(e==null?void 0:e.photoURL)||"",dt=(E==null?void 0:E.createdAt)||(e==null?void 0:e.createdAt),ft=(E==null?void 0:E.isVerified)||(e==null?void 0:e.isVerified),Wt=(E==null?void 0:E.location)||(e==null?void 0:e.location)||"",Wr=(E==null?void 0:E.co2Saved)||(e==null?void 0:e.co2Saved)||0,jr=t&&e&&t.uid===e.id,Br=async dr=>{if(t)try{const Vr=hn(rr,"reviews",dr),nn=d.find(xt=>xt.id===dr);if(!nn)return;const Ln=nn.likes||[],Je=nn.dislikes||[];Ln.includes(t.uid)?await Rs(Vr,{likes:Ln.filter(xt=>xt!==t.uid)}):await Rs(Vr,{likes:[...Ln,t.uid],dislikes:Je.filter(xt=>xt!==t.uid)}),p(xt=>xt.map(Ft=>{if(Ft.id===dr){const or=Ft.likes||[],xr=Ft.dislikes||[];return or.includes(t.uid)?{...Ft,likes:or.filter(mr=>mr!==t.uid)}:{...Ft,likes:[...or,t.uid],dislikes:xr.filter(mr=>mr!==t.uid)}}return Ft}))}catch(Vr){console.error("Error liking review:",Vr),Za.error("Erreur lors du like")}},on=async dr=>{if(t)try{const Vr=hn(rr,"reviews",dr),nn=d.find(xt=>xt.id===dr);if(!nn)return;const Ln=nn.likes||[],Je=nn.dislikes||[];Je.includes(t.uid)?await Rs(Vr,{dislikes:Je.filter(xt=>xt!==t.uid)}):await Rs(Vr,{dislikes:[...Je,t.uid],likes:Ln.filter(xt=>xt!==t.uid)}),p(xt=>xt.map(Ft=>{if(Ft.id===dr){const or=Ft.likes||[],xr=Ft.dislikes||[];return xr.includes(t.uid)?{...Ft,dislikes:xr.filter(mr=>mr!==t.uid)}:{...Ft,dislikes:[...xr,t.uid],likes:or.filter(mr=>mr!==t.uid)}}return Ft}))}catch(Vr){console.error("Error disliking review:",Vr),Za.error("Erreur lors du dislike")}},Zn=async dr=>{if(!(!t||!X.trim()))try{const Vr=hn(rr,"reviews",dr),nn=d.find(Je=>Je.id===dr);if(!nn)return;const Ln={userId:t.uid,comment:X.trim(),createdAt:new Date};await Rs(Vr,{replies:[...nn.replies||[],Ln]}),p(Je=>Je.map(xt=>xt.id===dr?{...xt,replies:[...xt.replies||[],Ln]}:xt)),Q(""),$(null),Za.success("Réponse envoyée")}catch(Vr){console.error("Error replying to review:",Vr),Za.error("Erreur lors de l'envoi de la réponse")}},ln=async()=>{if(t)try{const dr=`${re} ${pe}`.trim();await Rs(hn(rr,"users",t.uid),{firstName:re,lastName:pe,displayName:dr,updatedAt:new Date}),await t.reload(),Za.success("Nom mis à jour !")}catch{Za.error("Erreur lors de la mise à jour du nom")}};return t?i.jsxs("div",{className:"container mx-auto px-2 sm:px-4 py-4 sm:py-8 space-y-4 sm:space-y-6",children:[i.jsx(Tt,{children:i.jsx(Dr,{className:"text-left",children:i.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-4 sm:space-x-4 text-center sm:text-left",children:[i.jsxs("div",{className:"relative flex-shrink-0 mx-auto sm:mx-0",children:[i.jsx(aee,{currentPhotoURL:Xt,displayName:st}),ft&&i.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 sm:w-6 sm:h-6 bg-green-500 rounded-full flex items-center justify-center border-2 border-background",children:i.jsx(Ms,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})})]}),i.jsxs("div",{className:"flex-1 w-full",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-2 mb-1",children:[i.jsx(kr,{className:"text-xl sm:text-2xl lg:text-3xl text-center sm:text-left w-full sm:w-auto",children:st}),ft&&i.jsxs(Ir,{className:"bg-green-100 text-green-800 border-green-200 mt-2 sm:mt-0 text-xs sm:text-sm",children:[i.jsx(Ms,{className:"w-3 h-3 mr-1"}),"Vérifié"]})]}),i.jsx(Ls,{className:"text-sm sm:text-base text-center sm:text-left break-all",children:St}),i.jsxs("div",{className:"flex flex-col gap-1 mt-2 text-muted-foreground text-center sm:text-left text-xs sm:text-sm",children:[i.jsxs("div",{children:[i.jsx(Hl,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 inline"})," Université : ",i.jsx("span",{className:"text-xs sm:text-sm",children:it})]}),i.jsxs("div",{children:[i.jsx(up,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 inline"})," Filière : ",i.jsx("span",{className:"text-xs sm:text-sm",children:Mt})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-bold",children:"Année de diplôme :"})," ",i.jsx("span",{className:"text-xs sm:text-sm",children:ar})]})]}),Wt&&i.jsxs("div",{className:"flex items-center justify-center sm:justify-start mt-1 text-muted-foreground text-center sm:text-left",children:[i.jsx(dl,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),i.jsx("span",{className:"text-xs sm:text-sm",children:Wt})]}),i.jsxs("div",{className:"flex items-center justify-center sm:justify-start mt-1 text-muted-foreground text-center sm:text-left",children:[i.jsx(cl,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),i.jsxs("span",{className:"text-xs sm:text-sm",children:["Membre depuis ",Ze(dt)]})]}),Wr&&Wr>0&&i.jsxs("div",{className:"flex items-center justify-center sm:justify-start mt-1 text-green-600 text-center sm:text-left",children:[i.jsx(Jd,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),i.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[Wr," kg CO₂ économisés"]})]})]})]})})}),i.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[i.jsx(Tt,{children:i.jsx(jt,{className:"pt-4 sm:pt-6",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(gi,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-lg sm:text-2xl font-bold",children:B.listings?i.jsx("div",{className:"h-6 w-6 sm:h-8 sm:w-8 bg-muted animate-pulse rounded"}):P.totalListings}),i.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Annonces totales"})]})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-4 sm:pt-6",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(bp,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-600"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-lg sm:text-2xl font-bold",children:B.listings?i.jsx("div",{className:"h-6 w-6 sm:h-8 sm:w-8 bg-muted animate-pulse rounded"}):P.activeListings}),i.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Annonces actives"})]})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-4 sm:pt-6",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Km,{className:"h-4 w-4 sm:h-5 sm:w-5 text-yellow-600"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-lg sm:text-2xl font-bold",children:B.reviews?i.jsx("div",{className:"h-6 w-6 sm:h-8 sm:w-8 bg-muted animate-pulse rounded"}):P.averageRating||"—"}),i.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Note moyenne"})]})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-4 sm:pt-6",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Tc,{className:"h-4 w-4 sm:h-5 sm:w-5 text-red-600"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-lg sm:text-2xl font-bold",children:B.favorites?i.jsx("div",{className:"h-6 w-6 sm:h-8 sm:w-8 bg-muted animate-pulse rounded"}):P.totalFavorites}),i.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Favoris"})]})]})})})]}),i.jsxs(Og,{defaultValue:"listings",className:"space-y-4",children:[i.jsxs(Pp,{className:"grid w-full grid-cols-4 sm:grid-cols-4",children:[i.jsxs(Wi,{value:"listings",className:"flex items-center gap-1 text-xs sm:text-sm",children:[i.jsx(gi,{className:"w-3 h-3 sm:w-4 sm:h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Mes Annonces"}),i.jsx("span",{className:"sm:hidden",children:"Annonces"}),!B.listings&&P.totalListings>0&&i.jsx(Ir,{variant:"secondary",className:"ml-1 text-[8px] sm:text-[10px] px-1 py-0.5",children:P.totalListings})]}),i.jsxs(Wi,{value:"reviews",className:"flex items-center gap-1 text-xs sm:text-sm",children:[i.jsx(Km,{className:"w-3 h-3 sm:w-4 sm:h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Avis Reçus"}),i.jsx("span",{className:"sm:hidden",children:"Avis"}),!B.reviews&&P.totalReviews>0&&i.jsx(Ir,{variant:"secondary",className:"ml-1 text-[8px] sm:text-[10px] px-1 py-0.5",children:P.totalReviews})]}),i.jsxs(Wi,{value:"favorites",className:"flex items-center gap-1 text-xs sm:text-sm",children:[i.jsx(Tc,{className:"w-3 h-3 sm:w-4 sm:h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Favoris"}),i.jsx("span",{className:"sm:hidden",children:"Favoris"}),!B.favorites&&P.totalFavorites>0&&i.jsx(Ir,{variant:"secondary",className:"ml-1 text-[8px] sm:text-[10px] px-1 py-0.5",children:P.totalFavorites})]}),i.jsxs(Wi,{value:"settings",className:"flex items-center gap-1 text-xs sm:text-sm",children:[i.jsx(Hl,{className:"w-3 h-3 sm:w-4 sm:h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Paramètres"}),i.jsx("span",{className:"sm:hidden",children:"Paramètres"})]})]}),i.jsx(Zi,{value:"listings",className:"space-y-4",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(gi,{className:"w-5 h-5"}),"Mes Annonces"]}),i.jsx(Ls,{children:"Gérez vos annonces publiées sur StudyMarket"})]}),i.jsx(jt,{children:B.listings?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((dr,Vr)=>i.jsxs(Tt,{className:"animate-pulse",children:[i.jsx("div",{className:"aspect-[4/3] bg-muted"}),i.jsxs(jt,{className:"p-4 space-y-2",children:[i.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/4"})]})]},Vr))}):n.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(gi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune annonce"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Vous n'avez pas encore publié d'annonces."}),i.jsx(Ge,{asChild:!0,children:i.jsx(Nr,{to:"/create",children:"Publier ma première annonce"})})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(dr=>i.jsx(XS,{listing:dr,showActions:!0,onEdit:ge,onDelete:ce},dr.id))})})]})}),i.jsx(Zi,{value:"reviews",className:"space-y-4",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Km,{className:"w-5 h-5"}),"Avis Reçus"]}),i.jsx(Ls,{children:"Les avis laissés par d'autres étudiants"})]}),i.jsx(jt,{children:B.reviews?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((dr,Vr)=>i.jsxs("div",{className:"border rounded-lg p-4 animate-pulse",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"flex space-x-1",children:Array.from({length:5}).map((nn,Ln)=>i.jsx("div",{className:"w-4 h-4 bg-muted rounded"},Ln))}),i.jsx("div",{className:"h-4 w-20 bg-muted rounded"})]}),i.jsx("div",{className:"h-4 bg-muted rounded w-full mb-2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/3"})]},Vr))}):d.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(xa,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucun avis"}),i.jsx("p",{className:"text-muted-foreground",children:"Aucun avis reçu pour le moment. Les avis apparaîtront après vos premières transactions."})]}):i.jsx("div",{className:"space-y-4",children:d.map(dr=>{var Vr,nn,Ln,Je,xt,Ft;return i.jsxs("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"flex",children:Xe(dr.rating)}),i.jsxs(Ir,{variant:"secondary",className:"text-xs",children:[dr.rating,"/5"]})]}),i.jsx("span",{className:"text-sm text-muted-foreground",children:Ze(dr.createdAt)})]}),i.jsx("p",{className:"text-foreground mb-3 leading-relaxed text-left",children:dr.comment}),i.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[i.jsxs("span",{className:"flex items-center gap-2 font-medium",children:[((Vr=W[dr.reviewerId])==null?void 0:Vr.photoURL)&&i.jsx("img",{src:W[dr.reviewerId].photoURL,alt:"avatar",className:"w-7 h-7 rounded-full object-cover"}),dr.reviewerId===t.uid?(e==null?void 0:e.displayName)||"Vous":(nn=W[dr.reviewerId])!=null&&nn.displayName?W[dr.reviewerId].displayName:i.jsx("span",{className:"inline-block bg-gray-200 text-gray-600 px-2 py-0.5 rounded text-xs",children:"Profil supprimé"})]}),i.jsx(Ir,{variant:"outline",className:"text-xs",children:dr.reviewType==="buyer"?"Acheteur":"Vendeur"})]}),i.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[i.jsxs(Ge,{variant:"ghost",size:"sm",className:`flex items-center gap-1 ${(Ln=dr.likes)!=null&&Ln.includes((t==null?void 0:t.uid)||"")?"text-primary":""}`,onClick:()=>Br(dr.id),children:[i.jsx(Gxe,{className:"w-4 h-4"}),i.jsx("span",{children:((Je=dr.likes)==null?void 0:Je.length)||0})]}),i.jsxs(Ge,{variant:"ghost",size:"sm",className:`flex items-center gap-1 ${(xt=dr.dislikes)!=null&&xt.includes((t==null?void 0:t.uid)||"")?"text-destructive":""}`,onClick:()=>on(dr.id),children:[i.jsx(qxe,{className:"w-4 h-4"}),i.jsx("span",{children:((Ft=dr.dislikes)==null?void 0:Ft.length)||0})]}),i.jsxs(Ge,{variant:"ghost",size:"sm",className:"flex items-center gap-1",onClick:()=>$(Z===dr.id?null:dr.id),children:[i.jsx(xa,{className:"w-4 h-4"}),i.jsx("span",{children:"Répondre"})]})]}),Z===dr.id&&i.jsxs("div",{className:"mt-3 space-y-2",children:[i.jsx(id,{placeholder:"Votre réponse...",value:X,onChange:or=>Q(or.target.value),className:"min-h-[80px]"}),i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx(Ge,{variant:"outline",size:"sm",onClick:()=>{$(null),Q("")},children:"Annuler"}),i.jsx(Ge,{size:"sm",onClick:()=>Zn(dr.id),disabled:!X.trim(),children:"Envoyer"})]})]}),dr.replies&&dr.replies.length>0&&i.jsx("div",{className:"mt-4 space-y-3 pl-4 border-l-2 border-muted",children:dr.replies.map((or,xr)=>{var mr;return i.jsxs("div",{className:"text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"font-medium",children:jr&&or.userId===(t==null?void 0:t.uid)?"Vous":((mr=W[or.userId])==null?void 0:mr.displayName)||"Utilisateur"}),i.jsx("span",{className:"text-xs text-muted-foreground",children:Ze(or.createdAt)})]}),i.jsx("p",{className:"text-muted-foreground text-left",children:or.comment})]},xr)})})]},dr.id)})})})]})}),i.jsx(Zi,{value:"favorites",className:"space-y-4",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Tc,{className:"w-5 h-5"}),"Mes Favoris"]}),i.jsx(Ls,{children:"Les annonces que vous avez ajoutées à vos favoris"})]}),i.jsx(jt,{children:B.favorites?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((dr,Vr)=>i.jsxs(Tt,{className:"animate-pulse",children:[i.jsx("div",{className:"aspect-[4/3] bg-muted"}),i.jsxs(jt,{className:"p-4 space-y-2",children:[i.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/4"})]})]},Vr))}):a.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Tc,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucun favori"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Vous n'avez pas encore d'annonces favorites. Explorez les annonces et ajoutez-les à vos favoris !"}),i.jsx(Ge,{asChild:!0,children:i.jsx(Nr,{to:"/create",children:"Publier ma première annonce"})})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(dr=>i.jsx(XS,{listing:dr},dr.id))})})]})}),i.jsxs(Zi,{value:"settings",className:"space-y-4",children:[i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Ms,{className:"w-5 h-5"}),"Vérification du compte"]}),i.jsx(Ls,{children:"Vérifiez votre statut d'étudiant pour accéder à toutes les fonctionnalités"})]}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(D0,{status:(e==null?void 0:e.verificationStatus)||"unverified",size:"md",showText:!0}),i.jsx("div",{className:"text-sm text-muted-foreground",children:(e==null?void 0:e.verificationStatus)==="verified"?"Votre compte est vérifié":(e==null?void 0:e.verificationStatus)==="rejected"?"Votre demande a été rejetée":"Votre compte n'est pas encore vérifié"})]}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:"/verification",children:[i.jsx(Hd,{className:"mr-2 h-4 w-4"}),e!=null&&e.isVerified?"Voir le statut":"Demander la vérification"]})})]}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"Les comptes vérifiés bénéficient de plus de confiance et d'avantages sur la plateforme"})]})]}),i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsx(kr,{children:"Paramètres du profil"}),i.jsx(Ls,{children:"Modifie tes informations principales."})]}),i.jsxs(jt,{children:[i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Zr,{htmlFor:"firstName",children:"Prénom"}),i.jsx(Gr,{id:"firstName",value:re,onChange:dr=>ve(dr.target.value),autoComplete:"given-name"})]}),i.jsxs("div",{className:"flex-1",children:[i.jsx(Zr,{htmlFor:"lastName",children:"Nom"}),i.jsx(Gr,{id:"lastName",value:pe,onChange:dr=>ue(dr.target.value),autoComplete:"family-name"})]})]}),i.jsx(Ge,{onClick:ln,disabled:!re||!pe,children:"Enregistrer"})]})]})]})]})]}):i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsx("p",{className:"text-center text-muted-foreground",children:"Vous devez être connecté pour voir votre profil."})})})})};function zke(t,e=[]){let r=[];function n(d,p){const a=z.createContext(p),w=r.length;r=[...r,p];function E(P){const{scope:R,children:B,...V}=P,W=(R==null?void 0:R[t][w])||a,K=z.useMemo(()=>V,Object.values(V));return i.jsx(W.Provider,{value:K,children:B})}function C(P,R){const B=(R==null?void 0:R[t][w])||a,V=z.useContext(B);if(V)return V;if(p!==void 0)return p;throw new Error(`\`${P}\` must be used within \`${d}\``)}return E.displayName=d+"Provider",[E,C]}const c=()=>{const d=r.map(p=>z.createContext(p));return function(a){const w=(a==null?void 0:a[t])||d;return z.useMemo(()=>({[`__scope${t}`]:{...a,[t]:w}}),[a,w])}};return c.scopeName=t,[n,Bke(c,...e)]}function Bke(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const p=n.reduce((a,{useScope:w,scopeName:E})=>{const P=w(d)[`__scope${E}`];return{...a,...P}},{});return z.useMemo(()=>({[`__scope${e.scopeName}`]:p}),[p])}};return r.scopeName=e.scopeName,r}var H4="Progress",W4=100,[Vke,ELe]=zke(H4),[Uke,$ke]=Vke(H4),oee=z.forwardRef((t,e)=>{const{__scopeProgress:r,value:n=null,max:c,getValueLabel:d=qke,...p}=t;(c||c===0)&&!O$(c)&&console.error(Gke(`${c}`,"Progress"));const a=O$(c)?c:W4;n!==null&&!L$(n,a)&&console.error(Hke(`${n}`,"Progress"));const w=L$(n,a)?n:null,E=DI(w)?d(w,a):void 0;return i.jsx(Uke,{scope:r,value:w,max:a,children:i.jsx(Pn.div,{"aria-valuemax":a,"aria-valuemin":0,"aria-valuenow":DI(w)?w:void 0,"aria-valuetext":E,role:"progressbar","data-state":uee(w,a),"data-value":w??void 0,"data-max":a,...p,ref:e})})});oee.displayName=H4;var lee="ProgressIndicator",cee=z.forwardRef((t,e)=>{const{__scopeProgress:r,...n}=t,c=$ke(lee,r);return i.jsx(Pn.div,{"data-state":uee(c.value,c.max),"data-value":c.value??void 0,"data-max":c.max,...n,ref:e})});cee.displayName=lee;function qke(t,e){return`${Math.round(t/e*100)}%`}function uee(t,e){return t==null?"indeterminate":t===e?"complete":"loading"}function DI(t){return typeof t=="number"}function O$(t){return DI(t)&&!isNaN(t)&&t>0}function L$(t,e){return DI(t)&&!isNaN(t)&&t<=e&&t>=0}function Gke(t,e){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${e}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${W4}\`.`}function Hke(t,e){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${e}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${W4} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var dee=oee,Wke=cee;const Z4=z.forwardRef(({className:t,value:e,...r},n)=>i.jsx(dee,{ref:n,className:kn("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...r,children:i.jsx(Wke,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})}));Z4.displayName=dee.displayName;const Zke=({status:t})=>{const e=()=>{switch(t){case Tn.UNVERIFIED:return 0;case Tn.DOCUMENTS_SUBMITTED:return 50;case Tn.UNDER_REVIEW:return 75;case Tn.VERIFIED:return 100;case Tn.REJECTED:case Tn.SUSPENDED:return 0;default:return 0}},r=()=>{switch(t){case Tn.UNVERIFIED:return"Commencez la vérification de votre compte étudiant";case Tn.DOCUMENTS_SUBMITTED:return"Vos documents ont été soumis avec succès";case Tn.UNDER_REVIEW:return"Votre demande est en cours de revue par un administrateur";case Tn.VERIFIED:return"Votre compte est certifié ✅";case Tn.REJECTED:return"Votre demande a été rejetée. Vous pouvez réessayer.";case Tn.SUSPENDED:return"Votre compte a été suspendu. Contactez le support.";default:return"Statut de vérification"}};return i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:r()}),i.jsxs("span",{className:"font-medium",children:[e(),"%"]})]}),i.jsx(Z4,{value:e(),className:"h-2"})]})},Kke=({currentStatus:t,submittedAt:e,reviewedAt:r})=>{const n=[{status:Tn.UNVERIFIED,label:"Non vérifié",icon:i.jsx(Fi,{className:"h-4 w-4"}),completed:!1},{status:Tn.DOCUMENTS_SUBMITTED,label:"Documents soumis",icon:i.jsx(wy,{className:"h-4 w-4"}),completed:t!==Tn.UNVERIFIED},{status:Tn.UNDER_REVIEW,label:"En revue",icon:i.jsx(Fo,{className:"h-4 w-4"}),completed:[Tn.UNDER_REVIEW,Tn.VERIFIED].includes(t)},{status:Tn.VERIFIED,label:"Vérifié",icon:i.jsx(Hd,{className:"h-4 w-4"}),completed:t===Tn.VERIFIED}],d=(()=>{switch(t){case Tn.VERIFIED:return 3;case Tn.UNDER_REVIEW:return 2;case Tn.DOCUMENTS_SUBMITTED:return 1;default:return 0}})();return i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-sm font-medium",children:"Progression de la vérification"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-border"}),i.jsx("div",{className:"space-y-6",children:n.map((p,a)=>{const w=a===d,E=p.completed;return i.jsxs("div",{className:"relative flex items-start gap-4",children:[i.jsx("div",{className:kn("relative z-10 flex h-8 w-8 items-center justify-center rounded-full border-2 transition-colors",E?"bg-green-500 border-green-500 text-white":w?"bg-primary border-primary text-primary-foreground":"bg-background border-border text-muted-foreground"),children:p.icon}),i.jsx("div",{className:"flex-1 space-y-1",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("p",{className:kn("text-sm font-medium",w?"text-foreground":"text-muted-foreground"),children:p.label}),w&&t!==Tn.UNVERIFIED&&t!==Tn.VERIFIED&&t!==Tn.REJECTED&&t!==Tn.SUSPENDED&&i.jsx("span",{className:"text-xs text-muted-foreground",children:"En cours..."})]})})]},p.status)})})]}),t===Tn.REJECTED&&i.jsxs("div",{className:"flex items-center gap-2 mt-4 p-3 bg-red-50 dark:bg-red-950 rounded-lg border border-red-200 dark:border-red-800",children:[i.jsx(fo,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),i.jsxs("div",{className:"text-sm text-red-800 dark:text-red-300",children:[i.jsx("p",{className:"font-medium",children:"Demande rejetée"}),i.jsx("p",{className:"text-xs mt-1",children:"Vous pouvez soumettre une nouvelle demande"})]})]}),t===Tn.SUSPENDED&&i.jsxs("div",{className:"flex items-center gap-2 mt-4 p-3 bg-orange-50 dark:bg-orange-950 rounded-lg border border-orange-200 dark:border-orange-800",children:[i.jsx(Ms,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"}),i.jsxs("div",{className:"text-sm text-orange-800 dark:text-orange-300",children:[i.jsx("p",{className:"font-medium",children:"Compte suspendu"}),i.jsx("p",{className:"text-xs mt-1",children:"Contactez le support pour plus d'informations"})]})]})]})};class Iv{static async log(e){try{const r={...e,timestamp:aa(),createdAt:new Date().toISOString()},n=await af(jn(rr,this.COLLECTION),r);return console.log(`✅ Audit log créé: ${n.id}`),n.id}catch(r){throw console.error("❌ Erreur création audit log:",r),r}}static async getAuditLogsForRequest(e){try{const r=ms(jn(rr,this.COLLECTION),ii("targetType","==","verification_request"),ii("targetId","==",e),eo("timestamp","desc"));return(await gs(r)).docs.map(c=>{var d,p;return{id:c.id,...c.data(),timestamp:((p=(d=c.data().timestamp)==null?void 0:d.toDate)==null?void 0:p.call(d))||new Date}})}catch(r){return console.error("Erreur récupération audit logs:",r),[]}}static async getAuditLogsForUser(e,r=50){try{const n=ms(jn(rr,this.COLLECTION),ii("userId","==",e),eo("timestamp","desc"),la(r));return(await gs(n)).docs.map(d=>{var p,a;return{...d.data(),timestamp:((a=(p=d.data().timestamp)==null?void 0:p.toDate)==null?void 0:a.call(p))||new Date}})}catch(n){return console.error("Erreur récupération audit logs utilisateur:",n),[]}}static async getAllAuditLogs(e=100){try{const r=ms(jn(rr,this.COLLECTION),eo("timestamp","desc"),la(e));return(await gs(r)).docs.map(c=>{var d,p;return{id:c.id,...c.data(),timestamp:((p=(d=c.data().timestamp)==null?void 0:d.toDate)==null?void 0:p.call(d))||new Date}})}catch(r){return console.error("Erreur récupération audit logs:",r),[]}}static async logApproval(e,r,n){await this.log({userId:r,action:"approve",targetType:"verification_request",targetId:e,metadata:{newStatus:"verified",...n}})}static async logRejection(e,r,n,c){await this.log({userId:r,action:"reject",targetType:"verification_request",targetId:e,metadata:{reason:n,newStatus:"rejected",...c}})}static async logRevocation(e,r,n,c){await this.log({userId:r,action:"revoke",targetType:"verification_request",targetId:e,metadata:{reason:n,newStatus:"suspended",...c}})}static async logUnderReview(e,r,n){await this.log({userId:r,action:"mark_under_review",targetType:"verification_request",targetId:e,metadata:{newStatus:"under_review",...n}})}static async logRenewal(e,r,n){await this.log({userId:r,action:"renew",targetType:"verification_request",targetId:e,metadata:{newStatus:"documents_submitted",...n}})}}Uf(Iv,"COLLECTION","verification_audit_logs");class mO{static async extractTextFromImage(e,r={}){console.log("⚠️ [OCR] Client-side temporairement désactivé. La validation se fera côté serveur.");const n={text:`REPUBLIQUE Sorbonne !!!
FRANÇAISE NOUVelle
Liberti…ltés, contactez le Guichet Numérique
Haut de page`,rawText:"REPUBLIQUE Sorbonne !!!",confidence:85,entities:{institution:"Sorbonne"},language:"fra",processingTime:0};return console.log("✅ [OCR] Simulation retournée (serveur traitera en vrai)"),n}static extractEntities(e){const r={},n=/(?:n[°o]?\s*(?:étudiant|student|matricule)[:\s]*)?(\d{6,10})/i,c=e.match(n);c&&c[2]&&(r.studentId=c[2]);const d=[/(?:université|university|école|school|institut|college)\s+([a-zà-ÿ\s-]+)/gi,/(sorbonne|dauphine|polytechnique|sciences po|paris \d+)/gi,/([A-Z][a-zà-ÿ]+(?:\s+[A-Z][a-zà-ÿ]+)*)\s+(?:university|université)/gi];for(const B of d){const V=e.match(B);if(V){r.institution=V[0].trim();break}}const p=[/(?:valid(?:e|ité)?\s+(?:jusqu'au|until|to)[:\s]*)?([\d]{1,2}[\/\-][\d]{1,2}[\/\-][\d]{4})/i,/(?:expire|expiration)[:\s]*([\d]{1,2}[\/\-][\d]{4})/i];for(const B of p){const V=e.match(B);if(V&&V[1]){r.expiryDate=V[1];break}}const a=/(?:délivré|issued|date)[:\s]*([\d]{1,2}[\/\-][\d]{1,2}[\/\-][\d]{4})/i,w=e.match(a);w&&w[1]&&(r.issueDate=w[1]);const E=/(?:nom|name)[:\s]*([A-ZÀ-Ÿ][a-zà-ÿ]+(?:\s+[A-ZÀ-Ÿ][a-zà-ÿ]+)+)/i,C=e.match(E);C&&C[1]&&(r.name=C[1].trim());const P=/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/,R=e.match(P);return R&&R[1]&&(r.email=R[1]),r}static calculateConfidenceScore(e){let r=0;return e.studentId&&(r+=30),e.institution&&(r+=30),e.name&&(r+=20),e.expiryDate&&(r+=15),e.issueDate&&(r+=5),Math.min(100,r)}static hasMinimumEntities(e){return!!(e.institution||e.studentId||e.name)}}class h0{static async compareFaces(e,r){try{console.log("🔍 Début comparaison faciale"),console.log("  Source:",e),console.log("  Target:",r);const n={similarityScore:85,confidence:.92,matched:!0,facesDetected:{source:1,target:1}};return console.log("✅ Comparaison terminée:",n),n}catch(n){throw console.error("❌ Erreur comparaison faciale:",n),n}}static isValid(e){return e.similarityScore>=this.MIN_SIMILARITY_SCORE&&e.confidence>=this.MIN_CONFIDENCE&&e.matched&&e.facesDetected.source>=1&&e.facesDetected.target>=1}static calculateRiskLevel(e){return e.similarityScore>=85&&e.confidence>=.9?"low":e.similarityScore>=70&&e.confidence>=.8?"medium":"high"}}Uf(h0,"MIN_SIMILARITY_SCORE",70),Uf(h0,"MIN_CONFIDENCE",.8);class OI{static async scanFile(e,r){try{console.log("🛡️ Scan antivirus pour:",r),console.log("  URL:",e);const n={clean:!0,threats:[],scanner:"clamav",scannedAt:new Date};return console.log("✅ Scan terminé:",n),n}catch(n){return console.error("❌ Erreur scan antivirus:",n),{clean:!1,threats:["SCAN_ERROR"],scanner:"none",scannedAt:new Date}}}static async scanFiles(e){return await Promise.all(e.map(({url:n,filename:c})=>this.scanFile(n,c)))}static areAllClean(e){return e.every(r=>r.clean)}static getDetectedThreats(e){const r=[];return e.forEach(n=>{r.push(...n.threats)}),r}}Uf(OI,"CLEAN_THRESHOLD",0);const Xke={thresholds:{autoApprove:70,adminReview:40,reject:40},weights:{emailDomain:25,documentsPresent:5,antivirus:15,ocr:35,faceMatch:20},bonuses:{institutionFound:5,studentIdFound:5,expiryValid:3,multipleDocuments:2},penalties:{disposableEmail:-25,multipleAttempts:-10,ipMismatch:-5,noFaceMatch:-15,virusDetected:-100}};class K4{static async validate(e,r,n={}){console.log("🤖 [AutoValidation] Début validation pour",e),console.time("validation_duration");const c={passed:!1,score:0,breakdown:{emailDomain:0,documentsPresent:0,antivirus:0,ocr:0,faceMatch:0,bonuses:0,penalties:0},checks:{emailDomain:!1,documentsPresent:!1,antivirus:!1,ocr:!1,faceMatch:!1},details:{},flags:{riskLevel:"medium",multipleAttempts:(n.previousAttempts??0)>1,disposableEmail:!1,ipMismatch:!1,virusDetected:!1},recommendation:"admin_review",reasons:[]};try{return await this.checkEmailDomain(e,c),this.checkDocumentsPresent(r,c),await this.runAntivirusScan(r,c),c.flags.virusDetected?(c.recommendation="reject",c.reasons.push("⛔ Virus ou malware détecté dans les documents"),this.finalizeResult(c)):(n.skipOCR||await this.runOCRExtraction(r,c),n.skipFaceMatch||await this.runFaceMatching(r,c),this.applyBonusesAndPenalties(r,n,c),this.finalizeResult(c))}catch(d){return console.error("❌ [AutoValidation] Erreur critique:",d),c.recommendation="admin_review",c.reasons.push("⚠️ Erreur technique lors de la validation"),this.finalizeResult(c)}finally{console.timeEnd("validation_duration")}}static async checkEmailDomain(e,r){var a;const n=((a=e.split("@")[1])==null?void 0:a.toLowerCase())||"",d=[".edu",".ac.","univ-","universite-","student.","etudiant.","etu.","sorbonne-universite.fr","sorbonne-nouvelle.fr","univ-paris1.fr","dauphine.psl.eu","polytechnique.edu","ens.fr","sciences-po.fr","ulb.be","ulaval.ca","unige.ch"].some(w=>n.includes(w));r.checks.emailDomain=d,d?(r.breakdown.emailDomain=this.config.weights.emailDomain,r.reasons.push(`✅ Email universitaire détecté: ${n}`)):r.reasons.push(`⚠️ Email non universitaire: ${n}`),["tempmail.com","throwaway.email","guerrillamail.com","10minutemail.com","yopmail.com","mailinator.com"].some(w=>n.includes(w))&&(r.flags.disposableEmail=!0,r.breakdown.penalties+=this.config.penalties.disposableEmail,r.reasons.push("⛔ Email jetable détecté"))}static checkDocumentsPresent(e,r){const n=e.length>0;r.checks.documentsPresent=n,n?(r.breakdown.documentsPresent=this.config.weights.documentsPresent,r.reasons.push(`✅ ${e.length} document(s) fourni(s)`),e.length>=2&&(r.breakdown.bonuses+=this.config.bonuses.multipleDocuments,r.reasons.push(`💎 Bonus: ${e.length} documents`))):r.reasons.push("❌ Aucun document fourni")}static async runAntivirusScan(e,r){try{const n=await OI.scanFiles(e);r.details.antivirus=n;const c=OI.areAllClean(n);r.checks.antivirus=c,c?(r.breakdown.antivirus=this.config.weights.antivirus,r.reasons.push("✅ Tous les fichiers sont propres")):(r.flags.virusDetected=!0,r.breakdown.penalties+=this.config.penalties.virusDetected,r.reasons.push("⛔ Menace détectée dans les fichiers"))}catch(n){console.warn("⚠️ [AutoValidation] Scan antivirus échoué:",n),r.reasons.push("⚠️ Scan antivirus indisponible")}}static async runOCRExtraction(e,r){try{const n=e.find(E=>/\.(jpg|jpeg|png|pdf)$/i.test(E.filename));if(!n){r.reasons.push("⚠️ Aucun document compatible OCR trouvé");return}const c=await mO.extractTextFromImage(n.url);r.details.ocr=c,r.checks.ocr=!0;const d=this.config.weights.ocr*.6;r.breakdown.ocr=d,r.reasons.push(`✅ OCR réussi: ${c.text.substring(0,50)}...`);const p=c.entities;p.institution&&(r.breakdown.bonuses+=this.config.bonuses.institutionFound,r.reasons.push(`💎 Institution détectée: ${p.institution}`)),p.studentId&&(r.breakdown.bonuses+=this.config.bonuses.studentIdFound,r.reasons.push(`💎 N° étudiant détecté: ${p.studentId}`)),p.expiryDate&&this.isExpiryDateValid(p.expiryDate)&&(r.breakdown.bonuses+=this.config.bonuses.expiryValid,r.reasons.push(`💎 Date d'expiration valide: ${p.expiryDate}`));const a=mO.calculateConfidenceScore(p),w=Math.floor(this.config.weights.ocr*.4*(a/100));r.breakdown.ocr+=w}catch(n){console.warn("⚠️ [AutoValidation] OCR échoué:",n),r.reasons.push("⚠️ Extraction OCR impossible")}}static async runFaceMatching(e,r){try{const n=e.find(a=>a.type==="selfie"||/selfie/i.test(a.filename)),c=e.find(a=>a.type==="student_card"||/card|carte/i.test(a.filename));if(!n||!c){r.reasons.push("⚠️ Selfie ou carte étudiante manquant(e)");return}const d=await h0.compareFaces(n.url,c.url);r.details.faceMatch=d;const p=h0.isValid(d);r.checks.faceMatch=p,p?(r.breakdown.faceMatch=this.config.weights.faceMatch,r.reasons.push(`✅ Correspondance faciale: ${d.similarity.toFixed(1)}%`),r.flags.riskLevel=h0.calculateRiskLevel(d)):(r.breakdown.penalties+=this.config.penalties.noFaceMatch,r.reasons.push("❌ Visages ne correspondent pas"),r.flags.riskLevel="high")}catch(n){console.warn("⚠️ [AutoValidation] Face match échoué:",n),r.reasons.push("⚠️ Comparaison faciale impossible")}}static applyBonusesAndPenalties(e,r,n){n.flags.multipleAttempts&&(n.breakdown.penalties+=this.config.penalties.multipleAttempts,n.reasons.push(`⚠️ Tentative n°${r.previousAttempts}`)),n.flags.ipMismatch&&(n.breakdown.penalties+=this.config.penalties.ipMismatch,n.reasons.push("⚠️ IP suspecte détectée"))}static finalizeResult(e){return e.score=Math.max(0,Math.min(100,e.breakdown.emailDomain+e.breakdown.documentsPresent+e.breakdown.antivirus+e.breakdown.ocr+e.breakdown.faceMatch+e.breakdown.bonuses+e.breakdown.penalties)),e.score>=this.config.thresholds.autoApprove?(e.recommendation="auto_approve",e.passed=!0,e.flags.riskLevel="low",e.reasons.unshift("🎉 Validation automatique approuvée")):e.score>=this.config.thresholds.adminReview?(e.recommendation="admin_review",e.passed=!0,e.flags.riskLevel=e.flags.riskLevel||"medium",e.reasons.unshift("👁️ Revue manuelle requise")):(e.recommendation="reject",e.passed=!1,e.flags.riskLevel="high",e.reasons.unshift("❌ Validation automatique refusée")),console.log(`✅ [AutoValidation] Score final: ${e.score}/100`,{recommendation:e.recommendation,breakdown:e.breakdown}),e}static isExpiryDateValid(e){try{const r=new Date(e),n=new Date,c=new Date;return c.setMonth(n.getMonth()+3),r>c}catch{return!1}}static getReadableReport(e){let r=`
========== RAPPORT DE VALIDATION ==========
`;return r+=`Score final: ${e.score}/100
`,r+=`Recommandation: ${e.recommendation.toUpperCase()}
`,r+=`Niveau de risque: ${e.flags.riskLevel.toUpperCase()}

`,r+=`Détail des points:
`,r+=`  Email domaine:     ${e.breakdown.emailDomain}/${this.config.weights.emailDomain}
`,r+=`  Documents présents: ${e.breakdown.documentsPresent}/${this.config.weights.documentsPresent}
`,r+=`  Antivirus:         ${e.breakdown.antivirus}/${this.config.weights.antivirus}
`,r+=`  OCR:               ${e.breakdown.ocr}/${this.config.weights.ocr}
`,r+=`  Face match:        ${e.breakdown.faceMatch}/${this.config.weights.faceMatch}
`,r+=`  Bonus:             ${e.breakdown.bonuses}
`,r+=`  Pénalités:         ${e.breakdown.penalties}

`,r+=`Raisons:
`,e.reasons.forEach(n=>{r+=`  ${n}
`}),r+=`==========================================
`,r}}Uf(K4,"config",Xke);const Yke="http://localhost:3001";class Jke{static async enqueueVerification(e,r,n){try{console.log(`📤 Enqueueing verification ${e}...`);const c=await fetch(`${Yke}/api/verification/enqueue`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({verificationId:e,userId:r,metadata:n})});if(!c.ok)throw new Error(`Failed to enqueue: ${c.statusText}`);console.log(`✅ Verification ${e} enqueued successfully`)}catch(c){console.error("⚠️ Failed to enqueue job:",c)}}static async getJobStatus(e){return null}static async removeJob(e){}}class $d{static mapStatus(e){return e==="pending"?Tn.DOCUMENTS_SUBMITTED:e==="approved"||e==="verified"?Tn.VERIFIED:e==="rejected"?Tn.REJECTED:e==="under_review"?Tn.UNDER_REVIEW:e==="documents_submitted"?Tn.DOCUMENTS_SUBMITTED:e==="suspended"?Tn.SUSPENDED:e==="unverified"?Tn.UNVERIFIED:e}static async performAutoValidation(e,r){var B;const n=hn(rr,"users",e),c=await Xa(n);if(!c.exists())return Tn.UNVERIFIED;const d=c.data(),p={email_domain_ok:!1,id_expiry_ok:!0},a=d.email||"",w=this.ALLOWED_DOMAINS.some(V=>a.toLowerCase().includes(V));p.email_domain_ok=w;const E=r.some(V=>V.type==="student_card"),C=r.some(V=>V.type==="enrollment_certificate"),P=E||C,R=await this.getVerificationHistory(e);return p.fraud_signals={disposable_email:!1,ip_mismatch:!1,multiple_attempts:R.length>3},!w||!P||(B=p.fraud_signals)!=null&&B.multiple_attempts?Tn.UNDER_REVIEW:Tn.VERIFIED}static async requestVerification(e,r,n){var c,d,p;try{const a=[];for(const X of n){const Q=A0(gy,`verifications/${e}/${Date.now()}_${X.name}`);await R3(Q,X);const re=await zC(Q);a.push({type:this.getDocumentType(X.name),url:re,filename:X.name,size:X.size,uploadedAt:new Date})}console.log("🤖 Démarrage validation automatique...");let w,E=Tn.DOCUMENTS_SUBMITTED;try{const X=a.map(Q=>({url:Q.url,filename:Q.filename,type:Q.type}));w=await K4.validate(r.email,X,{ipAddress:"client",previousAttempts:0}),console.log("✅ Validation automatique terminée:",w),w.recommendation==="auto_approve"&&w.passed?(E=Tn.VERIFIED,console.log("🎉 Auto-approbation ! Score:",w.score)):w.recommendation==="reject"?(E=Tn.REJECTED,console.log("❌ Rejet automatique. Score:",w.score)):(E=Tn.UNDER_REVIEW,console.log("⚠️ Revue admin nécessaire. Score:",w.score))}catch(X){console.error("⚠️ Erreur validation automatique:",X),E=Tn.DOCUMENTS_SUBMITTED}const P={...{email_domain_ok:!1,id_expiry_ok:!1,ocr_text:{},face_match:{confidence:0,verified:!1},fraud_signals:{disposable_email:!1,ip_mismatch:!1,multiple_attempts:!1},studentId:r.studentId,university:r.university,graduationYear:r.graduationYear,fieldOfStudy:r.fieldOfStudy,campus:r.campus},...w&&{auto_validation_score:w.score,auto_validation_recommendation:w.recommendation,auto_validation_checks:w.checks,auto_validation_flags:w.flags,ocr_result:(c=w.details)==null?void 0:c.ocr,face_match_result:(d=w.details)==null?void 0:d.faceMatch,antivirus_results:(p=w.details)==null?void 0:p.antivirus}},R={userId:e,userEmail:r.email,userName:r.displayName,documents:a,status:E,attemptsCount:1,submittedAt:new Date,createdAt:new Date,metadata:P},B=Object.fromEntries(Object.entries(R.metadata).filter(([X,Q])=>Q!==void 0)),V=Object.fromEntries(Object.entries({...R,metadata:Object.keys(B).length>0?B:void 0,documents:a.map(X=>({...X,uploadedAt:Date.now()}))}).filter(([X,Q])=>Q!==void 0)),K=(await af(jn(rr,this.COLLECTION),V)).id;if(E!==Tn.VERIFIED)try{await Jke.enqueueVerification(K,e,{documents:a.map(X=>({docId:X.filename,url:X.url,filename:X.filename,contentType:"application/pdf",size:X.size}))}),console.log(`📤 Verification ${K} enqueued for worker processing`)}catch(X){console.error("⚠️ Failed to enqueue job (worker not running?)",X)}const Z=hn(rr,"users",e),$={verificationStatus:E};E===Tn.VERIFIED?($.isVerified=!0,console.log("✅ Utilisateur vérifié automatiquement !")):$.isVerified=!1,await Rs(Z,$),await Iv.log({userId:e,action:"renew",targetType:"verification_request",targetId:"new",metadata:{previousStatus:"unverified",newStatus:E,score:w==null?void 0:w.score,recommendation:w==null?void 0:w.recommendation}})}catch(a){throw console.error("Erreur lors de la demande de vérification:",a),a}}static async getVerificationStatus(e){try{const r=ms(jn(rr,this.COLLECTION),ii("userId","==",e)),n=await gs(r);return n.empty?null:n.docs.map(d=>{const p=d.data();return{doc:d,data:p}}).sort((d,p)=>{var E,C,P,R,B,V,W,K,Z,$,X,Q;const a=((P=(C=(E=d.data.submittedAt)==null?void 0:E.toDate)==null?void 0:C.call(E))==null?void 0:P.getTime())||((V=(B=(R=d.data.requestedAt)==null?void 0:R.toDate)==null?void 0:B.call(R))==null?void 0:V.getTime())||0;return(((Z=(K=(W=p.data.submittedAt)==null?void 0:W.toDate)==null?void 0:K.call(W))==null?void 0:Z.getTime())||((Q=(X=($=p.data.requestedAt)==null?void 0:$.toDate)==null?void 0:X.call($))==null?void 0:Q.getTime())||0)-a}).map(({doc:d,data:p})=>{var w,E,C,P;const a=p.status;return{id:d.id,...p,status:this.mapStatus(a),submittedAt:((w=p.submittedAt)==null?void 0:w.toDate())||((E=p.requestedAt)==null?void 0:E.toDate())||new Date,reviewedAt:(C=p.reviewedAt)==null?void 0:C.toDate(),documents:((P=p.documents)==null?void 0:P.map(R=>{var B,V;return{...R,uploadedAt:typeof R.uploadedAt=="number"?new Date(R.uploadedAt):((V=(B=R.uploadedAt)==null?void 0:B.toDate)==null?void 0:V.call(B))||new Date}}))||[]}})[0]}catch(r){return console.error("Erreur lors de la récupération du statut:",r),null}}static async approveVerification(e,r){var n;try{const c=hn(rr,this.COLLECTION,e),d=await Xa(c);if(!d.exists())throw new Error("Demande de vérification introuvable");const p=d.data();await Rs(c,{status:Tn.VERIFIED,reviewedAt:aa(),reviewedBy:r});const a=hn(rr,"users",p.userId);await Rs(a,{verificationStatus:Tn.VERIFIED,isVerified:!0}),await Iv.logApproval(e,r,{documentsCount:((n=p.documents)==null?void 0:n.length)||0,previousStatus:p.status})}catch(c){throw console.error("Erreur lors de l'approbation:",c),c}}static async rejectVerification(e,r,n){try{const c=hn(rr,this.COLLECTION,e),d=await Xa(c);if(!d.exists())throw new Error("Demande de vérification introuvable");const p=d.data();await Rs(c,{status:Tn.REJECTED,reviewedAt:aa(),reviewedBy:n,rejectionReason:r});const a=hn(rr,"users",p.userId);await Rs(a,{verificationStatus:Tn.REJECTED,isVerified:!1}),await Iv.logRejection(e,n,r,{previousStatus:p.status,riskLevel:"medium"})}catch(c){throw console.error("Erreur lors du rejet:",c),c}}static async revokeVerification(e,r,n){try{const c=hn(rr,this.COLLECTION,e),d=await Xa(c);if(!d.exists())throw new Error("Demande de vérification introuvable");const p=d.data();await Rs(c,{status:Tn.SUSPENDED,reviewedAt:aa(),reviewedBy:n,revocationReason:r});const a=hn(rr,"users",p.userId);await Rs(a,{verificationStatus:Tn.SUSPENDED,isVerified:!1}),await Iv.logRevocation(e,n,r,{riskLevel:"high",previousStatus:p.status})}catch(c){throw console.error("Erreur lors de la révocation:",c),c}}static async getVerificationHistory(e){try{const r=ms(jn(rr,this.COLLECTION),ii("userId","==",e));return(await gs(r)).docs.map(c=>{var a,w,E,C;const d=c.data(),p=d.status;return{id:c.id,...d,status:this.mapStatus(p),submittedAt:((a=d.submittedAt)==null?void 0:a.toDate())||((w=d.requestedAt)==null?void 0:w.toDate())||new Date,reviewedAt:(E=d.reviewedAt)==null?void 0:E.toDate(),documents:((C=d.documents)==null?void 0:C.map(P=>{var R,B;return{...P,uploadedAt:typeof P.uploadedAt=="number"?new Date(P.uploadedAt):((B=(R=P.uploadedAt)==null?void 0:R.toDate)==null?void 0:B.call(R))||new Date}}))||[]}})}catch(r){return console.error("Erreur lors de la récupération de l'historique:",r),[]}}static async getAllRequests(e){try{let r;if(e&&e!=="all"){const c=ms(jn(rr,this.COLLECTION),ii("status","==",e));r=await gs(c)}else r=await gs(jn(rr,this.COLLECTION));const n=r.docs.map(c=>{var a,w,E,C;const d=c.data(),p=d.status;return{id:c.id,...d,status:this.mapStatus(p),submittedAt:((a=d.submittedAt)==null?void 0:a.toDate())||((w=d.requestedAt)==null?void 0:w.toDate())||new Date,reviewedAt:(E=d.reviewedAt)==null?void 0:E.toDate(),documents:((C=d.documents)==null?void 0:C.map(P=>{var R,B;return{...P,uploadedAt:typeof P.uploadedAt=="number"?new Date(P.uploadedAt):((B=(R=P.uploadedAt)==null?void 0:R.toDate)==null?void 0:B.call(R))||new Date}}))||[]}});return n.sort((c,d)=>{const p=c.submittedAt instanceof Date?c.submittedAt.getTime():0;return(d.submittedAt instanceof Date?d.submittedAt.getTime():0)-p}),n}catch(r){return console.error("Erreur lors de la récupération des demandes:",r),[]}}static async getPendingRequests(){return this.getAllRequests("pending")}static getDocumentType(e){const r=e.toLowerCase();return r.includes("card")||r.includes("carte")?"student_card":r.includes("certificate")||r.includes("certificat")||r.includes("enrollment")?"enrollment_certificate":r.includes("transcript")||r.includes("releve")||r.includes("notes")?"grades_transcript":r.includes("id")||r.includes("identity")||r.includes("identite")?"id_card":"student_card"}static async deleteVerificationDocuments(e){for(const r of e)try{const n=A0(gy,r.url);await PW(n)}catch(n){console.error("Erreur lors de la suppression du document:",n)}}static subscribeToVerificationStatus(e,r){const n=ms(jn(rr,this.COLLECTION),ii("userId","==",e));return hy(n,c=>{if(c.empty){r(null);return}const d=c.docs.map(p=>{const a=p.data();return{doc:p,data:a}}).sort((p,a)=>{var C,P,R,B,V,W,K,Z,$,X,Q,re;const w=((R=(P=(C=p.data.submittedAt)==null?void 0:C.toDate)==null?void 0:P.call(C))==null?void 0:R.getTime())||((W=(V=(B=p.data.requestedAt)==null?void 0:B.toDate)==null?void 0:V.call(B))==null?void 0:W.getTime())||0;return((($=(Z=(K=a.data.submittedAt)==null?void 0:K.toDate)==null?void 0:Z.call(K))==null?void 0:$.getTime())||((re=(Q=(X=a.data.requestedAt)==null?void 0:X.toDate)==null?void 0:Q.call(X))==null?void 0:re.getTime())||0)-w}).map(({doc:p,data:a})=>{var E,C,P,R;const w=a.status;return{id:p.id,...a,status:this.mapStatus(w),submittedAt:((E=a.submittedAt)==null?void 0:E.toDate())||((C=a.requestedAt)==null?void 0:C.toDate())||new Date,reviewedAt:(P=a.reviewedAt)==null?void 0:P.toDate(),documents:((R=a.documents)==null?void 0:R.map(B=>{var V,W;return{...B,uploadedAt:typeof B.uploadedAt=="number"?new Date(B.uploadedAt):((W=(V=B.uploadedAt)==null?void 0:V.toDate)==null?void 0:W.call(V))||new Date}}))||[]}});r(d[0])},c=>{console.error("Erreur listener Firestore:",c),r(null)})}static async markAsUnderReview(e,r){var n;try{const c=hn(rr,this.COLLECTION,e),d=await Xa(c);if(!d.exists())throw new Error("Demande de vérification introuvable");const p=d.data(),a=p.status;a==="documents_submitted"||a==="pending"?(console.log(`🔄 Mise à jour de ${e}: ${a} → under_review`),await Rs(c,{status:"under_review",reviewStartedAt:aa()}),console.log(`✅ Statut mis à jour pour ${e}`),r&&await Iv.logUnderReview(e,r,{documentsCount:((n=p.documents)==null?void 0:n.length)||0,previousStatus:a})):console.log(`⚠️ Statut actuel ${a}, pas de changement pour ${e}`)}catch(c){console.error('Erreur lors du passage en "en revue":',c)}}static subscribeToAllRequests(e,r){let n;return e&&e!=="all"?n=ms(jn(rr,this.COLLECTION),ii("status","==",e)):n=ms(jn(rr,this.COLLECTION)),hy(n,c=>{const d=c.docs.map(p=>{var E,C,P,R;const a=p.data(),w=a.status;return{id:p.id,...a,status:this.mapStatus(w),submittedAt:((E=a.submittedAt)==null?void 0:E.toDate())||((C=a.requestedAt)==null?void 0:C.toDate())||new Date,reviewedAt:(P=a.reviewedAt)==null?void 0:P.toDate(),documents:((R=a.documents)==null?void 0:R.map(B=>{var V,W;return{...B,uploadedAt:typeof B.uploadedAt=="number"?new Date(B.uploadedAt):((W=(V=B.uploadedAt)==null?void 0:V.toDate)==null?void 0:W.call(V))||new Date}}))||[]}});d.sort((p,a)=>{const w=p.submittedAt instanceof Date?p.submittedAt.getTime():0;return(a.submittedAt instanceof Date?a.submittedAt.getTime():0)-w}),r==null||r(d)},c=>{console.error("Erreur listener admin Firestore:",c)})}}Uf($d,"COLLECTION","verification_requests"),Uf($d,"ALLOWED_DOMAINS",[".edu","univ-",".ac.","student.","etudiant.","etu.","sorbonne-universite.fr","sorbonne-nouvelle.fr","dauphine.psl.eu","polytechnique.edu","ens.fr","centralesupelec.fr","mines-paristech.fr","gmail.com"]);class rM{static notifyVerificationStatusChange(e,r){switch(e){case Tn.VERIFIED:Nt.success("🎉 Félicitations ! Votre compte étudiant est maintenant vérifié.",{duration:5e3});break;case Tn.DOCUMENTS_SUBMITTED:Nt.success("📤 Vos documents ont été soumis. La vérification est en cours.",{duration:4e3});break;case Tn.UNDER_REVIEW:Nt("👀 Votre demande est en cours de revue par un administrateur.",{duration:4e3,icon:"🔍"});break;case Tn.REJECTED:Nt.error(r?`✗ Demande rejetée : ${r}`:"✗ Votre demande a été rejetée.",{duration:6e3});break;case Tn.SUSPENDED:Nt.error("⚠️ Votre compte a été suspendu. Contactez le support.",{duration:6e3});break}}static notifyAdminNewRequest(e){Nt.success(`Nouvelle demande de vérification de ${e}`,{duration:3e3})}static notifyDocumentUpload(e){Nt.success(`${e} document${e>1?"s":""} téléversé${e>1?"s":""} avec succès`,{duration:3e3})}static notifyUploadError(e){Nt.error(e||"Erreur lors du téléversement. Veuillez réessayer.",{duration:4e3})}}const Qke=()=>{const{currentUser:t,userProfile:e}=$i(),[r,n]=z.useState([]),[c,d]=z.useState(""),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState(!0),[R,B]=z.useState({});z.useEffect(()=>{if(!t){P(!1);return}const $=$d.subscribeToVerificationStatus(t.uid,X=>{a(X),P(!1)});return()=>{$&&$()}},[t]);const V=$=>{if($.target.files){const X=Array.from($.target.files);if(r.length+X.length>5){Nt.error("Maximum 5 fichiers autorisés");return}for(const Q of X){if(!q1.validateFileType(Q)){Nt.error(`Type de fichier non autorisé : ${Q.name}`);return}if(!q1.validateFileSize(Q,10)){Nt.error(`Fichier trop volumineux : ${Q.name} (max 10MB)`);return}}n(Q=>[...Q,...X]),rM.notifyDocumentUpload(X.length)}},W=$=>{n(X=>X.filter((Q,re)=>re!==$))},K=async $=>{if($.preventDefault(),!t||!e){Nt.error("Vous devez être connecté pour demander la vérification");return}if(r.length===0){Nt.error("Veuillez téléverser au moins un document");return}E(!0);try{const X=[];for(let re=0;re<r.length;re++){const ve=r[re],pe=q1.getVerificationDocumentPath(t.uid,"document",ve.name),ue=await q1.uploadFile(ve,pe,ge=>{B(ce=>({...ce,[re]:ge.percentage}))});X.push({type:ve.type.includes("pdf")?"enrollment_certificate":"student_card",url:ue,filename:ve.name,size:ve.size,uploadedAt:new Date})}await $d.requestVerification(t.uid,{email:t.email||"",displayName:e.displayName,university:e.university||"",studentId:c||void 0,graduationYear:e.graduationYear,fieldOfStudy:e.fieldOfStudy,campus:e.campus},r);const Q=await $d.getVerificationStatus(t.uid);a(Q),Q&&rM.notifyVerificationStatusChange(Q.status),n([]),d(""),B({})}catch(X){console.error("Erreur lors de la demande:",X),rM.notifyUploadError(X.message)}finally{E(!1)}};if(C)return i.jsx("div",{className:"flex items-center justify-center min-h-screen",children:i.jsx(Ka,{className:"h-8 w-8 animate-spin text-primary"})});const Z=()=>{if(!p)return null;switch(p.status){case"pending":case"documents_submitted":return i.jsxs(Ys,{className:"bg-yellow-50 dark:bg-yellow-950 border-yellow-200 dark:border-yellow-800",children:[i.jsx(Fi,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400"}),i.jsx(Js,{className:"text-yellow-800 dark:text-yellow-300",children:"Votre demande de vérification est en attente d'examen par un administrateur."})]});case"under_review":return i.jsxs(Ys,{className:"bg-purple-50 dark:bg-purple-950 border-purple-200 dark:border-purple-800",children:[i.jsx(Fo,{className:"h-4 w-4 text-purple-600 dark:text-purple-400 animate-pulse"}),i.jsx(Js,{className:"text-purple-800 dark:text-purple-300",children:"Un administrateur examine actuellement vos documents. Vous serez notifié dès qu'une décision sera prise."})]});case"approved":case"verified":return i.jsxs(Ys,{className:"bg-green-50 dark:bg-green-950 border-green-200 dark:border-green-800",children:[i.jsx(Hd,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),i.jsx(Js,{className:"text-green-800 dark:text-green-300",children:"Félicitations ! Votre compte est maintenant vérifié."})]});case"rejected":return i.jsxs(Ys,{className:"bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800",children:[i.jsx(Yd,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),i.jsxs(Js,{className:"text-red-800 dark:text-red-300",children:[i.jsx("div",{className:"font-semibold mb-1",children:"Votre demande a été rejetée"}),p.rejectionReason&&i.jsx("div",{className:"mt-2",children:p.rejectionReason}),i.jsx("div",{className:"mt-2",children:"Vous pouvez soumettre une nouvelle demande."})]})]});case"suspended":return i.jsxs(Ys,{className:"bg-orange-50 dark:bg-orange-950 border-orange-200 dark:border-orange-800",children:[i.jsx(Yd,{className:"h-4 w-4 text-orange-600 dark:text-orange-400"}),i.jsxs(Js,{className:"text-orange-800 dark:text-orange-300",children:[i.jsx("div",{className:"font-semibold mb-1",children:"Votre certification a été révoquée"}),p.revocationReason&&i.jsxs("div",{className:"mt-2",children:["Raison : ",p.revocationReason]}),i.jsx("div",{className:"mt-2",children:"Vous pouvez soumettre une nouvelle demande ci-dessous."})]})]});default:return null}};return i.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Vérification du compte étudiant"}),i.jsx("p",{className:"text-muted-foreground",children:"Vérifiez votre statut d'étudiant pour accéder à toutes les fonctionnalités et gagner la confiance des autres utilisateurs."})]}),p&&i.jsxs(Tt,{className:"mb-6",children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Statut de vérification"}),i.jsx(D0,{status:p.status,size:"lg"})]})}),i.jsxs(jt,{className:"space-y-4",children:[Z(),i.jsx(Zke,{status:p.status}),i.jsx(Kke,{currentStatus:p.status,submittedAt:p.submittedAt,reviewedAt:p.reviewedAt})]})]}),(!p||p.status==="rejected"||p.status==="unverified"||p.status==="suspended")&&i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsx(kr,{children:"Demande de vérification"}),i.jsx(Ls,{children:"Téléversez vos documents pour prouver votre statut d'étudiant"})]}),i.jsx(jt,{children:i.jsxs("form",{onSubmit:K,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{htmlFor:"studentId",className:"text-sm font-medium",children:"Numéro d'étudiant (optionnel)"}),i.jsx(Gr,{id:"studentId",type:"text",placeholder:"Ex: 123456789",value:c,onChange:$=>d($.target.value)})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{htmlFor:"documents",className:"text-sm font-medium block",children:"Documents à téléverser"}),i.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6",children:[i.jsx("input",{id:"documents",type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png",onChange:V,className:"hidden"}),i.jsx("label",{htmlFor:"documents",className:"cursor-pointer",children:i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[i.jsx(wy,{className:"h-8 w-8 text-muted-foreground"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Cliquez pour sélectionner ou glissez-déposez"}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"PDF, JPG, PNG (max 5 fichiers, 5MB chacun)"})]})})]}),r.length>0&&i.jsx("div",{className:"space-y-2",children:r.map(($,X)=>i.jsxs("div",{className:"p-3 bg-muted rounded-lg space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(U3,{className:"h-5 w-5 text-muted-foreground"}),i.jsx("span",{className:"text-sm",children:$.name}),i.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",($.size/1024).toFixed(1)," KB)"]})]}),i.jsx(Ge,{type:"button",variant:"ghost",size:"sm",onClick:()=>W(X),children:"Supprimer"})]}),R[X]!==void 0&&i.jsxs("div",{className:"space-y-1",children:[i.jsx("div",{className:"w-full bg-background rounded-full h-1",children:i.jsx("div",{className:"bg-primary h-1 rounded-full transition-all duration-300",style:{width:`${R[X]}%`}})}),i.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:[R[X].toFixed(0),"% uploadé"]})]})]},X))})]}),i.jsxs(Ys,{children:[i.jsx(Yd,{className:"h-4 w-4"}),i.jsxs(Js,{children:[i.jsx("div",{className:"font-semibold mb-2",children:"Documents acceptés :"}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[i.jsx("li",{children:"Carte étudiante"}),i.jsx("li",{children:"Certificat d'inscription"}),i.jsx("li",{children:"Relevé de notes officiel"}),i.jsx("li",{children:"Carte d'identité (en complément)"})]})]})]}),i.jsx(Ge,{type:"submit",disabled:w||r.length===0,className:"w-full",children:w?i.jsxs(i.Fragment,{children:[i.jsx(Ka,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi en cours..."]}):i.jsxs(i.Fragment,{children:[i.jsx(wy,{className:"mr-2 h-4 w-4"}),"Envoyer la demande"]})})]})})]})]})};var X4="Switch",[eRe,TLe]=hd(X4),[tRe,rRe]=eRe(X4),hee=z.forwardRef((t,e)=>{const{__scopeSwitch:r,name:n,checked:c,defaultChecked:d,required:p,disabled:a,value:w="on",onCheckedChange:E,form:C,...P}=t,[R,B]=z.useState(null),V=Fs(e,X=>B(X)),W=z.useRef(!1),K=R?C||!!R.closest("form"):!0,[Z=!1,$]=ud({prop:c,defaultProp:d,onChange:E});return i.jsxs(tRe,{scope:r,checked:Z,disabled:a,children:[i.jsx(Pn.button,{type:"button",role:"switch","aria-checked":Z,"aria-required":p,"data-state":mee(Z),"data-disabled":a?"":void 0,disabled:a,value:w,...P,ref:V,onClick:tn(t.onClick,X=>{$(Q=>!Q),K&&(W.current=X.isPropagationStopped(),W.current||X.stopPropagation())})}),K&&i.jsx(nRe,{control:R,bubbles:!W.current,name:n,value:w,checked:Z,required:p,disabled:a,form:C,style:{transform:"translateX(-100%)"}})]})});hee.displayName=X4;var fee="SwitchThumb",pee=z.forwardRef((t,e)=>{const{__scopeSwitch:r,...n}=t,c=rRe(fee,r);return i.jsx(Pn.span,{"data-state":mee(c.checked),"data-disabled":c.disabled?"":void 0,...n,ref:e})});pee.displayName=fee;var nRe=t=>{const{control:e,checked:r,bubbles:n=!0,...c}=t,d=z.useRef(null),p=y4(r),a=J3(e);return z.useEffect(()=>{const w=d.current,E=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(E,"checked").set;if(p!==r&&P){const R=new Event("click",{bubbles:n});P.call(w,r),w.dispatchEvent(R)}},[p,r,n]),i.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...c,tabIndex:-1,ref:d,style:{...t.style,...a,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function mee(t){return t?"checked":"unchecked"}var gee=hee,sRe=pee;const Zo=z.forwardRef(({className:t,...e},r)=>i.jsx(gee,{className:kn("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...e,ref:r,children:i.jsx(sRe,{className:kn("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Zo.displayName=gee.displayName;const iRe=On.object({displayName:On.string().min(2,"Le nom doit contenir au moins 2 caractères"),bio:On.string().max(500,"La bio ne peut pas dépasser 500 caractères").optional(),phone:On.string().optional(),university:On.string().min(1,"Veuillez sélectionner votre université"),fieldOfStudy:On.string().min(1,"Veuillez indiquer votre filière"),graduationYear:On.number().min(2020).max(2035),campus:On.string().optional(),location:On.string().optional()}),aRe=On.object({currentPassword:On.string().min(6,"Le mot de passe actuel est requis"),newPassword:On.string().min(6,"Le nouveau mot de passe doit contenir au moins 6 caractères"),confirmPassword:On.string()}).refine(t=>t.newPassword===t.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}),oRe=On.object({newEmail:On.string().email("Email invalide"),password:On.string().min(6,"Mot de passe requis pour changer l'email")}),lRe=["Sorbonne Université","Université Paris-Dauphine","École Polytechnique","ENS Paris","CentraleSupélec","MINES ParisTech","HEC Paris","ESSEC","ESCP","Université Paris 1 Panthéon-Sorbonne","Université Paris Cité","Sciences Po Paris","Université de Lyon","Université de Marseille","Université de Toulouse","Université de Bordeaux","Université de Lille","Université de Strasbourg","Université de Nantes","Université de Montpellier","Autre université"],cRe=["Informatique","Ingénierie","Commerce/Management","Droit","Médecine","Sciences","Lettres/Langues","Sciences Humaines","Arts","Architecture","Économie","Psychologie","Communication","Design","Autre"],uRe=()=>{var ke,Ze,Xe,qe,$e,st;const{currentUser:t,userProfile:e,updateUserProfile:r,logout:n}=$i(),c=Ra(),[d,p]=z.useState("profile"),[a,w]=z.useState(!1),[E,C]=z.useState(!1),[P,R]=z.useState(!1),[B,V]=z.useState(!1),[W,K]=z.useState(""),[Z,$]=z.useState({email:((ke=e==null?void 0:e.notificationPreferences)==null?void 0:ke.email)??!0,push:((Ze=e==null?void 0:e.notificationPreferences)==null?void 0:Ze.push)??!0,sms:((Xe=e==null?void 0:e.notificationPreferences)==null?void 0:Xe.sms)??!1,alerts:((qe=e==null?void 0:e.notificationPreferences)==null?void 0:qe.alerts)??!0,messages:!0,listings:!0,reviews:!0,marketing:!1}),[X,Q]=z.useState({profileVisibility:"public",showEmail:!1,showPhone:!1,showUniversity:!0,allowMessages:!0,showOnlineStatus:!0}),re=K_({resolver:X_(iRe),defaultValues:{displayName:(e==null?void 0:e.displayName)||"",bio:(e==null?void 0:e.bio)||"",phone:(e==null?void 0:e.phone)||"",university:(e==null?void 0:e.university)||"",fieldOfStudy:(e==null?void 0:e.fieldOfStudy)||"",graduationYear:(e==null?void 0:e.graduationYear)||new Date().getFullYear()+2,campus:(e==null?void 0:e.campus)||"",location:(e==null?void 0:e.location)||""}}),ve=K_({resolver:X_(aRe)}),pe=K_({resolver:X_(oRe)});z.useEffect(()=>{var it,Mt,ar,St;e&&(re.reset({displayName:e.displayName||"",bio:e.bio||"",phone:e.phone||"",university:e.university||"",fieldOfStudy:e.fieldOfStudy||"",graduationYear:e.graduationYear||new Date().getFullYear()+2,campus:e.campus||"",location:e.location||""}),$({email:((it=e.notificationPreferences)==null?void 0:it.email)??!0,push:((Mt=e.notificationPreferences)==null?void 0:Mt.push)??!0,sms:((ar=e.notificationPreferences)==null?void 0:ar.sms)??!1,alerts:((St=e.notificationPreferences)==null?void 0:St.alerts)??!0,messages:!0,listings:!0,reviews:!0,marketing:!1}))},[e,re]);const ue=async it=>{w(!0);try{await r({displayName:it.displayName,bio:it.bio||void 0,phone:it.phone||void 0,university:it.university,fieldOfStudy:it.fieldOfStudy,graduationYear:it.graduationYear,campus:it.campus||void 0,location:it.location||void 0}),Nt.success("Profil mis à jour avec succès !")}catch(Mt){console.error("Erreur lors de la mise à jour du profil:",Mt),Nt.error("Erreur lors de la mise à jour du profil")}finally{w(!1)}},ge=async()=>{w(!0);try{await r({notificationPreferences:{email:Z.email,push:Z.push,sms:Z.sms,alerts:Z.alerts}}),Nt.success("Préférences de notification mises à jour !")}catch(it){console.error("Erreur lors de la mise à jour des notifications:",it),Nt.error("Erreur lors de la mise à jour des notifications")}finally{w(!1)}},ce=async it=>{if(t){w(!0);try{const Mt=cg.credential(t.email,it.currentPassword);await J6(t,Mt),await The(t,it.newPassword),Nt.success("Mot de passe mis à jour avec succès !"),R(!1),ve.reset()}catch(Mt){console.error("Erreur lors du changement de mot de passe:",Mt),Mt.code==="auth/wrong-password"?Nt.error("Mot de passe actuel incorrect"):Nt.error("Erreur lors du changement de mot de passe")}finally{w(!1)}}},Se=async it=>{if(t){w(!0);try{const Mt=cg.credential(t.email,it.password);await J6(t,Mt),await Ehe(t,it.newEmail),await r({email:it.newEmail}),Nt.success("Email mis à jour avec succès !"),V(!1),pe.reset()}catch(Mt){console.error("Erreur lors du changement d'email:",Mt),Mt.code==="auth/wrong-password"?Nt.error("Mot de passe incorrect"):Mt.code==="auth/email-already-in-use"?Nt.error("Cet email est déjà utilisé"):Nt.error("Erreur lors du changement d'email")}finally{w(!1)}}},le=async()=>{if(!(!t||W!=="SUPPRIMER")){w(!0);try{const it=T3(rr),Mt=["listings","conversations","reviews","favorites","reports"];for(const ar of Mt){const St=ms(jn(rr,ar),ii("userId","==",t.uid));(await gs(St)).forEach(dt=>{it.delete(dt.ref)})}it.delete(hn(rr,"users",t.uid)),await it.commit(),await Ahe(t),Nt.success("Compte supprimé avec succès"),c("/")}catch(it){console.error("Erreur lors de la suppression du compte:",it),Nt.error("Erreur lors de la suppression du compte")}finally{w(!1)}}},J=async()=>{if(t){w(!0);try{const it={profile:e,listings:[],conversations:[],reviews:[],favorites:[]},Mt=ms(jn(rr,"listings"),ii("sellerId","==",t.uid)),ar=await gs(Mt);it.listings=ar.docs.map(ln=>({id:ln.id,...ln.data()}));const St=ms(jn(rr,"conversations"),ii("participants","array-contains",t.uid)),Xt=await gs(St);it.conversations=Xt.docs.map(ln=>({id:ln.id,...ln.data()}));const dt=ms(jn(rr,"reviews"),ii("revieweeId","==",t.uid)),ft=await gs(dt);it.reviews=ft.docs.map(ln=>({id:ln.id,...ln.data()}));const Wt=ms(jn(rr,"favorites"),ii("userId","==",t.uid)),Wr=await gs(Wt);it.favorites=Wr.docs.map(ln=>({id:ln.id,...ln.data()}));const jr=JSON.stringify(it,null,2),Br=new Blob([jr],{type:"application/json"}),on=URL.createObjectURL(Br),Zn=document.createElement("a");Zn.href=on,Zn.download=`studymarket-data-${new Date().toISOString().split("T")[0]}.json`,Zn.click(),URL.revokeObjectURL(on),Nt.success("Données exportées avec succès !")}catch(it){console.error("Erreur lors de l'export des données:",it),Nt.error("Erreur lors de l'export des données")}finally{w(!1)}}};return t?i.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[i.jsx(qC,{className:"w-8 h-8"}),"Paramètres"]}),i.jsx("p",{className:"text-muted-foreground",children:"Gérez votre profil, vos préférences et votre sécurité"})]}),i.jsxs(Og,{value:d,onValueChange:p,className:"space-y-6",children:[i.jsxs(Pp,{className:"grid w-full grid-cols-5",children:[i.jsxs(Wi,{value:"profile",className:"flex items-center gap-2",children:[i.jsx(Hl,{className:"w-4 h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Profil"})]}),i.jsxs(Wi,{value:"notifications",className:"flex items-center gap-2",children:[i.jsx(Bd,{className:"w-4 h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Notifications"})]}),i.jsxs(Wi,{value:"privacy",className:"flex items-center gap-2",children:[i.jsx(Fo,{className:"w-4 h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Confidentialité"})]}),i.jsxs(Wi,{value:"security",className:"flex items-center gap-2",children:[i.jsx(Ms,{className:"w-4 h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Sécurité"})]}),i.jsxs(Wi,{value:"data",className:"flex items-center gap-2",children:[i.jsx(to,{className:"w-4 h-4"}),i.jsx("span",{className:"hidden sm:inline",children:"Données"})]})]}),i.jsx(Zi,{value:"profile",className:"space-y-6",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Hl,{className:"w-5 h-5"}),"Informations personnelles"]}),i.jsx(Ls,{children:"Mettez à jour vos informations de profil et vos préférences"})]}),i.jsxs(jt,{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(aee,{currentPhotoURL:(e==null?void 0:e.photoURL)||"",displayName:(e==null?void 0:e.displayName)||t.email||"Utilisateur"}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium",children:"Photo de profil"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Cliquez sur votre avatar pour changer votre photo"})]})]}),i.jsx(Zc,{}),i.jsxs("form",{onSubmit:re.handleSubmit(ue),className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"displayName",children:"Nom complet *"}),i.jsx(Gr,{id:"displayName",...re.register("displayName"),placeholder:"Votre nom complet"}),re.formState.errors.displayName&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:re.formState.errors.displayName.message})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"phone",children:"Téléphone"}),i.jsx(Gr,{id:"phone",type:"tel",...re.register("phone"),placeholder:"+33 6 12 34 56 78"})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"bio",children:"Biographie"}),i.jsx(id,{id:"bio",...re.register("bio"),placeholder:"Parlez-nous de vous...",rows:3,maxLength:500}),i.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(($e=re.watch("bio"))==null?void 0:$e.length)||0,"/500 caractères"]})]}),i.jsx(Zc,{}),i.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[i.jsx(up,{className:"w-4 h-4"}),"Informations académiques"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"university",children:"Université *"}),i.jsxs(ds,{value:re.watch("university"),onValueChange:it=>re.setValue("university",it),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Sélectionnez votre université"})}),i.jsx(as,{children:lRe.map(it=>i.jsx(Bt,{value:it,children:it},it))})]}),re.formState.errors.university&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:re.formState.errors.university.message})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"fieldOfStudy",children:"Filière d'études *"}),i.jsxs(ds,{value:re.watch("fieldOfStudy"),onValueChange:it=>re.setValue("fieldOfStudy",it),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Sélectionnez votre filière"})}),i.jsx(as,{children:cRe.map(it=>i.jsx(Bt,{value:it,children:it},it))})]}),re.formState.errors.fieldOfStudy&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:re.formState.errors.fieldOfStudy.message})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"graduationYear",children:"Année de diplôme *"}),i.jsxs(ds,{value:(st=re.watch("graduationYear"))==null?void 0:st.toString(),onValueChange:it=>re.setValue("graduationYear",parseInt(it)),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Année de diplôme"})}),i.jsx(as,{children:Array.from({length:16},(it,Mt)=>2020+Mt).map(it=>i.jsx(Bt,{value:it.toString(),children:it},it))})]}),re.formState.errors.graduationYear&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:re.formState.errors.graduationYear.message})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"campus",children:"Campus"}),i.jsx(Gr,{id:"campus",...re.register("campus"),placeholder:"Campus principal"})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"location",children:"Localisation"}),i.jsx(Gr,{id:"location",...re.register("location"),placeholder:"Paris, France"})]}),i.jsx(Ge,{type:"submit",disabled:a,className:"w-full",children:a?i.jsxs(i.Fragment,{children:[i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}),"Sauvegarde..."]}):i.jsxs(i.Fragment,{children:[i.jsx(ER,{className:"w-4 h-4 mr-2"}),"Sauvegarder les modifications"]})})]})]})]})}),i.jsx(Zi,{value:"notifications",className:"space-y-6",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Bd,{className:"w-5 h-5"}),"Préférences de notification"]}),i.jsx(Ls,{children:"Choisissez comment vous souhaitez être notifié"})]}),i.jsxs(jt,{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-medium",children:"Canaux de notification"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx(Nl,{className:"w-5 h-5 text-blue-600 mt-0.5"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-base",children:"Email"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Recevez des notifications par email"})]})]}),i.jsx(Zo,{checked:Z.email,onCheckedChange:it=>$(Mt=>({...Mt,email:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx(Ag,{className:"w-5 h-5 text-green-600 mt-0.5"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-base",children:"Notifications push"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Notifications dans le navigateur"})]})]}),i.jsx(Zo,{checked:Z.push,onCheckedChange:it=>$(Mt=>({...Mt,push:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx(lw,{className:"w-5 h-5 text-purple-600 mt-0.5"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-base",children:"SMS"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Notifications par SMS (bientôt disponible)"})]})]}),i.jsx(Zo,{checked:Z.sms,onCheckedChange:it=>$(Mt=>({...Mt,sms:it})),disabled:!0})]})]})]}),i.jsx(Zc,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-medium",children:"Types de notifications"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx(xa,{className:"w-5 h-5 text-blue-600 mt-0.5"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-base",children:"Messages"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Nouveaux messages et conversations"})]})]}),i.jsx(Zo,{checked:Z.messages,onCheckedChange:it=>$(Mt=>({...Mt,messages:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx(gi,{className:"w-5 h-5 text-blue-600 mt-0.5"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-base",children:"Annonces"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Nouvelles annonces correspondant à vos recherches"})]})]}),i.jsx(Zo,{checked:Z.listings,onCheckedChange:it=>$(Mt=>({...Mt,listings:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx(Km,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-base",children:"Avis et évaluations"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Nouveaux avis sur vos transactions"})]})]}),i.jsx(Zo,{checked:Z.reviews,onCheckedChange:it=>$(Mt=>({...Mt,reviews:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx(Bd,{className:"w-5 h-5 text-red-600 mt-0.5"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-base",children:"Alertes de sécurité"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Alertes importantes et mises à jour de sécurité"})]})]}),i.jsx(Zo,{checked:Z.alerts,onCheckedChange:it=>$(Mt=>({...Mt,alerts:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx(Uxe,{className:"w-5 h-5 text-pink-600 mt-0.5"}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-base",children:"Marketing"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Nouvelles fonctionnalités et promotions"})]})]}),i.jsx(Zo,{checked:Z.marketing,onCheckedChange:it=>$(Mt=>({...Mt,marketing:it}))})]})]})]}),i.jsx(Ge,{onClick:ge,disabled:a,className:"w-full",children:a?i.jsxs(i.Fragment,{children:[i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}),"Sauvegarde..."]}):i.jsxs(i.Fragment,{children:[i.jsx(ER,{className:"w-4 h-4 mr-2"}),"Sauvegarder les préférences"]})})]})]})}),i.jsx(Zi,{value:"privacy",className:"space-y-6",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Fo,{className:"w-5 h-5"}),"Confidentialité et visibilité"]}),i.jsx(Ls,{children:"Contrôlez qui peut voir vos informations"})]}),i.jsxs(jt,{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-medium",children:"Visibilité du profil"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"text-left flex-1",children:[i.jsx("p",{className:"font-medium text-base",children:"Profil public"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre profil est visible par tous les étudiants vérifiés"})]}),i.jsx(Zo,{checked:X.profileVisibility==="public",onCheckedChange:it=>Q(Mt=>({...Mt,profileVisibility:it?"public":"private"}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"text-left flex-1",children:[i.jsx("p",{className:"font-medium text-base",children:"Afficher l'email"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre email est visible sur votre profil public"})]}),i.jsx(Zo,{checked:X.showEmail,onCheckedChange:it=>Q(Mt=>({...Mt,showEmail:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"text-left flex-1",children:[i.jsx("p",{className:"font-medium text-base",children:"Afficher le téléphone"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre numéro de téléphone est visible sur votre profil"})]}),i.jsx(Zo,{checked:X.showPhone,onCheckedChange:it=>Q(Mt=>({...Mt,showPhone:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"text-left flex-1",children:[i.jsx("p",{className:"font-medium text-base",children:"Afficher l'université"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre université est visible sur votre profil"})]}),i.jsx(Zo,{checked:X.showUniversity,onCheckedChange:it=>Q(Mt=>({...Mt,showUniversity:it}))})]})]})]}),i.jsx(Zc,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-medium",children:"Interactions"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"text-left flex-1",children:[i.jsx("p",{className:"font-medium text-base",children:"Autoriser les messages"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Les autres étudiants peuvent vous envoyer des messages"})]}),i.jsx(Zo,{checked:X.allowMessages,onCheckedChange:it=>Q(Mt=>({...Mt,allowMessages:it}))})]}),i.jsxs("div",{className:"flex items-start justify-between py-3",children:[i.jsxs("div",{className:"text-left flex-1",children:[i.jsx("p",{className:"font-medium text-base",children:"Statut en ligne"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Afficher quand vous êtes en ligne"})]}),i.jsx(Zo,{checked:X.showOnlineStatus,onCheckedChange:it=>Q(Mt=>({...Mt,showOnlineStatus:it}))})]})]})]}),i.jsxs(Ys,{children:[i.jsx(Ms,{className:"h-4 w-4"}),i.jsx(Js,{children:"Vos informations personnelles sont toujours protégées et ne sont jamais partagées avec des tiers sans votre consentement."})]})]})]})}),i.jsx(Zi,{value:"security",className:"space-y-6",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Ms,{className:"w-5 h-5"}),"Sécurité du compte"]}),i.jsx(Ls,{children:"Gérez la sécurité de votre compte StudyMarket"})]}),i.jsxs(jt,{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-medium",children:"Informations du compte"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(Nl,{className:"w-4 h-4 text-blue-600"}),i.jsx("span",{className:"font-medium",children:"Email"})]}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:t.email}),i.jsxs(ta,{open:B,onOpenChange:V,children:[i.jsx(l0,{asChild:!0,children:i.jsx(Ge,{variant:"outline",size:"sm",children:"Changer l'email"})}),i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Changer l'adresse email"}),i.jsx(go,{children:"Entrez votre nouveau email et votre mot de passe actuel"})]}),i.jsxs("form",{onSubmit:pe.handleSubmit(Se),className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"newEmail",children:"Nouvel email"}),i.jsx(Gr,{id:"newEmail",type:"email",...pe.register("newEmail"),placeholder:"nouveau@email.com"}),pe.formState.errors.newEmail&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:pe.formState.errors.newEmail.message})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"emailPassword",children:"Mot de passe actuel"}),i.jsx(Gr,{id:"emailPassword",type:"password",...pe.register("password"),placeholder:"••••••••"}),pe.formState.errors.password&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:pe.formState.errors.password.message})]}),i.jsxs(mo,{children:[i.jsx(Ge,{type:"button",variant:"outline",onClick:()=>V(!1),children:"Annuler"}),i.jsxs(Ge,{type:"submit",disabled:a,children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(ER,{className:"w-4 h-4 mr-2"}),"Changer l'email"]})]})]})]})]})]}),i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(xy,{className:"w-4 h-4 text-green-600"}),i.jsx("span",{className:"font-medium",children:"Mot de passe"})]}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Dernière modification : il y a 30 jours"}),i.jsxs(ta,{open:P,onOpenChange:R,children:[i.jsx(l0,{asChild:!0,children:i.jsx(Ge,{variant:"outline",size:"sm",children:"Changer le mot de passe"})}),i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Changer le mot de passe"}),i.jsx(go,{children:"Entrez votre mot de passe actuel et votre nouveau mot de passe"})]}),i.jsxs("form",{onSubmit:ve.handleSubmit(ce),className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"currentPassword",children:"Mot de passe actuel"}),i.jsx(Gr,{id:"currentPassword",type:"password",...ve.register("currentPassword"),placeholder:"••••••••"}),ve.formState.errors.currentPassword&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:ve.formState.errors.currentPassword.message})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"newPassword",children:"Nouveau mot de passe"}),i.jsx(Gr,{id:"newPassword",type:"password",...ve.register("newPassword"),placeholder:"••••••••"}),ve.formState.errors.newPassword&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:ve.formState.errors.newPassword.message})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"confirmPassword",children:"Confirmer le nouveau mot de passe"}),i.jsx(Gr,{id:"confirmPassword",type:"password",...ve.register("confirmPassword"),placeholder:"••••••••"}),ve.formState.errors.confirmPassword&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:ve.formState.errors.confirmPassword.message})]}),i.jsxs(mo,{children:[i.jsx(Ge,{type:"button",variant:"outline",onClick:()=>R(!1),children:"Annuler"}),i.jsxs(Ge,{type:"submit",disabled:a,children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(Oxe,{className:"w-4 h-4 mr-2"}),"Changer le mot de passe"]})]})]})]})]})]})]})]}),i.jsx(Zc,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-medium",children:"Vérification du compte"}),i.jsx("div",{className:"p-4 border rounded-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(D0,{status:(e==null?void 0:e.isVerified)||"unverified",size:"md",showText:!0}),i.jsx("div",{children:i.jsx("p",{className:"text-sm text-muted-foreground",children:e!=null&&e.isVerified?"Votre statut étudiant a été vérifié":"Demandez la vérification pour accéder à toutes les fonctionnalités"})})]}),i.jsx(Ge,{variant:"outline",size:"sm",asChild:!0,children:i.jsx(Nr,{to:"/verification",children:e!=null&&e.isVerified?"Voir le statut":"Demander la vérification"})})]})})]}),i.jsxs(Ys,{children:[i.jsx(Ms,{className:"h-4 w-4"}),i.jsx(Js,{children:"Pour votre sécurité, nous vous recommandons d'utiliser un mot de passe fort et de le changer régulièrement."})]})]})]})}),i.jsxs(Zi,{value:"data",className:"space-y-6",children:[i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(to,{className:"w-5 h-5"}),"Gestion des données"]}),i.jsx(Ls,{children:"Exportez ou supprimez vos données personnelles"})]}),i.jsxs(jt,{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-medium",children:"Exporter mes données"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Téléchargez une copie de toutes vos données StudyMarket au format JSON."}),i.jsxs(Ge,{onClick:J,disabled:a,variant:"outline",children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(to,{className:"w-4 h-4 mr-2"}),"Exporter mes données"]})]}),i.jsx(Zc,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-medium text-destructive",children:"Zone de danger"}),i.jsxs(Ys,{className:"border-destructive",children:[i.jsx(va,{className:"h-4 w-4"}),i.jsx(Js,{children:"La suppression de votre compte est irréversible. Toutes vos données seront définitivement supprimées."})]}),i.jsxs(ta,{open:E,onOpenChange:C,children:[i.jsx(l0,{asChild:!0,children:i.jsxs(Ge,{variant:"destructive",children:[i.jsx(nd,{className:"w-4 h-4 mr-2"}),"Supprimer mon compte"]})}),i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{className:"text-destructive",children:"Supprimer définitivement le compte"}),i.jsxs(go,{children:["Cette action est irréversible. Toutes vos données seront supprimées :",i.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[i.jsx("li",{children:"Profil utilisateur"}),i.jsx("li",{children:"Toutes vos annonces"}),i.jsx("li",{children:"Conversations et messages"}),i.jsx("li",{children:"Avis et évaluations"}),i.jsx("li",{children:"Favoris et recherches sauvegardées"})]})]})]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"deleteConfirm",children:'Tapez "SUPPRIMER" pour confirmer'}),i.jsx(Gr,{id:"deleteConfirm",value:W,onChange:it=>K(it.target.value),placeholder:"SUPPRIMER"})]})}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>C(!1),children:"Annuler"}),i.jsxs(Ge,{variant:"destructive",onClick:le,disabled:W!=="SUPPRIMER"||a,children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(nd,{className:"w-4 h-4 mr-2"}),"Supprimer définitivement"]})]})]})]})]})]})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(sI,{className:"w-5 h-5"}),"Informations légales"]})}),i.jsx(jt,{className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(Ge,{variant:"outline",asChild:!0,children:i.jsxs("a",{href:"/terms",target:"_blank",className:"flex items-center gap-2",children:[i.jsx(Ec,{className:"w-4 h-4"}),"Conditions d'utilisation"]})}),i.jsx(Ge,{variant:"outline",asChild:!0,children:i.jsxs("a",{href:"/privacy",target:"_blank",className:"flex items-center gap-2",children:[i.jsx(Ec,{className:"w-4 h-4"}),"Politique de confidentialité"]})}),i.jsx(Ge,{variant:"outline",asChild:!0,children:i.jsxs("a",{href:"/cookies",target:"_blank",className:"flex items-center gap-2",children:[i.jsx(Ec,{className:"w-4 h-4"}),"Politique des cookies"]})}),i.jsx(Ge,{variant:"outline",asChild:!0,children:i.jsxs("a",{href:"/support",target:"_blank",className:"flex items-center gap-2",children:[i.jsx(Ec,{className:"w-4 h-4"}),"Centre d'aide"]})})]})})]})]})]})]}):i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsx("p",{className:"text-center text-muted-foreground",children:"Vous devez être connecté pour accéder aux paramètres."})})})})},j_={electronics:{category:"Électronique",icon:Ag,color:"text-blue-600",co2PerItem:85,waterPerItem:1200,energyPerItem:450,wastePerItem:2.5,description:"Smartphones, ordinateurs, accessoires tech"},books:{category:"Livres & Cours",icon:sZ,color:"text-green-600",co2PerItem:8.5,waterPerItem:85,energyPerItem:12,wastePerItem:.8,description:"Manuels, livres, notes de cours"},furniture:{category:"Mobilier",icon:qd,color:"text-purple-600",co2PerItem:45,waterPerItem:350,energyPerItem:180,wastePerItem:15,description:"Meubles, déco, électroménager"},clothing:{category:"Vêtements",icon:q3,color:"text-pink-600",co2PerItem:22,waterPerItem:2700,energyPerItem:35,wastePerItem:.5,description:"Vêtements, chaussures, accessoires"}},dRe=[{id:"first_transaction",name:"Premier Pas",icon:"🌱",threshold:1,description:"Première transaction écologique"},{id:"co2_saver_10",name:"Éco-Warrior",icon:"🌍",threshold:10,description:"10 kg CO₂ économisés"},{id:"co2_saver_50",name:"Planète Protecteur",icon:"🛡️",threshold:50,description:"50 kg CO₂ économisés"},{id:"co2_saver_100",name:"Héros Climatique",icon:"🦸",threshold:100,description:"100 kg CO₂ économisés"},{id:"water_saver",name:"Gardien de l'Eau",icon:"💧",threshold:1e3,description:"1000L d'eau économisés"},{id:"recycling_master",name:"Maître du Recyclage",icon:"♻️",threshold:20,description:"20 transactions de seconde main"},{id:"donation_hero",name:"Ange du Don",icon:"😇",threshold:5,description:"5 dons gratuits"},{id:"monthly_champion",name:"Champion Mensuel",icon:"🏆",threshold:10,description:"10 transactions en un mois"}],yv=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch{return new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return t&&typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date},hRe=()=>{const{currentUser:t,userProfile:e}=$i(),[r,n]=z.useState({totalCo2Saved:0,totalWaterSaved:0,totalEnergySaved:0,totalWasteAvoided:0,transactionsByCategory:{},monthlyImpact:[],badges:[],rank:"Débutant",percentile:0}),[c,d]=z.useState([]),[p,a]=z.useState(!0),[w,E]=z.useState("all");z.useEffect(()=>{t&&C()},[t,w]);const C=async()=>{if(t){a(!0);try{const $=ms(jn(rr,"listings"),ii("sellerId","==",t.uid)),X=await gs($),Q=[];X.forEach(ve=>{const pe=ve.data();Q.push({id:ve.id,...pe,createdAt:yv(pe.createdAt),updatedAt:yv(pe.updatedAt)})}),d(Q);const re=P(Q,w);n(re),await W(re)}catch($){console.error("Erreur lors du chargement des données environnementales:",$)}finally{a(!1)}}},P=($,X)=>{const Q=new Date;let re=$;if(X==="month"){const Ze=new Date(Q.getFullYear(),Q.getMonth()-1,Q.getDate());re=$.filter(Xe=>yv(Xe.createdAt)>=Ze)}else if(X==="year"){const Ze=new Date(Q.getFullYear()-1,Q.getMonth(),Q.getDate());re=$.filter(Xe=>yv(Xe.createdAt)>=Ze)}let ve=0,pe=0,ue=0,ge=0;const ce={};re.forEach(Ze=>{const Xe=j_[Ze.category]||j_.electronics,qe=1;let $e=1;Ze.transactionType==="donation"?$e=1.2:Ze.transactionType==="exchange"&&($e=.8),ve+=Xe.co2PerItem*qe*$e,pe+=Xe.waterPerItem*qe*$e,ue+=Xe.energyPerItem*qe*$e,ge+=Xe.wastePerItem*qe*$e,ce[Ze.category]=(ce[Ze.category]||0)+1});const Se=R($),le=B($,ve,pe),{rank:J,percentile:ke}=V(ve,$.length);return{totalCo2Saved:Math.round(ve*10)/10,totalWaterSaved:Math.round(pe),totalEnergySaved:Math.round(ue*10)/10,totalWasteAvoided:Math.round(ge*10)/10,transactionsByCategory:ce,monthlyImpact:Se,badges:le,rank:J,percentile:ke}},R=$=>{const X={};for(let Q=11;Q>=0;Q--){const re=new Date;re.setMonth(re.getMonth()-Q);const ve=re.toISOString().slice(0,7);X[ve]={co2Saved:0,transactions:0,waterSaved:0,energySaved:0}}return $.forEach(Q=>{const ve=yv(Q.createdAt).toISOString().slice(0,7);if(X[ve]){const pe=j_[Q.category]||j_.electronics;let ue=1;Q.transactionType==="donation"?ue=1.2:Q.transactionType==="exchange"&&(ue=.8),X[ve].co2Saved+=pe.co2PerItem*ue,X[ve].waterSaved+=pe.waterPerItem*ue,X[ve].energySaved+=pe.energyPerItem*ue,X[ve].transactions+=1}}),Object.entries(X).map(([Q,re])=>({month:Q,co2Saved:Math.round(re.co2Saved*10)/10,transactions:re.transactions,waterSaved:Math.round(re.waterSaved),energySaved:Math.round(re.energySaved*10)/10}))},B=($,X,Q)=>{const re=[];$.length>=1&&re.push("first_transaction"),X>=10&&re.push("co2_saver_10"),X>=50&&re.push("co2_saver_50"),X>=100&&re.push("co2_saver_100"),Q>=1e3&&re.push("water_saver"),$.length>=20&&re.push("recycling_master"),$.filter(ge=>ge.transactionType==="donation").length>=5&&re.push("donation_hero");const pe=new Date().toISOString().slice(0,7);return $.filter(ge=>yv(ge.createdAt).toISOString().slice(0,7)===pe).length>=10&&re.push("monthly_champion"),re},V=($,X)=>{let Q="Débutant",re=0;return $>=200?(Q="Légende Écologique",re=95):$>=100?(Q="Maître Environnemental",re=85):$>=50?(Q="Expert Vert",re=70):$>=25?(Q="Éco-Warrior",re=50):$>=10?(Q="Protecteur",re=30):$>=5&&(Q="Apprenti Vert",re=15),{rank:Q,percentile:re}},W=async $=>{if(t)try{const X=hn(rr,"users",t.uid);await Rs(X,{co2Saved:$.totalCo2Saved,environmentalRank:$.rank,environmentalBadges:$.badges,lastEnvironmentalUpdate:new Date})}catch(X){console.error("Erreur lors de la mise à jour des données environnementales:",X)}},K=async()=>{const $=`🌍 Mon impact écologique sur StudyMarket :

🌱 ${r.totalCo2Saved} kg CO₂ économisés
💧 ${r.totalWaterSaved} L d'eau préservés
⚡ ${r.totalEnergySaved} kWh d'énergie économisés
🏆 Rang : ${r.rank}

Rejoignez la communauté étudiante éco-responsable ! 🎓`;if(navigator.share)try{await navigator.share({title:"Mon Impact Écologique - StudyMarket",text:$,url:window.location.origin})}catch{navigator.clipboard.writeText($)}else navigator.clipboard.writeText($)},Z=()=>{const $={user:e==null?void 0:e.displayName,date:new Date().toISOString(),impact:r,transactions:c.length,period:w},X=new Blob([JSON.stringify($,null,2)],{type:"application/json"}),Q=URL.createObjectURL(X),re=document.createElement("a");re.href=Q,re.download=`impact-ecologique-${new Date().toISOString().slice(0,10)}.json`,re.click(),URL.revokeObjectURL(Q)};return t?i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(Jd,{className:"w-8 h-8 text-green-600"}),"Mon Impact Écologique"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Découvrez votre contribution à la protection de l'environnement"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Ge,{variant:"outline",onClick:K,className:"flex items-center gap-2",children:[i.jsx($3,{className:"w-4 h-4"}),"Partager"]}),i.jsxs(Ge,{variant:"outline",onClick:Z,className:"flex items-center gap-2",children:[i.jsx(to,{className:"w-4 h-4"}),"Exporter"]})]})]}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(cl,{className:"w-5 h-5 text-muted-foreground"}),i.jsx("span",{className:"font-medium",children:"Période d'analyse :"})]}),i.jsx("div",{className:"flex gap-2",children:[{key:"month",label:"Ce mois"},{key:"year",label:"Cette année"},{key:"all",label:"Tout"}].map($=>i.jsx(Ge,{variant:w===$.key?"default":"outline",size:"sm",onClick:()=>E($.key),children:$.label},$.key))})]})})}),p?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Array.from({length:4}).map(($,X)=>i.jsx(Tt,{className:"animate-pulse",children:i.jsx(jt,{className:"pt-6",children:i.jsx("div",{className:"h-16 bg-muted rounded"})})},X))}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[i.jsx(Tt,{className:"border-green-200 bg-green-50/50",children:i.jsxs(jt,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-green-700",children:r.totalCo2Saved}),i.jsx("p",{className:"text-sm text-green-600",children:"kg CO₂ économisés"})]}),i.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:i.jsx(Jd,{className:"w-6 h-6 text-green-600"})})]}),i.jsxs("div",{className:"mt-2 text-xs text-green-600",children:["≈ ",Math.round(r.totalCo2Saved/2.3)," km en voiture évités"]})]})}),i.jsx(Tt,{className:"border-blue-200 bg-blue-50/50",children:i.jsxs(jt,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-blue-700",children:r.totalWaterSaved.toLocaleString()}),i.jsx("p",{className:"text-sm text-blue-600",children:"L d'eau préservés"})]}),i.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:i.jsx(u8,{className:"w-6 h-6 text-blue-600"})})]}),i.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:["≈ ",Math.round(r.totalWaterSaved/150)," douches économisées"]})]})}),i.jsx(Tt,{className:"border-yellow-200 bg-yellow-50/50",children:i.jsxs(jt,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:r.totalEnergySaved}),i.jsx("p",{className:"text-sm text-yellow-600",children:"kWh économisés"})]}),i.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center",children:i.jsx(cw,{className:"w-6 h-6 text-yellow-600"})})]}),i.jsxs("div",{className:"mt-2 text-xs text-yellow-600",children:["≈ ",Math.round(r.totalEnergySaved/3.5)," jours d'électricité"]})]})}),i.jsx(Tt,{className:"border-purple-200 bg-purple-50/50",children:i.jsxs(jt,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-purple-700",children:r.totalWasteAvoided}),i.jsx("p",{className:"text-sm text-purple-600",children:"kg déchets évités"})]}),i.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:i.jsx($xe,{className:"w-6 h-6 text-purple-600"})})]}),i.jsxs("div",{className:"mt-2 text-xs text-purple-600",children:["≈ ",Math.round(r.totalWasteAvoided/.5)," sacs poubelle évités"]})]})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(nZ,{className:"w-5 h-5 text-yellow-600"}),"Votre Rang Écologique"]})}),i.jsxs(jt,{children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-2xl font-bold text-primary",children:r.rank}),i.jsxs("p",{className:"text-muted-foreground",children:["Vous êtes dans le top ",100-r.percentile,"% des utilisateurs"]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-3xl",children:"🏆"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Rang actuel"})]})]}),i.jsx(Z4,{value:r.percentile,className:"h-3"}),i.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground mt-2",children:[i.jsx("span",{children:"Débutant"}),i.jsx("span",{children:"Légende Écologique"})]})]})]}),i.jsxs(Og,{defaultValue:"overview",className:"space-y-4",children:[i.jsxs(Pp,{className:"grid w-full grid-cols-4",children:[i.jsx(Wi,{value:"overview",children:"Vue d'ensemble"}),i.jsx(Wi,{value:"categories",children:"Par catégorie"}),i.jsx(Wi,{value:"badges",children:"Badges"}),i.jsx(Wi,{value:"methodology",children:"Méthodologie"})]}),i.jsxs(Zi,{value:"overview",className:"space-y-6",children:[i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(V3,{className:"w-5 h-5"}),"Évolution Mensuelle"]}),i.jsx(Ls,{children:"Votre impact environnemental au cours des 12 derniers mois"})]}),i.jsx(jt,{children:i.jsx("div",{className:"space-y-4",children:r.monthlyImpact.slice(-6).map(($,X)=>i.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),i.jsx("span",{className:"font-medium",children:new Date($.month+"-01").toLocaleDateString("fr-FR",{month:"long",year:"numeric"})})]}),i.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"font-semibold text-green-600",children:[$.co2Saved," kg"]}),i.jsx("div",{className:"text-muted-foreground",children:"CO₂"})]}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"font-semibold text-blue-600",children:[$.waterSaved," L"]}),i.jsx("div",{className:"text-muted-foreground",children:"Eau"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"font-semibold text-primary",children:$.transactions}),i.jsx("div",{className:"text-muted-foreground",children:"Transactions"})]})]})]},$.month))})})]}),i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(cZ,{className:"w-5 h-5"}),"Équivalences Concrètes"]}),i.jsx(Ls,{children:"Votre impact traduit en équivalences du quotidien"})]}),i.jsx(jt,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-lg",children:[i.jsx(aZ,{className:"w-8 h-8 text-green-600"}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-semibold",children:[Math.round(r.totalCo2Saved/2.3)," km"]}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"de trajet en voiture évités"})]})]}),i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg",children:[i.jsx(Hxe,{className:"w-8 h-8 text-blue-600"}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-semibold",children:[Math.round(r.totalCo2Saved/22)," arbres"]}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"plantés (équivalent CO₂)"})]})]}),i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 rounded-lg",children:[i.jsx(Rxe,{className:"w-8 h-8 text-yellow-600"}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-semibold",children:[Math.round(r.totalEnergySaved/24)," jours"]}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"de consommation électrique"})]})]}),i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-lg",children:[i.jsx(u8,{className:"w-8 h-8 text-purple-600"}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-semibold",children:[Math.round(r.totalWaterSaved/150)," douches"]}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"de 10 minutes économisées"})]})]})]})})]})]}),i.jsx(Zi,{value:"categories",className:"space-y-6",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(gi,{className:"w-5 h-5"}),"Impact par Catégorie"]}),i.jsx(Ls,{children:"Détail de votre impact selon les types d'objets échangés"})]}),i.jsx(jt,{children:i.jsx("div",{className:"space-y-4",children:Object.entries(r.transactionsByCategory).map(([$,X])=>{const Q=j_[$]||j_.electronics,re=Q.icon,ve=X*Q.co2PerItem;return i.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:i.jsx(re,{className:`w-5 h-5 ${Q.color}`})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold",children:Q.category}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[X," transaction",X>1?"s":""]})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("div",{className:"font-semibold text-green-600",children:[Math.round(ve*10)/10," kg CO₂"]}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[Math.round(X*Q.waterPerItem)," L eau"]})]})]},$)})})})]})}),i.jsx(Zi,{value:"badges",className:"space-y-6",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(FD,{className:"w-5 h-5"}),"Badges Écologiques"]}),i.jsx(Ls,{children:"Vos récompenses pour votre engagement environnemental"})]}),i.jsx(jt,{children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:dRe.map($=>{const X=r.badges.includes($.id);return i.jsx("div",{className:`p-4 rounded-lg border-2 transition-all ${X?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50 opacity-60"}`,children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl mb-2",children:$.icon}),i.jsx("h3",{className:`font-semibold ${X?"text-green-800":"text-gray-600"}`,children:$.name}),i.jsx("p",{className:`text-sm ${X?"text-green-600":"text-gray-500"}`,children:$.description}),X&&i.jsx(Ir,{className:"mt-2 bg-green-100 text-green-800",children:"Obtenu !"})]})},$.id)})})})]})}),i.jsx(Zi,{value:"methodology",className:"space-y-6",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(yy,{className:"w-5 h-5"}),"Méthodologie de Calcul"]}),i.jsx(Ls,{children:"Comment nous calculons votre impact environnemental"})]}),i.jsxs(jt,{className:"space-y-6",children:[i.jsxs(Ys,{children:[i.jsx(yy,{className:"h-4 w-4"}),i.jsx(Js,{children:"Nos calculs sont basés sur des études scientifiques et des données de l'ADEME (Agence de l'Environnement et de la Maîtrise de l'Énergie)."})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Principe de Base"}),i.jsx("p",{className:"text-muted-foreground",children:"Chaque objet acheté d'occasion évite la production d'un objet neuf. Nous calculons l'impact environnemental évité en nous basant sur l'empreinte carbone, hydrique et énergétique de la production de chaque catégorie d'objets."}),i.jsx("h3",{className:"text-lg font-semibold",children:"Facteurs de Calcul par Catégorie"}),i.jsx("div",{className:"space-y-3",children:Object.entries(j_).map(([$,X])=>{const Q=X.icon;return i.jsxs("div",{className:"p-3 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(Q,{className:`w-4 h-4 ${X.color}`}),i.jsx("span",{className:"font-medium",children:X.category})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"CO₂:"}),i.jsxs("span",{className:"ml-1 font-medium",children:[X.co2PerItem," kg"]})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Eau:"}),i.jsxs("span",{className:"ml-1 font-medium",children:[X.waterPerItem," L"]})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Énergie:"}),i.jsxs("span",{className:"ml-1 font-medium",children:[X.energyPerItem," kWh"]})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Déchets:"}),i.jsxs("span",{className:"ml-1 font-medium",children:[X.wastePerItem," kg"]})]})]})]},$)})}),i.jsx("h3",{className:"text-lg font-semibold",children:"Facteurs de Pondération"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(P0,{className:"w-4 h-4 text-green-600"}),i.jsxs("span",{children:[i.jsx("strong",{children:"Dons gratuits :"})," +20% d'impact (encourage le partage)"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Yo,{className:"w-4 h-4 text-purple-600"}),i.jsxs("span",{children:[i.jsx("strong",{children:"Échanges/Troc :"})," -20% d'impact (pas de transaction monétaire)"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(gi,{className:"w-4 h-4 text-blue-600"}),i.jsxs("span",{children:[i.jsx("strong",{children:"Ventes :"})," Impact standard (100%)"]})]})]}),i.jsx("h3",{className:"text-lg font-semibold",children:"Sources et Références"}),i.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[i.jsx("li",{children:"• ADEME - Base Carbone® pour les facteurs d'émission"}),i.jsx("li",{children:"• Water Footprint Network pour l'empreinte hydrique"}),i.jsx("li",{children:"• IEA (International Energy Agency) pour l'énergie"}),i.jsx("li",{children:"• Ellen MacArthur Foundation pour l'économie circulaire"})]})]})]})]})})]})]})]}):i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(Jd,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connectez-vous pour voir votre impact"}),i.jsx("p",{className:"text-muted-foreground",children:"Découvrez combien vous contribuez à la protection de l'environnement"})]})})})},Nj=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch{return new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return t&&typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date},LI=t=>{if(t==null)return null;if(Array.isArray(t))return t.map(LI).filter(e=>e!==void 0);if(typeof t=="object"&&t!==null){const e={};return Object.keys(t).forEach(r=>{const n=LI(t[r]);n!==void 0&&(e[r]=n)}),e}return t},F$=[{value:"all",label:"Toutes catégories"},{value:"electronics",label:"Électronique"},{value:"books",label:"Livres & Cours"},{value:"furniture",label:"Mobilier"},{value:"clothing",label:"Vêtements"},{value:"services",label:"Services"},{value:"housing",label:"Logement"},{value:"jobs",label:"Jobs & Stages"}],z$=[{value:"all",label:"Tous types"},{value:"sale",label:"Vente"},{value:"donation",label:"Don"},{value:"exchange",label:"Échange"},{value:"service",label:"Service"}],fRe=[{value:"all",label:"Toutes universités"},{value:"sorbonne",label:"Sorbonne Université"},{value:"dauphine",label:"Université Paris-Dauphine"},{value:"polytechnique",label:"École Polytechnique"},{value:"ens",label:"ENS Paris"},{value:"centrale",label:"CentraleSupélec"}],pRe=()=>{const{currentUser:t,userProfile:e}=$i(),[r,n]=z.useState([]),[c,d]=z.useState([]),[p,a]=z.useState({totalSearches:0,activeAlerts:0,totalMatches:0,newMatches:0}),[w,E]=z.useState({searches:!0,matches:!0,creating:!1,updating:!1}),[C,P]=z.useState(!1),[R,B]=z.useState(null),[V,W]=z.useState({name:"",query:"",category:"all",transactionType:"all",university:"all",minPrice:"",maxPrice:"",alertsEnabled:!0,notificationFrequency:"daily",notificationMethods:{email:!0,push:!0,sms:!1}});z.useEffect(()=>{t&&(K(),Z())},[t]);const K=async()=>{if(t)try{E(ke=>({...ke,searches:!0}));const ce=ms(jn(rr,"savedSearches"),ii("userId","==",t.uid),la(50)),Se=await gs(ce),le=[];Se.forEach(ke=>{const Ze=ke.data();le.push({id:ke.id,...Ze,createdAt:Nj(Ze.createdAt),updatedAt:Nj(Ze.updatedAt),lastNotified:Ze.lastNotified?Nj(Ze.lastNotified):void 0})}),le.sort((ke,Ze)=>Ze.createdAt.getTime()-ke.createdAt.getTime()),n(le);const J=le.filter(ke=>ke.alertsEnabled).length;a(ke=>({...ke,totalSearches:le.length,activeAlerts:J}))}catch(ce){console.error("Erreur lors du chargement des recherches sauvegardées:",ce),Nt.error("Erreur lors du chargement des recherches sauvegardées")}finally{E(ce=>({...ce,searches:!1}))}},Z=async()=>{if(t)try{E(ke=>({...ke,matches:!0}));const ce=ms(jn(rr,"alertMatches"),ii("userId","==",t.uid),la(100)),Se=await gs(ce),le=[];Se.forEach(ke=>{const Ze=ke.data();le.push({id:ke.id,...Ze,matchedAt:Nj(Ze.matchedAt)})}),le.sort((ke,Ze)=>Ze.matchedAt.getTime()-ke.matchedAt.getTime()),d(le);const J=le.filter(ke=>!ke.seen).length;a(ke=>({...ke,totalMatches:le.length,newMatches:J}))}catch(ce){console.error("Erreur lors du chargement des correspondances:",ce),Nt.error("Erreur lors du chargement des correspondances")}finally{E(ce=>({...ce,matches:!1}))}},$=async()=>{if(!t||!V.name.trim()){Nt.error("Veuillez remplir le nom de la recherche");return}E(ce=>({...ce,creating:!0}));try{const ce={};if(V.query&&V.query.trim()&&(ce.query=V.query.trim()),V.category&&V.category!=="all"&&(ce.category=V.category),V.transactionType&&V.transactionType!=="all"&&(ce.transactionType=V.transactionType),V.university&&V.university!=="all"&&(ce.university=V.university),V.minPrice&&V.minPrice.trim()){const J=parseFloat(V.minPrice);!isNaN(J)&&J>=0&&(ce.minPrice=J)}if(V.maxPrice&&V.maxPrice.trim()){const J=parseFloat(V.maxPrice);!isNaN(J)&&J>=0&&(ce.maxPrice=J)}const Se={userId:t.uid,name:V.name.trim(),filters:ce,alertsEnabled:V.alertsEnabled,notificationFrequency:V.notificationFrequency,notificationMethods:{email:V.notificationMethods.email,push:V.notificationMethods.push,sms:V.notificationMethods.sms},matchCount:0,createdAt:new Date,updatedAt:new Date},le=LI(Se);await af(jn(rr,"savedSearches"),le),Nt.success("Alerte créée avec succès !"),P(!1),pe(),K()}catch(ce){console.error("Erreur lors de la création de l'alerte:",ce),Nt.error("Erreur lors de la création de l'alerte")}finally{E(ce=>({...ce,creating:!1}))}},X=async(ce,Se)=>{try{E(J=>({...J,updating:!0}));const le=LI({...Se,updatedAt:new Date});await Rs(hn(rr,"savedSearches",ce),le),Nt.success("Recherche mise à jour !"),K()}catch(le){console.error("Erreur lors de la mise à jour:",le),Nt.error("Erreur lors de la mise à jour")}finally{E(le=>({...le,updating:!1}))}},Q=async ce=>{if(window.confirm("Êtes-vous sûr de vouloir supprimer cette recherche sauvegardée ?"))try{await cd(hn(rr,"savedSearches",ce)),Nt.success("Recherche supprimée !"),K()}catch(Se){console.error("Erreur lors de la suppression:",Se),Nt.error("Erreur lors de la suppression")}},re=async(ce,Se)=>{await X(ce,{alertsEnabled:Se})},ve=async ce=>{try{await Rs(hn(rr,"alertMatches",ce),{seen:!0,seenAt:new Date}),Z()}catch(Se){console.error("Erreur lors du marquage comme vu:",Se)}},pe=()=>{W({name:"",query:"",category:"all",transactionType:"all",university:"all",minPrice:"",maxPrice:"",alertsEnabled:!0,notificationFrequency:"daily",notificationMethods:{email:!0,push:!0,sms:!1}}),B(null)},ue=ce=>{try{return _w(ce,{addSuffix:!0,locale:po})}catch{return"Date inconnue"}},ge=ce=>{const Se=[];if(ce.query&&Se.push(`"${ce.query}"`),ce.category&&ce.category!=="all"){const le=F$.find(J=>J.value===ce.category);le&&Se.push(le.label)}if(ce.transactionType&&ce.transactionType!=="all"){const le=z$.find(J=>J.value===ce.transactionType);le&&Se.push(le.label)}return ce.minPrice!==void 0&&Se.push(`≥ ${ce.minPrice}€`),ce.maxPrice!==void 0&&Se.push(`≤ ${ce.maxPrice}€`),Se.length>0?Se.join(" • "):"Tous les critères"};return t?i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(Bd,{className:"w-8 h-8 text-primary"}),"Mes Alertes",p.totalSearches>0&&i.jsx(Ir,{variant:"secondary\\",className:"ml-1",children:p.totalSearches})]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Gérez vos recherches sauvegardées et recevez des notifications"})]}),i.jsxs(ta,{open:C,onOpenChange:P,children:[i.jsx(l0,{asChild:!0,children:i.jsxs(Ge,{className:"bg-gradient-to-r from-primary to-secondary",children:[i.jsx(W_,{className:"w-4 h-4 mr-2"}),"Nouvelle Alerte"]})}),i.jsxs(Ki,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(oa,{children:[i.jsxs(ra,{className:"flex items-center gap-2",children:[i.jsx(S_,{className:"w-5 h-5"}),"Créer une Alerte Personnalisée"]}),i.jsx(go,{children:"Définissez vos critères de recherche et recevez des notifications pour les nouvelles annonces correspondantes"})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"alert-name",children:"Nom de l'alerte *"}),i.jsx(Gr,{id:"alert-name",value:V.name,onChange:ce=>W(Se=>({...Se,name:ce.target.value})),placeholder:"Ex: MacBook Pro pas cher",className:"mt-1"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[i.jsx($C,{className:"w-4 h-4"}),"Critères de Recherche"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"search-query",children:"Mots-clés"}),i.jsx(Gr,{id:"search-query",value:V.query,onChange:ce=>W(Se=>({...Se,query:ce.target.value})),placeholder:"Ex: MacBook, iPhone, livre...",className:"mt-1"})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"search-category",children:"Catégorie"}),i.jsxs(ds,{value:V.category,onValueChange:ce=>W(Se=>({...Se,category:ce})),children:[i.jsx(is,{className:"mt-1",children:i.jsx(hs,{})}),i.jsx(as,{children:F$.map(ce=>i.jsx(Bt,{value:ce.value,children:ce.label},ce.value))})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"transaction-type",children:"Type de transaction"}),i.jsxs(ds,{value:V.transactionType,onValueChange:ce=>W(Se=>({...Se,transactionType:ce})),children:[i.jsx(is,{className:"mt-1",children:i.jsx(hs,{})}),i.jsx(as,{children:z$.map(ce=>i.jsx(Bt,{value:ce.value,children:ce.label},ce.value))})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"search-university",children:"Université"}),i.jsxs(ds,{value:V.university,onValueChange:ce=>W(Se=>({...Se,university:ce})),children:[i.jsx(is,{className:"mt-1",children:i.jsx(hs,{})}),i.jsx(as,{children:fRe.map(ce=>i.jsx(Bt,{value:ce.value,children:ce.label},ce.value))})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"min-price",children:"Prix minimum (€)"}),i.jsx(Gr,{id:"min-price",type:"number",value:V.minPrice,onChange:ce=>W(Se=>({...Se,minPrice:ce.target.value})),placeholder:"0",className:"mt-1",min:"0"})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"max-price",children:"Prix maximum (€)"}),i.jsx(Gr,{id:"max-price",type:"number",value:V.maxPrice,onChange:ce=>W(Se=>({...Se,maxPrice:ce.target.value})),placeholder:"1000",className:"mt-1",min:"0"})]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[i.jsx(Bd,{className:"w-4 h-4"}),"Notifications"]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"alerts-enabled",children:"Activer les notifications"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Recevoir des alertes pour cette recherche"})]}),i.jsx(Zo,{id:"alerts-enabled",checked:V.alertsEnabled,onCheckedChange:ce=>W(Se=>({...Se,alertsEnabled:ce}))})]}),V.alertsEnabled&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx(Zr,{children:"Fréquence des notifications"}),i.jsx("div",{className:"mt-2 space-y-2",children:[{value:"instant",label:"Instantané",description:"Dès qu'une nouvelle annonce correspond"},{value:"daily",label:"Quotidien",description:"Un résumé par jour"},{value:"weekly",label:"Hebdomadaire",description:"Un résumé par semaine"}].map(ce=>i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"radio",id:ce.value,name:"frequency",value:ce.value,checked:V.notificationFrequency===ce.value,onChange:Se=>W(le=>({...le,notificationFrequency:Se.target.value})),className:"rounded border-border"}),i.jsx(Zr,{htmlFor:ce.value,className:"cursor-pointer",children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:ce.label}),i.jsx("div",{className:"text-sm text-muted-foreground",children:ce.description})]})})]},ce.value))})]}),i.jsxs("div",{children:[i.jsx(Zr,{children:"Méthodes de notification"}),i.jsxs("div",{className:"mt-2 space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Nl,{className:"w-4 h-4 text-blue-600"}),i.jsx(Zr,{htmlFor:"email-notifications",children:"Email"})]}),i.jsx(Zo,{id:"email-notifications",checked:V.notificationMethods.email,onCheckedChange:ce=>W(Se=>({...Se,notificationMethods:{...Se.notificationMethods,email:ce}}))})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Bd,{className:"w-4 h-4 text-green-600"}),i.jsx(Zr,{htmlFor:"push-notifications",children:"Notifications push"})]}),i.jsx(Zo,{id:"push-notifications",checked:V.notificationMethods.push,onCheckedChange:ce=>W(Se=>({...Se,notificationMethods:{...Se.notificationMethods,push:ce}}))})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(iI,{className:"w-4 h-4 text-purple-600"}),i.jsx(Zr,{htmlFor:"sms-notifications",children:"SMS"}),i.jsx(Ir,{variant:"outline",className:"text-xs",children:"Bientôt"})]}),i.jsx(Zo,{id:"sms-notifications",checked:V.notificationMethods.sms,onCheckedChange:ce=>W(Se=>({...Se,notificationMethods:{...Se.notificationMethods,sms:ce}})),disabled:!0})]})]})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[i.jsx(Ge,{variant:"outline",onClick:()=>P(!1),children:"Annuler"}),i.jsx(Ge,{onClick:$,disabled:w.creating||!V.name.trim(),children:w.creating?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Création..."]}):i.jsxs(i.Fragment,{children:[i.jsx(S_,{className:"w-4 h-4 mr-2"}),"Créer l'alerte"]})})]})]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:p.totalSearches}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Recherches sauvées"})]}),i.jsx(Oo,{className:"w-8 h-8 text-blue-600"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:p.activeAlerts}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Alertes actives"})]}),i.jsx(Bd,{className:"w-8 h-8 text-green-600"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:p.totalMatches}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Correspondances"})]}),i.jsx(S_,{className:"w-8 h-8 text-purple-600"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-blue-600",children:p.newMatches}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Nouvelles"})]}),i.jsx(cw,{className:"w-8 h-8 text-blue-600"})]})})})]}),i.jsxs(Og,{defaultValue:"searches",className:"space-y-4",children:[i.jsxs(Pp,{className:"grid w-full grid-cols-2",children:[i.jsxs(Wi,{value:"searches",className:"flex items-center gap-2",children:[i.jsx(Oo,{className:"w-4 h-4"}),"Mes Recherches",p.totalSearches>0&&i.jsx(Ir,{variant:"secondary\\",className:"ml-1",children:p.totalSearches})]}),i.jsxs(Wi,{value:"matches",className:"flex items-center gap-2",children:[i.jsx(S_,{className:"w-4 h-4"}),"Correspondances",p.newMatches>0&&i.jsx(Ir,{className:"ml-1 bg-blue-500",children:p.newMatches})]})]}),i.jsx(Zi,{value:"searches",className:"space-y-4",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(B3,{className:"w-5 h-5"}),"Recherches Sauvegardées"]}),i.jsx(Ls,{children:"Gérez vos alertes et critères de recherche personnalisés"})]}),i.jsx(jt,{children:w.searches?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((ce,Se)=>i.jsxs("div",{className:"border rounded-lg p-4 animate-pulse",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"h-5 bg-muted rounded w-1/3"}),i.jsx("div",{className:"h-6 bg-muted rounded w-16"})]}),i.jsx("div",{className:"h-4 bg-muted rounded w-2/3 mb-2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/4"})]},Se))}):r.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Oo,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune recherche sauvegardée"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Créez votre première alerte pour être notifié des nouvelles annonces"}),i.jsxs(Ge,{onClick:()=>P(!0),children:[i.jsx(W_,{className:"w-4 h-4 mr-2"}),"Créer ma première alerte"]})]}):i.jsx("div",{className:"space-y-4",children:r.map(ce=>i.jsxs("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("h3",{className:"font-semibold",children:ce.name}),ce.alertsEnabled?i.jsxs(Ir,{className:"bg-green-100 text-green-800",children:[i.jsx(Bd,{className:"w-3 h-3 mr-1"}),"Actif"]}):i.jsxs(Ir,{variant:"secondary",children:[i.jsx(h8,{className:"w-3 h-3 mr-1"}),"Pausé"]})]}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:ge(ce.filters)}),i.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),"Créé ",ue(ce.createdAt)]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(S_,{className:"w-3 h-3"}),ce.matchCount," correspondance",ce.matchCount!==1?"s":""]}),ce.lastNotified&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Bd,{className:"w-3 h-3"}),"Dernière alerte ",ue(ce.lastNotified)]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ge,{variant:"ghost",size:"icon",onClick:()=>re(ce.id,!ce.alertsEnabled),title:ce.alertsEnabled?"Désactiver les alertes":"Activer les alertes",children:ce.alertsEnabled?i.jsx(h8,{className:"w-4 h-4"}):i.jsx(mZ,{className:"w-4 h-4"})}),i.jsx(Ge,{variant:"ghost",size:"icon",onClick:()=>{var Se,le;B(ce),W({name:ce.name,query:ce.filters.query||"",category:ce.filters.category||"all",transactionType:ce.filters.transactionType||"all",university:ce.filters.university||"all",minPrice:((Se=ce.filters.minPrice)==null?void 0:Se.toString())||"",maxPrice:((le=ce.filters.maxPrice)==null?void 0:le.toString())||"",alertsEnabled:ce.alertsEnabled,notificationFrequency:ce.notificationFrequency,notificationMethods:ce.notificationMethods}),P(!0)},title:"Modifier",children:i.jsx(gZ,{className:"w-4 h-4"})}),i.jsx(Ge,{variant:"ghost",size:"icon",onClick:()=>Q(ce.id),title:"Supprimer",className:"text-destructive hover:text-destructive",children:i.jsx(nd,{className:"w-4 h-4"})})]})]}),ce.alertsEnabled&&i.jsxs("div",{className:"flex items-center gap-4 text-xs bg-muted/50 rounded p-2",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Fi,{className:"w-3 h-3"}),i.jsxs("span",{children:["Fréquence: ",ce.notificationFrequency==="instant"?"Instantané":ce.notificationFrequency==="daily"?"Quotidien":"Hebdomadaire"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[ce.notificationMethods.email&&i.jsx(Nl,{className:"w-3 h-3 text-blue-600\\",title:"Email activé"}),ce.notificationMethods.push&&i.jsx(Bd,{className:"w-3 h-3 text-green-600\\",title:"Push activé"}),ce.notificationMethods.sms&&i.jsx(iI,{className:"w-3 h-3 text-purple-600\\",title:"SMS activé"})]})]})]},ce.id))})})]})}),i.jsx(Zi,{value:"matches",className:"space-y-4",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(S_,{className:"w-5 h-5"}),"Correspondances Trouvées"]}),i.jsx(Ls,{children:"Les annonces qui correspondent à vos critères de recherche"})]}),i.jsx(jt,{children:w.matches?i.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((ce,Se)=>i.jsx("div",{className:"border rounded-lg p-4 animate-pulse",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-16 h-16 bg-muted rounded"}),i.jsxs("div",{className:"flex-1 space-y-2",children:[i.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/4"})]})]})},Se))}):c.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(S_,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune correspondance"}),i.jsx("p",{className:"text-muted-foreground",children:"Aucune annonce ne correspond encore à vos critères. Les nouvelles correspondances apparaîtront ici."})]}):i.jsx("div",{className:"space-y-4",children:c.map(ce=>i.jsx("div",{className:`border rounded-lg p-4 transition-colors ${ce.seen?"hover:bg-muted/50":"bg-blue-50 border-blue-200"}`,children:i.jsxs("div",{className:"flex items-center gap-4",children:[ce.listingImage?i.jsx("img",{src:ce.listingImage,alt:ce.listingTitle,className:"w-16 h-16 object-cover rounded"}):i.jsx("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsx(Package,{className:"w-6 h-6 text-muted-foreground"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("h3",{className:"font-semibold",children:ce.listingTitle}),i.jsxs("div",{className:"flex items-center gap-2",children:[!ce.seen&&i.jsx(Ir,{className:"bg-blue-500",children:"Nouveau"}),i.jsx("span",{className:"font-semibold text-primary",children:ce.listingPrice===0?"Gratuit":`${ce.listingPrice}€`})]})]}),i.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Fi,{className:"w-3 h-3"}),"Trouvé ",ue(ce.matchedAt)]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ge,{variant:"outline",size:"sm",onClick:()=>ve(ce.id),disabled:ce.seen,children:ce.seen?i.jsxs(i.Fragment,{children:[i.jsx(qs,{className:"w-3 h-3 mr-1"}),"Vu"]}):i.jsxs(i.Fragment,{children:[i.jsx(Fo,{className:"w-3 h-3 mr-1"}),"Marquer comme vu"]})}),i.jsxs(Ge,{size:"sm",onClick:()=>window.open(`/listing/${ce.listingId}`,"_blank"),children:[i.jsx(Ec,{className:"w-3 h-3 mr-1"}),"Voir l'annonce"]})]})]})]})]})},ce.id))})})]})})]})]}):i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(Oo,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connectez-vous pour gérer vos alertes"}),i.jsx("p",{className:"text-muted-foreground",children:"Créez des alertes personnalisées pour être notifié des nouvelles annonces"})]})})})},Ij=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch{return new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return t&&typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date},B$=[{value:"all",label:"Toutes catégories",icon:gi},{value:"electronics",label:"Électronique",icon:Ag},{value:"books",label:"Livres & Cours",icon:sZ},{value:"furniture",label:"Mobilier",icon:qd},{value:"clothing",label:"Vêtements",icon:q3},{value:"services",label:"Services",icon:Sp},{value:"housing",label:"Logement",icon:qd},{value:"jobs",label:"Jobs & Stages",icon:cS}],mRe=[{value:"all",label:"Tous types",icon:gi},{value:"sale",label:"Vente",icon:_y},{value:"donation",label:"Don",icon:P0},{value:"exchange",label:"Échange",icon:Yo},{value:"service",label:"Service",icon:Sp}],gRe=[{value:"recent",label:"Plus récents",icon:Fi},{value:"oldest",label:"Plus anciens",icon:cl},{value:"price-asc",label:"Prix croissant",icon:c8},{value:"price-desc",label:"Prix décroissant",icon:rZ},{value:"title",label:"Titre A-Z",icon:c8},{value:"category",label:"Par catégorie",icon:oI}],_Re=()=>{const{currentUser:t,userProfile:e}=$i(),[r,n]=z.useState([]),[c,d]=z.useState([]),[p,a]=z.useState({totalFavorites:0,byCategory:{},byTransactionType:{},averagePrice:0,recentlyAdded:0,availableCount:0,soldCount:0}),[w,E]=z.useState({favorites:!0,listings:!0,removing:!1}),[C,P]=z.useState({search:"",category:"all",transactionType:"all",priceRange:"all",availability:"all"}),[R,B]=z.useState("recent"),[V,W]=z.useState("grid"),[K,Z]=z.useState([]);z.useEffect(()=>{t&&$()},[t]),z.useEffect(()=>{r.length>0&&X()},[r]);const $=async()=>{if(t)try{E(Xe=>({...Xe,favorites:!0}));const J=ms(jn(rr,"favorites"),ii("userId","==",t.uid),la(100)),ke=await gs(J),Ze=[];ke.forEach(Xe=>{const qe=Xe.data();Ze.push({id:Xe.id,...qe,createdAt:Ij(qe.createdAt),updatedAt:Ij(qe.updatedAt)})}),Ze.sort((Xe,qe)=>qe.createdAt.getTime()-Xe.createdAt.getTime()),n(Ze),Q(Ze)}catch(J){console.error("Erreur lors du chargement des favoris:",J),Nt.error("Erreur lors du chargement des favoris")}finally{E(J=>({...J,favorites:!1}))}},X=async()=>{try{E(Xe=>({...Xe,listings:!0}));const J=r.map(async Xe=>{try{const qe=await Xa(hn(rr,"listings",Xe.listingId));if(qe.exists()){const $e=qe.data();return{id:qe.id,...$e,createdAt:Ij($e.createdAt),updatedAt:Ij($e.updatedAt)}}return null}catch(qe){return console.error(`Erreur lors du chargement de l'annonce ${Xe.listingId}:`,qe),null}}),Ze=(await Promise.all(J)).filter(Xe=>Xe!==null);d(Ze)}catch(J){console.error("Erreur lors du chargement des annonces favorites:",J)}finally{E(J=>({...J,listings:!1}))}},Q=J=>{const ke={},Ze={};let Xe=0,qe=0;const $e=new Date;$e.setDate($e.getDate()-7);let st=0;J.forEach(it=>{ke[it.listingCategory]=(ke[it.listingCategory]||0)+1,Ze[it.listingTransactionType]=(Ze[it.listingTransactionType]||0)+1,it.listingPrice>0&&(Xe+=it.listingPrice,qe++),it.createdAt>=$e&&st++}),a({totalFavorites:J.length,byCategory:ke,byTransactionType:Ze,averagePrice:qe>0?Math.round(Xe/qe):0,recentlyAdded:st,availableCount:J.length,soldCount:0})},re=async J=>{try{await cd(hn(rr,"favorites",J)),Nt.success("Favori supprimé"),$()}catch(ke){console.error("Erreur lors de la suppression:",ke),Nt.error("Erreur lors de la suppression")}},ve=async()=>{if(K.length!==0&&window.confirm(`Supprimer ${K.length} favori(s) sélectionné(s) ?`)){E(J=>({...J,removing:!0}));try{const J=K.map(ke=>cd(hn(rr,"favorites",ke)));await Promise.all(J),Nt.success(`${K.length} favori(s) supprimé(s)`),Z([]),$()}catch(J){console.error("Erreur lors de la suppression multiple:",J),Nt.error("Erreur lors de la suppression")}finally{E(J=>({...J,removing:!1}))}}},pe=()=>{const J={user:e==null?void 0:e.displayName,exportDate:new Date().toISOString(),totalFavorites:r.length,favorites:r.map(qe=>({title:qe.listingTitle,price:qe.listingPrice,category:qe.listingCategory,transactionType:qe.listingTransactionType,seller:qe.sellerName,university:qe.sellerUniversity,addedDate:qe.createdAt.toISOString(),notes:qe.notes||"",tags:qe.tags}))},ke=new Blob([JSON.stringify(J,null,2)],{type:"application/json"}),Ze=URL.createObjectURL(ke),Xe=document.createElement("a");Xe.href=Ze,Xe.download=`mes-favoris-${new Date().toISOString().slice(0,10)}.json`,Xe.click(),URL.revokeObjectURL(Ze)},ue=async()=>{const J=`🌟 Mes favoris StudyMarket :

📚 ${p.totalFavorites} annonces sauvegardées
💰 Prix moyen : ${p.averagePrice}€
🆕 ${p.recentlyAdded} ajoutées cette semaine

Découvrez la marketplace étudiante ! 🎓`;if(navigator.share)try{await navigator.share({title:"Mes Favoris - StudyMarket",text:J,url:window.location.origin})}catch{navigator.clipboard.writeText(J),Nt.success("Lien copié dans le presse-papiers")}else navigator.clipboard.writeText(J),Nt.success("Lien copié dans le presse-papiers")},ge=()=>{let J=r;if(C.search){const ke=C.search.toLowerCase();J=J.filter(Ze=>Ze.listingTitle.toLowerCase().includes(ke)||Ze.sellerName.toLowerCase().includes(ke)||Ze.tags.some(Xe=>Xe.toLowerCase().includes(ke)))}if(C.category!=="all"&&(J=J.filter(ke=>ke.listingCategory===C.category)),C.transactionType!=="all"&&(J=J.filter(ke=>ke.listingTransactionType===C.transactionType)),C.priceRange!=="all")switch(C.priceRange){case"free":J=J.filter(ke=>ke.listingPrice===0);break;case"under-50":J=J.filter(ke=>ke.listingPrice>0&&ke.listingPrice<50);break;case"50-200":J=J.filter(ke=>ke.listingPrice>=50&&ke.listingPrice<=200);break;case"over-200":J=J.filter(ke=>ke.listingPrice>200);break}switch(R){case"recent":J.sort((ke,Ze)=>Ze.createdAt.getTime()-ke.createdAt.getTime());break;case"oldest":J.sort((ke,Ze)=>ke.createdAt.getTime()-Ze.createdAt.getTime());break;case"price-asc":J.sort((ke,Ze)=>ke.listingPrice-Ze.listingPrice);break;case"price-desc":J.sort((ke,Ze)=>Ze.listingPrice-ke.listingPrice);break;case"title":J.sort((ke,Ze)=>ke.listingTitle.localeCompare(Ze.listingTitle));break;case"category":J.sort((ke,Ze)=>ke.listingCategory.localeCompare(Ze.listingCategory));break}return J},ce=J=>{try{return _w(J,{addSuffix:!0,locale:po})}catch{return"Date inconnue"}},Se=(J,ke)=>ke==="donation"?"Gratuit":ke==="exchange"?"Échange":J===0?"Gratuit":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(J),le=ge();return t?i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(Tc,{className:"w-8 h-8 text-red-500"}),"Mes Favoris",p.totalFavorites>0&&i.jsx(Ir,{variant:"secondary\\",className:"ml-1",children:p.totalFavorites})]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Retrouvez toutes vos annonces sauvegardées"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Ge,{variant:"outline",onClick:ue,className:"flex items-center gap-2",children:[i.jsx($3,{className:"w-4 h-4"}),"Partager"]}),i.jsxs(Ge,{variant:"outline",onClick:pe,className:"flex items-center gap-2",children:[i.jsx(to,{className:"w-4 h-4"}),"Exporter"]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:p.totalFavorites}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Favoris totaux"})]}),i.jsx(Tc,{className:"w-8 h-8 text-red-500"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-2xl font-bold",children:[p.averagePrice,"€"]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Prix moyen"})]}),i.jsx(bp,{className:"w-8 h-8 text-green-600"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:p.recentlyAdded}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Cette semaine"})]}),i.jsx(cw,{className:"w-8 h-8 text-blue-600"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:Object.keys(p.byCategory).length}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Catégories"})]}),i.jsx(oI,{className:"w-8 h-8 text-purple-600"})]})})})]}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Oo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{placeholder:"Rechercher dans vos favoris...",value:C.search,onChange:J=>P(ke=>({...ke,search:J.target.value})),className:"pl-10"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(ds,{value:R,onValueChange:B,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{})}),i.jsx(as,{children:gRe.map(J=>i.jsx(Bt,{value:J.value,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(J.icon,{className:"w-4 h-4"}),J.label]})},J.value))})]}),i.jsxs("div",{className:"flex border rounded-lg overflow-hidden",children:[i.jsx(Ge,{variant:V==="grid"?"default":"ghost",size:"icon",onClick:()=>W("grid"),className:"rounded-none",children:i.jsx(uZ,{className:"w-4 h-4"})}),i.jsx(Ge,{variant:V==="list"?"default":"ghost",size:"icon",onClick:()=>W("list"),className:"rounded-none",children:i.jsx(fZ,{className:"w-4 h-4"})})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsxs(ds,{value:C.category,onValueChange:J=>P(ke=>({...ke,category:J})),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Catégorie"})}),i.jsx(as,{children:B$.map(J=>i.jsx(Bt,{value:J.value,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(J.icon,{className:"w-4 h-4"}),J.label]})},J.value))})]}),i.jsxs(ds,{value:C.transactionType,onValueChange:J=>P(ke=>({...ke,transactionType:J})),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Type"})}),i.jsx(as,{children:mRe.map(J=>i.jsx(Bt,{value:J.value,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(J.icon,{className:"w-4 h-4"}),J.label]})},J.value))})]}),i.jsxs(ds,{value:C.priceRange,onValueChange:J=>P(ke=>({...ke,priceRange:J})),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Prix"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous les prix"}),i.jsx(Bt,{value:"free",children:"Gratuit"}),i.jsx(Bt,{value:"under-50",children:"Moins de 50€"}),i.jsx(Bt,{value:"50-200",children:"50€ - 200€"}),i.jsx(Bt,{value:"over-200",children:"Plus de 200€"})]})]}),i.jsxs(ds,{value:C.availability,onValueChange:J=>P(ke=>({...ke,availability:J})),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Disponibilité"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Toutes"}),i.jsx(Bt,{value:"available",children:"Disponibles"}),i.jsx(Bt,{value:"sold",children:"Vendues"}),i.jsx(Bt,{value:"reserved",children:"Réservées"})]})]})]}),K.length>0&&i.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[i.jsxs("span",{className:"text-sm font-medium text-blue-800",children:[K.length," favori(s) sélectionné(s)"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Ge,{variant:"outline",size:"sm",onClick:()=>Z([]),children:"Désélectionner"}),i.jsx(Ge,{variant:"destructive",size:"sm",onClick:ve,disabled:w.removing,children:w.removing?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin mr-1"}),"Suppression..."]}):i.jsxs(i.Fragment,{children:[i.jsx(nd,{className:"w-3 h-3 mr-1"}),"Supprimer"]})})]})]})]})})}),i.jsx("div",{className:"space-y-4",children:w.favorites?i.jsx("div",{className:`grid gap-6 ${V==="grid"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":"grid-cols-1"}`,children:Array.from({length:6}).map((J,ke)=>i.jsxs(Tt,{className:"animate-pulse",children:[i.jsx("div",{className:"aspect-[4/3] bg-muted"}),i.jsxs(jt,{className:"p-4 space-y-2",children:[i.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/4"})]})]},ke))}):le.length===0?i.jsx(Tt,{children:i.jsx(jt,{className:"pt-12 pb-12 text-center",children:r.length===0?i.jsxs(i.Fragment,{children:[i.jsx(Tc,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Aucun favori"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Vous n'avez pas encore ajouté d'annonces à vos favoris. Explorez les annonces et cliquez sur ❤️ pour les sauvegarder !"}),i.jsx(Ge,{asChild:!0,children:i.jsxs("a",{href:"/listings",children:[i.jsx(Oo,{className:"w-4 h-4 mr-2"}),"Explorer les annonces"]})})]}):i.jsxs(i.Fragment,{children:[i.jsx($C,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Aucun résultat"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Aucun favori ne correspond à vos critères de recherche. Essayez de modifier vos filtres."}),i.jsx(Ge,{variant:"outline",onClick:()=>P({search:"",category:"all",transactionType:"all",priceRange:"all",availability:"all"}),children:"Réinitialiser les filtres"})]})})}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("p",{className:"text-muted-foreground",children:[le.length," favori(s) trouvé(s)",le.length!==r.length&&` sur ${r.length}`]}),i.jsx(Ge,{variant:"outline",size:"sm",onClick:()=>{K.length===le.length?Z([]):Z(le.map(J=>J.id))},children:K.length===le.length?"Désélectionner tout":"Sélectionner tout"})]}),V==="grid"?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:le.map(J=>{const ke=c.find(Ze=>Ze.id===J.listingId);return i.jsxs("div",{className:"relative group",children:[i.jsx("div",{className:"absolute top-2 left-2 z-10",children:i.jsx("input",{type:"checkbox",checked:K.includes(J.id),onChange:Ze=>{Ze.target.checked?Z(Xe=>[...Xe,J.id]):Z(Xe=>Xe.filter(qe=>qe!==J.id))},className:"w-4 h-4 rounded border-border bg-background"})}),i.jsx("div",{className:"absolute top-2 right-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:i.jsx(Ge,{variant:"destructive",size:"icon",className:"w-8 h-8",onClick:()=>re(J.id),children:i.jsx(nd,{className:"w-4 h-4"})})}),ke?i.jsx(XS,{listing:ke}):i.jsxs(Tt,{children:[i.jsx("div",{className:"aspect-[4/3] bg-muted flex items-center justify-center",children:i.jsxs("div",{className:"text-center text-muted-foreground",children:[i.jsx(Yd,{className:"w-8 h-8 mx-auto mb-2"}),i.jsx("p",{className:"text-sm",children:"Annonce non disponible"})]})}),i.jsxs(jt,{className:"p-4",children:[i.jsx("h3",{className:"font-semibold mb-2",children:J.listingTitle}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:Se(J.listingPrice,J.listingTransactionType)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ajouté ",ce(J.createdAt)]})]})]})]},J.id)})}):i.jsx("div",{className:"space-y-4",children:le.map(J=>{var Ze;const ke=c.find(Xe=>Xe.id===J.listingId);return i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsx(jt,{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("input",{type:"checkbox",checked:K.includes(J.id),onChange:Xe=>{Xe.target.checked?Z(qe=>[...qe,J.id]):Z(qe=>qe.filter($e=>$e!==J.id))},className:"w-4 h-4 rounded border-border"}),i.jsx("div",{className:"w-20 h-20 bg-muted rounded-lg flex items-center justify-center flex-shrink-0",children:J.listingImage?i.jsx("img",{src:J.listingImage,alt:J.listingTitle,className:"w-full h-full object-cover rounded-lg"}):i.jsx(gi,{className:"w-8 h-8 text-muted-foreground"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("h3",{className:"font-semibold truncate",children:J.listingTitle}),i.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[i.jsx("span",{className:"font-semibold text-primary",children:Se(J.listingPrice,J.listingTransactionType)}),(ke==null?void 0:ke.status)&&i.jsx(Ir,{variant:ke.status==="active"?"default":"secondary",children:ke.status==="active"?"Disponible":ke.status==="sold"?"Vendu":"Réservé"})]})]}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Hl,{className:"w-3 h-3"}),J.sellerName]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(dl,{className:"w-3 h-3"}),J.sellerUniversity]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(oI,{className:"w-3 h-3"}),(Ze=B$.find(Xe=>Xe.value===J.listingCategory))==null?void 0:Ze.label]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"text-xs text-muted-foreground",children:["Ajouté ",ce(J.createdAt)]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(Ge,{variant:"outline",size:"sm",onClick:()=>window.open(`/listing/${J.listingId}`,"_blank"),children:[i.jsx(Ec,{className:"w-3 h-3 mr-1"}),"Voir"]}),i.jsx(Ge,{variant:"ghost",size:"sm",onClick:()=>re(J.id),className:"text-destructive hover:text-destructive",children:i.jsx(nd,{className:"w-3 h-3"})})]})]})]})]})})},J.id)})})]})})]}):i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(Tc,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connectez-vous pour voir vos favoris"}),i.jsx("p",{className:"text-muted-foreground",children:"Sauvegardez vos annonces préférées et retrouvez-les facilement"})]})})})},nM=({request:t,userRole:e,onStatusUpdate:r})=>{const{updatePaymentStatus:n,getPaymentInstructions:c}=dA(),d=V=>{switch(V){case"pending":return Fi;case"confirmed":return qs;case"completed":return qs;case"cancelled":return fo;case"disputed":return va;default:return Fi}},p=V=>{switch(V){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"confirmed":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-green-100 text-green-800 border-green-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"disputed":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},a=V=>{switch(V){case"pending":return"En attente";case"confirmed":return"Confirmé";case"completed":return"Terminé";case"cancelled":return"Annulé";case"disputed":return"Litige";default:return V}},w=V=>({cash:"Espèces",transfer:"Virement bancaire",paypal:"PayPal",lydia:"Lydia"})[V]||V,E=(V,W)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:W||"EUR"}).format(V),C=(V,W)=>{navigator.clipboard.writeText(V),Nt.success(`${W} copié dans le presse-papiers`)},P=async V=>{try{await n(t.id,V),r==null||r(V)}catch(W){console.error("Erreur lors de la mise à jour du statut:",W)}},R=d(t.status),B=c(t.paymentMethod,t);return i.jsxs(Tt,{className:"w-full",children:[i.jsx(Dr,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:i.jsx(Aa,{className:"w-6 h-6 text-primary"})}),i.jsxs("div",{children:[i.jsxs(kr,{className:"text-lg",children:["Paiement ",w(t.paymentMethod)]}),i.jsxs(Ls,{children:[E(t.amount,t.currency)," • ",e==="buyer"?"Achat":"Vente"]})]})]}),i.jsxs(Ir,{className:p(t.status),children:[i.jsx(R,{className:"w-3 h-3 mr-1"}),a(t.status)]})]})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Créé le :"}),i.jsx("p",{className:"font-medium",children:Pa(t.createdAt,"PPP à HH:mm",{locale:po})})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Dernière mise à jour :"}),i.jsx("p",{className:"font-medium",children:Pa(t.updatedAt,"PPP à HH:mm",{locale:po})})]})]}),t.paymentMethod==="cash"&&t.meetingLocation&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[i.jsx(dl,{className:"w-4 h-4"}),"Détails de la rencontre"]}),i.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg space-y-2",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground text-sm",children:"Lieu :"}),i.jsx("p",{className:"font-medium",children:t.meetingLocation})]}),t.meetingDateTime&&i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground text-sm",children:"Date et heure :"}),i.jsx("p",{className:"font-medium",children:Pa(t.meetingDateTime,"PPP à HH:mm",{locale:po})})]})]})]}),t.securityCode&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[i.jsx(Ms,{className:"w-4 h-4"}),"Code de sécurité"]}),i.jsxs("div",{className:"flex items-center gap-2 bg-muted/50 p-3 rounded-lg",children:[i.jsx("code",{className:"font-mono text-lg font-bold",children:t.securityCode}),i.jsx(Ge,{variant:"ghost",size:"icon",onClick:()=>C(t.securityCode,"Code de sécurité"),children:i.jsx(lZ,{className:"w-4 h-4"})})]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Partagez ce code uniquement avec votre interlocuteur lors de la finalisation du paiement."})]}),t.status==="confirmed"&&B.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("h4",{className:"font-medium",children:"Instructions de paiement"}),i.jsx("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg",children:i.jsx("ul",{className:"space-y-1 text-sm",children:B.map((V,W)=>i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),i.jsx("span",{children:V})]},W))})})]}),t.notes&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("h4",{className:"font-medium",children:"Notes"}),i.jsx("p",{className:"text-sm bg-muted/50 p-3 rounded-lg",children:t.notes})]}),i.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e==="seller"&&t.status==="pending"&&i.jsxs(i.Fragment,{children:[i.jsxs(Ge,{onClick:()=>P("confirmed"),className:"flex-1",children:[i.jsx(qs,{className:"w-4 h-4 mr-2"}),"Accepter"]}),i.jsxs(Ge,{variant:"outline",onClick:()=>P("cancelled"),className:"flex-1",children:[i.jsx(fo,{className:"w-4 h-4 mr-2"}),"Refuser"]})]}),e==="buyer"&&t.status==="confirmed"&&i.jsxs(Ge,{onClick:()=>P("completed"),className:"flex-1",children:[i.jsx(qs,{className:"w-4 h-4 mr-2"}),"Marquer comme payé"]}),e==="seller"&&t.status==="confirmed"&&i.jsxs(Ge,{onClick:()=>P("completed"),className:"flex-1",children:[i.jsx(qs,{className:"w-4 h-4 mr-2"}),"Confirmer la réception"]}),(t.status==="pending"||t.status==="confirmed")&&i.jsxs(Ge,{variant:"outline",onClick:()=>P("disputed"),className:"text-blue-600 hover:text-blue-700",children:[i.jsx(va,{className:"w-4 h-4 mr-2"}),"Signaler un problème"]})]}),t.status==="pending"&&e==="buyer"&&i.jsxs(Ys,{children:[i.jsx(Fi,{className:"h-4 w-4"}),i.jsx(Js,{children:"Votre demande de paiement a été envoyée au vendeur. Vous recevrez une notification dès qu'il l'aura acceptée."})]}),t.status==="confirmed"&&e==="buyer"&&i.jsxs(Ys,{className:"border-green-200 bg-green-50",children:[i.jsx(qs,{className:"h-4 w-4 text-green-600"}),i.jsx(Js,{className:"text-green-800",children:"Le vendeur a accepté votre demande ! Suivez les instructions ci-dessus pour effectuer le paiement."})]}),t.status==="completed"&&i.jsxs(Ys,{className:"border-green-200 bg-green-50",children:[i.jsx(qs,{className:"h-4 w-4 text-green-600"}),i.jsx(Js,{className:"text-green-800",children:"Transaction terminée avec succès ! Merci d'avoir utilisé StudyMarket."})]}),t.status==="disputed"&&i.jsxs(Ys,{className:"border-blue-200 bg-blue-50",children:[i.jsx(va,{className:"h-4 w-4 text-blue-600"}),i.jsx(Js,{className:"text-blue-800",children:"Un litige a été signalé. Notre équipe support va examiner la situation et vous contacter sous 24h."})]})]})]})},yRe=()=>{const{currentUser:t,userProfile:e}=$i(),{paymentRequests:r,loading:n,fetchUserPaymentRequests:c,initializePaymentMethods:d}=dA(),[p,a]=z.useState(""),[w,E]=z.useState("all"),[C,P]=z.useState("all"),[R,B]=z.useState({totalRequests:0,pendingRequests:0,completedRequests:0,totalAmount:0,averageAmount:0,byMethod:{},byStatus:{}});z.useEffect(()=>{d()},[d]),z.useEffect(()=>{t&&c(t.uid)},[t,c]),z.useEffect(()=>{V()},[r]);const V=()=>{const Q={},re={};let ve=0;r.forEach(pe=>{Q[pe.paymentMethod]=(Q[pe.paymentMethod]||0)+1,re[pe.status]=(re[pe.status]||0)+1,ve+=pe.amount}),B({totalRequests:r.length,pendingRequests:re.pending||0,completedRequests:re.completed||0,totalAmount:ve,averageAmount:r.length>0?ve/r.length:0,byMethod:Q,byStatus:re})},W=()=>r.filter(Q=>{const re=!p||Q.listingId.toLowerCase().includes(p.toLowerCase())||Q.id.toLowerCase().includes(p.toLowerCase()),ve=w==="all"||Q.status===w,pe=C==="all"||Q.paymentMethod===C;return re&&ve&&pe}),K=()=>W().filter(Q=>Q.buyerId===(t==null?void 0:t.uid)),Z=()=>W().filter(Q=>Q.sellerId===(t==null?void 0:t.uid)),$=Q=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(Q),X=()=>{const Q={user:e==null?void 0:e.displayName,exportDate:new Date().toISOString(),stats:R,payments:r.map(ue=>({id:ue.id,amount:ue.amount,currency:ue.currency,method:ue.paymentMethod,status:ue.status,role:ue.buyerId===(t==null?void 0:t.uid)?"buyer":"seller",createdAt:ue.createdAt.toISOString(),updatedAt:ue.updatedAt.toISOString()}))},re=new Blob([JSON.stringify(Q,null,2)],{type:"application/json"}),ve=URL.createObjectURL(re),pe=document.createElement("a");pe.href=ve,pe.download=`paiements-${new Date().toISOString().slice(0,10)}.json`,pe.click(),URL.revokeObjectURL(ve)};return t?i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(Kxe,{className:"w-8 h-8 text-primary"}),"Mes Paiements",R.totalRequests>0&&i.jsx(Ir,{variant:"secondary\\",className:"ml-1",children:R.totalRequests})]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Gérez vos demandes de paiement et suivez vos transactions"})]}),i.jsxs(Ge,{variant:"outline",onClick:X,className:"flex items-center gap-2",children:[i.jsx(to,{className:"w-4 h-4"}),"Exporter"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:R.totalRequests}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Demandes totales"})]}),i.jsx(Aa,{className:"w-8 h-8 text-blue-600"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:R.pendingRequests}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"En attente"})]}),i.jsx(Fi,{className:"w-8 h-8 text-blue-600"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:R.completedRequests}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Terminées"})]}),i.jsx(qs,{className:"w-8 h-8 text-green-600"})]})})}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold",children:$(R.totalAmount)}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Montant total"})]}),i.jsx(bp,{className:"w-8 h-8 text-purple-600"})]})})})]}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Oo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{placeholder:"Rechercher par ID de transaction...",value:p,onChange:Q=>a(Q.target.value),className:"pl-10"})]}),i.jsxs(ds,{value:w,onValueChange:E,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous les statuts"}),i.jsx(Bt,{value:"pending",children:"En attente"}),i.jsx(Bt,{value:"confirmed",children:"Confirmé"}),i.jsx(Bt,{value:"completed",children:"Terminé"}),i.jsx(Bt,{value:"cancelled",children:"Annulé"}),i.jsx(Bt,{value:"disputed",children:"Litige"})]})]}),i.jsxs(ds,{value:C,onValueChange:P,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Méthode"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Toutes les méthodes"}),i.jsx(Bt,{value:"cash",children:"Espèces"}),i.jsx(Bt,{value:"transfer",children:"Virement"}),i.jsx(Bt,{value:"paypal",children:"PayPal"}),i.jsx(Bt,{value:"lydia",children:"Lydia"})]})]})]})})}),i.jsxs(Og,{defaultValue:"all",className:"space-y-4",children:[i.jsxs(Pp,{className:"grid w-full grid-cols-3",children:[i.jsxs(Wi,{value:"all",className:"flex items-center gap-2",children:[i.jsx(Aa,{className:"w-4 h-4"}),"Toutes",R.totalRequests>0&&i.jsx(Ir,{variant:"secondary\\",className:"ml-1",children:R.totalRequests})]}),i.jsxs(Wi,{value:"purchases",className:"flex items-center gap-2",children:[i.jsx(SR,{className:"w-4 h-4"}),"Mes achats",K().length>0&&i.jsx(Ir,{variant:"secondary\\",className:"ml-1",children:K().length})]}),i.jsxs(Wi,{value:"sales",className:"flex items-center gap-2",children:[i.jsx(bR,{className:"w-4 h-4"}),"Mes ventes",Z().length>0&&i.jsx(Ir,{variant:"secondary\\",className:"ml-1",children:Z().length})]})]}),i.jsx(Zi,{value:"all",className:"space-y-4",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(V3,{className:"w-5 h-5"}),"Toutes les Demandes de Paiement"]}),i.jsx(Ls,{children:"Historique complet de vos transactions"})]}),i.jsx(jt,{children:n?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((Q,re)=>i.jsxs("div",{className:"border rounded-lg p-4 animate-pulse",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"h-5 bg-muted rounded w-1/3"}),i.jsx("div",{className:"h-6 bg-muted rounded w-16"})]}),i.jsx("div",{className:"h-4 bg-muted rounded w-2/3 mb-2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/4"})]},re))}):W().length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Aa,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune demande de paiement"}),i.jsx("p",{className:"text-muted-foreground",children:r.length===0?"Vous n'avez pas encore de demandes de paiement.":"Aucune demande ne correspond à vos critères de recherche."})]}):i.jsx("div",{className:"space-y-4",children:W().map(Q=>i.jsx(nM,{request:Q,userRole:Q.buyerId===t.uid?"buyer":"seller"},Q.id))})})]})}),i.jsx(Zi,{value:"purchases",className:"space-y-4",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(SR,{className:"w-5 h-5"}),"Mes Achats"]}),i.jsx(Ls,{children:"Demandes de paiement que vous avez initiées"})]}),i.jsx(jt,{children:K().length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(SR,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucun achat"}),i.jsx("p",{className:"text-muted-foreground",children:"Vous n'avez pas encore initié de demandes de paiement pour vos achats."})]}):i.jsx("div",{className:"space-y-4",children:K().map(Q=>i.jsx(nM,{request:Q,userRole:"buyer"},Q.id))})})]})}),i.jsx(Zi,{value:"sales",className:"space-y-4",children:i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(bR,{className:"w-5 h-5"}),"Mes Ventes"]}),i.jsx(Ls,{children:"Demandes de paiement reçues pour vos annonces"})]}),i.jsx(jt,{children:Z().length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(bR,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune vente"}),i.jsx("p",{className:"text-muted-foreground",children:"Vous n'avez pas encore reçu de demandes de paiement pour vos annonces."})]}):i.jsx("div",{className:"space-y-4",children:Z().map(Q=>i.jsx(nM,{request:Q,userRole:"seller"},Q.id))})})]})})]}),i.jsxs(Ys,{className:"border-blue-200 bg-blue-50",children:[i.jsx(Ms,{className:"h-4 w-4 text-blue-600"}),i.jsxs(Js,{className:"text-blue-800",children:[i.jsx("strong",{children:"Conseils de sécurité :"})," Ne communiquez jamais vos informations bancaires par message privé. Utilisez uniquement les canaux sécurisés de StudyMarket pour vos transactions."]})]})]}):i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(Aa,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connectez-vous pour voir vos paiements"}),i.jsx("p",{className:"text-muted-foreground",children:"Gérez vos demandes de paiement et suivez vos transactions"})]})})})};var Y4="Collapsible",[xRe,_ee]=hd(Y4),[vRe,J4]=xRe(Y4),yee=z.forwardRef((t,e)=>{const{__scopeCollapsible:r,open:n,defaultOpen:c,disabled:d,onOpenChange:p,...a}=t,[w=!1,E]=ud({prop:n,defaultProp:c,onChange:p});return i.jsx(vRe,{scope:r,disabled:d,contentId:ku(),open:w,onOpenToggle:z.useCallback(()=>E(C=>!C),[E]),children:i.jsx(Pn.div,{"data-state":eF(w),"data-disabled":d?"":void 0,...a,ref:e})})});yee.displayName=Y4;var xee="CollapsibleTrigger",vee=z.forwardRef((t,e)=>{const{__scopeCollapsible:r,...n}=t,c=J4(xee,r);return i.jsx(Pn.button,{type:"button","aria-controls":c.contentId,"aria-expanded":c.open||!1,"data-state":eF(c.open),"data-disabled":c.disabled?"":void 0,disabled:c.disabled,...n,ref:e,onClick:tn(t.onClick,c.onOpenToggle)})});vee.displayName=xee;var Q4="CollapsibleContent",wee=z.forwardRef((t,e)=>{const{forceMount:r,...n}=t,c=J4(Q4,t.__scopeCollapsible);return i.jsx(Xl,{present:r||c.open,children:({present:d})=>i.jsx(wRe,{...n,ref:e,present:d})})});wee.displayName=Q4;var wRe=z.forwardRef((t,e)=>{const{__scopeCollapsible:r,present:n,children:c,...d}=t,p=J4(Q4,r),[a,w]=z.useState(n),E=z.useRef(null),C=Fs(e,E),P=z.useRef(0),R=P.current,B=z.useRef(0),V=B.current,W=p.open||a,K=z.useRef(W),Z=z.useRef();return z.useEffect(()=>{const $=requestAnimationFrame(()=>K.current=!1);return()=>cancelAnimationFrame($)},[]),Jo(()=>{const $=E.current;if($){Z.current=Z.current||{transitionDuration:$.style.transitionDuration,animationName:$.style.animationName},$.style.transitionDuration="0s",$.style.animationName="none";const X=$.getBoundingClientRect();P.current=X.height,B.current=X.width,K.current||($.style.transitionDuration=Z.current.transitionDuration,$.style.animationName=Z.current.animationName),w(n)}},[p.open,n]),i.jsx(Pn.div,{"data-state":eF(p.open),"data-disabled":p.disabled?"":void 0,id:p.contentId,hidden:!W,...d,ref:C,style:{"--radix-collapsible-content-height":R?`${R}px`:void 0,"--radix-collapsible-content-width":V?`${V}px`:void 0,...t.style},children:W&&c})});function eF(t){return t?"open":"closed"}var bRe=yee,SRe=vee,ERe=wee,kp="Accordion",TRe=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[tF,jRe,NRe]=FE(kp),[yA,jLe]=hd(kp,[NRe,_ee]),rF=_ee(),bee=_n.forwardRef((t,e)=>{const{type:r,...n}=t,c=n,d=n;return i.jsx(tF.Provider,{scope:t.__scopeAccordion,children:r==="multiple"?i.jsx(PRe,{...d,ref:e}):i.jsx(ARe,{...c,ref:e})})});bee.displayName=kp;var[See,IRe]=yA(kp),[Eee,CRe]=yA(kp,{collapsible:!1}),ARe=_n.forwardRef((t,e)=>{const{value:r,defaultValue:n,onValueChange:c=()=>{},collapsible:d=!1,...p}=t,[a,w]=ud({prop:r,defaultProp:n,onChange:c});return i.jsx(See,{scope:t.__scopeAccordion,value:a?[a]:[],onItemOpen:w,onItemClose:_n.useCallback(()=>d&&w(""),[d,w]),children:i.jsx(Eee,{scope:t.__scopeAccordion,collapsible:d,children:i.jsx(Tee,{...p,ref:e})})})}),PRe=_n.forwardRef((t,e)=>{const{value:r,defaultValue:n,onValueChange:c=()=>{},...d}=t,[p=[],a]=ud({prop:r,defaultProp:n,onChange:c}),w=_n.useCallback(C=>a((P=[])=>[...P,C]),[a]),E=_n.useCallback(C=>a((P=[])=>P.filter(R=>R!==C)),[a]);return i.jsx(See,{scope:t.__scopeAccordion,value:p,onItemOpen:w,onItemClose:E,children:i.jsx(Eee,{scope:t.__scopeAccordion,collapsible:!0,children:i.jsx(Tee,{...d,ref:e})})})}),[kRe,xA]=yA(kp),Tee=_n.forwardRef((t,e)=>{const{__scopeAccordion:r,disabled:n,dir:c,orientation:d="vertical",...p}=t,a=_n.useRef(null),w=Fs(a,e),E=jRe(r),P=Fy(c)==="ltr",R=tn(t.onKeyDown,B=>{var ue;if(!TRe.includes(B.key))return;const V=B.target,W=E().filter(ge=>{var ce;return!((ce=ge.ref.current)!=null&&ce.disabled)}),K=W.findIndex(ge=>ge.ref.current===V),Z=W.length;if(K===-1)return;B.preventDefault();let $=K;const X=0,Q=Z-1,re=()=>{$=K+1,$>Q&&($=X)},ve=()=>{$=K-1,$<X&&($=Q)};switch(B.key){case"Home":$=X;break;case"End":$=Q;break;case"ArrowRight":d==="horizontal"&&(P?re():ve());break;case"ArrowDown":d==="vertical"&&re();break;case"ArrowLeft":d==="horizontal"&&(P?ve():re());break;case"ArrowUp":d==="vertical"&&ve();break}const pe=$%Z;(ue=W[pe].ref.current)==null||ue.focus()});return i.jsx(kRe,{scope:r,disabled:n,direction:c,orientation:d,children:i.jsx(tF.Slot,{scope:r,children:i.jsx(Pn.div,{...p,"data-orientation":d,ref:w,onKeyDown:n?void 0:R})})})}),FI="AccordionItem",[RRe,nF]=yA(FI),jee=_n.forwardRef((t,e)=>{const{__scopeAccordion:r,value:n,...c}=t,d=xA(FI,r),p=IRe(FI,r),a=rF(r),w=ku(),E=n&&p.value.includes(n)||!1,C=d.disabled||t.disabled;return i.jsx(RRe,{scope:r,open:E,disabled:C,triggerId:w,children:i.jsx(bRe,{"data-orientation":d.orientation,"data-state":kee(E),...a,...c,ref:e,disabled:C,open:E,onOpenChange:P=>{P?p.onItemOpen(n):p.onItemClose(n)}})})});jee.displayName=FI;var Nee="AccordionHeader",Iee=_n.forwardRef((t,e)=>{const{__scopeAccordion:r,...n}=t,c=xA(kp,r),d=nF(Nee,r);return i.jsx(Pn.h3,{"data-orientation":c.orientation,"data-state":kee(d.open),"data-disabled":d.disabled?"":void 0,...n,ref:e})});Iee.displayName=Nee;var gO="AccordionTrigger",Cee=_n.forwardRef((t,e)=>{const{__scopeAccordion:r,...n}=t,c=xA(kp,r),d=nF(gO,r),p=CRe(gO,r),a=rF(r);return i.jsx(tF.ItemSlot,{scope:r,children:i.jsx(SRe,{"aria-disabled":d.open&&!p.collapsible||void 0,"data-orientation":c.orientation,id:d.triggerId,...a,...n,ref:e})})});Cee.displayName=gO;var Aee="AccordionContent",Pee=_n.forwardRef((t,e)=>{const{__scopeAccordion:r,...n}=t,c=xA(kp,r),d=nF(Aee,r),p=rF(r);return i.jsx(ERe,{role:"region","aria-labelledby":d.triggerId,"data-orientation":c.orientation,...p,...n,ref:e,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Pee.displayName=Aee;function kee(t){return t?"open":"closed"}var MRe=bee,DRe=jee,ORe=Iee,Ree=Cee,Mee=Pee;const LRe=MRe,Dee=z.forwardRef(({className:t,...e},r)=>i.jsx(DRe,{ref:r,className:kn("border-b",t),...e}));Dee.displayName="AccordionItem";const Oee=z.forwardRef(({className:t,children:e,...r},n)=>i.jsx(ORe,{className:"flex",children:i.jsxs(Ree,{ref:n,className:kn("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...r,children:[e,i.jsx(rX,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Oee.displayName=Ree.displayName;const Lee=z.forwardRef(({className:t,children:e,...r},n)=>i.jsx(Mee,{ref:n,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:i.jsx("div",{className:kn("pb-4 pt-0",t),children:e})}));Lee.displayName=Mee.displayName;const V$=[{category:"Compte et Inscription",icon:Sp,questions:[{question:"Comment créer un compte étudiant vérifié ?",answer:'Pour créer votre compte, utilisez votre adresse email universitaire (ex: prenom.nom@univ-exemple.fr). Notre système vérifie automatiquement votre statut étudiant. Vous recevrez un badge "Étudiant certifié" une fois la vérification terminée.'},{question:"Pourquoi mon université n'est pas reconnue ?",answer:"Nous ajoutons régulièrement de nouvelles universités. Si la vôtre n'apparaît pas, contactez-nous avec votre carte étudiante et nous l'ajouterons rapidement à notre base de données."},{question:"Comment modifier mes informations de profil ?",answer:'Rendez-vous dans "Mon profil" depuis le menu utilisateur. Vous pouvez modifier votre photo, bio, université, et préférences de notification. Certaines informations nécessitent une re-vérification.'},{question:"Puis-je avoir plusieurs comptes ?",answer:"Non, un seul compte par personne est autorisé. Cela garantit la confiance et la sécurité de notre communauté étudiante."}]},{category:"Achats et Ventes",icon:Aa,questions:[{question:"Comment publier une annonce ?",answer:'Cliquez sur "Publier" dans le menu principal. Remplissez le formulaire avec photos, description détaillée, prix et lieu de rencontre. Votre annonce sera visible immédiatement après publication.'},{question:"Quels modes de paiement sont acceptés ?",answer:"Nous recommandons les paiements sécurisés : espèces lors de la remise en main propre, virements bancaires, Lydia, ou PayPal. Évitez les paiements à distance sans garantie."},{question:"Comment fixer le bon prix ?",answer:"Notre IA vous suggère une fourchette de prix basée sur l'état et la catégorie. Consultez les annonces similaires et considérez l'état réel de votre objet. Les prix justes se vendent plus rapidement."},{question:"Que faire si un acheteur ne se présente pas ?",answer:"Contactez-le via notre messagerie. Si pas de réponse sous 24h, vous pouvez signaler le comportement et remettre votre annonce en ligne. Nous prenons ces situations au sérieux."}]},{category:"Sécurité et Confiance",icon:Ms,questions:[{question:"Comment éviter les arnaques ?",answer:"Rencontrez-vous toujours en personne dans un lieu public (campus, bibliothèque). Vérifiez l'identité avec la carte étudiante. Ne payez jamais à l'avance sans avoir vu l'objet. Utilisez notre système de signalement en cas de doute."},{question:"Où se rencontrer en sécurité ?",answer:`Privilégiez les lieux publics de votre campus : bibliothèques, halls d'entrée, cafétérias. Évitez les parkings isolés ou les domiciles privés. Certaines universités ont des "zones d'échange sécurisées".`},{question:"Comment signaler un utilisateur suspect ?",answer:'Utilisez le bouton "Signaler" sur le profil ou dans la conversation. Décrivez précisément le problème. Notre équipe examine tous les signalements sous 24h et prend les mesures appropriées.'},{question:"Que faire en cas de litige ?",answer:"Contactez d'abord l'autre partie via notre messagerie. Si pas de résolution, utilisez notre service de médiation gratuit. En dernier recours, contactez le support avec toutes les preuves (captures, messages)."}]},{category:"Messagerie et Communication",icon:xa,questions:[{question:"Comment contacter un vendeur ?",answer:`Cliquez sur "Contacter le vendeur" sur l'annonce. Rédigez un message poli et précis. Le vendeur recevra une notification email et pourra vous répondre via notre messagerie sécurisée.`},{question:"Pourquoi mes messages ne sont pas lus ?",answer:"Les utilisateurs reçoivent des notifications email mais peuvent avoir des délais de réponse. Soyez patient (24-48h). Si pas de réponse, l'annonce est peut-être déjà vendue ou l'utilisateur inactif."},{question:"Puis-je partager mes coordonnées ?",answer:"Oui, mais seulement après les premiers échanges via notre messagerie. Cela nous permet de garder une trace en cas de problème et de vous protéger contre le spam."},{question:"Comment bloquer un utilisateur ?",answer:`Dans la conversation, cliquez sur les trois points puis "Bloquer". L'utilisateur ne pourra plus vous contacter. Vous pouvez débloquer depuis vos paramètres si nécessaire.`}]},{category:"Impact Écologique",icon:Tc,questions:[{question:"Comment est calculé mon impact CO₂ ?",answer:"Chaque objet acheté d'occasion évite la production d'un neuf. Nous calculons le CO₂ économisé selon des données ADEME : 85kg pour un smartphone, 8.5kg pour un livre, etc. Votre total s'affiche dans votre profil."},{question:"Qu'est-ce que les badges écologiques ?",answer:'Vous gagnez des badges selon vos actions : "Premier Pas" (1ère transaction), "Éco-Warrior" (10kg CO₂), "Héros Climatique" (100kg CO₂). Ils apparaissent sur votre profil et motivent la communauté.'},{question:"Comment améliorer mon rang écologique ?",answer:"Multipliez les transactions d'occasion, privilégiez les dons (bonus +20%), participez aux échanges. Plus vous économisez de CO₂, plus votre rang augmente : Débutant → Éco-Warrior → Maître Environnemental → Légende Écologique."}]},{category:"Technique et Bugs",icon:qC,questions:[{question:"L'application ne fonctionne pas correctement",answer:"Essayez de vider le cache de votre navigateur (Ctrl+F5) ou utilisez un autre navigateur. Vérifiez votre connexion internet. Si le problème persiste, contactez-nous avec votre navigateur et système d'exploitation."},{question:"Je ne reçois pas les notifications email",answer:'Vérifiez vos spams/courriers indésirables. Ajoutez notifications@studymarket.fr à vos contacts. Vérifiez vos préférences de notification dans "Paramètres". Certains emails universitaires bloquent les notifications externes.'},{question:"Mes photos ne s'uploadent pas",answer:"Vérifiez que vos images font moins de 15MB et sont au format JPG/PNG. Essayez de les redimensionner. Si vous êtes sur mobile, autorisez l'accès à la galerie dans les paramètres de votre navigateur."},{question:"Comment supprimer mon compte ?",answer:'Rendez-vous dans "Paramètres" > "Compte" > "Supprimer mon compte". Cette action est irréversible et supprime toutes vos données. Vos annonces actives seront automatiquement retirées.'}]}],FRe=[{title:"Chat en direct",description:"Réponse immédiate pendant les heures ouvrables",icon:xa,action:"Démarrer le chat",available:!0,hours:"Lun-Ven 9h-18h"},{title:"Email Support",description:"Réponse sous 24h maximum",icon:Nl,action:"support@studymarket.fr",available:!0,hours:"24h/7j"},{title:"Téléphone",description:"Pour les urgences uniquement",icon:lw,action:"01 23 45 67 89",available:!1,hours:"Bientôt disponible"},{title:"Centre de ressources",description:"Guides détaillés et tutoriels",icon:iZ,action:"Consulter les guides",available:!0,hours:"Toujours accessible"}],zRe=[{title:"Guide du vendeur débutant",description:"Tout savoir pour vendre efficacement",icon:Km,duration:"5 min",type:"Article"},{title:"Sécurité : éviter les arnaques",description:"Reconnaître et éviter les situations dangereuses",icon:Ms,duration:"3 min",type:"Vidéo"},{title:"Optimiser ses annonces",description:"Photos, descriptions et prix pour vendre vite",icon:cw,duration:"7 min",type:"Article"},{title:"Impact écologique expliqué",description:"Comment nous calculons votre empreinte carbone",icon:Tc,duration:"4 min",type:"Infographie"}],BRe=()=>{const{currentUser:t,userProfile:e}=$i(),[r,n]=z.useState(""),[c,d]=z.useState("all"),[p,a]=z.useState({subject:"",category:"",message:"",priority:"normal"}),[w,E]=z.useState(!1),C=V$.filter(R=>{if(c!=="all"&&R.category!==c)return!1;if(r){const B=r.toLowerCase();return R.questions.some(V=>V.question.toLowerCase().includes(B)||V.answer.toLowerCase().includes(B))}return!0}),P=async R=>{if(R.preventDefault(),!p.subject||!p.message){Nt.error("Veuillez remplir tous les champs obligatoires");return}E(!0);try{await new Promise(B=>setTimeout(B,1e3)),Nt.success("Votre message a été envoyé ! Nous vous répondrons sous 24h."),a({subject:"",category:"",message:"",priority:"normal"})}catch{Nt.error("Erreur lors de l'envoi. Veuillez réessayer.")}finally{E(!1)}};return i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx("div",{className:"flex items-center justify-center gap-2 mb-4",children:i.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center",children:i.jsx(sI,{className:"w-6 h-6 text-white"})})}),i.jsx("h1",{className:"text-4xl font-bold",children:"Centre d'Aide StudyMarket"}),i.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Trouvez rapidement les réponses à vos questions ou contactez notre équipe support"})]}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[i.jsx(Oo,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-muted-foreground"}),i.jsx(Gr,{type:"text",placeholder:"Rechercher dans l'aide... (ex: comment vendre, sécurité, notifications)",value:r,onChange:R=>n(R.target.value),className:"pl-12 h-14 text-lg"})]})})}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:FRe.map((R,B)=>i.jsx(Tt,{className:`transition-all hover:shadow-lg ${R.available?"hover:-translate-y-1":"opacity-60"}`,children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 ${R.available?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"}`,children:i.jsx(R.icon,{className:"w-6 h-6"})}),i.jsx("h3",{className:"font-semibold mb-2",children:R.title}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:R.description}),i.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:R.hours}),i.jsx(Ge,{variant:R.available?"default":"secondary",size:"sm",disabled:!R.available,className:"w-full",children:R.action})]})},B))}),i.jsxs(Og,{defaultValue:"faq",className:"space-y-6",children:[i.jsxs(Pp,{className:"grid w-full grid-cols-3",children:[i.jsxs(Wi,{value:"faq",className:"flex items-center gap-2",children:[i.jsx(sI,{className:"w-4 h-4"}),"FAQ"]}),i.jsxs(Wi,{value:"guides",className:"flex items-center gap-2",children:[i.jsx(iZ,{className:"w-4 h-4"}),"Guides"]}),i.jsxs(Wi,{value:"contact",className:"flex items-center gap-2",children:[i.jsx(xa,{className:"w-4 h-4"}),"Contact"]})]}),i.jsxs(Zi,{value:"faq",className:"space-y-6",children:[i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx(Ge,{variant:c==="all"?"default":"outline",size:"sm",onClick:()=>d("all"),children:"Toutes les catégories"}),V$.map(R=>i.jsxs(Ge,{variant:c===R.category?"default":"outline",size:"sm",onClick:()=>d(R.category),className:"flex items-center gap-2",children:[i.jsx(R.icon,{className:"w-4 h-4"}),R.category]},R.category))]})})}),C.length===0?i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-12 pb-12 text-center",children:[i.jsx(Oo,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Aucun résultat trouvé"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Essayez avec d'autres mots-clés ou contactez notre support"}),i.jsx(Ge,{variant:"outline",onClick:()=>n(""),children:"Effacer la recherche"})]})}):i.jsx("div",{className:"space-y-6",children:C.map((R,B)=>i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(R.icon,{className:"w-5 h-5"}),R.category]})}),i.jsx(jt,{children:i.jsx(LRe,{type:"single",collapsible:!0,className:"w-full",children:R.questions.map((V,W)=>i.jsxs(Dee,{value:`${B}-${W}`,children:[i.jsx(Oee,{className:"text-left",children:V.question}),i.jsx(Lee,{className:"text-muted-foreground leading-relaxed",children:V.answer})]},W))})})]},B))})]}),i.jsxs(Zi,{value:"guides",className:"space-y-6",children:[i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(hZ,{className:"w-5 h-5"}),"Guides et Tutoriels"]}),i.jsx(Ls,{children:"Apprenez à utiliser StudyMarket comme un pro avec nos guides détaillés"})]}),i.jsx(jt,{children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:zRe.map((R,B)=>i.jsx("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(R.icon,{className:"w-6 h-6 text-primary"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("h3",{className:"font-semibold",children:R.title}),i.jsx(Ir,{variant:"outline",className:"text-xs",children:R.type})]}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:R.description}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[i.jsx(Fi,{className:"w-3 h-3"}),R.duration]}),i.jsxs(Ge,{size:"sm",variant:"outline",children:[i.jsx(Ec,{className:"w-3 h-3 mr-1"}),"Lire"]})]})]})]})},B))})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(yZ,{className:"w-8 h-8 text-blue-600 mx-auto mb-3"}),i.jsx("h3",{className:"font-semibold mb-2",children:"Tutoriels Vidéo"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Apprenez visuellement avec nos vidéos courtes"}),i.jsxs(Ge,{variant:"outline",size:"sm",children:[i.jsx(Ec,{className:"w-3 h-3 mr-1"}),"Voir les vidéos"]})]})}),i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(to,{className:"w-8 h-8 text-green-600 mx-auto mb-3"}),i.jsx("h3",{className:"font-semibold mb-2",children:"Ressources PDF"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Téléchargez nos guides au format PDF"}),i.jsxs(Ge,{variant:"outline",size:"sm",children:[i.jsx(to,{className:"w-3 h-3 mr-1"}),"Télécharger"]})]})}),i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(Sp,{className:"w-8 h-8 text-purple-600 mx-auto mb-3"}),i.jsx("h3",{className:"font-semibold mb-2",children:"Communauté"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Échangez avec d'autres étudiants"}),i.jsxs(Ge,{variant:"outline",size:"sm",children:[i.jsx(Ec,{className:"w-3 h-3 mr-1"}),"Rejoindre"]})]})})]})]}),i.jsx(Zi,{value:"contact",className:"space-y-6",children:i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(vy,{className:"w-5 h-5"}),"Contactez notre équipe"]}),i.jsx(Ls,{children:"Décrivez votre problème en détail pour une réponse rapide et précise"})]}),i.jsx(jt,{children:i.jsxs("form",{onSubmit:P,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"subject",children:"Sujet *"}),i.jsx(Gr,{id:"subject",value:p.subject,onChange:R=>a(B=>({...B,subject:R.target.value})),placeholder:"Résumez votre problème en quelques mots",className:"mt-1"})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"category",children:"Catégorie"}),i.jsxs(ds,{value:p.category,onValueChange:R=>a(B=>({...B,category:R})),children:[i.jsx(is,{className:"mt-1",children:i.jsx(hs,{placeholder:"Sélectionnez une catégorie"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"account",children:"Compte et profil"}),i.jsx(Bt,{value:"listing",children:"Annonces"}),i.jsx(Bt,{value:"payment",children:"Paiements"}),i.jsx(Bt,{value:"security",children:"Sécurité"}),i.jsx(Bt,{value:"technical",children:"Problème technique"}),i.jsx(Bt,{value:"other",children:"Autre"})]})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"priority",children:"Priorité"}),i.jsxs(ds,{value:p.priority,onValueChange:R=>a(B=>({...B,priority:R})),children:[i.jsx(is,{className:"mt-1",children:i.jsx(hs,{})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"low",children:"Basse - Question générale"}),i.jsx(Bt,{value:"normal",children:"Normale - Besoin d'aide"}),i.jsx(Bt,{value:"high",children:"Haute - Problème bloquant"}),i.jsx(Bt,{value:"urgent",children:"Urgente - Sécurité/Arnaque"})]})]})]}),i.jsxs("div",{children:[i.jsx(Zr,{htmlFor:"message",children:"Message *"}),i.jsx(id,{id:"message",value:p.message,onChange:R=>a(B=>({...B,message:R.target.value})),placeholder:"Décrivez votre problème en détail. Plus vous donnez d'informations, plus nous pourrons vous aider efficacement.",rows:6,className:"mt-1"})]}),t&&i.jsxs(Ys,{children:[i.jsx(qs,{className:"h-4 w-4"}),i.jsxs(Js,{children:["Nous vous répondrons à l'adresse ",i.jsx("strong",{children:t.email})]})]}),i.jsx(Ge,{type:"submit",className:"w-full",disabled:w||!p.subject||!p.message,children:w?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Envoi en cours..."]}):i.jsxs(i.Fragment,{children:[i.jsx(vy,{className:"w-4 h-4 mr-2"}),"Envoyer le message"]})})]})})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Fi,{className:"w-5 h-5"}),"Temps de réponse"]})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm",children:"Questions générales"}),i.jsx(Ir,{variant:"secondary",children:"24h"})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm",children:"Problèmes techniques"}),i.jsx(Ir,{variant:"secondary",children:"12h"})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm",children:"Urgences sécurité"}),i.jsx(Ir,{className:"bg-red-500",children:"2h"})]})]})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(cZ,{className:"w-5 h-5"}),"Autres moyens de contact"]})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Nl,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:"Email direct"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"support@studymarket.fr"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(xa,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:"Chat en direct"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Lun-Ven 9h-18h"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Ag,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:"Application mobile"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Bientôt disponible"})]})]})]})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(cw,{className:"w-5 h-5"}),"État du système"]})}),i.jsxs(jt,{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm",children:"Plateforme web"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),i.jsx("span",{className:"text-sm text-green-600",children:"Opérationnel"})]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm",children:"Messagerie"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),i.jsx("span",{className:"text-sm text-green-600",children:"Opérationnel"})]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm",children:"Notifications email"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),i.jsx("span",{className:"text-sm text-yellow-600",children:"Maintenance"})]})]}),i.jsxs(Ge,{variant:"outline",size:"sm",className:"w-full mt-3",children:[i.jsx(Ec,{className:"w-3 h-3 mr-1"}),"Page de statut complète"]})]})]})]})]})})]})]})},VRe=[{category:"Rencontres et Échanges",icon:dl,color:"text-blue-600",tips:[{title:"Choisissez des lieux publics",description:"Rencontrez-vous toujours dans des endroits fréquentés : bibliothèques universitaires, halls d'entrée, cafétérias du campus.",type:"do",icon:qs},{title:"Évitez les lieux isolés",description:"Ne vous donnez jamais rendez-vous dans des parkings souterrains, domiciles privés ou endroits déserts.",type:"dont",icon:fo},{title:"Prévenez un proche",description:"Informez toujours quelqu'un de votre rendez-vous : lieu, heure, personne rencontrée.",type:"do",icon:qs},{title:"Rencontrez en journée",description:"Privilégiez les rendez-vous en journée, évitez les rencontres tardives ou nocturnes.",type:"do",icon:qs}]},{category:"Vérification d'Identité",icon:_Z,color:"text-green-600",tips:[{title:"Demandez la carte étudiante",description:"Vérifiez toujours l'identité avec la carte étudiante. C'est votre garantie de sécurité.",type:"do",icon:qs},{title:"Vérifiez le profil StudyMarket",description:"Consultez le profil : badge vérifié, avis, nombre de transactions, ancienneté du compte.",type:"do",icon:qs},{title:"Méfiez-vous des profils récents",description:"Soyez prudent avec les comptes créés récemment sans historique de transactions.",type:"dont",icon:va},{title:"Utilisez la messagerie StudyMarket",description:"Gardez une trace de vos échanges via notre messagerie sécurisée.",type:"do",icon:qs}]},{category:"Paiements Sécurisés",icon:Aa,color:"text-purple-600",tips:[{title:"Payez à la remise",description:"Ne payez qu'après avoir inspecté l'objet et lors de la remise en main propre.",type:"do",icon:qs},{title:"Évitez les paiements à l'avance",description:"Ne versez jamais d'acompte ou de paiement intégral avant d'avoir vu l'objet.",type:"dont",icon:fo},{title:"Utilisez des moyens traçables",description:"Privilégiez Lydia, PayPal, virements ou espèces. Évitez les cryptomonnaies.",type:"do",icon:qs},{title:"Méfiez-vous des prix trop bas",description:"Un iPhone à 50€ ou un MacBook à 200€ sont probablement des arnaques.",type:"dont",icon:va}]},{category:"Communication",icon:xa,color:"text-blue-600",tips:[{title:"Restez poli et respectueux",description:"Maintenez un ton courtois dans tous vos échanges, même en cas de désaccord.",type:"do",icon:qs},{title:"Posez des questions précises",description:"Demandez des détails sur l'état, l'âge, la raison de la vente, les défauts éventuels.",type:"do",icon:qs},{title:"Méfiez-vous de l'urgence",description:'Les vendeurs qui pressent ("achetez maintenant", "dernière chance") sont suspects.',type:"dont",icon:va},{title:"Gardez les preuves",description:"Conservez les captures d'écran des conversations en cas de litige.",type:"do",icon:qs}]}],URe=[{title:"Prix anormalement bas",description:"Un objet vendu bien en-dessous de sa valeur marchande",severity:"high",icon:va},{title:"Paiement demandé à l'avance",description:"Demande d'acompte ou paiement avant la rencontre",severity:"high",icon:Aa},{title:"Refus de se rencontrer",description:"Propose uniquement l'envoi postal ou la livraison",severity:"high",icon:dl},{title:"Photos de mauvaise qualité",description:"Images floues, prises sur internet ou très peu nombreuses",severity:"medium",icon:H_},{title:"Profil incomplet",description:"Pas de photo de profil, peu d'informations, compte récent",severity:"medium",icon:Sp},{title:"Communication étrange",description:"Français approximatif, réponses évasives, pression temporelle",severity:"medium",icon:xa},{title:"Changement de lieu",description:"Modifie le lieu de rendez-vous au dernier moment",severity:"medium",icon:Fi},{title:"Demande d'informations personnelles",description:"Veut votre adresse, RIB, ou autres données sensibles",severity:"high",icon:xy}],$Re=[{title:"Urgence immédiate",description:"Danger physique, menaces, agression",contact:"17 (Police)",icon:lw,color:"text-red-600"},{title:"Signalement StudyMarket",description:"Comportement suspect, arnaque, violation des règles",contact:`Bouton "Signaler" dans l'app`,icon:V_,color:"text-blue-600"},{title:"Support StudyMarket",description:"Questions, aide, médiation de conflit",contact:"support@studymarket.fr",icon:xa,color:"text-blue-600"},{title:"Sécurité Campus",description:"Incidents sur le campus universitaire",contact:"Service sécurité de votre université",icon:Ms,color:"text-green-600"}],qRe=()=>i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx("div",{className:"flex items-center justify-center gap-2 mb-4",children:i.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:i.jsx(Ms,{className:"w-6 h-6 text-white"})})}),i.jsx("h1",{className:"text-4xl font-bold",children:"Sécurité & Conseils"}),i.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"Votre sécurité est notre priorité. Suivez ces conseils pour des échanges sereins et sécurisés entre étudiants."})]}),i.jsxs(Ys,{className:"border-green-200 bg-green-50",children:[i.jsx(Ms,{className:"h-4 w-4 text-green-600"}),i.jsx(Js,{className:"text-green-800",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Rappel important :"})," Rencontrez-vous toujours dans un lieu public du campus et vérifiez l'identité avec la carte étudiante."]}),i.jsxs(Ge,{variant:"outline",size:"sm",className:"ml-4 border-green-300 text-green-700 hover:bg-green-100",children:[i.jsx(to,{className:"w-3 h-3 mr-1"}),"Guide PDF"]})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:i.jsx(Ms,{className:"w-6 h-6 text-green-600"})}),i.jsx("div",{className:"text-2xl font-bold text-green-600",children:"99.8%"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Transactions sécurisées"})]})}),i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:i.jsx(_Z,{className:"w-6 h-6 text-blue-600"})}),i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"100%"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Étudiants vérifiés"})]})}),i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3",children:i.jsx(Fi,{className:"w-6 h-6 text-purple-600"})}),i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"< 2h"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Réponse aux signalements"})]})}),i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:i.jsx(Km,{className:"w-6 h-6 text-blue-600"})}),i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"4.9/5"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Satisfaction sécurité"})]})})]}),i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Guide de Sécurité Complet"}),i.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Suivez ces conseils essentiels pour des échanges en toute sécurité"})]}),VRe.map((t,e)=>i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(t.icon,{className:`w-6 h-6 ${t.color}`}),t.category]})}),i.jsx(jt,{children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.tips.map((r,n)=>i.jsx("div",{className:`p-4 rounded-lg border-2 ${r.type==="do"?"border-green-200 bg-green-50":r.type==="dont"?"border-red-200 bg-red-50":"border-blue-200 bg-blue-50"}`,children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(r.icon,{className:`w-5 h-5 mt-0.5 ${r.type==="do"?"text-green-600":r.type==="dont"?"text-red-600":"text-blue-600"}`}),i.jsxs("div",{children:[i.jsx("h4",{className:`font-semibold mb-2 ${r.type==="do"?"text-green-800":r.type==="dont"?"text-red-800":"text-blue-800"}`,children:r.title}),i.jsx("p",{className:`text-sm ${r.type==="do"?"text-green-700":r.type==="dont"?"text-red-700":"text-blue-700"}`,children:r.description})]})]})},n))})})]},e))]}),i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(va,{className:"w-6 h-6 text-red-600"}),"Signaux d'Alarme à Reconnaître"]}),i.jsx(Ls,{children:"Ces comportements doivent vous alerter et vous inciter à la prudence"})]}),i.jsx(jt,{children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:URe.map((t,e)=>i.jsx("div",{className:`p-4 rounded-lg border-2 ${t.severity==="high"?"border-red-200 bg-red-50":"border-blue-200 bg-blue-50"}`,children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(t.icon,{className:`w-5 h-5 mt-0.5 ${t.severity==="high"?"text-red-600":"text-blue-600"}`}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("h4",{className:`font-semibold ${t.severity==="high"?"text-red-800":"text-blue-800"}`,children:t.title}),i.jsx(Ir,{variant:t.severity==="high"?"destructive":"secondary",className:"text-xs",children:t.severity==="high"?"Danger":"Attention"})]}),i.jsx("p",{className:`text-sm ${t.severity==="high"?"text-red-700":"text-blue-700"}`,children:t.description})]})]})},e))})})]}),i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(lw,{className:"w-6 h-6 text-blue-600"}),"Contacts d'Urgence et Signalement"]}),i.jsx(Ls,{children:"En cas de problème, voici qui contacter selon la situation"})]}),i.jsx(jt,{children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:$Re.map((t,e)=>i.jsxs("div",{className:"flex items-start gap-4 p-4 border rounded-lg",children:[i.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${t.color==="text-red-600"?"bg-red-100":t.color==="text-blue-600"||t.color==="text-blue-600"?"bg-blue-100":"bg-green-100"}`,children:i.jsx(t.icon,{className:`w-6 h-6 ${t.color}`})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-semibold mb-1",children:t.title}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.description}),i.jsx("div",{className:`font-medium ${t.color}`,children:t.contact})]})]},e))})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(U3,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),i.jsx("h3",{className:"font-semibold mb-2",children:"Guide Complet PDF"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Téléchargez notre guide de sécurité complet"}),i.jsxs(Ge,{variant:"outline",className:"w-full",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Télécharger"]})]})}),i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(sI,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),i.jsx("h3",{className:"font-semibold mb-2",children:"Centre d'Aide"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Questions fréquentes sur la sécurité"}),i.jsx(Ge,{variant:"outline",className:"w-full",asChild:!0,children:i.jsxs(Nr,{to:"/help",children:[i.jsx(Ec,{className:"w-4 h-4 mr-2"}),"Consulter l'aide"]})})]})}),i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6 text-center",children:[i.jsx(xa,{className:"w-12 h-12 text-purple-600 mx-auto mb-4"}),i.jsx("h3",{className:"font-semibold mb-2",children:"Signaler un Problème"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Contactez notre équipe de sécurité"}),i.jsxs(Ge,{variant:"outline",className:"w-full",children:[i.jsx(V_,{className:"w-4 h-4 mr-2"}),"Faire un signalement"]})]})})]}),i.jsxs(Ys,{className:"border-blue-200 bg-blue-50",children:[i.jsx(hZ,{className:"h-4 w-4 text-blue-600"}),i.jsxs(Js,{className:"text-blue-800",children:[i.jsx("strong",{children:"Rappel :"})," En cas de doute, n'hésitez pas à annuler la transaction. Votre sécurité vaut plus que n'importe quel objet. L'équipe StudyMarket est là pour vous aider 24h/7j."]})]})]});function GRe(t,e){return z.useReducer((r,n)=>e[r][n]??r,t)}var sF="ScrollArea",[Fee,NLe]=hd(sF),[HRe,fd]=Fee(sF),zee=z.forwardRef((t,e)=>{const{__scopeScrollArea:r,type:n="hover",dir:c,scrollHideDelay:d=600,...p}=t,[a,w]=z.useState(null),[E,C]=z.useState(null),[P,R]=z.useState(null),[B,V]=z.useState(null),[W,K]=z.useState(null),[Z,$]=z.useState(0),[X,Q]=z.useState(0),[re,ve]=z.useState(!1),[pe,ue]=z.useState(!1),ge=Fs(e,Se=>w(Se)),ce=Fy(c);return i.jsx(HRe,{scope:r,type:n,dir:ce,scrollHideDelay:d,scrollArea:a,viewport:E,onViewportChange:C,content:P,onContentChange:R,scrollbarX:B,onScrollbarXChange:V,scrollbarXEnabled:re,onScrollbarXEnabledChange:ve,scrollbarY:W,onScrollbarYChange:K,scrollbarYEnabled:pe,onScrollbarYEnabledChange:ue,onCornerWidthChange:$,onCornerHeightChange:Q,children:i.jsx(Pn.div,{dir:ce,...p,ref:ge,style:{position:"relative","--radix-scroll-area-corner-width":Z+"px","--radix-scroll-area-corner-height":X+"px",...t.style}})})});zee.displayName=sF;var Bee="ScrollAreaViewport",Vee=z.forwardRef((t,e)=>{const{__scopeScrollArea:r,children:n,asChild:c,nonce:d,...p}=t,a=fd(Bee,r),w=z.useRef(null),E=Fs(e,w,a.onViewportChange);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:d}),i.jsx(Pn.div,{"data-radix-scroll-area-viewport":"",...p,asChild:c,ref:E,style:{overflowX:a.scrollbarXEnabled?"scroll":"hidden",overflowY:a.scrollbarYEnabled?"scroll":"hidden",...t.style},children:rMe({asChild:c,children:n},C=>i.jsx("div",{"data-radix-scroll-area-content":"",ref:a.onContentChange,style:{minWidth:a.scrollbarXEnabled?"fit-content":void 0},children:C}))})]})});Vee.displayName=Bee;var gf="ScrollAreaScrollbar",iF=z.forwardRef((t,e)=>{const{forceMount:r,...n}=t,c=fd(gf,t.__scopeScrollArea),{onScrollbarXEnabledChange:d,onScrollbarYEnabledChange:p}=c,a=t.orientation==="horizontal";return z.useEffect(()=>(a?d(!0):p(!0),()=>{a?d(!1):p(!1)}),[a,d,p]),c.type==="hover"?i.jsx(WRe,{...n,ref:e,forceMount:r}):c.type==="scroll"?i.jsx(ZRe,{...n,ref:e,forceMount:r}):c.type==="auto"?i.jsx(Uee,{...n,ref:e,forceMount:r}):c.type==="always"?i.jsx(aF,{...n,ref:e}):null});iF.displayName=gf;var WRe=z.forwardRef((t,e)=>{const{forceMount:r,...n}=t,c=fd(gf,t.__scopeScrollArea),[d,p]=z.useState(!1);return z.useEffect(()=>{const a=c.scrollArea;let w=0;if(a){const E=()=>{window.clearTimeout(w),p(!0)},C=()=>{w=window.setTimeout(()=>p(!1),c.scrollHideDelay)};return a.addEventListener("pointerenter",E),a.addEventListener("pointerleave",C),()=>{window.clearTimeout(w),a.removeEventListener("pointerenter",E),a.removeEventListener("pointerleave",C)}}},[c.scrollArea,c.scrollHideDelay]),i.jsx(Xl,{present:r||d,children:i.jsx(Uee,{"data-state":d?"visible":"hidden",...n,ref:e})})}),ZRe=z.forwardRef((t,e)=>{const{forceMount:r,...n}=t,c=fd(gf,t.__scopeScrollArea),d=t.orientation==="horizontal",p=wA(()=>w("SCROLL_END"),100),[a,w]=GRe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return z.useEffect(()=>{if(a==="idle"){const E=window.setTimeout(()=>w("HIDE"),c.scrollHideDelay);return()=>window.clearTimeout(E)}},[a,c.scrollHideDelay,w]),z.useEffect(()=>{const E=c.viewport,C=d?"scrollLeft":"scrollTop";if(E){let P=E[C];const R=()=>{const B=E[C];P!==B&&(w("SCROLL"),p()),P=B};return E.addEventListener("scroll",R),()=>E.removeEventListener("scroll",R)}},[c.viewport,d,w,p]),i.jsx(Xl,{present:r||a!=="hidden",children:i.jsx(aF,{"data-state":a==="hidden"?"hidden":"visible",...n,ref:e,onPointerEnter:tn(t.onPointerEnter,()=>w("POINTER_ENTER")),onPointerLeave:tn(t.onPointerLeave,()=>w("POINTER_LEAVE"))})})}),Uee=z.forwardRef((t,e)=>{const r=fd(gf,t.__scopeScrollArea),{forceMount:n,...c}=t,[d,p]=z.useState(!1),a=t.orientation==="horizontal",w=wA(()=>{if(r.viewport){const E=r.viewport.offsetWidth<r.viewport.scrollWidth,C=r.viewport.offsetHeight<r.viewport.scrollHeight;p(a?E:C)}},10);return G0(r.viewport,w),G0(r.content,w),i.jsx(Xl,{present:n||d,children:i.jsx(aF,{"data-state":d?"visible":"hidden",...c,ref:e})})}),aF=z.forwardRef((t,e)=>{const{orientation:r="vertical",...n}=t,c=fd(gf,t.__scopeScrollArea),d=z.useRef(null),p=z.useRef(0),[a,w]=z.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),E=Wee(a.viewport,a.content),C={...n,sizes:a,onSizesChange:w,hasThumb:E>0&&E<1,onThumbChange:R=>d.current=R,onThumbPointerUp:()=>p.current=0,onThumbPointerDown:R=>p.current=R};function P(R,B){return eMe(R,p.current,a,B)}return r==="horizontal"?i.jsx(KRe,{...C,ref:e,onThumbPositionChange:()=>{if(c.viewport&&d.current){const R=c.viewport.scrollLeft,B=U$(R,a,c.dir);d.current.style.transform=`translate3d(${B}px, 0, 0)`}},onWheelScroll:R=>{c.viewport&&(c.viewport.scrollLeft=R)},onDragScroll:R=>{c.viewport&&(c.viewport.scrollLeft=P(R,c.dir))}}):r==="vertical"?i.jsx(XRe,{...C,ref:e,onThumbPositionChange:()=>{if(c.viewport&&d.current){const R=c.viewport.scrollTop,B=U$(R,a);d.current.style.transform=`translate3d(0, ${B}px, 0)`}},onWheelScroll:R=>{c.viewport&&(c.viewport.scrollTop=R)},onDragScroll:R=>{c.viewport&&(c.viewport.scrollTop=P(R))}}):null}),KRe=z.forwardRef((t,e)=>{const{sizes:r,onSizesChange:n,...c}=t,d=fd(gf,t.__scopeScrollArea),[p,a]=z.useState(),w=z.useRef(null),E=Fs(e,w,d.onScrollbarXChange);return z.useEffect(()=>{w.current&&a(getComputedStyle(w.current))},[w]),i.jsx(qee,{"data-orientation":"horizontal",...c,ref:E,sizes:r,style:{bottom:0,left:d.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:d.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":vA(r)+"px",...t.style},onThumbPointerDown:C=>t.onThumbPointerDown(C.x),onDragScroll:C=>t.onDragScroll(C.x),onWheelScroll:(C,P)=>{if(d.viewport){const R=d.viewport.scrollLeft+C.deltaX;t.onWheelScroll(R),Kee(R,P)&&C.preventDefault()}},onResize:()=>{w.current&&d.viewport&&p&&n({content:d.viewport.scrollWidth,viewport:d.viewport.offsetWidth,scrollbar:{size:w.current.clientWidth,paddingStart:BI(p.paddingLeft),paddingEnd:BI(p.paddingRight)}})}})}),XRe=z.forwardRef((t,e)=>{const{sizes:r,onSizesChange:n,...c}=t,d=fd(gf,t.__scopeScrollArea),[p,a]=z.useState(),w=z.useRef(null),E=Fs(e,w,d.onScrollbarYChange);return z.useEffect(()=>{w.current&&a(getComputedStyle(w.current))},[w]),i.jsx(qee,{"data-orientation":"vertical",...c,ref:E,sizes:r,style:{top:0,right:d.dir==="ltr"?0:void 0,left:d.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":vA(r)+"px",...t.style},onThumbPointerDown:C=>t.onThumbPointerDown(C.y),onDragScroll:C=>t.onDragScroll(C.y),onWheelScroll:(C,P)=>{if(d.viewport){const R=d.viewport.scrollTop+C.deltaY;t.onWheelScroll(R),Kee(R,P)&&C.preventDefault()}},onResize:()=>{w.current&&d.viewport&&p&&n({content:d.viewport.scrollHeight,viewport:d.viewport.offsetHeight,scrollbar:{size:w.current.clientHeight,paddingStart:BI(p.paddingTop),paddingEnd:BI(p.paddingBottom)}})}})}),[YRe,$ee]=Fee(gf),qee=z.forwardRef((t,e)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:c,onThumbChange:d,onThumbPointerUp:p,onThumbPointerDown:a,onThumbPositionChange:w,onDragScroll:E,onWheelScroll:C,onResize:P,...R}=t,B=fd(gf,r),[V,W]=z.useState(null),K=Fs(e,ge=>W(ge)),Z=z.useRef(null),$=z.useRef(""),X=B.viewport,Q=n.content-n.viewport,re=Do(C),ve=Do(w),pe=wA(P,10);function ue(ge){if(Z.current){const ce=ge.clientX-Z.current.left,Se=ge.clientY-Z.current.top;E({x:ce,y:Se})}}return z.useEffect(()=>{const ge=ce=>{const Se=ce.target;(V==null?void 0:V.contains(Se))&&re(ce,Q)};return document.addEventListener("wheel",ge,{passive:!1}),()=>document.removeEventListener("wheel",ge,{passive:!1})},[X,V,Q,re]),z.useEffect(ve,[n,ve]),G0(V,pe),G0(B.content,pe),i.jsx(YRe,{scope:r,scrollbar:V,hasThumb:c,onThumbChange:Do(d),onThumbPointerUp:Do(p),onThumbPositionChange:ve,onThumbPointerDown:Do(a),children:i.jsx(Pn.div,{...R,ref:K,style:{position:"absolute",...R.style},onPointerDown:tn(t.onPointerDown,ge=>{ge.button===0&&(ge.target.setPointerCapture(ge.pointerId),Z.current=V.getBoundingClientRect(),$.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",B.viewport&&(B.viewport.style.scrollBehavior="auto"),ue(ge))}),onPointerMove:tn(t.onPointerMove,ue),onPointerUp:tn(t.onPointerUp,ge=>{const ce=ge.target;ce.hasPointerCapture(ge.pointerId)&&ce.releasePointerCapture(ge.pointerId),document.body.style.webkitUserSelect=$.current,B.viewport&&(B.viewport.style.scrollBehavior=""),Z.current=null})})})}),zI="ScrollAreaThumb",Gee=z.forwardRef((t,e)=>{const{forceMount:r,...n}=t,c=$ee(zI,t.__scopeScrollArea);return i.jsx(Xl,{present:r||c.hasThumb,children:i.jsx(JRe,{ref:e,...n})})}),JRe=z.forwardRef((t,e)=>{const{__scopeScrollArea:r,style:n,...c}=t,d=fd(zI,r),p=$ee(zI,r),{onThumbPositionChange:a}=p,w=Fs(e,P=>p.onThumbChange(P)),E=z.useRef(),C=wA(()=>{E.current&&(E.current(),E.current=void 0)},100);return z.useEffect(()=>{const P=d.viewport;if(P){const R=()=>{if(C(),!E.current){const B=tMe(P,a);E.current=B,a()}};return a(),P.addEventListener("scroll",R),()=>P.removeEventListener("scroll",R)}},[d.viewport,C,a]),i.jsx(Pn.div,{"data-state":p.hasThumb?"visible":"hidden",...c,ref:w,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:tn(t.onPointerDownCapture,P=>{const B=P.target.getBoundingClientRect(),V=P.clientX-B.left,W=P.clientY-B.top;p.onThumbPointerDown({x:V,y:W})}),onPointerUp:tn(t.onPointerUp,p.onThumbPointerUp)})});Gee.displayName=zI;var oF="ScrollAreaCorner",Hee=z.forwardRef((t,e)=>{const r=fd(oF,t.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?i.jsx(QRe,{...t,ref:e}):null});Hee.displayName=oF;var QRe=z.forwardRef((t,e)=>{const{__scopeScrollArea:r,...n}=t,c=fd(oF,r),[d,p]=z.useState(0),[a,w]=z.useState(0),E=!!(d&&a);return G0(c.scrollbarX,()=>{var P;const C=((P=c.scrollbarX)==null?void 0:P.offsetHeight)||0;c.onCornerHeightChange(C),w(C)}),G0(c.scrollbarY,()=>{var P;const C=((P=c.scrollbarY)==null?void 0:P.offsetWidth)||0;c.onCornerWidthChange(C),p(C)}),E?i.jsx(Pn.div,{...n,ref:e,style:{width:d,height:a,position:"absolute",right:c.dir==="ltr"?0:void 0,left:c.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function BI(t){return t?parseInt(t,10):0}function Wee(t,e){const r=t/e;return isNaN(r)?0:r}function vA(t){const e=Wee(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,n=(t.scrollbar.size-r)*e;return Math.max(n,18)}function eMe(t,e,r,n="ltr"){const c=vA(r),d=c/2,p=e||d,a=c-p,w=r.scrollbar.paddingStart+p,E=r.scrollbar.size-r.scrollbar.paddingEnd-a,C=r.content-r.viewport,P=n==="ltr"?[0,C]:[C*-1,0];return Zee([w,E],P)(t)}function U$(t,e,r="ltr"){const n=vA(e),c=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,d=e.scrollbar.size-c,p=e.content-e.viewport,a=d-n,w=r==="ltr"?[0,p]:[p*-1,0],E=YS(t,w);return Zee([0,p],[0,a])(E)}function Zee(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(t[1]-t[0]);return e[0]+n*(r-t[0])}}function Kee(t,e){return t>0&&t<e}var tMe=(t,e=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},n=0;return function c(){const d={left:t.scrollLeft,top:t.scrollTop},p=r.left!==d.left,a=r.top!==d.top;(p||a)&&e(),r=d,n=window.requestAnimationFrame(c)}(),()=>window.cancelAnimationFrame(n)};function wA(t,e){const r=Do(t),n=z.useRef(0);return z.useEffect(()=>()=>window.clearTimeout(n.current),[]),z.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,e)},[r,e])}function G0(t,e){const r=Do(e);Jo(()=>{let n=0;if(t){const c=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return c.observe(t),()=>{window.cancelAnimationFrame(n),c.unobserve(t)}}},[t,r])}function rMe(t,e){const{asChild:r,children:n}=t;if(!r)return typeof e=="function"?e(n):e;const c=z.Children.only(n);return z.cloneElement(c,{children:typeof e=="function"?e(c.props.children):e})}var Xee=zee,nMe=Vee,sMe=Hee;const lF=z.forwardRef(({className:t,children:e,...r},n)=>i.jsxs(Xee,{ref:n,className:kn("relative overflow-hidden",t),...r,children:[i.jsx(nMe,{className:"h-full w-full rounded-[inherit]",children:e}),i.jsx(Yee,{}),i.jsx(sMe,{})]}));lF.displayName=Xee.displayName;const Yee=z.forwardRef(({className:t,orientation:e="vertical",...r},n)=>i.jsx(iF,{ref:n,orientation:e,className:kn("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:i.jsx(Gee,{className:"relative flex-1 rounded-full bg-border"})}));Yee.displayName=iF.displayName;const $$=({conversations:t,loading:e,searchQuery:r,setSearchQuery:n,currentConversation:c,currentUser:d,onSelectConversation:p})=>{const a=t.filter(C=>{const P=C.participants.find(B=>B!==(d==null?void 0:d.uid)),R=P?C.participantDetails[P]:null;return(R==null?void 0:R.name.toLowerCase().includes(r.toLowerCase()))||C.listingTitle.toLowerCase().includes(r.toLowerCase())}),w=C=>C===0?"Gratuit":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(C),E=C=>{const P=C.participants.find(R=>R!==(d==null?void 0:d.uid));return P?C.participantDetails[P]:null};return i.jsxs("div",{className:"w-full lg:w-72 xl:w-80 border-r border-border bg-muted/20 flex flex-col h-full",children:[i.jsxs("div",{className:"p-3 border-b border-border bg-background/95 backdrop-blur",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(xa,{className:"w-5 h-5 text-primary"}),i.jsx("h1",{className:"text-lg font-semibold",children:"Messages"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ge,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Filtrer",children:i.jsx($C,{className:"w-4 h-4"})}),i.jsx(Ge,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Trier",children:i.jsx(rZ,{className:"w-4 h-4"})}),i.jsx(Ge,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Paramètres",children:i.jsx(qC,{className:"w-4 h-4"})})]})]}),i.jsxs("div",{className:"relative",children:[i.jsx(Oo,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{placeholder:"Rechercher conversations...",value:r,onChange:C=>n(C.target.value),className:"pl-9 h-9 text-sm"})]})]}),i.jsx(lF,{className:"flex-1",children:e?i.jsx("div",{className:"p-2 space-y-2",children:Array.from({length:5}).map((C,P)=>i.jsx("div",{className:"animate-pulse",children:i.jsxs("div",{className:"flex items-center gap-2 p-2",children:[i.jsx("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center",children:i.jsx(Hl,{className:"w-5 h-5 text-muted-foreground"})}),i.jsxs("div",{className:"flex-1 space-y-1",children:[i.jsx("div",{className:"h-3 bg-muted rounded w-3/4"}),i.jsx("div",{className:"h-2 bg-muted rounded w-1/2"})]})]})},P))}):a.length===0?i.jsxs("div",{className:"p-6 text-center",children:[i.jsx(xa,{className:"w-10 h-10 text-muted-foreground mx-auto mb-3"}),i.jsx("h3",{className:"font-medium mb-1 text-sm",children:"Aucune conversation"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:r?i.jsxs(i.Fragment,{children:[i.jsx(Oo,{className:"w-3 h-3 inline mr-1"}),'Aucun résultat pour "',r,'"']}):i.jsxs(i.Fragment,{children:[i.jsx(Nl,{className:"w-3 h-3 inline mr-1"}),"Vos conversations apparaîtront ici"]})})]}):i.jsx("div",{className:"p-1",children:a.map(C=>{var V,W;const P=E(C),R=C.unreadCount[d==null?void 0:d.uid]||0,B=(c==null?void 0:c.id)===C.id;return i.jsx("div",{onClick:()=>p(C),className:`p-2 rounded-md cursor-pointer transition-colors hover:bg-accent/50 ${B?"bg-accent":""}`,children:i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsxs("div",{className:"relative",children:[i.jsxs(Jc,{className:"w-10 h-10",children:[i.jsx(cf,{src:P==null?void 0:P.avatar}),i.jsx(Sc,{className:"text-xs bg-gradient-to-br from-primary to-secondary text-white",children:((W=(V=P==null?void 0:P.name)==null?void 0:V[0])==null?void 0:W.toUpperCase())||i.jsx(Hl,{className:"w-4 h-4"})})]}),(P==null?void 0:P.verified)&&i.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full flex items-center justify-center",children:i.jsx(Ms,{className:"w-1.5 h-1.5 text-white"})})]}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[i.jsxs("h3",{className:"font-medium text-xs truncate flex items-center gap-1",children:[i.jsx(Hl,{className:"w-3 h-3 text-muted-foreground"}),(P==null?void 0:P.name)||"Utilisateur"]}),i.jsxs("div",{className:"flex items-center gap-1",children:[C.lastMessage&&i.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[i.jsx(Fi,{className:"w-3 h-3"}),_w(C.lastMessage.sentAt,{addSuffix:!0,locale:po})]}),R>0&&i.jsx(Ir,{className:"bg-red-500 text-white text-xs min-w-[16px] h-4 flex items-center justify-center px-1",children:R>99?"99+":R})]})]}),i.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[C.listingImage?i.jsx("img",{src:C.listingImage,alt:"",className:"w-3 h-3 rounded object-cover"}):i.jsx(dZ,{className:"w-3 h-3 text-muted-foreground"}),i.jsx("span",{className:"text-xs text-muted-foreground truncate flex-1",children:C.listingTitle}),i.jsxs("span",{className:"text-xs font-medium text-primary flex items-center gap-1",children:[C.listingPrice===0?i.jsx(Tc,{className:"w-3 h-3 text-green-600"}):i.jsx("span",{children:"€"}),w(C.listingPrice)]})]}),C.lastMessage&&i.jsxs("p",{className:"text-xs text-muted-foreground truncate flex items-center gap-1",children:[C.lastMessage.senderId===(d==null?void 0:d.uid)?i.jsx(vy,{className:"w-3 h-3"}):i.jsx(xa,{className:"w-3 h-3"}),C.lastMessage.senderId===(d==null?void 0:d.uid)&&"Vous: ",C.lastMessage.text]})]})]})},C.id)})})})]})},q$=({conversation:t,messages:e,loading:r,currentUser:n,onBack:c})=>{var it,Mt;const{sendMessage:d,markMessagesAsSeen:p,blockUser:a,reportUser:w,deleteConversation:E}=iA(),[C,P]=z.useState(""),[R,B]=z.useState(40),[V,W]=z.useState(!1),[K,Z]=z.useState(!1),[$,X]=z.useState(""),[Q,re]=z.useState(""),ve=z.useRef(null),pe=z.useRef(null),ue=()=>{var ar;(ar=pe.current)==null||ar.scrollIntoView({behavior:"smooth"})},ge=z.useCallback(()=>{const ar=ve.current;if(!ar)return;ar.style.height="auto";const St=Math.max(40,Math.min(ar.scrollHeight,120));B(St)},[]),ce=z.useCallback(ar=>{const St=ar.target.value;P(St),W(!!St.trim()),setTimeout(ge,0)},[ge]),Se=async()=>{if(!C.trim()||!t||!n)return;const ar=C.trim();P(""),W(!1),B(40),await d(t.id,ar,n.uid,n.displayName||"Utilisateur",n.photoURL)},le=ar=>{ar.key==="Enter"&&!ar.shiftKey&&(ar.preventDefault(),Se())},J=async()=>{!t||!n||await a(t.id,n.uid)},ke=async()=>{if(!t||!n||!$.trim())return;const ar=t.participants.find(St=>St!==n.uid);ar&&(await w(t.id,n.uid,ar,$,Q),Z(!1),X(""),re(""))},Ze=async()=>{!t||!n||(await E(t.id,n.uid),c())};if(z.useEffect(()=>{t&&n&&p(t.id,n.uid)},[t,n,p]),z.useEffect(ue,[e]),!t)return i.jsx("div",{className:"flex-1 flex items-center justify-center bg-background",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(xa,{className:"w-8 h-8 text-white"})}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Sélectionnez une conversation"}),i.jsxs("p",{className:"text-muted-foreground flex items-center justify-center gap-2",children:[i.jsx(Oo,{className:"w-4 h-4"}),"Choisissez une conversation pour commencer à discuter"]})]})});const Xe=t.participants.find(ar=>ar!==(n==null?void 0:n.uid)),qe=Xe?t.participantDetails[Xe]:null,$e=ar=>{const St=new Date,Xt=new Date(ar);return Xt.toDateString()===St.toDateString()?Xt.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):Math.floor((St.getTime()-Xt.getTime())/(1e3*60*60*24))<7?Xt.toLocaleDateString("fr-FR",{weekday:"short",hour:"2-digit",minute:"2-digit"}):Xt.toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})},st=ar=>ar.senderId!==(n==null?void 0:n.uid)?null:ar.seen?i.jsx(Ixe,{className:"w-3 h-3 text-blue-500"}):i.jsx(oZ,{className:"w-3 h-3 text-muted-foreground"});return i.jsxs("div",{className:"flex-1 flex flex-col bg-background h-full",children:[i.jsxs("div",{className:"p-3 border-b border-border bg-background/95 backdrop-blur shrink-0",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[i.jsx(Ge,{variant:"ghost",size:"icon",onClick:c,className:"lg:hidden h-8 w-8",children:i.jsx(vp,{className:"w-4 h-4"})}),i.jsxs(Jc,{className:"w-8 h-8",children:[i.jsx(cf,{src:qe==null?void 0:qe.avatar}),i.jsx(Sc,{className:"text-xs bg-gradient-to-br from-primary to-secondary text-white",children:((Mt=(it=qe==null?void 0:qe.name)==null?void 0:it[0])==null?void 0:Mt.toUpperCase())||i.jsx(Hl,{className:"w-4 h-4"})})]}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("h2",{className:"font-semibold truncate text-sm flex items-center gap-1",children:[i.jsx(Hl,{className:"w-3 h-3 text-muted-foreground"}),(qe==null?void 0:qe.name)||"Utilisateur"]}),(qe==null?void 0:qe.verified)&&i.jsx(Ms,{className:"w-3 h-3 text-green-600"})]}),i.jsxs("p",{className:"text-xs text-muted-foreground truncate flex items-center gap-1",children:[i.jsx(dl,{className:"w-3 h-3"}),qe==null?void 0:qe.university]})]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ge,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Appeler",children:i.jsx(lw,{className:"w-4 h-4"})}),i.jsx(Ge,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Vidéo",children:i.jsx(yZ,{className:"w-4 h-4"})}),i.jsxs(XD,{children:[i.jsx(YD,{asChild:!0,children:i.jsx(Ge,{variant:"ghost",size:"icon",className:"h-8 w-8",children:i.jsx(Axe,{className:"w-4 h-4"})})}),i.jsxs(pI,{align:"end",children:[i.jsx(Oi,{asChild:!0,children:i.jsxs(Nr,{to:`/listing/${t.listingId}`,className:"flex items-center",children:[i.jsx(Ec,{className:"w-4 h-4 mr-2"}),"Voir l'annonce"]})}),i.jsxs(Oi,{children:[i.jsx(Km,{className:"w-4 h-4 mr-2"}),"Marquer comme favori"]}),i.jsxs(Oi,{children:[i.jsx(wxe,{className:"w-4 h-4 mr-2"}),"Archiver"]}),i.jsx(Eu,{}),i.jsxs(Oi,{onClick:()=>Z(!0),children:[i.jsx(V_,{className:"w-4 h-4 mr-2"}),"Signaler"]}),i.jsxs(Oi,{onClick:J,children:[i.jsx(Txe,{className:"w-4 h-4 mr-2"}),"Bloquer"]}),i.jsxs(Oi,{onClick:Ze,className:"text-destructive",children:[i.jsx(nd,{className:"w-4 h-4 mr-2"}),"Supprimer"]})]})]})]})]}),i.jsx(Tt,{className:"mt-2",children:i.jsx(jt,{className:"p-2",children:i.jsxs("div",{className:"flex items-center gap-2",children:[t.listingImage?i.jsx("img",{src:t.listingImage,alt:"",className:"w-8 h-8 rounded object-cover"}):i.jsx("div",{className:"w-8 h-8 bg-muted rounded flex items-center justify-center",children:i.jsx(dZ,{className:"w-4 h-4 text-muted-foreground"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("h3",{className:"font-medium text-xs truncate flex items-center gap-1",children:[i.jsx(B3,{className:"w-3 h-3 text-muted-foreground"}),t.listingTitle]}),i.jsx("p",{className:"text-sm font-semibold text-primary flex items-center gap-1",children:t.listingPrice===0?i.jsxs(i.Fragment,{children:[i.jsx(Tc,{className:"w-3 h-3 text-green-600"}),"Gratuit"]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"text-xs",children:"€"}),new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t.listingPrice)]})})]}),i.jsx(Ge,{variant:"outline",size:"sm",asChild:!0,className:"h-7 text-xs px-2",children:i.jsxs(Nr,{to:`/listing/${t.listingId}`,className:"flex items-center gap-1",children:[i.jsx(Ec,{className:"w-3 h-3"}),"Voir"]})})]})})})]}),i.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[i.jsx(lF,{className:"flex-1 p-3",children:i.jsxs("div",{className:"space-y-3",children:[r?i.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((ar,St)=>i.jsx("div",{className:"animate-pulse",children:i.jsx("div",{className:`flex ${St%2===0?"justify-start":"justify-end"}`,children:i.jsxs("div",{className:"max-w-xs",children:[i.jsx("div",{className:"h-3 bg-muted rounded w-3/4 mb-1"}),i.jsx("div",{className:"h-8 bg-muted rounded"})]})})},St))}):e.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(xa,{className:"w-6 h-6 text-white"})}),i.jsx("h3",{className:"font-medium mb-2",children:"Aucun message"}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center justify-center gap-2",children:[i.jsx(vy,{className:"w-4 h-4"}),"Commencez la conversation en envoyant un message"]})]}):e.map(ar=>{const St=ar.senderId===(n==null?void 0:n.uid);return i.jsx("div",{className:`flex ${St?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`max-w-[75%] lg:max-w-[60%] ${St?"order-2":"order-1"}`,children:[i.jsx("div",{className:`rounded-2xl px-4 py-2 ${St?"bg-primary text-primary-foreground rounded-br-md":"bg-muted text-foreground rounded-bl-md"}`,children:i.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:ar.text})}),i.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs text-muted-foreground ${St?"justify-end":"justify-start"}`,children:[i.jsx(Fi,{className:"w-3 h-3"}),i.jsx("span",{children:$e(ar.sentAt)}),st(ar)]})]})},ar.id)}),i.jsx("div",{ref:pe})]})}),i.jsxs("div",{className:"p-3 border-t border-border bg-background/95 backdrop-blur shrink-0",children:[i.jsxs("div",{className:"flex items-end gap-2 bg-muted/30 rounded-2xl border relative",children:[i.jsx(id,{ref:ve,value:C,placeholder:"Tapez votre message...",onChange:ce,onKeyDown:le,rows:1,style:{height:R,transition:"height 0.15s ease-out",overflow:"hidden"},className:"min-h-[40px] max-h-[120px] resize-none border-0 bg-transparent focus:ring-0 focus:outline-none placeholder:text-muted-foreground/60 text-sm leading-relaxed py-2.5 px-4 pr-12 rounded-2xl"}),i.jsx(Ge,{onClick:Se,disabled:!C.trim(),size:"sm",className:"absolute right-1.5 bottom-1.5 h-7 w-7 p-0 rounded-full bg-gradient-to-r from-primary to-secondary",children:i.jsx(vy,{className:"h-3.5 w-3.5"})})]}),V&&i.jsxs("div",{className:"text-xs text-muted-foreground mt-1 px-2 flex items-center gap-1",children:[i.jsx(xa,{className:"w-3 h-3 animate-pulse"}),"En cours de frappe..."]})]})]}),i.jsx(ta,{open:K,onOpenChange:Z,children:i.jsxs(Ki,{children:[i.jsx(oa,{children:i.jsxs(ra,{className:"flex items-center gap-2",children:[i.jsx(V_,{className:"w-5 h-5 text-red-500"}),"Signaler cet utilisateur"]})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsxs(Zr,{htmlFor:"report-reason",className:"flex items-center gap-2",children:[i.jsx(va,{className:"w-4 h-4"}),"Motif du signalement"]}),i.jsxs(ds,{value:$,onValueChange:X,children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Sélectionnez un motif"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"spam",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Nl,{className:"w-4 h-4"}),"Spam"]})}),i.jsx(Bt,{value:"harassment",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(va,{className:"w-4 h-4"}),"Harcèlement"]})}),i.jsx(Bt,{value:"inappropriate",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(V_,{className:"w-4 h-4"}),"Contenu inapproprié"]})}),i.jsx(Bt,{value:"scam",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(va,{className:"w-4 h-4"}),"Arnaque"]})}),i.jsx(Bt,{value:"other",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(yy,{className:"w-4 h-4"}),"Autre"]})})]})]})]}),i.jsxs("div",{children:[i.jsxs(Zr,{htmlFor:"report-description",className:"flex items-center gap-2",children:[i.jsx(xa,{className:"w-4 h-4"}),"Description (optionnel)"]}),i.jsx(id,{id:"report-description",value:Q,onChange:ar=>re(ar.target.value),placeholder:"Décrivez le problème...",rows:3})]}),i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx(Ge,{variant:"outline",onClick:()=>Z(!1),children:"Annuler"}),i.jsxs(Ge,{onClick:ke,disabled:!$,className:"bg-red-500 hover:bg-red-600",children:[i.jsx(V_,{className:"w-4 h-4 mr-2"}),"Signaler"]})]})]})]})})]})},iMe=()=>{const{currentUser:t,userProfile:e}=$i(),{conversations:r,currentConversation:n,messages:c,loading:d,fetchConversations:p,fetchMessages:a,setCurrentConversation:w,cleanup:E}=iA(),[C,P]=z.useState(""),[R,B]=z.useState(!1);z.useEffect(()=>(t&&p(t.uid),()=>{E()}),[t,p,E]),z.useEffect(()=>{n&&a(n.id)},[n,a]);const V=K=>{w(K),B(!0)},W=()=>{B(!1),w(null)};return t?i.jsxs("div",{className:"h-[calc(100vh-64px)] flex overflow-hidden",children:[i.jsx("div",{className:"lg:hidden w-full h-full",children:R?i.jsx(q$,{conversation:n,messages:c,loading:d,currentUser:t,onBack:W}):i.jsx($$,{conversations:r,loading:d,searchQuery:C,setSearchQuery:P,currentConversation:n,setCurrentConversation:w,currentUser:t,onSelectConversation:V})}),i.jsxs("div",{className:"hidden lg:flex w-full h-full",children:[i.jsx($$,{conversations:r,loading:d,searchQuery:C,setSearchQuery:P,currentConversation:n,setCurrentConversation:w,currentUser:t,onSelectConversation:V}),i.jsx(q$,{conversation:n,messages:c,loading:d,currentUser:t,onBack:W})]})]}):i.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(xa,{className:"w-8 h-8 text-white"})}),i.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Connectez-vous pour accéder à vos messages"}),i.jsxs("p",{className:"text-muted-foreground mb-6 flex items-center justify-center gap-2",children:[i.jsx(Hl,{className:"w-4 h-4"}),"Vous devez être connecté pour voir et envoyer des messages."]}),i.jsx(Ge,{asChild:!0,className:"bg-gradient-to-r from-primary to-secondary",children:i.jsxs(Nr,{to:"/auth",className:"flex items-center gap-2",children:[i.jsx(Hl,{className:"w-4 h-4"}),"Se connecter"]})})]})},aMe=On.object({email:On.string().email("Email invalide"),password:On.string().min(6,"Le mot de passe doit contenir au moins 6 caractères")}),oMe=On.object({firstName:On.string().min(2,"Le prénom doit contenir au moins 2 caractères"),lastName:On.string().min(2,"Le nom doit contenir au moins 2 caractères"),displayName:On.string().optional(),email:On.string().email("Email invalide").refine(t=>[".edu","univ-",".ac.","student.","etudiant.","etu.","gmail.com","sorbonne-universite.fr","sorbonne-nouvelle.fr","dauphine.psl.eu","polytechnique.edu","ens.fr","centralesupelec.fr","mines-paristech.fr"].some(r=>t.toLowerCase().includes(r)),"Vous devez utiliser une adresse email universitaire"),university:On.string().min(1,"Veuillez sélectionner votre université"),otherUniversity:On.string().optional(),fieldOfStudy:On.string().min(1,"Veuillez indiquer votre filière"),otherFieldOfStudy:On.string().optional(),graduationYear:On.string().min(1,"Veuillez indiquer votre année de diplôme"),password:On.string().min(6,"Le mot de passe doit contenir au moins 6 caractères"),confirmPassword:On.string()}).refine(t=>t.password===t.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}).refine(t=>t.university==="Autre université"?!!t.otherUniversity&&t.otherUniversity.trim().length>1:!0,{message:"Veuillez indiquer le nom de votre université",path:["otherUniversity"]}).refine(t=>t.fieldOfStudy==="Autre"?!!t.otherFieldOfStudy&&t.otherFieldOfStudy.trim().length>1:!0,{message:"Veuillez indiquer le nom de votre filière",path:["otherFieldOfStudy"]}),lMe=On.object({university:On.string().min(1,"Veuillez sélectionner votre université"),otherUniversity:On.string().optional(),fieldOfStudy:On.string().min(1,"Veuillez indiquer votre filière"),otherFieldOfStudy:On.string().optional(),graduationYear:On.string().min(1,"Veuillez indiquer votre année de diplôme"),displayName:On.string().min(2,"Le nom doit contenir au moins 2 caractères")}).refine(t=>t.university==="Autre université"?!!t.otherUniversity&&t.otherUniversity.trim().length>1:!0,{message:"Veuillez indiquer le nom de votre université",path:["otherUniversity"]}).refine(t=>t.fieldOfStudy==="Autre"?!!t.otherFieldOfStudy&&t.otherFieldOfStudy.trim().length>1:!0,{message:"Veuillez indiquer le nom de votre filière",path:["otherFieldOfStudy"]}),G$=["Sorbonne Université","Université Paris-Dauphine","École Polytechnique","ENS Paris","CentraleSupélec","MINES ParisTech","HEC Paris","ESSEC","ESCP","Université Paris 1 Panthéon-Sorbonne","Université Paris 3 Sorbonne","Université Paris Cité","Sciences Po Paris","Autre université"],H$=["Informatique","Ingénierie","Commerce/Management","Droit","Médecine","Sciences","Lettres/Langues","Sciences Humaines","Arts","Architecture","Autre"],cMe=t=>[".edu","univ-",".ac.","student.","etudiant.","etu.","gmail.com","sorbonne-universite.fr","sorbonne-nouvelle.fr","dauphine.psl.eu","polytechnique.edu","ens.fr","centralesupelec.fr","mines-paristech.fr"].some(r=>t.toLowerCase().includes(r)),uMe=()=>{var ce,Se;const{currentUser:t,signIn:e,signInWithGoogle:r}=$i(),[n,c]=z.useState(!1),[d,p]=z.useState(!1),[a,w]=z.useState(!1),[E,C]=z.useState(!1),[P,R]=z.useState(""),[B,V]=z.useState(""),[W,K]=z.useState(!1),[Z,$]=z.useState(null),X=Ra(),Q=K_({resolver:X_(aMe),defaultValues:{email:"",password:""}}),re=K_({resolver:X_(oMe),defaultValues:{firstName:"",lastName:"",displayName:"",email:"",university:"",otherUniversity:"",fieldOfStudy:"",otherFieldOfStudy:"",graduationYear:"",password:"",confirmPassword:""}}),ve=K_({resolver:X_(lMe),defaultValues:{university:"",fieldOfStudy:"",graduationYear:""}});if(z.useEffect(()=>{(async()=>{if(!t){K(!1),$(null);return}try{const J=await Xa(hn(rr,"users",t.uid));if(J.exists()){const ke=J.data();if(t.emailVerified&&!ke.emailVerified){await Rs(hn(rr,"users",t.uid),{emailVerified:!0,profileCompleted:!0,updatedAt:new Date().toISOString()}),window.location.reload();return}!(t.emailVerified||t.providerData.some(Xe=>Xe.providerId==="google.com"))&&!ke.emailVerified&&(V(t.email||""),C(!0)),K(!1)}else{if(t.providerData.some(ke=>ke.providerId==="google.com")){if(!cMe(t.email||"")){R("Vous devez utiliser une adresse email universitaire"),ko.signOut();return}$({email:t.email,displayName:t.displayName,photoURL:t.photoURL,uid:t.uid}),K(!0);return}console.error("User profile not found and not from Google"),K(!1)}}catch(J){console.error("Error checking user profile:",J),K(!1)}})()},[t]),z.useEffect(()=>{let le=null;return E&&t&&!t.emailVerified&&(le=setInterval(async()=>{try{await gD(t),t.emailVerified&&(C(!1),V(""),R(""),window.location.reload())}catch(J){console.error("Error checking email verification:",J)}},5e3)),()=>{le&&clearInterval(le)}},[E,t]),W&&Z)return i.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 py-8",children:i.jsxs(Tt,{className:"w-full max-w-md",children:[i.jsxs(Dr,{className:"text-center",children:[i.jsx("div",{className:"flex items-center justify-center mb-4",children:i.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:i.jsx(f8,{className:"w-6 h-6 text-green-600"})})}),i.jsx(kr,{className:"text-2xl text-green-600",children:"Complétez votre profil étudiant"}),i.jsx(Ls,{children:"Dernière étape pour accéder à StudyMarket"})]}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs(Ys,{children:[i.jsx(f8,{className:"h-4 w-4"}),i.jsxs(Js,{children:["Connecté avec ",i.jsx("strong",{children:Z.email})]})]}),P&&i.jsxs(Ys,{variant:"destructive",children:[i.jsx(Yd,{className:"h-4 w-4"}),i.jsx(Js,{children:P})]}),i.jsxs("form",{onSubmit:ve.handleSubmit(async le=>{w(!0),R("");try{const J=le.university==="Autre université"?le.otherUniversity:le.university,ke=le.fieldOfStudy==="Autre"?le.otherFieldOfStudy:le.fieldOfStudy,Ze=Object.fromEntries(Object.entries(le).filter(([,Xe])=>Xe!==void 0));if(await C0(hn(rr,"users",Z.uid),{email:Z.email,displayName:Ze.displayName,photoURL:Z.photoURL,university:J,otherUniversity:le.university==="Autre université"?le.otherUniversity:null,fieldOfStudy:ke,otherFieldOfStudy:le.fieldOfStudy==="Autre"?le.otherFieldOfStudy:null,graduationYear:parseInt(le.graduationYear),createdAt:new Date().toISOString(),emailVerified:!0,isStudent:!0,provider:"google",profileCompleted:!0}),t&&Z.displayName)try{await OS(t,{displayName:Ze.displayName})}catch(Xe){console.error("Error updating profile:",Xe)}window.location.reload()}catch(J){console.error("Error completing profile:",J),R("Erreur lors de la sauvegarde du profil")}finally{w(!1)}}),className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"university",children:"Université"}),i.jsxs(ds,{onValueChange:le=>ve.setValue("university",le),value:ve.watch("university"),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Sélectionnez votre université"})}),i.jsx(as,{children:G$.map(le=>i.jsx(Bt,{value:le,children:le},le))})]}),ve.watch("university")==="Autre université"&&i.jsx(Gr,{id:"otherUniversity",type:"text",placeholder:"Nom de votre université",...ve.register("otherUniversity"),className:"mt-2"}),ve.formState.errors.university&&i.jsx("p",{className:"text-sm text-destructive",children:ve.formState.errors.university.message}),ve.watch("university")==="Autre université"&&ve.formState.errors.otherUniversity&&i.jsx("p",{className:"text-sm text-destructive",children:ve.formState.errors.otherUniversity.message})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"fieldOfStudy",children:"Filière"}),i.jsxs(ds,{onValueChange:le=>ve.setValue("fieldOfStudy",le),value:ve.watch("fieldOfStudy"),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Filière"})}),i.jsx(as,{children:H$.map(le=>i.jsx(Bt,{value:le,children:le},le))})]}),ve.watch("fieldOfStudy")==="Autre"&&i.jsx(Gr,{id:"otherFieldOfStudy",type:"text",placeholder:"Nom de votre filière",...ve.register("otherFieldOfStudy"),className:"mt-2"}),ve.formState.errors.fieldOfStudy&&i.jsx("p",{className:"text-sm text-destructive",children:ve.formState.errors.fieldOfStudy.message}),ve.watch("fieldOfStudy")==="Autre"&&ve.formState.errors.otherFieldOfStudy&&i.jsx("p",{className:"text-sm text-destructive",children:ve.formState.errors.otherFieldOfStudy.message})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"graduationYear",children:"Année de diplôme"}),i.jsxs(ds,{onValueChange:le=>ve.setValue("graduationYear",le),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Année"})}),i.jsx(as,{children:Array.from({length:8},(le,J)=>2024+J).map(le=>i.jsx(Bt,{value:le.toString(),children:le},le))})]}),ve.formState.errors.graduationYear&&i.jsx("p",{className:"text-sm text-destructive",children:ve.formState.errors.graduationYear.message})]})]}),i.jsxs(Ge,{type:"submit",className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800",disabled:a,children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Finaliser mon inscription"]})]}),i.jsx(Ge,{variant:"outline",onClick:()=>{ko.signOut(),K(!1),$(null)},className:"w-full",children:"Se déconnecter et recommencer"})]})]})});if(E)return i.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 py-8",children:i.jsxs(Tt,{className:"w-full max-w-md",children:[i.jsxs(Dr,{className:"text-center",children:[i.jsx("div",{className:"flex items-center justify-center mb-4",children:i.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:i.jsx(Nl,{className:"w-6 h-6 text-blue-600"})})}),i.jsx(kr,{className:"text-2xl text-blue-600",children:"Vérifiez votre email"}),i.jsxs(Ls,{children:["Un lien d'activation a été envoyé à ",i.jsx("strong",{children:B}),".",i.jsx("br",{}),"Cliquez sur le lien pour activer votre compte.",i.jsx("br",{}),i.jsx("span",{className:"text-xs text-muted-foreground",children:"(Vous pouvez fermer cette page et revenir après avoir validé l'email)"})]})]}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[i.jsx("p",{children:i.jsx("strong",{children:"Important :"})}),i.jsx("p",{children:"• Cliquez sur le lien dans l'email pour activer votre compte"}),i.jsx("p",{children:"• Vérifiez votre boîte de réception et vos spams"}),i.jsx("p",{children:"• Le lien expire dans 24h"})]}),i.jsxs(Ge,{onClick:async()=>{if(t){w(!0);try{await Q6(t,LD.actionCodeSettings),R(""),alert("Email d'activation renvoyé !")}catch(le){R("Erreur lors de l'envoi de l'email"),console.error("Error resending verification:",le)}w(!1)}},variant:"outline",className:"w-full",disabled:a||!t,children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(Nl,{className:"w-4 h-4 mr-2"}),"Renvoyer l'email d'activation"]}),i.jsx(Ge,{onClick:async()=>{if(t){w(!0);try{await gD(t),t.emailVerified?(C(!1),V(""),R(""),window.location.reload()):R("L'email n'est pas encore validé. Pensez à vérifier vos spams.")}catch{R("Erreur lors de la vérification de l'état de l'email")}w(!1)}},variant:"secondary",className:"w-full",disabled:a||!t,children:"J'ai déjà validé mon email"}),P&&i.jsxs(Ys,{variant:"destructive",children:[i.jsx(Yd,{className:"h-4 w-4"}),i.jsx(Js,{children:P})]}),i.jsx(Ge,{variant:"link",onClick:()=>{C(!1),V(""),R(""),t&&ko.signOut()},className:"w-full",children:"Retour à l'inscription"})]})]})});const pe=async le=>{w(!0),R("");try{await e(le.email,le.password),X("/")}catch(J){const ke=J instanceof Error?J.message:"Erreur inconnue",Ze=J==null?void 0:J.code;R(Ze==="auth/invalid-credential"?"Email ou mot de passe incorrect":Ze==="auth/user-not-found"?"Aucun compte trouvé avec cet email":Ze==="auth/user-disabled"?"Ce compte a été désactivé":Ze==="auth/too-many-requests"?"Trop de tentatives. Réessayez plus tard.":"Erreur de connexion: "+ke),console.error("Sign in error:",J)}finally{w(!1)}},ue=async le=>{w(!0),R("");try{const{firstName:J,lastName:ke}=le,Ze=`${J} ${ke}`,qe=(await SG(ko,le.email,le.password)).user,$e=le.university==="Autre université"&&le.otherUniversity||le.university,st=le.fieldOfStudy==="Autre"&&le.otherFieldOfStudy||le.fieldOfStudy;console.log("📝 Données d'inscription:",{firstName:J,lastName:ke,displayName:Ze,email:le.email,university:le.university,otherUniversity:le.otherUniversity,universityToSave:$e,fieldOfStudy:le.fieldOfStudy,otherFieldOfStudy:le.otherFieldOfStudy,fieldOfStudyToSave:st,graduationYear:le.graduationYear});const it={firstName:J,lastName:ke,displayName:Ze,university:$e,otherUniversity:le.university==="Autre université"?le.otherUniversity:null,fieldOfStudy:st,otherFieldOfStudy:le.fieldOfStudy==="Autre"?le.otherFieldOfStudy:null,graduationYear:parseInt(le.graduationYear),email:le.email,photoURL:null,bio:null,phone:null,campus:null,location:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),emailVerified:!1,profileCompleted:!1,isStudent:!0,provider:"email"};console.log("💾 Données à sauvegarder dans Firestore:",it),await C0(hn(rr,"users",qe.uid),it),console.log("✅ Données sauvegardées avec succès pour UID:",qe.uid),await OS(qe,{displayName:Ze}),await Q6(qe,LD.actionCodeSettings),V(le.email),C(!0)}catch(J){const ke=J==null?void 0:J.code;R(ke==="auth/email-already-in-use"?"Cette adresse email est déjà utilisée":ke==="auth/weak-password"?"Le mot de passe est trop faible":ke==="auth/invalid-email"?"Adresse email invalide":"Erreur lors de la création du compte"),console.error("Sign up error:",J)}finally{w(!1)}},ge=async()=>{w(!0),R("");try{await r()}catch(le){const J=le instanceof Error?le.message:"Erreur inconnue",ke=le==null?void 0:le.code;R(ke==="auth/popup-closed-by-user"?"Connexion annulée":ke==="auth/popup-blocked"?"Popup bloquée par le navigateur":ke==="auth/account-exists-with-different-credential"?"Un compte existe déjà avec cet email":"Erreur de connexion avec Google: "+J),console.error("Google sign in error:",le)}finally{w(!1)}};return i.jsx("div",{className:"min-h-screen flex items-center justify-center px-2 sm:px-4 py-4 sm:py-8 bg-gradient-to-br from-primary/5 via-background to-secondary/5",children:i.jsxs(Tt,{className:"w-full max-w-md sm:max-w-lg lg:max-w-xl mx-auto",children:[i.jsxs(Dr,{className:"text-center space-y-2 sm:space-y-4",children:[i.jsx("div",{className:"flex justify-center",children:i.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center",children:i.jsx(up,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})})}),i.jsx(kr,{className:"text-xl sm:text-2xl lg:text-3xl",children:n?"Rejoindre StudyMarket":"Connectez-vous à votre compte étudiant"}),i.jsx(Ls,{className:"text-sm sm:text-base",children:n?"Créez votre compte étudiant vérifié et rejoignez la communauté":"Connectez-vous à votre compte étudiant"}),n&&i.jsx("div",{className:"flex items-center justify-center gap-2 mt-2 sm:mt-4",children:i.jsxs(Ir,{className:"bg-blue-100 text-blue-800 border-blue-200 text-xs sm:text-sm",children:[i.jsx(Ms,{className:"w-3 h-3 mr-1"}),"Email universitaire requis"]})})]}),i.jsxs(jt,{className:"space-y-4 sm:space-y-6",children:[P&&i.jsxs(Ys,{variant:"destructive",children:[i.jsx(Yd,{className:"h-4 w-4"}),i.jsx(Js,{children:P})]}),i.jsxs(Ge,{variant:"outline",className:"w-full",onClick:ge,disabled:a,children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsxs("svg",{className:"w-4 h-4 mr-2",viewBox:"0 0 24 24",children:[i.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),i.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),i.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),i.jsx("path",{fill:"currentColor",d:"M12 1c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),i.jsx("span",{className:"hidden sm:inline",children:"Continuer avec Google Éducation"}),i.jsx("span",{className:"sm:hidden",children:"Google Éducation"})]}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx(Zc,{className:"w-full"})}),i.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:i.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Ou avec votre email universitaire"})})]}),i.jsxs("form",{onSubmit:n?re.handleSubmit(ue):Q.handleSubmit(pe),className:"space-y-4",children:[n&&i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Zr,{htmlFor:"firstName",className:"text-sm",children:"Prénom"}),i.jsx(Gr,{id:"firstName",...re.register("firstName"),autoComplete:"given-name",className:"text-sm"}),re.formState.errors.firstName&&i.jsx("span",{className:"text-red-500 text-xs",children:re.formState.errors.firstName.message})]}),i.jsxs("div",{className:"flex-1",children:[i.jsx(Zr,{htmlFor:"lastName",className:"text-sm",children:"Nom"}),i.jsx(Gr,{id:"lastName",...re.register("lastName"),autoComplete:"family-name",className:"text-sm"}),re.formState.errors.lastName&&i.jsx("span",{className:"text-red-500 text-xs",children:re.formState.errors.lastName.message})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"email",className:"text-sm",children:"Email universitaire"}),i.jsxs("div",{className:"relative",children:[i.jsx(Nl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{id:"email",type:"email",placeholder:"prenom.nom@univ-exemple.fr",className:"pl-10 text-sm",...n?re.register("email"):Q.register("email")})]}),(n?re.formState.errors.email:Q.formState.errors.email)&&i.jsx("p",{className:"text-sm text-destructive",children:(ce=n?re.formState.errors.email:Q.formState.errors.email)==null?void 0:ce.message}),n&&i.jsx("p",{className:"text-xs text-muted-foreground",children:"Un lien d'activation sera envoyé à cette adresse"})]}),n&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"university",className:"text-sm",children:"Université"}),i.jsxs(ds,{onValueChange:le=>re.setValue("university",le),value:re.watch("university"),children:[i.jsx(is,{className:"text-sm",children:i.jsx(hs,{placeholder:"Sélectionnez votre université"})}),i.jsx(as,{children:G$.map(le=>i.jsx(Bt,{value:le,children:le},le))})]}),re.watch("university")==="Autre université"&&i.jsx(Gr,{id:"otherUniversity",type:"text",placeholder:"Nom de votre université",...re.register("otherUniversity"),className:"mt-2 text-sm"}),re.formState.errors.university&&i.jsx("p",{className:"text-sm text-destructive",children:re.formState.errors.university.message}),re.watch("university")==="Autre université"&&re.formState.errors.otherUniversity&&i.jsx("p",{className:"text-sm text-destructive",children:re.formState.errors.otherUniversity.message})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"fieldOfStudy",className:"text-sm",children:"Filière"}),i.jsxs(ds,{onValueChange:le=>re.setValue("fieldOfStudy",le),value:re.watch("fieldOfStudy"),children:[i.jsx(is,{className:"text-sm",children:i.jsx(hs,{placeholder:"Sélectionnez votre filière"})}),i.jsx(as,{children:H$.map(le=>i.jsx(Bt,{value:le,children:le},le))})]}),re.watch("fieldOfStudy")==="Autre"&&i.jsx(Gr,{id:"otherFieldOfStudy",type:"text",placeholder:"Nom de votre filière",...re.register("otherFieldOfStudy"),className:"mt-2 text-sm"}),re.formState.errors.fieldOfStudy&&i.jsx("p",{className:"text-sm text-destructive",children:re.formState.errors.fieldOfStudy.message}),re.watch("fieldOfStudy")==="Autre"&&re.formState.errors.otherFieldOfStudy&&i.jsx("p",{className:"text-sm text-destructive",children:re.formState.errors.otherFieldOfStudy.message})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"graduationYear",className:"text-sm",children:"Année de diplôme"}),i.jsxs(ds,{onValueChange:le=>re.setValue("graduationYear",le),value:re.watch("graduationYear"),children:[i.jsx(is,{className:"text-sm",children:i.jsx(hs,{placeholder:"Sélectionnez votre année"})}),i.jsx(as,{children:Array.from({length:8},(le,J)=>2024+J).map(le=>i.jsx(Bt,{value:le.toString(),children:le},le))})]}),re.formState.errors.graduationYear&&i.jsx("p",{className:"text-sm text-destructive",children:re.formState.errors.graduationYear.message})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"password",className:"text-sm",children:"Mot de passe"}),i.jsxs("div",{className:"relative",children:[i.jsx(xy,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{id:"password",type:d?"text":"password",placeholder:"••••••••",className:"pl-10 text-sm",...n?re.register("password"):Q.register("password")}),i.jsx(Ge,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>p(!d),children:d?i.jsx(Pxe,{className:"w-4 h-4"}):i.jsx(Fo,{className:"w-4 h-4"})})]}),(n?re.formState.errors.password:Q.formState.errors.password)&&i.jsx("p",{className:"text-sm text-destructive",children:(Se=n?re.formState.errors.password:Q.formState.errors.password)==null?void 0:Se.message})]}),n&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(Zr,{htmlFor:"confirmPassword",className:"text-sm",children:"Confirmer le mot de passe"}),i.jsxs("div",{className:"relative",children:[i.jsx(xy,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{id:"confirmPassword",type:d?"text":"password",placeholder:"••••••••",className:"pl-10 text-sm",...re.register("confirmPassword")})]}),re.formState.errors.confirmPassword&&i.jsx("p",{className:"text-sm text-destructive",children:re.formState.errors.confirmPassword.message})]}),i.jsxs(Ge,{type:"submit",className:"w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-sm sm:text-base",disabled:a,children:[a?i.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}):null,n?"Créer le compte et envoyer l'email":"Se connecter"]})]}),i.jsx("div",{className:"w-full",children:i.jsx(Ge,{variant:"link",onClick:()=>c(!n),disabled:a,className:"w-full flex justify-center items-center text-center break-words px-1 text-sm sm:text-base",children:n?"Déjà un compte ? Se connecter":"Pas encore de compte ? S'inscrire"})}),n&&i.jsx("div",{className:"text-center text-xs text-muted-foreground",children:"En créant un compte, vous acceptez nos conditions d'utilisation. Seules les adresses email universitaires sont acceptées."})]})]})})},dMe=()=>{const[t]=xE(),e=Ra(),[r,n]=z.useState("loading"),[c,d]=z.useState(""),[p,a]=z.useState(""),[w,E]=z.useState(!1),[C,P]=z.useState("");z.useEffect(()=>{(async()=>{const V=t.get("mode"),W=t.get("oobCode");if(V!=="verifyEmail"||!W){n("error"),d("Lien de vérification invalide");return}try{const Z=(await bhe(ko,W)).data.email||"";if(a(Z),console.log("📧 Email à vérifier:",Z),await whe(ko,W),console.log("✅ Code de vérification appliqué"),ko.currentUser&&ko.currentUser.email===Z){console.log("✅ Utilisateur déjà connecté"),await ko.currentUser.reload();const $=hn(rr,"users",ko.currentUser.uid),X=await Xa($);if(X.exists()){const Q=X.data();console.log("📊 Données utilisateur existantes:",{firstName:Q.firstName,lastName:Q.lastName,university:Q.university,otherUniversity:Q.otherUniversity,fieldOfStudy:Q.fieldOfStudy,otherFieldOfStudy:Q.otherFieldOfStudy,graduationYear:Q.graduationYear}),await Rs($,{emailVerified:!0,profileCompleted:!0,updatedAt:new Date().toISOString()}),console.log("✅ Profil mis à jour dans Firestore")}n("success"),setTimeout(()=>{e("/",{replace:!0}),window.location.reload()},2e3)}else console.log("⚠️ Utilisateur non connecté, connexion nécessaire"),E(!0),n("loading")}catch(K){console.error("❌ Erreur lors de la vérification:",K);let Z="Une erreur est survenue";K.code==="auth/invalid-action-code"?Z="Le lien de vérification a expiré ou a déjà été utilisé":K.code==="auth/expired-action-code"&&(Z="Le lien de vérification a expiré. Demandez un nouveau lien."),d(Z),n("error")}})()},[t,e]);const R=async B=>{if(B.preventDefault(),!C||!p){d("Veuillez entrer votre mot de passe");return}n("loading");try{const V=await EG(ko,p,C);console.log("✅ Connexion réussie pour:",V.user.uid),await V.user.reload();const W=hn(rr,"users",V.user.uid),K=await Xa(W);if(K.exists()){const Z=K.data();console.log("📊 Données utilisateur:",{firstName:Z.firstName,lastName:Z.lastName,university:Z.university,otherUniversity:Z.otherUniversity,fieldOfStudy:Z.fieldOfStudy,otherFieldOfStudy:Z.otherFieldOfStudy,graduationYear:Z.graduationYear}),await Rs(W,{emailVerified:!0,profileCompleted:!0,updatedAt:new Date().toISOString()}),console.log("✅ Profil mis à jour dans Firestore")}n("success"),setTimeout(()=>{e("/",{replace:!0}),window.location.reload()},2e3)}catch(V){console.error("❌ Erreur de connexion:",V);let W="Erreur de connexion";V.code==="auth/wrong-password"?W="Mot de passe incorrect":V.code==="auth/user-not-found"?W="Utilisateur non trouvé":V.code==="auth/too-many-requests"&&(W="Trop de tentatives. Veuillez réessayer plus tard."),d(W),n("error")}};return i.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 py-8 bg-gradient-to-br from-primary/5 via-background to-secondary/5",children:i.jsxs(Tt,{className:"w-full max-w-md",children:[i.jsxs(Dr,{className:"text-center",children:[i.jsxs("div",{className:"flex items-center justify-center mb-4",children:[r==="loading"&&!w&&i.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:i.jsx(Ka,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}),r==="success"&&i.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center",children:i.jsx(Hd,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),r==="error"&&i.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center",children:i.jsx(fo,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),w&&i.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:i.jsx(Nl,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})})]}),r==="loading"&&!w&&i.jsxs(i.Fragment,{children:[i.jsx(kr,{className:"text-2xl",children:"Vérification en cours..."}),i.jsx(Ls,{children:"Veuillez patienter pendant que nous vérifions votre email"})]}),w&&i.jsxs(i.Fragment,{children:[i.jsx(kr,{className:"text-2xl",children:"Email vérifié ✅"}),i.jsxs(Ls,{children:[p&&i.jsxs("span",{className:"block mb-2",children:[i.jsx("strong",{children:p})," est maintenant vérifié"]}),i.jsx("span",{children:"Entrez votre mot de passe pour vous connecter"})]})]}),r==="success"&&i.jsxs(i.Fragment,{children:[i.jsx(kr,{className:"text-2xl text-green-600 dark:text-green-400",children:"✅ Email vérifié avec succès !"}),i.jsxs(Ls,{children:[p&&i.jsxs("span",{className:"block mb-2",children:[i.jsx("strong",{children:p})," est maintenant vérifié"]}),i.jsx("span",{children:"Redirection vers votre compte..."})]})]}),r==="error"&&i.jsxs(i.Fragment,{children:[i.jsx(kr,{className:"text-2xl text-red-600 dark:text-red-400",children:"Erreur de vérification"}),i.jsx(Ls,{children:c})]})]}),i.jsxs(jt,{className:"space-y-4",children:[w&&i.jsxs("form",{onSubmit:R,className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{htmlFor:"password",className:"text-sm font-medium",children:"Mot de passe"}),i.jsx("input",{id:"password",type:"password",value:C,onChange:B=>P(B.target.value),placeholder:"Entrez votre mot de passe",className:"w-full px-3 py-2 border border-input rounded-md bg-background focus:outline-none focus:ring-2 focus:ring-ring",required:!0})]}),i.jsx(Ge,{type:"submit",className:"w-full",children:"Se connecter"})]}),r==="success"&&i.jsxs(Ys,{className:"bg-green-50 dark:bg-green-950 border-green-200 dark:border-green-800",children:[i.jsx(Nl,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),i.jsx(Js,{className:"text-green-800 dark:text-green-300",children:"Votre compte est maintenant activé et vous pouvez profiter de toutes les fonctionnalités de StudyMarket !"})]}),r==="error"&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs(Ys,{className:"bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800",children:[i.jsx(fo,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),i.jsx(Js,{className:"text-red-800 dark:text-red-300",children:c})]}),i.jsx(Ge,{onClick:()=>e("/auth",{replace:!0}),className:"w-full",children:"Retour à la connexion"})]}),r==="loading"&&!w&&i.jsx("div",{className:"flex justify-center",children:i.jsx("div",{className:"text-sm text-muted-foreground",children:"Cette opération peut prendre quelques secondes..."})})]})]})})},hMe=()=>i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-6 flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-secondary text-white flex items-center justify-center",children:i.jsx(Ms,{className:"w-5 h-5"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold",children:"Administration"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Gestion centrale de la plateforme"})]})]}),i.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[i.jsx("nav",{className:"lg:w-60 flex-shrink-0",children:i.jsxs("ul",{className:"space-y-1",children:[i.jsx("li",{children:i.jsxs(Bh,{to:"/admin",end:!0,className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(Lxe,{className:"w-4 h-4"}),"Vue d'ensemble"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/orders",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(gi,{className:"w-4 h-4"}),"Commandes"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/listings",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(Fxe,{className:"w-4 h-4"}),"Annonces"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/users",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(Sp,{className:"w-4 h-4"}),"Utilisateurs"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/webhooks",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(Xxe,{className:"w-4 h-4"}),"Webhook Logs"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/payouts",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(UC,{className:"w-4 h-4"}),"Payouts"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/messages",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(iI,{className:"w-4 h-4"}),"Messages"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/reports",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(va,{className:"w-4 h-4"}),"Signalements"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/verifications",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(qs,{className:"w-4 h-4"}),"Vérifications"]})}),i.jsx("li",{children:i.jsxs(Bh,{to:"/admin/audit",className:({isActive:t})=>`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${t?"bg-accent text-accent-foreground":"hover:bg-muted"}`,children:[i.jsx(U3,{className:"w-4 h-4"}),"Audit Trail"]})})]})}),i.jsx("section",{className:"flex-1",children:i.jsx("div",{className:"rounded-lg border border-border bg-card text-card-foreground p-4",children:i.jsx(jle,{})})})]})]}),fMe=()=>{const[t,e]=z.useState({totalUsers:0,newUsers24h:0,totalListings:0,activeListings:0,pendingListings:0,totalOrders:0,pendingOrders:0,paidOrders:0,failedOrders:0,revenue24h:0,revenueTotal:0,conversionRate:0}),[r,n]=z.useState(!0),[c,d]=z.useState([]);return z.useEffect(()=>{(async()=>{try{const a=new Date,w=new Date(a.getTime()-24*60*60*1e3),E=await gs(jn(rr,"users")),C=E.size,P=E.docs.filter(ge=>{var Se,le;return(((le=(Se=ge.data().createdAt)==null?void 0:Se.toDate)==null?void 0:le.call(Se))||new Date(0))>=w}).length,R=await gs(jn(rr,"listings")),B=R.size,V=R.docs.filter(ge=>ge.data().status==="active").length,W=R.docs.filter(ge=>ge.data().status==="pending").length,K=await gs(jn(rr,"orders")),Z=K.size,$=K.docs.filter(ge=>ge.data().status==="pending").length,X=K.docs.filter(ge=>ge.data().status==="paid").length,Q=K.docs.filter(ge=>ge.data().status==="failed").length;let re=0,ve=0;K.docs.forEach(ge=>{var Se,le;const ce=ge.data();if(ce.status==="paid"){const J=(ce.totalCents||ce.total*100||0)/100;re+=J,(((le=(Se=ce.createdAt)==null?void 0:Se.toDate)==null?void 0:le.call(Se))||new Date(0))>=w&&(ve+=J)}});const pe=Z>0?X/Z*100:0,ue=[];$>10&&ue.push(`${$} commandes en attente`),Q>5&&ue.push(`${Q} paiements échoués`),W>20&&ue.push(`${W} annonces en modération`),e({totalUsers:C,newUsers24h:P,totalListings:B,activeListings:V,pendingListings:W,totalOrders:Z,pendingOrders:$,paidOrders:X,failedOrders:Q,revenue24h:ve,revenueTotal:re,conversionRate:pe}),d(ue)}catch(a){console.error("Error fetching stats:",a)}finally{n(!1)}})()},[]),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Tableau de bord"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Vue d'ensemble de la plateforme"})]}),c.length>0&&i.jsxs(Ys,{variant:"destructive",children:[i.jsx(va,{className:"h-4 w-4"}),i.jsxs(Js,{children:[i.jsx("strong",{children:"Alertes :"}),i.jsx("ul",{className:"mt-2 space-y-1",children:c.map((p,a)=>i.jsxs("li",{children:["• ",p]},a))})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsx(Nr,{to:"/admin/users",className:"block group",children:i.jsxs(Tt,{className:"transition-all hover:shadow-lg hover:border-primary/50 cursor-pointer",children:[i.jsxs(Dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(kr,{className:"text-sm font-medium",children:"Utilisateurs"}),i.jsx(Sp,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors"})]}),i.jsxs(jt,{children:[i.jsx("div",{className:"text-2xl font-bold",children:r?"...":t.totalUsers}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",t.newUsers24h," dernières 24h"]})]})]})}),i.jsx(Nr,{to:"/admin/listings",className:"block group",children:i.jsxs(Tt,{className:"transition-all hover:shadow-lg hover:border-primary/50 cursor-pointer",children:[i.jsxs(Dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(kr,{className:"text-sm font-medium",children:"Annonces"}),i.jsx(gi,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors"})]}),i.jsxs(jt,{children:[i.jsx("div",{className:"text-2xl font-bold",children:r?"...":t.activeListings}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.pendingListings," en attente"]})]})]})}),i.jsx(Nr,{to:"/admin/orders",className:"block group",children:i.jsxs(Tt,{className:"transition-all hover:shadow-lg hover:border-primary/50 cursor-pointer",children:[i.jsxs(Dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(kr,{className:"text-sm font-medium",children:"Commandes"}),i.jsx(wp,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors"})]}),i.jsxs(jt,{children:[i.jsx("div",{className:"text-2xl font-bold",children:r?"...":t.paidOrders}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.pendingOrders," en attente, ",t.failedOrders," échouées"]})]})]})}),i.jsx(Nr,{to:"/admin/orders",className:"block group",children:i.jsxs(Tt,{className:"transition-all hover:shadow-lg hover:border-primary/50 cursor-pointer",children:[i.jsxs(Dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(kr,{className:"text-sm font-medium",children:"Revenus"}),i.jsx(UC,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors"})]}),i.jsxs(jt,{children:[i.jsx("div",{className:"text-2xl font-bold",children:r?"...":`${t.revenueTotal.toFixed(2)} €`}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",t.revenue24h.toFixed(2)," € (24h)"]})]})]})}),i.jsx(Nr,{to:"/admin/orders",className:"block group",children:i.jsxs(Tt,{className:"transition-all hover:shadow-lg hover:border-primary/50 cursor-pointer",children:[i.jsxs(Dr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(kr,{className:"text-sm font-medium",children:"Taux conversion"}),i.jsx(bp,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors"})]}),i.jsxs(jt,{children:[i.jsx("div",{className:"text-2xl font-bold",children:r?"...":`${t.conversionRate.toFixed(1)}%`}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.paidOrders,"/",t.totalOrders," commandes payées"]})]})]})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{children:"Actions rapides"})}),i.jsxs(jt,{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs(Nr,{to:"/admin/orders",className:"p-4 text-center border rounded-lg hover:bg-muted hover:border-primary/50 transition-all group",children:[i.jsx(wp,{className:"h-6 w-6 mx-auto mb-2 text-muted-foreground group-hover:text-primary transition-colors"}),i.jsx("div",{className:"text-sm font-medium",children:"Commandes"})]}),i.jsxs(Nr,{to:"/admin/listings",className:"p-4 text-center border rounded-lg hover:bg-muted hover:border-primary/50 transition-all group",children:[i.jsx(gi,{className:"h-6 w-6 mx-auto mb-2 text-muted-foreground group-hover:text-primary transition-colors"}),i.jsx("div",{className:"text-sm font-medium",children:"Annonces"})]}),i.jsxs(Nr,{to:"/admin/users",className:"p-4 text-center border rounded-lg hover:bg-muted hover:border-primary/50 transition-all group",children:[i.jsx(Sp,{className:"h-6 w-6 mx-auto mb-2 text-muted-foreground group-hover:text-primary transition-colors"}),i.jsx("div",{className:"text-sm font-medium",children:"Utilisateurs"})]}),i.jsxs(Nr,{to:"/admin/reports",className:"p-4 text-center border rounded-lg hover:bg-muted hover:border-primary/50 transition-all group",children:[i.jsx(V3,{className:"h-6 w-6 mx-auto mb-2 text-muted-foreground group-hover:text-primary transition-colors"}),i.jsx("div",{className:"text-sm font-medium",children:"Rapports"})]})]})]})]})},pMe=()=>{const[t,e]=z.useState([]),[r,n]=z.useState([]),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(""),[C,P]=z.useState(""),[R,B]=z.useState(!1),[V,W]=z.useState(!1),[K,Z]=z.useState("all"),[$,X]=z.useState("all"),[Q,re]=z.useState("");z.useEffect(()=>{ve()},[]),z.useEffect(()=>{pe()},[t,K,$,Q]);const ve=async()=>{try{const J=ms(jn(rr,"orders"),eo("createdAt","desc"),la(100)),Ze=(await gs(J)).docs.map(Xe=>({id:Xe.id,...Xe.data()}));e(Ze)}finally{d(!1)}},pe=()=>{let J=[...t];if(K!=="all"&&(J=J.filter(ke=>ke.status===K)),$!=="all"&&(J=J.filter(ke=>ke.method===$)),Q){const ke=Q.toLowerCase();J=J.filter(Ze=>{var Xe,qe;return Ze.id.toLowerCase().includes(ke)||((Xe=Ze.userId)==null?void 0:Xe.toLowerCase().includes(ke))||((qe=Ze.stripePaymentIntentId)==null?void 0:qe.toLowerCase().includes(ke))})}n(J)},ue=async()=>{if(p)try{const J=parseFloat(w);if(isNaN(J)||J<=0){Nt.error("Montant invalide");return}if(!(await fetch(`http://localhost:3001/api/admin/orders/${p.id}/refund`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount_cents:Math.round(J*100),reason:C||"Admin refund"})})).ok)throw new Error("Erreur lors du remboursement");Nt.success("Remboursement initié"),B(!1),ve()}catch(J){console.error("Refund error:",J),Nt.error(J.message||"Erreur lors du remboursement")}},ge=async J=>{try{if(!(await fetch(`http://localhost:3001/api/admin/orders/${J.id}/replay-webhook`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:"stripe"})})).ok)throw new Error("Erreur lors du replay webhook");Nt.success("Webhook rejoué"),ve()}catch(ke){console.error("Replay webhook error:",ke),Nt.error(ke.message||"Erreur lors du replay webhook")}},ce=async(J,ke)=>{try{await Rs(hn(rr,"orders",J.id),{status:ke,updatedAt:new Date}),Nt.success(`Statut changé vers ${ke}`),ve()}catch(Ze){console.error("Force status error:",Ze),Nt.error("Erreur lors du changement de statut")}},Se=()=>{const J=[["ID","User","Status","Amount","Method","Payment ID","Created"],...r.map(qe=>{var $e,st,it,Mt;return[qe.id,qe.userId||"",qe.status,((qe.totalCents||qe.total*100||0)/100).toFixed(2),qe.method||"",qe.stripePaymentIntentId||qe.paypalOrderId||"",((Mt=(it=(st=($e=qe.createdAt)==null?void 0:$e.toDate)==null?void 0:st.call($e))==null?void 0:it.toISOString)==null?void 0:Mt.call(it))||""]})].map(qe=>qe.join(",")).join(`
`),ke=new Blob([J],{type:"text/csv"}),Ze=URL.createObjectURL(ke),Xe=document.createElement("a");Xe.href=Ze,Xe.download=`orders-${new Date().toISOString().split("T")[0]}.csv`,Xe.click(),Nt.success("Export CSV téléchargé")},le=J=>{const ke={paid:"bg-green-500 text-white",pending:"bg-yellow-500 text-white",failed:"bg-red-500 text-white",cancelled:"bg-gray-500 text-white",processing:"bg-blue-500 text-white"};return i.jsx(Ir,{className:ke[J]||"",children:J})};return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Gestion des commandes"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," commande(s) sur ",t.length]})]}),i.jsxs(Ge,{onClick:Se,variant:"outline",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(Gr,{placeholder:"Rechercher ID, user, payment...",value:Q,onChange:J=>re(J.target.value),className:"max-w-xs"}),i.jsxs(ds,{value:K,onValueChange:Z,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous"}),i.jsx(Bt,{value:"pending",children:"Pending"}),i.jsx(Bt,{value:"paid",children:"Paid"}),i.jsx(Bt,{value:"failed",children:"Failed"}),i.jsx(Bt,{value:"cancelled",children:"Cancelled"})]})]}),i.jsxs(ds,{value:$,onValueChange:X,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Méthode"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Toutes"}),i.jsx(Bt,{value:"stripe",children:"Stripe"}),i.jsx(Bt,{value:"paypal",children:"PayPal"}),i.jsx(Bt,{value:"lydia",children:"Lydia"}),i.jsx(Bt,{value:"cash",children:"Cash"})]})]}),i.jsxs(Ge,{variant:"outline",onClick:ve,children:[i.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Rafraîchir"]})]}),c?i.jsx("div",{className:"text-left py-",children:"Chargement…"}):r.length===0?i.jsx("div",{className:"text-left py- rounded-md border border-border bg-muted/50",children:i.jsxs("p",{className:"text-muted-foreground",children:["Aucune commande trouvée.",t.length===0&&" La collection orders est vide."]})}):i.jsx("div",{className:"overflow-x-auto rounded-md border border-border",children:i.jsxs("table",{className:"min-w-full text-sm",children:[i.jsx("thead",{className:"bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"ID"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"User"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Statut"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Montant"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Méthode"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Payment ID"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(J=>{var ke;return i.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[i.jsxs("td",{className:"px-3 py-3 font-mono text-xs",children:[J.id.slice(0,8),"..."]}),i.jsx("td",{className:"px-3 py-3",children:((ke=J.userId)==null?void 0:ke.slice(0,8))||"—"}),i.jsx("td",{className:"px-3 py-3",children:le(J.status)}),i.jsxs("td",{className:"px-3 py-3 font-medium",children:[((J.totalCents||J.total*100||0)/100).toFixed(2)," €"]}),i.jsx("td",{className:"px-3 py-3 capitalize",children:J.method||"—"}),i.jsxs("td",{className:"px-3 py-3 font-mono text-xs",children:[(J.stripePaymentIntentId||J.paypalOrderId||"—").slice(0,12),"..."]}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(J),W(!0)},children:i.jsx(Fo,{className:"w-4 h-4"})}),J.status==="paid"&&i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(J),E(((J.totalCents||0)/100).toString()),B(!0)},children:i.jsx(UC,{className:"w-4 h-4"})}),(J.status==="pending"||J.status==="failed")&&i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>ge(J),children:i.jsx(Yo,{className:"w-4 h-4"})}),J.status==="pending"&&i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>ce(J,"paid"),children:i.jsx(qs,{className:"w-4 h-4 text-green-600"})})]})})]},J.id)})})]})}),i.jsx(ta,{open:R,onOpenChange:B,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Rembourser la commande"}),i.jsxs(go,{children:["Ordre ",p==null?void 0:p.id]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Montant (EUR)"}),i.jsx(Gr,{type:"number",step:"0.01",value:w,onChange:J=>E(J.target.value),placeholder:"0.00"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Raison"}),i.jsx(Gr,{value:C,onChange:J=>P(J.target.value),placeholder:"Raison du remboursement"})]})]}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>B(!1),children:"Annuler"}),i.jsx(Ge,{onClick:ue,children:"Rembourser"})]})]})}),i.jsx(ta,{open:V,onOpenChange:W,children:i.jsxs(Ki,{className:"max-w-2xl",children:[i.jsx(oa,{children:i.jsx(ra,{children:"Détail de la commande"})}),p&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"ID:"})," ",p.id]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Statut:"})," ",le(p.status)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Acheteur:"})," ",p.userId]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Vendeur:"})," ",p.sellerId||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Montant:"})," ",((p.totalCents||0)/100).toFixed(2)," €"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Méthode:"})," ",p.method||"—"]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Payment ID:"})," ",i.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:p.stripePaymentIntentId||p.paypalOrderId||"—"})]})]}),p.items&&p.items.length>0&&i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-2",children:"Articles"}),i.jsx("div",{className:"space-y-2",children:p.items.map((J,ke)=>i.jsxs("div",{className:"flex justify-between text-sm border-b pb-2",children:[i.jsx("span",{children:J.title||J.name}),i.jsxs("span",{children:[J.price," € x ",J.quantity]})]},ke))})]})]}),i.jsx(mo,{children:i.jsx(Ge,{onClick:()=>W(!1),children:"Fermer"})})]})})]})},mMe=()=>{const[t,e]=z.useState([]),[r,n]=z.useState([]),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState(!1),[R,B]=z.useState(""),[V,W]=z.useState("all");z.useEffect(()=>{K()},[]),z.useEffect(()=>{Z()},[t,R,V]);const K=async()=>{try{const ve=ms(jn(rr,"listings"),eo("createdAt","desc"),la(100)),pe=await gs(ve);e(pe.docs.map(ue=>({id:ue.id,...ue.data()})))}finally{d(!1)}},Z=()=>{let ve=[...t];if(V!=="all"&&(ve=ve.filter(pe=>pe.status===V)),R){const pe=R.toLowerCase();ve=ve.filter(ue=>{var ge,ce;return((ge=ue.title)==null?void 0:ge.toLowerCase().includes(pe))||ue.id.toLowerCase().includes(pe)||((ce=ue.sellerId)==null?void 0:ce.toLowerCase().includes(pe))})}n(ve)},$=async(ve,pe)=>{try{await Rs(hn(rr,"listings",ve.id),{status:pe,updatedAt:new Date}),Nt.success(`Statut changé vers ${pe}`),K()}catch(ue){console.error("Change status error:",ue),Nt.error("Erreur lors du changement de statut")}},X=async()=>{if(p)try{await cd(hn(rr,"listings",p.id)),Nt.success("Annonce supprimée"),P(!1),K()}catch(ve){console.error("Delete error:",ve),Nt.error("Erreur lors de la suppression")}},Q=()=>{const ve=[["ID","Title","Price","Currency","Status","Seller","Category","Views","Created"],...r.map(ce=>{var Se,le,J,ke;return[ce.id,ce.title||"",ce.price||0,ce.currency||"EUR",ce.status||"",ce.sellerId||"",ce.category||"",ce.views||0,((ke=(J=(le=(Se=ce.createdAt)==null?void 0:Se.toDate)==null?void 0:le.call(Se))==null?void 0:J.toISOString)==null?void 0:ke.call(J))||""]})].map(ce=>ce.join(",")).join(`
`),pe=new Blob([ve],{type:"text/csv"}),ue=URL.createObjectURL(pe),ge=document.createElement("a");ge.href=ue,ge.download=`listings-${new Date().toISOString().split("T")[0]}.csv`,ge.click(),Nt.success("Export CSV téléchargé")},re=ve=>{const pe={active:"bg-green-500 text-white",sold:"bg-blue-500 text-white",pending:"bg-yellow-500 text-white",removed:"bg-red-500 text-white",draft:"bg-gray-500 text-white"};return i.jsx(Ir,{className:pe[ve||""]||"",children:ve||"unknown"})};return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Gestion des annonces"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," annonce(s) sur ",t.length]})]}),i.jsxs(Ge,{onClick:Q,variant:"outline",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(Gr,{placeholder:"Rechercher titre, ID, vendeur...",value:R,onChange:ve=>B(ve.target.value),className:"max-w-xs"}),i.jsxs(ds,{value:V,onValueChange:W,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous"}),i.jsx(Bt,{value:"active",children:"Active"}),i.jsx(Bt,{value:"sold",children:"Vendue"}),i.jsx(Bt,{value:"pending",children:"En attente"}),i.jsx(Bt,{value:"removed",children:"Supprimée"}),i.jsx(Bt,{value:"draft",children:"Brouillon"})]})]}),i.jsxs(Ge,{variant:"outline",onClick:K,children:[i.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Rafraîchir"]})]}),c?i.jsx("div",{className:"text-left py-",children:"Chargement…"}):r.length===0?i.jsx("div",{className:"text-left py- rounded-md border border-border bg-muted/50",children:i.jsxs("p",{className:"text-muted-foreground",children:["Aucune annonce trouvée.",t.length===0&&" La collection listings est vide."]})}):i.jsx("div",{className:"overflow-x-auto rounded-md border border-border",children:i.jsxs("table",{className:"min-w-full text-sm",children:[i.jsx("thead",{className:"bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"ID"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Titre"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Prix"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Statut"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Vues"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(ve=>i.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[i.jsxs("td",{className:"px-3 py-3 font-mono text-xs",children:[ve.id.slice(0,8),"..."]}),i.jsx("td",{className:"px-3 py-3",children:ve.title||"—"}),i.jsx("td",{className:"px-3 py-3 font-medium",children:typeof ve.price=="number"?`${ve.price.toFixed(2)} ${ve.currency||"EUR"}`:"—"}),i.jsx("td",{className:"px-3 py-3",children:re(ve.status)}),i.jsx("td",{className:"px-3 py-3",children:ve.views||0}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(ve),E(!0)},children:i.jsx(Fo,{className:"w-4 h-4"})}),ve.status==="pending"&&i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>$(ve,"active"),title:"Approuver",children:i.jsx(qs,{className:"w-4 h-4 text-green-600"})}),ve.status==="active"&&i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>$(ve,"removed"),title:"Retirer",children:i.jsx(fo,{className:"w-4 h-4 text-red-600"})}),i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(ve),P(!0)},title:"Supprimer définitivement",children:i.jsx(nd,{className:"w-4 h-4 text-red-600"})})]})})]},ve.id))})]})}),i.jsx(ta,{open:C,onOpenChange:P,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Supprimer l'annonce"}),i.jsx(go,{children:p==null?void 0:p.title})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Cette action est irréversible. L'annonce sera définitivement supprimée."}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>P(!1),children:"Annuler"}),i.jsx(Ge,{variant:"destructive",onClick:X,children:"Supprimer"})]})]})}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsxs(Ki,{className:"max-w-2xl",children:[i.jsx(oa,{children:i.jsx(ra,{children:"Détail de l'annonce"})}),p&&i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"ID:"})," ",p.id]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Statut:"})," ",re(p.status)]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Titre:"})," ",p.title||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Prix:"})," ",p.price," ",p.currency||"EUR"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Catégorie:"})," ",p.category||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Vendeur:"})," ",p.sellerName||p.sellerId||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Vues:"})," ",p.views||0]}),p.images&&p.images.length>0&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Images:"})," ",p.images.length," image(s)"]})]})}),i.jsx(mo,{children:i.jsx(Ge,{onClick:()=>E(!1),children:"Fermer"})})]})})]})},gMe=()=>{const[t,e]=z.useState([]),[r,n]=z.useState([]),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState(!1),[R,B]=z.useState(""),[V,W]=z.useState(""),[K,Z]=z.useState("all");z.useEffect(()=>{$()},[]),z.useEffect(()=>{X()},[t,V,K]);const $=async()=>{try{const ge=ms(jn(rr,"users"),eo("createdAt","desc"),la(100)),ce=await gs(ge);e(ce.docs.map(Se=>({id:Se.id,...Se.data()})))}finally{d(!1)}},X=()=>{let ge=[...t];if(K!=="all"&&(K==="verified"&&(ge=ge.filter(ce=>ce.isVerified)),K==="blocked"&&(ge=ge.filter(ce=>ce.blocked)),K==="unverified"&&(ge=ge.filter(ce=>!ce.isVerified))),V){const ce=V.toLowerCase();ge=ge.filter(Se=>{var le,J,ke;return((le=Se.email)==null?void 0:le.toLowerCase().includes(ce))||((J=Se.displayName)==null?void 0:J.toLowerCase().includes(ce))||((ke=Se.university)==null?void 0:ke.toLowerCase().includes(ce))||Se.id.toLowerCase().includes(ce)})}n(ge)},Q=async ge=>{if(p)try{if(!(await fetch(`http://localhost:3001/api/admin/users/${p.id}/block`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blocked:ge,reason:R})})).ok)throw new Error("Erreur lors du blocage");Nt.success(ge?"Utilisateur bloqué":"Utilisateur débloqué"),P(!1),B(""),$()}catch(ce){console.error("Block user error:",ce),Nt.error(ce.message||"Erreur lors du blocage")}},re=async ge=>{try{await Rs(hn(rr,"users",ge.id),{isVerified:!0,verificationStatus:"verified",updatedAt:new Date}),Nt.success("Utilisateur vérifié"),$()}catch(ce){console.error("Verify error:",ce),Nt.error("Erreur lors de la vérification")}},ve=async(ge,ce)=>{try{await Rs(hn(rr,"users",ge.id),{role:ce,updatedAt:new Date}),Nt.success(`Rôle changé vers ${ce}`),$()}catch(Se){console.error("Change role error:",Se),Nt.error("Erreur lors du changement de rôle")}},pe=()=>{const ge=[["ID","Name","Email","University","Verified","Blocked","CO2 Saved","Transactions","Created"],...r.map(J=>{var ke,Ze,Xe,qe;return[J.id,J.displayName||"",J.email||"",J.university||"",J.isVerified?"Yes":"No",J.blocked?"Yes":"No",J.co2Saved||0,J.transactionsCount||0,((qe=(Xe=(Ze=(ke=J.createdAt)==null?void 0:ke.toDate)==null?void 0:Ze.call(ke))==null?void 0:Xe.toISOString)==null?void 0:qe.call(Xe))||""]})].map(J=>J.join(",")).join(`
`),ce=new Blob([ge],{type:"text/csv"}),Se=URL.createObjectURL(ce),le=document.createElement("a");le.href=Se,le.download=`users-${new Date().toISOString().split("T")[0]}.csv`,le.click(),Nt.success("Export CSV téléchargé")},ue=ge=>ge.blocked?i.jsx(Ir,{className:"bg-red-500 text-white",children:"Bloqué"}):ge.isVerified?i.jsx(Ir,{className:"bg-green-500 text-white",children:"Vérifié"}):i.jsx(Ir,{className:"bg-yellow-500 text-white",children:"Non vérifié"});return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Gestion des utilisateurs"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," utilisateur(s) sur ",t.length]})]}),i.jsxs(Ge,{onClick:pe,variant:"outline",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(Gr,{placeholder:"Rechercher nom, email, université...",value:V,onChange:ge=>W(ge.target.value),className:"max-w-xs"}),i.jsxs(ds,{value:K,onValueChange:Z,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous"}),i.jsx(Bt,{value:"verified",children:"Vérifiés"}),i.jsx(Bt,{value:"unverified",children:"Non vérifiés"}),i.jsx(Bt,{value:"blocked",children:"Bloqués"})]})]}),i.jsxs(Ge,{variant:"outline",onClick:$,children:[i.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Rafraîchir"]})]}),c?i.jsx("div",{className:"text-left py-",children:"Chargement…"}):r.length===0?i.jsx("div",{className:"text-left py- rounded-md border border-border bg-muted/50",children:i.jsxs("p",{className:"text-muted-foreground",children:["Aucun utilisateur trouvé.",t.length===0&&" La collection users est vide."]})}):i.jsx("div",{className:"overflow-x-auto rounded-md border border-border",children:i.jsxs("table",{className:"min-w-full text-sm",children:[i.jsx("thead",{className:"bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"ID"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Nom"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Email"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Université"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Statut"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"CO₂"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(ge=>i.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[i.jsxs("td",{className:"px-3 py-3 font-mono text-xs",children:[ge.id.slice(0,8),"..."]}),i.jsx("td",{className:"px-3 py-3",children:ge.displayName||"—"}),i.jsx("td",{className:"px-3 py-3",children:ge.email||"—"}),i.jsx("td",{className:"px-3 py-3",children:ge.university||"—"}),i.jsx("td",{className:"px-3 py-3",children:ue(ge)}),i.jsxs("td",{className:"px-3 py-3",children:[ge.co2Saved||0," kg"]}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(ge),E(!0)},children:i.jsx(Fo,{className:"w-4 h-4"})}),!ge.isVerified&&i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>re(ge),title:"Vérifier",children:i.jsx(Ms,{className:"w-4 h-4 text-green-600"})}),ge.blocked?i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(ge),Q(!1)},title:"Débloquer",children:i.jsx(zxe,{className:"w-4 h-4 text-green-600"})}):i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(ge),P(!0)},title:"Bloquer",children:i.jsx(xy,{className:"w-4 h-4 text-red-600"})}),i.jsx(Ge,{size:"sm",variant:"ghost",title:"Changer rôle",onClick:()=>{const ce=prompt("Nouveau rôle (user/admin/moderator):",ge.role||"user");ce&&ve(ge,ce)},children:i.jsx(Zxe,{className:"w-4 h-4"})})]})})]},ge.id))})]})}),i.jsx(ta,{open:C,onOpenChange:P,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Bloquer l'utilisateur"}),i.jsxs(go,{children:[p==null?void 0:p.displayName," (",p==null?void 0:p.email,")"]})]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Raison du blocage"}),i.jsx(Gr,{value:R,onChange:ge=>B(ge.target.value),placeholder:"Violation des conditions, spam, etc."})]})}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>P(!1),children:"Annuler"}),i.jsx(Ge,{variant:"destructive",onClick:()=>Q(!0),children:"Bloquer"})]})]})}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsxs(Ki,{className:"max-w-2xl",children:[i.jsx(oa,{children:i.jsx(ra,{children:"Détail utilisateur"})}),p&&i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"ID:"})," ",p.id]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Statut:"})," ",ue(p)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Nom:"})," ",p.displayName||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Email:"})," ",p.email||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Université:"})," ",p.university||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Rôle:"})," ",p.role||"user"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"CO₂ économisé:"})," ",p.co2Saved||0," kg"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Transactions:"})," ",p.transactionsCount||0]}),p.blocked&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium text-red-600",children:"Raison blocage:"})," ",p.blockedReason||"Non spécifiée"]})]})}),i.jsx(mo,{children:i.jsx(Ge,{onClick:()=>E(!1),children:"Fermer"})})]})})]})},_Me=()=>{var ue,ge,ce,Se;const[t,e]=z.useState([]),[r,n]=z.useState([]),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState(""),[R,B]=z.useState("all"),[V,W]=z.useState("all"),[K,Z]=z.useState(null);z.useEffect(()=>{$()},[]),z.useEffect(()=>{X()},[t,C,R,V]);const $=async()=>{try{const le=ms(jn(rr,"webhook_logs"),eo("timestamp","desc"),la(200)),J=await gs(le);e(J.docs.map(ke=>({id:ke.id,...ke.data()})))}catch(le){console.error("Fetch logs error:",le),Nt.error("Erreur lors du chargement des logs webhook"),e([])}finally{d(!1)}},X=()=>{let le=[...t];if(R!=="all"&&(le=le.filter(J=>J.status===R)),V!=="all"&&(le=le.filter(J=>{var ke,Ze;return((ke=J.event)==null?void 0:ke.includes(V))||((Ze=J.type)==null?void 0:Ze.includes(V))})),C){const J=C.toLowerCase();le=le.filter(ke=>{var Ze,Xe,qe;return((Ze=ke.event)==null?void 0:Ze.toLowerCase().includes(J))||((Xe=ke.orderId)==null?void 0:Xe.toLowerCase().includes(J))||((qe=ke.paymentIntentId)==null?void 0:qe.toLowerCase().includes(J))||ke.id.toLowerCase().includes(J)})}n(le)},Q=async le=>{if(!le.orderId){Nt.error("Pas de commande associée");return}Z(le.id);try{if(!(await fetch(`http://localhost:3001/api/admin/webhooks/${le.id}/reprocess`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:le.orderId,paymentIntentId:le.paymentIntentId,event:le.event})})).ok)throw new Error("Erreur lors du reprocess");Nt.success("Webhook retraité avec succès"),$()}catch(J){console.error("Reprocess error:",J),Nt.error(J.message||"Erreur lors du reprocess")}finally{Z(null)}},re=()=>{const le=[["ID","Event","Status","Order ID","Payment Intent","Retry Count","Processing Time","Error","Timestamp"],...r.map(Xe=>{var qe,$e,st,it;return[Xe.id,Xe.event||Xe.type||"",Xe.status,Xe.orderId||"",Xe.paymentIntentId||"",Xe.retryCount||0,Xe.processingTime||0,Xe.error||"",((it=(st=($e=(qe=Xe.timestamp)==null?void 0:qe.toDate)==null?void 0:$e.call(qe))==null?void 0:st.toISOString)==null?void 0:it.call(st))||""]})].map(Xe=>Xe.join(",")).join(`
`),J=new Blob([le],{type:"text/csv"}),ke=URL.createObjectURL(J),Ze=document.createElement("a");Ze.href=ke,Ze.download=`webhook-logs-${new Date().toISOString().split("T")[0]}.csv`,Ze.click(),Nt.success("Export CSV téléchargé")},ve=le=>{const J={success:"bg-green-500 text-white",failed:"bg-red-500 text-white",pending:"bg-yellow-500 text-white"};return i.jsx(Ir,{className:J[le]||"bg-gray-500 text-white",children:le})},pe=le=>{if(!le)return null;const J=le.includes("succeeded")||le.includes("charge.succeeded")||le.includes("failed")?"bg-blue-500 text-white":le.includes("refunded")?"bg-purple-500 text-white":"bg-gray-500 text-white";return i.jsx(Ir,{className:J,children:le})};return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Webhook Logs"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," log(s) sur ",t.length]})]}),i.jsxs(Ge,{onClick:re,variant:"outline",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(Gr,{placeholder:"Rechercher event, order ID, payment intent...",value:C,onChange:le=>P(le.target.value),className:"max-w-xs"}),i.jsxs(ds,{value:R,onValueChange:B,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous statuts"}),i.jsx(Bt,{value:"success",children:"Succès"}),i.jsx(Bt,{value:"failed",children:"Échoué"}),i.jsx(Bt,{value:"pending",children:"En attente"})]})]}),i.jsxs(ds,{value:V,onValueChange:W,children:[i.jsx(is,{className:"w-48",children:i.jsx(hs,{placeholder:"Type d'événement"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous événements"}),i.jsx(Bt,{value:"payment_intent",children:"Payment Intent"}),i.jsx(Bt,{value:"charge",children:"Charge"}),i.jsx(Bt,{value:"refund",children:"Refund"})]})]}),i.jsxs(Ge,{variant:"outline",onClick:$,children:[i.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Rafraîchir"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"}),i.jsx("div",{className:"text-2xl font-bold",children:t.length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-green-500/20 bg-green-500/10",children:[i.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Succès"}),i.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:t.filter(le=>le.status==="success").length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-red-500/20 bg-red-500/10",children:[i.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:"Échecs"}),i.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:t.filter(le=>le.status==="failed").length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-yellow-500/20 bg-yellow-500/10",children:[i.jsx("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"En attente"}),i.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:t.filter(le=>le.status==="pending").length})]})]}),c?i.jsx("div",{className:"text-left py-",children:"Chargement…"}):r.length===0?i.jsx("div",{className:"text-left py- rounded-md border border-border bg-muted/50",children:i.jsxs("p",{className:"text-muted-foreground",children:["Aucun log webhook trouvé.",t.length===0&&" La collection webhook_logs est vide."]})}):i.jsx("div",{className:"overflow-x-auto rounded-md border border-border",children:i.jsxs("table",{className:"min-w-full text-sm",children:[i.jsx("thead",{className:"bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Timestamp"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Event"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Statut"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Order ID"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Retry"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Temps"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(le=>{var J,ke,Ze,Xe,qe;return i.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[i.jsx("td",{className:"px-3 py-3 text-xs",children:((Xe=(Ze=(ke=(J=le.timestamp)==null?void 0:J.toDate)==null?void 0:ke.call(J))==null?void 0:Ze.toLocaleString)==null?void 0:Xe.call(Ze,"fr-FR"))||"—"}),i.jsx("td",{className:"px-3 py-3",children:pe(le.event||le.type)}),i.jsx("td",{className:"px-3 py-3",children:ve(le.status)}),i.jsx("td",{className:"px-3 py-3 font-mono text-xs",children:((qe=le.orderId)==null?void 0:qe.slice(0,12))||"—"}),i.jsx("td",{className:"px-3 py-3",children:le.retryCount?i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Yd,{className:"w-3 h-3 text-blue-500"}),le.retryCount]}):"0"}),i.jsx("td",{className:"px-3 py-3",children:le.processingTime?`${le.processingTime}ms`:"—"}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(le),E(!0)},children:i.jsx(Fo,{className:"w-4 h-4"})}),le.status==="failed"&&i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>Q(le),disabled:K===le.id,title:"Retraiter",children:i.jsx(mZ,{className:"w-4 h-4 text-blue-600"})})]})})]},le.id)})})]})}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsxs(Ki,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Détail du webhook"}),i.jsxs(go,{children:["ID: ",p==null?void 0:p.id]})]}),p&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Event:"})," ",pe(p.event||p.type)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Statut:"})," ",ve(p.status)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Order ID:"})," ",p.orderId||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Payment Intent:"})," ",p.paymentIntentId||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Retry Count:"})," ",p.retryCount||0]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Processing Time:"})," ",p.processingTime?`${p.processingTime}ms`:"—"]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Timestamp:"})," ",((Se=(ce=(ge=(ue=p.timestamp)==null?void 0:ue.toDate)==null?void 0:ge.call(ue))==null?void 0:ce.toLocaleString)==null?void 0:Se.call(ce,"fr-FR"))||"—"]}),p.error&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium text-red-600",children:"Error:"})," ",i.jsx("span",{className:"text-red-600",children:p.error})]})]}),p.payload&&i.jsxs("div",{children:[i.jsx("div",{className:"font-medium mb-2",children:"Payload:"}),i.jsx("pre",{className:"p-3 bg-muted rounded text-xs overflow-x-auto",children:JSON.stringify(p.payload,null,2)})]}),p.response&&i.jsxs("div",{children:[i.jsx("div",{className:"font-medium mb-2",children:"Response:"}),i.jsx("pre",{className:"p-3 bg-muted rounded text-xs overflow-x-auto",children:JSON.stringify(p.response,null,2)})]})]}),i.jsx(mo,{children:i.jsx(Ge,{onClick:()=>E(!1),children:"Fermer"})})]})})]})},yMe=()=>{var Se,le,J,ke,Ze,Xe,qe,$e,st,it,Mt,ar;const[t,e]=z.useState([]),[r,n]=z.useState([]),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState(!1),[R,B]=z.useState(""),[V,W]=z.useState("all"),[K,Z]=z.useState(null);z.useEffect(()=>{$()},[]),z.useEffect(()=>{X()},[t,R,V]);const $=async()=>{try{const St=ms(jn(rr,"payouts"),eo("requestedAt","desc"),la(100)),Xt=await gs(St);e(Xt.docs.map(dt=>({id:dt.id,...dt.data()})))}catch(St){console.error("Fetch payouts error:",St),Nt.error("Erreur lors du chargement des payouts"),e([])}finally{d(!1)}},X=()=>{let St=[...t];if(V!=="all"&&(St=St.filter(Xt=>Xt.status===V)),R){const Xt=R.toLowerCase();St=St.filter(dt=>{var ft,Wt;return((ft=dt.sellerName)==null?void 0:ft.toLowerCase().includes(Xt))||((Wt=dt.sellerEmail)==null?void 0:Wt.toLowerCase().includes(Xt))||dt.id.toLowerCase().includes(Xt)||dt.sellerId.toLowerCase().includes(Xt)})}n(St)},Q=async()=>{if(p){Z(p.id);try{if(!(await fetch(`http://localhost:3001/api/admin/payouts/${p.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Erreur lors de l'approbation");Nt.success("Payout approuvé et en cours de traitement"),P(!1),$()}catch(St){console.error("Approve payout error:",St),Nt.error(St.message||"Erreur lors de l'approbation")}finally{Z(null)}}},re=async St=>{const Xt=prompt("Raison du rejet:");if(Xt){Z(St.id);try{await Rs(hn(rr,"payouts",St.id),{status:"failed",failureReason:Xt,processedAt:new Date}),Nt.success("Payout rejeté"),$()}catch(dt){console.error("Reject payout error:",dt),Nt.error("Erreur lors du rejet")}finally{Z(null)}}},ve=()=>{const St=[["ID","Seller","Email","Amount","Currency","Status","Order ID","Requested","Processed","Bank"],...r.map(Wt=>{var Wr,jr,Br,on,Zn,ln,dr,Vr,nn,Ln,Je,xt,Ft,or;return[Wt.id,Wt.sellerName||"",Wt.sellerEmail||"",Wt.amount,Wt.currency,Wt.status,Wt.orderId||((Wr=Wt.orderIds)==null?void 0:Wr.join(";"))||"",((Zn=(on=(Br=(jr=Wt.requestedAt)==null?void 0:jr.toDate)==null?void 0:Br.call(jr))==null?void 0:on.toISOString)==null?void 0:Zn.call(on))||((dr=(ln=Wt.requestedAt)==null?void 0:ln.toISOString)==null?void 0:dr.call(ln))||"",((Je=(Ln=(nn=(Vr=Wt.processedAt)==null?void 0:Vr.toDate)==null?void 0:nn.call(Vr))==null?void 0:Ln.toISOString)==null?void 0:Je.call(Ln))||((Ft=(xt=Wt.processedAt)==null?void 0:xt.toISOString)==null?void 0:Ft.call(xt))||"",((or=Wt.bankInfo)==null?void 0:or.bankName)||""]})].map(Wt=>Wt.join(",")).join(`
`),Xt=new Blob([St],{type:"text/csv"}),dt=URL.createObjectURL(Xt),ft=document.createElement("a");ft.href=dt,ft.download=`payouts-${new Date().toISOString().split("T")[0]}.csv`,ft.click(),Nt.success("Export CSV téléchargé")},pe=St=>{const Xt={pending:"bg-yellow-500 text-white",processing:"bg-blue-500 text-white",completed:"bg-green-500 text-white",failed:"bg-red-500 text-white"};return i.jsx(Ir,{className:Xt[St]||"bg-gray-500 text-white",children:St})},ue=t.filter(St=>St.status==="pending").reduce((St,Xt)=>St+Xt.amount,0),ge=t.filter(St=>St.status==="processing").reduce((St,Xt)=>St+Xt.amount,0),ce=t.filter(St=>St.status==="completed").reduce((St,Xt)=>St+Xt.amount,0);return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Gestion des payouts vendeurs"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," payout(s) sur ",t.length]})]}),i.jsxs(Ge,{onClick:ve,variant:"outline",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total payouts"}),i.jsx("div",{className:"text-2xl font-bold",children:t.length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-yellow-500/20 bg-yellow-500/10",children:[i.jsx("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"En attente"}),i.jsxs("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[ue.toFixed(2)," €"]}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.filter(St=>St.status==="pending").length," payout(s)"]})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-blue-500/20 bg-blue-500/10",children:[i.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"En traitement"}),i.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[ge.toFixed(2)," €"]}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.filter(St=>St.status==="processing").length," payout(s)"]})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-green-500/20 bg-green-500/10",children:[i.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Complétés"}),i.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[ce.toFixed(2)," €"]}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.filter(St=>St.status==="completed").length," payout(s)"]})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(Gr,{placeholder:"Rechercher vendeur, email, ID...",value:R,onChange:St=>B(St.target.value),className:"max-w-xs"}),i.jsxs(ds,{value:V,onValueChange:W,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous statuts"}),i.jsx(Bt,{value:"pending",children:"En attente"}),i.jsx(Bt,{value:"processing",children:"En traitement"}),i.jsx(Bt,{value:"completed",children:"Complété"}),i.jsx(Bt,{value:"failed",children:"Échoué"})]})]}),i.jsxs(Ge,{variant:"outline",onClick:$,children:[i.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Rafraîchir"]})]}),c?i.jsx("div",{className:"text-left py-",children:"Chargement…"}):r.length===0?i.jsx("div",{className:"text-left py- rounded-md border border-border bg-muted/50",children:i.jsxs("p",{className:"text-muted-foreground",children:["Aucun payout trouvé.",t.length===0&&" La collection payouts est vide."]})}):i.jsx("div",{className:"overflow-x-auto rounded-md border border-border",children:i.jsxs("table",{className:"min-w-full text-sm",children:[i.jsx("thead",{className:"bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Vendeur"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Email"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Montant"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Statut"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Demandé le"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(St=>{var Xt,dt,ft,Wt,Wr,jr;return i.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[i.jsx("td",{className:"px-3 py-3",children:St.sellerName||"—"}),i.jsx("td",{className:"px-3 py-3 text-xs",children:St.sellerEmail||"—"}),i.jsxs("td",{className:"px-3 py-3 text-right font-medium",children:[St.amount.toFixed(2)," ",St.currency]}),i.jsx("td",{className:"px-3 py-3",children:pe(St.status)}),i.jsx("td",{className:"px-3 py-3 text-xs",children:((Wt=(ft=(dt=(Xt=St.requestedAt)==null?void 0:Xt.toDate)==null?void 0:dt.call(Xt))==null?void 0:ft.toLocaleDateString)==null?void 0:Wt.call(ft,"fr-FR"))||((jr=(Wr=St.requestedAt)==null?void 0:Wr.toLocaleDateString)==null?void 0:jr.call(Wr,"fr-FR"))||"—"}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(St),E(!0)},children:i.jsx(Fo,{className:"w-4 h-4"})}),St.status==="pending"&&i.jsxs(i.Fragment,{children:[i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(St),P(!0)},disabled:K===St.id,title:"Approuver",children:i.jsx(qs,{className:"w-4 h-4 text-green-600"})}),i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>re(St),disabled:K===St.id,title:"Rejeter",children:i.jsx(fo,{className:"w-4 h-4 text-red-600"})})]})]})})]},St.id)})})]})}),i.jsx(ta,{open:C,onOpenChange:P,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Approuver le payout"}),i.jsxs(go,{children:["Vendeur: ",p==null?void 0:p.sellerName," (",p==null?void 0:p.sellerEmail,")"]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"p-4 bg-muted rounded-md",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm font-medium",children:"Montant:"}),i.jsxs("span",{className:"text-2xl font-bold",children:[p==null?void 0:p.amount.toFixed(2)," ",p==null?void 0:p.currency]})]}),(p==null?void 0:p.bankInfo)&&i.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["Banque: ",p.bankInfo.bankName," (••••",p.bankInfo.last4,")"]})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Le payout sera traité via Stripe Connect et versé sur le compte bancaire du vendeur."})]}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>P(!1),children:"Annuler"}),i.jsxs(Ge,{onClick:Q,disabled:K===(p==null?void 0:p.id),children:[i.jsx(UC,{className:"w-4 h-4 mr-2"}),"Approuver le payout"]})]})]})}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsxs(Ki,{className:"max-w-2xl",children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Détail du payout"}),i.jsxs(go,{children:["ID: ",p==null?void 0:p.id]})]}),p&&i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Vendeur:"})," ",p.sellerName||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Email:"})," ",p.sellerEmail||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Statut:"})," ",pe(p.status)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Montant:"})," ",p.amount.toFixed(2)," ",p.currency]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Seller ID:"})," ",p.sellerId]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Order ID:"})," ",p.orderId||"—"]}),p.stripeAccountId&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Stripe Account:"})," ",p.stripeAccountId]}),p.stripePayoutId&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Stripe Payout ID:"})," ",p.stripePayoutId]}),p.bankInfo&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Compte bancaire:"})," ",p.bankInfo.bankName," (••••",p.bankInfo.last4,")"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Demandé le:"})," ",((ke=(J=(le=(Se=p.requestedAt)==null?void 0:Se.toDate)==null?void 0:le.call(Se))==null?void 0:J.toLocaleString)==null?void 0:ke.call(J,"fr-FR"))||((Xe=(Ze=p.requestedAt)==null?void 0:Ze.toLocaleString)==null?void 0:Xe.call(Ze,"fr-FR"))||"—"]}),p.processedAt&&i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Traité le:"})," ",((it=(st=($e=(qe=p.processedAt)==null?void 0:qe.toDate)==null?void 0:$e.call(qe))==null?void 0:st.toLocaleString)==null?void 0:it.call(st,"fr-FR"))||((ar=(Mt=p.processedAt)==null?void 0:Mt.toLocaleString)==null?void 0:ar.call(Mt,"fr-FR"))||"—"]}),p.failureReason&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium text-red-600",children:"Raison d'échec:"})," ",i.jsx("span",{className:"text-red-600",children:p.failureReason})]})]})}),i.jsx(mo,{children:i.jsx(Ge,{onClick:()=>E(!1),children:"Fermer"})})]})})]})},xMe=()=>{const[t,e]=z.useState([]),[r,n]=z.useState([]),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState(!1),[R,B]=z.useState([]),[V,W]=z.useState(""),[K,Z]=z.useState("all");z.useEffect(()=>{$()},[]),z.useEffect(()=>{X()},[t,V,K]);const $=async()=>{try{const le=ms(jn(rr,"conversations"),eo("updatedAt","desc"),la(100)),J=await gs(le),ke=await Promise.all(J.docs.map(async Ze=>{const Xe=Ze.data(),qe=await gs(jn(rr,"conversations",Ze.id,"messages")),$e=Array.isArray(Xe.participants)?Xe.participants:[];return{id:Ze.id,participants:$e,participantDetails:Xe.participantDetails||{},listingId:Xe.listingId||"",listingTitle:Xe.listingTitle||"",listingPrice:Xe.listingPrice||0,lastMessage:Xe.lastMessage,unreadCount:Xe.unreadCount||{},status:Xe.status||"active",blockedBy:Array.isArray(Xe.blockedBy)?Xe.blockedBy:[],createdAt:Xe.createdAt,updatedAt:Xe.updatedAt,messageCount:qe.size}}));e(ke)}catch(le){console.error("Fetch conversations error:",le),Nt.error("Erreur lors du chargement des conversations"),e([])}finally{d(!1)}},X=()=>{let le=[...t];if(K!=="all"&&(le=le.filter(J=>J.status===K)),V){const J=V.toLowerCase();le=le.filter(ke=>{var Ze;return((Ze=ke.listingTitle)==null?void 0:Ze.toLowerCase().includes(J))||ke.id.toLowerCase().includes(J)||Object.values(ke.participantDetails).some(Xe=>{var qe;return(qe=Xe.name)==null?void 0:qe.toLowerCase().includes(J)})})}n(le)},Q=async le=>{try{const ke=(await gs(ms(jn(rr,"conversations",le,"messages"),eo("sentAt","asc")))).docs.map(Ze=>({id:Ze.id,...Ze.data()}));B(ke)}catch(J){console.error("Load messages error:",J),Nt.error("Erreur lors du chargement des messages")}},re=async le=>{a(le),await Q(le.id),E(!0)},ve=async()=>{if(p)try{const J=(await gs(jn(rr,"conversations",p.id,"messages"))).docs.map(ke=>cd(ke.ref));await Promise.all(J),await cd(hn(rr,"conversations",p.id)),Nt.success("Conversation supprimée"),P(!1),$()}catch(le){console.error("Delete error:",le),Nt.error("Erreur lors de la suppression")}},pe=async le=>{try{await Rs(hn(rr,"conversations",le.id),{status:"blocked",updatedAt:new Date}),Nt.success("Conversation bloquée"),$()}catch(J){console.error("Block error:",J),Nt.error("Erreur lors du blocage")}},ue=async le=>{try{await Rs(hn(rr,"conversations",le.id),{status:"active",blockedBy:[],updatedAt:new Date}),Nt.success("Conversation débloquée"),$()}catch(J){console.error("Unblock error:",J),Nt.error("Erreur lors du déblocage")}},ge=()=>{const le=[["ID","Listing","Participants","Messages","Status","Last Message","Created"],...r.map(Xe=>{var qe,$e,st,it,Mt;return[Xe.id,Xe.listingTitle||"",Xe.participants.map(ar=>{var St;return((St=Xe.participantDetails[ar])==null?void 0:St.name)||ar}).join(" & "),Xe.messageCount||0,Xe.status,((qe=Xe.lastMessage)==null?void 0:qe.text)||"",((Mt=(it=(st=($e=Xe.createdAt)==null?void 0:$e.toDate)==null?void 0:st.call($e))==null?void 0:it.toISOString)==null?void 0:Mt.call(it))||""]})].map(Xe=>Xe.join(",")).join(`
`),J=new Blob([le],{type:"text/csv"}),ke=URL.createObjectURL(J),Ze=document.createElement("a");Ze.href=ke,Ze.download=`conversations-${new Date().toISOString().split("T")[0]}.csv`,Ze.click(),Nt.success("Export CSV téléchargé")},ce=le=>{const J={active:"bg-green-500 text-white",archived:"bg-gray-500 text-white",blocked:"bg-red-500 text-white"};return i.jsx(Ir,{className:J[le]||"bg-gray-500 text-white",children:le})},Se=le=>!le.participants||!Array.isArray(le.participants)?"Participants inconnus":le.participants.map(J=>{var ke;return((ke=le.participantDetails[J])==null?void 0:ke.name)||"Inconnu"}).join(" & ");return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Gestion des Messages"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," conversation(s) sur ",t.length]})]}),i.jsxs(Ge,{onClick:ge,variant:"outline",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"}),i.jsx("div",{className:"text-2xl font-bold",children:t.length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-green-500/20 bg-green-500/10",children:[i.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Actives"}),i.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:t.filter(le=>le.status==="active").length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-red-500/20 bg-red-500/10",children:[i.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:"Bloquées"}),i.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:t.filter(le=>le.status==="blocked").length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-blue-500/20 bg-blue-500/10",children:[i.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Messages totaux"}),i.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:t.reduce((le,J)=>le+(J.messageCount||0),0)})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(Gr,{placeholder:"Rechercher annonce, participants...",value:V,onChange:le=>W(le.target.value),className:"max-w-xs"}),i.jsxs(ds,{value:K,onValueChange:Z,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous"}),i.jsx(Bt,{value:"active",children:"Actives"}),i.jsx(Bt,{value:"blocked",children:"Bloquées"}),i.jsx(Bt,{value:"archived",children:"Archivées"})]})]}),i.jsxs(Ge,{variant:"outline",onClick:$,children:[i.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Rafraîchir"]})]}),c?i.jsx("div",{className:"text-left py-",children:"Chargement…"}):r.length===0?i.jsx("div",{className:"text-left py- rounded-md border border-border bg-muted/50",children:i.jsxs("p",{className:"text-muted-foreground",children:["Aucune conversation trouvée.",t.length===0&&" La collection conversations est vide."]})}):i.jsx("div",{className:"overflow-x-auto rounded-md border border-border",children:i.jsxs("table",{className:"min-w-full text-sm",children:[i.jsx("thead",{className:"bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Annonce"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Participants"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Messages"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Statut"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Dernier message"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(le=>{var J;return i.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:le.listingTitle}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:[le.listingPrice," €"]})]})}),i.jsx("td",{className:"px-3 py-3",children:Se(le)}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(iI,{className:"w-4 h-4"}),le.messageCount||0]})}),i.jsx("td",{className:"px-3 py-3",children:ce(le.status)}),i.jsx("td",{className:"px-3 py-3 max-w-xs truncate",children:((J=le.lastMessage)==null?void 0:J.text)||"—"}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>re(le),children:i.jsx(Fo,{className:"w-4 h-4"})}),le.status==="blocked"?i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>ue(le),title:"Débloquer",children:i.jsx(va,{className:"w-4 h-4 text-green-600"})}):i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>pe(le),title:"Bloquer",children:i.jsx(va,{className:"w-4 h-4 text-red-600"})}),i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(le),P(!0)},title:"Supprimer",children:i.jsx(nd,{className:"w-4 h-4 text-red-600"})})]})})]},le.id)})})]})}),i.jsx(ta,{open:C,onOpenChange:P,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Supprimer la conversation"}),i.jsx(go,{children:p==null?void 0:p.listingTitle})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Cette action est irréversible. Tous les messages seront définitivement supprimés."}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>P(!1),children:"Annuler"}),i.jsx(Ge,{variant:"destructive",onClick:ve,children:"Supprimer"})]})]})}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsxs(Ki,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Détails de la conversation"}),i.jsxs(go,{children:["ID: ",p==null?void 0:p.id]})]}),p&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Annonce:"})," ",p.listingTitle]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Prix:"})," ",p.listingPrice," €"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Statut:"})," ",ce(p.status)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Messages:"})," ",p.messageCount||0]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Participants:"}),i.jsx("div",{className:"mt-2 space-y-2",children:Array.isArray(p.participants)&&p.participants.map(le=>{const J=p.participantDetails[le];return i.jsx("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:(J==null?void 0:J.name)||"Inconnu"}),i.jsx("div",{className:"text-xs text-muted-foreground",children:J==null?void 0:J.university})]})},le)})})]})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium mb-2",children:["Messages (",R.length,"):"]}),i.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2 p-3 bg-muted rounded",children:R.map((le,J)=>{var ke,Ze,Xe,qe;return i.jsxs("div",{className:"p-2 bg-card rounded text-xs",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("span",{className:"font-medium",children:le.senderName}),i.jsx("span",{className:"text-muted-foreground",children:((qe=(Xe=(Ze=(ke=le.sentAt)==null?void 0:ke.toDate)==null?void 0:Ze.call(ke))==null?void 0:Xe.toLocaleString)==null?void 0:qe.call(Xe,"fr-FR"))||"—"})]}),i.jsx("p",{className:"text-foreground",children:le.text})]},J)})})]})]}),i.jsx(mo,{children:i.jsx(Ge,{onClick:()=>E(!1),children:"Fermer"})})]})})]})},vMe=()=>{var Se,le,J,ke,Ze,Xe,qe,$e;const[t,e]=z.useState([]),[r,n]=z.useState([]),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState(!1),[R,B]=z.useState("dismiss"),[V,W]=z.useState(""),[K,Z]=z.useState(""),[$,X]=z.useState("all");z.useEffect(()=>{Q()},[]),z.useEffect(()=>{re()},[t,K,$]);const Q=async()=>{try{const st=ms(jn(rr,"reports"),eo("createdAt","desc"),la(200)),it=await gs(st),Mt=await Promise.all(it.docs.map(async ar=>{const St=ar.data();let Xt="Inconnu",dt="Inconnu";try{const ft=await Xa(hn(rr,"users",St.reporterId));ft.exists()&&(Xt=ft.data().displayName||"Inconnu")}catch{}try{const ft=await Xa(hn(rr,"users",St.reportedUserId));ft.exists()&&(dt=ft.data().displayName||"Inconnu")}catch{}return{id:ar.id,reporterId:St.reporterId||"",reportedUserId:St.reportedUserId||"",conversationId:St.conversationId||"",reason:St.reason||"",description:St.description||"",status:St.status||"pending",createdAt:St.createdAt,reviewedAt:St.reviewedAt,reviewedBy:St.reviewedBy,action:St.action,reporterName:Xt,reportedUserName:dt}}));e(Mt)}catch(st){console.error("Fetch reports error:",st),Nt.error("Erreur lors du chargement des signalements"),e([])}finally{d(!1)}},re=()=>{let st=[...t];if($!=="all"&&(st=st.filter(it=>it.status===$)),K){const it=K.toLowerCase();st=st.filter(Mt=>{var ar,St,Xt,dt;return((ar=Mt.reason)==null?void 0:ar.toLowerCase().includes(it))||((St=Mt.description)==null?void 0:St.toLowerCase().includes(it))||((Xt=Mt.reporterName)==null?void 0:Xt.toLowerCase().includes(it))||((dt=Mt.reportedUserName)==null?void 0:dt.toLowerCase().includes(it))||Mt.id.toLowerCase().includes(it)})}n(st)},ve=async()=>{if(p)try{const st={status:R==="dismiss"?"rejected":"resolved",reviewedAt:new Date,action:R,actionNote:V||null};await Rs(hn(rr,"reports",p.id),st),R==="block"&&(await Rs(hn(rr,"users",p.reportedUserId),{blocked:!0,blockedReason:`Signalement: ${p.reason}`,blockedAt:new Date}),p.conversationId&&await Rs(hn(rr,"conversations",p.conversationId),{status:"blocked",blockedBy:[p.reportedUserId]})),Nt.success(R==="block"?"Utilisateur bloqué":R==="warn"?"Avertissement enregistré":"Signalement rejeté"),P(!1),W(""),Q()}catch(st){console.error("Process report error:",st),Nt.error("Erreur lors du traitement")}},pe=async st=>{if(confirm("Supprimer définitivement ce signalement ?"))try{await cd(hn(rr,"reports",st)),Nt.success("Signalement supprimé"),Q()}catch(it){console.error("Delete error:",it),Nt.error("Erreur lors de la suppression")}},ue=()=>{const st=[["ID","Reporter","Reported User","Reason","Description","Status","Created","Action"],...r.map(St=>{var Xt,dt,ft,Wt;return[St.id,St.reporterName||"",St.reportedUserName||"",St.reason,St.description,St.status,((Wt=(ft=(dt=(Xt=St.createdAt)==null?void 0:Xt.toDate)==null?void 0:dt.call(Xt))==null?void 0:ft.toISOString)==null?void 0:Wt.call(ft))||"",St.action||""]})].map(St=>St.join(",")).join(`
`),it=new Blob([st],{type:"text/csv"}),Mt=URL.createObjectURL(it),ar=document.createElement("a");ar.href=Mt,ar.download=`reports-${new Date().toISOString().split("T")[0]}.csv`,ar.click(),Nt.success("Export CSV téléchargé")},ge=st=>{const it={pending:"bg-yellow-500 text-white",reviewed:"bg-blue-500 text-white",resolved:"bg-green-500 text-white",rejected:"bg-gray-500 text-white"};return i.jsx(Ir,{className:it[st]||"bg-gray-500 text-white",children:st})},ce=st=>{const it={spam:"bg-blue-500 text-white",harassment:"bg-red-500 text-white",inappropriate:"bg-purple-500 text-white",scam:"bg-red-600 text-white",fake:"bg-yellow-600 text-white",other:"bg-gray-600 text-white"};return i.jsx(Ir,{className:it[st.toLowerCase()]||"bg-gray-600 text-white",children:st})};return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Gestion des Signalements"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.length," signalement(s) sur ",t.length]})]}),i.jsxs(Ge,{onClick:ue,variant:"outline",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"}),i.jsx("div",{className:"text-2xl font-bold",children:t.length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-yellow-500/20 bg-yellow-500/10",children:[i.jsx("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"En attente"}),i.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:t.filter(st=>st.status==="pending").length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-green-500/20 bg-green-500/10",children:[i.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Résolus"}),i.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:t.filter(st=>st.status==="resolved").length})]}),i.jsxs("div",{className:"p-4 rounded-lg border border-gray-500/20 bg-gray-500/10",children:[i.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Rejetés"}),i.jsx("div",{className:"text-2xl font-bold text-gray-600 dark:text-gray-400",children:t.filter(st=>st.status==="rejected").length})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(Gr,{placeholder:"Rechercher raison, description, utilisateur...",value:K,onChange:st=>Z(st.target.value),className:"max-w-xs"}),i.jsxs(ds,{value:$,onValueChange:X,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous"}),i.jsx(Bt,{value:"pending",children:"En attente"}),i.jsx(Bt,{value:"reviewed",children:"Examinés"}),i.jsx(Bt,{value:"resolved",children:"Résolus"}),i.jsx(Bt,{value:"rejected",children:"Rejetés"})]})]}),i.jsxs(Ge,{variant:"outline",onClick:Q,children:[i.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Rafraîchir"]})]}),c?i.jsx("div",{className:"text-left py-",children:"Chargement…"}):r.length===0?i.jsx("div",{className:"text-left py- rounded-md border border-border bg-muted/50",children:i.jsxs("p",{className:"text-muted-foreground",children:["Aucun signalement trouvé.",t.length===0&&" La collection reports est vide."]})}):i.jsx("div",{className:"overflow-x-auto rounded-md border border-border",children:i.jsxs("table",{className:"min-w-full text-sm",children:[i.jsx("thead",{className:"bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Signalé par"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Utilisateur signalé"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Raison"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Statut"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Date"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(st=>{var it,Mt,ar,St;return i.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[i.jsx("td",{className:"px-3 py-3",children:st.reporterName}),i.jsx("td",{className:"px-3 py-3 font-medium",children:st.reportedUserName}),i.jsx("td",{className:"px-3 py-3",children:ce(st.reason)}),i.jsx("td",{className:"px-3 py-3",children:ge(st.status)}),i.jsx("td",{className:"px-3 py-3 text-xs",children:((St=(ar=(Mt=(it=st.createdAt)==null?void 0:it.toDate)==null?void 0:Mt.call(it))==null?void 0:ar.toLocaleDateString)==null?void 0:St.call(ar,"fr-FR"))||"—"}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(st),E(!0)},children:i.jsx(Fo,{className:"w-4 h-4"})}),st.status==="pending"&&i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(st),P(!0)},title:"Traiter",children:i.jsx(qs,{className:"w-4 h-4 text-blue-600"})}),i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>pe(st.id),title:"Supprimer",children:i.jsx(fo,{className:"w-4 h-4 text-red-600"})})]})})]},st.id)})})]})}),i.jsx(ta,{open:C,onOpenChange:P,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Traiter le signalement"}),i.jsxs(go,{children:["Signalement contre ",p==null?void 0:p.reportedUserName]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Action"}),i.jsxs(ds,{value:R,onValueChange:st=>B(st),children:[i.jsx(is,{children:i.jsx(hs,{})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"dismiss",children:"Rejeter (pas de violation)"}),i.jsx(Bt,{value:"warn",children:"Avertir l'utilisateur"}),i.jsx(Bt,{value:"block",children:"Bloquer l'utilisateur"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Note (optionnelle)"}),i.jsx(Gr,{value:V,onChange:st=>W(st.target.value),placeholder:"Détails de l'action prise..."})]})]}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>P(!1),children:"Annuler"}),i.jsx(Ge,{onClick:ve,children:"Confirmer"})]})]})}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsxs(Ki,{className:"max-w-2xl",children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Détails du signalement"}),i.jsxs(go,{children:["ID: ",p==null?void 0:p.id]})]}),p&&i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Signalé par:"})," ",p.reporterName]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Utilisateur signalé:"})," ",p.reportedUserName]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Raison:"})," ",ce(p.reason)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Statut:"})," ",ge(p.status)]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Description:"}),i.jsx("p",{className:"mt-1 p-2 bg-muted rounded",children:p.description})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Date:"})," ",((ke=(J=(le=(Se=p.createdAt)==null?void 0:Se.toDate)==null?void 0:le.call(Se))==null?void 0:J.toLocaleString)==null?void 0:ke.call(J,"fr-FR"))||"—"]}),p.reviewedAt&&i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Traité le:"})," ",(($e=(qe=(Xe=(Ze=p.reviewedAt)==null?void 0:Ze.toDate)==null?void 0:Xe.call(Ze))==null?void 0:qe.toLocaleString)==null?void 0:$e.call(qe,"fr-FR"))||"—"]}),p.action&&i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Action prise:"})," ",i.jsx(Ir,{children:p.action})]})]})}),i.jsx(mo,{children:i.jsx(Ge,{onClick:()=>E(!1),children:"Fermer"})})]})})]})},wMe=()=>{var re,ve,pe,ue;const[t,e]=z.useState([]),[r,n]=z.useState([]),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(!1),[C,P]=z.useState(""),[R,B]=z.useState("all"),[V,W]=z.useState("all");z.useEffect(()=>{K()},[]),z.useEffect(()=>{Z()},[t,C,R,V]);const K=async()=>{try{const ge=ms(jn(rr,"audit_logs"),eo("timestamp","desc"),la(200)),ce=await gs(ge);e(ce.docs.map(Se=>({id:Se.id,...Se.data()})))}catch(ge){console.error("Fetch audit logs error:",ge),Nt.error("Erreur lors du chargement des logs audit"),e([])}finally{d(!1)}},Z=()=>{let ge=[...t];if(R!=="all"&&(ge=ge.filter(ce=>ce.action.includes(R))),V!=="all"&&(ge=ge.filter(ce=>ce.entity===V)),C){const ce=C.toLowerCase();ge=ge.filter(Se=>{var le,J,ke;return((le=Se.action)==null?void 0:le.toLowerCase().includes(ce))||((J=Se.adminEmail)==null?void 0:J.toLowerCase().includes(ce))||((ke=Se.adminName)==null?void 0:ke.toLowerCase().includes(ce))||Se.entityId.toLowerCase().includes(ce)})}n(ge)},$=()=>{const ge=[["Timestamp","Admin","Email","Action","Entity","Entity ID","IP Address"],...r.map(J=>{var ke,Ze,Xe,qe;return[((qe=(Xe=(Ze=(ke=J.timestamp)==null?void 0:ke.toDate)==null?void 0:Ze.call(ke))==null?void 0:Xe.toISOString)==null?void 0:qe.call(Xe))||"",J.adminName||"",J.adminEmail||"",J.action,J.entity,J.entityId,J.ipAddress||""]})].map(J=>J.join(",")).join(`
`),ce=new Blob([ge],{type:"text/csv"}),Se=URL.createObjectURL(ce),le=document.createElement("a");le.href=Se,le.download=`audit-trail-${new Date().toISOString().split("T")[0]}.csv`,le.click(),Nt.success("Export CSV téléchargé")},X=ge=>ge.includes("block")||ge.includes("remove")||ge.includes("delete")||ge.includes("reject")?i.jsx(Ir,{className:"bg-red-500 text-white",children:ge}):ge.includes("approve")||ge.includes("verify")||ge.includes("unblock")?i.jsx(Ir,{className:"bg-green-500 text-white",children:ge}):ge.includes("refund")||ge.includes("replay")||ge.includes("reprocess")?i.jsx(Ir,{className:"bg-blue-500 text-white",children:ge}):i.jsx(Ir,{className:"bg-gray-500 text-white",children:ge}),Q=ge=>({user:i.jsx(Hl,{className:"w-4 h-4"}),order:i.jsx(Ms,{className:"w-4 h-4"}),listing:i.jsx(Ms,{className:"w-4 h-4"}),payout:i.jsx(Ms,{className:"w-4 h-4"}),webhook:i.jsx(Ms,{className:"w-4 h-4"})})[ge]||i.jsx(Ms,{className:"w-4 h-4"});return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Audit Trail"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Historique des actions administratives - ",r.length," entrée(s)"]})]}),i.jsxs(Ge,{onClick:$,variant:"outline",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsx(Gr,{placeholder:"Rechercher action, admin, entity...",value:C,onChange:ge=>P(ge.target.value),className:"max-w-xs"}),i.jsxs(ds,{value:R,onValueChange:B,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Action"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Toutes actions"}),i.jsx(Bt,{value:"block",children:"Block/Unblock"}),i.jsx(Bt,{value:"approve",children:"Approve"}),i.jsx(Bt,{value:"refund",children:"Refund"}),i.jsx(Bt,{value:"delete",children:"Delete"}),i.jsx(Bt,{value:"verify",children:"Verify"})]})]}),i.jsxs(ds,{value:V,onValueChange:W,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Entity"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Toutes entités"}),i.jsx(Bt,{value:"user",children:"User"}),i.jsx(Bt,{value:"order",children:"Order"}),i.jsx(Bt,{value:"listing",children:"Listing"}),i.jsx(Bt,{value:"payout",children:"Payout"}),i.jsx(Bt,{value:"webhook",children:"Webhook"})]})]}),i.jsxs(Ge,{variant:"outline",onClick:K,children:[i.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Rafraîchir"]})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 text-sm",children:["user","order","listing","payout","webhook"].map(ge=>i.jsxs("div",{className:"p-3 rounded-md border border-border bg-card",children:[i.jsxs("div",{className:"text-xs text-muted-foreground capitalize",children:[ge,"s"]}),i.jsx("div",{className:"text-xl font-bold",children:t.filter(ce=>ce.entity===ge).length})]},ge))}),c?i.jsx("div",{className:"text-left py-",children:"Chargement…"}):r.length===0?i.jsx("div",{className:"text-left py- rounded-md border border-border bg-muted/50",children:i.jsxs("p",{className:"text-muted-foreground",children:["Aucun log audit trouvé.",t.length===0&&" La collection audit_logs est vide."]})}):i.jsx("div",{className:"overflow-x-auto rounded-md border border-border",children:i.jsxs("table",{className:"min-w-full text-sm",children:[i.jsx("thead",{className:"bg-muted/50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Timestamp"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Admin"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Action"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Entity"}),i.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Entity ID"}),i.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),i.jsx("tbody",{children:r.map(ge=>{var ce,Se,le,J;return i.jsxs("tr",{className:"border-t border-border hover:bg-muted/50",children:[i.jsx("td",{className:"px-3 py-3 text-xs",children:((J=(le=(Se=(ce=ge.timestamp)==null?void 0:ce.toDate)==null?void 0:Se.call(ce))==null?void 0:le.toLocaleString)==null?void 0:J.call(le,"fr-FR"))||"—"}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:ge.adminName||"Admin"}),i.jsx("div",{className:"text-xs text-muted-foreground",children:ge.adminEmail||"—"})]})}),i.jsx("td",{className:"px-3 py-3",children:X(ge.action)}),i.jsx("td",{className:"px-3 py-3",children:i.jsxs("div",{className:"flex items-center gap-2",children:[Q(ge.entity),i.jsx("span",{className:"capitalize",children:ge.entity})]})}),i.jsxs("td",{className:"px-3 py-3 font-mono text-xs",children:[ge.entityId.slice(0,12),"..."]}),i.jsx("td",{className:"px-3 py-3",children:i.jsx("div",{className:"flex justify-end",children:i.jsx(Ge,{size:"sm",variant:"ghost",onClick:()=>{a(ge),E(!0)},children:i.jsx(Fo,{className:"w-4 h-4"})})})})]},ge.id)})})]})}),i.jsx(ta,{open:w,onOpenChange:E,children:i.jsxs(Ki,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Détail de l'action"}),i.jsxs(go,{children:["Audit Log ID: ",p==null?void 0:p.id]})]}),p&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Admin:"})," ",p.adminName||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Email:"})," ",p.adminEmail||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Action:"})," ",X(p.action)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Entity:"})," ",i.jsx("span",{className:"capitalize",children:p.entity})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx("span",{className:"font-medium",children:"Entity ID:"})," ",p.entityId]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"IP Address:"})," ",p.ipAddress||"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Timestamp:"})," ",((ue=(pe=(ve=(re=p.timestamp)==null?void 0:re.toDate)==null?void 0:ve.call(re))==null?void 0:pe.toLocaleString)==null?void 0:ue.call(pe,"fr-FR"))||"—"]})]}),p.details&&i.jsxs("div",{children:[i.jsx("div",{className:"font-medium mb-2",children:"Détails:"}),i.jsx("pre",{className:"p-3 bg-muted rounded text-xs overflow-x-auto",children:JSON.stringify(p.details,null,2)})]}),p.before&&i.jsxs("div",{children:[i.jsx("div",{className:"font-medium mb-2",children:"État avant:"}),i.jsx("pre",{className:"p-3 bg-muted rounded text-xs overflow-x-auto",children:JSON.stringify(p.before,null,2)})]}),p.after&&i.jsxs("div",{children:[i.jsx("div",{className:"font-medium mb-2",children:"État après:"}),i.jsx("pre",{className:"p-3 bg-muted rounded text-xs overflow-x-auto",children:JSON.stringify(p.after,null,2)})]})]}),i.jsx(mo,{children:i.jsx(Ge,{onClick:()=>E(!1),children:"Fermer"})})]})})]})};function bMe({isOpen:t,onClose:e,documentUrl:r,documentName:n}){const c=()=>{const d=document.createElement("a");d.href=r,d.download=n,d.click()};return t?i.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center",children:i.jsxs("div",{className:"bg-background w-full max-w-5xl h-[90vh] flex flex-col rounded-lg overflow-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[i.jsx("h2",{className:"text-lg font-semibold truncate flex-1",children:n}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ge,{variant:"ghost",size:"sm",onClick:c,className:"h-8 w-8 p-0",title:"Télécharger",children:i.jsx(to,{className:"w-4 h-4"})}),i.jsx(Ge,{variant:"ghost",size:"sm",onClick:e,className:"h-8 w-8 p-0",title:"Fermer",children:i.jsx(of,{className:"w-4 h-4"})})]})]}),i.jsx("div",{className:"flex-1 overflow-auto bg-muted/30 flex items-start justify-center p-4",children:i.jsx("iframe",{src:`https://docs.google.com/viewer?url=${encodeURIComponent(r)}&embedded=true`,className:"w-full h-full min-h-[600px] border-0",title:n})})]})}):null}const SMe=()=>{const{currentUser:t}=$i(),[e,r]=z.useState([]),[n,c]=z.useState(!0),[d,p]=z.useState(null),[a,w]=z.useState(!1),[E,C]=z.useState(!1),[P,R]=z.useState(!1),[B,V]=z.useState(!1),[W,K]=z.useState([]),[Z,$]=z.useState(0),[X,Q]=z.useState(!1),[re,ve]=z.useState(""),[pe,ue]=z.useState(""),[ge,ce]=z.useState(""),[Se,le]=z.useState(""),[J,ke]=z.useState("all");z.useEffect(()=>{if(B&&W[Z]){const ft=W[Z],Wt=ft.filename||ft.fileName||"Document";!Wt.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp)$/)&&!X&&(ve(ft.url),ue(Wt),Q(!0),V(!1))}},[B,Z,W,X]),z.useEffect(()=>{const ft=$d.subscribeToAllRequests(J==="all"?void 0:J,Wt=>{r(Wt),c(!1)});return()=>{ft&&ft()}},[J]);const Ze=async()=>{if(!(!d||!t))try{await $d.approveVerification(d.id,t.uid),Nt.success("Demande approuvée avec succès"),w(!1),p(null)}catch(ft){console.error("Erreur lors de l'approbation:",ft),Nt.error("Erreur lors de l'approbation")}},Xe=async()=>{if(!(!d||!t||!ge))try{await $d.rejectVerification(d.id,ge,t.uid),Nt.success("Demande rejetée"),C(!1),p(null),ce("")}catch(ft){console.error("Erreur lors du rejet:",ft),Nt.error("Erreur lors du rejet")}},qe=async ft=>{(ft.status==="documents_submitted"||ft.status==="pending")&&await $d.markAsUnderReview(ft.id,t==null?void 0:t.uid),p(ft),w(!0)},$e=ft=>{p(ft),C(!0)},st=ft=>{p(ft),R(!0)},it=async(ft,Wt)=>{(ft.status==="documents_submitted"||ft.status==="pending")&&await $d.markAsUnderReview(ft.id,t==null?void 0:t.uid),K(ft.documents||[]),$(Wt??0),p(ft),V(!0)},Mt=async()=>{if(!(!d||!t||!Se))try{await $d.revokeVerification(d.id,Se,t.uid),Nt.success("Certification révoquée"),R(!1),p(null),le("")}catch(ft){console.error("Erreur lors de la révocation:",ft),Nt.error("Erreur lors de la révocation")}},ar=ft=>{switch(ft){case"pending":case"documents_submitted":return i.jsxs(Ir,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[i.jsx(Fi,{className:"h-3 w-3 mr-1"}),"En attente"]});case"approved":case"verified":return i.jsxs(Ir,{className:"bg-green-100 text-green-800 border-green-200",children:[i.jsx(Hd,{className:"h-3 w-3 mr-1"}),"Approuvé"]});case"rejected":return i.jsxs(Ir,{className:"bg-red-100 text-red-800 border-red-200",children:[i.jsx(fo,{className:"h-3 w-3 mr-1"}),"Rejeté"]});case"under_review":return i.jsxs(Ir,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[i.jsx(Fo,{className:"h-3 w-3 mr-1"}),"En revue"]});case"unverified":return i.jsx(Ir,{className:"bg-gray-100 text-gray-800 border-gray-200",children:"Non vérifié"});case"suspended":return i.jsxs(Ir,{className:"bg-orange-100 text-orange-800 border-orange-200",children:[i.jsx(fo,{className:"h-3 w-3 mr-1"}),"Suspendu"]});default:return i.jsx(Ir,{children:ft})}},St=ft=>ft?new Date(ft).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",Xt=e.filter(ft=>J==="all"?!0:J==="pending"?ft.status==="pending"||ft.status==="documents_submitted"||ft.status==="under_review":J==="approved"?ft.status==="approved"||ft.status==="verified":J==="rejected"?ft.status==="rejected":ft.status===J),dt={total:e.length,pending:e.filter(ft=>ft.status==="pending"||ft.status==="documents_submitted"||ft.status==="under_review").length,approved:e.filter(ft=>ft.status==="approved"||ft.status==="verified").length,rejected:e.filter(ft=>ft.status==="rejected").length};return i.jsxs("div",{className:"container mx-auto px-4 py-6",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Gestion des Vérifications"}),i.jsx("p",{className:"text-muted-foreground",children:"Approuver ou rejeter les demandes de vérification d'identité étudiante"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{className:"pb-2",children:i.jsx(kr,{className:"text-sm font-medium",children:"Total"})}),i.jsx(jt,{children:i.jsx("div",{className:"text-2xl font-bold",children:dt.total})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{className:"pb-2",children:i.jsx(kr,{className:"text-sm font-medium",children:"En attente"})}),i.jsx(jt,{children:i.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:dt.pending})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{className:"pb-2",children:i.jsx(kr,{className:"text-sm font-medium",children:"Approuvées"})}),i.jsx(jt,{children:i.jsx("div",{className:"text-2xl font-bold text-green-600",children:dt.approved})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{className:"pb-2",children:i.jsx(kr,{className:"text-sm font-medium",children:"Rejetées"})}),i.jsx(jt,{children:i.jsx("div",{className:"text-2xl font-bold text-red-600",children:dt.rejected})})]})]}),i.jsxs("div",{className:"flex gap-2 mb-6",children:[i.jsxs(Ge,{variant:J==="all"?"default":"outline",size:"sm",onClick:()=>ke("all"),children:["Tous (",dt.total,")"]}),i.jsxs(Ge,{variant:J==="pending"?"default":"outline",size:"sm",onClick:()=>ke("pending"),children:["En attente (",dt.pending,")"]}),i.jsxs(Ge,{variant:J==="approved"?"default":"outline",size:"sm",onClick:()=>ke("approved"),children:["Approuvées (",dt.approved,")"]}),i.jsxs(Ge,{variant:J==="rejected"?"default":"outline",size:"sm",onClick:()=>ke("rejected"),children:["Rejetées (",dt.rejected,")"]})]}),n?i.jsx(Tt,{children:i.jsxs(jt,{className:"py-12",children:[i.jsx(Yo,{className:"h-8 w-8 animate-spin mb-2"}),i.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):Xt.length===0?i.jsx(Tt,{children:i.jsx(jt,{className:"py-12",children:i.jsx("p",{className:"text-muted-foreground",children:"Aucune demande trouvée"})})}):i.jsx("div",{className:"space-y-4",children:Xt.map(ft=>{var Wt,Wr;return i.jsxs(Tt,{className:"hover:shadow-md transition-shadow",children:[i.jsx(Dr,{className:"text-left",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(kr,{className:"text-lg",children:ft.userName}),ar(ft.status)]}),i.jsxs("div",{className:"text-sm text-muted-foreground space-y-1 text-left",children:[i.jsxs("p",{className:"text-left",children:["📧 ",ft.userEmail]}),ft.university&&i.jsxs("p",{className:"text-left",children:["🏫 ",ft.university]}),((Wt=ft.metadata)==null?void 0:Wt.university)&&i.jsxs("p",{className:"text-left",children:["🏫 ",ft.metadata.university]}),ft.studentId&&i.jsxs("p",{className:"text-left",children:["🆔 Numéro étudiant : ",ft.studentId]}),((Wr=ft.metadata)==null?void 0:Wr.studentId)&&i.jsxs("p",{className:"text-left",children:["🆔 Numéro étudiant : ",ft.metadata.studentId]}),(ft.requestedAt||ft.submittedAt)&&i.jsxs("p",{className:"text-left",children:["📅 Demande le : ",St(ft.requestedAt||ft.submittedAt)]})]})]}),(ft.status==="pending"||ft.status==="documents_submitted"||ft.status==="under_review")&&i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Ge,{variant:"outline",size:"sm",onClick:()=>it(ft),children:[i.jsx(Fo,{className:"h-4 w-4 mr-1"}),"Voir docs"]}),i.jsxs(Ge,{variant:"outline",size:"sm",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>qe(ft),children:[i.jsx(Hd,{className:"h-4 w-4 mr-1"}),"Approuver"]}),i.jsxs(Ge,{variant:"outline",size:"sm",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>$e(ft),children:[i.jsx(fo,{className:"h-4 w-4 mr-1"}),"Rejeter"]})]}),(ft.status==="verified"||ft.status==="approved")&&i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Ge,{variant:"outline",size:"sm",onClick:()=>it(ft),children:[i.jsx(Fo,{className:"h-4 w-4 mr-1"}),"Voir docs"]}),i.jsxs(Ge,{variant:"outline",size:"sm",className:"text-orange-600 border-orange-600 hover:bg-orange-50",onClick:()=>st(ft),children:[i.jsx(fo,{className:"h-4 w-4 mr-1"}),"Révoquer"]})]})]})}),ft.documents&&ft.documents.length>0&&i.jsx(jt,{children:i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:ft.documents.map((jr,Br)=>{var on;return i.jsxs("div",{className:"border rounded-lg p-2 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>it(ft,Br),children:[(on=jr.filename||jr.fileName)!=null&&on.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)?i.jsx("img",{src:jr.url,alt:jr.filename||jr.fileName||"Document",className:"w-full h-32 object-cover rounded"}):i.jsx("div",{className:"w-full h-32 bg-muted flex items-center justify-center rounded",children:"📄 PDF"}),i.jsx("p",{className:"text-xs mt-1 truncate",children:jr.filename||jr.fileName||"Document"})]},Br)})})})]},ft.id)})}),i.jsx(ta,{open:a,onOpenChange:w,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Approuver la demande de vérification"}),i.jsxs(go,{children:["Êtes-vous sûr de vouloir approuver la demande de vérification de ",d==null?void 0:d.userName," ? Cette action est irréversible."]})]}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>w(!1),children:"Annuler"}),i.jsx(Ge,{onClick:Ze,className:"bg-green-600 hover:bg-green-700",children:"Approuver"})]})]})}),i.jsx(ta,{open:E,onOpenChange:C,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Rejeter la demande de vérification"}),i.jsxs(go,{children:["Veuillez fournir un motif de rejet pour ",d==null?void 0:d.userName]})]}),i.jsx("div",{className:"py-4",children:i.jsx(Gr,{placeholder:"Motif de rejet (ex: Documents invalides)",value:ge,onChange:ft=>ce(ft.target.value)})}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>C(!1),children:"Annuler"}),i.jsx(Ge,{onClick:Xe,disabled:!ge,className:"bg-red-600 hover:bg-red-700",children:"Rejeter"})]})]})}),i.jsx(ta,{open:P,onOpenChange:R,children:i.jsxs(Ki,{children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Révoquer la certification"}),i.jsxs(go,{children:["Veuillez fournir un motif de révocation pour ",d==null?void 0:d.userName,(d==null?void 0:d.status)==="verified"&&" (statut actuel: Vérifié)"]})]}),i.jsx("div",{className:"py-4",children:i.jsx(Gr,{placeholder:"Motif de révocation (ex: Documents frauduleux détectés)",value:Se,onChange:ft=>le(ft.target.value)})}),i.jsxs(mo,{children:[i.jsx(Ge,{variant:"outline",onClick:()=>R(!1),children:"Annuler"}),i.jsx(Ge,{onClick:Mt,disabled:!Se,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Révoquer"})]})]})}),i.jsx(ta,{open:B,onOpenChange:V,children:i.jsxs(Ki,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(oa,{children:[i.jsx(ra,{children:"Documents de vérification"}),i.jsxs(go,{children:["Documents soumis par ",d==null?void 0:d.userName]})]}),i.jsx("div",{className:"py-4",children:W[Z]&&(()=>{const ft=W[Z],Wt=ft.filename||ft.fileName||"Document",Wr=Wt.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp)$/);return i.jsxs("div",{className:"space-y-4",children:[W.length>1&&i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx(Ge,{variant:"outline",size:"sm",disabled:Z===0,onClick:()=>$(Z-1),children:"← Précédent"}),i.jsxs("span",{className:"text-sm text-muted-foreground",children:[Z+1," / ",W.length]}),i.jsx(Ge,{variant:"outline",size:"sm",disabled:Z===W.length-1,onClick:()=>$(Z+1),children:"Suivant →"})]}),Wr?i.jsx("img",{src:ft.url,alt:Wt,className:"w-full max-h-[600px] object-contain rounded-lg border border-border mx-auto"}):i.jsx("div",{className:"w-full min-h-[600px] bg-muted rounded-lg flex items-center justify-center",children:i.jsxs("div",{className:"text-center space-y-4",children:[i.jsx("p",{className:"text-6xl mb-4",children:"📄"}),i.jsx("p",{className:"text-lg font-semibold mb-4",children:Wt}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Chargement du PDF en arrière-plan..."})]})})]})})()}),i.jsx(mo,{children:i.jsx(Ge,{variant:"outline",onClick:()=>V(!1),children:"Fermer"})})]})}),i.jsx(bMe,{isOpen:X,onClose:()=>Q(!1),documentUrl:re,documentName:pe})]})},EMe=()=>{const[t,e]=z.useState(!1),[r,n]=z.useState(null),[c,d]=z.useState(""),[p,a]=z.useState(""),[w,E]=z.useState(null),C=B=>{var W;const V=(W=B.target.files)==null?void 0:W[0];if(V){E(V);const K=new FileReader;K.onloadend=()=>{a(K.result)},K.readAsDataURL(V)}},P=async()=>{e(!0),n(null),d("");try{const B=p||"https://example.com/student-card.jpg";d("OCR Service");const V=await mO.extractTextFromImage(B);d("Antivirus Service");const W=await OI.scanFile("https://example.com/test.pdf","test.pdf");d("Face Match Service");const K=await h0.compareFaces("https://example.com/selfie.jpg","https://example.com/card.jpg");d("Auto Validation Service");const Z=await K4.validate("student@university.edu",[{url:"https://example.com/card.jpg",filename:"card.jpg",type:"student_card"},{url:"https://example.com/selfie.jpg",filename:"selfie.jpg",type:"selfie"}],{ipAddress:"192.168.1.1",previousAttempts:0});n({ocr:V,antivirus:W,faceMatch:K,validation:Z}),d("")}catch(B){console.error("❌ Test Error:",B),d(`Erreur: ${B}`)}finally{e(!1)}},R=(B,V,W)=>i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[W?i.jsx(Hd,{className:"h-5 w-5 text-green-500"}):i.jsx(fo,{className:"h-5 w-5 text-red-500"}),i.jsx("h3",{className:"font-semibold",children:B})]}),i.jsx("pre",{className:"bg-muted p-3 rounded text-xs overflow-auto",children:JSON.stringify(V,null,2)})]});return i.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Tests Validation Automatique"}),i.jsx("p",{className:"text-muted-foreground",children:"Testez les services de validation automatique (OCR, Face Match, Antivirus)"})]}),i.jsxs(Tt,{className:"mb-6",children:[i.jsxs(Dr,{children:[i.jsx(kr,{children:"Services de Validation"}),i.jsx(Ls,{children:"Cliquez sur le bouton pour lancer les tests des services"})]}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Upload une image de test (optionnel)"}),i.jsx("input",{type:"file",accept:"image/*",onChange:C,className:`block w-full text-sm text-muted-foreground
                         file:mr-4 file:py-2 file:px-4 file:rounded-lg
                         file:border-0 file:text-sm file:font-semibold
                         file:bg-primary file:text-primary-foreground
                         hover:file:bg-primary/90 cursor-pointer`}),p&&i.jsxs(Ys,{className:"mt-2",children:[i.jsx(Hd,{className:"h-4 w-4"}),i.jsxs(Js,{children:["Image chargée : ",w==null?void 0:w.name]})]})]}),i.jsx(Ge,{onClick:P,disabled:t,className:"w-full",children:t?i.jsxs(i.Fragment,{children:[i.jsx(Ka,{className:"mr-2 h-4 w-4 animate-spin"}),c||"Test en cours..."]}):"Lancer les Tests"})]})]}),t&&c&&i.jsxs(Ys,{className:"mb-6",children:[i.jsx(Ka,{className:"h-4 w-4 animate-spin"}),i.jsxs(Js,{children:[i.jsx("strong",{children:c})," en cours..."]})]}),r&&i.jsxs(Tt,{children:[i.jsxs(Dr,{children:[i.jsx(kr,{children:"Résultats des Tests"}),i.jsx(Ls,{children:"Détails des tests effectués sur les services de validation"})]}),i.jsxs(jt,{className:"space-y-4",children:[r.ocr&&R("OCR Service - Extraction de Texte",r.ocr,!0),r.antivirus&&R("Antivirus Service - Scan de Sécurité",r.antivirus,r.antivirus.clean),r.faceMatch&&R("Face Match Service - Comparaison Faciale",r.faceMatch,r.faceMatch.matched),r.validation&&i.jsxs("div",{className:"mt-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(Hd,{className:"h-5 w-5 text-green-500"}),i.jsx("h3",{className:"font-semibold text-lg",children:"Auto Validation - Résultat Complet"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[i.jsxs("div",{className:"bg-muted p-3 rounded",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Score"}),i.jsxs("p",{className:"text-2xl font-bold",children:[r.validation.score,"/100"]})]}),i.jsxs("div",{className:"bg-muted p-3 rounded",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Statut"}),i.jsx("p",{className:"text-lg font-semibold",children:r.validation.passed?"✅ Passé":"❌ Échoué"})]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm font-semibold mb-2",children:"Recommandation"}),i.jsxs(Ys,{className:r.validation.recommendation==="auto_approve"?"bg-green-50":r.validation.recommendation==="admin_review"?"bg-yellow-50":"bg-red-50",children:[i.jsx(Yd,{className:"h-4 w-4"}),i.jsxs(Js,{className:"font-semibold",children:[r.validation.recommendation==="auto_approve"&&"✅ Approuvé automatiquement",r.validation.recommendation==="admin_review"&&"⚠️ Demande revue admin",r.validation.recommendation==="reject"&&"❌ Rejeté"]})]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm font-semibold mb-2",children:"Vérifications"}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(r.validation.checks).map(([B,V])=>i.jsxs("div",{className:"flex items-center gap-2",children:[V?i.jsx(Hd,{className:"h-4 w-4 text-green-500"}):i.jsx(fo,{className:"h-4 w-4 text-red-500"}),i.jsx("span",{className:"text-sm",children:B})]},B))})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold mb-2",children:"Flags de Risque"}),i.jsx("pre",{className:"bg-muted p-3 rounded text-xs overflow-auto",children:JSON.stringify(r.validation.flags,null,2)})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("p",{className:"text-sm font-semibold mb-2",children:"Détails"}),i.jsx("pre",{className:"bg-muted p-3 rounded text-xs overflow-auto",children:JSON.stringify(r.validation.details,null,2)})]})]})]})]})]})},W$=t=>[],TMe=({children:t})=>{const{currentUser:e}=$i(),r=Ap();if(!e)return i.jsx(nD,{to:"/auth",state:{from:r},replace:!0});const n=W$(),c=W$();return e.email&&n.includes(e.email)||c.includes(e.uid)?i.jsx(i.Fragment,{children:t}):i.jsx(nD,{to:"/",replace:!0})},Vl=({children:t})=>{const{currentUser:e}=$i(),r=Ap();return e?i.jsx(i.Fragment,{children:t}):i.jsx(nD,{to:"/auth",state:{from:r},replace:!0})},jMe=({cart:t,total:e,showCheckoutButton:r=!0})=>{const n=Ra(),c=e,d=0,p=0,a=c+d-p,w=E=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(E);return i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(wp,{className:"w-5 h-5"}),"Récapitulatif de commande"]})}),i.jsx(jt,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("span",{className:"text-muted-foreground",children:["Articles (",t.reduce((E,C)=>E+C.quantity,0),")"]}),i.jsx("span",{children:w(c)})]}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground",children:[i.jsx(k0,{className:"w-4 h-4"}),"Livraison"]}),i.jsx("span",{className:"text-green-600 font-medium",children:"Gratuite"})]}),p>0,i.jsx(Zc,{}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"font-semibold",children:"Total"}),i.jsx("span",{className:"font-bold text-lg",children:w(a)})]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"* TVA incluse"}),r&&i.jsxs(Ge,{onClick:()=>n("/checkout"),className:"w-full mt-4 bg-gradient-to-r from-primary to-secondary",disabled:t.length===0,children:[i.jsx(Aa,{className:"mr-2 h-4 w-4"}),"Procéder au paiement",i.jsx(Zh,{className:"ml-2 h-4 w-4"})]})]})})]})},NMe=()=>{const{currentUser:t}=$i(),{cart:e,updateQuantity:r,removeFromCart:n,clearCart:c,cartTotal:d}=HE(),p=Ra(),[a,w]=z.useState(""),[E,C]=z.useState(!1),P=(V,W)=>{if(!(W<1)){if(W>10){Nt.error("Maximum 10 articles par produit");return}r(V,W)}},R=V=>{n(V),Nt.success("Article retiré du panier")},B=()=>{a.trim()&&(C(!0),setTimeout(()=>{a.toLowerCase()==="etudiant10"?Nt.success("Code promo appliqué : 10% de réduction"):Nt.error("Code promo invalide ou expiré"),C(!1)},1e3))};return i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs(Ge,{variant:"ghost",onClick:()=>p(-1),className:"-ml-4",children:[i.jsx(vp,{className:"w-4 h-4 mr-2"}),"Retour"]}),i.jsxs("div",{className:"flex items-center justify-between mt-4",children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(wp,{className:"w-8 h-8"}),"Mon Panier"]}),e.length>0&&i.jsxs(Ge,{variant:"outline",onClick:c,className:"text-destructive hover:text-destructive",children:[i.jsx(nd,{className:"w-4 h-4 mr-2"}),"Vider le panier"]})]})]}),e.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(wp,{className:"w-8 h-8 text-muted-foreground"})}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Votre panier est vide"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Vous n'avez pas encore ajouté d'articles à votre panier."}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:"/products",children:[i.jsx(Z_,{className:"w-4 h-4 mr-2"}),"Parcourir les produits"]})})]}):i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"lg:col-span-2",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center justify-between",children:[i.jsxs("span",{children:["Articles (",e.reduce((V,W)=>V+W.quantity,0),")"]}),i.jsxs(Ge,{variant:"ghost",size:"sm",onClick:()=>p("/products"),children:[i.jsx(Z_,{className:"w-4 h-4 mr-2"}),"Continuer mes achats"]})]})}),i.jsx(jt,{children:i.jsx("div",{className:"space-y-4",children:e.map(V=>i.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[V.image?i.jsx("img",{src:V.image,alt:V.name,className:"w-20 h-20 object-cover rounded"}):i.jsx("div",{className:"w-20 h-20 bg-muted rounded flex items-center justify-center",children:i.jsx(Z_,{className:"w-8 h-8 text-muted-foreground"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold",children:V.name}),i.jsx("p",{className:"text-sm text-muted-foreground",children:V.seller}),i.jsxs("div",{className:"flex items-center mt-2",children:[i.jsx(Ge,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-r-none",onClick:()=>P(V.id,V.quantity-1),disabled:V.quantity<=1,children:i.jsx(pZ,{className:"h-3 w-3"})}),i.jsx(Gr,{type:"number",value:V.quantity,onChange:W=>{const K=parseInt(W.target.value);isNaN(K)||P(V.id,K)},className:"h-8 w-12 rounded-none text-center [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),i.jsx(Ge,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-l-none",onClick:()=>P(V.id,V.quantity+1),disabled:V.quantity>=10,children:i.jsx(W_,{className:"h-3 w-3"})})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(V.price*V.quantity)}),i.jsxs(Ge,{variant:"ghost",size:"sm",onClick:()=>R(V.id),className:"text-destructive hover:text-destructive mt-2",children:[i.jsx(nd,{className:"h-3 w-3 mr-1"}),"Supprimer"]})]})]},V.id))})})]}),i.jsx(Tt,{className:"mt-6",children:i.jsxs(jt,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(oI,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{placeholder:"Code promo",value:a,onChange:V=>w(V.target.value),className:"pl-10"})]}),i.jsx(Ge,{onClick:B,disabled:!a.trim()||E,children:E?i.jsxs(i.Fragment,{children:[i.jsx(Yo,{className:"w-4 h-4 mr-2 animate-spin"}),"Application..."]}):"Appliquer"})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:'Essayez le code "ETUDIANT10" pour 10% de réduction'})]})})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(jMe,{cart:e,total:d,showCheckoutButton:!0}),!t&&i.jsxs(Ys,{className:"border-blue-200 bg-blue-50",children:[i.jsx(va,{className:"h-4 w-4 text-blue-600"}),i.jsx(Js,{className:"text-blue-800",children:"Vous devez être connecté pour finaliser votre commande."})]})]})]})]})},IMe=({id:t,name:e,description:r,price:n,currency:c,image:d,mode:p})=>{const{currentUser:a}=$i(),{addToCart:w}=HE(),E=Ra(),C=(B,V)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:V}).format(B),P=()=>{if(!a){Nt.error("Veuillez vous connecter pour ajouter au panier"),E("/auth");return}w({id:t,name:e,price:n,image:d,seller:"StudyMarket",sellerId:"system",listingId:t})},R=()=>{if(!a){Nt.error("Veuillez vous connecter pour acheter"),E("/auth");return}w({id:t,name:e,price:n,image:d,seller:"StudyMarket",sellerId:"system",listingId:t}),E("/checkout")};return i.jsxs(Tt,{className:"overflow-hidden transition-all hover:shadow-lg",children:[i.jsxs("div",{className:"aspect-video relative overflow-hidden",children:[d?i.jsx("img",{src:d,alt:e,className:"w-full h-full object-cover transition-transform hover:scale-105"}):i.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:i.jsx(Exe,{className:"w-12 h-12 text-muted-foreground"})}),i.jsx(Ir,{className:"absolute top-2 right-2 bg-primary",children:p==="subscription"?"Abonnement":"Achat unique"})]}),i.jsxs(Dr,{children:[i.jsx(kr,{children:e}),i.jsx(Ls,{children:r})]}),i.jsx(jt,{children:i.jsxs("div",{className:"text-2xl font-bold text-primary",children:[C(n,c),p==="subscription"&&i.jsx("span",{className:"text-sm text-muted-foreground ml-1",children:"/mois"})]})}),i.jsxs(yX,{className:"flex gap-2",children:[i.jsxs(Ge,{variant:"outline",className:"flex-1",onClick:P,children:[i.jsx(wp,{className:"w-4 h-4 mr-2"}),"Ajouter"]}),i.jsx(Ge,{className:"flex-1 bg-gradient-to-r from-primary to-secondary",onClick:R,children:"Acheter"})]})]})},_O=[{id:"prod_ST3q24zsLbS28p",name:"Bicyclette",description:"Vélo",priceId:"price_1RY7iN2XLhzYQhT9ErigqaGg",price:10,currency:"EUR",mode:"payment",image:"https://images.pexels.com/photos/100582/pexels-photo-100582.jpeg?auto=compress&cs=tinysrgb&w=800"}],CMe=t=>_O.find(e=>e.priceId===t),AMe=()=>{const{getCartItemCount:t}=HE(),e=Ra(),r=t();return i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs(Ge,{variant:"ghost",onClick:()=>e(-1),className:"-ml-4",children:[i.jsx(vp,{className:"w-4 h-4 mr-2"}),"Retour"]}),i.jsxs("div",{className:"flex items-center justify-between mt-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(Z_,{className:"w-8 h-8"}),"Boutique"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Découvrez nos produits et services"})]}),r>0&&i.jsxs(Ge,{onClick:()=>e("/cart"),className:"flex items-center gap-2",children:[i.jsx(wp,{className:"w-4 h-4"}),"Panier (",r,")"]})]})]}),!lIe.isConfigured&&i.jsxs(Ys,{className:"border-yellow-200 bg-yellow-50 mb-6",children:[i.jsx(va,{className:"h-4 w-4 text-yellow-600"}),i.jsxs(Js,{className:"text-yellow-800",children:[i.jsx("strong",{children:"Configuration Stripe manquante"})," - Les paiements par carte ne fonctionneront pas tant que vous n'aurez pas configuré votre clé publique Stripe dans le fichier .env"]})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_O.map(n=>i.jsx(IMe,{id:n.id,name:n.name,description:n.description,price:n.price,currency:n.currency,image:n.image,mode:n.mode},n.id))}),_O.length===0&&i.jsx(Tt,{className:"text-center py-12",children:i.jsxs(jt,{className:"pt-6",children:[i.jsx(gi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Aucun produit disponible"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Revenez bientôt pour découvrir nos nouveaux produits."})]})})]})},xv=t=>{if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")try{return t.toDate()}catch{return new Date}if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?new Date:e}return t&&typeof t=="object"&&t.seconds?new Date(t.seconds*1e3):new Date},bA=pw((t,e)=>({orders:[],sales:[],loading:!1,fetchUserOrders:async r=>{if(r)try{t({loading:!0});const n=ms(jn(rr,"orders"),ii("userId","==",r),eo("createdAt","desc"),la(100)),c=await gs(n),d=[];c.forEach(p=>{const a=p.data();d.push({id:p.id,...a,createdAt:xv(a.createdAt),updatedAt:xv(a.updatedAt)})}),t({orders:d,loading:!1})}catch(n){console.error("Error fetching orders:",n),Nt.error("Erreur lors du chargement des commandes"),t({loading:!1})}},fetchSellerSales:async r=>{if(r)try{t({loading:!0});const n=ms(jn(rr,"orders"),eo("createdAt","desc"),la(200)),c=await gs(n),d=[];c.forEach(p=>{var E;const a=p.data();((E=a.items)==null?void 0:E.some(C=>C.sellerId===r))&&d.push({id:p.id,...a,createdAt:xv(a.createdAt),updatedAt:xv(a.updatedAt)})}),t({sales:d,loading:!1})}catch(n){console.error("Error fetching sales:",n),Nt.error("Erreur lors du chargement des ventes"),t({loading:!1})}},getOrderById:async r=>{try{const n=await Xa(hn(rr,"orders",r));if(n.exists()){const c=n.data();return{id:n.id,...c,createdAt:xv(c.createdAt),updatedAt:xv(c.updatedAt)}}return null}catch(n){return console.error("Error getting order:",n),Nt.error("Erreur lors du chargement de la commande"),null}},createOrder:async r=>{try{const n=Math.random().toString(36).substring(2,8).toUpperCase(),c={...r,securityCode:n,createdAt:aa(),updatedAt:aa()},d=await af(jn(rr,"orders"),c),p={id:d.id,...r,createdAt:new Date,updatedAt:new Date};return t(a=>({orders:[p,...a.orders]})),Nt.success("Commande créée avec succès !"),d.id}catch(n){throw console.error("Error creating order:",n),Nt.error("Erreur lors de la création de la commande"),n}},updateOrderStatus:async(r,n,c)=>{try{const d={status:n,updatedAt:aa()};c&&(d.notes=c),await Rs(hn(rr,"orders",r),d),t(p=>({orders:p.orders.map(a=>a.id===r?{...a,status:n,notes:c||a.notes,updatedAt:new Date}:a)})),Nt.success(`Statut de la commande mis à jour : ${n}`)}catch(d){console.error("Error updating order status:",d),Nt.error("Erreur lors de la mise à jour du statut")}},cancelOrder:async(r,n)=>{try{await Rs(hn(rr,"orders",r),{status:"cancelled",notes:n,updatedAt:aa()}),t(c=>({orders:c.orders.map(d=>d.id===r?{...d,status:"cancelled",notes:n,updatedAt:new Date}:d)})),Nt.success("Commande annulée")}catch(c){console.error("Error cancelling order:",c),Nt.error("Erreur lors de l'annulation de la commande")}}})),PMe=()=>{const{currentUser:t}=$i(),{orders:e,fetchUserOrders:r,loading:n}=bA(),c=Ra(),[d,p]=z.useState(""),[a,w]=z.useState("all"),[E,C]=z.useState("date-desc"),[P,R]=z.useState("all");z.useEffect(()=>{t&&r(t.uid)},[t,r]);const B=()=>e.filter(Z=>{const $=!d||Z.id.toLowerCase().includes(d.toLowerCase()),X=a==="all"||Z.status===a;let Q=!0;if(P!=="all"){const re=new Date(Z.createdAt),ve=new Date;if(P==="last-30-days"){const pe=new Date;pe.setDate(ve.getDate()-30),Q=re>=pe}else if(P==="last-6-months"){const pe=new Date;pe.setMonth(ve.getMonth()-6),Q=re>=pe}}return $&&X&&Q}).sort((Z,$)=>E==="date-desc"?new Date($.createdAt).getTime()-new Date(Z.createdAt).getTime():E==="date-asc"?new Date(Z.createdAt).getTime()-new Date($.createdAt).getTime():E==="total-desc"?$.total-Z.total:E==="total-asc"?Z.total-$.total:0),V=Z=>{switch(Z){case"pending":return i.jsxs(Ir,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[i.jsx(Fi,{className:"w-3 h-3 mr-1"}),"En attente"]});case"processing":return i.jsxs(Ir,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[i.jsx(gi,{className:"w-3 h-3 mr-1"}),"En traitement"]});case"shipped":return i.jsxs(Ir,{className:"bg-purple-100 text-purple-800 border-purple-200",children:[i.jsx(k0,{className:"w-3 h-3 mr-1"}),"Expédiée"]});case"delivered":return i.jsxs(Ir,{className:"bg-green-100 text-green-800 border-green-200",children:[i.jsx(qs,{className:"w-3 h-3 mr-1"}),"Livrée"]});case"cancelled":return i.jsxs(Ir,{className:"bg-red-100 text-red-800 border-red-200",children:[i.jsx(fo,{className:"w-3 h-3 mr-1"}),"Annulée"]});default:return i.jsx(Ir,{children:Z})}},W=Z=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(Z),K=()=>{const Z={user:(t==null?void 0:t.displayName)||(t==null?void 0:t.email),date:new Date().toISOString(),orders:e.map(re=>({id:re.id,date:re.createdAt,status:re.status,total:re.total,items:re.items.length}))},$=new Blob([JSON.stringify(Z,null,2)],{type:"application/json"}),X=URL.createObjectURL($),Q=document.createElement("a");Q.href=X,Q.download=`commandes-${new Date().toISOString().slice(0,10)}.json`,Q.click(),URL.revokeObjectURL(X)};return t?i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(gi,{className:"w-8 h-8"}),"Mes Commandes"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Suivez et gérez toutes vos commandes"})]}),i.jsxs(Ge,{variant:"outline",onClick:K,className:"flex items-center gap-2",children:[i.jsx(to,{className:"w-4 h-4"}),"Exporter"]})]}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Oo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{placeholder:"Rechercher par numéro de commande...",value:d,onChange:Z=>p(Z.target.value),className:"pl-10"})]}),i.jsxs(ds,{value:a,onValueChange:w,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous les statuts"}),i.jsx(Bt,{value:"pending",children:"En attente"}),i.jsx(Bt,{value:"processing",children:"En traitement"}),i.jsx(Bt,{value:"shipped",children:"Expédiée"}),i.jsx(Bt,{value:"delivered",children:"Livrée"}),i.jsx(Bt,{value:"cancelled",children:"Annulée"})]})]}),i.jsxs(ds,{value:P,onValueChange:R,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Période"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Toutes les périodes"}),i.jsx(Bt,{value:"last-30-days",children:"30 derniers jours"}),i.jsx(Bt,{value:"last-6-months",children:"6 derniers mois"})]})]}),i.jsxs(ds,{value:E,onValueChange:C,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Trier par"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"date-desc",children:"Date (récent → ancien)"}),i.jsx(Bt,{value:"date-asc",children:"Date (ancien → récent)"}),i.jsx(Bt,{value:"total-desc",children:"Prix (élevé → bas)"}),i.jsx(Bt,{value:"total-asc",children:"Prix (bas → élevé)"})]})]})]})})}),i.jsxs(Og,{defaultValue:"all",className:"space-y-4",children:[i.jsxs(Pp,{className:"grid w-full grid-cols-4",children:[i.jsx(Wi,{value:"all",children:"Toutes"}),i.jsx(Wi,{value:"active",children:"En cours"}),i.jsx(Wi,{value:"completed",children:"Terminées"}),i.jsx(Wi,{value:"cancelled",children:"Annulées"})]}),i.jsx(Zi,{value:"all",className:"space-y-4",children:n?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((Z,$)=>i.jsx(Tt,{className:"animate-pulse",children:i.jsxs(jt,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between mb-4",children:[i.jsx("div",{className:"h-6 bg-muted rounded w-1/4"}),i.jsx("div",{className:"h-6 bg-muted rounded w-1/6"})]}),i.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})]})},$))}):B().length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(gi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune commande trouvée"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:e.length===0?"Vous n'avez pas encore passé de commande.":"Aucune commande ne correspond à vos critères de recherche."}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:"/listings",children:[i.jsx(Z_,{className:"w-4 h-4 mr-2"}),"Parcourir les produits"]})})]}):i.jsx("div",{className:"space-y-4",children:B().map(Z=>i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsxs(jt,{className:"p-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsxs("h3",{className:"font-semibold",children:["Commande #",Z.id.slice(0,8)]}),V(Z.status)]}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),Pa(new Date(Z.createdAt),"dd MMMM yyyy",{locale:po})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold",children:W(Z.total)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[Z.items.length," article",Z.items.length>1?"s":""]})]}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:`/order/${Z.id}`,children:["Détails",i.jsx(Zh,{className:"ml-1 w-4 h-4"})]})})]})]}),i.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-2",children:[Z.items.slice(0,4).map(($,X)=>i.jsx("div",{className:"flex-shrink-0",children:$.image?i.jsx("img",{src:$.image,alt:$.title,className:"w-16 h-16 object-cover rounded",title:$.title}):i.jsx("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsx(gi,{className:"w-6 h-6 text-muted-foreground"})})},X)),Z.items.length>4&&i.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsxs("span",{className:"text-sm font-medium",children:["+",Z.items.length-4]})})]})]})},Z.id))})}),i.jsx(Zi,{value:"active",className:"space-y-4",children:B().filter(Z=>["pending","processing","shipped"].includes(Z.status)).length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Fi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune commande en cours"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Vous n'avez pas de commandes en cours de traitement."})]}):i.jsx("div",{className:"space-y-4",children:B().filter(Z=>["pending","processing","shipped"].includes(Z.status)).map(Z=>i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsxs(jt,{className:"p-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsxs("h3",{className:"font-semibold",children:["Commande #",Z.id.slice(0,8)]}),V(Z.status)]}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),Pa(new Date(Z.createdAt),"dd MMMM yyyy",{locale:po})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold",children:W(Z.total)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[Z.items.length," article",Z.items.length>1?"s":""]})]}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:`/order/${Z.id}`,children:["Détails",i.jsx(Zh,{className:"ml-1 w-4 h-4"})]})})]})]}),i.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-2",children:[Z.items.slice(0,4).map(($,X)=>i.jsx("div",{className:"flex-shrink-0",children:$.image?i.jsx("img",{src:$.image,alt:$.name,className:"w-16 h-16 object-cover rounded"}):i.jsx("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsx(gi,{className:"w-6 h-6 text-muted-foreground"})})},X)),Z.items.length>4&&i.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsxs("span",{className:"text-sm font-medium",children:["+",Z.items.length-4]})})]})]})},Z.id))})}),i.jsx(Zi,{value:"completed",className:"space-y-4",children:B().filter(Z=>Z.status==="delivered").length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(qs,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune commande terminée"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Vous n'avez pas encore de commandes livrées."})]}):i.jsx("div",{className:"space-y-4",children:B().filter(Z=>Z.status==="delivered").map(Z=>i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsxs(jt,{className:"p-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsxs("h3",{className:"font-semibold",children:["Commande #",Z.id.slice(0,8)]}),V(Z.status)]}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),Pa(new Date(Z.createdAt),"dd MMMM yyyy",{locale:po})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold",children:W(Z.total)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[Z.items.length," article",Z.items.length>1?"s":""]})]}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:`/order/${Z.id}`,children:["Détails",i.jsx(Zh,{className:"ml-1 w-4 h-4"})]})})]})]}),i.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-2",children:[Z.items.slice(0,4).map(($,X)=>i.jsx("div",{className:"flex-shrink-0",children:$.image?i.jsx("img",{src:$.image,alt:$.name,className:"w-16 h-16 object-cover rounded"}):i.jsx("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsx(gi,{className:"w-6 h-6 text-muted-foreground"})})},X)),Z.items.length>4&&i.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsxs("span",{className:"text-sm font-medium",children:["+",Z.items.length-4]})})]})]})},Z.id))})}),i.jsx(Zi,{value:"cancelled",className:"space-y-4",children:B().filter(Z=>Z.status==="cancelled").length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(fo,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune commande annulée"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Vous n'avez pas de commandes annulées."})]}):i.jsx("div",{className:"space-y-4",children:B().filter(Z=>Z.status==="cancelled").map(Z=>i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsxs(jt,{className:"p-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsxs("h3",{className:"font-semibold",children:["Commande #",Z.id.slice(0,8)]}),V(Z.status)]}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),Pa(new Date(Z.createdAt),"dd MMMM yyyy",{locale:po})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold",children:W(Z.total)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[Z.items.length," article",Z.items.length>1?"s":""]})]}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:`/order/${Z.id}`,children:["Détails",i.jsx(Zh,{className:"ml-1 w-4 h-4"})]})})]})]}),i.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-2",children:[Z.items.slice(0,4).map(($,X)=>i.jsx("div",{className:"flex-shrink-0",children:$.image?i.jsx("img",{src:$.image,alt:$.name,className:"w-16 h-16 object-cover rounded"}):i.jsx("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsx(gi,{className:"w-6 h-6 text-muted-foreground"})})},X)),Z.items.length>4&&i.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsxs("span",{className:"text-sm font-medium",children:["+",Z.items.length-4]})})]})]})},Z.id))})})]})]}):i.jsx("div",{className:"container mx-auto px-4 py-8 text-center",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6",children:[i.jsx(gi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connectez-vous pour voir vos commandes"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Vous devez être connecté pour accéder à l'historique de vos commandes"}),i.jsx(Ge,{onClick:()=>c("/auth"),children:"Se connecter"})]})})})},kMe=()=>{const{currentUser:t}=$i(),{sales:e,fetchSellerSales:r,loading:n}=bA(),c=Ra(),[d,p]=z.useState(""),[a,w]=z.useState("all"),[E,C]=z.useState("date-desc"),[P,R]=z.useState("all");z.useEffect(()=>{t&&r(t.uid)},[t,r]);const B=()=>e.filter(Q=>{const re=!d||Q.id.toLowerCase().includes(d.toLowerCase())||Q.items.some(ue=>ue.title.toLowerCase().includes(d.toLowerCase())),ve=a==="all"||Q.status===a;let pe=!0;if(P!=="all"){const ue=new Date(Q.createdAt),ge=new Date;if(P==="last-30-days"){const ce=new Date;ce.setDate(ge.getDate()-30),pe=ue>=ce}else if(P==="last-6-months"){const ce=new Date;ce.setMonth(ge.getMonth()-6),pe=ue>=ce}}return re&&ve&&pe}).sort((Q,re)=>E==="date-desc"?new Date(re.createdAt).getTime()-new Date(Q.createdAt).getTime():E==="date-asc"?new Date(Q.createdAt).getTime()-new Date(re.createdAt).getTime():E==="total-desc"?re.total-Q.total:E==="total-asc"?Q.total-re.total:0),V=Q=>{switch(Q){case"pending":return i.jsxs(Ir,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[i.jsx(Fi,{className:"w-3 h-3 mr-1"}),"En attente"]});case"processing":return i.jsxs(Ir,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[i.jsx(gi,{className:"w-3 h-3 mr-1"}),"En traitement"]});case"shipped":return i.jsxs(Ir,{className:"bg-purple-100 text-purple-800 border-purple-200",children:[i.jsx(k0,{className:"w-3 h-3 mr-1"}),"Expédiée"]});case"delivered":return i.jsxs(Ir,{className:"bg-green-100 text-green-800 border-green-200",children:[i.jsx(qs,{className:"w-3 h-3 mr-1"}),"Livrée"]});case"cancelled":return i.jsxs(Ir,{className:"bg-red-100 text-red-800 border-red-200",children:[i.jsx(fo,{className:"w-3 h-3 mr-1"}),"Annulée"]});default:return i.jsx(Ir,{children:Q})}},W=Q=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(Q),K=()=>{const Q={seller:(t==null?void 0:t.displayName)||(t==null?void 0:t.email),date:new Date().toISOString(),sales:e.map(ue=>({id:ue.id,date:ue.createdAt,status:ue.status,total:ue.total,items:ue.items.length}))},re=new Blob([JSON.stringify(Q,null,2)],{type:"application/json"}),ve=URL.createObjectURL(re),pe=document.createElement("a");pe.href=ve,pe.download=`ventes-${new Date().toISOString().slice(0,10)}.json`,pe.click(),URL.revokeObjectURL(ve)},Z=e.length,$=e.reduce((Q,re)=>Q+re.total,0),X=e.filter(Q=>Q.status==="delivered").length;return t?i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(bp,{className:"w-8 h-8"}),"Mes Ventes"]}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Gérez et suivez vos ventes"})]}),i.jsxs(Ge,{variant:"outline",onClick:K,className:"flex items-center gap-2",children:[i.jsx(to,{className:"w-4 h-4"}),"Exporter"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{className:"pb-2",children:i.jsx(kr,{className:"text-sm font-medium text-muted-foreground",children:"Total des ventes"})}),i.jsxs(jt,{children:[i.jsx("div",{className:"text-2xl font-bold",children:Z}),i.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[X," terminées"]})]})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{className:"pb-2",children:i.jsx(kr,{className:"text-sm font-medium text-muted-foreground",children:"Revenu total"})}),i.jsxs(jt,{children:[i.jsxs("div",{className:"text-2xl font-bold flex items-center gap-1",children:[i.jsx(_y,{className:"w-5 h-5"}),W($)]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tous statuts confondus"})]})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{className:"pb-2",children:i.jsx(kr,{className:"text-sm font-medium text-muted-foreground",children:"Taux de complétion"})}),i.jsxs(jt,{children:[i.jsxs("div",{className:"text-2xl font-bold",children:[Z>0?Math.round(X/Z*100):0,"%"]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ventes livrées"})]})]})]}),i.jsx(Tt,{children:i.jsx(jt,{className:"pt-6",children:i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Oo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(Gr,{placeholder:"Rechercher par numéro ou article...",value:d,onChange:Q=>p(Q.target.value),className:"pl-10"})]}),i.jsxs(ds,{value:a,onValueChange:w,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Statut"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Tous les statuts"}),i.jsx(Bt,{value:"pending",children:"En attente"}),i.jsx(Bt,{value:"processing",children:"En traitement"}),i.jsx(Bt,{value:"shipped",children:"Expédiée"}),i.jsx(Bt,{value:"delivered",children:"Livrée"}),i.jsx(Bt,{value:"cancelled",children:"Annulée"})]})]}),i.jsxs(ds,{value:P,onValueChange:R,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Période"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"all",children:"Toutes les périodes"}),i.jsx(Bt,{value:"last-30-days",children:"30 derniers jours"}),i.jsx(Bt,{value:"last-6-months",children:"6 derniers mois"})]})]}),i.jsxs(ds,{value:E,onValueChange:C,children:[i.jsx(is,{className:"w-40",children:i.jsx(hs,{placeholder:"Trier par"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"date-desc",children:"Date (récent → ancien)"}),i.jsx(Bt,{value:"date-asc",children:"Date (ancien → récent)"}),i.jsx(Bt,{value:"total-desc",children:"Prix (élevé → bas)"}),i.jsx(Bt,{value:"total-asc",children:"Prix (bas → élevé)"})]})]})]})})}),i.jsxs(Og,{defaultValue:"all",className:"space-y-4",children:[i.jsxs(Pp,{className:"grid w-full grid-cols-4",children:[i.jsx(Wi,{value:"all",children:"Toutes"}),i.jsx(Wi,{value:"active",children:"En cours"}),i.jsx(Wi,{value:"completed",children:"Terminées"}),i.jsx(Wi,{value:"cancelled",children:"Annulées"})]}),i.jsx(Zi,{value:"all",className:"space-y-4",children:n?i.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((Q,re)=>i.jsx(Tt,{className:"animate-pulse",children:i.jsxs(jt,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between mb-4",children:[i.jsx("div",{className:"h-6 bg-muted rounded w-1/4"}),i.jsx("div",{className:"h-6 bg-muted rounded w-1/6"})]}),i.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})]})},re))}):B().length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(bp,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune vente trouvée"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:e.length===0?"Vous n'avez pas encore réalisé de vente.":"Aucune vente ne correspond à vos critères de recherche."}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:"/create",children:[i.jsx(gi,{className:"w-4 h-4 mr-2"}),"Créer une annonce"]})})]}):i.jsx("div",{className:"space-y-4",children:B().map(Q=>i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsxs(jt,{className:"p-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsxs("h3",{className:"font-semibold",children:["Vente #",Q.id.slice(0,8)]}),V(Q.status)]}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),Pa(new Date(Q.createdAt),"dd MMMM yyyy",{locale:po})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold text-green-600",children:W(Q.total)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[Q.items.length," article",Q.items.length>1?"s":""]})]}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:`/order/${Q.id}`,children:["Détails",i.jsx(Zh,{className:"ml-1 w-4 h-4"})]})})]})]}),i.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-2",children:[Q.items.slice(0,4).map((re,ve)=>i.jsx("div",{className:"flex-shrink-0",children:re.image?i.jsx("img",{src:re.image,alt:re.title,className:"w-16 h-16 object-cover rounded",title:re.title}):i.jsx("div",{className:"w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsx(gi,{className:"w-6 h-6 text-muted-foreground"})})},ve)),Q.items.length>4&&i.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-muted rounded flex items-center justify-center",children:i.jsxs("span",{className:"text-sm font-medium",children:["+",Q.items.length-4]})})]})]})},Q.id))})}),i.jsx(Zi,{value:"active",className:"space-y-4",children:B().filter(Q=>["pending","processing","shipped"].includes(Q.status)).length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Fi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune vente en cours"})]}):i.jsx("div",{className:"space-y-4",children:B().filter(Q=>["pending","processing","shipped"].includes(Q.status)).map(Q=>i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsx(jt,{className:"p-6",children:i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsxs("h3",{className:"font-semibold",children:["Vente #",Q.id.slice(0,8)]}),V(Q.status)]}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),Pa(new Date(Q.createdAt),"dd MMMM yyyy",{locale:po})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold text-green-600",children:W(Q.total)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[Q.items.length," article",Q.items.length>1?"s":""]})]}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:`/order/${Q.id}`,children:["Détails",i.jsx(Zh,{className:"ml-1 w-4 h-4"})]})})]})]})})},Q.id))})}),i.jsx(Zi,{value:"completed",className:"space-y-4",children:B().filter(Q=>Q.status==="delivered").length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(qs,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune vente terminée"})]}):i.jsx("div",{className:"space-y-4",children:B().filter(Q=>Q.status==="delivered").map(Q=>i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsx(jt,{className:"p-6",children:i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsxs("h3",{className:"font-semibold",children:["Vente #",Q.id.slice(0,8)]}),V(Q.status)]}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),Pa(new Date(Q.createdAt),"dd MMMM yyyy",{locale:po})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold text-green-600",children:W(Q.total)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[Q.items.length," article",Q.items.length>1?"s":""]})]}),i.jsx(Ge,{asChild:!0,children:i.jsxs(Nr,{to:`/order/${Q.id}`,children:["Détails",i.jsx(Zh,{className:"ml-1 w-4 h-4"})]})})]})]})})},Q.id))})}),i.jsx(Zi,{value:"cancelled",className:"space-y-4",children:B().filter(Q=>Q.status==="cancelled").length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(fo,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucune vente annulée"})]}):i.jsx("div",{className:"space-y-4",children:B().filter(Q=>Q.status==="cancelled").map(Q=>i.jsx(Tt,{className:"hover:shadow-md transition-shadow",children:i.jsx(jt,{className:"p-6",children:i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsxs("h3",{className:"font-semibold",children:["Vente #",Q.id.slice(0,8)]}),V(Q.status)]}),i.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[i.jsx(cl,{className:"w-3 h-3"}),Pa(new Date(Q.createdAt),"dd MMMM yyyy",{locale:po})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"font-semibold text-muted-foreground",children:W(Q.total)}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[Q.items.length," article",Q.items.length>1?"s":""]})]}),i.jsx(Ge,{asChild:!0,variant:"outline",children:i.jsxs(Nr,{to:`/order/${Q.id}`,children:["Détails",i.jsx(Zh,{className:"ml-1 w-4 h-4"})]})})]})]})})},Q.id))})})]})]}):i.jsx("div",{className:"container mx-auto px-4 py-8 text-center",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6",children:[i.jsx(gi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connectez-vous pour voir vos ventes"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Vous devez être connecté pour accéder à l'historique de vos ventes"}),i.jsx(Ge,{onClick:()=>c("/auth"),children:"Se connecter"})]})})})},RMe=()=>{var W,K,Z,$,X,Q,re,ve,pe,ue,ge,ce;const{id:t}=yE(),{currentUser:e}=$i(),{orders:r,fetchUserOrders:n,loading:c}=bA(),d=Ra(),[p,a]=z.useState(null);z.useEffect(()=>{e&&n(e.uid)},[e,n]),z.useEffect(()=>{if(r.length>0&&t){const Se=r.find(le=>le.id===t);a(Se||null)}},[r,t]);const w=Se=>{switch(Se){case"pending":return i.jsxs(Ir,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[i.jsx(Fi,{className:"w-3 h-3 mr-1"}),"En attente"]});case"processing":return i.jsxs(Ir,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[i.jsx(gi,{className:"w-3 h-3 mr-1"}),"En traitement"]});case"shipped":return i.jsxs(Ir,{className:"bg-purple-100 text-purple-800 border-purple-200",children:[i.jsx(k0,{className:"w-3 h-3 mr-1"}),"Expédiée"]});case"delivered":return i.jsxs(Ir,{className:"bg-green-100 text-green-800 border-green-200",children:[i.jsx(qs,{className:"w-3 h-3 mr-1"}),"Livrée"]});case"cancelled":return i.jsxs(Ir,{className:"bg-red-100 text-red-800 border-red-200",children:[i.jsx(fo,{className:"w-3 h-3 mr-1"}),"Annulée"]});default:return i.jsx(Ir,{children:Se})}},E=(Se,le="EUR")=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:le.toUpperCase()}).format(Se);if(!e)return i.jsx("div",{className:"container mx-auto px-4 py-8 text-center",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6",children:[i.jsx(gi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connectez-vous pour voir vos commandes"}),i.jsx(Ge,{onClick:()=>d("/auth"),children:"Se connecter"})]})})});if(c)return i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx(Tt,{className:"animate-pulse",children:i.jsxs(jt,{className:"p-8",children:[i.jsx("div",{className:"h-8 bg-muted rounded w-1/3 mb-4"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mb-2"}),i.jsx("div",{className:"h-4 bg-muted rounded w-2/3"})]})})});if(!p)return i.jsx("div",{className:"container mx-auto px-4 py-8 text-center",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6",children:[i.jsx(gi,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Commande introuvable"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Cette commande n'existe pas ou vous n'y avez pas accès."}),i.jsxs(Ge,{onClick:()=>d("/orders"),children:[i.jsx(vp,{className:"w-4 h-4 mr-2"}),"Retour aux commandes"]})]})})});const C=((K=(W=p.payment)==null?void 0:W.details)==null?void 0:K.subtotalCents)||0,P=(($=(Z=p.payment)==null?void 0:Z.details)==null?void 0:$.serviceFeeCents)||0,R=((Q=(X=p.payment)==null?void 0:X.details)==null?void 0:Q.processingFeeCents)||0,B=((ve=(re=p.payment)==null?void 0:re.details)==null?void 0:ve.totalCents)||Math.round(p.total*100),V=((ue=(pe=p.payment)==null?void 0:pe.details)==null?void 0:ue.currency)||"EUR";return i.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[i.jsx("div",{className:"flex items-center gap-4",children:i.jsxs(Ge,{variant:"ghost",onClick:()=>d("/orders"),children:[i.jsx(vp,{className:"w-4 h-4 mr-2"}),"Retour"]})}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[i.jsx(Tt,{children:i.jsx(Dr,{children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsxs(kr,{className:"flex items-center gap-2",children:["Commande #",p.id.slice(0,8)]}),i.jsxs(Ls,{className:"flex items-center gap-2 mt-1",children:[i.jsx(cl,{className:"w-4 h-4"}),Pa(new Date(p.createdAt),"dd MMMM yyyy à HH:mm",{locale:po})]})]}),w(p.status)]})})}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{children:"Articles commandés"})}),i.jsx(jt,{className:"space-y-4",children:p.items.map((Se,le)=>i.jsxs("div",{children:[i.jsxs("div",{className:"flex gap-4",children:[Se.image?i.jsx("img",{src:Se.image,alt:Se.title,className:"w-20 h-20 object-cover rounded"}):i.jsx("div",{className:"w-20 h-20 bg-muted rounded flex items-center justify-center",children:i.jsx(gi,{className:"w-8 h-8 text-muted-foreground"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx(Nr,{to:`/listing/${Se.id}`,className:"font-medium hover:text-primary transition-colors",children:Se.title}),i.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-muted-foreground",children:[i.jsxs("span",{children:["Quantité: ",Se.quantity]}),i.jsxs("span",{children:["Prix unitaire: ",E(Se.price,V)]})]})]}),i.jsx("div",{className:"text-right",children:i.jsx("p",{className:"font-semibold",children:E(Se.price*Se.quantity,V)})})]}),le<p.items.length-1&&i.jsx(Zc,{className:"mt-4"})]},le))})]}),p.shipping&&(p.shipping.address||p.shipping.university)&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(dl,{className:"w-5 h-5"}),"Adresse de livraison"]})}),i.jsxs(jt,{className:"space-y-2",children:[p.shipping.fullName&&i.jsx("p",{className:"font-medium",children:p.shipping.fullName}),p.shipping.address&&i.jsx("p",{className:"text-muted-foreground",children:p.shipping.address}),p.shipping.city&&p.shipping.postalCode&&i.jsxs("p",{className:"text-muted-foreground",children:[p.shipping.postalCode," ",p.shipping.city]}),p.shipping.country&&i.jsx("p",{className:"text-muted-foreground",children:p.shipping.country}),p.shipping.university&&i.jsx("div",{className:"mt-2 pt-2 border-t",children:i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Université: ",p.shipping.university]})}),p.shipping.phone&&i.jsxs("p",{className:"flex items-center gap-2 text-muted-foreground",children:[i.jsx(lw,{className:"w-4 h-4"}),p.shipping.phone]})]})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{children:"Récapitulatif"})}),i.jsxs(jt,{className:"space-y-3",children:[i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:"Sous-total"}),i.jsx("span",{children:E(C/100,V)})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:"Frais de service (5%)"}),i.jsx("span",{children:E(P/100,V)})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:"Frais de traitement"}),i.jsx("span",{children:E(R/100,V)})]}),i.jsx(Zc,{}),i.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[i.jsx("span",{children:"Total"}),i.jsx("span",{className:"text-primary",children:E(B/100,V)})]})]})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Aa,{className:"w-5 h-5"}),"Informations de paiement"]})}),i.jsxs(jt,{className:"space-y-3",children:[i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:"Méthode"}),i.jsx("span",{className:"capitalize",children:((ge=p.payment)==null?void 0:ge.method)||"Carte bancaire"})]}),((ce=p.payment)==null?void 0:ce.transactionId)&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:"Transaction ID"}),i.jsxs("span",{className:"font-mono text-xs",children:[p.payment.transactionId.slice(0,16),"..."]})]}),i.jsxs(Ge,{variant:"outline",size:"sm",className:"w-full",onClick:()=>{var Se;return window.open(`https://dashboard.stripe.com/test/payments/${(Se=p.payment)==null?void 0:Se.transactionId}`,"_blank")},children:[i.jsx(Ec,{className:"w-4 h-4 mr-2"}),"Voir sur Stripe"]})]})]})]}),p.trackingNumber&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(k0,{className:"w-5 h-5"}),"Suivi"]})}),i.jsxs(jt,{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Numéro de suivi"}),i.jsx("p",{className:"font-mono text-sm",children:p.trackingNumber})]})]}),p.notes&&i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{children:"Notes"})}),i.jsx(jt,{children:i.jsx("p",{className:"text-sm text-muted-foreground",children:p.notes})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs(Ge,{variant:"outline",className:"w-full",children:[i.jsx(to,{className:"w-4 h-4 mr-2"}),"Télécharger la facture"]}),p.status!=="cancelled"&&p.status!=="delivered"&&i.jsx(Ge,{variant:"destructive",className:"w-full",disabled:!0,children:"Annuler la commande"})]})]})]})]})},MMe=()=>{var C,P;const{orderId:t}=yE(),{getOrderById:e}=bA(),[r,n]=z.useState(null),[c,d]=z.useState(!0);z.useEffect(()=>{(async()=>{if(t)try{d(!0);const B=await e(t);n(B)}catch(B){console.error("Error loading order:",B)}finally{d(!1)}})()},[t,e]);const p=R=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(R),a=R=>({card:"Carte bancaire",paypal:"PayPal",transfer:"Virement bancaire",cash:"Paiement à la livraison"})[R]||R,w=()=>{const R=new Date,B=new Date(R);return B.setDate(R.getDate()+3),Pa(B,"EEEE d MMMM",{locale:po})},E=()=>{navigator.clipboard.writeText(t||""),Nt.success("Numéro de commande copié !")};return c?i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx("div",{className:"max-w-3xl mx-auto",children:i.jsxs("div",{className:"animate-pulse space-y-4",children:[i.jsx("div",{className:"h-8 bg-muted rounded w-3/4 mx-auto"}),i.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mx-auto"}),i.jsx("div",{className:"h-32 bg-muted rounded"}),i.jsx("div",{className:"h-64 bg-muted rounded"})]})})}):r?i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"max-w-3xl mx-auto",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(qs,{className:"w-8 h-8 text-green-600"})}),i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Commande confirmée !"}),i.jsxs("p",{className:"text-muted-foreground",children:["Merci pour votre commande. Vous recevrez un email de confirmation à ",r.shipping.email,"."]})]}),i.jsxs(Tt,{className:"mb-6",children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx(gi,{className:"w-5 h-5"}),"Détails de la commande"]}),i.jsx(Ir,{className:"bg-green-100 text-green-800 border-green-200",children:r.status==="pending"?"En attente":r.status==="processing"?"En traitement":r.status==="shipped"?"Expédiée":r.status==="delivered"?"Livrée":"Confirmée"})]})}),i.jsx(jt,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Numéro de commande"}),i.jsxs("p",{className:"font-medium flex items-center gap-2",children:[t,i.jsx(Ge,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:E,children:i.jsx(lZ,{className:"h-3 w-3"})})]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),i.jsx("p",{className:"font-medium",children:Pa(new Date(r.createdAt),"dd/MM/yyyy")})]})]}),i.jsx(Zc,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-3",children:"Articles"}),i.jsx("div",{className:"space-y-3",children:r.items.map((R,B)=>i.jsxs("div",{className:"flex items-center gap-3",children:[R.image&&i.jsx("img",{src:R.image,alt:R.name,className:"w-16 h-16 object-cover rounded"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-medium",children:R.name}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Quantité: ",R.quantity]})]}),i.jsx("p",{className:"font-semibold",children:p(R.price*R.quantity)})]},B))})]}),i.jsx(Zc,{}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Sous-total"}),i.jsx("span",{children:p(r.total)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Livraison"}),i.jsx("span",{className:"text-green-600",children:"Gratuite"})]}),i.jsxs("div",{className:"flex justify-between font-bold",children:[i.jsx("span",{children:"Total"}),i.jsx("span",{children:p(r.total)})]})]})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-base",children:[i.jsx(k0,{className:"w-4 h-4"}),"Livraison"]})}),i.jsx(jt,{children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"font-medium",children:r.shipping.fullName}),i.jsx("p",{children:r.shipping.address}),i.jsxs("p",{children:[r.shipping.postalCode," ",r.shipping.city,", ",r.shipping.country]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:r.shipping.phone}),i.jsx("div",{className:"pt-2 mt-2 border-t",children:i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx(cl,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("span",{children:["Livraison estimée: ",w()]})]})})]})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2 text-base",children:[i.jsx(Aa,{className:"w-4 h-4"}),"Paiement"]})}),i.jsx(jt,{children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"font-medium",children:a(r.payment.method)}),r.payment.method==="card"&&((C=r.payment.details)==null?void 0:C.cardNumber)&&i.jsxs("p",{children:["Carte se terminant par ",r.payment.details.cardNumber.slice(-4)]}),r.payment.method==="paypal"&&((P=r.payment.details)==null?void 0:P.paypalEmail)&&i.jsx("p",{children:r.payment.details.paypalEmail}),r.payment.method==="transfer"&&i.jsxs(Ys,{className:"mt-2",children:[i.jsx(va,{className:"h-4 w-4"}),i.jsx(Js,{children:"Veuillez effectuer le virement dans les 48h pour valider votre commande."})]}),i.jsx("div",{className:"pt-2 mt-2 border-t",children:i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx(Fi,{className:"w-4 h-4 text-muted-foreground"}),i.jsxs("span",{children:["Statut: ",r.status==="pending"?"En attente":"Confirmé"]})]})})]})})]})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[i.jsx(Ge,{variant:"outline",className:"flex-1",asChild:!0,children:i.jsxs(Nr,{to:"/orders",children:[i.jsx(gi,{className:"mr-2 h-4 w-4"}),"Mes commandes"]})}),i.jsxs(Ge,{variant:"outline",className:"flex-1",children:[i.jsx(to,{className:"mr-2 h-4 w-4"}),"Télécharger la facture"]}),i.jsx(Ge,{className:"flex-1 bg-gradient-to-r from-primary to-secondary",asChild:!0,children:i.jsxs(Nr,{to:"/listings",children:[i.jsx(Z_,{className:"mr-2 h-4 w-4"}),"Continuer mes achats"]})})]}),i.jsxs("div",{className:"mt-8 text-center",children:[i.jsx("p",{className:"text-muted-foreground mb-2",children:"Besoin d'aide avec votre commande ?"}),i.jsxs("div",{className:"flex justify-center gap-4",children:[i.jsxs(Ge,{variant:"link",className:"text-primary",children:[i.jsx(Nl,{className:"mr-2 h-4 w-4"}),"Contacter le support"]}),i.jsxs(Ge,{variant:"link",className:"text-primary",children:[i.jsx(fg,{className:"mr-2 h-4 w-4"}),"FAQ"]})]})]})]})}):i.jsx("div",{className:"container mx-auto px-4 py-8 text-center",children:i.jsx(Tt,{children:i.jsxs(jt,{className:"pt-6",children:[i.jsx(va,{className:"w-12 h-12 text-blue-500 mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Commande introuvable"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Nous n'avons pas pu trouver les détails de cette commande."}),i.jsx(Ge,{asChild:!0,children:i.jsx(Nr,{to:"/orders",children:"Voir mes commandes"})})]})})})},DMe=()=>{const[t]=xE(),e=Ra(),{currentUser:r}=$i(),{clearCart:n}=HE(),[c,d]=z.useState(!0),[p,a]=z.useState(null),[w,E]=z.useState(null),[C,P]=z.useState(null),R=t.get("session_id"),B=t.get("type")==="subscription";z.useEffect(()=>{n();async function W(){if(r)try{if(d(!0),B){const Z=await dIe();a(Z)}else{const $=(await hIe())[0];E($)}}catch(Z){console.error("Error fetching checkout result:",Z),P("Impossible de charger les détails de votre achat")}finally{d(!1)}}const K=setTimeout(()=>{W()},2e3);return()=>clearTimeout(K)},[r,B,R,n]);const V=()=>{if(B&&(p!=null&&p.price_id)){const W=CMe(p.price_id);return W?W.name:"Abonnement"}else if(w)return"Commande";return"Achat"};return r?c?i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"max-w-md mx-auto text-center",children:[i.jsx(Ka,{className:"w-12 h-12 animate-spin text-primary mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Traitement de votre paiement..."}),i.jsx("p",{className:"text-muted-foreground",children:"Veuillez patienter pendant que nous confirmons votre transaction."})]})}):C?i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"max-w-md mx-auto",children:[i.jsxs(Ys,{className:"border-red-200 bg-red-50",children:[i.jsx(va,{className:"h-4 w-4 text-red-600"}),i.jsx(Js,{className:"text-red-800",children:C})]}),i.jsx("div",{className:"mt-4 text-center",children:i.jsx(Ge,{asChild:!0,children:i.jsx(Nr,{to:"/",children:"Retour à l'accueil"})})})]})}):i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"max-w-md mx-auto",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(qs,{className:"w-8 h-8 text-green-600"})}),i.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Merci pour votre achat !"}),i.jsxs("p",{className:"text-muted-foreground",children:["Votre ",B?"abonnement":"commande"," a été confirmé",B?"":"e","."]})]}),i.jsxs(Tt,{className:"mb-6",children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[B?i.jsx(Aa,{className:"w-5 h-5"}):i.jsx(gi,{className:"w-5 h-5"}),V()]})}),i.jsx(jt,{children:i.jsx("div",{className:"space-y-4",children:B&&p?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Statut:"}),i.jsx("span",{className:"font-medium",children:p.subscription_status==="active"?"Actif":p.subscription_status==="trialing"?"Période d'essai":p.subscription_status})]}),p.current_period_end&&i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Prochain renouvellement:"}),i.jsx("span",{className:"font-medium",children:new Date(p.current_period_end*1e3).toLocaleDateString("fr-FR")})]}),p.payment_method_brand&&i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Méthode de paiement:"}),i.jsxs("span",{className:"font-medium",children:[p.payment_method_brand.toUpperCase()," •••• ",p.payment_method_last4]})]})]}):w?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Numéro de commande:"}),i.jsx("span",{className:"font-medium",children:w.order_id})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Date:"}),i.jsx("span",{className:"font-medium",children:new Date(w.order_date).toLocaleDateString("fr-FR")})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Montant:"}),i.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:w.currency}).format(w.amount_total/100)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Statut:"}),i.jsx("span",{className:"font-medium",children:w.order_status==="completed"?"Complété":w.order_status==="pending"?"En attente":w.order_status})]})]}):i.jsx("p",{children:"Merci pour votre achat. Vous recevrez un email de confirmation."})})})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs(Ys,{className:"bg-blue-50 border-blue-200",children:[i.jsx(cl,{className:"h-4 w-4 text-blue-600"}),i.jsx(Js,{className:"text-blue-800",children:B?"Vous pouvez gérer votre abonnement à tout moment depuis votre compte.":"Vous recevrez un email de confirmation avec les détails de votre commande."})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[i.jsx(Ge,{variant:"outline",className:"flex-1",asChild:!0,children:i.jsxs(Nr,{to:"/orders",children:[i.jsx(gi,{className:"mr-2 h-4 w-4"}),"Mes commandes"]})}),i.jsx(Ge,{className:"flex-1 bg-gradient-to-r from-primary to-secondary",asChild:!0,children:i.jsxs(Nr,{to:"/products",children:[i.jsx(Z_,{className:"mr-2 h-4 w-4"}),"Continuer mes achats",i.jsx(fg,{className:"ml-2 h-4 w-4"})]})})]})]})]})}):i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"max-w-md mx-auto",children:[i.jsxs(Ys,{className:"border-blue-200 bg-blue-50",children:[i.jsx(va,{className:"h-4 w-4 text-blue-600"}),i.jsx(Js,{className:"text-blue-800",children:"Vous devez être connecté pour voir les détails de votre achat."})]}),i.jsx("div",{className:"mt-4 text-center",children:i.jsx(Ge,{onClick:()=>e("/auth"),children:"Se connecter"})})]})})},OMe=()=>{var $;const{id:t}=yE(),e=Ra();$i();const{currentListing:r,loading:n,fetchListingById:c}=mw(),[d,p]=z.useState(!1),[a,w]=z.useState(!1);z.useEffect(()=>{t&&c(t)},[t,c]);const E=async X=>{p(!0);try{console.log("Paiement réussi:",X),e(`/payment/success?payment_intent=${X.id}`)}catch(Q){console.error("Erreur lors du traitement du paiement:",Q)}finally{p(!1)}},C=X=>{console.error("Erreur de paiement:",X)};if(n)return i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"animate-pulse space-y-6",children:[i.jsx("div",{className:"h-8 bg-muted rounded w-1/4"}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsx("div",{className:"h-96 bg-muted rounded-lg"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"h-8 bg-muted rounded w-3/4"}),i.jsx("div",{className:"h-6 bg-muted rounded w-1/2"})]})]})]})});if(!r)return i.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[i.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Annonce introuvable"}),i.jsx(Ge,{onClick:()=>e("/listings"),children:"Retour aux annonces"})]});const P=(X,Q)=>{const re=Q||"EUR";return new Intl.NumberFormat("fr-FR",{style:"currency",currency:re}).format(X)},R=(r==null?void 0:r.price)||0,B=.05,V=.25,W=Math.round(R*B*100)/100,K=V,Z=Math.round((R+W+K)*100)/100;return i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx("div",{className:"border-b border-border bg-muted/30",children:i.jsx("div",{className:"container mx-auto px-4 py-4",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs(Ge,{variant:"ghost",onClick:()=>e(-1),className:"-ml-4",children:[i.jsx(vp,{className:"w-4 h-4 mr-2"}),"Retour"]}),i.jsx("h1",{className:"text-xl font-semibold",children:"Finaliser l'achat"})]})})}),i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{children:"Résumé de votre commande"})}),i.jsxs(jt,{className:"space-y-4",children:[i.jsxs("div",{className:"flex gap-4",children:[r.images&&r.images.length>0&&i.jsx("img",{src:r.images[0],alt:r.title,className:"w-20 h-20 object-cover rounded-lg"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold",children:r.title}),i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:r.description}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx(Ir,{variant:"secondary",children:r.condition})})]})]}),i.jsxs("div",{className:"pt-4 border-t space-y-2",children:[i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{children:"Sous-total"}),i.jsx("span",{children:P(R,r.currency)})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{children:"Frais de service (5%)"}),i.jsx("span",{children:P(W,r.currency)})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{children:"Frais de traitement"}),i.jsx("span",{children:P(K,r.currency)})]}),i.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[i.jsx("span",{className:"text-lg font-semibold",children:"Total estimé"}),i.jsx("span",{className:"text-2xl font-bold text-primary",children:P(Z,r.currency)})]})]})]})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsx(kr,{children:"Vendeur"})}),i.jsx(jt,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs(Jc,{className:"w-12 h-12",children:[i.jsx(cf,{src:r.sellerAvatar}),i.jsx(Sc,{children:($=r.sellerName[0])==null?void 0:$.toUpperCase()})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold",children:r.sellerName}),i.jsx("p",{className:"text-sm text-muted-foreground",children:r.sellerUniversity})]})]})})]}),i.jsxs(Tt,{children:[i.jsx(Dr,{children:i.jsxs(kr,{className:"flex items-center gap-2",children:[i.jsx(Ms,{className:"w-5 h-5"}),"Garanties StudyMarket"]})}),i.jsxs(jt,{className:"space-y-3 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ms,{className:"w-4 h-4 text-green-600"}),i.jsx("span",{children:"Transaction sécurisée"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Fi,{className:"w-4 h-4 text-blue-600"}),i.jsx("span",{children:"Support client 24/7"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Aa,{className:"w-4 h-4 text-purple-600"}),i.jsx("span",{children:"Paiement protégé"})]})]})]})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4 space-y-3",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Des frais de service peuvent s'appliquer. En payant, vous acceptez nos Conditions et la Politique de remboursement."}),i.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[i.jsx("input",{type:"checkbox",checked:a,onChange:X=>w(X.target.checked)}),"J'accepte les conditions de vente"]})]}),i.jsx(CJ,{listing:r,onPaymentSuccess:E,onPaymentError:C,enabled:a})]})]})})]})},LMe=()=>{var w,E,C,P;const[t]=xE();Ra();const{currentUser:e}=$i(),[r,n]=z.useState(null),[c,d]=z.useState(!0),p=t.get("payment_intent");z.useEffect(()=>{const R=t.get("orderId");if(R){let B=0;const V=15,W=async()=>{var K,Z;try{const X=await fetch(`http://localhost:3001/api/orders/${R}/status`);if(!X.ok)throw new Error("Erreur lors de la récupération du statut");const Q=await X.json();if(console.log("📊 Statut commande:",Q),Q.status==="paid"){const re=await Xa(hn(rr,"orders",R));if(re.exists()){const ve=re.data();n({id:re.id,...ve,createdAt:((Z=(K=ve.createdAt)==null?void 0:K.toDate)==null?void 0:Z.call(K))||new Date})}return d(!1),!0}return B++>=V?(console.log("⏱️ Timeout du polling"),d(!1),!0):!1}catch($){return console.error("❌ Erreur poll:",$),!1}};W().then(K=>{if(K)return;const Z=setInterval(async()=>{await W()&&clearInterval(Z)},2e3);return()=>clearInterval(Z)})}else p&&e?(async()=>{var V,W;try{const K=ms(jn(rr,"orders"),ii("payment.details.paymentIntentId","==",p),ii("userId","==",e.uid),eo("createdAt","desc"),la(1)),Z=await gs(K);if(!Z.empty){const $=Z.docs[0],X=$.data();n({id:$.id,...X,createdAt:((W=(V=X.createdAt)==null?void 0:V.toDate)==null?void 0:W.call(V))||new Date})}}catch(K){console.error("Erreur lors de la récupération de la commande:",K)}finally{d(!1)}})():d(!1)},[p,e,t]);const a=(R,B="EUR")=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:B.toUpperCase()}).format(R);return c?i.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:i.jsxs("div",{className:"w-full max-w-md text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),i.jsx("p",{className:"text-muted-foreground",children:"Chargement des détails de votre commande..."})]})}):i.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:i.jsxs("div",{className:"w-full max-w-2xl",children:[i.jsx(Tt,{children:i.jsxs(jt,{className:"p-8 text-center",children:[i.jsx(qs,{className:"w-20 h-20 text-green-500 mx-auto mb-6"}),i.jsx("h1",{className:"text-2xl font-bold text-green-700 mb-4",children:"Paiement réussi !"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Votre paiement a été traité avec succès. Vous recevrez un email de confirmation dans les prochaines minutes."}),r&&i.jsxs("div",{className:"bg-muted/50 p-6 rounded-lg mb-6 space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-left",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Numéro de commande"}),i.jsxs("p",{className:"font-semibold",children:["#",r.id.slice(0,8)]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Date"}),i.jsxs("p",{className:"font-semibold flex items-center gap-1",children:[i.jsx(cl,{className:"w-4 h-4"}),Pa(r.createdAt,"dd/MM/yyyy HH:mm",{locale:po})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Montant total"}),i.jsxs("p",{className:"font-bold text-lg text-green-600 flex items-center gap-1",children:[i.jsx(_y,{className:"w-5 h-5"}),a(r.total,((E=(w=r.payment)==null?void 0:w.details)==null?void 0:E.currency)||"EUR")]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Articles"}),i.jsxs("p",{className:"font-semibold",children:[((C=r.items)==null?void 0:C.length)||0," article",((P=r.items)==null?void 0:P.length)>1?"s":""]})]})]}),r.items&&r.items.length>0&&i.jsxs("div",{className:"border-t border-border pt-4 mt-4",children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-3 text-left font-medium",children:"Articles commandés :"}),i.jsx("div",{className:"space-y-2",children:r.items.map((R,B)=>{var V,W;return i.jsxs("div",{className:"flex items-center gap-3 text-left bg-background p-3 rounded",children:[R.image&&i.jsx("img",{src:R.image,alt:R.title,className:"w-12 h-12 object-cover rounded"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-medium text-sm",children:R.title}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Quantité: ",R.quantity," × ",a(R.price,((W=(V=r.payment)==null?void 0:V.details)==null?void 0:W.currency)||"EUR")]})]})]},B)})})]}),i.jsxs("div",{className:"border-t border-border pt-4 mt-4",children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Référence de transaction"}),i.jsx("p",{className:"font-mono text-xs break-all",children:p})]})]}),!r&&p&&i.jsxs("div",{className:"bg-muted p-4 rounded-lg mb-6",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Référence de transaction :"}),i.jsx("p",{className:"font-mono text-sm break-all",children:p})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx(Ge,{asChild:!0,className:"w-full",children:i.jsxs(Nr,{to:"/orders",children:[i.jsx(gi,{className:"w-4 h-4 mr-2"}),"Voir mes commandes"]})}),i.jsx(Ge,{variant:"outline",asChild:!0,className:"w-full",children:i.jsxs(Nr,{to:"/listings",children:[i.jsx(fg,{className:"w-4 h-4 mr-2"}),"Continuer mes achats"]})}),i.jsx(Ge,{variant:"ghost",asChild:!0,className:"w-full",children:i.jsxs(Nr,{to:"/",children:[i.jsx(qd,{className:"w-4 h-4 mr-2"}),"Retour à l'accueil"]})})]})]})}),i.jsx("div",{className:"mt-6 text-center",children:i.jsx("p",{className:"text-sm text-muted-foreground",children:"Des questions ? Contactez notre support client"})})]})})},FMe=[{value:"electronics",label:"Électronique"},{value:"books",label:"Livres & Cours"},{value:"furniture",label:"Mobilier"},{value:"clothing",label:"Vêtements"},{value:"services",label:"Services"},{value:"housing",label:"Logement"},{value:"jobs",label:"Jobs & Stages"},{value:"donations",label:"Dons"},{value:"exchange",label:"Troc"}],zMe=()=>{const{id:t}=yE(),e=Ra(),{currentUser:r}=$i(),{fetchListingById:n,updateListing:c,currentListing:d,loading:p}=mw(),[a,w]=z.useState({title:"",description:"",price:"",images:[]}),[E,C]=z.useState([]),[P,R]=z.useState(!1),[B,V]=z.useState(null),[W,K]=z.useState(""),[Z,$]=z.useState([]),[X,Q]=z.useState(""),[re,ve]=z.useState(void 0);z.useEffect(()=>{t&&n(t)},[t,n]),z.useEffect(()=>{var ke,Ze;d&&(w({title:d.title||"",description:d.description||"",price:((ke=d.price)==null?void 0:ke.toString())||"",images:d.images||[]}),K(d.category||""),$(d.tags||[]),(Ze=d.location)!=null&&Ze.coordinates&&!isNaN(d.location.coordinates.lat)&&!isNaN(d.location.coordinates.lng)&&d.location.coordinates.lat!==0&&d.location.coordinates.lng!==0&&ve({address:`${d.location.city}, ${d.location.state}`,latitude:d.location.coordinates.lat,longitude:d.location.coordinates.lng}))},[d]);const pe=ke=>{w({...a,[ke.target.name]:ke.target.value})},ue=ke=>{if(!ke.target.files)return;const Ze=Array.from(ke.target.files);C(Xe=>[...Xe,...Ze])},ge=ke=>{w({...a,images:a.images.filter((Ze,Xe)=>Xe!==ke)})},ce=ke=>{C(E.filter((Ze,Xe)=>Xe!==ke))},Se=()=>{X.trim()&&!Z.includes(X.trim())&&Z.length<5&&($([...Z,X.trim()]),Q(""))},le=ke=>{$(Z.filter(Ze=>Ze!==ke))},J=async ke=>{if(ke.preventDefault(),!(!t||!r)){R(!0);try{let Ze=[];E.length>0&&(Ze=await Promise.all(E.map($e=>BMe($e,r.uid))));const Xe=[...a.images,...Ze],qe={...a,price:parseFloat(a.price),images:Xe,category:W,tags:Z};re&&(qe.location={...d==null?void 0:d.location,city:re.address.split(",")[0]||(d==null?void 0:d.location.city),coordinates:{lat:re.latitude,lng:re.longitude}},qe.meetingPoint=re.address),await c(t,qe),e(`/listing/${t}`)}catch{V("Erreur lors de la mise à jour de l'annonce")}finally{R(!1)}}};return p?i.jsx("div",{children:"Chargement..."}):d?B?i.jsx("div",{className:"text-red-500",children:B}):i.jsx("form",{onSubmit:J,className:"max-w-lg mx-auto mt-10",children:i.jsxs("div",{className:"bg-white dark:bg-card rounded-2xl shadow-lg p-8 border border-gray-100 dark:border-border",children:[i.jsx("h2",{className:"text-2xl font-bold mb-8 text-left",children:"Modifier mon annonce"}),i.jsxs("div",{className:"mb-5",children:[i.jsx(Zr,{htmlFor:"title",className:"block mb-1 text-gray-700",children:"Titre"}),i.jsx(Gr,{id:"title",name:"title",value:a.title,onChange:pe,placeholder:"Titre",className:"w-full"})]}),i.jsxs("div",{className:"mb-5",children:[i.jsx(Zr,{htmlFor:"description",className:"block mb-1 text-gray-700",children:"Description"}),i.jsx(id,{id:"description",name:"description",value:a.description,onChange:pe,placeholder:"Description",className:"w-full",rows:4})]}),i.jsxs("div",{className:"mb-5",children:[i.jsx(Zr,{htmlFor:"price",className:"block mb-1 text-gray-700",children:"Prix (€)"}),i.jsx(Gr,{id:"price",name:"price",value:a.price,onChange:pe,placeholder:"Prix",type:"number",min:0,className:"w-full"})]}),i.jsxs("div",{className:"mb-5",children:[i.jsx(Zr,{htmlFor:"category",className:"block mb-1 text-gray-700",children:"Catégorie"}),i.jsxs("select",{id:"category",name:"category",value:W,onChange:ke=>K(ke.target.value),className:"w-full border rounded px-3 py-2 bg-gray-50",required:!0,children:[i.jsx("option",{value:"",children:"Sélectionnez une catégorie"}),FMe.map(ke=>i.jsx("option",{value:ke.value,children:ke.label},ke.value))]})]}),i.jsxs("div",{className:"mb-5",children:[i.jsx(Zr,{className:"block mb-1 text-gray-700",children:"Tags (max 5)"}),i.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:Z.map(ke=>i.jsxs("span",{className:"bg-gray-100 rounded px-2 py-1 flex items-center gap-1 text-sm",children:[ke,i.jsx(Ge,{type:"button",size:"icon",variant:"ghost",className:"w-4 h-4 p-0",onClick:()=>le(ke),children:"×"})]},ke))}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Gr,{placeholder:"Ajouter un tag...",value:X,onChange:ke=>Q(ke.target.value),onKeyDown:ke=>ke.key==="Enter"&&(ke.preventDefault(),Se()),className:"flex-1"}),i.jsx(Ge,{type:"button",onClick:Se,disabled:!X.trim()||Z.length>=5,children:"Ajouter"})]})]}),i.jsx("div",{className:"mb-5",children:i.jsx(HQ,{onLocationSelect:ve,initialLocation:re,placeholder:"Sélectionnez un nouveau point de rencontre"})}),i.jsxs("div",{className:"mb-8",children:[i.jsx(Zr,{className:"block mb-1 text-gray-700",children:"Photos"}),i.jsxs("div",{className:"flex flex-wrap gap-4 mt-2",children:[a.images.map((ke,Ze)=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:ke,alt:`photo-${Ze}`,className:"w-20 h-20 object-cover rounded-lg border border-gray-200"}),i.jsx(Ge,{type:"button",size:"icon",variant:"destructive",className:"absolute top-1 right-1 w-6 h-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity shadow-md",onClick:()=>ge(Ze),children:i.jsx(of,{className:"w-4 h-4"})})]},Ze)),E.map((ke,Ze)=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:URL.createObjectURL(ke),alt:`new-photo-${Ze}`,className:"w-20 h-20 object-cover rounded-lg border border-gray-200"}),i.jsx(Ge,{type:"button",size:"icon",variant:"destructive",className:"absolute top-1 right-1 w-6 h-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity shadow-md",onClick:()=>ce(Ze),children:i.jsx(of,{className:"w-4 h-4"})})]},Ze)),i.jsxs("label",{className:"w-20 h-20 flex items-center justify-center border-2 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition",children:[i.jsx("span",{className:"text-2xl text-gray-400",children:"+"}),i.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:ue,disabled:P})]})]})]}),i.jsx(Ge,{type:"submit",className:"w-full",disabled:P,children:P?"Enregistrement...":"Enregistrer les modifications"}),B&&i.jsx("div",{className:"text-red-500 text-center mt-2",children:B})]})}):i.jsx("div",{className:"text-red-500",children:"Annonce introuvable"})};async function BMe(t,e){const r=Date.now(),n=`listings/${e}/${r}_${t.name}`,c=A0(gy,n),d=await R3(c,t);return await zC(d.ref)}const VMe=()=>{const[t,e]=z.useState([]),[r,n]=z.useState(!0),[c,d]=z.useState(""),[p,a]=z.useState({type:"",contract:"",level:"",city:"",remote:""}),w=[{id:"1",title:"Développeur Frontend React - Stage",company:"TechStart Paris",description:"Rejoins notre équipe pour développer des interfaces modernes avec React et TypeScript. Formation et mentoring assurés.",type:"stage",contract:"stage",salary:{min:600,max:800,period:"month"},location:{city:"Paris",remote:!0,university:"Sorbonne Université"},requirements:{level:"master",experience:"Débutant accepté",skills:["React","TypeScript","CSS"]},schedule:{hours:"35h/semaine",flexible:!0},contact:{email:"stage@techstart.fr",website:"techstart.fr"},postedAt:new Date,deadline:new Date("2025-02-28")},{id:"2",title:"Cours particuliers Mathématiques",company:"Particulier",description:"Recherche étudiant en Master Maths pour donner des cours à domicile niveau lycée.",type:"cours-particuliers",contract:"freelance",salary:{min:20,max:25,period:"hour"},location:{city:"Paris 16e",remote:!1},requirements:{level:"master",experience:"Première expérience souhaitée",skills:["Mathématiques","Pédagogie"]},schedule:{hours:"2h/semaine",flexible:!0},contact:{email:"marie.martin@example.com",phone:"06.12.34.56.78"},postedAt:new Date,deadline:new Date("2025-01-30")},{id:"3",title:"Assistant Marketing Digital",company:"Agence Digital Plus",description:"Job étudiant flexible. Gestion réseaux sociaux et création de contenu pour nos clients.",type:"job-etudiant",contract:"cdd",salary:{min:12,max:15,period:"hour"},location:{city:"Lyon",remote:!0},requirements:{level:"licence",experience:"Débutant accepté",skills:["Réseaux sociaux","Canva","Communication"]},schedule:{hours:"15h/semaine",flexible:!0},contact:{email:"recrutement@digitalplus.fr"},postedAt:new Date}];z.useEffect(()=>{(async()=>{n(!0);try{c||Object.keys(p).length>0,setTimeout(()=>{e(w),n(!1)},1e3)}catch(W){console.error("Erreur recherche emplois:",W),n(!1)}})()},[c,p]);const E=V=>{d(V)},C=(V,W)=>{a(K=>({...K,[V]:W}))},P=V=>{switch(V){case"stage":return i.jsx(up,{className:"w-4 h-4"});case"job-etudiant":return i.jsx(cS,{className:"w-4 h-4"});case"cours-particuliers":return i.jsx(up,{className:"w-4 h-4"});case"babysitting":return i.jsx(cS,{className:"w-4 h-4"});default:return i.jsx(cS,{className:"w-4 h-4"})}},R=V=>{switch(V){case"stage":return"bg-blue-100 text-blue-800";case"job-etudiant":return"bg-green-100 text-green-800";case"cours-particuliers":return"bg-purple-100 text-purple-800";case"babysitting":return"bg-pink-100 text-pink-800";case"freelance":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},B=V=>{const{min:W,max:K,period:Z}=V,$=Z==="hour"?"/h":Z==="month"?"/mois":"/an";return W===K?`${W}€${$}`:`${W}-${K}€${$}`};return i.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950",children:i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Jobs & Stages étudiants"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Trouvez l'opportunité parfaite compatible avec vos études"})]}),i.jsx("div",{className:"mb-6",children:i.jsxs("div",{className:"relative",children:[i.jsx(Oo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),i.jsx(Gr,{type:"text",placeholder:"Rechercher par poste, entreprise, compétences...",value:c,onChange:V=>E(V.target.value),className:"pl-10 py-3 text-lg"})]})}),i.jsxs("div",{className:"mb-8 grid grid-cols-1 md:grid-cols-5 gap-4",children:[i.jsxs(ds,{onValueChange:V=>C("type",V),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Type d'emploi"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"stage",children:"Stages"}),i.jsx(Bt,{value:"job-etudiant",children:"Jobs étudiants"}),i.jsx(Bt,{value:"cours-particuliers",children:"Cours particuliers"}),i.jsx(Bt,{value:"babysitting",children:"Baby-sitting"}),i.jsx(Bt,{value:"freelance",children:"Freelance"})]})]}),i.jsxs(ds,{onValueChange:V=>C("level",V),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Niveau d'études"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"tous-niveaux",children:"Tous niveaux"}),i.jsx(Bt,{value:"licence",children:"Licence"}),i.jsx(Bt,{value:"master",children:"Master"}),i.jsx(Bt,{value:"doctorat",children:"Doctorat"})]})]}),i.jsx(Gr,{type:"text",placeholder:"Ville",value:p.city,onChange:V=>C("city",V.target.value)}),i.jsxs(ds,{onValueChange:V=>C("remote",V),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Modalité"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"true",children:"Télétravail"}),i.jsx(Bt,{value:"false",children:"Présentiel"})]})]}),i.jsxs(ds,{onValueChange:V=>C("contract",V),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Contrat"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"stage",children:"Stage"}),i.jsx(Bt,{value:"cdd",children:"CDD"}),i.jsx(Bt,{value:"freelance",children:"Freelance"}),i.jsx(Bt,{value:"interim",children:"Intérim"})]})]})]}),r?i.jsx("div",{className:"space-y-4",children:[...Array(5)].map((V,W)=>i.jsx(Tt,{className:"animate-pulse",children:i.jsxs(jt,{className:"p-6",children:[i.jsx("div",{className:"h-6 bg-gray-200 rounded mb-2"}),i.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),i.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})},W))}):i.jsx("div",{className:"space-y-4",children:t.map(V=>i.jsx(Tt,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:i.jsxs(jt,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("h3",{className:"text-xl font-semibold",children:V.title}),i.jsxs(Ir,{className:R(V.type),children:[P(V.type),i.jsx("span",{className:"ml-1 capitalize",children:V.type.replace("-"," ")})]})]}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mb-2",children:V.company}),i.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4 line-clamp-2",children:V.description})]}),i.jsxs("div",{className:"text-right ml-4",children:[i.jsx("div",{className:"text-2xl font-bold text-primary mb-1",children:B(V.salary)}),i.jsx("div",{className:"text-sm text-gray-500",children:V.schedule.hours})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 text-sm text-gray-600 dark:text-gray-400",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(dl,{className:"w-4 h-4 mr-1"}),V.location.city,V.location.remote&&i.jsx(Ir,{variant:"secondary",className:"ml-2 text-xs",children:"Télétravail possible"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx(up,{className:"w-4 h-4 mr-1"}),V.requirements.level]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx(Fi,{className:"w-4 h-4 mr-1"}),"Publié il y a ",Math.floor((Date.now()-V.postedAt.getTime())/(1e3*60*60*24))," jours"]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[V.requirements.skills.slice(0,4).map((W,K)=>i.jsx(Ir,{variant:"outline",className:"text-xs",children:W},K)),V.requirements.skills.length>4&&i.jsxs(Ir,{variant:"outline",className:"text-xs",children:["+",V.requirements.skills.length-4," autres"]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:"text-sm text-gray-500",children:V.deadline&&i.jsxs("span",{children:["Candidature avant le ",V.deadline.toLocaleDateString("fr-FR")]})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Ge,{variant:"outline",size:"sm",children:"Sauvegarder"}),i.jsx(Ge,{size:"sm",children:"Postuler"})]})]})]})},V.id))})]})})},UMe=()=>{const[t,e]=z.useState([]),[r,n]=z.useState(!0),[c,d]=z.useState(""),[p,a]=z.useState({type:"",minPrice:"",maxPrice:"",university:"",furnished:""}),w=[{id:"1",title:"Studio proche Sorbonne",description:"Joli studio meublé à 5min à pied de la Sorbonne. Parfait pour étudiant.",price:650,type:"studio",location:{address:"12 rue de la Sorbonne",city:"Paris",university:"Sorbonne Université",distance:.3},features:{rooms:1,surface:25,furnished:!0,charges:!0},images:["/api/placeholder/400/300"],contact:{name:"Marie D.",email:"marie.d@example.com"},availability:new Date("2025-02-01"),createdAt:new Date},{id:"2",title:"Chambre en colocation - Dauphine",description:"Chambre dans coloc sympa avec 3 autres étudiants. Cuisine équipée.",price:480,type:"colocation",location:{address:"45 avenue de Neuilly",city:"Paris",university:"Université Paris-Dauphine",distance:.8},features:{rooms:1,surface:15,furnished:!0,charges:!0},images:["/api/placeholder/400/300"],contact:{name:"Thomas L.",email:"thomas.l@example.com"},availability:new Date("2025-01-20"),createdAt:new Date}];z.useEffect(()=>{(async()=>{n(!0);try{c||Object.keys(p).length>0,setTimeout(()=>{e(w),n(!1)},1e3)}catch(V){console.error("Erreur recherche logements:",V),n(!1)}})()},[c,p]);const E=B=>{d(B)},C=(B,V)=>{a(W=>({...W,[B]:V}))},P=B=>{switch(B){case"studio":return i.jsx(qd,{className:"w-4 h-4"});case"appartement":return i.jsx(qd,{className:"w-4 h-4"});case"chambre":return i.jsx(qd,{className:"w-4 h-4"});case"colocation":return i.jsx(Sp,{className:"w-4 h-4"});default:return i.jsx(qd,{className:"w-4 h-4"})}},R=B=>{switch(B){case"studio":return"bg-blue-100 text-blue-800";case"appartement":return"bg-green-100 text-green-800";case"chambre":return"bg-purple-100 text-purple-800";case"colocation":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return i.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950",children:i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Logements étudiants"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Trouvez le logement parfait près de votre campus"})]}),i.jsx("div",{className:"mb-6",children:i.jsxs("div",{className:"relative",children:[i.jsx(Oo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),i.jsx(Gr,{type:"text",placeholder:"Rechercher par ville, université, quartier...",value:c,onChange:B=>E(B.target.value),className:"pl-10 py-3 text-lg"})]})}),i.jsxs("div",{className:"mb-8 grid grid-cols-1 md:grid-cols-5 gap-4",children:[i.jsxs(ds,{onValueChange:B=>C("type",B),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Type de logement"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"studio",children:"Studio"}),i.jsx(Bt,{value:"appartement",children:"Appartement"}),i.jsx(Bt,{value:"chambre",children:"Chambre"}),i.jsx(Bt,{value:"colocation",children:"Colocation"})]})]}),i.jsx(Gr,{type:"number",placeholder:"Prix min (€)",value:p.minPrice,onChange:B=>C("minPrice",B.target.value)}),i.jsx(Gr,{type:"number",placeholder:"Prix max (€)",value:p.maxPrice,onChange:B=>C("maxPrice",B.target.value)}),i.jsxs(ds,{onValueChange:B=>C("university",B),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Université"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"sorbonne",children:"Sorbonne Université"}),i.jsx(Bt,{value:"dauphine",children:"Paris-Dauphine"}),i.jsx(Bt,{value:"assas",children:"Panthéon-Assas"}),i.jsx(Bt,{value:"sciences-po",children:"Sciences Po"})]})]}),i.jsxs(ds,{onValueChange:B=>C("furnished",B),children:[i.jsx(is,{children:i.jsx(hs,{placeholder:"Meublé"})}),i.jsxs(as,{children:[i.jsx(Bt,{value:"true",children:"Meublé"}),i.jsx(Bt,{value:"false",children:"Non meublé"})]})]})]}),r?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((B,V)=>i.jsxs(Tt,{className:"animate-pulse",children:[i.jsx("div",{className:"h-48 bg-gray-200 rounded-t-lg"}),i.jsxs(jt,{className:"p-4",children:[i.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),i.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),i.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]},V))}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(B=>i.jsxs(Tt,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[i.jsxs("div",{className:"relative",children:[i.jsx("img",{src:B.images[0],alt:B.title,className:"w-full h-48 object-cover rounded-t-lg"}),i.jsxs(Ir,{className:`absolute top-3 left-3 ${R(B.type)}`,children:[P(B.type),i.jsx("span",{className:"ml-1 capitalize",children:B.type})]})]}),i.jsxs(jt,{className:"p-4",children:[i.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",children:B.title}),i.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400 mb-2",children:[i.jsx(dl,{className:"w-4 h-4 mr-1"}),i.jsxs("span",{className:"text-sm",children:[B.location.city," • ",B.location.distance,"km du campus"]})]}),i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center text-primary font-bold text-xl",children:[i.jsx(_y,{className:"w-5 h-5 mr-1"}),B.price,i.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:"/mois"})]}),i.jsxs("span",{className:"text-sm text-gray-500",children:[B.features.surface,"m²"]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[B.features.furnished&&i.jsx(Ir,{variant:"secondary",className:"text-xs",children:"Meublé"}),B.features.charges&&i.jsx(Ir,{variant:"secondary",className:"text-xs",children:"Charges comprises"})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"text-sm text-gray-500",children:["Disponible le ",B.availability.toLocaleDateString("fr-FR")]}),i.jsx(Ge,{size:"sm",children:"Contacter"})]})]})]},B.id))}),!r&&t.length===0&&i.jsxs("div",{className:"text-center py-12",children:[i.jsx(qd,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),i.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Aucun logement trouvé"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Essayez de modifier vos critères de recherche"})]}),i.jsx("div",{className:"mt-12 text-center",children:i.jsx(Tt,{className:"bg-gradient-to-r from-primary/10 to-secondary/10 border-primary/20",children:i.jsxs(jt,{className:"p-6",children:[i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Vous proposez un logement ?"}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Publiez votre annonce gratuitement et touchez des milliers d'étudiants"}),i.jsx(Ge,{size:"lg",children:"Publier une annonce logement"})]})})})]})})},$Me=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>ny(async()=>{const{default:n}=await Promise.resolve().then(()=>ww);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)};class cF extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class qMe extends cF{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class GMe extends cF{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class HMe extends cF{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var yO;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(yO||(yO={}));var WMe=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function a(C){try{E(n.next(C))}catch(P){p(P)}}function w(C){try{E(n.throw(C))}catch(P){p(P)}}function E(C){C.done?d(C.value):c(C.value).then(a,w)}E((n=n.apply(t,e||[])).next())})};class ZMe{constructor(e,{headers:r={},customFetch:n,region:c=yO.Any}={}){this.url=e,this.headers=r,this.region=c,this.fetch=$Me(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,r={}){var n;return WMe(this,void 0,void 0,function*(){try{const{headers:c,method:d,body:p}=r;let a={},{region:w}=r;w||(w=this.region),w&&w!=="any"&&(a["x-region"]=w);let E;p&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)&&(typeof Blob<"u"&&p instanceof Blob||p instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",E=p):typeof p=="string"?(a["Content-Type"]="text/plain",E=p):typeof FormData<"u"&&p instanceof FormData?E=p:(a["Content-Type"]="application/json",E=JSON.stringify(p)));const C=yield this.fetch(`${this.url}/${e}`,{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),c),body:E}).catch(V=>{throw new qMe(V)}),P=C.headers.get("x-relay-error");if(P&&P==="true")throw new GMe(C);if(!C.ok)throw new HMe(C);let R=((n=C.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),B;return R==="application/json"?B=yield C.json():R==="application/octet-stream"?B=yield C.blob():R==="text/event-stream"?B=C:R==="multipart/form-data"?B=yield C.formData():B=yield C.text(),{data:B,error:null}}catch(c){return{data:null,error:c}}})}}var Kc={},uF={},SA={},tT={},EA={},TA={},KMe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},H0=KMe();const XMe=H0.fetch,Jee=H0.fetch.bind(H0),Qee=H0.Headers,YMe=H0.Request,JMe=H0.Response,ww=Object.freeze(Object.defineProperty({__proto__:null,Headers:Qee,Request:YMe,Response:JMe,default:Jee,fetch:XMe},Symbol.toStringTag,{value:"Module"})),QMe=c9(ww);var jA={};Object.defineProperty(jA,"__esModule",{value:!0});let eDe=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};jA.default=eDe;var ete=Ya&&Ya.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(TA,"__esModule",{value:!0});const tDe=ete(QMe),rDe=ete(jA);let nDe=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=tDe.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,r){return this.headers=Object.assign({},this.headers),this.headers[e]=r,this}then(e,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let c=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{var p,a,w;let E=null,C=null,P=null,R=d.status,B=d.statusText;if(d.ok){if(this.method!=="HEAD"){const Z=await d.text();Z===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?C=Z:C=JSON.parse(Z))}const W=(p=this.headers.Prefer)===null||p===void 0?void 0:p.match(/count=(exact|planned|estimated)/),K=(a=d.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");W&&K&&K.length>1&&(P=parseInt(K[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(C)&&(C.length>1?(E={code:"PGRST116",details:`Results contain ${C.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},C=null,P=null,R=406,B="Not Acceptable"):C.length===1?C=C[0]:C=null)}else{const W=await d.text();try{E=JSON.parse(W),Array.isArray(E)&&d.status===404&&(C=[],E=null,R=200,B="OK")}catch{d.status===404&&W===""?(R=204,B="No Content"):E={message:W}}if(E&&this.isMaybeSingle&&(!((w=E==null?void 0:E.details)===null||w===void 0)&&w.includes("0 rows"))&&(E=null,R=200,B="OK"),E&&this.shouldThrowOnError)throw new rDe.default(E)}return{error:E,data:C,count:P,status:R,statusText:B}});return this.shouldThrowOnError||(c=c.catch(d=>{var p,a,w;return{error:{message:`${(p=d==null?void 0:d.name)!==null&&p!==void 0?p:"FetchError"}: ${d==null?void 0:d.message}`,details:`${(a=d==null?void 0:d.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(w=d==null?void 0:d.code)!==null&&w!==void 0?w:""}`},data:null,count:null,status:0,statusText:""}})),c.then(e,r)}returns(){return this}overrideTypes(){return this}};TA.default=nDe;var sDe=Ya&&Ya.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(EA,"__esModule",{value:!0});const iDe=sDe(TA);let aDe=class extends iDe.default{select(e){let r=!1;const n=(e??"*").split("").map(c=>/\s/.test(c)&&!r?"":(c==='"'&&(r=!r),c)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:r=!0,nullsFirst:n,foreignTable:c,referencedTable:d=c}={}){const p=d?`${d}.order`:"order",a=this.url.searchParams.get(p);return this.url.searchParams.set(p,`${a?`${a},`:""}${e}.${r?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:r,referencedTable:n=r}={}){const c=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(c,`${e}`),this}range(e,r,{foreignTable:n,referencedTable:c=n}={}){const d=typeof c>"u"?"offset":`${c}.offset`,p=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${e}`),this.url.searchParams.set(p,`${r-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:r=!1,settings:n=!1,buffers:c=!1,wal:d=!1,format:p="text"}={}){var a;const w=[e?"analyze":null,r?"verbose":null,n?"settings":null,c?"buffers":null,d?"wal":null].filter(Boolean).join("|"),E=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${p}; for="${E}"; options=${w};`,p==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};EA.default=aDe;var oDe=Ya&&Ya.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(tT,"__esModule",{value:!0});const lDe=oDe(EA);let cDe=class extends lDe.default{eq(e,r){return this.url.searchParams.append(e,`eq.${r}`),this}neq(e,r){return this.url.searchParams.append(e,`neq.${r}`),this}gt(e,r){return this.url.searchParams.append(e,`gt.${r}`),this}gte(e,r){return this.url.searchParams.append(e,`gte.${r}`),this}lt(e,r){return this.url.searchParams.append(e,`lt.${r}`),this}lte(e,r){return this.url.searchParams.append(e,`lte.${r}`),this}like(e,r){return this.url.searchParams.append(e,`like.${r}`),this}likeAllOf(e,r){return this.url.searchParams.append(e,`like(all).{${r.join(",")}}`),this}likeAnyOf(e,r){return this.url.searchParams.append(e,`like(any).{${r.join(",")}}`),this}ilike(e,r){return this.url.searchParams.append(e,`ilike.${r}`),this}ilikeAllOf(e,r){return this.url.searchParams.append(e,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(e,r){return this.url.searchParams.append(e,`ilike(any).{${r.join(",")}}`),this}is(e,r){return this.url.searchParams.append(e,`is.${r}`),this}in(e,r){const n=Array.from(new Set(r)).map(c=>typeof c=="string"&&new RegExp("[,()]").test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,r){return typeof r=="string"?this.url.searchParams.append(e,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(e,`cs.{${r.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(r)}`),this}containedBy(e,r){return typeof r=="string"?this.url.searchParams.append(e,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(e,`cd.{${r.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(r)}`),this}rangeGt(e,r){return this.url.searchParams.append(e,`sr.${r}`),this}rangeGte(e,r){return this.url.searchParams.append(e,`nxl.${r}`),this}rangeLt(e,r){return this.url.searchParams.append(e,`sl.${r}`),this}rangeLte(e,r){return this.url.searchParams.append(e,`nxr.${r}`),this}rangeAdjacent(e,r){return this.url.searchParams.append(e,`adj.${r}`),this}overlaps(e,r){return typeof r=="string"?this.url.searchParams.append(e,`ov.${r}`):this.url.searchParams.append(e,`ov.{${r.join(",")}}`),this}textSearch(e,r,{config:n,type:c}={}){let d="";c==="plain"?d="pl":c==="phrase"?d="ph":c==="websearch"&&(d="w");const p=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${d}fts${p}.${r}`),this}match(e){return Object.entries(e).forEach(([r,n])=>{this.url.searchParams.append(r,`eq.${n}`)}),this}not(e,r,n){return this.url.searchParams.append(e,`not.${r}.${n}`),this}or(e,{foreignTable:r,referencedTable:n=r}={}){const c=n?`${n}.or`:"or";return this.url.searchParams.append(c,`(${e})`),this}filter(e,r,n){return this.url.searchParams.append(e,`${r}.${n}`),this}};tT.default=cDe;var uDe=Ya&&Ya.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(SA,"__esModule",{value:!0});const A1=uDe(tT);let dDe=class{constructor(e,{headers:r={},schema:n,fetch:c}){this.url=e,this.headers=r,this.schema=n,this.fetch=c}select(e,{head:r=!1,count:n}={}){const c=r?"HEAD":"GET";let d=!1;const p=(e??"*").split("").map(a=>/\s/.test(a)&&!d?"":(a==='"'&&(d=!d),a)).join("");return this.url.searchParams.set("select",p),n&&(this.headers.Prefer=`count=${n}`),new A1.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:r,defaultToNull:n=!0}={}){const c="POST",d=[];if(this.headers.Prefer&&d.push(this.headers.Prefer),r&&d.push(`count=${r}`),n||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(e)){const p=e.reduce((a,w)=>a.concat(Object.keys(w)),[]);if(p.length>0){const a=[...new Set(p)].map(w=>`"${w}"`);this.url.searchParams.set("columns",a.join(","))}}return new A1.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:r,ignoreDuplicates:n=!1,count:c,defaultToNull:d=!0}={}){const p="POST",a=[`resolution=${n?"ignore":"merge"}-duplicates`];if(r!==void 0&&this.url.searchParams.set("on_conflict",r),this.headers.Prefer&&a.push(this.headers.Prefer),c&&a.push(`count=${c}`),d||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const w=e.reduce((E,C)=>E.concat(Object.keys(C)),[]);if(w.length>0){const E=[...new Set(w)].map(C=>`"${C}"`);this.url.searchParams.set("columns",E.join(","))}}return new A1.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:r}={}){const n="PATCH",c=[];return this.headers.Prefer&&c.push(this.headers.Prefer),r&&c.push(`count=${r}`),this.headers.Prefer=c.join(","),new A1.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const r="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new A1.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};SA.default=dDe;var NA={},IA={};Object.defineProperty(IA,"__esModule",{value:!0});IA.version=void 0;IA.version="0.0.0-automated";Object.defineProperty(NA,"__esModule",{value:!0});NA.DEFAULT_HEADERS=void 0;const hDe=IA;NA.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${hDe.version}`};var tte=Ya&&Ya.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(uF,"__esModule",{value:!0});const fDe=tte(SA),pDe=tte(tT),mDe=NA;let gDe=class rte{constructor(e,{headers:r={},schema:n,fetch:c}={}){this.url=e,this.headers=Object.assign(Object.assign({},mDe.DEFAULT_HEADERS),r),this.schemaName=n,this.fetch=c}from(e){const r=new URL(`${this.url}/${e}`);return new fDe.default(r,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new rte(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,r={},{head:n=!1,get:c=!1,count:d}={}){let p;const a=new URL(`${this.url}/rpc/${e}`);let w;n||c?(p=n?"HEAD":"GET",Object.entries(r).filter(([C,P])=>P!==void 0).map(([C,P])=>[C,Array.isArray(P)?`{${P.join(",")}}`:`${P}`]).forEach(([C,P])=>{a.searchParams.append(C,P)})):(p="POST",w=r);const E=Object.assign({},this.headers);return d&&(E.Prefer=`count=${d}`),new pDe.default({method:p,url:a,headers:E,schema:this.schemaName,body:w,fetch:this.fetch,allowEmpty:!1})}};uF.default=gDe;var bw=Ya&&Ya.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Kc,"__esModule",{value:!0});Kc.PostgrestError=Kc.PostgrestBuilder=Kc.PostgrestTransformBuilder=Kc.PostgrestFilterBuilder=Kc.PostgrestQueryBuilder=Kc.PostgrestClient=void 0;const nte=bw(uF);Kc.PostgrestClient=nte.default;const ste=bw(SA);Kc.PostgrestQueryBuilder=ste.default;const ite=bw(tT);Kc.PostgrestFilterBuilder=ite.default;const ate=bw(EA);Kc.PostgrestTransformBuilder=ate.default;const ote=bw(TA);Kc.PostgrestBuilder=ote.default;const lte=bw(jA);Kc.PostgrestError=lte.default;var _De=Kc.default={PostgrestClient:nte.default,PostgrestQueryBuilder:ste.default,PostgrestFilterBuilder:ite.default,PostgrestTransformBuilder:ate.default,PostgrestBuilder:ote.default,PostgrestError:lte.default};const{PostgrestClient:yDe,PostgrestQueryBuilder:RLe,PostgrestFilterBuilder:MLe,PostgrestTransformBuilder:DLe,PostgrestBuilder:OLe,PostgrestError:LLe}=_De;let xO;typeof window>"u"?xO=require("ws"):xO=window.WebSocket;const xDe=xO,vDe="2.11.10",wDe={"X-Client-Info":`realtime-js/${vDe}`},bDe="1.0.0",cte=1e4,SDe=1e3;var f0;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(f0||(f0={}));var xc;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(xc||(xc={}));var Vd;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Vd||(Vd={}));var vO;(function(t){t.websocket="websocket"})(vO||(vO={}));var M_;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(M_||(M_={}));class EDe{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const c=r.getUint8(1),d=r.getUint8(2);let p=this.HEADER_LENGTH+2;const a=n.decode(e.slice(p,p+c));p=p+c;const w=n.decode(e.slice(p,p+d));p=p+d;const E=JSON.parse(n.decode(e.slice(p,e.byteLength)));return{ref:null,topic:a,event:w,payload:E}}}class ute{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ga;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(ga||(ga={}));const Z$=(t,e,r={})=>{var n;const c=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((d,p)=>(d[p]=TDe(p,t,e,c),d),{})},TDe=(t,e,r,n)=>{const c=e.find(a=>a.name===t),d=c==null?void 0:c.type,p=r[t];return d&&!n.includes(d)?dte(d,p):wO(p)},dte=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return CDe(e,r)}switch(t){case ga.bool:return jDe(e);case ga.float4:case ga.float8:case ga.int2:case ga.int4:case ga.int8:case ga.numeric:case ga.oid:return NDe(e);case ga.json:case ga.jsonb:return IDe(e);case ga.timestamp:return ADe(e);case ga.abstime:case ga.date:case ga.daterange:case ga.int4range:case ga.int8range:case ga.money:case ga.reltime:case ga.text:case ga.time:case ga.timestamptz:case ga.timetz:case ga.tsrange:case ga.tstzrange:return wO(e);default:return wO(e)}},wO=t=>t,jDe=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},NDe=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},IDe=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},CDe=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let d;const p=t.slice(1,r);try{d=JSON.parse("["+p+"]")}catch{d=p?p.split(","):[]}return d.map(a=>dte(e,a))}return t},ADe=t=>typeof t=="string"?t.replace(" ","T"):t,hte=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class sM{constructor(e,r,n={},c=cte){this.channel=e,this.event=r,this.payload=n,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var K$;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(K$||(K$={}));class dS{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},c=>{const{onJoin:d,onLeave:p,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=dS.syncState(this.state,c,d,p),this.pendingDiffs.forEach(w=>{this.state=dS.syncDiff(this.state,w,d,p)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},c=>{const{onJoin:d,onLeave:p,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=dS.syncDiff(this.state,c,d,p),a())}),this.onJoin((c,d,p)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:d,newPresences:p})}),this.onLeave((c,d,p)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:d,leftPresences:p})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,c){const d=this.cloneDeep(e),p=this.transformState(r),a={},w={};return this.map(d,(E,C)=>{p[E]||(w[E]=C)}),this.map(p,(E,C)=>{const P=d[E];if(P){const R=C.map(K=>K.presence_ref),B=P.map(K=>K.presence_ref),V=C.filter(K=>B.indexOf(K.presence_ref)<0),W=P.filter(K=>R.indexOf(K.presence_ref)<0);V.length>0&&(a[E]=V),W.length>0&&(w[E]=W)}else a[E]=C}),this.syncDiff(d,{joins:a,leaves:w},n,c)}static syncDiff(e,r,n,c){const{joins:d,leaves:p}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),c||(c=()=>{}),this.map(d,(a,w)=>{var E;const C=(E=e[a])!==null&&E!==void 0?E:[];if(e[a]=this.cloneDeep(w),C.length>0){const P=e[a].map(B=>B.presence_ref),R=C.filter(B=>P.indexOf(B.presence_ref)<0);e[a].unshift(...R)}n(a,C,w)}),this.map(p,(a,w)=>{let E=e[a];if(!E)return;const C=w.map(P=>P.presence_ref);E=E.filter(P=>C.indexOf(P.presence_ref)<0),e[a]=E,c(a,E,w),E.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const c=e[n];return"metas"in c?r[n]=c.metas.map(d=>(d.presence_ref=d.phx_ref,delete d.phx_ref,delete d.phx_ref_prev,d)):r[n]=c,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var X$;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(X$||(X$={}));var Y$;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Y$||(Y$={}));var Xf;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Xf||(Xf={}));class dF{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=xc.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new sM(this,Vd.join,this.params,this.timeout),this.rejoinTimer=new ute(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=xc.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=xc.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=xc.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=xc.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Vd.reply,{},(c,d)=>{this._trigger(this._replyEventName(d),c)}),this.presence=new dS(this),this.broadcastEndpointURL=hte(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,c;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:d,presence:p,private:a}}=this.params;this._onError(C=>e==null?void 0:e(Xf.CHANNEL_ERROR,C)),this._onClose(()=>e==null?void 0:e(Xf.CLOSED));const w={},E={broadcast:d,presence:p,postgres_changes:(c=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(C=>C.filter))!==null&&c!==void 0?c:[],private:a};this.socket.accessTokenValue&&(w.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:E},w)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:C})=>{var P;if(this.socket.setAuth(),C===void 0){e==null||e(Xf.SUBSCRIBED);return}else{const R=this.bindings.postgres_changes,B=(P=R==null?void 0:R.length)!==null&&P!==void 0?P:0,V=[];for(let W=0;W<B;W++){const K=R[W],{filter:{event:Z,schema:$,table:X,filter:Q}}=K,re=C&&C[W];if(re&&re.event===Z&&re.schema===$&&re.table===X&&re.filter===Q)V.push(Object.assign(Object.assign({},K),{id:re.id}));else{this.unsubscribe(),this.state=xc.errored,e==null||e(Xf.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=V,e&&e(Xf.SUBSCRIBED);return}}).receive("error",C=>{this.state=xc.errored,e==null||e(Xf.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(C).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Xf.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this._on(e,r,n)}async send(e,r={}){var n,c;if(!this._canPush()&&e.type==="broadcast"){const{event:d,payload:p}=e,w={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:d,payload:p,private:this.private}]})};try{const E=await this._fetchWithTimeout(this.broadcastEndpointURL,w,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((c=E.body)===null||c===void 0?void 0:c.cancel()),E.ok?"ok":"error"}catch(E){return E.name==="AbortError"?"timed out":"error"}}else return new Promise(d=>{var p,a,w;const E=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((w=(a=(p=this.params)===null||p===void 0?void 0:p.config)===null||a===void 0?void 0:a.broadcast)===null||w===void 0)&&w.ack)&&d("ok"),E.receive("ok",()=>d("ok")),E.receive("error",()=>d("error")),E.receive("timeout",()=>d("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=xc.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Vd.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise(n=>{const c=new sM(this,Vd.leave,{},e);c.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),c.send(),this._canPush()||c.trigger("ok",{})})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,r,n){const c=new AbortController,d=setTimeout(()=>c.abort(),n),p=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:c.signal}));return clearTimeout(d),p}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new sM(this,e,r,n);return this._canPush()?c.send():(c.startTimeout(),this.pushBuffer.push(c)),c}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var c,d;const p=e.toLocaleLowerCase(),{close:a,error:w,leave:E,join:C}=Vd;if(n&&[a,w,E,C].indexOf(p)>=0&&n!==this._joinRef())return;let R=this._onMessage(p,r,n);if(r&&!R)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(p)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(B=>{var V,W,K;return((V=B.filter)===null||V===void 0?void 0:V.event)==="*"||((K=(W=B.filter)===null||W===void 0?void 0:W.event)===null||K===void 0?void 0:K.toLocaleLowerCase())===p}).map(B=>B.callback(R,n)):(d=this.bindings[p])===null||d===void 0||d.filter(B=>{var V,W,K,Z,$,X;if(["broadcast","presence","postgres_changes"].includes(p))if("id"in B){const Q=B.id,re=(V=B.filter)===null||V===void 0?void 0:V.event;return Q&&((W=r.ids)===null||W===void 0?void 0:W.includes(Q))&&(re==="*"||(re==null?void 0:re.toLocaleLowerCase())===((K=r.data)===null||K===void 0?void 0:K.type.toLocaleLowerCase()))}else{const Q=($=(Z=B==null?void 0:B.filter)===null||Z===void 0?void 0:Z.event)===null||$===void 0?void 0:$.toLocaleLowerCase();return Q==="*"||Q===((X=r==null?void 0:r.event)===null||X===void 0?void 0:X.toLocaleLowerCase())}else return B.type.toLocaleLowerCase()===p}).map(B=>{if(typeof R=="object"&&"ids"in R){const V=R.data,{schema:W,table:K,commit_timestamp:Z,type:$,errors:X}=V;R=Object.assign(Object.assign({},{schema:W,table:K,commit_timestamp:Z,eventType:$,new:{},old:{},errors:X}),this._getPayloadRecords(V))}B.callback(R,n)})}_isClosed(){return this.state===xc.closed}_isJoined(){return this.state===xc.joined}_isJoining(){return this.state===xc.joining}_isLeaving(){return this.state===xc.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const c=e.toLocaleLowerCase(),d={type:c,filter:r,callback:n};return this.bindings[c]?this.bindings[c].push(d):this.bindings[c]=[d],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(c=>{var d;return!(((d=c.type)===null||d===void 0?void 0:d.toLocaleLowerCase())===n&&dF.isEqual(c.filter,r))}),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Vd.close,{},e)}_onError(e){this._on(Vd.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=xc.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=Z$(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=Z$(e.columns,e.old_record)),r}}const J$=()=>{},PDe=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class kDe{constructor(e,r){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=wDe,this.params={},this.timeout=cte,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=J$,this.ref=0,this.logger=J$,this.conn=null,this.sendBuffer=[],this.serializer=new EDe,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=d=>{let p;return d?p=d:typeof fetch>"u"?p=(...a)=>ny(async()=>{const{default:w}=await Promise.resolve().then(()=>ww);return{default:w}},void 0).then(({default:w})=>w(...a)):p=fetch,(...a)=>p(...a)},this.endPoint=`${e}/${vO.websocket}`,this.httpEndpoint=hte(e),r!=null&&r.transport?this.transport=r.transport:this.transport=null,r!=null&&r.params&&(this.params=r.params),r!=null&&r.headers&&(this.headers=Object.assign(Object.assign({},this.headers),r.headers)),r!=null&&r.timeout&&(this.timeout=r.timeout),r!=null&&r.logger&&(this.logger=r.logger),(r!=null&&r.logLevel||r!=null&&r.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),r!=null&&r.heartbeatIntervalMs&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);const c=(n=r==null?void 0:r.params)===null||n===void 0?void 0:n.apikey;if(c&&(this.accessTokenValue=c,this.apiKey=c),this.reconnectAfterMs=r!=null&&r.reconnectAfterMs?r.reconnectAfterMs:d=>[1e3,2e3,5e3,1e4][d-1]||1e4,this.encode=r!=null&&r.encode?r.encode:(d,p)=>p(JSON.stringify(d)),this.decode=r!=null&&r.decode?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ute(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(r==null?void 0:r.fetch),r!=null&&r.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(r==null?void 0:r.worker)||!1,this.workerUrl=r==null?void 0:r.workerUrl}this.accessToken=(r==null?void 0:r.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=xDe),this.transport){typeof window<"u"&&this.transport===window.WebSocket?this.conn=new this.transport(this.endpointURL()):this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection();return}this.conn=new RDe(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:bDe}))}disconnect(e,r){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,r??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels=this.channels.filter(n=>n._joinRef!==e._joinRef),this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case f0.connecting:return M_.Connecting;case f0.open:return M_.Open;case f0.closing:return M_.Closing;default:return M_.Closed}}isConnected(){return this.connectionState()===M_.Open}channel(e,r={config:{}}){const n=`realtime:${e}`,c=this.getChannels().find(d=>d.topic===n);if(c)return c;{const d=new dF(`realtime:${e}`,r,this);return this.channels.push(d),d}}push(e){const{topic:r,event:n,payload:c,ref:d}=e,p=()=>{this.encode(e,a=>{var w;(w=this.conn)===null||w===void 0||w.send(a)})};this.log("push",`${r} ${n} (${d})`,c),this.isConnected()?p():this.sendBuffer.push(p)}async setAuth(e=null){let r=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{r&&n.updateJoinPayload({access_token:r,version:this.headers&&this.headers["X-Client-Info"]}),n.joinedOnce&&n._isJoined()&&n._push(Vd.access_token,{access_token:r})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(SDe,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,r=>{let{topic:n,event:c,payload:d,ref:p}=r;n==="phoenix"&&c==="phx_reply"&&this.heartbeatCallback(r.payload.status=="ok"?"ok":"error"),p&&p===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${d.status||""} ${n} ${c} ${p&&"("+p+")"||""}`,d),Array.from(this.channels).filter(a=>a._isMember(n)).forEach(a=>a._trigger(c,d,p)),this.stateChangeCallbacks.message.forEach(a=>a(r))})}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(r=>r(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(r=>r(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Vd.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",c=new URLSearchParams(r);return`${e}${n}${c}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([PDe],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}}class RDe{constructor(e,r,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=f0.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}}class hF extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function il(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class MDe extends hF{constructor(e,r){super(e),this.name="StorageApiError",this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class bO extends hF{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var DDe=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function a(C){try{E(n.next(C))}catch(P){p(P)}}function w(C){try{E(n.throw(C))}catch(P){p(P)}}function E(C){C.done?d(C.value):c(C.value).then(a,w)}E((n=n.apply(t,e||[])).next())})};const fte=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>ny(async()=>{const{default:n}=await Promise.resolve().then(()=>ww);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},ODe=()=>DDe(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ny(()=>Promise.resolve().then(()=>ww),void 0)).Response:Response}),SO=t=>{if(Array.isArray(t))return t.map(r=>SO(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const c=r.replace(/([-_][a-z])/gi,d=>d.toUpperCase().replace(/[-_]/g,""));e[c]=SO(n)}),e};var Vy=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function a(C){try{E(n.next(C))}catch(P){p(P)}}function w(C){try{E(n.throw(C))}catch(P){p(P)}}function E(C){C.done?d(C.value):c(C.value).then(a,w)}E((n=n.apply(t,e||[])).next())})};const iM=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),LDe=(t,e,r)=>Vy(void 0,void 0,void 0,function*(){const n=yield ODe();t instanceof n&&!(r!=null&&r.noResolveJson)?t.json().then(c=>{e(new MDe(iM(c),t.status||500))}).catch(c=>{e(new bO(iM(c),c))}):e(new bO(iM(t),t))}),FDe=(t,e,r,n)=>{const c={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n&&(c.body=JSON.stringify(n)),Object.assign(Object.assign({},c),r))};function rT(t,e,r,n,c,d){return Vy(this,void 0,void 0,function*(){return new Promise((p,a)=>{t(r,FDe(e,n,c,d)).then(w=>{if(!w.ok)throw w;return n!=null&&n.noResolveJson?w:w.json()}).then(w=>p(w)).catch(w=>LDe(w,a,n))})})}function VI(t,e,r,n){return Vy(this,void 0,void 0,function*(){return rT(t,"GET",e,r,n)})}function Mm(t,e,r,n,c){return Vy(this,void 0,void 0,function*(){return rT(t,"POST",e,n,c,r)})}function zDe(t,e,r,n,c){return Vy(this,void 0,void 0,function*(){return rT(t,"PUT",e,n,c,r)})}function BDe(t,e,r,n){return Vy(this,void 0,void 0,function*(){return rT(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function pte(t,e,r,n,c){return Vy(this,void 0,void 0,function*(){return rT(t,"DELETE",e,n,c,r)})}var qc=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function a(C){try{E(n.next(C))}catch(P){p(P)}}function w(C){try{E(n.throw(C))}catch(P){p(P)}}function E(C){C.done?d(C.value):c(C.value).then(a,w)}E((n=n.apply(t,e||[])).next())})};const VDe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Q$={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class UDe{constructor(e,r={},n,c){this.url=e,this.headers=r,this.bucketId=n,this.fetch=fte(c)}uploadOrUpdate(e,r,n,c){return qc(this,void 0,void 0,function*(){try{let d;const p=Object.assign(Object.assign({},Q$),c);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(p.upsert)});const w=p.metadata;typeof Blob<"u"&&n instanceof Blob?(d=new FormData,d.append("cacheControl",p.cacheControl),w&&d.append("metadata",this.encodeMetadata(w)),d.append("",n)):typeof FormData<"u"&&n instanceof FormData?(d=n,d.append("cacheControl",p.cacheControl),w&&d.append("metadata",this.encodeMetadata(w))):(d=n,a["cache-control"]=`max-age=${p.cacheControl}`,a["content-type"]=p.contentType,w&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(w)))),c!=null&&c.headers&&(a=Object.assign(Object.assign({},a),c.headers));const E=this._removeEmptyFolders(r),C=this._getFinalPath(E),P=yield this.fetch(`${this.url}/object/${C}`,Object.assign({method:e,body:d,headers:a},p!=null&&p.duplex?{duplex:p.duplex}:{})),R=yield P.json();return P.ok?{data:{path:E,id:R.Id,fullPath:R.Key},error:null}:{data:null,error:R}}catch(d){if(il(d))return{data:null,error:d};throw d}})}upload(e,r,n){return qc(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,c){return qc(this,void 0,void 0,function*(){const d=this._removeEmptyFolders(e),p=this._getFinalPath(d),a=new URL(this.url+`/object/upload/sign/${p}`);a.searchParams.set("token",r);try{let w;const E=Object.assign({upsert:Q$.upsert},c),C=Object.assign(Object.assign({},this.headers),{"x-upsert":String(E.upsert)});typeof Blob<"u"&&n instanceof Blob?(w=new FormData,w.append("cacheControl",E.cacheControl),w.append("",n)):typeof FormData<"u"&&n instanceof FormData?(w=n,w.append("cacheControl",E.cacheControl)):(w=n,C["cache-control"]=`max-age=${E.cacheControl}`,C["content-type"]=E.contentType);const P=yield this.fetch(a.toString(),{method:"PUT",body:w,headers:C}),R=yield P.json();return P.ok?{data:{path:d,fullPath:R.Key},error:null}:{data:null,error:R}}catch(w){if(il(w))return{data:null,error:w};throw w}})}createSignedUploadUrl(e,r){return qc(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const c=Object.assign({},this.headers);r!=null&&r.upsert&&(c["x-upsert"]="true");const d=yield Mm(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:c}),p=new URL(this.url+d.url),a=p.searchParams.get("token");if(!a)throw new hF("No token returned by API");return{data:{signedUrl:p.toString(),path:e,token:a},error:null}}catch(n){if(il(n))return{data:null,error:n};throw n}})}update(e,r,n){return qc(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return qc(this,void 0,void 0,function*(){try{return{data:yield Mm(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(c){if(il(c))return{data:null,error:c};throw c}})}copy(e,r,n){return qc(this,void 0,void 0,function*(){try{return{data:{path:(yield Mm(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(c){if(il(c))return{data:null,error:c};throw c}})}createSignedUrl(e,r,n){return qc(this,void 0,void 0,function*(){try{let c=this._getFinalPath(e),d=yield Mm(this.fetch,`${this.url}/object/sign/${c}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const p=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return d={signedUrl:encodeURI(`${this.url}${d.signedURL}${p}`)},{data:d,error:null}}catch(c){if(il(c))return{data:null,error:c};throw c}})}createSignedUrls(e,r,n){return qc(this,void 0,void 0,function*(){try{const c=yield Mm(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),d=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:c.map(p=>Object.assign(Object.assign({},p),{signedUrl:p.signedURL?encodeURI(`${this.url}${p.signedURL}${d}`):null})),error:null}}catch(c){if(il(c))return{data:null,error:c};throw c}})}download(e,r){return qc(this,void 0,void 0,function*(){const c=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",d=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),p=d?`?${d}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield VI(this.fetch,`${this.url}/${c}/${a}${p}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(il(a))return{data:null,error:a};throw a}})}info(e){return qc(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield VI(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:SO(n),error:null}}catch(n){if(il(n))return{data:null,error:n};throw n}})}exists(e){return qc(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield BDe(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(il(n)&&n instanceof bO){const c=n.originalError;if([400,404].includes(c==null?void 0:c.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),c=[],d=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";d!==""&&c.push(d);const a=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",w=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});w!==""&&c.push(w);let E=c.join("&");return E!==""&&(E=`?${E}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${E}`)}}}remove(e){return qc(this,void 0,void 0,function*(){try{return{data:yield pte(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(il(r))return{data:null,error:r};throw r}})}list(e,r,n){return qc(this,void 0,void 0,function*(){try{const c=Object.assign(Object.assign(Object.assign({},VDe),r),{prefix:e||""});return{data:yield Mm(this.fetch,`${this.url}/object/list/${this.bucketId}`,c,{headers:this.headers},n),error:null}}catch(c){if(il(c))return{data:null,error:c};throw c}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const $De="2.7.1",qDe={"X-Client-Info":`storage-js/${$De}`};var vv=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function a(C){try{E(n.next(C))}catch(P){p(P)}}function w(C){try{E(n.throw(C))}catch(P){p(P)}}function E(C){C.done?d(C.value):c(C.value).then(a,w)}E((n=n.apply(t,e||[])).next())})};class GDe{constructor(e,r={},n){this.url=e,this.headers=Object.assign(Object.assign({},qDe),r),this.fetch=fte(n)}listBuckets(){return vv(this,void 0,void 0,function*(){try{return{data:yield VI(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(il(e))return{data:null,error:e};throw e}})}getBucket(e){return vv(this,void 0,void 0,function*(){try{return{data:yield VI(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(il(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return vv(this,void 0,void 0,function*(){try{return{data:yield Mm(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(il(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return vv(this,void 0,void 0,function*(){try{return{data:yield zDe(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(il(n))return{data:null,error:n};throw n}})}emptyBucket(e){return vv(this,void 0,void 0,function*(){try{return{data:yield Mm(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(il(r))return{data:null,error:r};throw r}})}deleteBucket(e){return vv(this,void 0,void 0,function*(){try{return{data:yield pte(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(il(r))return{data:null,error:r};throw r}})}}class HDe extends GDe{constructor(e,r={},n){super(e,r,n)}from(e){return new UDe(this.url,this.headers,e,this.fetch)}}const WDe="2.50.0";let G1="";typeof Deno<"u"?G1="deno":typeof document<"u"?G1="web":typeof navigator<"u"&&navigator.product==="ReactNative"?G1="react-native":G1="node";const ZDe={"X-Client-Info":`supabase-js-${G1}/${WDe}`},KDe={headers:ZDe},XDe={schema:"public"},YDe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},JDe={};var QDe=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function a(C){try{E(n.next(C))}catch(P){p(P)}}function w(C){try{E(n.throw(C))}catch(P){p(P)}}function E(C){C.done?d(C.value):c(C.value).then(a,w)}E((n=n.apply(t,e||[])).next())})};const eOe=t=>{let e;return t?e=t:typeof fetch>"u"?e=Jee:e=fetch,(...r)=>e(...r)},tOe=()=>typeof Headers>"u"?Qee:Headers,rOe=(t,e,r)=>{const n=eOe(r),c=tOe();return(d,p)=>QDe(void 0,void 0,void 0,function*(){var a;const w=(a=yield e())!==null&&a!==void 0?a:t;let E=new c(p==null?void 0:p.headers);return E.has("apikey")||E.set("apikey",t),E.has("Authorization")||E.set("Authorization",`Bearer ${w}`),n(d,Object.assign(Object.assign({},p),{headers:E}))})};var nOe=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function a(C){try{E(n.next(C))}catch(P){p(P)}}function w(C){try{E(n.throw(C))}catch(P){p(P)}}function E(C){C.done?d(C.value):c(C.value).then(a,w)}E((n=n.apply(t,e||[])).next())})};function sOe(t){return t.endsWith("/")?t:t+"/"}function iOe(t,e){var r,n;const{db:c,auth:d,realtime:p,global:a}=t,{db:w,auth:E,realtime:C,global:P}=e,R={db:Object.assign(Object.assign({},w),c),auth:Object.assign(Object.assign({},E),d),realtime:Object.assign(Object.assign({},C),p),global:Object.assign(Object.assign(Object.assign({},P),a),{headers:Object.assign(Object.assign({},(r=P==null?void 0:P.headers)!==null&&r!==void 0?r:{}),(n=a==null?void 0:a.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>nOe(this,void 0,void 0,function*(){return""})};return t.accessToken?R.accessToken=t.accessToken:delete R.accessToken,R}const mte="2.70.0",Cv=30*1e3,EO=3,aM=EO*Cv,aOe="http://localhost:9999",oOe="supabase.auth.token",lOe={"X-Client-Info":`gotrue-js/${mte}`},TO="X-Supabase-Api-Version",gte={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},cOe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,uOe=6e5;class fF extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function $s(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class dOe extends fF{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function hOe(t){return $s(t)&&t.name==="AuthApiError"}class _te extends fF{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Lg extends fF{constructor(e,r,n,c){super(e,n,c),this.name=r,this.status=n}}class Pm extends Lg{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function fOe(t){return $s(t)&&t.name==="AuthSessionMissingError"}class Cj extends Lg{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Aj extends Lg{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Pj extends Lg{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function pOe(t){return $s(t)&&t.name==="AuthImplicitGrantRedirectError"}class e9 extends Lg{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jO extends Lg{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function oM(t){return $s(t)&&t.name==="AuthRetryableFetchError"}class t9 extends Lg{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class hS extends Lg{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const UI="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),r9=` 	
\r=`.split(""),mOe=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<r9.length;e+=1)t[r9[e].charCodeAt(0)]=-2;for(let e=0;e<UI.length;e+=1)t[UI[e].charCodeAt(0)]=e;return t})();function n9(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(UI[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(UI[n]),e.queuedBits-=6}}function yte(t,e,r){const n=mOe[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function s9(t){const e=[],r=p=>{e.push(String.fromCodePoint(p))},n={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},d=p=>{yOe(p,n,r)};for(let p=0;p<t.length;p+=1)yte(t.charCodeAt(p),c,d);return e.join("")}function gOe(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function _Oe(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const c=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|c)+65536,r+=1}gOe(n,e)}}function yOe(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if(!(t>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function xOe(t){const e=[],r={queue:0,queuedBits:0},n=c=>{e.push(c)};for(let c=0;c<t.length;c+=1)yte(t.charCodeAt(c),r,n);return new Uint8Array(e)}function vOe(t){const e=[];return _Oe(t,r=>e.push(r)),new Uint8Array(e)}function wOe(t){const e=[],r={queue:0,queuedBits:0},n=c=>{e.push(c)};return t.forEach(c=>n9(c,r,n)),n9(null,r,n),e.join("")}function bOe(t){return Math.round(Date.now()/1e3)+t}function SOe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const Od=()=>typeof window<"u"&&typeof document<"u",N_={tested:!1,writable:!1},fS=()=>{if(!Od())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(N_.tested)return N_.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),N_.tested=!0,N_.writable=!0}catch{N_.tested=!0,N_.writable=!1}return N_.writable};function EOe(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((c,d)=>{e[d]=c})}catch{}return r.searchParams.forEach((n,c)=>{e[c]=n}),e}const xte=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>ny(async()=>{const{default:n}=await Promise.resolve().then(()=>ww);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},TOe=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",vte=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},kj=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Rj=async(t,e)=>{await t.removeItem(e)};class CA{constructor(){this.promise=new CA.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}CA.promiseConstructor=Promise;function lM(t){const e=t.split(".");if(e.length!==3)throw new hS("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!cOe.test(e[n]))throw new hS("JWT not in base64url format");return{header:JSON.parse(s9(e[0])),payload:JSON.parse(s9(e[1])),signature:xOe(e[2]),raw:{header:e[0],payload:e[1]}}}async function jOe(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function NOe(t,e){return new Promise((n,c)=>{(async()=>{for(let d=0;d<1/0;d++)try{const p=await t(d);if(!e(d,null,p)){n(p);return}}catch(p){if(!e(d,p)){c(p);return}}})()})}function IOe(t){return("0"+t.toString(16)).substr(-2)}function COe(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let c="";for(let d=0;d<56;d++)c+=r.charAt(Math.floor(Math.random()*n));return c}return crypto.getRandomValues(e),Array.from(e,IOe).join("")}async function AOe(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),c=new Uint8Array(n);return Array.from(c).map(d=>String.fromCharCode(d)).join("")}async function POe(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await AOe(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function wv(t,e,r=!1){const n=COe();let c=n;r&&(c+="/PASSWORD_RECOVERY"),await vte(t,`${e}-code-verifier`,c);const d=await POe(n);return[d,n===d?"plain":"s256"]}const kOe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ROe(t){const e=t.headers.get(TO);if(!e||!e.match(kOe))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function MOe(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function DOe(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const OOe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function bv(t){if(!OOe.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var LOe=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(t);c<n.length;c++)e.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(t,n[c])&&(r[n[c]]=t[n[c]]);return r};const R_=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),FOe=[502,503,504];async function i9(t){var e;if(!TOe(t))throw new jO(R_(t),0);if(FOe.includes(t.status))throw new jO(R_(t),t.status);let r;try{r=await t.json()}catch(d){throw new _te(R_(d),d)}let n;const c=ROe(t);if(c&&c.getTime()>=gte["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new t9(R_(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Pm}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((d,p)=>d&&typeof p=="string",!0))throw new t9(R_(r),t.status,r.weak_password.reasons);throw new dOe(R_(r),t.status||500,n)}const zOe=(t,e,r,n)=>{const c={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),c.body=JSON.stringify(n),Object.assign(Object.assign({},c),r))};async function di(t,e,r,n){var c;const d=Object.assign({},n==null?void 0:n.headers);d[TO]||(d[TO]=gte["2024-01-01"].name),n!=null&&n.jwt&&(d.Authorization=`Bearer ${n.jwt}`);const p=(c=n==null?void 0:n.query)!==null&&c!==void 0?c:{};n!=null&&n.redirectTo&&(p.redirect_to=n.redirectTo);const a=Object.keys(p).length?"?"+new URLSearchParams(p).toString():"",w=await BOe(t,e,r+a,{headers:d,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(w):{data:Object.assign({},w),error:null}}async function BOe(t,e,r,n,c,d){const p=zOe(e,n,c,d);let a;try{a=await t(r,Object.assign({},p))}catch(w){throw console.error(w),new jO(R_(w),0)}if(a.ok||await i9(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(w){await i9(w)}}function Zf(t){var e;let r=null;qOe(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=bOe(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function a9(t){const e=Zf(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function qm(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function VOe(t){return{data:t,error:null}}function UOe(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:c,verification_type:d}=t,p=LOe(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:c,verification_type:d},w=Object.assign({},p);return{data:{properties:a,user:w},error:null}}function $Oe(t){return t}function qOe(t){return t.access_token&&t.refresh_token&&t.expires_in}const cM=["global","local","others"];var GOe=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(t);c<n.length;c++)e.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(t,n[c])&&(r[n[c]]=t[n[c]]);return r};class HOe{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=xte(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r=cM[0]){if(cM.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${cM.join(", ")}`);try{return await di(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if($s(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await di(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:qm})}catch(n){if($s(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=GOe(e,["options"]),c=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(c.new_email=n==null?void 0:n.newEmail,delete c.newEmail),await di(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:UOe,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if($s(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await di(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:qm})}catch(r){if($s(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,c,d,p,a,w;try{const E={nextPage:null,lastPage:0,total:0},C=await di(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(d=(c=e==null?void 0:e.perPage)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""},xform:$Oe});if(C.error)throw C.error;const P=await C.json(),R=(p=C.headers.get("x-total-count"))!==null&&p!==void 0?p:0,B=(w=(a=C.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&w!==void 0?w:[];return B.length>0&&(B.forEach(V=>{const W=parseInt(V.split(";")[0].split("=")[1].substring(0,1)),K=JSON.parse(V.split(";")[1].split("=")[1]);E[`${K}Page`]=W}),E.total=parseInt(R)),{data:Object.assign(Object.assign({},P),E),error:null}}catch(E){if($s(E))return{data:{users:[]},error:E};throw E}}async getUserById(e){bv(e);try{return await di(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:qm})}catch(r){if($s(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){bv(e);try{return await di(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:qm})}catch(n){if($s(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){bv(e);try{return await di(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:qm})}catch(n){if($s(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){bv(e.userId);try{const{data:r,error:n}=await di(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:r,error:n}}catch(r){if($s(r))return{data:null,error:r};throw r}}async _deleteFactor(e){bv(e.userId),bv(e.id);try{return{data:await di(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if($s(r))return{data:null,error:r};throw r}}}const WOe={getItem:t=>fS()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{fS()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{fS()&&globalThis.localStorage.removeItem(t)}};function o9(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function ZOe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Sv={debug:!!(globalThis&&fS()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class wte extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class KOe extends wte{}async function XOe(t,e,r){Sv.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Sv.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async c=>{if(c){Sv.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,c.name);try{return await r()}finally{Sv.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,c.name)}}else{if(e===0)throw Sv.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new KOe(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Sv.debug)try{const d=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(d,null,"  "))}catch(d){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",d)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}ZOe();const YOe={url:aOe,storageKey:oOe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:lOe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function l9(t,e,r){return await r()}class hE{constructor(e){var r,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=hE.nextInstanceID,hE.nextInstanceID+=1,this.instanceID>0&&Od()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const c=Object.assign(Object.assign({},YOe),e);if(this.logDebugMessages=!!c.debug,typeof c.debug=="function"&&(this.logger=c.debug),this.persistSession=c.persistSession,this.storageKey=c.storageKey,this.autoRefreshToken=c.autoRefreshToken,this.admin=new HOe({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=xte(c.fetch),this.lock=c.lock||l9,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,c.lock?this.lock=c.lock:Od()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=XOe:this.lock=l9,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?c.storage?this.storage=c.storage:fS()?this.storage=WOe:(this.memoryStorage={},this.storage=o9(this.memoryStorage)):(this.memoryStorage={},this.storage=o9(this.memoryStorage)),Od()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${mte}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const r=EOe(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),Od()&&this.detectSessionInUrl&&n!=="none"){const{data:c,error:d}=await this._getSessionFromURL(r,n);if(d){if(this._debug("#_initialize()","error detecting session from URL",d),pOe(d)){const w=(e=d.details)===null||e===void 0?void 0:e.code;if(w==="identity_already_exists"||w==="identity_not_found"||w==="single_identity_not_deletable")return{error:d}}return await this._removeSession(),{error:d}}const{session:p,redirectType:a}=c;return this._debug("#_initialize()","detected session in URL",p,"redirect type",a),await this._saveSession(p),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",p):await this._notifyAllSubscribers("SIGNED_IN",p)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return $s(r)?{error:r}:{error:new _te("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,c;try{const d=await di(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(c=e==null?void 0:e.options)===null||c===void 0?void 0:c.captchaToken}},xform:Zf}),{data:p,error:a}=d;if(a||!p)return{data:{user:null,session:null},error:a};const w=p.session,E=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",w)),{data:{user:E,session:w},error:null}}catch(d){if($s(d))return{data:{user:null,session:null},error:d};throw d}}async signUp(e){var r,n,c;try{let d;if("email"in e){const{email:C,password:P,options:R}=e;let B=null,V=null;this.flowType==="pkce"&&([B,V]=await wv(this.storage,this.storageKey)),d=await di(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:R==null?void 0:R.emailRedirectTo,body:{email:C,password:P,data:(r=R==null?void 0:R.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken},code_challenge:B,code_challenge_method:V},xform:Zf})}else if("phone"in e){const{phone:C,password:P,options:R}=e;d=await di(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:C,password:P,data:(n=R==null?void 0:R.data)!==null&&n!==void 0?n:{},channel:(c=R==null?void 0:R.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken}},xform:Zf})}else throw new Aj("You must provide either an email or phone number and a password");const{data:p,error:a}=d;if(a||!p)return{data:{user:null,session:null},error:a};const w=p.session,E=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",w)),{data:{user:E,session:w},error:null}}catch(d){if($s(d))return{data:{user:null,session:null},error:d};throw d}}async signInWithPassword(e){try{let r;if("email"in e){const{email:d,password:p,options:a}=e;r=await di(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:d,password:p,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:a9})}else if("phone"in e){const{phone:d,password:p,options:a}=e;r=await di(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:d,password:p,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:a9})}else throw new Aj("You must provide either an email or phone number and a password");const{data:n,error:c}=r;return c?{data:{user:null,session:null},error:c}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Cj}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:c})}catch(r){if($s(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,c,d;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(d=e.options)===null||d===void 0?void 0:d.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;if(r==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(e){var r,n,c,d,p,a,w,E,C,P,R,B;let V,W;if("message"in e)V=e.message,W=e.signature;else{const{chain:K,wallet:Z,statement:$,options:X}=e;let Q;if(Od())if(typeof Z=="object")Q=Z;else{const ve=window;if("solana"in ve&&typeof ve.solana=="object"&&("signIn"in ve.solana&&typeof ve.solana.signIn=="function"||"signMessage"in ve.solana&&typeof ve.solana.signMessage=="function"))Q=ve.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof Z!="object"||!(X!=null&&X.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Q=Z}const re=new URL((r=X==null?void 0:X.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in Q&&Q.signIn){const ve=await Q.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},X==null?void 0:X.signInWithSolana),{version:"1",domain:re.host,uri:re.href}),$?{statement:$}:null));let pe;if(Array.isArray(ve)&&ve[0]&&typeof ve[0]=="object")pe=ve[0];else if(ve&&typeof ve=="object"&&"signedMessage"in ve&&"signature"in ve)pe=ve;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in pe&&"signature"in pe&&(typeof pe.signedMessage=="string"||pe.signedMessage instanceof Uint8Array)&&pe.signature instanceof Uint8Array)V=typeof pe.signedMessage=="string"?pe.signedMessage:new TextDecoder().decode(pe.signedMessage),W=pe.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Q)||typeof Q.signMessage!="function"||!("publicKey"in Q)||typeof Q!="object"||!Q.publicKey||!("toBase58"in Q.publicKey)||typeof Q.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");V=[`${re.host} wants you to sign in with your Solana account:`,Q.publicKey.toBase58(),...$?["",$,""]:[""],"Version: 1",`URI: ${re.href}`,`Issued At: ${(c=(n=X==null?void 0:X.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((d=X==null?void 0:X.signInWithSolana)===null||d===void 0)&&d.notBefore?[`Not Before: ${X.signInWithSolana.notBefore}`]:[],...!((p=X==null?void 0:X.signInWithSolana)===null||p===void 0)&&p.expirationTime?[`Expiration Time: ${X.signInWithSolana.expirationTime}`]:[],...!((a=X==null?void 0:X.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${X.signInWithSolana.chainId}`]:[],...!((w=X==null?void 0:X.signInWithSolana)===null||w===void 0)&&w.nonce?[`Nonce: ${X.signInWithSolana.nonce}`]:[],...!((E=X==null?void 0:X.signInWithSolana)===null||E===void 0)&&E.requestId?[`Request ID: ${X.signInWithSolana.requestId}`]:[],...!((P=(C=X==null?void 0:X.signInWithSolana)===null||C===void 0?void 0:C.resources)===null||P===void 0)&&P.length?["Resources",...X.signInWithSolana.resources.map(pe=>`- ${pe}`)]:[]].join(`
`);const ve=await Q.signMessage(new TextEncoder().encode(V),"utf8");if(!ve||!(ve instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");W=ve}}try{const{data:K,error:Z}=await di(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:V,signature:wOe(W)},!((R=e.options)===null||R===void 0)&&R.captchaToken?{gotrue_meta_security:{captcha_token:(B=e.options)===null||B===void 0?void 0:B.captchaToken}}:null),xform:Zf});if(Z)throw Z;return!K||!K.session||!K.user?{data:{user:null,session:null},error:new Cj}:(K.session&&(await this._saveSession(K.session),await this._notifyAllSubscribers("SIGNED_IN",K.session)),{data:Object.assign({},K),error:Z})}catch(K){if($s(K))return{data:{user:null,session:null},error:K};throw K}}async _exchangeCodeForSession(e){const r=await kj(this.storage,`${this.storageKey}-code-verifier`),[n,c]=(r??"").split("/");try{const{data:d,error:p}=await di(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Zf});if(await Rj(this.storage,`${this.storageKey}-code-verifier`),p)throw p;return!d||!d.session||!d.user?{data:{user:null,session:null,redirectType:null},error:new Cj}:(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),{data:Object.assign(Object.assign({},d),{redirectType:c??null}),error:p})}catch(d){if($s(d))return{data:{user:null,session:null,redirectType:null},error:d};throw d}}async signInWithIdToken(e){try{const{options:r,provider:n,token:c,access_token:d,nonce:p}=e,a=await di(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:c,access_token:d,nonce:p,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Zf}),{data:w,error:E}=a;return E?{data:{user:null,session:null},error:E}:!w||!w.session||!w.user?{data:{user:null,session:null},error:new Cj}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:w,error:E})}catch(r){if($s(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,c,d,p;try{if("email"in e){const{email:a,options:w}=e;let E=null,C=null;this.flowType==="pkce"&&([E,C]=await wv(this.storage,this.storageKey));const{error:P}=await di(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=w==null?void 0:w.data)!==null&&r!==void 0?r:{},create_user:(n=w==null?void 0:w.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},code_challenge:E,code_challenge_method:C},redirectTo:w==null?void 0:w.emailRedirectTo});return{data:{user:null,session:null},error:P}}if("phone"in e){const{phone:a,options:w}=e,{data:E,error:C}=await di(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(c=w==null?void 0:w.data)!==null&&c!==void 0?c:{},create_user:(d=w==null?void 0:w.shouldCreateUser)!==null&&d!==void 0?d:!0,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},channel:(p=w==null?void 0:w.channel)!==null&&p!==void 0?p:"sms"}});return{data:{user:null,session:null,messageId:E==null?void 0:E.message_id},error:C}}throw new Aj("You must provide either an email or phone number.")}catch(a){if($s(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var r,n;try{let c,d;"options"in e&&(c=(r=e.options)===null||r===void 0?void 0:r.redirectTo,d=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:p,error:a}=await di(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:d}}),redirectTo:c,xform:Zf});if(a)throw a;if(!p)throw new Error("An error occurred on token verification.");const w=p.session,E=p.user;return w!=null&&w.access_token&&(await this._saveSession(w),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",w)),{data:{user:E,session:w},error:null}}catch(c){if($s(c))return{data:{user:null,session:null},error:c};throw c}}async signInWithSSO(e){var r,n,c;try{let d=null,p=null;return this.flowType==="pkce"&&([d,p]=await wv(this.storage,this.storageKey)),await di(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((c=e==null?void 0:e.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:d,code_challenge_method:p}),headers:this.headers,xform:VOe})}catch(d){if($s(d))return{data:null,error:d};throw d}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new Pm;const{error:c}=await di(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:c}})}catch(e){if($s(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:c,options:d}=e,{error:p}=await di(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},redirectTo:d==null?void 0:d.emailRedirectTo});return{data:{user:null,session:null},error:p}}else if("phone"in e){const{phone:n,type:c,options:d}=e,{data:p,error:a}=await di(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}}});return{data:{user:null,session:null,messageId:p==null?void 0:p.message_id},error:a}}throw new Aj("You must provide either an email or phone number and a type")}catch(r){if($s(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await kj(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<aM:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){let p=this.suppressGetSessionWarning;e=new Proxy(e,{get:(w,E,C)=>(!p&&E==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),p=!0,this.suppressGetSessionWarning=!0),Reflect.get(w,E,C))})}return{data:{session:e},error:null}}const{session:c,error:d}=await this._callRefreshToken(e.refresh_token);return d?{data:{session:null},error:d}:{data:{session:c},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await di(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:qm}):await this._useSession(async r=>{var n,c,d;const{data:p,error:a}=r;if(a)throw a;return!(!((n=p.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Pm}:await di(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(d=(c=p.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0,xform:qm})})}catch(r){if($s(r))return fOe(r)&&(await this._removeSession(),await Rj(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:c,error:d}=n;if(d)throw d;if(!c.session)throw new Pm;const p=c.session;let a=null,w=null;this.flowType==="pkce"&&e.email!=null&&([a,w]=await wv(this.storage,this.storageKey));const{data:E,error:C}=await di(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:w}),jwt:p.access_token,xform:qm});if(C)throw C;return p.user=E.user,await this._saveSession(p),await this._notifyAllSubscribers("USER_UPDATED",p),{data:{user:p.user},error:null}})}catch(n){if($s(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Pm;const r=Date.now()/1e3;let n=r,c=!0,d=null;const{payload:p}=lM(e.access_token);if(p.exp&&(n=p.exp,c=n<=r),c){const{session:a,error:w}=await this._callRefreshToken(e.refresh_token);if(w)return{data:{user:null,session:null},error:w};if(!a)return{data:{user:null,session:null},error:null};d=a}else{const{data:a,error:w}=await this._getUser(e.access_token);if(w)throw w;d={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)}return{data:{user:d.user,session:d},error:null}}catch(r){if($s(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:p,error:a}=r;if(a)throw a;e=(n=p.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Pm;const{session:c,error:d}=await this._callRefreshToken(e.refresh_token);return d?{data:{user:null,session:null},error:d}:c?{data:{user:c.user,session:c},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if($s(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!Od())throw new Pj("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Pj(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new e9("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Pj("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new e9("No code detected.");const{data:$,error:X}=await this._exchangeCodeForSession(e.code);if(X)throw X;const Q=new URL(window.location.href);return Q.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Q.toString()),{data:{session:$.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:c,access_token:d,refresh_token:p,expires_in:a,expires_at:w,token_type:E}=e;if(!d||!a||!p||!E)throw new Pj("No session defined in URL");const C=Math.round(Date.now()/1e3),P=parseInt(a);let R=C+P;w&&(R=parseInt(w));const B=R-C;B*1e3<=Cv&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${B}s, should have been closer to ${P}s`);const V=R-P;C-V>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",V,R,C):C-V<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",V,R,C);const{data:W,error:K}=await this._getUser(d);if(K)throw K;const Z={provider_token:n,provider_refresh_token:c,access_token:d,expires_in:P,expires_at:R,refresh_token:p,token_type:E,user:W.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:Z,redirectType:e.type},error:null}}catch(n){if($s(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await kj(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:c,error:d}=r;if(d)return{error:d};const p=(n=c.session)===null||n===void 0?void 0:n.access_token;if(p){const{error:a}=await this.admin.signOut(p,e);if(a&&!(hOe(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Rj(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=SOe(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,c;try{const{data:{session:d},error:p}=r;if(p)throw p;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",e,"session",d)}catch(d){await((c=this.stateChangeEmitters.get(e))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",d),console.error(d)}})}async resetPasswordForEmail(e,r={}){let n=null,c=null;this.flowType==="pkce"&&([n,c]=await wv(this.storage,this.storageKey,!0));try{return await di(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:c,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(d){if($s(d))return{data:null,error:d};throw d}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if($s(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:c}=await this._useSession(async d=>{var p,a,w,E,C;const{data:P,error:R}=d;if(R)throw R;const B=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(p=e.options)===null||p===void 0?void 0:p.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(w=e.options)===null||w===void 0?void 0:w.queryParams,skipBrowserRedirect:!0});return await di(this.fetch,"GET",B,{headers:this.headers,jwt:(C=(E=P.session)===null||E===void 0?void 0:E.access_token)!==null&&C!==void 0?C:void 0})});if(c)throw c;return Od()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if($s(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,c;const{data:d,error:p}=r;if(p)throw p;return await di(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(c=(n=d.session)===null||n===void 0?void 0:n.access_token)!==null&&c!==void 0?c:void 0})})}catch(r){if($s(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await NOe(async c=>(c>0&&await jOe(200*Math.pow(2,c-1)),this._debug(r,"refreshing attempt",c),await di(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Zf})),(c,d)=>{const p=200*Math.pow(2,c);return d&&oM(d)&&Date.now()+p-n<Cv})}catch(n){if(this._debug(r,"error",n),$s(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),Od()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await kj(this.storage,this.storageKey);if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const c=((e=n.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<aM;if(this._debug(r,`session has${c?"":" not"} expired with margin of ${aM}s`),c){if(this.autoRefreshToken&&n.refresh_token){const{error:d}=await this._callRefreshToken(n.refresh_token);d&&(console.error(d),oM(d)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new Pm;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new CA;const{data:d,error:p}=await this._refreshAccessToken(e);if(p)throw p;if(!d.session)throw new Pm;await this._saveSession(d.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",d.session);const a={session:d.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(d){if(this._debug(c,"error",d),$s(d)){const p={session:null,error:d};return oM(d)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(p),p}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(d),d}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(e,r,n=!0){const c=`#_notifyAllSubscribers(${e})`;this._debug(c,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const d=[],p=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(w){d.push(w)}});if(await Promise.all(p),d.length>0){for(let a=0;a<d.length;a+=1)console.error(d[a]);throw d[0]}}finally{this._debug(c,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await vte(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Rj(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Od()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Cv);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((n.expires_at*1e3-e)/Cv);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${Cv}ms, refresh threshold is ${EO} ticks`),c<=EO&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof wte)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Od()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const c=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&c.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&c.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[d,p]=await wv(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(d)}`,code_challenge_method:`${encodeURIComponent(p)}`});c.push(a.toString())}if(n!=null&&n.queryParams){const d=new URLSearchParams(n.queryParams);c.push(d.toString())}return n!=null&&n.skipBrowserRedirect&&c.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${c.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:c,error:d}=r;return d?{data:null,error:d}:await di(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=c==null?void 0:c.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if($s(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,c;const{data:d,error:p}=r;if(p)return{data:null,error:p};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:w,error:E}=await di(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=d==null?void 0:d.session)===null||n===void 0?void 0:n.access_token});return E?{data:null,error:E}:(e.factorType==="totp"&&(!((c=w==null?void 0:w.totp)===null||c===void 0)&&c.qr_code)&&(w.totp.qr_code=`data:image/svg+xml;utf-8,${w.totp.qr_code}`),{data:w,error:null})})}catch(r){if($s(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:c,error:d}=r;if(d)return{data:null,error:d};const{data:p,error:a}=await di(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=c==null?void 0:c.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+p.expires_in},p)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",p),{data:p,error:a})})}catch(r){if($s(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:c,error:d}=r;return d?{data:null,error:d}:await di(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=c==null?void 0:c.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if($s(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=(e==null?void 0:e.factors)||[],c=n.filter(p=>p.factor_type==="totp"&&p.status==="verified"),d=n.filter(p=>p.factor_type==="phone"&&p.status==="verified");return{data:{all:n,totp:c,phone:d},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:c},error:d}=e;if(d)return{data:null,error:d};if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:p}=lM(c.access_token);let a=null;p.aal&&(a=p.aal);let w=a;((n=(r=c.user.factors)===null||r===void 0?void 0:r.filter(P=>P.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(w="aal2");const C=p.amr||[];return{data:{currentLevel:a,nextLevel:w,currentAuthenticationMethods:C},error:null}}))}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(p=>p.kid===e);if(n||(n=this.jwks.keys.find(p=>p.kid===e),n&&this.jwks_cached_at+uOe>Date.now()))return n;const{data:c,error:d}=await di(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;if(!c.keys||c.keys.length===0)throw new hS("JWKS is empty");if(this.jwks=c,this.jwks_cached_at=Date.now(),n=c.keys.find(p=>p.kid===e),!n)throw new hS("No matching signing key found in JWKS");return n}async getClaims(e,r={keys:[]}){try{let n=e;if(!n){const{data:B,error:V}=await this.getSession();if(V||!B.session)return{data:null,error:V};n=B.session.access_token}const{header:c,payload:d,signature:p,raw:{header:a,payload:w}}=lM(n);if(MOe(d.exp),!c.kid||c.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:B}=await this.getUser(n);if(B)throw B;return{data:{claims:d,header:c,signature:p},error:null}}const E=DOe(c.alg),C=await this.fetchJwk(c.kid,r),P=await crypto.subtle.importKey("jwk",C,E,!0,["verify"]);if(!await crypto.subtle.verify(E,P,p,vOe(`${a}.${w}`)))throw new hS("Invalid JWT signature");return{data:{claims:d,header:c,signature:p},error:null}}catch(n){if($s(n))return{data:null,error:n};throw n}}}hE.nextInstanceID=0;const JOe=hE;class QOe extends JOe{constructor(e){super(e)}}var eLe=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function a(C){try{E(n.next(C))}catch(P){p(P)}}function w(C){try{E(n.throw(C))}catch(P){p(P)}}function E(C){C.done?d(C.value):c(C.value).then(a,w)}E((n=n.apply(t,e||[])).next())})};class tLe{constructor(e,r,n){var c,d,p;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const a=sOe(e),w=new URL(a);this.realtimeUrl=new URL("realtime/v1",w),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",w),this.storageUrl=new URL("storage/v1",w),this.functionsUrl=new URL("functions/v1",w);const E=`sb-${w.hostname.split(".")[0]}-auth-token`,C={db:XDe,realtime:JDe,auth:Object.assign(Object.assign({},YDe),{storageKey:E}),global:KDe},P=iOe(n??{},C);this.storageKey=(c=P.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(d=P.global.headers)!==null&&d!==void 0?d:{},P.accessToken?(this.accessToken=P.accessToken,this.auth=new Proxy({},{get:(R,B)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(B)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((p=P.auth)!==null&&p!==void 0?p:{},this.headers,P.global.fetch),this.fetch=rOe(r,this._getAccessToken.bind(this),P.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},P.realtime)),this.rest=new yDe(new URL("rest/v1",w).href,{headers:this.headers,schema:P.db.schema,fetch:this.fetch}),P.accessToken||this._listenForAuthEvents()}get functions(){return new ZMe(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new HDe(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return eLe(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:c,storageKey:d,flowType:p,lock:a,debug:w},E,C){const P={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new QOe({url:this.authUrl.href,headers:Object.assign(Object.assign({},P),E),storageKey:d,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:c,flowType:p,lock:a,debug:w,fetch:C,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new kDe(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const rLe=(t,e,r)=>new tLe(t,e,r),bte="https://placeholder.supabase.co",Ste="placeholder_key";let Ete=null;Ete=rLe(bte,Ste);const nLe={isConfigured:Ste!=="your_supabase_anon_key",url:bte},sLe=()=>{const{currentUser:t,userProfile:e}=$i(),[r,n]=z.useState(!1),[c,d]=z.useState(!1),[p,a]=z.useState("menu"),[w,E]=z.useState([]),[C,P]=z.useState(""),[R,B]=z.useState(!1),[V,W]=z.useState({name:"",email:"",subject:"",message:""}),[K,Z]=z.useState(!1),[$,X]=z.useState(!1),Q=z.useRef(null),re=z.useRef(null),ve=()=>{var Xt;(Xt=Q.current)==null||Xt.scrollIntoView({behavior:"smooth"})};z.useEffect(()=>{ve()},[w]),z.useEffect(()=>{r&&p==="chat"&&re.current&&re.current.focus()},[r,p]),z.useEffect(()=>{(async()=>{const dt=await st();E(dt)})()},[t]),z.useEffect(()=>{t&&e&&W(Xt=>({...Xt,name:Xt.name||e.displayName||t.displayName||"",email:Xt.email||e.email||t.email||""}))},[t,e]);const pe=Xt=>{const dt=Xt.toLowerCase();if(dt.includes("bonjour")||dt.includes("salut")||dt.includes("hello")){const ft=(e==null?void 0:e.displayName)||(t==null?void 0:t.displayName)||"étudiant";return t?`Salut ${ft} ! 😊 Comment ça va ? Je peux t'aider avec tes annonces ou répondre à tes questions sur StudyMarket.`:"Salut ! 😊 Bienvenue sur StudyMarket ! Je peux t'aider à naviguer sur la plateforme. Que cherches-tu ?"}return dt.includes("annonce")||dt.includes("publier")||dt.includes("vendre")?`Pour publier une annonce, va sur "Créer une annonce" ! 📝 Tu peux vendre des livres, de l'électronique, proposer des services ou même faire du troc. Besoin d'aide pour une catégorie spécifique ?`:dt.includes("acheter")||dt.includes("trouver")||dt.includes("rechercher")?"Pour trouver des articles, utilise la barre de recherche ou parcours les catégories ! 🔍 Tu peux filtrer par prix et université. Que cherches-tu exactement ?":dt.includes("sécurité")||dt.includes("sûr")||dt.includes("confiance")?"StudyMarket est sécurisé ! 🛡️ Tous les étudiants sont vérifiés avec leur email universitaire. Utilise notre chat intégré et rencontrez-vous dans des lieux publics du campus.":dt.includes("prix")||dt.includes("coût")||dt.includes("gratuit")?"StudyMarket est 100% gratuit pour les étudiants ! 🎓 Pas de frais cachés pour publier ou contacter des vendeurs. On veut juste faciliter les échanges !":dt.includes("logement")||dt.includes("chambre")||dt.includes("colocation")?"🏠 Section Logement ! Tu peux chercher des colocations, studios ou chambres près de ton campus. Utilise les filtres par prix et distance. Visite toujours avant de t'engager !":dt.includes("job")||dt.includes("stage")||dt.includes("travail")?"💼 Jobs & Stages ! Parfait pour ton budget étudiant. Tu trouveras des petits boulots, cours particuliers, stages... Postule directement via la plateforme !":dt.includes("problème")||dt.includes("bug")||dt.includes("erreur")?"Oh non ! 😅 Peux-tu me dire quel problème ? Essaie de rafraîchir la page. Si ça persiste, contacte notre support !":dt.includes("merci")||dt.includes("thanks")?"De rien ! 😊 C'est un plaisir d'aider la communauté étudiante. N'hésite pas si tu as d'autres questions !":`Hmm, je ne suis pas sûr de comprendre ! 🤔 Je peux t'aider avec :

• Créer/gérer des annonces
• Questions de sécurité
• Navigation sur le site
• Infos sur les catégories

Pose-moi une question plus spécifique ! 😊`},ue=async()=>{if(!C.trim())return;const Xt={id:Date.now().toString(),text:C,sender:"user",timestamp:new Date},dt=[...w,Xt];E(dt),P(""),B(!0),Xe(dt),t&&$e(dt),setTimeout(()=>{const ft={id:(Date.now()+1).toString(),text:pe(C),sender:"bot",timestamp:new Date},Wt=[...dt,ft];E(Wt),B(!1),Xe(Wt),t&&$e(Wt)},1e3+Math.random()*1e3)},ge=Xt=>{Xt.key==="Enter"&&!Xt.shiftKey&&(Xt.preventDefault(),ue())},ce=async Xt=>{Xt.preventDefault(),Z(!0);try{const{data:dt,error:ft}=await Ete.functions.invoke("contact-email",{body:{name:V.name,email:V.email,subject:V.subject,message:V.message,user_id:(t==null?void 0:t.uid)||null}});if(ft)throw ft;if(!dt||!dt.success)throw new Error((dt==null?void 0:dt.error)||"Erreur lors de l'envoi");X(!0),Nt.success("Message envoyé avec succès ! Nous vous répondrons rapidement."),setTimeout(()=>{X(!1),W({name:"",email:"",subject:"",message:""}),a("menu")},3e3)}catch(dt){console.error("Erreur envoi message:",dt),Nt.error("Erreur lors de l'envoi du message: "+(dt.message||"Erreur inconnue"))}finally{Z(!1)}},Se=(Xt,dt)=>{W(ft=>({...ft,[Xt]:dt}))},le=()=>{n(!0),d(!1),a("menu")},J=()=>{n(!1),d(!1),a("menu")},ke=()=>{d(!c)},Ze=()=>{window.location.href="/"},Xe=Xt=>{try{localStorage.setItem("chatbot_messages",JSON.stringify(Xt))}catch(dt){console.warn("Erreur sauvegarde cache:",dt)}},qe=()=>{try{const Xt=localStorage.getItem("chatbot_messages");if(Xt)return JSON.parse(Xt).map(ft=>({...ft,timestamp:new Date(ft.timestamp)}))}catch(Xt){console.warn("Erreur chargement cache:",Xt)}return[{id:"1",text:"Salut ! 👋 Je suis l'assistant StudyMarket. Comment puis-je t'aider aujourd'hui ?",sender:"bot",timestamp:new Date}]},$e=async Xt=>{if(t)try{const dt=hn(rr,"chatHistory",t.uid);await C0(dt,{messages:Xt.map(ft=>({...ft,timestamp:ft.timestamp.toISOString()})),lastUpdated:new Date().toISOString()},{merge:!0})}catch(dt){console.warn("Erreur sauvegarde Firestore:",dt)}},st=async()=>{if(!t)return qe();try{const Xt=hn(rr,"chatHistory",t.uid),dt=await Xa(Xt);if(dt.exists()){const Wt=dt.data().messages.map(Wr=>({...Wr,timestamp:new Date(Wr.timestamp)}));return Xe(Wt),Wt}}catch(Xt){console.warn("Erreur chargement Firestore:",Xt)}return qe()},it=()=>i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"text-center mb-6",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-primary to-secondary flex items-center justify-center mx-auto mb-4",children:i.jsx("span",{className:"text-2xl font-bold text-white",children:"T"})}),i.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:["Salut ",(e==null?void 0:e.displayName)||(t==null?void 0:t.displayName)||"Étudiant"," ! 👋"]}),i.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Comment peut-on t'aider ?"})]}),i.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors rounded-lg",onClick:()=>a("chat"),children:[i.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Message récent"}),w.length>0&&w.some(Xt=>Xt.sender==="user")?i.jsxs("div",{className:"flex items-start space-x-3",children:[i.jsx(Jc,{className:"w-8 h-8",children:i.jsx(Sc,{className:"bg-gradient-to-br from-primary to-secondary text-white text-xs",children:w[w.length-1].sender==="bot"?"T":"U"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:w[w.length-1].text.length>50?`${w[w.length-1].text.substring(0,50)}...`:w[w.length-1].text}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[w[w.length-1].sender==="bot"?"Assistant":"Vous"," • ",new Date(w[w.length-1].timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),i.jsx(fg,{className:"w-4 h-4 text-gray-400"})]}):i.jsxs("div",{className:"flex items-center justify-between py-4",children:[i.jsx("p",{className:"text-sm text-gray-500 italic",children:"Aucun message récent"}),i.jsx(fg,{className:"w-4 h-4 text-gray-400"})]})]})]}),Mt=()=>i.jsxs("div",{className:"flex items-center justify-around p-4 bg-white dark:bg-gray-900",children:[i.jsx(Ge,{variant:"ghost",size:"sm",onClick:Ze,className:`p-2 ${p==="home"?"text-primary":"text-gray-500"}`,children:i.jsx(qd,{className:"w-5 h-5"})}),i.jsx(Ge,{variant:"ghost",size:"sm",onClick:()=>a("chat"),className:`p-2 ${p==="chat"?"text-primary":"text-gray-500"}`,children:i.jsx(jxe,{className:"w-5 h-5"})}),i.jsx(Ge,{variant:"ghost",size:"sm",onClick:()=>a("contact"),className:`p-2 ${p==="contact"?"text-primary":"text-gray-500"}`,children:i.jsx(Nl,{className:"w-5 h-5"})})]}),ar=()=>i.jsxs("div",{className:"flex flex-col h-full",children:[i.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-primary/5 to-secondary/5",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(Ge,{variant:"ghost",size:"sm",onClick:()=>a("menu"),className:"p-2",children:i.jsx(vp,{className:"w-4 h-4"})}),i.jsx(Jc,{className:"w-8 h-8",children:i.jsx(Sc,{className:"bg-gradient-to-br from-primary to-secondary text-white text-xs",children:"SM"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-sm",children:"Assistant StudyMarket"}),i.jsx("p",{className:"text-xs text-green-600",children:"En ligne"})]})]}),i.jsx(Ir,{className:"bg-green-100 text-green-800 text-xs",children:"Actif"})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[w.map((Xt,dt)=>{var Wr,jr;const ft=Xt.sender==="user",Wt=dt===0||w[dt-1].sender!==Xt.sender;return i.jsxs("div",{className:`flex items-end space-x-2 ${ft?"flex-row-reverse space-x-reverse":""}`,children:[i.jsx("div",{className:"flex-shrink-0",children:Wt?i.jsx(Jc,{className:"w-8 h-8",children:ft?e!=null&&e.photoURL?i.jsx("img",{src:e.photoURL,alt:"User Avatar",className:"w-full h-full object-cover rounded-full"}):i.jsx(Sc,{className:"bg-gradient-to-br from-blue-500 to-purple-500 text-white text-sm font-semibold",children:((Wr=e==null?void 0:e.displayName)==null?void 0:Wr.charAt(0))||((jr=t==null?void 0:t.displayName)==null?void 0:jr.charAt(0))||"U"}):i.jsx(Sc,{className:"bg-gradient-to-br from-primary to-secondary text-white text-sm font-semibold",children:"T"})}):i.jsx("div",{className:"w-8 h-8"})}),i.jsxs("div",{className:"flex flex-col max-w-[75%]",children:[i.jsx("div",{className:`px-4 py-2 ${ft?"bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl rounded-br-md":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-2xl rounded-bl-md"}`,children:i.jsx("p",{className:"text-sm whitespace-pre-line leading-relaxed text-left",children:Xt.text})}),i.jsx("p",{className:`text-xs text-gray-500 mt-1 px-1 ${ft?"text-right":"text-left"}`,children:Xt.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},Xt.id)}),R&&i.jsxs("div",{className:"flex items-end space-x-2",children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx(Jc,{className:"w-8 h-8",children:i.jsx(Sc,{className:"bg-gradient-to-br from-primary to-secondary text-white text-sm font-semibold",children:"T"})})}),i.jsx("div",{className:"max-w-[75%]",children:i.jsx("div",{className:"px-4 py-3 bg-gray-100 dark:bg-gray-700 rounded-2xl rounded-bl-md",children:i.jsxs("div",{className:"flex space-x-1",children:[i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),i.jsx("div",{ref:Q})]}),i.jsx("div",{className:"p-4",children:i.jsxs("div",{className:"flex space-x-2",children:[i.jsx(Gr,{ref:re,value:C,onChange:Xt=>P(Xt.target.value),onKeyPress:ge,placeholder:"Tape ton message...",className:"flex-1 border-none focus:ring-0 focus:ring-offset-0 bg-gray-50 dark:bg-gray-700",disabled:R}),i.jsx(Ge,{onClick:ue,disabled:!C.trim()||R,size:"icon",className:"w-12 h-12 rounded-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:i.jsx(vy,{className:"w-6 h-6 text-white"})})]})})]}),St=()=>i.jsxs("div",{className:"flex flex-col h-full",children:[i.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-gradient-to-r from-primary/5 to-secondary/5",children:[i.jsx(Ge,{variant:"ghost",size:"sm",onClick:()=>a("menu"),className:"p-2",children:i.jsx(vp,{className:"w-4 h-4"})}),i.jsx(Nl,{className:"w-6 h-6 text-primary"}),i.jsx("h3",{className:"font-semibold",children:"Nous contacter"})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[!nLe.isConfigured,$?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"w-16 h-16 bg-green-100 flex items-center justify-center mx-auto mb-4",children:i.jsx(oZ,{className:"w-8 h-8 text-green-600"})}),i.jsx("h4",{className:"text-lg font-semibold text-green-600 mb-2",children:"Message envoyé !"}),i.jsx("p",{className:"text-gray-600",children:"Nous te répondrons rapidement."})]}):i.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nom complet *"}),i.jsx(Gr,{type:"text",value:V.name,onChange:Xt=>Se("name",Xt.target.value),required:!0,placeholder:"Ton nom complet",className:"w-full border-none focus:ring-0 focus:ring-offset-0 bg-gray-50 dark:bg-gray-700"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email *"}),i.jsx(Gr,{type:"email",value:V.email,onChange:Xt=>Se("email",Xt.target.value),required:!0,placeholder:"ton.email@univ.fr",className:"w-full border-none focus:ring-0 focus:ring-offset-0 bg-gray-50 dark:bg-gray-700"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sujet *"}),i.jsx(Gr,{type:"text",value:V.subject,onChange:Xt=>Se("subject",Xt.target.value),required:!0,placeholder:"Sujet de ton message",className:"w-full border-none focus:ring-0 focus:ring-offset-0 bg-gray-50 dark:bg-gray-700"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Message *"}),i.jsx("textarea",{value:V.message,onChange:Xt=>Se("message",Xt.target.value),required:!0,rows:4,placeholder:"Décris ta demande...",className:"w-full px-3 py-2 border-none focus:ring-0 focus:ring-offset-0 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 resize-none"})]}),i.jsx(Ge,{type:"submit",disabled:K,className:"w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white",children:K?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Envoi en cours..."]}):"Envoyer le message"})]})]})]});return i.jsxs(i.Fragment,{children:[i.jsx(Ge,{onClick:r?J:le,className:"fixed bottom-4 right-4 md:bottom-6 md:right-6 z-50 w-12 h-12 md:w-14 md:h-14 rounded-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110",children:r?i.jsx("img",{src:"/StudyMarket/assets/arrow.svg",alt:"Arrow",className:"w-5 h-5 md:w-6 md:h-6"}):i.jsx(xa,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),r&&i.jsx(Tt,{className:`fixed z-40 shadow-2xl border-0 bg-white dark:bg-gray-900 overflow-hidden transition-all duration-300 ease-in-out
            ${c?"bottom-24 right-4 w-80 max-w-[calc(100vw-2rem)] h-10":"bottom-24 right-4 w-80 max-w-[calc(100vw-2rem)] h-[500px] max-h-[calc(100vh-8rem)]"}
            md:${c?"bottom-20 md:right-6 md:w-80":"bottom-20 md:right-6 md:w-96 md:h-[550px] md:max-h-[calc(100vh-8rem)]"}
            md:max-w-none
          `,children:i.jsxs(jt,{className:"p-0 h-full flex flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-primary to-secondary text-white cursor-pointer",onClick:ke,children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:c?i.jsx(bxe,{className:"w-4 h-4 text-white transform rotate-180"}):i.jsx(xa,{className:"w-4 h-4 text-white"})}),i.jsxs("div",{children:[i.jsx("h2",{className:"font-semibold text-sm",children:"StudyMarket"}),!c&&i.jsx("p",{className:"text-xs text-white/80",children:"Assistant en ligne"})]})]}),i.jsx("div",{className:"flex items-center space-x-2",children:i.jsx(Ge,{onClick:Xt=>{Xt.stopPropagation(),J()},variant:"ghost",size:"sm",className:"text-white hover:bg-white/20 p-1",children:i.jsx(of,{className:"w-4 h-4"})})})]}),!c&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex-1 overflow-hidden",children:[p==="menu"&&it(),p==="chat"&&ar(),p==="contact"&&St()]}),Mt()]})]})})]})};class iLe extends _n.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,r){console.error("ErrorBoundary caught an error:",e,r)}render(){var e;return this.state.hasError?i.jsxs("div",{style:{color:"red",padding:"2rem",textAlign:"center"},children:["Une erreur est survenue : ",(e=this.state.error)==null?void 0:e.message]}):this.props.children}}function aLe(){return i.jsx(Gle,{attribute:"class",defaultTheme:"light",enableSystem:!0,children:i.jsx(_xe,{children:i.jsxs(Lle,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[i.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[i.jsx(SSe,{}),i.jsx("main",{className:"flex-1 pt-16",children:i.jsx(iLe,{children:i.jsxs(Ile,{children:[i.jsx(Us,{path:"/",element:i.jsx(VTe,{})}),i.jsx(Us,{path:"/listings",element:i.jsx(b2e,{})}),i.jsx(Us,{path:"/listing/:id",element:i.jsx(bIe,{})}),i.jsx(Us,{path:"/auth",element:i.jsx(uMe,{})}),i.jsx(Us,{path:"/verify-email",element:i.jsx(dMe,{})}),i.jsx(Us,{path:"/help",element:i.jsx(BRe,{})}),i.jsx(Us,{path:"/safety",element:i.jsx(qRe,{})}),i.jsx(Us,{path:"/cart",element:i.jsx(NMe,{})}),i.jsx(Us,{path:"/products",element:i.jsx(AMe,{})}),i.jsx(Us,{path:"/checkout/success",element:i.jsx(DMe,{})}),i.jsx(Us,{path:"/payment/success",element:i.jsx(LMe,{})}),i.jsxs(Us,{path:"/admin",element:i.jsx(Vl,{children:i.jsx(TMe,{children:i.jsx(hMe,{})})}),children:[i.jsx(Us,{index:!0,element:i.jsx(fMe,{})}),i.jsx(Us,{path:"orders",element:i.jsx(pMe,{})}),i.jsx(Us,{path:"listings",element:i.jsx(mMe,{})}),i.jsx(Us,{path:"users",element:i.jsx(gMe,{})}),i.jsx(Us,{path:"webhooks",element:i.jsx(_Me,{})}),i.jsx(Us,{path:"payouts",element:i.jsx(yMe,{})}),i.jsx(Us,{path:"messages",element:i.jsx(xMe,{})}),i.jsx(Us,{path:"reports",element:i.jsx(vMe,{})}),i.jsx(Us,{path:"verifications",element:i.jsx(SMe,{})}),i.jsx(Us,{path:"audit",element:i.jsx(wMe,{})})]}),i.jsx(Us,{path:"/checkout/:id",element:i.jsx(Vl,{children:i.jsx(OMe,{})})}),i.jsx(Us,{path:"/orders",element:i.jsx(Vl,{children:i.jsx(PMe,{})})}),i.jsx(Us,{path:"/sales",element:i.jsx(Vl,{children:i.jsx(kMe,{})})}),i.jsx(Us,{path:"/order/:id",element:i.jsx(Vl,{children:i.jsx(RMe,{})})}),i.jsx(Us,{path:"/order-confirmation/:orderId",element:i.jsx(Vl,{children:i.jsx(MMe,{})})}),i.jsx(Us,{path:"/create",element:i.jsx(Vl,{children:i.jsx(Mke,{})})}),i.jsx(Us,{path:"/profile",element:i.jsx(Vl,{children:i.jsx(Fke,{})})}),i.jsx(Us,{path:"/verification",element:i.jsx(Vl,{children:i.jsx(Qke,{})})}),i.jsx(Us,{path:"/test-validation",element:i.jsx(Vl,{children:i.jsx(EMe,{})})}),i.jsx(Us,{path:"/settings",element:i.jsx(Vl,{children:i.jsx(uRe,{})})}),i.jsx(Us,{path:"/impact",element:i.jsx(Vl,{children:i.jsx(hRe,{})})}),i.jsx(Us,{path:"/saved-searches",element:i.jsx(Vl,{children:i.jsx(pRe,{})})}),i.jsx(Us,{path:"/favorites",element:i.jsx(Vl,{children:i.jsx(_Re,{})})}),i.jsx(Us,{path:"/payments",element:i.jsx(Vl,{children:i.jsx(yRe,{})})}),i.jsx(Us,{path:"/messages",element:i.jsx(Vl,{children:i.jsx(iMe,{})})}),i.jsx(Us,{path:"/edit-listing/:id",element:i.jsx(zMe,{})}),i.jsx(Us,{path:"/jobs",element:i.jsx(VMe,{})}),i.jsx(Us,{path:"/housing",element:i.jsx(UMe,{})}),i.jsx(Us,{path:"*",element:i.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Page non trouvée (404)"})})]})})}),i.jsx(TSe,{}),i.jsx(sLe,{})]}),i.jsx(zce,{position:"top-right",toastOptions:{duration:4e3,style:{background:"hsl(var(--background))",color:"hsl(var(--foreground))",border:"1px solid hsl(var(--border))"}}})]})})})}S7(document.getElementById("root")).render(i.jsx(z.StrictMode,{children:i.jsx(aLe,{})}));
